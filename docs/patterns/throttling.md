---
title: Регулирование
description: Контроль потребления ресурсов, используемых экземпляром приложения, отдельным клиентом или всей службой.
keywords: конструктивный шаблон
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- availability
- performance-scalability
ms.openlocfilehash: 29156fc72f40a952dd53adcb20ffa7c3d0af79b4
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
# <a name="throttling-pattern"></a><span data-ttu-id="fbbf4-104">Шаблон регулирования</span><span class="sxs-lookup"><span data-stu-id="fbbf4-104">Throttling pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="fbbf4-105">Контролируйте потребление ресурсов, используемых экземпляром приложения, отдельным клиентом или всей службой.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-105">Control the consumption of resources used by an instance of an application, an individual tenant, or an entire service.</span></span> <span data-ttu-id="fbbf4-106">Благодаря контролю потребления ресурсов система продолжает работать и выполняет соглашение об уровне обслуживания, даже если растущие потребности приводят к чрезмерной нагрузке на ресурсы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-106">This can allow the system to continue to function and meet service level agreements, even when an increase in demand places an extreme load on resources.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="fbbf4-107">Контекст и проблема</span><span class="sxs-lookup"><span data-stu-id="fbbf4-107">Context and problem</span></span>

<span data-ttu-id="fbbf4-108">Нагрузка на облачное приложение обычно изменяется со временем в зависимости от количества активных пользователей или действий, которые они выполняют.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-108">The load on a cloud application typically varies over time based on the number of active users or the types of activities they are performing.</span></span> <span data-ttu-id="fbbf4-109">Например, скорее всего, больше активных пользователей будет в рабочее время. Или в конце каждого месяца система будет выполнять аналитику, требующую большого количества вычислительных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-109">For example, more users are likely to be active during business hours, or the system might be required to perform computationally expensive analytics at the end of each month.</span></span> <span data-ttu-id="fbbf4-110">Могут также возникать неожиданные и непредвиденные всплески активности.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-110">There might also be sudden and unanticipated bursts in activity.</span></span> <span data-ttu-id="fbbf4-111">Если потребности системы в обработке превышают емкость доступных ресурсов, производительность системы будет очень низкой, и она даже может перестать работать.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-111">If the processing requirements of the system exceed the capacity of the resources that are available, it'll suffer from poor performance and can even fail.</span></span> <span data-ttu-id="fbbf4-112">Если система должна соответствовать установленному уровню обслуживания, такой сбой может быть неприемлемым.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-112">If the system has to meet an agreed level of service, such failure could be unacceptable.</span></span>

<span data-ttu-id="fbbf4-113">Изменяющуюся нагрузку в облаке можно обрабатывать разными способами. Их выбор зависит от бизнес-целей приложения.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-113">There're many strategies available for handling varying load in the cloud, depending on the business goals for the application.</span></span> <span data-ttu-id="fbbf4-114">Одним из решений может быть автоматическое масштабирование, то есть подготовка тех ресурсов, которые нужны пользователю в конкретный момент.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-114">One strategy is to use autoscaling to match the provisioned resources to the user needs at any given time.</span></span> <span data-ttu-id="fbbf4-115">Это создает потенциал для постоянного удовлетворения потребностей пользователей и одновременной оптимизации эксплуатационных расходов.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-115">This has the potential to consistently meet user demand, while optimizing running costs.</span></span> <span data-ttu-id="fbbf4-116">Однако, хотя автоматическое масштабирование инициирует подготовку дополнительных ресурсов, эта операция не выполняется немедленно.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-116">However, while autoscaling can trigger the provisioning of additional resources, this provisioning isn't immediate.</span></span> <span data-ttu-id="fbbf4-117">Если потребности в ресурсах растут быстро, может возникнуть период дефицита ресурсов.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-117">If demand grows quickly, there can be a window of time where there's a resource deficit.</span></span>

## <a name="solution"></a><span data-ttu-id="fbbf4-118">Решение</span><span class="sxs-lookup"><span data-stu-id="fbbf4-118">Solution</span></span>

<span data-ttu-id="fbbf4-119">Альтернативная стратегия автоматического масштабирования заключается в том, чтобы позволить приложениям использовать определенное ограниченное количество ресурсов, а затем регулировать приложения по достижении этого ограничения.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-119">An alternative strategy to autoscaling is to allow applications to use resources only up to a limit, and then throttle them when this limit is reached.</span></span> <span data-ttu-id="fbbf4-120">Система должна отслеживать использование ресурсов, чтобы при превышении порогового значения она могла регулировать запросы от одного или нескольких пользователей.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-120">The system should monitor how it's using resources so that, when usage exceeds the threshold, it can throttle requests from one or more users.</span></span> <span data-ttu-id="fbbf4-121">Эта стратегия позволяет системе продолжать работу и выполнять любое соглашение об уровне обслуживания, которое применяется к системе.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-121">This will enable the system to continue functioning and meet any service level agreements (SLAs) that are in place.</span></span> <span data-ttu-id="fbbf4-122">Дополнительные сведения о мониторинге использования ресурсов см. в [руководстве по инструментированию и телеметрии](https://msdn.microsoft.com/library/dn589775.aspx).</span><span class="sxs-lookup"><span data-stu-id="fbbf4-122">For more information on monitoring resource usage, see the [Instrumentation and Telemetry Guidance](https://msdn.microsoft.com/library/dn589775.aspx).</span></span>

<span data-ttu-id="fbbf4-123">В системе могут быть реализованы несколько стратегий регулирования, в том числе:</span><span class="sxs-lookup"><span data-stu-id="fbbf4-123">The system could implement several throttling strategies, including:</span></span>

- <span data-ttu-id="fbbf4-124">Отклонение запросов от отдельного пользователя, который уже получал доступ к API системы более n раз в секунду в течение определенного периода.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-124">Rejecting requests from an individual user who's already accessed system APIs more than n times per second over a given period of time.</span></span> <span data-ttu-id="fbbf4-125">Для этого система должна измерять использование ресурсов для каждого клиента или пользователя, использующих приложение.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-125">This requires the system to meter the use of resources for each tenant or user running an application.</span></span> <span data-ttu-id="fbbf4-126">Дополнительные сведения см. в [руководстве по контролю потребления служб](https://msdn.microsoft.com/library/dn589796.aspx).</span><span class="sxs-lookup"><span data-stu-id="fbbf4-126">For more information, see the [Service Metering Guidance](https://msdn.microsoft.com/library/dn589796.aspx).</span></span>

- <span data-ttu-id="fbbf4-127">Отключение или снижение функциональных возможностей выбранных неосновных служб, что позволяет предоставить достаточное количество ресурсов для беспрепятственной работы основных служб.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-127">Disabling or degrading the functionality of selected nonessential services so that essential services can run unimpeded with sufficient resources.</span></span> <span data-ttu-id="fbbf4-128">Например, если приложение выполняет потоковую передачу видео, для него можно включить более низкое разрешение.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-128">For example, if the application is streaming video output, it could switch to a lower resolution.</span></span>

- <span data-ttu-id="fbbf4-129">Выравнивание нагрузки для распределения объема операций. Этот подход подробно описан в статье о [шаблоне балансировки нагрузки на основе очередей](queue-based-load-leveling.md).</span><span class="sxs-lookup"><span data-stu-id="fbbf4-129">Using load leveling to smooth the volume of activity (this approach is covered in more detail by the [Queue-based Load Leveling pattern](queue-based-load-leveling.md)).</span></span> <span data-ttu-id="fbbf4-130">В среде с поддержкой нескольких клиентов такой подход приведет к снижению производительности для каждого клиента.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-130">In a multi-tenant environment, this approach will reduce the performance for every tenant.</span></span> <span data-ttu-id="fbbf4-131">Если система должна поддерживать разные клиенты с разными соглашениями об уровне обслуживания, запросы более важных клиентов могут обрабатываться немедленно.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-131">If the system must support a mix of tenants with different SLAs, the work for high-value tenants might be performed immediately.</span></span> <span data-ttu-id="fbbf4-132">Запросы других клиентов могут задерживаться и обрабатываться после выполнения более срочных запросов.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-132">Requests for other tenants can be held back, and handled when the backlog has eased.</span></span> <span data-ttu-id="fbbf4-133">Для реализации такого подхода можно использовать [шаблон приоритета очередей][].</span><span class="sxs-lookup"><span data-stu-id="fbbf4-133">The [Priority Queue pattern][] could be used to help implement this approach.</span></span>

- <span data-ttu-id="fbbf4-134">Отсрочка операций для приложений или клиентов с более низким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-134">Deferring operations being performed on behalf of lower priority applications or tenants.</span></span> <span data-ttu-id="fbbf4-135">Эти операции могут быть приостановлены или ограничены. При этом создается исключение,которое сообщает клиенту, что система занята и операцию следует повторить позже.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-135">These operations can be suspended or limited, with an exception generated to inform the tenant that the system is busy and that the operation should be retried later.</span></span>

<span data-ttu-id="fbbf4-136">На этой диаграмме с областями показано использование ресурсов (сочетание памяти, ЦП, пропускной способности и других факторов) по времени для приложений, которые используют три функции.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-136">The figure shows an area graph for resource use (a combination of memory, CPU, bandwidth, and other factors) against time for applications that are making use of three features.</span></span> <span data-ttu-id="fbbf4-137">Функция — это область функциональных возможностей, например компонент, который выполняет определенный набор задач, блок кода, выполняющий сложные вычисления, либо элемент, который реализует какую-то службу, например кэш в памяти.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-137">A feature is an area of functionality, such as a component that performs a specific set of tasks, a piece of code that performs a complex calculation, or an element that provides a service such as an in-memory cache.</span></span> <span data-ttu-id="fbbf4-138">Эти функции обозначены буквами A, B и C.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-138">These features are labeled A, B, and C.</span></span>

![Рис. 1. Диаграмма использования ресурсов по времени для приложений, которые используют три пользователя](./_images/throttling-resource-utilization.png)


> <span data-ttu-id="fbbf4-140">Область под линией функции показывает ресурсы, которые используются приложениями при вызове этой функции.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-140">The area immediately below the line for a feature indicates the resources that are used by applications when they invoke this feature.</span></span> <span data-ttu-id="fbbf4-141">Например, область под линией функции А отображает ресурсы, потребляемые приложениями, которые используют функцию А. Область между линиями функций A и B обозначает ресурсы, используемые приложениями, которые вызывают функцию B. Объединив области всех функций, можно определить совокупное использование ресурсов системы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-141">For example, the area below the line for Feature A shows the resources used by applications that are making use of Feature A, and the area between the lines for Feature A and Feature B indicates the resources used by applications invoking Feature B. Aggregating the areas for each feature shows the total resource use of the system.</span></span>

<span data-ttu-id="fbbf4-142">На рисунке выше показаны результаты задержки операций.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-142">The previous figure illustrates the effects of deferring operations.</span></span> <span data-ttu-id="fbbf4-143">Непосредственно перед точкой времени T1 общее число ресурсов, выделенных для всех приложений, использующих эти функции, достигает порогового значения (ограничения на использование ресурсов).</span><span class="sxs-lookup"><span data-stu-id="fbbf4-143">Just prior to time T1, the total resources allocated to all applications using these features reach a threshold (the limit of resource use).</span></span> <span data-ttu-id="fbbf4-144">На этом этапе существует риск, что приложения исчерпают доступные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-144">At this point, the applications are in danger of exhausting the resources available.</span></span> <span data-ttu-id="fbbf4-145">В этой системе функция B менее важна, чем функции A и C, поэтому она временно отключается и используемые ею ресурсы освобождаются.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-145">In this system, Feature B is less critical than Feature A or Feature C, so it's temporarily disabled and the resources that it was using are released.</span></span> <span data-ttu-id="fbbf4-146">Между точками времени T1 и T2 приложения, использующие функции A и C, продолжают работать в обычном режиме.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-146">Between times T1 and T2, the applications using Feature A and Feature C continue running as normal.</span></span> <span data-ttu-id="fbbf4-147">Со временем использование ресурсов этими двумя функциями снизится до такой степени, что в момент времени T2 высвободится достаточно ресурсов, чтобы снова включить функцию B.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-147">Eventually, the resource use of these two features diminishes to the point when, at time T2, there is sufficient capacity to enable Feature B again.</span></span>

<span data-ttu-id="fbbf4-148">Автоматическое масштабирование и регулирование можно также совмещать, чтобы обеспечить ответ приложений на запросы и выполнение соглашений об уровне обслуживания.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-148">The autoscaling and throttling approaches can also be combined to help keep the applications responsive and within SLAs.</span></span> <span data-ttu-id="fbbf4-149">Если ожидается, что потребности в ресурсах будут оставаться высокими, регулирование обеспечивает временное решение, пока развертывается система. На этом этапе можно восстановить полную функциональность системы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-149">If the demand is expected to remain high, throttling provides a temporary solution while the system scales out. At this point, the full functionality of the system can be restored.</span></span>

<span data-ttu-id="fbbf4-150">На следующей диаграмме с областями показано общее использование ресурсов всеми приложениями, работающими в системе, по времени. Также здесь показано, как регулирование можно объединить с автоматическим масштабированием.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-150">The next figure shows an area graph of the overall resource use by all applications running in a system against time, and illustrates how throttling can be combined with autoscaling.</span></span>

![Рисунок 2. Диаграмма, показывающая результаты объединения регулирования с автоматическим масштабированием](./_images/throttling-autoscaling.png)


<span data-ttu-id="fbbf4-152">В момент времени T1 достигнуто пороговое значение, соответствующее мягкому ограничению на использование ресурсов.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-152">At time T1, the threshold specifying the soft limit of resource use is reached.</span></span> <span data-ttu-id="fbbf4-153">На этом этапе может начаться горизонтальное масштабирование системы. Но если новые ресурсы не станут доступны достаточно быстро, существующие ресурсы могут быть исчерпаны и произойдет сбой системы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-153">At this point, the system can start to scale out. However, if the new resources don't become available quickly enough, then the existing resources might be exhausted and the system could fail.</span></span> <span data-ttu-id="fbbf4-154">Чтобы предотвратить такое развитие событий, система временно регулируется, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-154">To prevent this from occurring, the system is temporarily throttled, as described earlier.</span></span> <span data-ttu-id="fbbf4-155">После завершения автоматического масштабирования и появления дополнительных ресурсов регулирование можно уменьшить.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-155">When autoscaling has completed and the additional resources are available, throttling can be relaxed.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="fbbf4-156">Проблемы и рекомендации</span><span class="sxs-lookup"><span data-stu-id="fbbf4-156">Issues and considerations</span></span>

<span data-ttu-id="fbbf4-157">При выборе схемы реализации этого шаблона следует учитывать следующие моменты.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-157">You should consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="fbbf4-158">Регулирование приложения и стратегия его реализации является архитектурным решением, которое влияет на всю структуру системы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-158">Throttling an application, and the strategy to use, is an architectural decision that impacts the entire design of a system.</span></span> <span data-ttu-id="fbbf4-159">Регулирование следует запланировать на раннем этапе разработки приложения, так как его непросто добавить после реализации системы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-159">Throttling should be considered early in the application design process because it isn't easy to add once a system has been implemented.</span></span>

- <span data-ttu-id="fbbf4-160">Регулирование должно выполняться быстро.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-160">Throttling must be performed quickly.</span></span> <span data-ttu-id="fbbf4-161">Система должна уметь обнаруживать рост активности и реагировать соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-161">The system must be capable of detecting an increase in activity and react accordingly.</span></span> <span data-ttu-id="fbbf4-162">Система также должна уметь быстро восстанавливаться до исходного состояния после уменьшения нагрузки.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-162">The system must also be able to revert to its original state quickly after the load has eased.</span></span> <span data-ttu-id="fbbf4-163">Для этого необходимо постоянно собирать и отслеживать соответствующие данные производительности.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-163">This requires that the appropriate performance data is continually captured and monitored.</span></span>

- <span data-ttu-id="fbbf4-164">Если службе необходимо временно отклонить запрос пользователя, она должна вернуть конкретный код ошибки, чтобы указать клиентскому приложению, что причиной отказа выполнить операцию является регулирование.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-164">If a service needs to temporarily deny a user request, it should return a specific error code so the client application understands that the reason for the refusal to perform an operation is due to throttling.</span></span> <span data-ttu-id="fbbf4-165">Клиентское приложение может подождать какое-то время перед повторным выполнением запроса.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-165">The client application can wait for a period before retrying the request.</span></span>

- <span data-ttu-id="fbbf4-166">Регулирование может использоваться в качестве временной меры, пока система автоматически масштабируется.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-166">Throttling can be used as a temporary measure while a system autoscales.</span></span> <span data-ttu-id="fbbf4-167">Иногда лучше применить регулирование, чем масштабирование, если всплеск активности появился внезапно и не должен длиться долго, так как масштабирование может привести к значительному увеличению затрат.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-167">In some cases it's better to simply throttle, rather than to scale, if a burst in activity is sudden and isn't expected to be long lived because scaling can add considerably to running costs.</span></span>

- <span data-ttu-id="fbbf4-168">Если регулирование используется в качестве временной меры во время автомасштабирования системы и если потребность в ресурсах растет очень быстро, система может работать неправильно &mdash; даже если она работает в режиме регулирования.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-168">If throttling is being used as a temporary measure while a system autoscales, and if resource demands grow very quickly, the system might not be able to continue functioning&mdash;even when operating in a throttled mode.</span></span> <span data-ttu-id="fbbf4-169">Если это недопустимая ситуация, попробуйте поддерживать больше резервных ресурсов и настроить интенсивное автоматическое масштабирование.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-169">If this isn't acceptable, consider maintaining larger capacity reserves and configuring more aggressive autoscaling.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="fbbf4-170">Когда следует использовать этот шаблон</span><span class="sxs-lookup"><span data-stu-id="fbbf4-170">When to use this pattern</span></span>

<span data-ttu-id="fbbf4-171">Используйте этот шаблон в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="fbbf4-171">Use this pattern:</span></span>

- <span data-ttu-id="fbbf4-172">чтобы гарантировать постоянное соответствие системы соглашению об уровне обслуживания;</span><span class="sxs-lookup"><span data-stu-id="fbbf4-172">To ensure that a system continues to meet service level agreements.</span></span>

- <span data-ttu-id="fbbf4-173">чтобы предотвратить монополизацию ресурсов приложения одним клиентом;</span><span class="sxs-lookup"><span data-stu-id="fbbf4-173">To prevent a single tenant from monopolizing the resources provided by an application.</span></span>

- <span data-ttu-id="fbbf4-174">чтобы справляться со всплесками активности;</span><span class="sxs-lookup"><span data-stu-id="fbbf4-174">To handle bursts in activity.</span></span>

- <span data-ttu-id="fbbf4-175">чтобы оптимизировать затраты на систему, ограничивая максимальные уровни ресурсов, необходимые для поддержания работы системы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-175">To help cost-optimize a system by limiting the maximum resource levels needed to keep it functioning.</span></span>

## <a name="example"></a><span data-ttu-id="fbbf4-176">Пример</span><span class="sxs-lookup"><span data-stu-id="fbbf4-176">Example</span></span>

<span data-ttu-id="fbbf4-177">На последнем рисунке показано, как можно реализовать регулирование в системе, поддерживающей несколько клиентов.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-177">The final figure illustrates how throttling can be implemented in a multi-tenant system.</span></span> <span data-ttu-id="fbbf4-178">Пользователи в каждой клиентской организации получают доступ к размещенному в облаке приложению, в котором они заполняют и отправляют опросы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-178">Users from each of the tenant organizations access a cloud-hosted application where they fill out and submit surveys.</span></span> <span data-ttu-id="fbbf4-179">Инструментирование в приложении контролирует скорость, с которой пользователи отправляют запросы к приложению.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-179">The application contains instrumentation that monitors the rate at which these users are submitting requests to the application.</span></span>

<span data-ttu-id="fbbf4-180">Чтобы пользователи из одного клиента не влияли на скорость реагирования и доступность приложения для других пользователей, ограничивается число запросов в секунду, которые могут отправить пользователи из одного клиента.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-180">In order to prevent the users from one tenant affecting the responsiveness and availability of the application for all other users, a limit is applied to the number of requests per second the users from any one tenant can submit.</span></span> <span data-ttu-id="fbbf4-181">Приложение блокирует запросы, которые превышают это ограничение.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-181">The application blocks requests that exceed this limit.</span></span>

![Рисунок 3. Реализация регулирования в приложении с поддержкой нескольких клиентов](./_images/throttling-multi-tenant.png)


## <a name="related-patterns-and-guidance"></a><span data-ttu-id="fbbf4-183">Связанные шаблоны и рекомендации</span><span class="sxs-lookup"><span data-stu-id="fbbf4-183">Related patterns and guidance</span></span>

<span data-ttu-id="fbbf4-184">При реализации данного шаблона можно принять во внимание следующие шаблоны и рекомендации:</span><span class="sxs-lookup"><span data-stu-id="fbbf4-184">The following patterns and guidance may also be relevant when implementing this pattern:</span></span>
- <span data-ttu-id="fbbf4-185">[Руководство по инструментированию и телеметрии.](https://msdn.microsoft.com/library/dn589775.aspx)</span><span class="sxs-lookup"><span data-stu-id="fbbf4-185">[Instrumentation and Telemetry Guidance](https://msdn.microsoft.com/library/dn589775.aspx).</span></span> <span data-ttu-id="fbbf4-186">Регулирование зависит от сбора сведений об интенсивности использования службы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-186">Throttling depends on gathering information about how heavily a service is being used.</span></span> <span data-ttu-id="fbbf4-187">Руководство объясняет, как создавать и записывать пользовательские данные мониторинга.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-187">Describes how to generate and capture custom monitoring information.</span></span>
- <span data-ttu-id="fbbf4-188">[Руководство по контролю потребления служб](https://msdn.microsoft.com/library/dn589796.aspx).</span><span class="sxs-lookup"><span data-stu-id="fbbf4-188">[Service Metering Guidance](https://msdn.microsoft.com/library/dn589796.aspx).</span></span> <span data-ttu-id="fbbf4-189">Описывает, как контролировать потребление служб, чтобы знать, как они используются.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-189">Describes how to meter the use of services in order to gain an understanding of how they are used.</span></span> <span data-ttu-id="fbbf4-190">С помощью этих сведений можно определить способ регулирования службы.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-190">This information can be useful in determining how to throttle a service.</span></span>
- <span data-ttu-id="fbbf4-191">[Автоматическое масштабирование](https://msdn.microsoft.com/library/dn589774.aspx).</span><span class="sxs-lookup"><span data-stu-id="fbbf4-191">[Autoscaling Guidance](https://msdn.microsoft.com/library/dn589774.aspx).</span></span> <span data-ttu-id="fbbf4-192">Регулирование может использоваться в качестве временной меры, пока система автоматически масштабируется. Или его можно использовать, чтобы система вообще не выполняла автоматическое масштабирование.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-192">Throttling can be used as an interim measure while a system autoscales, or to remove the need for a system to autoscale.</span></span> <span data-ttu-id="fbbf4-193">Статья содержит сведения о стратегиях автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-193">Contains information on autoscaling strategies.</span></span>
- <span data-ttu-id="fbbf4-194">[Шаблон балансировки нагрузки на основе очередей](queue-based-load-leveling.md).</span><span class="sxs-lookup"><span data-stu-id="fbbf4-194">[Queue-based Load Leveling pattern](queue-based-load-leveling.md).</span></span> <span data-ttu-id="fbbf4-195">Балансировка нагрузки на основе очередей часто используется для реализации регулирования.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-195">Queue-based load leveling is a commonly used mechanism for implementing throttling.</span></span> <span data-ttu-id="fbbf4-196">Очередь может служить буфером, который помогает балансировать скорость доставки в службу запросов, отправляемых приложением.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-196">A queue can act as a buffer that helps to even out the rate at which requests sent by an application are delivered to a service.</span></span>
- <span data-ttu-id="fbbf4-197">[шаблон приоритета очередей][].</span><span class="sxs-lookup"><span data-stu-id="fbbf4-197">[Priority Queue pattern][].</span></span> <span data-ttu-id="fbbf4-198">Система может использовать очереди с приоритетом в рамках стратегии регулирования, чтобы поддерживать производительность критически важных или ценных приложений, снижая производительность менее важных приложений.</span><span class="sxs-lookup"><span data-stu-id="fbbf4-198">A system can use priority queuing as part of its throttling strategy to maintain performance for critical or higher value applications, while reducing the performance of less important applications.</span></span>

[шаблон приоритета очередей]: priority-queue.md
[Priority Queue pattern]: priority-queue.md