---
title: Шаблон уровня защиты от повреждения
titleSuffix: Cloud Design Patterns
description: Реализуйте интерфейс или уровень адаптера между современным приложением и устаревшей системой.
keywords: Конструктивный шаблон
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: bec9fb1a2bd2ad8eab68d6fbf07bfa197e57cbf5
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54483961"
---
# <a name="anti-corruption-layer-pattern"></a><span data-ttu-id="98380-104">Шаблон уровня защиты от повреждения</span><span class="sxs-lookup"><span data-stu-id="98380-104">Anti-Corruption Layer pattern</span></span>

<span data-ttu-id="98380-105">Между разными подсистемами с разной семантикой можно реализовать уровень оболочки или адаптера.</span><span class="sxs-lookup"><span data-stu-id="98380-105">Implement a façade or adapter layer between different subsystems that don't share the same semantics.</span></span> <span data-ttu-id="98380-106">Этот уровень будет преобразовывать запросы от одной подсистемы к другой.</span><span class="sxs-lookup"><span data-stu-id="98380-106">This layer translates requests that one subsystem makes to the other subsystem.</span></span> <span data-ttu-id="98380-107">Используйте этот шаблон, чтобы гарантировать, что схема приложения не ограничена зависимостями во внешних подсистемах.</span><span class="sxs-lookup"><span data-stu-id="98380-107">Use this pattern to ensure that an application's design is not limited by dependencies on outside subsystems.</span></span> <span data-ttu-id="98380-108">Впервые этот шаблон описал Эрик Эванс (Eric Evans) в книге *Предметно-ориентированное проектирование*.</span><span class="sxs-lookup"><span data-stu-id="98380-108">This pattern was first described by Eric Evans in *Domain-Driven Design*.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="98380-109">Контекст и проблема</span><span class="sxs-lookup"><span data-stu-id="98380-109">Context and problem</span></span>

<span data-ttu-id="98380-110">Большинство приложений используют другие системы для некоторых данных или функций.</span><span class="sxs-lookup"><span data-stu-id="98380-110">Most applications rely on other systems for some data or functionality.</span></span> <span data-ttu-id="98380-111">Например, при миграции приложения прежних версий в новую систему по-прежнему могут потребоваться устаревшие ресурсы.</span><span class="sxs-lookup"><span data-stu-id="98380-111">For example, when a legacy application is migrated to a modern system, it may still need existing legacy resources.</span></span> <span data-ttu-id="98380-112">Новые компоненты должны вызвать устаревшую систему.</span><span class="sxs-lookup"><span data-stu-id="98380-112">New features must be able to call the legacy system.</span></span> <span data-ttu-id="98380-113">В частности, это относится к постепенным миграциям, где различные компоненты более крупных приложений со временем перемещаются в современные системы.</span><span class="sxs-lookup"><span data-stu-id="98380-113">This is especially true of gradual migrations, where different features of a larger application are moved to a modern system over time.</span></span>

<span data-ttu-id="98380-114">В устаревших системах часто появляются проблемы с качеством, такие как сложные схемы данных или устаревшие API.</span><span class="sxs-lookup"><span data-stu-id="98380-114">Often these legacy systems suffer from quality issues such as convoluted data schemas or obsolete APIs.</span></span> <span data-ttu-id="98380-115">Компоненты и технологии, используемые в устаревших системах, могут существенно отличаться от новых систем.</span><span class="sxs-lookup"><span data-stu-id="98380-115">The features and technologies used in legacy systems can vary widely from more modern systems.</span></span> <span data-ttu-id="98380-116">Для взаимодействия с устаревшей системой новому приложению может потребоваться поддержка устаревшей инфраструктуры, протоколов, моделей данных, API-интерфейсов или других компонентов, которые в противном случае вы не поместили бы в новое приложение.</span><span class="sxs-lookup"><span data-stu-id="98380-116">To interoperate with the legacy system, the new application may need to support outdated infrastructure, protocols, data models, APIs, or other features that you wouldn't otherwise put into a modern application.</span></span>

<span data-ttu-id="98380-117">Для обеспечения доступа между новыми и устаревшими системами в новой системе может потребоваться принудительно использовать по крайней мере некоторые API-интерфейсы или другую семантику устаревших систем.</span><span class="sxs-lookup"><span data-stu-id="98380-117">Maintaining access between new and legacy systems can force the new system to adhere to at least some of the legacy system's APIs or other semantics.</span></span> <span data-ttu-id="98380-118">Если в устаревших компонентах возникают проблемы с качеством, их поддержка может быть нецелесообразна в хорошо спроектированном современном приложении.</span><span class="sxs-lookup"><span data-stu-id="98380-118">When these legacy features have quality issues, supporting them "corrupts" what might otherwise be a cleanly designed modern application.</span></span>

<span data-ttu-id="98380-119">Аналогичные проблемы могут возникнуть в любой внешней системе, которую не контролирует ваша команда разработчиков, а не только в устаревших системах.</span><span class="sxs-lookup"><span data-stu-id="98380-119">Similar issues can arise with any external system that your development team doesn't control, not just legacy systems.</span></span>

## <a name="solution"></a><span data-ttu-id="98380-120">Решение</span><span class="sxs-lookup"><span data-stu-id="98380-120">Solution</span></span>

<span data-ttu-id="98380-121">Изолируйте разные подсистемы, поместив между ними уровень защиты от повреждений.</span><span class="sxs-lookup"><span data-stu-id="98380-121">Isolate the different subsystems by placing an anti-corruption layer between them.</span></span> <span data-ttu-id="98380-122">Этот уровень преобразует обмен данными между двумя системами, за счет чего одна система не изменяется, а в другой сохраняется структура и технологический подход.</span><span class="sxs-lookup"><span data-stu-id="98380-122">This layer translates communications between the two systems, allowing one system to remain unchanged while the other can avoid compromising its design and technological approach.</span></span>

![Шаблон уровня защиты от повреждения](./_images/anti-corruption-layer.png)

<span data-ttu-id="98380-124">На приведенной выше схеме показано приложение с двумя подсистемами.</span><span class="sxs-lookup"><span data-stu-id="98380-124">The diagram above shows an application with two subsystems.</span></span> <span data-ttu-id="98380-125">Подсистема A вызывает подсистему B через уровень защиты от повреждений.</span><span class="sxs-lookup"><span data-stu-id="98380-125">Subsystem A calls to subsystem B through an anti-corruption layer.</span></span> <span data-ttu-id="98380-126">При обмене данными между подсистемой A и уровнем защиты от повреждений всегда используется модель данных и архитектура подсистемы A. Вызовы из уровня защиты от повреждений к подсистеме B соответствуют модели данных и методам этой подсистемы.</span><span class="sxs-lookup"><span data-stu-id="98380-126">Communication between subsystem A and the anti-corruption layer always uses the data model and architecture of subsystem A. Calls from the anti-corruption layer to subsystem B conform to that subsystem's data model or methods.</span></span> <span data-ttu-id="98380-127">Уровень защиты от повреждения содержит всю логику, необходимую для преобразования между двумя системами.</span><span class="sxs-lookup"><span data-stu-id="98380-127">The anti-corruption layer contains all of the logic necessary to translate between the two systems.</span></span> <span data-ttu-id="98380-128">Его можно реализовать как компонент в приложении или как независимую службу.</span><span class="sxs-lookup"><span data-stu-id="98380-128">The layer can be implemented as a component within the application or as an independent service.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="98380-129">Проблемы и рекомендации</span><span class="sxs-lookup"><span data-stu-id="98380-129">Issues and considerations</span></span>

- <span data-ttu-id="98380-130">Уровень защиты от повреждения может привести к задержкам в вызовах между системами.</span><span class="sxs-lookup"><span data-stu-id="98380-130">The anti-corruption layer may add latency to calls made between the two systems.</span></span>
- <span data-ttu-id="98380-131">Уровень защиты от повреждения добавляет дополнительную службу, требующую управления и поддержки.</span><span class="sxs-lookup"><span data-stu-id="98380-131">The anti-corruption layer adds an additional service that must be managed and maintained.</span></span>
- <span data-ttu-id="98380-132">Определите способ масштабирования уровня защиты от повреждения.</span><span class="sxs-lookup"><span data-stu-id="98380-132">Consider how your anti-corruption layer will scale.</span></span>
- <span data-ttu-id="98380-133">Определите количество уровней защиты от повреждения.</span><span class="sxs-lookup"><span data-stu-id="98380-133">Consider whether you need more than one anti-corruption layer.</span></span> <span data-ttu-id="98380-134">Вам может потребоваться разделить функциональные возможности на несколько служб, использующих различные технологии и языки. Или же у вас могут быть другие причины для разделения уровня защиты от повреждения.</span><span class="sxs-lookup"><span data-stu-id="98380-134">You may want to decompose functionality into multiple services using different technologies or languages, or there may be other reasons to partition the anti-corruption layer.</span></span>
- <span data-ttu-id="98380-135">Подумайте об управлении уровнем защиты от повреждения в контексте своих приложений и служб,</span><span class="sxs-lookup"><span data-stu-id="98380-135">Consider how the anti-corruption layer will be managed in relation with your other applications or services.</span></span> <span data-ttu-id="98380-136">а также о том, как он будет интегрироваться с процессами наблюдения, выпуска и конфигурации.</span><span class="sxs-lookup"><span data-stu-id="98380-136">How will it be integrated into your monitoring, release, and configuration processes?</span></span>
- <span data-ttu-id="98380-137">Убедитесь в том, что транзакции и целостность данных сохраняются и их можно отслеживать.</span><span class="sxs-lookup"><span data-stu-id="98380-137">Make sure transaction and data consistency are maintained and can be monitored.</span></span>
- <span data-ttu-id="98380-138">Определите объем задач для уровня защиты от повреждений: обработка всех данных, передаваемых между разными подсистемами, или только подмножества функций.</span><span class="sxs-lookup"><span data-stu-id="98380-138">Consider whether the anti-corruption layer needs to handle all communication between different subsystems, or just a subset of features.</span></span>
- <span data-ttu-id="98380-139">Если уровень защиты от повреждений входит в стратегию переноса приложений, определите, будет ли он постоянным или его использование будет прекращено после переноса всех устаревших функциональных возможностей.</span><span class="sxs-lookup"><span data-stu-id="98380-139">If the anti-corruption layer is part of an application migration strategy, consider whether it will be permanent, or will be retired after all legacy functionality has been migrated.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="98380-140">Когда следует использовать этот шаблон</span><span class="sxs-lookup"><span data-stu-id="98380-140">When to use this pattern</span></span>

<span data-ttu-id="98380-141">Используйте этот шаблон в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="98380-141">Use this pattern when:</span></span>

- <span data-ttu-id="98380-142">Планируется миграция в несколько этапов, но необходима поддержка интеграции между новыми и устаревшими системами.</span><span class="sxs-lookup"><span data-stu-id="98380-142">A migration is planned to happen over multiple stages, but integration between new and legacy systems needs to be maintained.</span></span>
- <span data-ttu-id="98380-143">Семантика разных подсистем различна, но по-прежнему требуется их взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="98380-143">Two or more subsystems have different semantics, but still need to communicate.</span></span>

<span data-ttu-id="98380-144">Этот шаблон неприменим в случае несущественных семантических различий между новыми и устаревшими системами.</span><span class="sxs-lookup"><span data-stu-id="98380-144">This pattern may not be suitable if there are no significant semantic differences between new and legacy systems.</span></span>

## <a name="related-guidance"></a><span data-ttu-id="98380-145">Связанные руководства</span><span class="sxs-lookup"><span data-stu-id="98380-145">Related guidance</span></span>

- [<span data-ttu-id="98380-146">Шаблон подавления</span><span class="sxs-lookup"><span data-stu-id="98380-146">Strangler pattern</span></span>](./strangler.md)
