---
title: Шаблон расширения
titleSuffix: Cloud Design Patterns
description: Чтобы обеспечить изоляцию и инкапсуляцию, развертывайте компоненты приложения в отдельном процессе или контейнере.
keywords: Конструктивный шаблон
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: 20a63cdd935f28cc47686238d34d654da2798985
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59639603"
---
# <a name="sidecar-pattern"></a><span data-ttu-id="174e8-104">Шаблон расширения</span><span class="sxs-lookup"><span data-stu-id="174e8-104">Sidecar pattern</span></span>

<span data-ttu-id="174e8-105">Чтобы обеспечить изоляцию и инкапсуляцию, развертывайте компоненты приложения в отдельном процессе или контейнере.</span><span class="sxs-lookup"><span data-stu-id="174e8-105">Deploy components of an application into a separate process or container to provide isolation and encapsulation.</span></span> <span data-ttu-id="174e8-106">Этот шаблон также может включать возможность создания приложений, состоящих из разнородных компонентов и технологий.</span><span class="sxs-lookup"><span data-stu-id="174e8-106">This pattern can also enable applications to be composed of heterogeneous components and technologies.</span></span>

<span data-ttu-id="174e8-107">Он называется *расширением*, так как напоминает коляску, присоединенную к мотоциклу.</span><span class="sxs-lookup"><span data-stu-id="174e8-107">This pattern is named *Sidecar* because it resembles a sidecar attached to a motorcycle.</span></span> <span data-ttu-id="174e8-108">В шаблоне расширение присоединяется к родительскому приложению и предоставляет для него вспомогательные функции.</span><span class="sxs-lookup"><span data-stu-id="174e8-108">In the pattern, the sidecar is attached to a parent application and provides supporting features for the application.</span></span> <span data-ttu-id="174e8-109">Жизненный цикл расширения и родительского приложения один и тот же, так как расширение создается и удаляется вместе с родительским приложением.</span><span class="sxs-lookup"><span data-stu-id="174e8-109">The sidecar also shares the same lifecycle as the parent application, being created and retired alongside the parent.</span></span> <span data-ttu-id="174e8-110">Иногда шаблон расширения называют шаблоном-компаньоном, который является шаблоном декомпозиции.</span><span class="sxs-lookup"><span data-stu-id="174e8-110">The sidecar pattern is sometimes referred to as the sidekick pattern and is a decomposition pattern.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="174e8-111">Контекст и проблема</span><span class="sxs-lookup"><span data-stu-id="174e8-111">Context and Problem</span></span>

<span data-ttu-id="174e8-112">Для приложений и служб часто нужны связанные функции, такие как мониторинг, ведение журналов, конфигурация и сетевые службы.</span><span class="sxs-lookup"><span data-stu-id="174e8-112">Applications and services often require related functionality, such as monitoring, logging, configuration, and networking services.</span></span> <span data-ttu-id="174e8-113">Эти периферийные задачи можно реализовать в качестве отдельных компонентов или служб.</span><span class="sxs-lookup"><span data-stu-id="174e8-113">These peripheral tasks can be implemented as separate components or services.</span></span>

<span data-ttu-id="174e8-114">Если они тесно интегрированы в приложении, то могут выполняться в одном процессе в качестве приложения, за счет чего обеспечивается эффективное использование общих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="174e8-114">If they are tightly integrated into the application, they can run in the same process as the application, making efficient use of shared resources.</span></span> <span data-ttu-id="174e8-115">Однако это также означает, что они неэффективно изолированы и сбой в одном из этих компонентов может повлиять на остальные или же на все приложения.</span><span class="sxs-lookup"><span data-stu-id="174e8-115">However, this also means they are not well isolated, and an outage in one of these components can affect other components or the entire application.</span></span> <span data-ttu-id="174e8-116">Кроме того, они обычно должны быть реализованы на том же языке, что и родительское приложение.</span><span class="sxs-lookup"><span data-stu-id="174e8-116">Also, they usually need to be implemented using the same language as the parent application.</span></span> <span data-ttu-id="174e8-117">В результате компонент и приложение тесно связаны друг с другом.</span><span class="sxs-lookup"><span data-stu-id="174e8-117">As a result, the component and the application have close interdependence on each other.</span></span>

<span data-ttu-id="174e8-118">Если приложение делится на службы, каждую из них можно создать с использованием разных языков и технологий.</span><span class="sxs-lookup"><span data-stu-id="174e8-118">If the application is decomposed into services, then each service can be built using different languages and technologies.</span></span> <span data-ttu-id="174e8-119">При этом обеспечивается дополнительная гибкость, но у каждого компонента есть собственные зависимости, а также ему необходимы языковые библиотеки для доступа к базовой платформе и ресурсам родительского приложения.</span><span class="sxs-lookup"><span data-stu-id="174e8-119">While this gives more flexibility, it means that each component has its own dependencies and requires language-specific libraries to access the underlying platform and any resources shared with the parent application.</span></span> <span data-ttu-id="174e8-120">Кроме того, развертывание этих функций в качестве отдельных служб может привести к задержкам в приложении.</span><span class="sxs-lookup"><span data-stu-id="174e8-120">In addition, deploying these features as separate services can add latency to the application.</span></span> <span data-ttu-id="174e8-121">При управлении кодом и зависимостями для этих языковых интерфейсов операции могут усложниться, особенно размещение, развертывание и управление.</span><span class="sxs-lookup"><span data-stu-id="174e8-121">Managing the code and dependencies for these language-specific interfaces can also add considerable complexity, especially for hosting, deployment, and management.</span></span>

## <a name="solution"></a><span data-ttu-id="174e8-122">Решение</span><span class="sxs-lookup"><span data-stu-id="174e8-122">Solution</span></span>

<span data-ttu-id="174e8-123">Разместите набор задач вместе с основным приложением внутри их собственного процесса или контейнера, предоставляя однородный интерфейс для служб на платформе для разных языков.</span><span class="sxs-lookup"><span data-stu-id="174e8-123">Co-locate a cohesive set of tasks with the primary application, but place them inside their own process or container, providing a homogeneous interface for platform services across languages.</span></span>

![Шаблон расширения](./_images/sidecar.png)

<span data-ttu-id="174e8-125">Служба-расширение необязательно входит в приложение, хотя и подключена к нему.</span><span class="sxs-lookup"><span data-stu-id="174e8-125">A sidecar service is not necessarily part of the application, but is connected to it.</span></span> <span data-ttu-id="174e8-126">Она всегда работает с родительским приложением.</span><span class="sxs-lookup"><span data-stu-id="174e8-126">It goes wherever the parent application goes.</span></span> <span data-ttu-id="174e8-127">Службы-расширения поддерживают процессы или службы, развернутые с помощью основного приложения.</span><span class="sxs-lookup"><span data-stu-id="174e8-127">Sidecars are supporting processes or services that are deployed with the primary application.</span></span> <span data-ttu-id="174e8-128">К мотоциклу можно присоединить лишь одну коляску, и у каждого мотоцикла отдельная коляска.</span><span class="sxs-lookup"><span data-stu-id="174e8-128">On a motorcycle, the sidecar is attached to one motorcycle, and each motorcycle can have its own sidecar.</span></span> <span data-ttu-id="174e8-129">Таким же образом служба-расширение работает с родительским приложением.</span><span class="sxs-lookup"><span data-stu-id="174e8-129">In the same way, a sidecar service shares the fate of its parent application.</span></span> <span data-ttu-id="174e8-130">Для каждого экземпляра приложения размещен и развернут экземпляр расширения.</span><span class="sxs-lookup"><span data-stu-id="174e8-130">For each instance of the application, an instance of the sidecar is deployed and hosted alongside it.</span></span>

<span data-ttu-id="174e8-131">Преимущества шаблона расширения:</span><span class="sxs-lookup"><span data-stu-id="174e8-131">Advantages of using a sidecar pattern include:</span></span>

- <span data-ttu-id="174e8-132">Расширение не зависит от среды выполнения и языка программирования основного приложения, поэтому не нужно разрабатывать такой шаблон для каждого языка.</span><span class="sxs-lookup"><span data-stu-id="174e8-132">A sidecar is independent from its primary application in terms of runtime environment and programming language, so you don't need to develop one sidecar per language.</span></span>

- <span data-ttu-id="174e8-133">Расширение может получить доступ к тем же ресурсам, что и основное приложение.</span><span class="sxs-lookup"><span data-stu-id="174e8-133">The sidecar can access the same resources as the primary application.</span></span> <span data-ttu-id="174e8-134">Например, оно может наблюдать за системными ресурсами, используемыми основным приложением и им самим.</span><span class="sxs-lookup"><span data-stu-id="174e8-134">For example, a sidecar can monitor system resources used by both the sidecar and the primary application.</span></span>

- <span data-ttu-id="174e8-135">При обмене данными между расширением и основным приложением задержки не возникают, так как они тесно связаны.</span><span class="sxs-lookup"><span data-stu-id="174e8-135">Because of its proximity to the primary application, there’s no significant latency when communicating between them.</span></span>

- <span data-ttu-id="174e8-136">Даже для приложений, которые не предоставляют механизм расширения можно использовать расширение для расширения функциональных возможностей, подключив его как собственный процесс, в том же узле или вложенном контейнере в качестве основного приложения.</span><span class="sxs-lookup"><span data-stu-id="174e8-136">Even for applications that don’t provide an extensibility mechanism, you can use a sidecar to extend functionality by attaching it as its own process in the same host or sub-container as the primary application.</span></span>

<span data-ttu-id="174e8-137">Шаблон расширения часто используется с контейнерами и называется контейнером-расширением или контейнером-компаньоном.</span><span class="sxs-lookup"><span data-stu-id="174e8-137">The sidecar pattern is often used with containers and referred to as a sidecar container or sidekick container.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="174e8-138">Проблемы и рекомендации</span><span class="sxs-lookup"><span data-stu-id="174e8-138">Issues and Considerations</span></span>

- <span data-ttu-id="174e8-139">Определите формат развертывания и упаковки, который будет использоваться для развертывания служб, процессов или контейнеров.</span><span class="sxs-lookup"><span data-stu-id="174e8-139">Consider the deployment and packaging format you will use to deploy services, processes, or containers.</span></span> <span data-ttu-id="174e8-140">Контейнеры особенно хорошо подходят для шаблона расширения.</span><span class="sxs-lookup"><span data-stu-id="174e8-140">Containers are particularly well suited to the sidecar pattern.</span></span>
- <span data-ttu-id="174e8-141">При разработке службы-расширения проявите тщательность при выборе механизма межпроцессного взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="174e8-141">When designing a sidecar service, carefully decide on the interprocess communication mechanism.</span></span> <span data-ttu-id="174e8-142">Если это целесообразно в соответствии с требованиями по производительности, попробуйте использовать технологии, независимые от языка или платформы.</span><span class="sxs-lookup"><span data-stu-id="174e8-142">Try to use language- or framework-agnostic technologies unless performance requirements make that impractical.</span></span>
- <span data-ttu-id="174e8-143">Перед переводом функциональной возможности в расширение определите оптимальный способ ее работы — в качестве отдельной службы или стандартной управляющей программы.</span><span class="sxs-lookup"><span data-stu-id="174e8-143">Before putting functionality into a sidecar, consider whether it would work better as a separate service or a more traditional daemon.</span></span>
- <span data-ttu-id="174e8-144">Кроме того, определите, можно ли внедрить функциональную возможность в виде библиотеки или же с помощью стандартного механизма расширения.</span><span class="sxs-lookup"><span data-stu-id="174e8-144">Also consider whether the functionality could be implemented as a library or using a traditional extension mechanism.</span></span> <span data-ttu-id="174e8-145">Языковые библиотеки могут иметь более тесный уровень интеграции и меньше нагрузки на сеть.</span><span class="sxs-lookup"><span data-stu-id="174e8-145">Language-specific libraries may have a deeper level of integration and less network overhead.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="174e8-146">Когда следует использовать этот шаблон</span><span class="sxs-lookup"><span data-stu-id="174e8-146">When to Use this Pattern</span></span>

<span data-ttu-id="174e8-147">Используйте этот шаблон в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="174e8-147">Use this pattern when:</span></span>

- <span data-ttu-id="174e8-148">В основном приложении используется разнородный набор языков и платформ.</span><span class="sxs-lookup"><span data-stu-id="174e8-148">Your primary application uses a heterogeneous set of languages and frameworks.</span></span> <span data-ttu-id="174e8-149">Компонент, расположенный в службе-расширении, может использоваться приложениями, написанными на разных языках и с использованием различных платформ.</span><span class="sxs-lookup"><span data-stu-id="174e8-149">A component located in a sidecar service can be consumed by applications written in different languages using different frameworks.</span></span>
- <span data-ttu-id="174e8-150">Компонент принадлежит удаленной команде или другой организации.</span><span class="sxs-lookup"><span data-stu-id="174e8-150">A component is owned by a remote team or a different organization.</span></span>
- <span data-ttu-id="174e8-151">Компонент или функция размещается на том же узле, что и приложение.</span><span class="sxs-lookup"><span data-stu-id="174e8-151">A component or feature must be co-located on the same host as the application</span></span>
- <span data-ttu-id="174e8-152">Вам нужна служба, имеющая тот же жизненный цикл, что и основное приложение, но при этом она должна обновляться независимо от приложения.</span><span class="sxs-lookup"><span data-stu-id="174e8-152">You need a service that shares the overall lifecycle of your main application, but can be independently updated.</span></span>
- <span data-ttu-id="174e8-153">Вам нужен точный контроль над ограничениями ресурсов для конкретного ресурса или компонента.</span><span class="sxs-lookup"><span data-stu-id="174e8-153">You need fine-grained control over resource limits for a particular resource or component.</span></span> <span data-ttu-id="174e8-154">Например, вам может понадобиться ограничить объем памяти, который используют отдельные компоненты.</span><span class="sxs-lookup"><span data-stu-id="174e8-154">For example, you may want to restrict the amount of memory a specific component uses.</span></span> <span data-ttu-id="174e8-155">Компонент можно развернуть в качестве расширения и управлять использованием памяти независимо от основного приложения.</span><span class="sxs-lookup"><span data-stu-id="174e8-155">You can deploy the component as a sidecar and manage memory usage independently of the main application.</span></span>

<span data-ttu-id="174e8-156">Этот шаблон будет неприменим в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="174e8-156">This pattern may not be suitable:</span></span>

- <span data-ttu-id="174e8-157">Если необходимо оптимизировать межпроцессное взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="174e8-157">When interprocess communication needs to be optimized.</span></span> <span data-ttu-id="174e8-158">Обмен данными между родительским приложением и службами-расширениями вызывает дополнительные нагрузки, в частности задержки в вызовах.</span><span class="sxs-lookup"><span data-stu-id="174e8-158">Communication between a parent application and sidecar services includes some overhead, notably latency in the calls.</span></span> <span data-ttu-id="174e8-159">Это неприемлемый компромисс для активных интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="174e8-159">This may not be an acceptable trade-off for chatty interfaces.</span></span>
- <span data-ttu-id="174e8-160">Для небольших приложений, где стоимость ресурса при развертывания службы-расширения для каждого экземпляра выше, чем преимущество изоляции.</span><span class="sxs-lookup"><span data-stu-id="174e8-160">For small applications where the resource cost of deploying a sidecar service for each instance is not worth the advantage of isolation.</span></span>
- <span data-ttu-id="174e8-161">Если службу нужно масштабировать по-другому или независимо от основного приложения,</span><span class="sxs-lookup"><span data-stu-id="174e8-161">When the service needs to scale differently than or independently from the main applications.</span></span> <span data-ttu-id="174e8-162">лучше развернуть компонент как отдельную службу.</span><span class="sxs-lookup"><span data-stu-id="174e8-162">If so, it may be better to deploy the feature as a separate service.</span></span>

## <a name="example"></a><span data-ttu-id="174e8-163">Пример</span><span class="sxs-lookup"><span data-stu-id="174e8-163">Example</span></span>

<span data-ttu-id="174e8-164">Шаблон расширения применяется во многих сценариях.</span><span class="sxs-lookup"><span data-stu-id="174e8-164">The sidecar pattern is applicable to many scenarios.</span></span> <span data-ttu-id="174e8-165">Несколько распространенных примеров:</span><span class="sxs-lookup"><span data-stu-id="174e8-165">Some common examples:</span></span>

- <span data-ttu-id="174e8-166">API инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="174e8-166">Infrastructure API.</span></span> <span data-ttu-id="174e8-167">Команда разработчиков инфраструктуры создает службу, развертываемую вместе с каждым приложением, а не языковую клиентскую библиотеку для доступа к инфраструктуре.</span><span class="sxs-lookup"><span data-stu-id="174e8-167">The infrastructure development team creates a service that's deployed alongside each application, instead of a language-specific client library to access the infrastructure.</span></span> <span data-ttu-id="174e8-168">Служба загружается как расширение и предоставляет общий уровень для служб инфраструктуры, включая ведение журнала, данные среды, хранилище конфигураций, обнаружение, проверку работоспособности и контрольные службы.</span><span class="sxs-lookup"><span data-stu-id="174e8-168">The service is loaded as a sidecar and provides a common layer for infrastructure services, including logging, environment data, configuration store, discovery, health checks, and watchdog services.</span></span> <span data-ttu-id="174e8-169">Расширение также отслеживает среду размещения и процесс родительского приложения (или контейнера) и записывает сведения в централизованную службу.</span><span class="sxs-lookup"><span data-stu-id="174e8-169">The sidecar also monitors the parent application's host environment and process (or container) and logs the information to a centralized service.</span></span>
- <span data-ttu-id="174e8-170">Управление NGINX и HAProxy.</span><span class="sxs-lookup"><span data-stu-id="174e8-170">Manage NGINX/HAProxy.</span></span> <span data-ttu-id="174e8-171">Разверните NGINX с помощью службы-расширения, которая отслеживает состояние среды, а затем обновляет файл конфигурации NGINX и перезапускает процесс, если требуются изменения в состоянии.</span><span class="sxs-lookup"><span data-stu-id="174e8-171">Deploy NGINX with a sidecar service that monitors environment state, then updates the NGINX configuration file and recycles the process when a change in state is needed.</span></span>
- <span data-ttu-id="174e8-172">Расширение-посредник.</span><span class="sxs-lookup"><span data-stu-id="174e8-172">Ambassador sidecar.</span></span> <span data-ttu-id="174e8-173">Разверните [службу-посредник](./ambassador.md) в качестве расширения.</span><span class="sxs-lookup"><span data-stu-id="174e8-173">Deploy an [ambassador](./ambassador.md) service as a sidecar.</span></span> <span data-ttu-id="174e8-174">Приложение вызывает посредник, который обрабатывает журнал запросов, маршрутизацию, автоматическое выключение и другие функции, связанные с подключением.</span><span class="sxs-lookup"><span data-stu-id="174e8-174">The application calls through the ambassador, which handles request logging, routing, circuit breaking, and other connectivity related features.</span></span>
- <span data-ttu-id="174e8-175">Разгрузка прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="174e8-175">Offload proxy.</span></span> <span data-ttu-id="174e8-176">Разместите прокси-сервер NGINX перед экземпляром службы node.js для обработки содержимого статических файлов для службы.</span><span class="sxs-lookup"><span data-stu-id="174e8-176">Place an NGINX proxy in front of a node.js service instance, to handle serving static file content for the service.</span></span>

## <a name="related-guidance"></a><span data-ttu-id="174e8-177">Связанные руководства</span><span class="sxs-lookup"><span data-stu-id="174e8-177">Related guidance</span></span>

- [<span data-ttu-id="174e8-178">Шаблон посредника</span><span class="sxs-lookup"><span data-stu-id="174e8-178">Ambassador pattern</span></span>](./ambassador.md)
