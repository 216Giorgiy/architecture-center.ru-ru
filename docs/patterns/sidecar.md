---
title: Шаблон расширения
description: Чтобы обеспечить изоляцию и инкапсуляцию, развертывайте компоненты приложения в отдельном процессе или контейнере.
author: dragon119
ms.date: 06/23/2017
ms.openlocfilehash: ec168009aa99f412c3f1222a1c404ea4ea5cb669
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
# <a name="sidecar-pattern"></a><span data-ttu-id="88808-103">Шаблон расширения</span><span class="sxs-lookup"><span data-stu-id="88808-103">Sidecar pattern</span></span>

<span data-ttu-id="88808-104">Чтобы обеспечить изоляцию и инкапсуляцию, развертывайте компоненты приложения в отдельном процессе или контейнере.</span><span class="sxs-lookup"><span data-stu-id="88808-104">Deploy components of an application into a separate process or container to provide isolation and encapsulation.</span></span> <span data-ttu-id="88808-105">Этот шаблон также может включать возможность создания приложений, состоящих из разнородных компонентов и технологий.</span><span class="sxs-lookup"><span data-stu-id="88808-105">This pattern can also enable applications to be composed of heterogeneous components and technologies.</span></span>

<span data-ttu-id="88808-106">Он называется *расширением*, так как напоминает коляску, присоединенную к мотоциклу.</span><span class="sxs-lookup"><span data-stu-id="88808-106">This pattern is named *Sidecar* because it resembles a sidecar attached to a motorcycle.</span></span> <span data-ttu-id="88808-107">В шаблоне расширение присоединяется к родительскому приложению и предоставляет для него вспомогательные функции.</span><span class="sxs-lookup"><span data-stu-id="88808-107">In the pattern, the sidecar is attached to a parent application and provides supporting features for the application.</span></span> <span data-ttu-id="88808-108">Жизненный цикл расширения и родительского приложения один и тот же, так как расширение создается и удаляется вместе с родительским приложением.</span><span class="sxs-lookup"><span data-stu-id="88808-108">The sidecar also shares the same lifecycle as the parent application, being created and retired alongside the parent.</span></span> <span data-ttu-id="88808-109">Иногда шаблон расширения называют шаблоном-компаньоном, который является шаблоном декомпозиции.</span><span class="sxs-lookup"><span data-stu-id="88808-109">The sidecar pattern is sometimes referred to as the sidekick pattern and is a decomposition pattern.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="88808-110">Контекст и проблема</span><span class="sxs-lookup"><span data-stu-id="88808-110">Context and Problem</span></span>

<span data-ttu-id="88808-111">Для приложений и служб часто нужны связанные функции, такие как мониторинг, ведение журналов, конфигурация и сетевые службы.</span><span class="sxs-lookup"><span data-stu-id="88808-111">Applications and services often require related functionality, such as monitoring, logging, configuration, and networking services.</span></span> <span data-ttu-id="88808-112">Эти периферийные задачи можно реализовать в качестве отдельных компонентов или служб.</span><span class="sxs-lookup"><span data-stu-id="88808-112">These peripheral tasks can be implemented as separate components or services.</span></span> 

<span data-ttu-id="88808-113">Если они тесно интегрированы в приложении, то могут выполняться в одном процессе в качестве приложения, за счет чего обеспечивается эффективное использование общих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="88808-113">If they are tightly integrated into the application, they can run in the same process as the application, making efficient use of shared resources.</span></span> <span data-ttu-id="88808-114">Однако это также означает, что они неэффективно изолированы и сбой в одном из этих компонентов может повлиять на остальные или же на все приложения.</span><span class="sxs-lookup"><span data-stu-id="88808-114">However, this also means they are not well isolated, and an outage in one of these components can affect other components or the entire application.</span></span> <span data-ttu-id="88808-115">Кроме того, они обычно должны быть реализованы на том же языке, что и родительское приложение.</span><span class="sxs-lookup"><span data-stu-id="88808-115">Also, they usually need to be implemented using the same language as the parent application.</span></span> <span data-ttu-id="88808-116">В результате компонент и приложение тесно связаны друг с другом.</span><span class="sxs-lookup"><span data-stu-id="88808-116">As a result, the component and the application have close interdependence on each other.</span></span>

<span data-ttu-id="88808-117">Если приложение делится на службы, каждую из них можно создать с использованием разных языков и технологий.</span><span class="sxs-lookup"><span data-stu-id="88808-117">If the application is decomposed into services, then each service can be built using different languages and technologies.</span></span> <span data-ttu-id="88808-118">При этом обеспечивается дополнительная гибкость, но у каждого компонента есть собственные зависимости, а также ему необходимы языковые библиотеки для доступа к базовой платформе и ресурсам родительского приложения.</span><span class="sxs-lookup"><span data-stu-id="88808-118">While this gives more flexibility, it means that each component has its own dependencies and requires language-specific libraries to access the underlying platform and any resources shared with the parent application.</span></span> <span data-ttu-id="88808-119">Кроме того, развертывание этих функций в качестве отдельных служб может привести к задержкам в приложении.</span><span class="sxs-lookup"><span data-stu-id="88808-119">In addition, deploying these features as separate services can add latency to the application.</span></span> <span data-ttu-id="88808-120">При управлении кодом и зависимостями для этих языковых интерфейсов операции могут усложниться, особенно размещение, развертывание и управление.</span><span class="sxs-lookup"><span data-stu-id="88808-120">Managing the code and dependencies for these language-specific interfaces can also add considerable complexity, especially for hosting, deployment, and management.</span></span>

## <a name="solution"></a><span data-ttu-id="88808-121">Решение</span><span class="sxs-lookup"><span data-stu-id="88808-121">Solution</span></span>

<span data-ttu-id="88808-122">Разместите набор задач вместе с основным приложением внутри их собственного процесса или контейнера, предоставляя однородный интерфейс для служб на платформе для разных языков.</span><span class="sxs-lookup"><span data-stu-id="88808-122">Co-locate a cohesive set of tasks with the primary application, but place them inside their own process or container, providing a homogeneous interface for platform services across languages.</span></span> 

![](./_images/sidecar.png)

<span data-ttu-id="88808-123">Служба-расширение необязательно входит в приложение, хотя и подключена к нему.</span><span class="sxs-lookup"><span data-stu-id="88808-123">A sidecar service is not necessarily part of the application, but is connected to it.</span></span> <span data-ttu-id="88808-124">Она всегда работает с родительским приложением.</span><span class="sxs-lookup"><span data-stu-id="88808-124">It goes wherever the parent application goes.</span></span> <span data-ttu-id="88808-125">Службы-расширения поддерживают процессы или службы, развернутые с помощью основного приложения.</span><span class="sxs-lookup"><span data-stu-id="88808-125">Sidecars are supporting processes or services that are deployed with the primary application.</span></span> <span data-ttu-id="88808-126">К мотоциклу можно присоединить лишь одну коляску, и у каждого мотоцикла отдельная коляска.</span><span class="sxs-lookup"><span data-stu-id="88808-126">On a motorcycle, the sidecar is attached to one motorcycle, and each motorcycle can have its own sidecar.</span></span> <span data-ttu-id="88808-127">Таким же образом служба-расширение работает с родительским приложением.</span><span class="sxs-lookup"><span data-stu-id="88808-127">In the same way, a sidecar service shares the fate of its parent application.</span></span> <span data-ttu-id="88808-128">Для каждого экземпляра приложения размещен и развернут экземпляр расширения.</span><span class="sxs-lookup"><span data-stu-id="88808-128">For each instance of the application, an instance of the sidecar is deployed and hosted alongside it.</span></span> 

<span data-ttu-id="88808-129">Преимущества шаблона расширения:</span><span class="sxs-lookup"><span data-stu-id="88808-129">Advantages of using a sidecar pattern include:</span></span>

- <span data-ttu-id="88808-130">Расширение не зависит от среды выполнения и языка программирования основного приложения, поэтому не нужно разрабатывать такой шаблон для каждого языка.</span><span class="sxs-lookup"><span data-stu-id="88808-130">A sidecar is independent from its primary application in terms of runtime environment and programming language, so you don't need to develop one sidecar per language.</span></span> 

- <span data-ttu-id="88808-131">Расширение может получить доступ к тем же ресурсам, что и основное приложение.</span><span class="sxs-lookup"><span data-stu-id="88808-131">The sidecar can access the same resources as the primary application.</span></span> <span data-ttu-id="88808-132">Например, оно может наблюдать за системными ресурсами, используемыми основным приложением и им самим.</span><span class="sxs-lookup"><span data-stu-id="88808-132">For example, a sidecar can monitor system resources used by both the sidecar and the primary application.</span></span> 

- <span data-ttu-id="88808-133">При обмене данными между расширением и основным приложением задержки не возникают, так как они тесно связаны.</span><span class="sxs-lookup"><span data-stu-id="88808-133">Because of its proximity to the primary application, there’s no significant latency when communicating between them.</span></span>

- <span data-ttu-id="88808-134">Шаблон для расширения функциональных возможностей можно использовать даже для приложений, которые не предоставляют механизм расширения. Для этого подключите его как собственный процесс на том же узле или во вложенном контейнере в качестве основного приложения.</span><span class="sxs-lookup"><span data-stu-id="88808-134">Even for applications that don’t provide an extensibility mechanism, you can use a sidecar to extend functionality by attaching it as own process in the same host or sub-container as the primary application.</span></span>

<span data-ttu-id="88808-135">Шаблон расширения часто используется с контейнерами и называется контейнером-расширением или контейнером-компаньоном.</span><span class="sxs-lookup"><span data-stu-id="88808-135">The sidecar pattern is often used with containers and referred to as a sidecar container or sidekick container.</span></span> 

## <a name="issues-and-considerations"></a><span data-ttu-id="88808-136">Проблемы и рекомендации</span><span class="sxs-lookup"><span data-stu-id="88808-136">Issues and Considerations</span></span>

- <span data-ttu-id="88808-137">Определите формат развертывания и упаковки, который будет использоваться для развертывания служб, процессов или контейнеров.</span><span class="sxs-lookup"><span data-stu-id="88808-137">Consider the deployment and packaging format you will use to deploy services, processes, or containers.</span></span> <span data-ttu-id="88808-138">Контейнеры особенно хорошо подходят для шаблона расширения.</span><span class="sxs-lookup"><span data-stu-id="88808-138">Containers are particularly well suited to the sidecar pattern.</span></span>
- <span data-ttu-id="88808-139">При разработке службы-расширения проявите тщательность при выборе механизма межпроцессного взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="88808-139">When designing a sidecar service, carefully decide on the interprocess communication mechanism.</span></span> <span data-ttu-id="88808-140">Если это целесообразно в соответствии с требованиями по производительности, попробуйте использовать технологии, независимые от языка или платформы.</span><span class="sxs-lookup"><span data-stu-id="88808-140">Try to use language- or framework-agnostic technologies unless performance requirements make that impractical.</span></span>
- <span data-ttu-id="88808-141">Перед переводом функциональной возможности в расширение определите оптимальный способ ее работы — в качестве отдельной службы или стандартной управляющей программы.</span><span class="sxs-lookup"><span data-stu-id="88808-141">Before putting functionality into a sidecar, consider whether it would work better as a separate service or a more traditional daemon.</span></span>
- <span data-ttu-id="88808-142">Кроме того, определите, можно ли внедрить функциональную возможность в виде библиотеки или же с помощью стандартного механизма расширения.</span><span class="sxs-lookup"><span data-stu-id="88808-142">Also consider whether the functionality could be implemented as a library or using a traditional extension mechanism.</span></span> <span data-ttu-id="88808-143">Языковые библиотеки могут иметь более тесный уровень интеграции и меньше нагрузки на сеть.</span><span class="sxs-lookup"><span data-stu-id="88808-143">Language-specific libraries may have a deeper level of integration and less network overhead.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="88808-144">Когда следует использовать этот шаблон</span><span class="sxs-lookup"><span data-stu-id="88808-144">When to Use this Pattern</span></span>

<span data-ttu-id="88808-145">Используйте этот шаблон в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="88808-145">Use this pattern when:</span></span>

- <span data-ttu-id="88808-146">В основном приложении используется разнородный набор языков и платформ.</span><span class="sxs-lookup"><span data-stu-id="88808-146">Your primary application uses a heterogenous set of languages and frameworks.</span></span> <span data-ttu-id="88808-147">Компонент, расположенный в службе-расширении, может использоваться приложениями, написанными на разных языках и с использованием различных платформ.</span><span class="sxs-lookup"><span data-stu-id="88808-147">A component located in a sidecar service can be consumed by applications written in different languages using different frameworks.</span></span>
- <span data-ttu-id="88808-148">Компонент принадлежит удаленной команде или другой организации.</span><span class="sxs-lookup"><span data-stu-id="88808-148">A component is owned by a remote team or a different organization.</span></span>
- <span data-ttu-id="88808-149">Компонент или функция размещается на том же узле, что и приложение.</span><span class="sxs-lookup"><span data-stu-id="88808-149">A component or feature must be co-located on the same host as the application</span></span>
- <span data-ttu-id="88808-150">Вам нужна служба, имеющая тот же жизненный цикл, что и основное приложение, но при этом она должна обновляться независимо от приложения.</span><span class="sxs-lookup"><span data-stu-id="88808-150">You need a service that shares the overall lifecycle of your main application, but can be independently updated.</span></span>
- <span data-ttu-id="88808-151">Вам нужен точный контроль над ограничениями ресурсов для конкретного ресурса или компонента.</span><span class="sxs-lookup"><span data-stu-id="88808-151">You need fine-grained control over resource limits for a particular resource or component.</span></span> <span data-ttu-id="88808-152">Например, вам может понадобиться ограничить объем памяти, который используют отдельные компоненты.</span><span class="sxs-lookup"><span data-stu-id="88808-152">For example, you may want to restrict the amount of memory a specific component uses.</span></span> <span data-ttu-id="88808-153">Компонент можно развернуть в качестве расширения и управлять использованием памяти независимо от основного приложения.</span><span class="sxs-lookup"><span data-stu-id="88808-153">You can deploy the component as a sidecar and manage memory usage independently of the main application.</span></span>

<span data-ttu-id="88808-154">Этот шаблон будет неприменим в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="88808-154">This pattern may not be suitable:</span></span>

- <span data-ttu-id="88808-155">Если необходимо оптимизировать межпроцессное взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="88808-155">When interprocess communication needs to be optimized.</span></span> <span data-ttu-id="88808-156">Обмен данными между родительским приложением и службами-расширениями вызывает дополнительные нагрузки, в частности задержки в вызовах.</span><span class="sxs-lookup"><span data-stu-id="88808-156">Communication between a parent application and sidecar services includes some overhead, notably latency in the calls.</span></span> <span data-ttu-id="88808-157">Это неприемлемый компромисс для активных интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="88808-157">This may not be an acceptable trade-off for chatty interfaces.</span></span>
- <span data-ttu-id="88808-158">Для небольших приложений, где стоимость ресурса при развертывания службы-расширения для каждого экземпляра выше, чем преимущество изоляции.</span><span class="sxs-lookup"><span data-stu-id="88808-158">For small applications where the resource cost of deploying a sidecar service for each instance is not worth the advantage of isolation.</span></span>
- <span data-ttu-id="88808-159">Если службу нужно масштабировать по-другому или независимо от основного приложения,</span><span class="sxs-lookup"><span data-stu-id="88808-159">When the service needs to scale differently than or independently from the main applications.</span></span> <span data-ttu-id="88808-160">лучше развернуть компонент как отдельную службу.</span><span class="sxs-lookup"><span data-stu-id="88808-160">If so, it may be better to deploy the feature as a separate service.</span></span>

## <a name="example"></a><span data-ttu-id="88808-161">Пример</span><span class="sxs-lookup"><span data-stu-id="88808-161">Example</span></span>

<span data-ttu-id="88808-162">Шаблон расширения применяется во многих сценариях.</span><span class="sxs-lookup"><span data-stu-id="88808-162">The sidecar pattern is applicable to many scenarios.</span></span> <span data-ttu-id="88808-163">Несколько распространенных примеров:</span><span class="sxs-lookup"><span data-stu-id="88808-163">Some common examples:</span></span>

- <span data-ttu-id="88808-164">API инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="88808-164">Infrastructure API.</span></span> <span data-ttu-id="88808-165">Команда разработчиков инфраструктуры создает службу, развертываемую вместе с каждым приложением, а не языковую клиентскую библиотеку для доступа к инфраструктуре.</span><span class="sxs-lookup"><span data-stu-id="88808-165">The infrastructure development team creates a service that's deployed alongside each application, instead of a language-specific client library to access the infrastructure.</span></span> <span data-ttu-id="88808-166">Служба загружается как расширение и предоставляет общий уровень для служб инфраструктуры, включая ведение журнала, данные среды, хранилище конфигураций, обнаружение, проверку работоспособности и контрольные службы.</span><span class="sxs-lookup"><span data-stu-id="88808-166">The service is loaded as a sidecar and provides a common layer for infrastructure services, including logging, environment data, configuration store, discovery, health checks, and watchdog services.</span></span> <span data-ttu-id="88808-167">Расширение также отслеживает среду размещения и процесс родительского приложения (или контейнера) и записывает сведения в централизованную службу.</span><span class="sxs-lookup"><span data-stu-id="88808-167">The sidecar also monitors the parent application's host environment and process (or container) and logs the information to a centralized service.</span></span>
- <span data-ttu-id="88808-168">Управление NGINX и HAProxy.</span><span class="sxs-lookup"><span data-stu-id="88808-168">Manage NGINX/HAProxy.</span></span> <span data-ttu-id="88808-169">Разверните NGINX с помощью службы-расширения, которая отслеживает состояние среды, а затем обновляет файл конфигурации NGINX и перезапускает процесс, если требуются изменения в состоянии.</span><span class="sxs-lookup"><span data-stu-id="88808-169">Deploy NGINX with a sidecar service that monitors environment state, then updates the NGINX configuration file and recycles the process when a change in state is needed.</span></span>
- <span data-ttu-id="88808-170">Расширение-посредник.</span><span class="sxs-lookup"><span data-stu-id="88808-170">Ambassador sidecar.</span></span> <span data-ttu-id="88808-171">Разверните [службу-посредник][ambassador] в качестве расширения.</span><span class="sxs-lookup"><span data-stu-id="88808-171">Deploy an [ambassador][ambassador] service as a sidecar.</span></span> <span data-ttu-id="88808-172">Приложение вызывает посредник, который обрабатывает журнал запросов, маршрутизацию, автоматическое выключение и другие функции, связанные с подключением.</span><span class="sxs-lookup"><span data-stu-id="88808-172">The application calls through the ambassador, which handles request logging, routing, circuit breaking, and other connectivity related features.</span></span>
- <span data-ttu-id="88808-173">Разгрузка прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="88808-173">Offload proxy.</span></span> <span data-ttu-id="88808-174">Разместите прокси-сервер NGINX перед экземпляром службы node.js для обработки содержимого статических файлов для службы.</span><span class="sxs-lookup"><span data-stu-id="88808-174">Place an NGINX proxy in front of a node.js service instance, to handle serving static file content for the service.</span></span>


## <a name="related-guidance"></a><span data-ttu-id="88808-175">Связанное руководство</span><span class="sxs-lookup"><span data-stu-id="88808-175">Related guidance</span></span>

- <span data-ttu-id="88808-176">[Ambassador pattern][ambassador] (Шаблон-посредник)</span><span class="sxs-lookup"><span data-stu-id="88808-176">[Ambassador pattern][ambassador]</span></span>


[ambassador]: ./ambassador.md

