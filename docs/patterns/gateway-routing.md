---
title: Схема маршрутизации шлюза
description: Используйте одну конечную точку для маршрутизации запросов к нескольким службам.
author: dragon119
ms.date: 06/23/2017
ms.openlocfilehash: 53239b23cfd98fad1edc38ca37c2274d5a9d7a0f
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
# <a name="gateway-routing-pattern"></a>Схема маршрутизации шлюза

Используйте одну конечную точку для маршрутизации запросов к нескольким службам. Такой подход полезен, если нужно предоставить несколько служб через одну конечную точку, направляя разные запросы к разным службам.

## <a name="context-and-problem"></a>Контекст и проблема

Если клиенту нужно использовать несколько служб, настройка отдельной конечной точки для каждой службы и управление ими могут представлять определенные трудности. Например, приложение электронной торговли предоставляет сразу несколько служб, отвечающих за поиск, обзор, корзину покупок, оплату и историю заказов. В каждой службе реализован отдельный API-интерфейс, с которым должны взаимодействовать клиенты. При этом каждый клиент должен иметь информацию обо всех конечных точках для подключения к этим службам. Если изменяется любой API, приходится обновлять все клиенты. Если вы разделяете одну службу на две или несколько служб, приходится изменять код в самой службе и во всех клиентах.

## <a name="solution"></a>Решение

Установите шлюз перед набором приложений, служб и развертываний. Используйте маршрутизацию на уровне приложений (уровень 7) для передачи запросов в соответствующие экземпляры.

При такой схеме работы клиентское приложение имеет информацию только об одной конечной точке и взаимодействует только с ней. При слияниях и разделениях служб клиент не всегда требуется обновлять. Он может по-прежнему направлять запросы в шлюз, а изменения затронут только маршрутизацию.

Кроме того, шлюз обеспечивает абстракцию серверных служб для клиентов. Это позволяет использовать несложный формат запросов и вносить любые изменения в серверные службы за шлюзом. Запросы от клиента можно направлять для обработки в любую службу или несколько служб в зависимости от ситуации. При этом вы можете свободно добавлять, разделять или реорганизовывать службы, ничего не изменяя в клиенте.

![](./_images/gateway-routing.png)
 
Такая схема удобна и для управления развертыванием, так как дает свободу в применении обновлений для пользователей. Когда вы развертываете новую версию службы, она может работать параллельно с предыдущей. С помощью маршрутизации вы можете предоставлять клиентам разные версии службы, позволяя гибко применять разные стратегии обновления: добавочное, параллельное или полное развертывание выпусков. Если после развертывания новой версии службы возникнут проблемы, вы сможете быстро отменить любые изменения с помощью маршрутизации, и эти изменения никак не затронут клиенты.

## <a name="issues-and-considerations"></a>Проблемы и рекомендации

- Служба шлюза может стать единой точкой отказа. Важно правильно подойти к ее разработке, чтобы она соответствовала требованиям к доступности. При реализации оцените ее возможности в плане отказоустойчивости и надежности.
- Служба шлюза может стать узким местом системы. Убедитесь, что шлюз достаточно производителен для планируемой нагрузки и что его будет легко масштабировать в соответствии с ожидаемым темпом роста.
- Выполните нагрузочное тестирование шлюза, чтобы исключить возможность каскадных сбоев служб.
- Маршрутизация шлюза выполняется на 7-м уровне. Для этого можно использовать IP-адреса, порты, заголовки запросов и (или) URL-адреса.

## <a name="when-to-use-this-pattern"></a>Когда следует использовать этот шаблон

Используйте эту схему в следующих случаях:

- если клиенту нужно использовать несколько служб, доступ к которым возможен через шлюз;
- если вам нужно упростить клиентские приложения, чтобы они взаимодействовали только с одной конечной точкой;
- если вам нужно перенаправлять на виртуальные внутренние конечные точки запросы, поступающие на конечные точки, которые доступны из внешних сетей (например, чтобы предоставить доступ к портам виртуальной машины через IP-адреса виртуального кластера).

Такая схема не очень удобна, если вы используете простое приложение для доступа всего к одной или двум службам.

## <a name="example"></a>Пример

Ниже приведен простой пример файла конфигурации для сервера, на котором Nginx выполняет функции маршрутизатора и передает запросы к приложениям, размещенным в разных виртуальных каталогах на разных компьютерах серверной части.

```
server {
    listen 80;
    server_name domain.com;

    location /app1 {
        proxy_pass http://10.0.3.10:80;
    }

    location /app2 {
        proxy_pass http://10.0.3.20:80;
    }

    location /app3 {
        proxy_pass http://10.0.3.30:80;
    }
}
```

## <a name="related-guidance"></a>Связанные руководства

- [Схема отдельных серверных частей для каждого интерфейса](./backends-for-frontends.md)
- [Схема агрегирования на шлюзе](./gateway-aggregation.md)
- [Схема разгрузки шлюза](./gateway-offloading.md)



