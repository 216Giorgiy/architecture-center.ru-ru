---
title: Шаблон федеративной идентификации
titleSuffix: Cloud Design Patterns
description: Делегирование проверки подлинности внешнему поставщику удостоверений.
keywords: Конструктивный шаблон
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: f4e8d2dff1c653cf2b8ef0109f1cc3027e5428b9
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54483026"
---
# <a name="federated-identity-pattern"></a><span data-ttu-id="eb197-104">Шаблон федеративной идентификации</span><span class="sxs-lookup"><span data-stu-id="eb197-104">Federated Identity pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="eb197-105">Делегируйте аутентификацию внешнему поставщику удостоверений.</span><span class="sxs-lookup"><span data-stu-id="eb197-105">Delegate authentication to an external identity provider.</span></span> <span data-ttu-id="eb197-106">Это может упростить разработку, свести к минимуму требование для администрирования пользователей и улучшить работу с приложением.</span><span class="sxs-lookup"><span data-stu-id="eb197-106">This can simplify development, minimize the requirement for user administration, and improve the user experience of the application.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="eb197-107">Контекст и проблема</span><span class="sxs-lookup"><span data-stu-id="eb197-107">Context and problem</span></span>

<span data-ttu-id="eb197-108">Как правило, пользователи должны работать с несколькими приложениями, предоставленными и размещенными организациями, с которыми они сотрудничают.</span><span class="sxs-lookup"><span data-stu-id="eb197-108">Users typically need to work with multiple applications provided and hosted by different organizations they have a business relationship with.</span></span> <span data-ttu-id="eb197-109">Этим пользователям может потребоваться использовать конкретные учетные данные (и при этом разные) для каждого приложения.</span><span class="sxs-lookup"><span data-stu-id="eb197-109">These users might be required to use specific (and different) credentials for each one.</span></span> <span data-ttu-id="eb197-110">Это может:</span><span class="sxs-lookup"><span data-stu-id="eb197-110">This can:</span></span>

- <span data-ttu-id="eb197-111">**Привести к несвязной работе пользователей**.</span><span class="sxs-lookup"><span data-stu-id="eb197-111">**Cause a disjointed user experience**.</span></span> <span data-ttu-id="eb197-112">Пользователи часто забывают учетные данные для входа, так как их много.</span><span class="sxs-lookup"><span data-stu-id="eb197-112">Users often forget sign-in credentials when they have many different ones.</span></span>

- <span data-ttu-id="eb197-113">**Привести к появлению уязвимостей безопасности**.</span><span class="sxs-lookup"><span data-stu-id="eb197-113">**Expose security vulnerabilities**.</span></span> <span data-ttu-id="eb197-114">Когда пользователь уходит из компании, учетная запись должна быть немедленно удалена.</span><span class="sxs-lookup"><span data-stu-id="eb197-114">When a user leaves the company the account must immediately be deprovisioned.</span></span> <span data-ttu-id="eb197-115">В крупных организациях этот нюанс упускается.</span><span class="sxs-lookup"><span data-stu-id="eb197-115">It's easy to overlook this in large organizations.</span></span>

- <span data-ttu-id="eb197-116">**Усложнить управление пользователями**.</span><span class="sxs-lookup"><span data-stu-id="eb197-116">**Complicate user management**.</span></span> <span data-ttu-id="eb197-117">Администраторы должны управлять учетными данными для всех пользователей и выполнять дополнительные задачи, например запоминать пароль.</span><span class="sxs-lookup"><span data-stu-id="eb197-117">Administrators must manage credentials for all of the users, and perform additional tasks such as providing password reminders.</span></span>

<span data-ttu-id="eb197-118">Обычно пользователи предпочитают использовать одинаковые учетные данные для всех приложений.</span><span class="sxs-lookup"><span data-stu-id="eb197-118">Users typically prefer to use the same credentials for all these applications.</span></span>

## <a name="solution"></a><span data-ttu-id="eb197-119">Решение</span><span class="sxs-lookup"><span data-stu-id="eb197-119">Solution</span></span>

<span data-ttu-id="eb197-120">Реализуйте механизм аутентификации, который может использовать федеративное удостоверение.</span><span class="sxs-lookup"><span data-stu-id="eb197-120">Implement an authentication mechanism that can use federated identity.</span></span> <span data-ttu-id="eb197-121">Отделите аутентификацию пользователей от кода приложения и делегируйте аутентификацию доверенному поставщику удостоверений.</span><span class="sxs-lookup"><span data-stu-id="eb197-121">Separate user authentication from the application code, and delegate authentication to a trusted identity provider.</span></span> <span data-ttu-id="eb197-122">Это может упростить разработку и позволить пользователям проходить аутентификацию с использованием различных поставщиков удостоверений, а также свести к минимуму административные издержки.</span><span class="sxs-lookup"><span data-stu-id="eb197-122">This can simplify development and allow users to authenticate using a wider range of identity providers (IdP) while minimizing the administrative overhead.</span></span> <span data-ttu-id="eb197-123">Кроме того, это позволяет четко отделить аутентификацию от авторизации.</span><span class="sxs-lookup"><span data-stu-id="eb197-123">It also allows you to clearly decouple authentication from authorization.</span></span>

<span data-ttu-id="eb197-124">Доверенные поставщики удостоверений включают корпоративные каталоги, локальные службы федерации и другие службы токенов безопасности (STS), предоставляемые деловыми партнерами или социальными поставщиками удостоверений, которые могут аутентифицировать пользователей с такими учетными записями, как Microsoft, Google, Yahoo! или Facebook.</span><span class="sxs-lookup"><span data-stu-id="eb197-124">The trusted identity providers include corporate directories, on-premises federation services, other security token services (STS) provided by business partners, or social identity providers that can authenticate users who have, for example, a Microsoft, Google, Yahoo!, or Facebook account.</span></span>

<span data-ttu-id="eb197-125">На рисунке показан шаблон федеративного удостоверения. Клиентскому приложению нужен доступ к службе, которая запрашивает аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="eb197-125">The figure illustrates the Federated Identity pattern when a client application needs to access a service that requires authentication.</span></span> <span data-ttu-id="eb197-126">Ее выполняет поставщик удостоверений, который работает со службой токенов безопасности.</span><span class="sxs-lookup"><span data-stu-id="eb197-126">The authentication is performed by an IdP that works in concert with an STS.</span></span> <span data-ttu-id="eb197-127">Поставщик удостоверений издает маркеры безопасности, предоставляющие сведения об аутентифицированном пользователе.</span><span class="sxs-lookup"><span data-stu-id="eb197-127">The IdP issues security tokens that provide information about the authenticated user.</span></span> <span data-ttu-id="eb197-128">Эти сведения называются утверждениями и включают идентификатор пользователя, а также другие сведения, например членство в роли и детальные права доступа.</span><span class="sxs-lookup"><span data-stu-id="eb197-128">This information, referred to as claims, includes the user’s identity, and might also include other information such as role membership and more granular access rights.</span></span>

![Общие сведения о федеративной аутентификации](./_images/federated-identity-overview.png)

<span data-ttu-id="eb197-130">Эта модель часто называется управлением доступом на основе утверждений.</span><span class="sxs-lookup"><span data-stu-id="eb197-130">This model is often called claims-based access control.</span></span> <span data-ttu-id="eb197-131">Приложения и службы разрешают получать доступ к функциям и возможностям на основе утверждений, содержащихся в токене.</span><span class="sxs-lookup"><span data-stu-id="eb197-131">Applications and services authorize access to features and functionality based on the claims contained in the token.</span></span> <span data-ttu-id="eb197-132">Служба, которая требует аутентификации, должна доверять поставщику удостоверений.</span><span class="sxs-lookup"><span data-stu-id="eb197-132">The service that requires authentication must trust the IdP.</span></span> <span data-ttu-id="eb197-133">Клиентское приложение обращается к поставщику удостоверений, который выполняет аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="eb197-133">The client application contacts the IdP that performs the authentication.</span></span> <span data-ttu-id="eb197-134">Если аутентификация успешна, поставщик удостоверений возвращает токен, содержащий утверждения, идентифицирующие пользователя в службе маркеров безопасности (обратите внимание, что поставщик удостоверений и служба маркеров безопасности могут быть одной службой).</span><span class="sxs-lookup"><span data-stu-id="eb197-134">If the authentication is successful, the IdP returns a token containing the claims that identify the user to the STS (note that the IdP and STS can be the same service).</span></span> <span data-ttu-id="eb197-135">Перед возвращением клиенту служба маркеров безопасности может преобразовывать и дополнять утверждения в маркере на основе стандартных правил.</span><span class="sxs-lookup"><span data-stu-id="eb197-135">The STS can transform and augment the claims in the token based on predefined rules, before returning it to the client.</span></span> <span data-ttu-id="eb197-136">Затем клиентское приложение может передать этот маркер службе как доказательство своей подлинности.</span><span class="sxs-lookup"><span data-stu-id="eb197-136">The client application can then pass this token to the service as proof of its identity.</span></span>

> <span data-ttu-id="eb197-137">В цепочке доверия могут существовать дополнительные службы токенов безопасности.</span><span class="sxs-lookup"><span data-stu-id="eb197-137">There might be additional STSs in the chain of trust.</span></span> <span data-ttu-id="eb197-138">Например, в описанном далее сценарии отношения доверия существуют между локальной службой токенов безопасности и другой службой, которая отвечает за доступ поставщика удостоверений для аутентификации пользователя.</span><span class="sxs-lookup"><span data-stu-id="eb197-138">For example, in the scenario described later, an on-premises STS trusts another STS that is responsible for accessing an identity provider to authenticate the user.</span></span> <span data-ttu-id="eb197-139">Этот подход часто встречается в корпоративных сценариях при наличии локальной службы токенов безопасности и каталога.</span><span class="sxs-lookup"><span data-stu-id="eb197-139">This approach is common in enterprise scenarios where there's an on-premises STS and directory.</span></span>

<span data-ttu-id="eb197-140">Федеративная аутентификация обеспечивает решение на основе стандартов для доверия идентификаторам в различных доменах. Кроме того, она может поддерживать единый вход.</span><span class="sxs-lookup"><span data-stu-id="eb197-140">Federated authentication provides a standards-based solution to the issue of trusting identities across diverse domains, and can support single sign-on.</span></span> <span data-ttu-id="eb197-141">Этот подход все шире распространяется среди различных типов приложений, особенно размещенных в облаке, так как он поддерживает единый вход, не требующий прямого сетевого подключения для поставщиков удостоверений.</span><span class="sxs-lookup"><span data-stu-id="eb197-141">It's becoming more common across all types of applications, especially cloud-hosted applications, because it supports single sign-on without requiring a direct network connection to identity providers.</span></span> <span data-ttu-id="eb197-142">Пользователю не нужно вводить учетные данные для каждого приложения.</span><span class="sxs-lookup"><span data-stu-id="eb197-142">The user doesn't have to enter credentials for every application.</span></span> <span data-ttu-id="eb197-143">Это повышает уровень безопасности, так как предотвращает создание учетных данных, необходимых для доступа к различным приложениям. Кроме того, при этом подходе скрываются учетные данные пользователя для всех, за исключением исходного поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="eb197-143">This increases security because it prevents the creation of credentials required to access many different applications, and it also hides the user’s credentials from all but the original identity provider.</span></span> <span data-ttu-id="eb197-144">Приложения видят только содержащиеся в маркере сведения об удостоверении, прошедшем аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="eb197-144">Applications see just the authenticated identity information contained within the token.</span></span>

<span data-ttu-id="eb197-145">Федеративные удостоверения также имеют важное преимущество. Оно заключается в том, что именно поставщик удостоверений управляет удостоверениями и учетными данными.</span><span class="sxs-lookup"><span data-stu-id="eb197-145">Federated identity also has the major advantage that management of the identity and credentials is the responsibility of the identity provider.</span></span> <span data-ttu-id="eb197-146">Приложению или службе не нужно управлять ими.</span><span class="sxs-lookup"><span data-stu-id="eb197-146">The application or service doesn't need to provide identity management features.</span></span> <span data-ttu-id="eb197-147">Кроме того, в корпоративных сценариях каталог организации не должен знать о пользователе, если он доверяет поставщику удостоверений.</span><span class="sxs-lookup"><span data-stu-id="eb197-147">In addition, in corporate scenarios, the corporate directory doesn't need to know about the user if it trusts the identity provider.</span></span> <span data-ttu-id="eb197-148">При этом сокращаются все административные расходы на управление удостоверениями пользователей в каталоге.</span><span class="sxs-lookup"><span data-stu-id="eb197-148">This removes all the administrative overhead of managing the user identity within the directory.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="eb197-149">Проблемы и рекомендации</span><span class="sxs-lookup"><span data-stu-id="eb197-149">Issues and considerations</span></span>

<span data-ttu-id="eb197-150">При разработке приложения, которое реализует федеративную аутентификацию, необходимо учитывать следующее:</span><span class="sxs-lookup"><span data-stu-id="eb197-150">Consider the following when designing applications that implement federated authentication:</span></span>

- <span data-ttu-id="eb197-151">Аутентификация может быть единой точкой отказа.</span><span class="sxs-lookup"><span data-stu-id="eb197-151">Authentication can be a single point of failure.</span></span> <span data-ttu-id="eb197-152">При развертывании приложения в нескольких центрах обработки данных убедитесь, что механизм управления удостоверениями развертывается в одном центре, чтобы поддержать доступность и стабильность приложения.</span><span class="sxs-lookup"><span data-stu-id="eb197-152">If you deploy your application to multiple datacenters, consider deploying your identity management mechanism to the same datacenters to maintain application reliability and availability.</span></span>

- <span data-ttu-id="eb197-153">Инструменты аутентификации позволяют настроить управление доступом на основе утверждений ролей, содержащихся в маркере проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="eb197-153">Authentication tools make it possible to configure access control based on role claims contained in the authentication token.</span></span> <span data-ttu-id="eb197-154">Это часто называется управлением доступом на основе ролей (RBAC) и позволяет более эффективно контролировать доступ к компонентам и ресурсам.</span><span class="sxs-lookup"><span data-stu-id="eb197-154">This is often referred to as role-based access control (RBAC), and it can allow a more granular level of control over access to features and resources.</span></span>

- <span data-ttu-id="eb197-155">В отличие от каталогов организации аутентификация на основе утверждений, использующая поставщиков удостоверений из социальных сетей, обычно не предоставляет никаких сведений о прошедших аутентификацию пользователях, кроме адреса электронной почты и, может быть, имени.</span><span class="sxs-lookup"><span data-stu-id="eb197-155">Unlike a corporate directory, claims-based authentication using social identity providers doesn't usually provide information about the authenticated user other than an email address, and perhaps a name.</span></span> <span data-ttu-id="eb197-156">Некоторые поставщики удостоверений из социальных сетей, например из учетной записи Майкрософт, указывают лишь уникальный идентификатор.</span><span class="sxs-lookup"><span data-stu-id="eb197-156">Some social identity providers, such as a Microsoft account, provide only a unique identifier.</span></span> <span data-ttu-id="eb197-157">Обычно приложение должно содержать некоторые сведения о зарегистрированных пользователях и сопоставлять их с идентификатором в утверждениях токена.</span><span class="sxs-lookup"><span data-stu-id="eb197-157">The application usually needs to maintain some information on registered users, and be able to match this information to the identifier contained in the claims in the token.</span></span> <span data-ttu-id="eb197-158">Это делается путем регистрации после первого доступа к приложению, а затем сведения вставляются в токен в виде дополнительных утверждений после каждой аутентификации.</span><span class="sxs-lookup"><span data-stu-id="eb197-158">Typically this is done through registration when the user first accesses the application, and information is then injected into the token as additional claims after each authentication.</span></span>

- <span data-ttu-id="eb197-159">Если для службы маркеров безопасности настроено несколько поставщиков удостоверений, необходимо определить, к какому поставщику нужно перенаправить пользователей для аутентификации.</span><span class="sxs-lookup"><span data-stu-id="eb197-159">If there's more than one identity provider configured for the STS, it must detect which identity provider the user should be redirected to for authentication.</span></span> <span data-ttu-id="eb197-160">Этот процесс называется обнаружением домашней области.</span><span class="sxs-lookup"><span data-stu-id="eb197-160">This process is called home realm discovery.</span></span> <span data-ttu-id="eb197-161">Служба токенов безопасности может сделать это автоматически на основе адреса электронной почты или имени пользователя, предоставленными пользователем, дочернего домена приложения, к которому обращается пользователь, области IP-адресов для пользователя или содержимого файла cookie, хранящегося в браузере пользователя.</span><span class="sxs-lookup"><span data-stu-id="eb197-161">The STS might be able to do this automatically based on an email address or user name that the user provides, a subdomain of the application that the user is accessing, the user’s IP address scope, or on the contents of a cookie stored in the user’s browser.</span></span> <span data-ttu-id="eb197-162">Например, если пользователь ввел адрес электронной почты в домене корпорации Майкрософт user@live.com, служба токенов безопасности перенаправит его на страницу входа в учетную запись Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="eb197-162">For example, if the user entered an email address in the Microsoft domain, such as user@live.com, the STS will redirect the user to the Microsoft account sign-in page.</span></span> <span data-ttu-id="eb197-163">В следующий раз служба токенов безопасности может использовать файл cookie, чтобы указать, что последний вход был совершен через учетную запись Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="eb197-163">On later visits, the STS could use a cookie to indicate that the last sign in was with a Microsoft account.</span></span> <span data-ttu-id="eb197-164">Если при автоматическом обнаружении домашняя область не определяется, служба токенов безопасности откроет страницу обнаружения домашней области со списком доверенных поставщиков удостоверений, и пользователь должен выбрать одного из них.</span><span class="sxs-lookup"><span data-stu-id="eb197-164">If automatic discovery can't determine the home realm, the STS will display a home realm discovery page that lists the trusted identity providers, and the user must select the one they want to use.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="eb197-165">Когда следует использовать этот шаблон</span><span class="sxs-lookup"><span data-stu-id="eb197-165">When to use this pattern</span></span>

<span data-ttu-id="eb197-166">Шаблон полезен в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="eb197-166">This pattern is useful for scenarios such as:</span></span>

- <span data-ttu-id="eb197-167">**Единый вход в корпоративное приложение**.</span><span class="sxs-lookup"><span data-stu-id="eb197-167">**Single sign-on in the enterprise**.</span></span> <span data-ttu-id="eb197-168">В этом случае необходимо выполнить аутентификацию сотрудников для корпоративных приложений, размещенных в облаке за пределами периметра безопасности организации. При этом не нужно входить в систему каждый раз при использовании приложения.</span><span class="sxs-lookup"><span data-stu-id="eb197-168">In this scenario you need to authenticate employees for corporate applications that are hosted in the cloud outside the corporate security boundary, without requiring them to sign in every time they visit an application.</span></span> <span data-ttu-id="eb197-169">Взаимодействие с пользователем будет таким же, как при использовании локальных приложений, в которых они проходили аутентификацию после входа в систему в корпоративной сети и получали доступ ко всем соответствующим приложениям без необходимости повторного входа.</span><span class="sxs-lookup"><span data-stu-id="eb197-169">The user experience is the same as when using on-premises applications where they're authenticated when signing in to a corporate network, and from then on have access to all relevant applications without needing to sign in again.</span></span>

- <span data-ttu-id="eb197-170">**Федеративная идентификация с несколькими участниками**.</span><span class="sxs-lookup"><span data-stu-id="eb197-170">**Federated identity with multiple partners**.</span></span> <span data-ttu-id="eb197-171">В этом случае необходимо выполнить аутентификацию для корпоративных сотрудников и деловых партнеров, не имеющих учетных записей в каталоге организации.</span><span class="sxs-lookup"><span data-stu-id="eb197-171">In this scenario you need to authenticate both corporate employees and business partners who don't have accounts in the corporate directory.</span></span> <span data-ttu-id="eb197-172">Такое часто встречается в бизнес-приложениях, приложениях, которые интегрируются со службами сторонних производителей, а также при слиянии компаний с различными ИТ-системами или при обмене ресурсами.</span><span class="sxs-lookup"><span data-stu-id="eb197-172">This is common in business-to-business applications, applications that integrate with third-party services, and where companies with different IT systems have merged or shared resources.</span></span>

- <span data-ttu-id="eb197-173">**Федеративная идентификация в приложениях SaaS**.</span><span class="sxs-lookup"><span data-stu-id="eb197-173">**Federated identity in SaaS applications**.</span></span> <span data-ttu-id="eb197-174">В этом случае независимые поставщики программного обеспечения предоставляют готовые к использованию службы нескольким клиентам или арендаторам.</span><span class="sxs-lookup"><span data-stu-id="eb197-174">In this scenario independent software vendors provide a ready-to-use service for multiple clients or tenants.</span></span> <span data-ttu-id="eb197-175">Каждый арендатор выполняет аутентификацию с помощью подходящего поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="eb197-175">Each tenant authenticates using a suitable identity provider.</span></span> <span data-ttu-id="eb197-176">Например, бизнес-пользователи будут использовать свои корпоративные учетные данные, а потребители и клиенты арендатора будут использовать свои учетные данные удостоверений из социальных сетей.</span><span class="sxs-lookup"><span data-stu-id="eb197-176">For example, business users will use their corporate credentials, while consumers and clients of the tenant will use their social identity credentials.</span></span>

<span data-ttu-id="eb197-177">Этот шаблон неприменим в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="eb197-177">This pattern might not be useful in the following situations:</span></span>

- <span data-ttu-id="eb197-178">Один поставщик удостоверений может выполнить аутентификацию для всех пользователей приложения, и не нужно проводить аутентификацию с использованием другого поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="eb197-178">All users of the application can be authenticated by one identity provider, and there's no requirement to authenticate using any other identity provider.</span></span> <span data-ttu-id="eb197-179">Такое часто встречается в бизнес-приложениях, которые используют корпоративный каталог (доступный в приложении) для аутентификации с помощью VPN или (в сценарии размещения в облаке) через подключение к виртуальной сети между локальным каталогом и приложением.</span><span class="sxs-lookup"><span data-stu-id="eb197-179">This is typical in business applications that use a corporate directory (accessible within the application) for authentication, by using a VPN, or (in a cloud-hosted scenario) through a virtual network connection between the on-premises directory and the application.</span></span>

- <span data-ttu-id="eb197-180">Приложение изначально было создано с другим механизмом аутентификации, возможно, с помощью пользовательских хранилищ, или же у него нет возможности для обработки стандартов согласования, используемых технологиями на основе утверждений.</span><span class="sxs-lookup"><span data-stu-id="eb197-180">The application was originally built using a different authentication mechanism, perhaps with custom user stores, or doesn't have the capability to handle the negotiation standards used by claims-based technologies.</span></span> <span data-ttu-id="eb197-181">Модернизация управления доступом и аутентификации на основе утверждений для имеющихся приложений может быть сложной и, возможно, невыгодной.</span><span class="sxs-lookup"><span data-stu-id="eb197-181">Retrofitting claims-based authentication and access control into existing applications can be complex, and probably not cost effective.</span></span>

## <a name="example"></a><span data-ttu-id="eb197-182">Пример</span><span class="sxs-lookup"><span data-stu-id="eb197-182">Example</span></span>

<span data-ttu-id="eb197-183">Организация размещает мультитенантное приложение SaaS в Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="eb197-183">An organization hosts a multi-tenant software as a service (SaaS) application in Microsoft Azure.</span></span> <span data-ttu-id="eb197-184">Приложение включает веб-сайт, с помощью которого клиенты могут настраивать приложения для пользователей.</span><span class="sxs-lookup"><span data-stu-id="eb197-184">The application includes a website that tenants can use to manage the application for their own users.</span></span> <span data-ttu-id="eb197-185">Оно позволяет клиентам осуществлять доступ к веб-сайту с помощью федеративного удостоверения, созданного службами федерации Active Directory (ADFS). Это происходит, когда пользователь проходит аутентификацию Active Directory.</span><span class="sxs-lookup"><span data-stu-id="eb197-185">The application allows tenants to access the website by using a federated identity that is generated by Active Directory Federation Services (ADFS) when a user is authenticated by that organization’s own Active Directory.</span></span>

![Как пользователи крупного корпоративного подписчика получают доступ к приложению](./_images/federated-identity-multitenat.png)

<span data-ttu-id="eb197-187">На рисунке показано, как клиент выполняет аутентификацию с помощью собственного поставщика удостоверений службы федерации Active Directory (шаг 1).</span><span class="sxs-lookup"><span data-stu-id="eb197-187">The figure shows how tenants authenticate with their own identity provider (step 1), in this case ADFS.</span></span> <span data-ttu-id="eb197-188">После успешной аутентификации клиента служба федерации Active Directory выдает токен.</span><span class="sxs-lookup"><span data-stu-id="eb197-188">After successfully authenticating a tenant, ADFS issues a token.</span></span> <span data-ttu-id="eb197-189">Браузер клиента перенаправляет этот токен федеративному поставщику приложения SaaS, который доверяет токенам, выданным клиентом службы федерации Active Directory, чтобы получить допустимый для поставщика федерации SaaS токен (шаг 2).</span><span class="sxs-lookup"><span data-stu-id="eb197-189">The client browser forwards this token to the SaaS application’s federation provider, which trusts tokens issued by the tenant’s ADFS, in order to get back a token that is valid for the SaaS federation provider (step 2).</span></span> <span data-ttu-id="eb197-190">При необходимости перед возвратом нового токена в клиентский браузер федеративный поставщик SaaS выполняет преобразование утверждений в токене в утверждения, которые распознает приложение (шаг 3).</span><span class="sxs-lookup"><span data-stu-id="eb197-190">If necessary, the SaaS federation provider performs a transformation on the claims in the token into claims that the application recognizes (step 3) before returning the new token to the client browser.</span></span> <span data-ttu-id="eb197-191">Приложение доверяет токенам, выданным федеративным поставщиком SaaS, и использует утверждения в токене для применения правил авторизации (шаг 4).</span><span class="sxs-lookup"><span data-stu-id="eb197-191">The application trusts tokens issued by the SaaS federation provider and uses the claims in the token to apply authorization rules (step 4).</span></span>

<span data-ttu-id="eb197-192">Клиентам не нужно запоминать отдельные учетные данные для доступа к приложению. Администратор компании клиента в своем ADFS может настроить список пользователей, которые получат доступ к приложению.</span><span class="sxs-lookup"><span data-stu-id="eb197-192">Tenants won't need to remember separate credentials to access the application, and an administrator at the tenant’s company can configure in its own ADFS the list of users that can access the application.</span></span>

## <a name="related-guidance"></a><span data-ttu-id="eb197-193">Связанные руководства</span><span class="sxs-lookup"><span data-stu-id="eb197-193">Related guidance</span></span>

- [<span data-ttu-id="eb197-194">Microsoft Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="eb197-194">Microsoft Azure Active Directory</span></span>](https://azure.microsoft.com/services/active-directory/)
- [<span data-ttu-id="eb197-195">Доменные службы Active Directory</span><span class="sxs-lookup"><span data-stu-id="eb197-195">Active Directory Domain Services</span></span>](https://msdn.microsoft.com/library/bb897402.aspx)
- <span data-ttu-id="eb197-196">[Active Directory Federation Services](https://msdn.microsoft.com/library/bb897402.aspx) (Службы федерации Active Directory)</span><span class="sxs-lookup"><span data-stu-id="eb197-196">[Active Directory Federation Services](https://msdn.microsoft.com/library/bb897402.aspx)</span></span>
- [<span data-ttu-id="eb197-197">Управление удостоверениями мультитенантных приложений в Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="eb197-197">Identity management for multitenant applications in Microsoft Azure</span></span>](/azure/architecture/multitenant-identity)
- [<span data-ttu-id="eb197-198">Мультитенантные приложения Azure</span><span class="sxs-lookup"><span data-stu-id="eb197-198">Multitenant Applications in Azure</span></span>](/azure/dotnet-develop-multitenant-applications)
