---
title: Привратник
description: Защита приложений и служб с помощью выделенного экземпляра узла, который выполняет роль брокера между клиентами и приложением или службой, проверяет и очищает запросы, а также передает запросы и данные между ними.
keywords: конструктивный шаблон
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- security
ms.openlocfilehash: 39f8548bbccb5e19d433f65b2e7e09147d676996
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
# <a name="gatekeeper-pattern"></a>Шаблон привратника

[!INCLUDE [header](../_includes/header.md)]

Защита приложений и служб с помощью выделенного экземпляра узла, который выполняет роль брокера между клиентами и приложением или службой, проверяет и очищает запросы, а также передает запросы и данные между ними. Такой подход обеспечивает дополнительный уровень защиты и ограничивает степень влияния атаки на систему.

## <a name="context-and-problem"></a>Контекст и проблема

Приложения предоставляют клиентам свои функции, принимая и обрабатывая запросы. Размещенные в облаке приложения предоставляют конечные точки, к которым подключаются клиенты и которые обычно содержат код для обработки запросов от клиентов. Этот код выполняет аутентификацию и проверку, полную обработку запросов или некоторую ее часть, обращается от имени клиента к хранилищу и другим службам.

Если пользователь-злоумышленник сможет скомпрометировать систему и получить доступ к среде размещения приложения, он также получит доступ ко многим механизмам защиты, включая учетные данные и ключи хранилища, а также все службы и данные, к которым обращается этот код. Таким образом пользователь-злоумышленник получает практически неограниченный контроль над конфиденциальной информацией и другими службами.

## <a name="solution"></a>Решение

Чтобы минимизировать возможность доступа клиентов к конфиденциальной информации и службам приложения, изолируйте узлы или задачи, которые предоставляют открытые конечные точки, от кода обработки запросов и обращения к хранилищу. Для этого можно использовать оболочку, то есть специализированную задачу, которая взаимодействует с клиентами и передает запросы (например, через несвязанный интерфейс) узлам или задачам, которые обрабатывают эти запросы. На этом рисунке представлен общий обзор этого шаблона.

![Общие сведения о шаблоне](./_images/gatekeeper-diagram.png)


Шаблон привратника может просто защищать хранилище данных или использоваться в качестве многофункциональной оболочки для защиты всех функций приложения. Используя эту модель, важно учитывать следующее:

- **Контролируемая проверка.** Привратник проверяет все запросы, отклоняя те, которые не соответствуют условиям проверки.
- **Ограничение риска и уязвимости.** У привратника нет доступа к учетным данным или ключам, которые доверенный узел использует, чтобы обращаться к хранилищу и службам. Скомпрометировав привратник, злоумышленник не получит доступ к учетным данным или ключам.
- **Обеспечение безопасности.** Привратник работает в режиме ограниченных прав, а остальная часть приложения — в режиме полного доверия, необходимом для обеспечения доступа к хранилищу и службам. Даже в случае компрометации привратник не сможет обратиться к службам или данным приложения напрямую.

Этот шаблон действует как брандмауэр в классической сетевой топографии. Такая архитектура позволяет привратнику проверять запросы и решать, нужно ли передавать их доверенному узлу, который выполнит требуемые задачи. Обычно, если привратник принимает решение передать запрос доверенному узлу, он предварительно проверяет и очищает содержимое запроса.

## <a name="issues-and-considerations"></a>Проблемы и рекомендации

При принятии решения о реализации этого шаблона необходимо учитывать следующие моменты.

- Доверенный узел, которому привратник передает запросы, должен предоставлять только внутренние или защищенные конечные точки, которые допускают подключение только от привратника. У доверенных узлов не должно быть внешних конечных точек и (или) интерфейсов.
- Привратник должен выполняться в режиме ограниченных прав. Для этого привратник и доверенный узел обычно размещают в разных службах или на разных виртуальных машин.
- Привратник не должен выполнять обработку, связанную с работой приложения или служб, а также обращаться к данным. Его единственная функция — проверка и очистка запросов. Возможно, доверенный узел будет выполнять дополнительные проверки запросов, но все основные проверки следует поручить привратнику.
- Если возможно, используйте безопасный коммуникационный канал (HTTPS, SSL или TLS) между привратником и доверенным узлом или задачами. Некоторые среды размещения не поддерживают HTTPS для внутренних конечных точек.
- Добавление еще одного слоя приложения, необходимого для реализации шаблона привратника, может несколько снизить производительность из-за необходимости в дополнительной обработке и сетевом взаимодействии.
- Экземпляр привратника может стать единой точкой отказа. Чтобы свести к минимуму влияние таких отказов, можно развернуть дополнительные экземпляры и настроить механизм автомасштабирования, чтобы обеспечить необходимую мощность и доступность.

## <a name="when-to-use-this-pattern"></a>Когда следует использовать этот шаблон

Этот шаблон можно использовать для следующих целей:

- в приложениях, которые обрабатывают конфиденциальные сведения, предоставляют службы, которым требуется высокий уровень защиты от атак злоумышленников, или выполняют важные операции, которые нельзя прерывать.
- в распределенных приложениях, в которых проверка запроса должна быть отделена от основных задач или может выполняться централизованно, чтобы упростить обслуживание и администрирование.

## <a name="example"></a>Пример

При облачном размещении этот шаблон можно реализовать, отделив роль или виртуальную машину привратника от доверенных ролей и служб приложения. Для этого добавьте внутреннюю конечную точку, очередь или хранилище в качестве промежуточного механизма взаимодействия. На схеме представлен пример с использованием внутренней конечной точки.

![Пример шаблона с использованием веб-роли и рабочей роли облачных служб](./_images/gatekeeper-endpoint.png)


## <a name="related-patterns"></a>Связанные шаблоны

[Шаблон ключа камердинера](valet-key.md) также может использоваться при реализации шаблона привратника. При обмене данными между ролью привратника и доверенными ролями рекомендуется применять ключи или маркеры, ограничивающие права доступа к ресурсам, чтобы повысить уровень безопасности. Этот шаблон описывает, как использовать маркер или ключ, который предоставляет клиентам ограниченный прямой доступ к определенному ресурсу или службе.
