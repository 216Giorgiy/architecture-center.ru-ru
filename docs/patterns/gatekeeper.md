---
title: Шаблон привратника
titleSuffix: Cloud Design Patterns
description: Защита приложений и служб с помощью выделенного экземпляра узла, который выполняет роль брокера между клиентами и приложением или службой, проверяет и очищает запросы, а также передает запросы и данные между ними.
keywords: Конструктивный шаблон
author: dragon119
ms.date: 06/23/2017
ms.custom: seodec18
ms.openlocfilehash: a45ace8ea05e4a7dd1d8a48653e94a5fe5bfb0f6
ms.sourcegitcommit: 680c9cef945dff6fee5e66b38e24f07804510fa9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/04/2019
ms.locfileid: "54009701"
---
# <a name="gatekeeper-pattern"></a><span data-ttu-id="96c43-104">Шаблон привратника</span><span class="sxs-lookup"><span data-stu-id="96c43-104">Gatekeeper pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="96c43-105">Защита приложений и служб с помощью выделенного экземпляра узла, который выполняет роль брокера между клиентами и приложением или службой, проверяет и очищает запросы, а также передает запросы и данные между ними.</span><span class="sxs-lookup"><span data-stu-id="96c43-105">Protect applications and services by using a dedicated host instance that acts as a broker between clients and the application or service, validates and sanitizes requests, and passes requests and data between them.</span></span> <span data-ttu-id="96c43-106">Такой подход обеспечивает дополнительный уровень защиты и ограничивает степень влияния атаки на систему.</span><span class="sxs-lookup"><span data-stu-id="96c43-106">This can provide an additional layer of security, and limit the attack surface of the system.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="96c43-107">Контекст и проблема</span><span class="sxs-lookup"><span data-stu-id="96c43-107">Context and problem</span></span>

<span data-ttu-id="96c43-108">Приложения предоставляют клиентам свои функции, принимая и обрабатывая запросы.</span><span class="sxs-lookup"><span data-stu-id="96c43-108">Applications expose their functionality to clients by accepting and processing requests.</span></span> <span data-ttu-id="96c43-109">Размещенные в облаке приложения предоставляют конечные точки, к которым подключаются клиенты и которые обычно содержат код для обработки запросов от клиентов.</span><span class="sxs-lookup"><span data-stu-id="96c43-109">In cloud-hosted scenarios, applications expose endpoints clients connect to, and typically include the code to handle the requests from clients.</span></span> <span data-ttu-id="96c43-110">Этот код выполняет аутентификацию и проверку, полную обработку запросов или некоторую ее часть, обращается от имени клиента к хранилищу и другим службам.</span><span class="sxs-lookup"><span data-stu-id="96c43-110">This code performs authentication and validation, some or all request processing, and is likely to accesses storage and other services on behalf of the client.</span></span>

<span data-ttu-id="96c43-111">Если пользователь-злоумышленник сможет скомпрометировать систему и получить доступ к среде размещения приложения, он также получит доступ ко многим механизмам защиты, включая учетные данные и ключи хранилища, а также все службы и данные, к которым обращается этот код.</span><span class="sxs-lookup"><span data-stu-id="96c43-111">If a malicious user is able to compromise the system and gain access to the application’s hosting environment, the security mechanisms it uses such as credentials and storage keys, and the services and data it accesses, are exposed.</span></span> <span data-ttu-id="96c43-112">Таким образом пользователь-злоумышленник получает практически неограниченный контроль над конфиденциальной информацией и другими службами.</span><span class="sxs-lookup"><span data-stu-id="96c43-112">As a result, the malicious user can gain unrestrained access to sensitive information and other services.</span></span>

## <a name="solution"></a><span data-ttu-id="96c43-113">Решение</span><span class="sxs-lookup"><span data-stu-id="96c43-113">Solution</span></span>

<span data-ttu-id="96c43-114">Чтобы минимизировать возможность доступа клиентов к конфиденциальной информации и службам приложения, изолируйте узлы или задачи, которые предоставляют открытые конечные точки, от кода обработки запросов и обращения к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="96c43-114">To minimize the risk of clients gaining access to sensitive information and services, decouple hosts or tasks that expose public endpoints from the code that processes requests and accesses storage.</span></span> <span data-ttu-id="96c43-115">Для этого можно использовать оболочку, то есть специализированную задачу, которая взаимодействует с клиентами и передает запросы (например, через несвязанный интерфейс) узлам или задачам, которые обрабатывают эти запросы.</span><span class="sxs-lookup"><span data-stu-id="96c43-115">You can achieve this by using a façade or a dedicated task that interacts with clients and then hands off the request&mdash;perhaps through a decoupled interface&mdash;to the hosts or tasks that'll handle the request.</span></span> <span data-ttu-id="96c43-116">На этом рисунке представлен общий обзор этого шаблона.</span><span class="sxs-lookup"><span data-stu-id="96c43-116">The figure provides a high-level overview of this pattern.</span></span>

![Общие сведения о шаблоне](./_images/gatekeeper-diagram.png)

<span data-ttu-id="96c43-118">Шаблон привратника может просто защищать хранилище данных или использоваться в качестве многофункциональной оболочки для защиты всех функций приложения.</span><span class="sxs-lookup"><span data-stu-id="96c43-118">The gatekeeper pattern can be used to simply protect storage, or it can be used as a more comprehensive façade to protect all of the functions of the application.</span></span> <span data-ttu-id="96c43-119">Используя эту модель, важно учитывать следующее:</span><span class="sxs-lookup"><span data-stu-id="96c43-119">The important factors are:</span></span>

- <span data-ttu-id="96c43-120">**Контролируемая проверка**.</span><span class="sxs-lookup"><span data-stu-id="96c43-120">**Controlled validation**.</span></span> <span data-ttu-id="96c43-121">Привратник проверяет все запросы, отклоняя те, которые не соответствуют условиям проверки.</span><span class="sxs-lookup"><span data-stu-id="96c43-121">The gatekeeper validates all requests, and rejects those that don't meet validation requirements.</span></span>
- <span data-ttu-id="96c43-122">**Ограничение риска и уязвимости**.</span><span class="sxs-lookup"><span data-stu-id="96c43-122">**Limited risk and exposure**.</span></span> <span data-ttu-id="96c43-123">У привратника нет доступа к учетным данным или ключам, которые доверенный узел использует, чтобы обращаться к хранилищу и службам.</span><span class="sxs-lookup"><span data-stu-id="96c43-123">The gatekeeper doesn't have access to the credentials or keys used by the trusted host to access storage and services.</span></span> <span data-ttu-id="96c43-124">Скомпрометировав привратник, злоумышленник не получит доступ к учетным данным или ключам.</span><span class="sxs-lookup"><span data-stu-id="96c43-124">If the gatekeeper is compromised, the attacker doesn't get access to these credentials or keys.</span></span>
- <span data-ttu-id="96c43-125">**Обеспечение безопасности**.</span><span class="sxs-lookup"><span data-stu-id="96c43-125">**Appropriate security**.</span></span> <span data-ttu-id="96c43-126">Привратник работает в режиме ограниченных прав, а остальная часть приложения — в режиме полного доверия, необходимом для обеспечения доступа к хранилищу и службам.</span><span class="sxs-lookup"><span data-stu-id="96c43-126">The gatekeeper runs in a limited privilege mode, while the rest of the application runs in the full trust mode required to access storage and services.</span></span> <span data-ttu-id="96c43-127">Даже в случае компрометации привратник не сможет обратиться к службам или данным приложения напрямую.</span><span class="sxs-lookup"><span data-stu-id="96c43-127">If the gatekeeper is compromised, it can't directly access the application services or data.</span></span>

<span data-ttu-id="96c43-128">Этот шаблон действует как брандмауэр в классической сетевой топографии.</span><span class="sxs-lookup"><span data-stu-id="96c43-128">This pattern acts like a firewall in a typical network topography.</span></span> <span data-ttu-id="96c43-129">Такая архитектура позволяет привратнику проверять запросы и решать, нужно ли передавать их доверенному узлу, который выполнит требуемые задачи.</span><span class="sxs-lookup"><span data-stu-id="96c43-129">It allows the gatekeeper to examine requests and make a decision about whether to pass the request on to the trusted host (sometimes called the keymaster) that performs the required tasks.</span></span> <span data-ttu-id="96c43-130">Обычно, если привратник принимает решение передать запрос доверенному узлу, он предварительно проверяет и очищает содержимое запроса.</span><span class="sxs-lookup"><span data-stu-id="96c43-130">This decision typically requires the gatekeeper to validate and sanitize the request content before passing it on to the trusted host.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="96c43-131">Проблемы и рекомендации</span><span class="sxs-lookup"><span data-stu-id="96c43-131">Issues and considerations</span></span>

<span data-ttu-id="96c43-132">При принятии решения о реализации этого шаблона необходимо учитывать следующие моменты.</span><span class="sxs-lookup"><span data-stu-id="96c43-132">Consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="96c43-133">Доверенный узел, которому привратник передает запросы, должен предоставлять только внутренние или защищенные конечные точки, которые допускают подключение только от привратника.</span><span class="sxs-lookup"><span data-stu-id="96c43-133">Ensure that the trusted hosts the gatekeeper passes requests to expose only internal or protected endpoints, and connect only to the gatekeeper.</span></span> <span data-ttu-id="96c43-134">У доверенных узлов не должно быть внешних конечных точек и (или) интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="96c43-134">The trusted hosts shouldn't expose any external endpoints or interfaces.</span></span>
- <span data-ttu-id="96c43-135">Привратник должен выполняться в режиме ограниченных прав.</span><span class="sxs-lookup"><span data-stu-id="96c43-135">The gatekeeper must run in a limited privilege mode.</span></span> <span data-ttu-id="96c43-136">Для этого привратник и доверенный узел обычно размещают в разных службах или на разных виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="96c43-136">Typically this means running the gatekeeper and the trusted host in separate hosted services or virtual machines.</span></span>
- <span data-ttu-id="96c43-137">Привратник не должен выполнять обработку, связанную с работой приложения или служб, а также обращаться к данным.</span><span class="sxs-lookup"><span data-stu-id="96c43-137">The gatekeeper shouldn't perform any processing related to the application or services, or access any data.</span></span> <span data-ttu-id="96c43-138">Его единственная функция — проверка и очистка запросов.</span><span class="sxs-lookup"><span data-stu-id="96c43-138">Its function is purely to validate and sanitize requests.</span></span> <span data-ttu-id="96c43-139">Возможно, доверенный узел будет выполнять дополнительные проверки запросов, но все основные проверки следует поручить привратнику.</span><span class="sxs-lookup"><span data-stu-id="96c43-139">The trusted hosts might need to perform additional validation of requests, but the core validation should be performed by the gatekeeper.</span></span>
- <span data-ttu-id="96c43-140">Если возможно, используйте безопасный коммуникационный канал (HTTPS, SSL или TLS) между привратником и доверенным узлом или задачами.</span><span class="sxs-lookup"><span data-stu-id="96c43-140">Use a secure communication channel (HTTPS, SSL, or TLS) between the gatekeeper and the trusted hosts or tasks where this is possible.</span></span> <span data-ttu-id="96c43-141">Некоторые среды размещения не поддерживают HTTPS для внутренних конечных точек.</span><span class="sxs-lookup"><span data-stu-id="96c43-141">However, some hosting environments don't support HTTPS on internal endpoints.</span></span>
- <span data-ttu-id="96c43-142">Добавление еще одного слоя приложения, необходимого для реализации шаблона привратника, может несколько снизить производительность из-за необходимости в дополнительной обработке и сетевом взаимодействии.</span><span class="sxs-lookup"><span data-stu-id="96c43-142">Adding the extra layer to the application to implement the gatekeeper pattern is likely to have some impact on performance due to the additional processing and network communication it requires.</span></span>
- <span data-ttu-id="96c43-143">Экземпляр привратника может стать единой точкой отказа.</span><span class="sxs-lookup"><span data-stu-id="96c43-143">The gatekeeper instance could be a single point of failure.</span></span> <span data-ttu-id="96c43-144">Чтобы свести к минимуму влияние таких отказов, можно развернуть дополнительные экземпляры и настроить механизм автомасштабирования, чтобы обеспечить необходимую мощность и доступность.</span><span class="sxs-lookup"><span data-stu-id="96c43-144">To minimize the impact of a failure, consider deploying additional instances and using an autoscaling mechanism to ensure capacity to maintain availability.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="96c43-145">Когда следует использовать этот шаблон</span><span class="sxs-lookup"><span data-stu-id="96c43-145">When to use this pattern</span></span>

<span data-ttu-id="96c43-146">Этот шаблон можно использовать для следующих целей:</span><span class="sxs-lookup"><span data-stu-id="96c43-146">This pattern is useful for:</span></span>

- <span data-ttu-id="96c43-147">в приложениях, которые обрабатывают конфиденциальные сведения, предоставляют службы, которым требуется высокий уровень защиты от атак злоумышленников, или выполняют важные операции, которые нельзя прерывать.</span><span class="sxs-lookup"><span data-stu-id="96c43-147">Applications that handle sensitive information, expose services that must have a high degree of protection from malicious attacks, or perform mission-critical operations that shouldn't be disrupted.</span></span>
- <span data-ttu-id="96c43-148">в распределенных приложениях, в которых проверка запроса должна быть отделена от основных задач или может выполняться централизованно, чтобы упростить обслуживание и администрирование.</span><span class="sxs-lookup"><span data-stu-id="96c43-148">Distributed applications where it's necessary to perform request validation separately from the main tasks, or to centralize this validation to simplify maintenance and administration.</span></span>

## <a name="example"></a><span data-ttu-id="96c43-149">Пример</span><span class="sxs-lookup"><span data-stu-id="96c43-149">Example</span></span>

<span data-ttu-id="96c43-150">При облачном размещении этот шаблон можно реализовать, отделив роль или виртуальную машину привратника от доверенных ролей и служб приложения.</span><span class="sxs-lookup"><span data-stu-id="96c43-150">In a cloud-hosted scenario, this pattern can be implemented by decoupling the gatekeeper role or virtual machine from the trusted roles and services in an application.</span></span> <span data-ttu-id="96c43-151">Для этого добавьте внутреннюю конечную точку, очередь или хранилище в качестве промежуточного механизма взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="96c43-151">Do this by using an internal endpoint, a queue, or storage as an intermediate communication mechanism.</span></span> <span data-ttu-id="96c43-152">На схеме представлен пример с использованием внутренней конечной точки.</span><span class="sxs-lookup"><span data-stu-id="96c43-152">The figure illustrates using an internal endpoint.</span></span>

![Пример шаблона с использованием веб-роли и рабочей роли облачных служб](./_images/gatekeeper-endpoint.png)

## <a name="related-patterns"></a><span data-ttu-id="96c43-154">Связанные шаблоны</span><span class="sxs-lookup"><span data-stu-id="96c43-154">Related patterns</span></span>

<span data-ttu-id="96c43-155">[Шаблон ключа камердинера](./valet-key.md) также может использоваться при реализации шаблона привратника.</span><span class="sxs-lookup"><span data-stu-id="96c43-155">The [Valet Key pattern](./valet-key.md) might also be relevant when implementing the Gatekeeper pattern.</span></span> <span data-ttu-id="96c43-156">При обмене данными между ролью привратника и доверенными ролями рекомендуется применять ключи или маркеры, ограничивающие права доступа к ресурсам, чтобы повысить уровень безопасности.</span><span class="sxs-lookup"><span data-stu-id="96c43-156">When communicating between the Gatekeeper and trusted roles it's good practice to enhance security by using keys or tokens that limit permissions for accessing resources.</span></span> <span data-ttu-id="96c43-157">Этот шаблон описывает, как использовать маркер или ключ, который предоставляет клиентам ограниченный прямой доступ к определенному ресурсу или службе.</span><span class="sxs-lookup"><span data-stu-id="96c43-157">Describes how to use a token or key that provides clients with restricted direct access to a specific resource or service.</span></span>
