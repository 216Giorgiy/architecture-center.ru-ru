---
title: Реализация архитектуры защищенной гибридной сети
titleSuffix: Azure Reference Architectures
description: Реализация архитектуры защищенной гибридной сети в Azure.
author: telmosampaio
ms.date: 10/22/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18, networking
ms.openlocfilehash: 82327cca08e614bfe5226c9ca1a414388878a7c2
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54482516"
---
# <a name="implement-a-dmz-between-azure-and-your-on-premises-datacenter"></a><span data-ttu-id="41c89-103">Реализация сети периметра между Azure и локальным центром обработки данных</span><span class="sxs-lookup"><span data-stu-id="41c89-103">Implement a DMZ between Azure and your on-premises datacenter</span></span>

<span data-ttu-id="41c89-104">Эта эталонная архитектура представляет собой защищенную гибридную сеть, которая расширяет локальную сеть в Azure.</span><span class="sxs-lookup"><span data-stu-id="41c89-104">This reference architecture shows a secure hybrid network that extends an on-premises network to Azure.</span></span> <span data-ttu-id="41c89-105">В архитектуре реализована промежуточная подсеть (также называется *сетью периметра*) между локальной сетью и виртуальной сетью Azure.</span><span class="sxs-lookup"><span data-stu-id="41c89-105">The architecture implements a DMZ, also called a *perimeter network*, between the on-premises network and an Azure virtual network (VNet).</span></span> <span data-ttu-id="41c89-106">Промежуточная подсеть содержит виртуальные сетевые модули (NVA), в которых реализованы функции безопасности, например брандмауэры и проверка пакетов.</span><span class="sxs-lookup"><span data-stu-id="41c89-106">The DMZ includes network virtual appliances (NVAs) that implement security functionality such as firewalls and packet inspection.</span></span> <span data-ttu-id="41c89-107">Весь исходящий трафик из виртуальной сети принудительно туннелируется в Интернет через локальную сеть, чтобы можно было выполнить его аудит.</span><span class="sxs-lookup"><span data-stu-id="41c89-107">All outgoing traffic from the VNet is force-tunneled to the Internet through the on-premises network, so that it can be audited.</span></span> <span data-ttu-id="41c89-108">[**Разверните это решение**](#deploy-the-solution).</span><span class="sxs-lookup"><span data-stu-id="41c89-108">[**Deploy this solution**](#deploy-the-solution).</span></span>

> [!NOTE]
> <span data-ttu-id="41c89-109">Этот сценарий также может выполняться с помощью [Брандмауэра Azure](/azure/firewall/) — облачной службы безопасности сети.</span><span class="sxs-lookup"><span data-stu-id="41c89-109">This scenario can also be accomplished using [Azure Firewall](/azure/firewall/), a cloud-based network security service.</span></span>

![Архитектура защищенной гибридной сети](./images/dmz-private.png)

<span data-ttu-id="41c89-111">*Скачайте [файл Visio][visio-download] этой архитектуры.*</span><span class="sxs-lookup"><span data-stu-id="41c89-111">*Download a [Visio file][visio-download] of this architecture.*</span></span>

<span data-ttu-id="41c89-112">Эта архитектура требует подключения к локальному ЦОД с помощью [VPN-шлюза][ra-vpn] или соединения [ExpressRoute][ra-expressroute].</span><span class="sxs-lookup"><span data-stu-id="41c89-112">This architecture requires a connection to your on-premises datacenter, using either a [VPN gateway][ra-vpn] or an [ExpressRoute][ra-expressroute] connection.</span></span> <span data-ttu-id="41c89-113">Типичные способы использования этой архитектуры:</span><span class="sxs-lookup"><span data-stu-id="41c89-113">Typical uses for this architecture include:</span></span>

- <span data-ttu-id="41c89-114">Гибридные приложения, в которых рабочие нагрузки выполняются частично локально и частично в Azure.</span><span class="sxs-lookup"><span data-stu-id="41c89-114">Hybrid applications where workloads run partly on-premises and partly in Azure.</span></span>
- <span data-ttu-id="41c89-115">Инфраструктура, которая требует строгого контроля трафика, поступающего в виртуальную сеть Azure из локального центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="41c89-115">Infrastructure that requires granular control over traffic entering an Azure VNet from an on-premises datacenter.</span></span>
- <span data-ttu-id="41c89-116">Приложения, которые должны выполнять аудит исходящего трафика.</span><span class="sxs-lookup"><span data-stu-id="41c89-116">Applications that must audit outgoing traffic.</span></span> <span data-ttu-id="41c89-117">Это распространенное нормативное требование в многих коммерческих системах. Такие приложения помогают предотвратить разглашение конфиденциальной информации.</span><span class="sxs-lookup"><span data-stu-id="41c89-117">This is often a regulatory requirement of many commercial systems and can help to prevent public disclosure of private information.</span></span>

## <a name="architecture"></a><span data-ttu-id="41c89-118">Архитектура</span><span class="sxs-lookup"><span data-stu-id="41c89-118">Architecture</span></span>

<span data-ttu-id="41c89-119">Архитектура состоит из следующих компонентов:</span><span class="sxs-lookup"><span data-stu-id="41c89-119">The architecture consists of the following components.</span></span>

- <span data-ttu-id="41c89-120">**Локальная сеть.**</span><span class="sxs-lookup"><span data-stu-id="41c89-120">**On-premises network**.</span></span> <span data-ttu-id="41c89-121">Частная локальная сеть, реализованная в пределах организации.</span><span class="sxs-lookup"><span data-stu-id="41c89-121">A private local-area network implemented in an organization.</span></span>
- <span data-ttu-id="41c89-122">**Виртуальная сеть Azure.**</span><span class="sxs-lookup"><span data-stu-id="41c89-122">**Azure virtual network (VNet)**.</span></span> <span data-ttu-id="41c89-123">В виртуальной сети размещаются приложение и другие ресурсы, работающие в Azure.</span><span class="sxs-lookup"><span data-stu-id="41c89-123">The VNet hosts the application and other resources running in Azure.</span></span>
- <span data-ttu-id="41c89-124">**Шлюз.**</span><span class="sxs-lookup"><span data-stu-id="41c89-124">**Gateway**.</span></span> <span data-ttu-id="41c89-125">Шлюз позволяет установить подключение между маршрутизаторами в локальной и виртуальной сетях.</span><span class="sxs-lookup"><span data-stu-id="41c89-125">The gateway provides connectivity between the routers in the on-premises network and the VNet.</span></span>
- <span data-ttu-id="41c89-126">**Виртуальный сетевой модуль (NVA).**</span><span class="sxs-lookup"><span data-stu-id="41c89-126">**Network virtual appliance (NVA)**.</span></span> <span data-ttu-id="41c89-127">NVA — это общий термин, который означает виртуальную машину, выполняющую такие задачи, как разрешение или запрет доступа в качестве брандмауэра, оптимизация операций глобальной сети (WAN) (в том числе сжатие сети), настраиваемая маршрутизация или другие сетевые функции.</span><span class="sxs-lookup"><span data-stu-id="41c89-127">NVA is a generic term that describes a VM performing tasks such as allowing or denying access as a firewall, optimizing wide area network (WAN) operations (including network compression), custom routing, or other network functionality.</span></span>
- <span data-ttu-id="41c89-128">**Подсети веб-уровня, уровня бизнес-логики и уровня данных.**</span><span class="sxs-lookup"><span data-stu-id="41c89-128">**Web tier, business tier, and data tier subnets**.</span></span> <span data-ttu-id="41c89-129">Подсети, в которых размещены виртуальные машины и службы для реализации примера трехуровневого приложения в облаке.</span><span class="sxs-lookup"><span data-stu-id="41c89-129">Subnets hosting the VMs and services that implement an example 3-tier application running in the cloud.</span></span> <span data-ttu-id="41c89-130">Дополнительные сведения см. в статье о [запуске виртуальных машин Windows для n-уровневой архитектуры в Azure][ra-n-tier].</span><span class="sxs-lookup"><span data-stu-id="41c89-130">See [Running Windows VMs for an N-tier architecture on Azure][ra-n-tier] for more information.</span></span>
- <span data-ttu-id="41c89-131">**Определяемые пользователем маршруты (UDR).**</span><span class="sxs-lookup"><span data-stu-id="41c89-131">**User defined routes (UDR)**.</span></span> <span data-ttu-id="41c89-132">[Определяемые пользователем маршруты][udr-overview] используются для определения потока IP-трафика в виртуальных сетях Azure.</span><span class="sxs-lookup"><span data-stu-id="41c89-132">[User defined routes][udr-overview] define the flow of IP traffic within Azure VNets.</span></span>

    > [!NOTE]
    > <span data-ttu-id="41c89-133">В зависимости от требований VPN-подключения вместо использования UDR можно настроить маршруты протокола пограничного шлюза (BGP). Это позволяет реализовать правила переадресации, при помощи которых трафик направляется обратно через локальную сеть.</span><span class="sxs-lookup"><span data-stu-id="41c89-133">Depending on the requirements of your VPN connection, you can configure Border Gateway Protocol (BGP) routes instead of using UDRs to implement the forwarding rules that direct traffic back through the on-premises network.</span></span>
    >

- <span data-ttu-id="41c89-134">**Подсеть управления.**</span><span class="sxs-lookup"><span data-stu-id="41c89-134">**Management subnet**.</span></span> <span data-ttu-id="41c89-135">Эта подсеть содержит виртуальные машины для мониторинга компонентов, работающих в виртуальной сети, и управления ими.</span><span class="sxs-lookup"><span data-stu-id="41c89-135">This subnet contains VMs that implement management and monitoring capabilities for the components running in the VNet.</span></span>

## <a name="recommendations"></a><span data-ttu-id="41c89-136">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="41c89-136">Recommendations</span></span>

<span data-ttu-id="41c89-137">Следующие рекомендации применимы для большинства ситуаций.</span><span class="sxs-lookup"><span data-stu-id="41c89-137">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="41c89-138">Следуйте этим рекомендациям, если они не противоречат особым требованиям для вашего случая.</span><span class="sxs-lookup"><span data-stu-id="41c89-138">Follow these recommendations unless you have a specific requirement that overrides them.</span></span>

### <a name="access-control-recommendations"></a><span data-ttu-id="41c89-139">Рекомендации по управлению доступом</span><span class="sxs-lookup"><span data-stu-id="41c89-139">Access control recommendations</span></span>

<span data-ttu-id="41c89-140">Используйте [управление доступом на основе ролей][rbac] (RBAC), чтобы управлять ресурсами в приложении.</span><span class="sxs-lookup"><span data-stu-id="41c89-140">Use [Role-Based Access Control][rbac] (RBAC) to manage the resources in your application.</span></span> <span data-ttu-id="41c89-141">Рекомендуем создать следующие [пользовательские роли][rbac-custom-roles]:</span><span class="sxs-lookup"><span data-stu-id="41c89-141">Consider creating the following [custom roles][rbac-custom-roles]:</span></span>

- <span data-ttu-id="41c89-142">Роль DevOps с разрешениями на администрирование инфраструктуры для приложения, развертывание компонентов приложения, а также мониторинг и перезапуск виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="41c89-142">A DevOps role with permissions to administer the infrastructure for the application, deploy the application components, and monitor and restart VMs.</span></span>

- <span data-ttu-id="41c89-143">Централизованная роль ИТ-администратора для мониторинга сетевых ресурсов и управления ими.</span><span class="sxs-lookup"><span data-stu-id="41c89-143">A centralized IT administrator role to manage and monitor network resources.</span></span>

- <span data-ttu-id="41c89-144">Роль ИТ-администратора безопасности для управления ресурсами защищенной сети, например модулем NVA.</span><span class="sxs-lookup"><span data-stu-id="41c89-144">A security IT administrator role to manage secure network resources such as the NVAs.</span></span>

<span data-ttu-id="41c89-145">Роли DevOps и ИТ-администратора не должны предоставлять доступ к ресурсам NVA.</span><span class="sxs-lookup"><span data-stu-id="41c89-145">The DevOps and IT administrator roles should not have access to the NVA resources.</span></span> <span data-ttu-id="41c89-146">Он должен быть ограничен ролью ИТ-администратора безопасности.</span><span class="sxs-lookup"><span data-stu-id="41c89-146">This should be restricted to the security IT administrator role.</span></span>

### <a name="resource-group-recommendations"></a><span data-ttu-id="41c89-147">Рекомендации по группам ресурсов</span><span class="sxs-lookup"><span data-stu-id="41c89-147">Resource group recommendations</span></span>

<span data-ttu-id="41c89-148">Управление ресурсами Azure, такими как виртуальные машины, виртуальные сети и подсистемы балансировки нагрузки, можно без труда осуществлять, объединив их в группы ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="41c89-148">Azure resources such as VMs, VNets, and load balancers can be easily managed by grouping them together into resource groups.</span></span> <span data-ttu-id="41c89-149">Чтобы ограничить доступ, назначьте роли RBAC каждой группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="41c89-149">Assign RBAC roles to each resource group to restrict access.</span></span>

<span data-ttu-id="41c89-150">Рекомендуем создать следующие группы ресурсов:</span><span class="sxs-lookup"><span data-stu-id="41c89-150">We recommend creating the following resource groups:</span></span>

- <span data-ttu-id="41c89-151">Группа ресурсов, которая содержит виртуальную сеть (за исключением виртуальных машин), группы безопасности сети и ресурсы шлюза для подключения к локальной сети.</span><span class="sxs-lookup"><span data-stu-id="41c89-151">A resource group containing the VNet (excluding the VMs), NSGs, and the gateway resources for connecting to the on-premises network.</span></span> <span data-ttu-id="41c89-152">Назначьте централизованную роль ИТ-администратора этой группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="41c89-152">Assign the centralized IT administrator role to this resource group.</span></span>
- <span data-ttu-id="41c89-153">Группа ресурсов, которая содержит виртуальные машины для модулей NVA (включая подсистему балансировки нагрузки), jumpbox и другие виртуальные машины управления, а также UDR для подсети шлюза, который позволяет направить весь трафик через NVA.</span><span class="sxs-lookup"><span data-stu-id="41c89-153">A resource group containing the VMs for the NVAs (including the load balancer), the jumpbox and other management VMs, and the UDR for the gateway subnet that forces all traffic through the NVAs.</span></span> <span data-ttu-id="41c89-154">Назначьте роль ИТ-администратора безопасности этой группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="41c89-154">Assign the security IT administrator role to this resource group.</span></span>
- <span data-ttu-id="41c89-155">Отдельные группы ресурсов для каждого уровня приложения, которые содержат подсистемы балансировки нагрузки и виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="41c89-155">Separate resource groups for each application tier that contain the load balancer and VMs.</span></span> <span data-ttu-id="41c89-156">Обратите внимание, что такая группа ресурсов не должна содержать подсети для каждого уровня.</span><span class="sxs-lookup"><span data-stu-id="41c89-156">Note that this resource group shouldn't include the subnets for each tier.</span></span> <span data-ttu-id="41c89-157">Назначьте роль DevOps этой группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="41c89-157">Assign the DevOps role to this resource group.</span></span>

### <a name="virtual-network-gateway-recommendations"></a><span data-ttu-id="41c89-158">Рекомендации по использованию шлюза виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="41c89-158">Virtual network gateway recommendations</span></span>

<span data-ttu-id="41c89-159">Локальный трафик поступает в виртуальную сеть через шлюз виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="41c89-159">On-premises traffic passes to the VNet through a virtual network gateway.</span></span> <span data-ttu-id="41c89-160">Рекомендуем использовать [VPN-шлюз Azure][guidance-vpn-gateway] или [шлюз Azure ExpressRoute][guidance-expressroute].</span><span class="sxs-lookup"><span data-stu-id="41c89-160">We recommend an [Azure VPN gateway][guidance-vpn-gateway] or an [Azure ExpressRoute gateway][guidance-expressroute].</span></span>

### <a name="nva-recommendations"></a><span data-ttu-id="41c89-161">Рекомендации по использованию виртуального сетевого модуля</span><span class="sxs-lookup"><span data-stu-id="41c89-161">NVA recommendations</span></span>

<span data-ttu-id="41c89-162">Модули NVA предоставляют различные службы для мониторинга сетевого трафика и управления им.</span><span class="sxs-lookup"><span data-stu-id="41c89-162">NVAs provide different services for managing and monitoring network traffic.</span></span> <span data-ttu-id="41c89-163">В [Azure Marketplace][azure-marketplace-nva] есть несколько модулей NVA сторонних поставщиков, которые можно использовать.</span><span class="sxs-lookup"><span data-stu-id="41c89-163">The [Azure Marketplace][azure-marketplace-nva] offers several third-party vendor NVAs that you can use.</span></span> <span data-ttu-id="41c89-164">Если ни один из таких модулей не соответствует вашим требованиям, вы можете создать пользовательский NVA с использованием виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="41c89-164">If none of these third-party NVAs meet your requirements, you can create a custom NVA using VMs.</span></span>

<span data-ttu-id="41c89-165">Например, при развертывании решений для этой эталонной архитектуры NVA реализуется на виртуальной машине с помощью следующих функций:</span><span class="sxs-lookup"><span data-stu-id="41c89-165">For example, the solution deployment for this reference architecture implements an NVA with the following functionality on a VM:</span></span>

- <span data-ttu-id="41c89-166">Трафик направляется в сетевые интерфейсы (NIC) для NVA с использованием [IP-переадресации][ip-forwarding].</span><span class="sxs-lookup"><span data-stu-id="41c89-166">Traffic is routed using [IP forwarding][ip-forwarding] on the NVA network interfaces (NICs).</span></span>
- <span data-ttu-id="41c89-167">Трафик пропускается через NVA, только если он соответствует определенным требованиям.</span><span class="sxs-lookup"><span data-stu-id="41c89-167">Traffic is permitted to pass through the NVA only if it is appropriate to do so.</span></span> <span data-ttu-id="41c89-168">Каждая виртуальная машина NVA в эталонной архитектуре — это простой маршрутизатор Linux.</span><span class="sxs-lookup"><span data-stu-id="41c89-168">Each NVA VM in the reference architecture is a simple Linux router.</span></span> <span data-ttu-id="41c89-169">Входящий трафик поступает в сетевой интерфейс *eth0*, а исходящий трафик, который соответствует правилам, определенным в пользовательских сценариях, подготавливается к отправке через сетевой интерфейс *eth1*.</span><span class="sxs-lookup"><span data-stu-id="41c89-169">Inbound traffic arrives on network interface *eth0*, and outbound traffic matches rules defined by custom scripts dispatched through network interface *eth1*.</span></span>
- <span data-ttu-id="41c89-170">Модули NVA можно настроить только из подсети управления.</span><span class="sxs-lookup"><span data-stu-id="41c89-170">The NVAs can only be configured from the management subnet.</span></span>
- <span data-ttu-id="41c89-171">Трафик, направленный в подсеть управления, не проходит через модули NVA.</span><span class="sxs-lookup"><span data-stu-id="41c89-171">Traffic routed to the management subnet does not pass through the NVAs.</span></span> <span data-ttu-id="41c89-172">Иначе при сбое NVA трафик не будет маршрутизироваться в подсеть управления для устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="41c89-172">Otherwise, if the NVAs fail, there would be no route to the management subnet to fix them.</span></span>
- <span data-ttu-id="41c89-173">Виртуальные машины NVA помещаются в [группу доступности][availability-set] за подсистемой балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="41c89-173">The VMs for the NVA are placed in an [availability set][availability-set] behind a load balancer.</span></span> <span data-ttu-id="41c89-174">UDR в подсети шлюза направляет запросы NVA в подсистему балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="41c89-174">The UDR in the gateway subnet directs NVA requests to the load balancer.</span></span>

<span data-ttu-id="41c89-175">Включите NVA уровня 7, чтобы завершать соединения приложений на уровне NVA и обеспечить поддержку соответствия серверным уровням.</span><span class="sxs-lookup"><span data-stu-id="41c89-175">Include a layer-7 NVA to terminate application connections at the NVA level and maintain affinity with the backend tiers.</span></span> <span data-ttu-id="41c89-176">Это гарантирует симметричное подключение, при котором ответный трафик с серверных уровней возвращается через NVA.</span><span class="sxs-lookup"><span data-stu-id="41c89-176">This guarantees symmetric connectivity, in which response traffic from the backend tiers returns through the NVA.</span></span>

<span data-ttu-id="41c89-177">Кроме того, можно последовательно подключить несколько NVA. При этом каждый модуль будет отвечать за определенную задачу безопасности.</span><span class="sxs-lookup"><span data-stu-id="41c89-177">Another option to consider is connecting multiple NVAs in series, with each NVA performing a specialized security task.</span></span> <span data-ttu-id="41c89-178">Это позволяет управлять каждой функцией обеспечения безопасности на основе отдельного модуля NVA.</span><span class="sxs-lookup"><span data-stu-id="41c89-178">This allows each security function to be managed on a per-NVA basis.</span></span> <span data-ttu-id="41c89-179">Например, NVA с брандмауэром можно последовательно разместить с NVA, в которых выполняются службы идентификации.</span><span class="sxs-lookup"><span data-stu-id="41c89-179">For example, an NVA implementing a firewall could be placed in series with an NVA running identity services.</span></span> <span data-ttu-id="41c89-180">Но упростив таким образом управление, можно добавить сетевые прыжки, что, в свою очередь, может привести к увеличению задержки. Поэтому убедитесь, что такой подход не влияет на производительность приложения.</span><span class="sxs-lookup"><span data-stu-id="41c89-180">The tradeoff for ease of management is the addition of extra network hops that may increase latency, so ensure that this doesn't affect your application's performance.</span></span>

### <a name="nsg-recommendations"></a><span data-ttu-id="41c89-181">Рекомендации по использованию групп безопасности сети</span><span class="sxs-lookup"><span data-stu-id="41c89-181">NSG recommendations</span></span>

<span data-ttu-id="41c89-182">VPN-шлюз предоставляет общедоступный IP-адрес для подключения к локальной сети.</span><span class="sxs-lookup"><span data-stu-id="41c89-182">The VPN gateway exposes a public IP address for the connection to the on-premises network.</span></span> <span data-ttu-id="41c89-183">Рекомендуем создать группу безопасности сети (NSG) для входящей подсети NVA с правилами блокировки трафика, который поступает не из локальной сети.</span><span class="sxs-lookup"><span data-stu-id="41c89-183">We recommend creating a network security group (NSG) for the inbound NVA subnet, with rules to block all traffic not originating from the on-premises network.</span></span>

<span data-ttu-id="41c89-184">Кроме того, желательно использовать NSG в каждой подсети, чтобы обеспечить второй уровень защиты от входящего трафика, который обходит неправильно настроенный или отключенный модуль NVA.</span><span class="sxs-lookup"><span data-stu-id="41c89-184">We also recommend NSGs for each subnet to provide a second level of protection against inbound traffic bypassing an incorrectly configured or disabled NVA.</span></span> <span data-ttu-id="41c89-185">Например, в подсети веб-уровня в эталонной архитектуре реализована группа NSG с правилом игнорирования всех запросов, кроме полученных из локальной (192.168.0.0/16) или виртуальной сети, и правило игнорирования всех запросов, которые поступают не через порт 80.</span><span class="sxs-lookup"><span data-stu-id="41c89-185">For example, the web tier subnet in the reference architecture implements an NSG with a rule to ignore all requests other than those received from the on-premises network (192.168.0.0/16) or the VNet, and another rule that ignores all requests not made on port 80.</span></span>

### <a name="internet-access-recommendations"></a><span data-ttu-id="41c89-186">Рекомендации по доступу к Интернету</span><span class="sxs-lookup"><span data-stu-id="41c89-186">Internet access recommendations</span></span>

<span data-ttu-id="41c89-187">[Принудительно туннелируйте][azure-forced-tunneling] весь исходящий интернет-трафик через локальную сеть, используя туннель VPN "сеть — сеть", и направляйте его в Интернет при помощи преобразования сетевых адресов (NAT).</span><span class="sxs-lookup"><span data-stu-id="41c89-187">[Force-tunnel][azure-forced-tunneling] all outbound Internet traffic through your on-premises network using the site-to-site VPN tunnel, and route to the Internet using network address translation (NAT).</span></span> <span data-ttu-id="41c89-188">Это позволяет предотвратить случайные утечки конфиденциальных данных, которые хранятся на уровне данных, и проводить проверку и аудит всего исходящего трафика.</span><span class="sxs-lookup"><span data-stu-id="41c89-188">This prevents accidental leakage of any confidential information stored in your data tier and allows inspection and auditing of all outgoing traffic.</span></span>

> [!NOTE]
> <span data-ttu-id="41c89-189">Не блокируйте интернет-трафик с уровней приложений полностью. Это помешает использовать на этих уровнях службы Azure PaaS, в которых используются общедоступные IP-адреса (например, журнал ведения диагностики виртуальной машины, скачивание расширений виртуальной машины и т. д.).</span><span class="sxs-lookup"><span data-stu-id="41c89-189">Don't completely block Internet traffic from the application tiers, as this will prevent these tiers from using Azure PaaS services that rely on public IP addresses, such as VM diagnostics logging, downloading of VM extensions, and other functionality.</span></span> <span data-ttu-id="41c89-190">Для диагностики в Azure также требуется, чтобы компоненты имели разрешение на чтение и запись в учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="41c89-190">Azure diagnostics also requires that components can read and write to an Azure Storage account.</span></span>

<span data-ttu-id="41c89-191">Убедитесь, что принудительное туннелирование исходящего интернет-трафика правильно реализовано.</span><span class="sxs-lookup"><span data-stu-id="41c89-191">Verify that outbound internet traffic is force-tunneled correctly.</span></span> <span data-ttu-id="41c89-192">Если вы используете VPN-подключение к [службе маршрутизации и удаленного доступа][routing-and-remote-access-service] на локальном сервере, примените такое средство, как [WireShark][wireshark]или [Microsoft Message Analyzer](https://www.microsoft.com/download/details.aspx?id=44226).</span><span class="sxs-lookup"><span data-stu-id="41c89-192">If you're using a VPN connection with the [routing and remote access service][routing-and-remote-access-service] on an on-premises server, use a tool such as [WireShark][wireshark] or [Microsoft Message Analyzer](https://www.microsoft.com/download/details.aspx?id=44226).</span></span>

### <a name="management-subnet-recommendations"></a><span data-ttu-id="41c89-193">Рекомендации по использованию подсетей управления</span><span class="sxs-lookup"><span data-stu-id="41c89-193">Management subnet recommendations</span></span>

<span data-ttu-id="41c89-194">В подсети управления есть сервер jumpbox, который осуществляет функции управления и мониторинга.</span><span class="sxs-lookup"><span data-stu-id="41c89-194">The management subnet contains a jumpbox that performs management and monitoring functionality.</span></span> <span data-ttu-id="41c89-195">Ограничьте выполнение всех задач управления безопасностью сервером jumpbox.</span><span class="sxs-lookup"><span data-stu-id="41c89-195">Restrict execution of all secure management tasks to the jumpbox.</span></span>

<span data-ttu-id="41c89-196">Не создавайте для него общедоступный IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="41c89-196">Do not create a public IP address for the jumpbox.</span></span> <span data-ttu-id="41c89-197">Вместо этого реализуйте один маршрут для доступа к jumpbox через входящий шлюз.</span><span class="sxs-lookup"><span data-stu-id="41c89-197">Instead, create one route to access the jumpbox through the incoming gateway.</span></span> <span data-ttu-id="41c89-198">Создайте такие правила NSG, чтобы подсеть управления отвечала только на запросы из разрешенных маршрутов.</span><span class="sxs-lookup"><span data-stu-id="41c89-198">Create NSG rules so the management subnet only responds to requests from the allowed route.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="41c89-199">Вопросы масштабируемости</span><span class="sxs-lookup"><span data-stu-id="41c89-199">Scalability considerations</span></span>

<span data-ttu-id="41c89-200">В эталонной архитектуре используется подсистема балансировки нагрузки для направления трафика из локальной сети в пул устройств NVA, которые маршрутизируют трафик.</span><span class="sxs-lookup"><span data-stu-id="41c89-200">The reference architecture uses a load balancer to direct on-premises network traffic to a pool of NVA devices, which route the traffic.</span></span> <span data-ttu-id="41c89-201">Модули NVA помещаются в [группу доступности][availability-set].</span><span class="sxs-lookup"><span data-stu-id="41c89-201">The NVAs are placed in an [availability set][availability-set].</span></span> <span data-ttu-id="41c89-202">Такой подход позволяет отслеживать пропускную способность NVA в динамике и добавлять устройства NVA при увеличении нагрузки.</span><span class="sxs-lookup"><span data-stu-id="41c89-202">This design allows you to monitor the throughput of the NVAs over time and add NVA devices in response to increases in load.</span></span>

<span data-ttu-id="41c89-203">VPN-шлюз с номером SKU стандартной производительности поддерживает постоянную пропускную способность до 100 Мбит/с.</span><span class="sxs-lookup"><span data-stu-id="41c89-203">The standard SKU VPN gateway supports sustained throughput of up to 100 Mbps.</span></span> <span data-ttu-id="41c89-204">Для шлюзов с номерами SKU высокой производительности этот показатель составляет200 Мбит/с.</span><span class="sxs-lookup"><span data-stu-id="41c89-204">The High Performance SKU provides up to 200 Mbps.</span></span> <span data-ttu-id="41c89-205">Для повышения пропускной способности рекомендуем выполнить обновление до шлюза ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="41c89-205">For higher bandwidths, consider upgrading to an ExpressRoute gateway.</span></span> <span data-ttu-id="41c89-206">ExpressRoute обеспечивает пропускную способность до 10 Гбит/с с меньшей задержкой, чем VPN-подключение.</span><span class="sxs-lookup"><span data-stu-id="41c89-206">ExpressRoute provides up to 10 Gbps bandwidth with lower latency than a VPN connection.</span></span>

<span data-ttu-id="41c89-207">Рекомендации по масштабируемости шлюзов Azure см. в статьях о реализации архитектуры гибридной сети при помощи [Azure и локальной VPN-сети][guidance-vpn-gateway-scalability] или [Azure ExpressRoute][guidance-expressroute-scalability].</span><span class="sxs-lookup"><span data-stu-id="41c89-207">For more information about the scalability of Azure gateways, see the scalability consideration section in [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-scalability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-scalability].</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="41c89-208">Вопросы доступности</span><span class="sxs-lookup"><span data-stu-id="41c89-208">Availability considerations</span></span>

<span data-ttu-id="41c89-209">Как уже упоминалось, в эталонной архитектуре используется пул устройств NVA за подсистемой балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="41c89-209">As mentioned, the reference architecture uses a pool of NVA devices behind a load balancer.</span></span> <span data-ttu-id="41c89-210">В подсистеме балансировки нагрузки для мониторинга каждого модуля NVA применяется зонд работоспособности. Все неработоспособные устройства NVA удаляются из пула.</span><span class="sxs-lookup"><span data-stu-id="41c89-210">The load balancer uses a health probe to monitor each NVA and will remove any unresponsive NVAs from the pool.</span></span>

<span data-ttu-id="41c89-211">Если для связи между виртуальной и локальной сетями вы используете Azure ExpressRoute, [настройте VPN-шлюз, чтобы обеспечить отработку отказа][ra-vpn-failover], если подключение ExpressRoute станет недоступным.</span><span class="sxs-lookup"><span data-stu-id="41c89-211">If you're using Azure ExpressRoute to provide connectivity between the VNet and on-premises network, [configure a VPN gateway to provide failover][ra-vpn-failover] if the ExpressRoute connection becomes unavailable.</span></span>

<span data-ttu-id="41c89-212">Рекомендации по поддержке доступности подключений VPN и ExpressRoute см. в статьях о реализации архитектуры гибридной сети при помощи [Azure и локальной VPN-сети][guidance-vpn-gateway-availability] или [Azure ExpressRoute][guidance-expressroute-availability].</span><span class="sxs-lookup"><span data-stu-id="41c89-212">For specific information on maintaining availability for VPN and ExpressRoute connections, see the availability considerations in [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-availability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-availability].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="41c89-213">Вопросы управляемости</span><span class="sxs-lookup"><span data-stu-id="41c89-213">Manageability considerations</span></span>

<span data-ttu-id="41c89-214">Все операции мониторинга для приложений и ресурсов должны выполняться на сервере jumpbox в подсети управления.</span><span class="sxs-lookup"><span data-stu-id="41c89-214">All application and resource monitoring should be performed by the jumpbox in the management subnet.</span></span> <span data-ttu-id="41c89-215">В зависимости от требований приложения в подсети управления могут понадобиться дополнительные ресурсы мониторинга.</span><span class="sxs-lookup"><span data-stu-id="41c89-215">Depending on your application requirements, you may need additional monitoring resources in the management subnet.</span></span> <span data-ttu-id="41c89-216">В таком случае доступ к этим ресурсам должен осуществляться через jumpbox.</span><span class="sxs-lookup"><span data-stu-id="41c89-216">If so, these resources should be accessed through the jumpbox.</span></span>

<span data-ttu-id="41c89-217">При разрыве подключения шлюза из локальной сети в Azure можно по-прежнему подключиться к jumpbox, развернув общедоступный IP-адрес, добавив его в jumpbox и установив удаленное подключение из Интернета.</span><span class="sxs-lookup"><span data-stu-id="41c89-217">If gateway connectivity from your on-premises network to Azure is down, you can still reach the jumpbox by deploying a public IP address, adding it to the jumpbox, and remoting in from the internet.</span></span>

<span data-ttu-id="41c89-218">В эталонной архитектуре подсеть каждого уровня защищена правилами NSG.</span><span class="sxs-lookup"><span data-stu-id="41c89-218">Each tier's subnet in the reference architecture is protected by NSG rules.</span></span> <span data-ttu-id="41c89-219">Вам может потребоваться правило, которое позволяет открыть порт 3389 для доступа по протоколу удаленного рабочего стола (RDP) на виртуальных машинах Windows или порт 22 для доступа по протоколу Secure Shell (SSH) на виртуальных машинах Linux.</span><span class="sxs-lookup"><span data-stu-id="41c89-219">You may need to create a rule to open port 3389 for remote desktop protocol (RDP) access on Windows VMs or port 22 for secure shell (SSH) access on Linux VMs.</span></span> <span data-ttu-id="41c89-220">Для других средств управления и мониторинга могут потребоваться правила, которые позволяют открыть дополнительные порты.</span><span class="sxs-lookup"><span data-stu-id="41c89-220">Other management and monitoring tools may require rules to open additional ports.</span></span>

<span data-ttu-id="41c89-221">Если вы используете ExpressRoute для подключения локального ЦОД к Azure, примените [набор средств подключения Azure (AzureCT)][azurect] для мониторинга и устранения неполадок с подключением.</span><span class="sxs-lookup"><span data-stu-id="41c89-221">If you're using ExpressRoute to provide the connectivity between your on-premises datacenter and Azure, use the [Azure Connectivity Toolkit (AzureCT)][azurect] to monitor and troubleshoot connection issues.</span></span>

<span data-ttu-id="41c89-222">Дополнительные сведения о мониторинге и администрировании подключений VPN и ExpressRoute см. в статьях о реализации архитектуры гибридной сети при помощи [Azure и локальной VPN-сети][guidance-vpn-gateway-manageability] или [Azure ExpressRoute][guidance-expressroute-manageability].</span><span class="sxs-lookup"><span data-stu-id="41c89-222">You can find additional information specifically aimed at monitoring and managing VPN and ExpressRoute connections in the articles [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-manageability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-manageability].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="41c89-223">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="41c89-223">Security considerations</span></span>

<span data-ttu-id="41c89-224">В этой эталонной архитектуре реализовано несколько уровней безопасности.</span><span class="sxs-lookup"><span data-stu-id="41c89-224">This reference architecture implements multiple levels of security.</span></span>

### <a name="routing-all-on-premises-user-requests-through-the-nva"></a><span data-ttu-id="41c89-225">Маршрутизация всех запросов пользователей локальной среды через модуль NVA</span><span class="sxs-lookup"><span data-stu-id="41c89-225">Routing all on-premises user requests through the NVA</span></span>

<span data-ttu-id="41c89-226">UDR в подсети шлюза блокирует все запросы пользователей, кроме полученных из локальной среды.</span><span class="sxs-lookup"><span data-stu-id="41c89-226">The UDR in the gateway subnet blocks all user requests other than those received from on-premises.</span></span> <span data-ttu-id="41c89-227">UDR передает допустимые запросы в модули NVA в частной промежуточной подсети. Отсюда запросы поступают в приложение, если это разрешается правилами NVA.</span><span class="sxs-lookup"><span data-stu-id="41c89-227">The UDR passes allowed requests to the NVAs in the private DMZ subnet, and these requests are passed on to the application if they are allowed by the NVA rules.</span></span> <span data-ttu-id="41c89-228">Можно добавить в UDR другие маршруты, но убедитесь, что они случайно не обходят модули NVA и не блокируют административный трафик, предназначенный для подсети управления.</span><span class="sxs-lookup"><span data-stu-id="41c89-228">You can add other routes to the UDR, but make sure they don't inadvertently bypass the NVAs or block administrative traffic intended for the management subnet.</span></span>

<span data-ttu-id="41c89-229">Подсистема балансировки нагрузки перед модулями NVA также выступает в роли устройства безопасности. Она игнорирует трафик, поступающий через порты, которые еще не открыты в правилах подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="41c89-229">The load balancer in front of the NVAs also acts as a security device by ignoring traffic on ports that are not open in the load balancing rules.</span></span> <span data-ttu-id="41c89-230">Подсистемы балансировки нагрузки в эталонной архитектуре прослушивают HTTP-запросы только в портах 80 и 443.</span><span class="sxs-lookup"><span data-stu-id="41c89-230">The load balancers in the reference architecture only listen for HTTP requests on port 80 and HTTPS requests on port 443.</span></span> <span data-ttu-id="41c89-231">Задокументируйте все дополнительные правила в подсистемах балансировки нагрузки и отслеживайте трафик на предмет проблем безопасности.</span><span class="sxs-lookup"><span data-stu-id="41c89-231">Document any additional rules that you add to the load balancers, and monitor traffic to ensure there are no security issues.</span></span>

### <a name="using-nsgs-to-blockpass-traffic-between-application-tiers"></a><span data-ttu-id="41c89-232">Использование групп NSG для блокировки или разрешения трафика между уровнями приложения</span><span class="sxs-lookup"><span data-stu-id="41c89-232">Using NSGs to block/pass traffic between application tiers</span></span>

<span data-ttu-id="41c89-233">Трафик между уровнями ограничен использованием групп NSG.</span><span class="sxs-lookup"><span data-stu-id="41c89-233">Traffic between tiers is restricted by using NSGs.</span></span> <span data-ttu-id="41c89-234">На уровне бизнес-логики блокируется весь трафик, который поступает не с веб-уровня, а на уровне данных блокируется весь трафик, который поступает не с уровня бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="41c89-234">The business tier blocks all traffic that doesn't originate in the web tier, and the data tier blocks all traffic that doesn't originate in the business tier.</span></span> <span data-ttu-id="41c89-235">Если вы планируете расширить правила NSG, чтобы разрешить более свободный доступ к этим уровням, учитывайте риски безопасности.</span><span class="sxs-lookup"><span data-stu-id="41c89-235">If you have a requirement to expand the NSG rules to allow broader access to these tiers, weigh these requirements against the security risks.</span></span> <span data-ttu-id="41c89-236">Каждый новый путь входящего трафика может привести к случайному или намеренному повреждению приложения либо утечке данных.</span><span class="sxs-lookup"><span data-stu-id="41c89-236">Each new inbound pathway represents an opportunity for accidental or purposeful data leakage or application damage.</span></span>

### <a name="devops-access"></a><span data-ttu-id="41c89-237">Права доступа DevOps</span><span class="sxs-lookup"><span data-stu-id="41c89-237">DevOps access</span></span>

<span data-ttu-id="41c89-238">Используйте [RBAC][rbac], чтобы ограничить операции для DevOps на каждом уровне.</span><span class="sxs-lookup"><span data-stu-id="41c89-238">Use [RBAC][rbac] to restrict the operations that DevOps can perform on each tier.</span></span> <span data-ttu-id="41c89-239">При предоставлении разрешений используйте [принцип минимальных привилегий][security-principle-of-least-privilege].</span><span class="sxs-lookup"><span data-stu-id="41c89-239">When granting permissions, use the [principle of least privilege][security-principle-of-least-privilege].</span></span> <span data-ttu-id="41c89-240">Ведите журнал всех административных операций и проводите регулярный аудит, чтобы следить за тем, все ли изменения конфигурации были запланированы.</span><span class="sxs-lookup"><span data-stu-id="41c89-240">Log all administrative operations and perform regular audits to ensure any configuration changes were planned.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="41c89-241">Развертывание решения</span><span class="sxs-lookup"><span data-stu-id="41c89-241">Deploy the solution</span></span>

<span data-ttu-id="41c89-242">В репозитории [GitHub][github-folder] есть шаблон развертывания эталонной архитектуры, для которого реализованы эти рекомендации.</span><span class="sxs-lookup"><span data-stu-id="41c89-242">A deployment for a reference architecture that implements these recommendations is available on [GitHub][github-folder].</span></span>

### <a name="prerequisites"></a><span data-ttu-id="41c89-243">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="41c89-243">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deploy-resources"></a><span data-ttu-id="41c89-244">Развертывание ресурсов</span><span class="sxs-lookup"><span data-stu-id="41c89-244">Deploy resources</span></span>

1. <span data-ttu-id="41c89-245">Перейдите в папку `/dmz/secure-vnet-hybrid` в репозитории эталонных архитектур на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="41c89-245">Navigate to the `/dmz/secure-vnet-hybrid` folder of the reference architectures GitHub repository.</span></span>

2. <span data-ttu-id="41c89-246">Выполните следующую команду:</span><span class="sxs-lookup"><span data-stu-id="41c89-246">Run the following command:</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource_group_name> -l <region> -p onprem.json --deploy
    ```

3. <span data-ttu-id="41c89-247">Выполните следующую команду:</span><span class="sxs-lookup"><span data-stu-id="41c89-247">Run the following command:</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource_group_name> -l <region> -p secure-vnet-hybrid.json --deploy
    ```

### <a name="connect-the-on-premises-and-azure-gateways"></a><span data-ttu-id="41c89-248">Подключение локальных шлюзов и шлюзов Azure</span><span class="sxs-lookup"><span data-stu-id="41c89-248">Connect the on-premises and Azure gateways</span></span>

<span data-ttu-id="41c89-249">На этом этапе вы подключите два шлюза локальной сети.</span><span class="sxs-lookup"><span data-stu-id="41c89-249">In this step, you will connect the two local network gateways.</span></span>

1. <span data-ttu-id="41c89-250">На портале Azure перейдите к созданной группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="41c89-250">In the Azure Portal, navigate to the resource group that you created.</span></span>

2. <span data-ttu-id="41c89-251">Найдите ресурс с именем `ra-vpn-vgw-pip` и скопируйте IP-адрес, который отображается в колонке **Обзор**.</span><span class="sxs-lookup"><span data-stu-id="41c89-251">Find the resource named `ra-vpn-vgw-pip` and copy the IP address shown in the **Overview** blade.</span></span>

3. <span data-ttu-id="41c89-252">Найдите ресурс с именем `onprem-vpn-lgw`.</span><span class="sxs-lookup"><span data-stu-id="41c89-252">Find the resource named `onprem-vpn-lgw`.</span></span>

4. <span data-ttu-id="41c89-253">Перейдите к колонке **Конфигурация**.</span><span class="sxs-lookup"><span data-stu-id="41c89-253">Click the **Configuration** blade.</span></span> <span data-ttu-id="41c89-254">В поле **IP-адрес** вставьте IP-адрес из шага 2.</span><span class="sxs-lookup"><span data-stu-id="41c89-254">Under **IP address**, paste in the IP address from step 2.</span></span>

    ![Снимок экрана, на котором показано поле "IP-адрес"](./images/local-net-gw.png)

5. <span data-ttu-id="41c89-256">Нажмите кнопку **Сохранить** и дождитесь завершения операции.</span><span class="sxs-lookup"><span data-stu-id="41c89-256">Click **Save** and wait for the operation to complete.</span></span> <span data-ttu-id="41c89-257">Это может занять около 5 минут.</span><span class="sxs-lookup"><span data-stu-id="41c89-257">It can take about 5 minutes.</span></span>

6. <span data-ttu-id="41c89-258">Найдите ресурс с именем `onprem-vpn-gateway1-pip`.</span><span class="sxs-lookup"><span data-stu-id="41c89-258">Find the resource named `onprem-vpn-gateway1-pip`.</span></span> <span data-ttu-id="41c89-259">Скопируйте IP-адрес, который отображается в колонке **Обзор**.</span><span class="sxs-lookup"><span data-stu-id="41c89-259">Copy the IP address shown in the **Overview** blade.</span></span>

7. <span data-ttu-id="41c89-260">Найдите ресурс с именем `ra-vpn-lgw`.</span><span class="sxs-lookup"><span data-stu-id="41c89-260">Find the resource named `ra-vpn-lgw`.</span></span>

8. <span data-ttu-id="41c89-261">Перейдите к колонке **Конфигурация**.</span><span class="sxs-lookup"><span data-stu-id="41c89-261">Click the **Configuration** blade.</span></span> <span data-ttu-id="41c89-262">В поле **IP-адрес** вставьте IP-адрес из шага 6.</span><span class="sxs-lookup"><span data-stu-id="41c89-262">Under **IP address**, paste in the IP address from step 6.</span></span>

9. <span data-ttu-id="41c89-263">Нажмите кнопку **Сохранить** и дождитесь завершения операции.</span><span class="sxs-lookup"><span data-stu-id="41c89-263">Click **Save** and wait for the operation to complete.</span></span>

10. <span data-ttu-id="41c89-264">Чтобы проверить подключение, перейдите к колонке **Подключения** для каждого шлюза.</span><span class="sxs-lookup"><span data-stu-id="41c89-264">To verify the connection, go to the **Connections** blade for each gateway.</span></span> <span data-ttu-id="41c89-265">Должно отображаться состояние **Подключено**.</span><span class="sxs-lookup"><span data-stu-id="41c89-265">The status should be **Connected**.</span></span>

### <a name="verify-that-network-traffic-reaches-the-web-tier"></a><span data-ttu-id="41c89-266">Проверка того, поступает ли трафик на веб-уровень</span><span class="sxs-lookup"><span data-stu-id="41c89-266">Verify that network traffic reaches the web tier</span></span>

1. <span data-ttu-id="41c89-267">На портале Azure перейдите к созданной группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="41c89-267">In the Azure Portal, navigate to the resource group that you created.</span></span>

2. <span data-ttu-id="41c89-268">Найдите ресурс с именем `int-dmz-lb`. Это подсистема балансировки нагрузки, размещенная перед частной промежуточной подсетью.</span><span class="sxs-lookup"><span data-stu-id="41c89-268">Find the resource named `int-dmz-lb`, which is the load balancer in front of the private DMZ.</span></span> <span data-ttu-id="41c89-269">Скопируйте частный IP-адрес в колонке **Обзор**.</span><span class="sxs-lookup"><span data-stu-id="41c89-269">Copy the private IP address from the **Overview** blade.</span></span>

3. <span data-ttu-id="41c89-270">Найдите виртуальную машину с именем `jb-vm1`.</span><span class="sxs-lookup"><span data-stu-id="41c89-270">Find the VM named `jb-vm1`.</span></span> <span data-ttu-id="41c89-271">Нажмите кнопку **Подключиться** и используйте удаленный рабочий стол, чтобы подключиться к виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="41c89-271">Click **Connect** and use Remote Desktop to connect to the VM.</span></span> <span data-ttu-id="41c89-272">Имя пользователя и пароль указываются в файле onprem.json.</span><span class="sxs-lookup"><span data-stu-id="41c89-272">The user name and password are specified in the onprem.json file.</span></span>

4. <span data-ttu-id="41c89-273">В сеансе удаленного рабочего стола откройте браузер и перейдите по IP-адресу из шага 2.</span><span class="sxs-lookup"><span data-stu-id="41c89-273">From the Remote Desktop Session, open a web browser and navigate to the IP address from step 2.</span></span> <span data-ttu-id="41c89-274">Вы увидите домашнюю страницу сервера Apache2 по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="41c89-274">You should see the default Apache2 server home page.</span></span>

## <a name="next-steps"></a><span data-ttu-id="41c89-275">Дополнительная информация</span><span class="sxs-lookup"><span data-stu-id="41c89-275">Next steps</span></span>

- <span data-ttu-id="41c89-276">Узнайте, как реализовать [промежуточную сеть между Azure и Интернетом](./secure-vnet-dmz.md).</span><span class="sxs-lookup"><span data-stu-id="41c89-276">Learn how to implement a [DMZ between Azure and the Internet](./secure-vnet-dmz.md).</span></span>
- <span data-ttu-id="41c89-277">Узнайте, как реализовать [архитектуру высокодоступной гибридной сети][ra-vpn-failover].</span><span class="sxs-lookup"><span data-stu-id="41c89-277">Learn how to implement a [highly available hybrid network architecture][ra-vpn-failover].</span></span>
- <span data-ttu-id="41c89-278">Дополнительные сведения об управлении безопасностью сети с помощью Azure см. в статье [Облачные службы Microsoft Cloud и сетевая безопасность][cloud-services-network-security].</span><span class="sxs-lookup"><span data-stu-id="41c89-278">For more information about managing network security with Azure, see [Microsoft cloud services and network security][cloud-services-network-security].</span></span>
- <span data-ttu-id="41c89-279">Подробные сведения о защите ресурсов в Azure см. в статье [Приступая к работе с безопасностью Microsoft Azure][getting-started-with-azure-security].</span><span class="sxs-lookup"><span data-stu-id="41c89-279">For detailed information about protecting resources in Azure, see [Getting started with Microsoft Azure security][getting-started-with-azure-security].</span></span>
- <span data-ttu-id="41c89-280">Дополнительные рекомендации по обеспечению безопасности при подключении шлюзов Azure см. в статьях о реализации архитектуры гибридной сети при помощи [Azure и локальной VPN-сети][guidance-vpn-gateway-security] или [Azure ExpressRoute][guidance-expressroute-security].</span><span class="sxs-lookup"><span data-stu-id="41c89-280">For additional details on addressing security concerns across an Azure gateway connection, see [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-security] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-security].</span></span>
- [<span data-ttu-id="41c89-281">Устранение неполадок с сетевым виртуальным модулем в Azure</span><span class="sxs-lookup"><span data-stu-id="41c89-281">Troubleshoot network virtual appliance issues in Azure</span></span>](/azure/virtual-network/virtual-network-troubleshoot-nva)

<!-- links -->

[availability-set]: /azure/virtual-machines/virtual-machines-windows-create-availability-set
[azurect]: https://github.com/Azure/NetworkMonitoring/tree/master/AzureCT
[azure-forced-tunneling]: https://azure.microsoft.com/en-gb/documentation/articles/vpn-gateway-forced-tunneling-rm/
[azure-marketplace-nva]: https://azuremarketplace.microsoft.com/marketplace/apps/category/networking
[cloud-services-network-security]: /azure/best-practices-network-security
[getting-started-with-azure-security]: /azure/security/azure-security-getting-started
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/dmz/secure-vnet-hybrid
[guidance-expressroute]: ../hybrid-networking/expressroute.md
[guidance-expressroute-availability]: ../hybrid-networking/expressroute.md#availability-considerations
[guidance-expressroute-manageability]: ../hybrid-networking/expressroute.md#manageability-considerations
[guidance-expressroute-security]: ../hybrid-networking/expressroute.md#security-considerations
[guidance-expressroute-scalability]: ../hybrid-networking/expressroute.md#scalability-considerations
[guidance-vpn-gateway]: ../hybrid-networking/vpn.md
[guidance-vpn-gateway-availability]: ../hybrid-networking/vpn.md#availability-considerations
[guidance-vpn-gateway-manageability]: ../hybrid-networking/vpn.md#manageability-considerations
[guidance-vpn-gateway-scalability]: ../hybrid-networking/vpn.md#scalability-considerations
[guidance-vpn-gateway-security]: ../hybrid-networking/vpn.md#security-considerations
[ip-forwarding]: /azure/virtual-network/virtual-networks-udr-overview#ip-forwarding
[ra-expressroute]: ../hybrid-networking/expressroute.md
[ra-n-tier]: ../virtual-machines-windows/n-tier.md
[ra-vpn]: ../hybrid-networking/vpn.md
[ra-vpn-failover]: ../hybrid-networking/expressroute-vpn-failover.md
[rbac]: /azure/active-directory/role-based-access-control-configure
[rbac-custom-roles]: /azure/active-directory/role-based-access-control-custom-roles
[routing-and-remote-access-service]: https://technet.microsoft.com/library/dd469790(v=ws.11).aspx
[security-principle-of-least-privilege]: https://msdn.microsoft.com/library/hdb58b2f(v=vs.110).aspx#Anchor_1
[udr-overview]: /azure/virtual-network/virtual-networks-udr-overview
[visio-download]: https://archcenter.blob.core.windows.net/cdn/dmz-reference-architectures.vsdx
[wireshark]: https://www.wireshark.org/
