---
title: Реализация сети периметра между Azure и Интернетом
description: Способы реализации защищенной гибридной сетевой архитектуры с доступом к Интернету в Azure.
author: telmosampaio
ms.date: 11/23/2016
pnp.series.title: Network DMZ
pnp.series.next: nva-ha
pnp.series.prev: secure-vnet-hybrid
cardTitle: DMZ between Azure and the Internet
ms.openlocfilehash: c88545b1fcae49b413e7e2b6ac5bd92d3fd3456d
ms.sourcegitcommit: c441fd165e6bebbbbbc19854ec6f3676be9c3b25
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2018
---
# <a name="dmz-between-azure-and-the-internet"></a>Сеть периметра между Azure и Интернетом

Эта эталонная архитектура представляет собой безопасную гибридную сеть, которая расширяет локальную сеть в Azure, а также принимает интернет-трафик. 

[![0]][0] 

*Скачайте [файл Visio][visio-download] этой архитектуры.*

Эта эталонная архитектура расширяет архитектуру, описанную в [DMZ between Azure and your on-premises datacenter][implementing-a-secure-hybrid-network-architecture] (Сеть периметра между Azure и локальным центром данных). Она добавляет открытую сеть периметра, обрабатывающую интернет-трафик, в дополнение к частной сети периметра, которая обрабатывает трафик из локальной сети. 

Типичные способы использования этой архитектуры:

* Гибридные приложения, в которых рабочие нагрузки выполняются частично локально и частично в Azure.
* Инфраструктура Azure, которая направляет входящий трафик из локальной среды и Интернета.

## <a name="architecture"></a>Архитектура

Архитектура состоит из следующих компонентов:

* **Общедоступный IP-адрес (PIP).** IP-адрес общедоступной конечной точки. Внешние пользователи, подключенные к Интернету, могут получить доступ к системе через этот адрес.
* **Виртуальный сетевой модуль (NVA).** Эта архитектура включает в себя отдельный пул NVA для исходящего трафика в Интернете.
* **Azure Load Balancer.** Все входящие интернет-запросы проходят через подсистему балансировки нагрузки и распространяются в NVA в общедоступной сети периметра.
* **Подсеть входящего трафика общедоступной сети периметра.** Эта подсеть принимает запросы от подсистемы балансировки нагрузки Azure. Входящие запросы передаются одному из NVA в общедоступной сети периметра.
* **Подсеть исходящего трафика общедоступной сети периметра.** Запросы, утвержденные виртуальным сетевым модулем, проходят через подсеть внутренней подсистемы балансировки нагрузки для веб-уровня.

## <a name="recommendations"></a>Рекомендации

Следующие рекомендации применимы для большинства ситуаций. Следуйте этим рекомендациям, если они не противоречат особым требованиям для вашего случая. 

### <a name="nva-recommendations"></a>Рекомендации по использованию виртуального сетевого модуля

Используйте разные наборы NVA для трафика в Интернете и трафика, создаваемого локальными системами. Использование только одного набора NVA в обоих случаях представляет угрозу безопасности, так как между двумя наборами сетевого трафика отсутствует периметр безопасности. Использование отдельных NVA упрощает проверку правил безопасности, а также позволяет понять, какие правила соответствуют определенным входящим сетевым запросам. Один набор NVA реализует правила для интернет-трафика, а другой — правила для локального трафика.

Включите NVA уровня 7, чтобы завершать соединения приложений на уровне NVA и обеспечить поддержку совместимости с серверными уровнями. Это гарантирует симметричное подключение, при котором ответный трафик из серверных уровней возвращается через NVA.  

### <a name="public-load-balancer-recommendations"></a>Рекомендации по использованию общедоступной подсистемы балансировки нагрузки

Для обеспечения масштабируемости и доступности развертывайте общедоступную сеть периметра NVA в [группе доступности][availability-set], а также распределяйте интернет-запросы по NVA в группе доступности с помощью [балансировщика нагрузки для Интернета][load-balancer].  

Настройте подсистему балансировки нагрузки для принятия запросов только на порты, необходимые для интернет-трафика. Например, ограничьте входящие HTTP-запросы на порт 80 и 443.

## <a name="scalability-considerations"></a>Вопросы масштабируемости

Даже если первоначально для архитектуры требуется один NVA в общедоступной сети периметра, мы рекомендуем сначала разместить подсистему балансировки нагрузки перед общедоступной сетью периметра. Это поможет упростить выполнение масштабирования для нескольких NVA в будущем.

## <a name="availability-considerations"></a>Вопросы доступности

Балансировщик нагрузки для Интернета требует, чтобы каждый NVA в подсети входящего трафика общедоступной сети периметра прошел [проверку работоспособности][lb-probe]. Проверка работоспособности, которая не отвечает на конечной точке, считается недоступной, из-за чего подсистема балансировки нагрузки будет направлять запросы к другим NVA в той же группе доступности. Обратите внимание, что если все NVA не отвечают, приложение не будет работать. Поэтому важно, чтобы были настроены уведомления на DevOps, когда число исправных экземпляров NVA падает ниже заданного порогового значения.

## <a name="manageability-considerations"></a>Вопросы управляемости

Все операции мониторинга и управления для NVA в общедоступной сети периметра должны выполняться в подсети управления с помощью jumpbox. Определите один сетевой маршрут из локальной сети через шлюз к jumpbox, чтобы ограничить доступ, как было сказано в статье [DMZ between Azure and your on-premises datacenter][implementing-a-secure-hybrid-network-architecture] (Сеть периметра между Azure и локальным центром данных).

При разрыве подключения шлюза из локальной сети в Azure можно по-прежнему подключиться к jumpbox путем развертывания общедоступного IP-адреса, добавив его в jumpbox и выполнив вход из Интернета.

## <a name="security-considerations"></a>Вопросы безопасности

Эта эталонная архитектура реализует несколько уровней безопасности:

* Балансировщик нагрузки для Интернета направляет запросы виртуальному сетевому модулю в подсеть входящего трафика общедоступной сети периметра и на порты, необходимые для приложения.
* Правила NSG для входящего и исходящего трафика подсетей общедоступной сети периметра предотвращают компрометацию NVA путем блокировки запросов, которые выходят за пределы правил NSG.
* Конфигурация маршрутизации NAT для NVA направляет входящие запросы к порту 80 и 443 в подсистему балансировки нагрузки веб-уровня. Однако запросы на остальных портах игнорируются.

Необходимо записывать входящие запросы на всех портах. Регулярно выполняйте аудит журналов, обращая внимание на запросы, которые выходят за пределы необходимых параметров, так как их появление может свидетельствовать о попытках вторжения.

## <a name="solution-deployment"></a>Развертывание решения

В репозитории [GitHub][github-folder] есть шаблон развертывания эталонной архитектуры, для которого реализованы эти рекомендации. Эталонную архитектуру можно развернуть с помощью виртуальных машин Windows или Linux, следуя приведенным ниже инструкциям:

1. Нажмите кнопку ниже:<br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fdmz%2Fsecure-vnet-dmz%2FvirtualNetwork.azuredeploy.json" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>
2. Ссылка откроется на портале Azure, где нужно задать значения для следующих параметров.
   * Имя **группы ресурсов** уже определено в файле параметров, поэтому выберите **Создать** и введите `ra-public-dmz-network-rg` в текстовом поле.
   * В раскрывающемся списке **Расположение** выберите регион.
   * Не изменяйте поля **Template Root Uri** (Корневой URI шаблона) или **Parameter Root Uri** (Корневой URI параметра).
   * В раскрывающемся списке в качестве **типа ОС** выберите **Windows** или **Linux**.
   * Прочтите условия использования и установите флажок **Я принимаю указанные выше условия**.
   * Нажмите кнопку **Приобрести**.
3. Дождитесь завершения развертывания.
4. Нажмите кнопку ниже:<br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fdmz%2Fsecure-vnet-dmz%2Fworkload.azuredeploy.json" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>
5. Ссылка откроется на портале Azure, где нужно задать значения для следующих параметров.
   * Имя **группы ресурсов** уже определено в файле параметров, поэтому выберите **Создать** и введите `ra-public-dmz-wl-rg` в текстовом поле.
   * В раскрывающемся списке **Расположение** выберите регион.
   * Не изменяйте поля **Template Root Uri** (Корневой URI шаблона) или **Parameter Root Uri** (Корневой URI параметра).
   * Прочтите условия использования и установите флажок **Я принимаю указанные выше условия**.
   * Нажмите кнопку **Приобрести**.
6. Дождитесь завершения развертывания.
7. Нажмите кнопку ниже:<br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fdmz%2Fsecure-vnet-dmz%2Fsecurity.azuredeploy.json" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>
8. Ссылка откроется на портале Azure, где нужно задать значения для следующих параметров.
   * Имя **группы ресурсов** уже определено в файле параметров, поэтому выберите **Использовать имеющийся** и введите `ra-public-dmz-network-rg` в текстовом поле.
   * В раскрывающемся списке **Расположение** выберите регион.
   * Не изменяйте поля **Template Root Uri** (Корневой URI шаблона) или **Parameter Root Uri** (Корневой URI параметра).
   * Прочтите условия использования и установите флажок **Я принимаю указанные выше условия**.
   * Нажмите кнопку **Приобрести**.
9. Дождитесь завершения развертывания.
10. В файлах параметров содержится жестко заданное имя пользователя с ролью "Администратор" и пароль для всех виртуальных машин. Мы настоятельно рекомендуем немедленно изменить эти параметры. Выберите их на портале Azure для каждой виртуальной машины в развертывании и нажмите кнопку **Сброс пароля** в колонке **Поддержка и устранение неполадок**. В раскрывающемся списке **Режим** выберите **Сбросить пароль** и введите новое **имя пользователя** и **пароль**. Чтобы сохранить изменения, нажмите кнопку **Обновить**.


[availability-set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/dmz/secure-vnet-dmz

[implementing-a-secure-hybrid-network-architecture]: ./secure-vnet-hybrid.md
[iptables]: https://help.ubuntu.com/community/IptablesHowTo
[lb-probe]: /azure/load-balancer/load-balancer-custom-probe-overview
[load-balancer]: /azure/load-balancer/load-balancer-Internet-overview
[network-security-group]: /azure/virtual-network/virtual-networks-nsg

[visio-download]: https://archcenter.blob.core.windows.net/cdn/dmz-reference-architectures.vsdx


[0]: ./images/dmz-public.png "Архитектура защищенной гибридной сети"
