---
title: "Реализация звездообразной топологии сети в Azure"
description: "Как реализовывать звездообразную топологию сети в Azure."
author: telmosampaio
ms.date: 05/05/2017
pnp.series.title: Implement a hub-spoke network topology in Azure
pnp.series.prev: expressroute
ms.openlocfilehash: e6f07a7962dd5728226b023700268340590d97a3
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
# <a name="implement-a-hub-spoke-network-topology-in-azure"></a>Реализация звездообразной топологии сети в Azure

На схеме эталонной архитектуры представлены сведения о том, как реализовать звездообразную топологию в Azure. *Концентратор* является виртуальной сетью в Azure, которая выступает в качестве центральной точки подключения к вашей локальной сети. *Периферийные зоны* — это виртуальные сети, которые устанавливают пиринг с концентратором и могут использоваться для изоляции рабочих нагрузок. Трафик передается между локальным центром обработки данных и концентратором через подключение ExpressRoute или VPN-шлюз.  [**Разверните это решение**](#deploy-the-solution).

![[0]][0]

*Скачайте [файл Visio][visio-download] этой архитектуры*


Преимущества этой топологии:

* **Сокращение затрат** путем централизации служб, которые могут совместно использоваться несколькими рабочими нагрузками, такими как сетевые виртуальные устройства (NVA) и DNS-серверы в одном расположении.
* **Превышение лимитов подписки** путем пиринга виртуальных сетей из разных подписок к центральному концентратору.
* **Разделение областей ответственности** между центральным ИТ-отделом (SecOps, InfraOps) и рабочими нагрузками (DevOps).

Типичные способы использования этой архитектуры:

* Рабочая нагрузка, развернутая в разных средах, например в среде для разработки, тестирования и в рабочей среде, для которых требуются общие службы, например DNS, IDS, NTP или AD DS. Общие службы размещаются в виртуальной сети концентратора, в то время как каждая среда развертывается в периферийной зоне для обеспечения изоляции.
* Рабочие нагрузки, которые не требуют подключения друг к другу, но требуют доступа к общим службам.
* Предприятия, которые требуют централизованного контроля над аспектами безопасности, такими как брандмауэр в концентраторе, таком как сеть периметра, и отдельного управления для рабочих нагрузок в каждой периферийной зоне.

## <a name="architecture"></a>Архитектура

Архитектура состоит из следующих компонентов.

* **Локальная сеть**. Частная локальная сеть, работающая внутри организации.

* **VPN-устройство**. Устройство или служба, предоставляющая возможность внешнего подключения к локальной сети. VPN-устройство может быть аппаратным устройством или программным решением, таким как служба маршрутизации и удаленного доступа (RRAS) в Windows Server 2012. Список поддерживаемых VPN-устройств и информацию о настройке выбранных VPN-устройств для подключения к Azure см. в статье [VPN-устройства и параметры IPsec/IKE для подключений типа "сеть — сеть" через VPN-шлюз][vpn-appliance].

* **Сетевой шлюз виртуальной сети VPN или шлюз ExpressRoute**. Шлюз виртуальной сети позволяет виртуальной сети подключаться к VPN-устройству или к каналу ExpressRoute, которые используются для подключения к вашей локальной сети. Дополнительные сведения см. в статье [Подключение локальной сети к виртуальной сети Microsoft Azure][connect-to-an-Azure-vnet].

> [!NOTE]
> В сценариях развертывания для этой эталонной архитектуры используется VPN-шлюз для подключения, а виртуальная сеть в Azure используется для имитации вашей локальной сети.

* **Виртуальная сеть концентратора**. Виртуальная сеть Azure используется в качестве концентратора в звездообразной топологии. Концентратор является центральной точкой подключения к вашей локальной сети и местом для размещения служб, которые могут использоваться различными рабочими нагрузками, размещенными в виртуальных сетях.

* **Подсеть шлюза**. Шлюзы виртуальных сетей хранятся в одной подсети.

* **Подсеть общих служб**. Подсеть в концентраторе виртуальной сети используется для размещения служб, которые могут использоваться совместно во всех периферийных зонах, например DNS или AD DS.

* **Виртуальные сети периферийных зон**. Одна или несколько виртуальных сетей Azure, которые используются в качестве периферийных зон в звездообразной топологии. Периферийные зоны можно использовать для изоляции рабочих нагрузок в их виртуальных сетях, управляемых отдельно от других периферийных зон. Каждая рабочая нагрузка может содержать несколько уровней с несколькими подсетями, подключенными через подсистемы балансировки нагрузки Azure. Дополнительные сведения об инфраструктуре приложений см. в статьях [Running Windows VM workloads][windows-vm-ra] (Выполнение рабочих нагрузок виртуальных машин Windows) и [Running Linux VM workloads][linux-vm-ra] (Выполнение рабочих нагрузок виртуальных машин Linux).

* **Пиринговая связь между виртуальными сетями**. Две виртуальные сети в одном регионе Azure можно подключить с помощью [пиринга][vnet-peering]. Пиринговые подключения представляют собой нетранзитивные подключения между виртуальными подсетями с низкой задержкой. После установки пирингового подключения виртуальные сети обмениваются трафиком по магистрали Azure без необходимости использования маршрутизатора. В звездообразной топологии сети пиринг виртуальной сети используется для подключения концентратора к каждой периферийной зоне.

> [!NOTE]
> В этой статье рассматриваются только [развертывания Resource Manager](/azure/azure-resource-manager/resource-group-overview), но вы также можете подключить классическую виртуальную сеть к виртуальной сети Resource Manager в той же подписке. Таким образом, ваши периферийные зоны могут размещать классические развертывания и по-прежнему пользоваться преимуществами общих служб в концентраторе.


## <a name="recommendations"></a>Рекомендации

Следующие рекомендации применимы для большинства ситуаций. Следуйте этим рекомендациям, если они не противоречат особым требованиям для вашего случая.

### <a name="resource-groups"></a>Группы ресурсов

Концентратор виртуальной сети и каждая периферийная зона виртуальной сети могут быть реализованы в разных группах ресурсов и даже в разных подписках, если они принадлежат одному и тому же клиенту Azure Active Directory (Azure AD) в одном регионе Azure. Это позволяет осуществлять децентрализованное управление каждой рабочей нагрузкой при совместном использовании служб, поддерживаемых в концентраторе виртуальной сети.

### <a name="vnet-and-gatewaysubnet"></a>Виртуальная сеть и подсеть шлюза

Создание подсети с именем *GatewaySubnet* с диапазоном адресов /27. Эта подсеть необходима для шлюза виртуальной сети. Выделение 32 адресов этой подсети поможет предотвратить достижение ограничения размера шлюза в будущем.

Дополнительные сведения о настройке шлюза см. в следующих статьях с данными об эталонных архитектурах в зависимости от типа подключения:

- [Connect an on-premises network to Azure using ExpressRoute][guidance-expressroute] (Подключение локальной сети к Azure с помощью ExpressRoute).
- [Connect an on-premises network to Azure using a VPN gateway][guidance-vpn] (Подключение локальной сети к Azure с помощью VPN-шлюза).

Для обеспечения высокой доступности вы можете использовать ExpressRoute вместе с VPN для отработки отказа. Ознакомьтесь со статьей [Connect an on-premises network to Azure using ExpressRoute with VPN failover][hybrid-ha] (Подключение локальной сети к Azure с помощью ExpressRoute с отработкой отказа VPN).

Звездообразная топология может также использоваться без шлюза, если вам не требуется связь с локальной сетью. 

### <a name="vnet-peering"></a>Пиринговая связь между виртуальными сетями

Пиринговая связь между виртуальными сетями — это нетранзитивная связь между двумя виртуальными сетями. Если вам требуется, чтобы периферийные зоны соединялись друг с другом, подумайте над добавлением отдельного пирингового подключения между ними.

Однако при наличии нескольких периферийных зон, которые требуется подключить между собой, очень скоро возникнет нехватка пиринговых подключений из-за ограничения [числа пиринговых подключений на каждую виртуальную сеть][vnet-peering-limit]. В этом случае рассмотрите возможность использования пользовательских маршрутов (UDR) для принудительной передачи трафика, предназначенного для периферийной зоны, на виртуальное сетевое устройство (NVA), выступающее в роли маршрутизатора в виртуальной сети концентратора. Это позволит периферийным зонам подключаться друг к другу.

Вы также можете настроить периферийные зоны для использования шлюза виртуальной сети концентратора для подключения к удаленным сетям. Чтобы разрешить передачу трафика шлюза из периферийной зоны в концентратор и подключение к удаленным сетям, требуется сделать следующее:

  - Настроить пиринговую связь между виртуальными сетями в концентраторе, чтобы **разрешить транзит шлюзов**.
  - Настроить пиринговое подключение виртуальной сети к каждой периферийной зоне для **использования удаленных шлюзов**.
  - Настроить все пиринговые соединения виртуальных сетей, чтобы **разрешить перенаправление трафика**.

## <a name="considerations"></a>Рекомендации

### <a name="spoke-connectivity"></a>Подключение периферийной зоны

Если вам требуется подключение между периферийными зонами, подумайте о внедрении виртуального сетевого устройства для маршрутизации в концентраторе и использовании определяемых пользователем маршрутов в периферийных зонах для направления трафика в концентратор.

![[2]][2]

В этом случае необходимо настроить пиринговые соединения, чтобы **разрешить перенаправленный трафик**.

### <a name="overcoming-vnet-peering-limits"></a>Преодоление ограничения пиринговых подключений виртуальной сети

Убедитесь, что вы учли [ограничение числа пиринговых подключений виртуальных сетей на одну виртуальную сеть][vnet-peering-limit] в Azure. Если вам нужно превысить лимит по периферийным зонам, подумайте о создании вложенной звездообразной топологии, где первый уровень периферийных зон также выступает в качестве концентраторов. Этот подход показан на схеме ниже.

![[3]][3]

Кроме того, следует учитывать, какие службы используются совместно в концентраторе, чтобы убедиться, что концентратор масштабируется в соответствии с большим количеством периферийных зон. Например, если ваш концентратор предоставляет службы брандмауэра, рассмотрите возможность ограничения пропускной способности решения брандмауэра при добавлении нескольких периферийных зон. Возможно, вам захочется перенести некоторые из этих общих служб на второй уровень концентраторов.

## <a name="deploy-the-solution"></a>Развертывание решения

Пример развертывания для этой архитектуры можно найти на портале [GitHub][ref-arch-repo]. В нем используются виртуальные машины Ubuntu в каждой виртуальной сети для проверки возможности подключения. В подсети **shared-services** в **виртуальной сети концентратора** нет настоящих служб.

### <a name="prerequisites"></a>Предварительные требования

Перед развертыванием эталонной архитектуры в собственной подписке необходимо выполнить следующие действия.

1. Клонируйте и скачайте ZIP-файл [с эталонными архитектурами AzureCAT][ref-arch-repo] в репозитории GitHub, а также выполните его разветвление.

2. Если вы предпочитаете использовать Azure CLI, убедитесь, что у вас на компьютере установлен Azure CLI 2.0. Чтобы установить CLI, следуйте инструкциям в статье об [установке Azure CLI 2.0][azure-cli-2].

3. Если вы предпочитаете использовать PowerShell, убедитесь, что на вашем компьютере установлен последний модуль PowerShell для Azure. Чтобы установить последнюю версию модуля Azure PowerShell, следуйте инструкциям в статье об [установке PowerShell для Azure][azure-powershell].

4. В командной строке, строке bash или строке PowerShell войдите в свою учетную запись Azure с помощью одной из приведенных ниже команд и следуйте инструкциям.

  ```bash
  az login
  ```

  ```powershell
  Login-AzureRmAccount
  ```

### <a name="deploy-the-simulated-on-premises-datacenter"></a>Развертывание имитации локального центра обработки данных

Чтобы развернуть имитацию локального центра обработки данных в виртуальной сети Azure, сделайте следующее.

1. Перейдите в папку `hybrid-networking\hub-spoke\onprem` репозитория, скачанного на предыдущем шаге.

2. Откройте файл `onprem.vm.parameters.json` и введите имя пользователя и пароль в кавычках в строках 11 и 12, как показано ниже, а затем сохраните файл.

  ```bash
  "adminUsername": "XXX",
  "adminPassword": "YYY",
  ```

3. Выполните следующую команду PowerShell или bash для развертывания имитации локальной среды в качестве виртуальной сети в Azure. Замените значения своей подпиской, именем группы ресурсов и регионом Azure.

  ```bash
  sh ./onprem.deploy.sh --subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx \
    --resourcegroup ra-onprem-rg \
    --location westus
  ```

  ```powershell
  ./onprem.deploy.ps1 -Subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx `
    -ResourceGroup ra-onprem-rg `
    -Location westus
  ```
  > [!NOTE]
  > Если вы решили использовать другое имя группы ресурсов (отличное от `ra-onprem-rg`), обязательно найдите все файлы параметров, которые используют это имя, и отредактируйте их, чтобы использовать собственное имя группы ресурсов.

4. Дождитесь завершения развертывания. При развертывании создается виртуальная сеть, виртуальная машина Ubuntu и VPN-шлюз. Создание VPN-шлюза может занять более 40 минут.

### <a name="azure-hub-vnet"></a>Виртуальная сеть концентратора Azure

Чтобы развернуть виртуальную сеть концентратора Azure и подключиться к имитации локальной виртуальной сети, созданной выше, сделайте следующее.

1. Перейдите в папку `hybrid-networking\hub-spoke\hub` репозитория, скачанного на предыдущем шаге.

2. Откройте файл `hub.vm.parameters.json` и введите имя пользователя и пароль в кавычках в строках 11 и 12, как показано ниже, а затем сохраните файл.

  ```bash
  "adminUsername": "XXX",
  "adminPassword": "YYY",
  ```

3. Откройте файл `hub.gateway.parameters.json` и введите общий ключ в кавычках в строке 23, как показано ниже, а затем сохраните файл. Сохраните это значение. Оно понадобится позже при развертывании.

  ```bash
  "sharedKey": "",
  ```

4. Выполните следующую команду PowerShell или bash для развертывания имитации локальной среды в качестве виртуальной сети в Azure. Замените значения своей подпиской, именем группы ресурсов и регионом Azure.

  ```bash
  sh ./hub.deploy.sh --subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx \
    --resourcegroup ra-hub-rg \
    --location westus
  ```

  ```powershell
  ./hub.deploy.ps1 -Subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx `
    -ResourceGroup ra-hub-rg `
    -Location westus
  ```
  > [!NOTE]
  > Если вы решили использовать другое имя группы ресурсов (отличное от `ra-hub-rg`), обязательно найдите все файлы параметров, которые используют это имя, и отредактируйте их, чтобы использовать собственное имя группы ресурсов.

5. Дождитесь завершения развертывания. При этом развертывании создается виртуальная сеть, виртуальная машина Ubuntu, VPN-шлюз и подключение к шлюзу, созданному в предыдущем разделе. Создание VPN-шлюза может занять более 40 минут.

### <a name="connection-from-on-premises-to-the-hub"></a>Подключение к концентратору из локальной среды

Чтобы подключиться из имитации локального центра обработки данных к виртуальной сети концентратора, сделайте следующее.

1. Перейдите в папку `hybrid-networking\hub-spoke\onprem` репозитория, скачанного на предыдущем шаге.

2. Откройте файл `onprem.connection.parameters.json` и введите общий ключ в кавычках в строке 9, как показано ниже, а затем сохраните файл. Это общее значение ключа должно быть таким же, как и в локальном шлюзе, который вы ранее развернули.

  ```bash
  "sharedKey": "",
  ```

3. Выполните следующую команду PowerShell или bash для развертывания имитации локальной среды в качестве виртуальной сети в Azure. Замените значения своей подпиской, именем группы ресурсов и регионом Azure.

  ```bash
  sh ./onprem.connection.deploy.sh --subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx \
    --resourcegroup ra-onprem-rg \
    --location westus
  ```

  ```powershell
  ./onprem.connection.deploy.ps1 -Subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx `
    -ResourceGroup ra-onprem-rg `
    -Location westus
  ```
  > [!NOTE]
  > Если вы решили использовать другое имя группы ресурсов (отличное от `ra-onprem-rg`), обязательно найдите все файлы параметров, которые используют это имя, и отредактируйте их, чтобы использовать собственное имя группы ресурсов.

4. Дождитесь завершения развертывания. При этом развертывании создается подключение между виртуальной сетью, используемой для имитации локального центра обработки данных, и виртуальной сетью концентратора.

### <a name="azure-spoke-vnets"></a>Виртуальные сети периферийных зон Azure

Чтобы развернуть виртуальные сети периферийных зон и подключиться к виртуальной сети концентратора, созданной выше, сделайте следующее.

1. Перейдите в папку `hybrid-networking\hub-spoke\spokes` репозитория, скачанного на предыдущем шаге.

2. Откройте файл `spoke1.web.parameters.json` и введите имя пользователя и пароль в кавычках в строках 53 и 54, как показано ниже, а затем сохраните файл.

  ```bash
  "adminUsername": "XXX",
  "adminPassword": "YYY",
  ```

3. Повторите предыдущий шаг для файла `spoke2.web.parameters.json`.

4. Запустите команду bash или PowerShell, указанную ниже, чтобы развернуть первую периферийную зону и подключить ее к концентратору. Замените значения своей подпиской, именем группы ресурсов и регионом Azure.

  ```bash
  sh ./spoke.deploy.sh --subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx \
    --resourcegroup ra-spoke1-rg \
    --location westus \
    --spoke 1
  ```

  ```powershell
  ./spoke.deploy.ps1 -Subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx `
    -ResourceGroup ra-spoke1-rg `
    -Location westus `
    -Spoke 1
  ```
  > [!NOTE]
  > Если вы решили использовать другое имя группы ресурсов (отличное от `ra-spoke1-rg`), обязательно найдите все файлы параметров, которые используют это имя, и отредактируйте их, чтобы использовать собственное имя группы ресурсов.

5. Дождитесь завершения развертывания. Это развертывание создает виртуальную сеть, подсистемы балансировки нагрузки с тремя виртуальными машинами, работающими под управлением Ubuntu и Apache, и виртуальное пиринговое подключение к концентратору виртуальной сети, созданной в предыдущем разделе. Это развертывание может занять более 20 минут.

6. Запустите команду bash или PowerShell, указанную ниже, чтобы развернуть первую периферийную зону и подключить ее к концентратору. Замените значения своей подпиской, именем группы ресурсов и регионом Azure.

  ```bash
  sh ./spoke.deploy.sh --subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx \
    --resourcegroup ra-spoke2-rg \
    --location westus \
    --spoke 2
  ```

  ```powershell
  ./spoke.deploy.ps1 -Subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx `
    -ResourceGroup ra-spoke2-rg `
    -Location westus `
    -Spoke 2
  ```
  > [!NOTE]
  > Если вы решили использовать другое имя группы ресурсов (отличное от `ra-spoke2-rg`), обязательно найдите все файлы параметров, которые используют это имя, и отредактируйте их, чтобы использовать собственное имя группы ресурсов.

5. Дождитесь завершения развертывания. Это развертывание создает виртуальную сеть, подсистемы балансировки нагрузки с тремя виртуальными машинами, работающими под управлением Ubuntu и Apache, и виртуальное пиринговое подключение к концентратору виртуальной сети, созданной в предыдущем разделе. Это развертывание может занять более 20 минут.

### <a name="azure-hub-vnet-peering-to-spoke-vnets"></a>Пиринговое подключение виртуальной сети концентратора Azure к виртуальным сетям периферийных зон

Чтобы развернуть пиринговые подключения виртуальной сети для виртуальной сети концентратора, сделайте следующее.

1. Перейдите в папку `hybrid-networking\hub-spoke\hub` репозитория, скачанного на предыдущем шаге.

2. Запустите команду bash или PowerShell, указанную ниже, чтобы развернуть пиринговое подключение к первой периферийной зоне. Замените значения своей подпиской, именем группы ресурсов и регионом Azure.

  ```bash
  sh ./hub.peering.deploy.sh --subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx \
    --resourcegroup ra-hub-rg \
    --location westus \
    --spoke 1
  ```

  ```powershell
  ./hub.peering.deploy.ps1 -Subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx `
    -ResourceGroup ra-hub-rg `
    -Location westus `
    -Spoke 1
  ```

2. Запустите команду bash или PowerShell, указанную ниже, чтобы развернуть пиринговое подключение ко второй периферийной зоне. Замените значения своей подпиской, именем группы ресурсов и регионом Azure.

  ```bash
  sh ./hub.peering.deploy.sh --subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx \
    --resourcegroup ra-hub-rg \
    --location westus \
    --spoke 2
  ```

  ```powershell
  ./hub.peering.deploy.ps1 -Subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx `
    -ResourceGroup ra-hub-rg `
    -Location westus `
    -Spoke 2
  ```

### <a name="test-connectivity"></a>Проверка подключения

Чтобы убедиться, что звездообразная топология, подключенная к локальному развертыванию центра обработки данных, работает, сделайте следующее.

1. На [портале Azure][портал] подключитесь к своей подписке и перейдите к виртуальной машине `ra-onprem-vm1` в группе ресурсов `ra-onprem-rg`.

2. В колонке `Overview` обратите внимание на значение `Public IP address` виртуальной машины.

3. Используйте SSH-клиент для подключения по указанному выше IP-адресу с использованием имени пользователя и пароля, указанных во время развертывания.

4. В командной строке на виртуальной машине, к которой вы подключились, выполните приведенную ниже команду, чтобы проверить подключение локальной виртуальной сети к виртуальной сети первой периферийной зоны.

  ```bash
  ping 10.1.1.37
  ```

### <a name="add-connectivity-between-spokes"></a>Добавление подключения между периферийными зонами

Если вы хотите, чтобы периферийные зоны подключались друг к другу, разверните определяемые пользователем маршруты для каждой периферийной зоны, которая перенаправляет трафик, предназначенный для других периферийных зон, в шлюз в виртуальной сети концентратора. Выполните следующие шаги, чтобы убедиться, что в настоящий момент вы не можете подключиться из одной периферийной зоны к другой, а затем снова разверните определяемые пользователем маршруты и проверьте подключение.

1. Повторите шаги 1–4 выше, если вы больше не подключены к виртуальной машине jumpbox.

2. Подключитесь к одному из веб-серверов в первой периферийной зоне.

  ```bash
  ssh 10.1.1.37
  ```

3. Проверьте подключение между первой и второй периферийными зонами. Оно должно завершиться ошибкой.

  ```bash
  ping 10.1.2.37
  ```

4. Перейдите обратно в командную строку компьютера.

5. Перейдите в папку `hybrid-networking\hub-spoke\spokes` репозитория, скачанного на предыдущем шаге.

6. Запустите команду bash или PowerShell, указанную ниже, чтобы развернуть определяемый пользователем маршрут в первой периферийной зоне. Замените значения своей подпиской, именем группы ресурсов и регионом Azure.

  ```bash
  sh ./spoke.udr.deploy.sh --subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx \
    --resourcegroup ra-spoke1-rg \
    --location westus \
    --spoke 1
  ```

  ```powershell
  ./spoke.udr.deploy.ps1 -Subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx `
    -ResourceGroup ra-spoke1-rg `
    -Location westus `
    -Spoke 1
  ```

7. Запустите команду bash или PowerShell, указанную ниже, чтобы развернуть определяемый пользователем маршрут во второй периферийной зоне. Замените значения своей подпиской, именем группы ресурсов и регионом Azure.

  ```bash
  sh ./spoke.udr.deploy.sh --subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx \
    --resourcegroup ra-spoke2-rg \
    --location westus \
    --spoke 2
  ```

  ```powershell
  ./spoke.udr.deploy.ps1 -Subscription xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx `
    -ResourceGroup ra-spoke2-rg `
    -Location westus `
    -Spoke 2
  ```

8. Вернитесь в окно терминала SSH.

9. Проверьте подключение между первой и второй периферийными зонами. Оно должно выполняться успешно.

  ```bash
  ping 10.1.2.37
  ```

<!-- links -->

[azure-cli-2]: /azure/install-azure-cli
[azure-powershell]: /powershell/azure/install-azure-ps?view=azuresmps-3.7.0
[azure-vpn-gateway]: /azure/vpn-gateway/vpn-gateway-about-vpngateways
[best-practices-security]: /azure/best-practices-network-securit
[connect-to-an-Azure-vnet]: https://technet.microsoft.com/library/dn786406.aspx
[guidance-expressroute]: ./expressroute.md
[guidance-vpn]: ./vpn.md
[linux-vm-ra]: ../virtual-machines-linux/index.md
[hybrid-ha]: ./expressroute-vpn-failover.md
[naming conventions]: /azure/guidance/guidance-naming-conventions
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[vnet-peering]: /azure/virtual-network/virtual-network-peering-overview
[vnet-peering-limit]: /azure/azure-subscription-service-limits#networking-limits
[vpn-appliance]: /azure/vpn-gateway/vpn-gateway-about-vpn-devices
[windows-vm-ra]: ../virtual-machines-windows/index.md

[visio-download]: https://archcenter.azureedge.net/cdn/hybrid-network-hub-spoke.vsdx
[ref-arch-repo]: https://github.com/mspnp/reference-architectures
[0]: ./images/hub-spoke.png "Звездообразная топология в Azure"
[1]: ./images/hub-spoke-gateway-routing.svg "Звездообразная топология в Azure с транзитивной маршрутизацией"
[2]: ./images/hub-spoke-no-gateway-routing.svg "Звездообразная топология в Azure с транзитивной маршрутизацией с использованием виртуального сетевого устройства (NVA)"
[3]: ./images/hub-spokehub-spoke.svg "Вложенная звездообразная топология в Azure"
[ARM-Templates]: https://azure.microsoft.com/documentation/articles/resource-group-authoring-templates/
