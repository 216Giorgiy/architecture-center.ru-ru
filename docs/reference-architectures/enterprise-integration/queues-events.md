---
title: Корпоративная интеграция с использованием очередей сообщений и событий
titleSuffix: Azure Reference Architectures
description: Рекомендуемая архитектура для реализации шаблона корпоративной интеграции с помощью Azure Logic Apps, Управления Azure API, Служебной шины Azure и Сетки событий Azure.
author: mattfarm
ms.reviewer: jonfan, estfan, LADocs
ms.topic: article
ms.date: 12/03/2018
ms.custom: integration-services
ms.openlocfilehash: 6357cb5015c8f10c0f4a8aa1b310ddbb38367004
ms.sourcegitcommit: a0a9981e7586bed8d876a54e055dea1e392118f8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2018
ms.locfileid: "53233869"
---
# <a name="enterprise-integration-on-azure-using-message-queues-and-events"></a><span data-ttu-id="4c6ae-103">Корпоративная интеграция в Azure с использованием очередей сообщений и событий</span><span class="sxs-lookup"><span data-stu-id="4c6ae-103">Enterprise integration on Azure using message queues and events</span></span>

<span data-ttu-id="4c6ae-104">В рамках этой эталонной архитектуры интегрируются внутренние системы предприятия и разделяются задачи между службами с помощью очередей сообщений и событий. Это повышает надежность и масштабируемость.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-104">This reference architecture integrates enterprise backend systems, using message queues and events to decouple services for greater scalability and reliability.</span></span> <span data-ttu-id="4c6ae-105">Серверные системы могут включать в себя системы "программное обеспечение как услуга" (SaaS), службы Azure и существующие веб-службы предприятия.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-105">The backend systems may include software as a service (SaaS) systems, Azure services, and existing web services in your enterprise.</span></span>

![Эталонная архитектура: корпоративная интеграция с использованием очередей и событий](./_images/enterprise-integration-queues-events.png)

## <a name="architecture"></a><span data-ttu-id="4c6ae-107">Архитектура</span><span class="sxs-lookup"><span data-stu-id="4c6ae-107">Architecture</span></span>

<span data-ttu-id="4c6ae-108">Показанная здесь архитектура основана на базовой архитектуре, описываемой в статье [Базовые сценарии корпоративной интеграции][basic-enterprise-integration].</span><span class="sxs-lookup"><span data-stu-id="4c6ae-108">The architecture shown here builds on a simpler architecture that is shown in [Basic enterprise integration][basic-enterprise-integration].</span></span> <span data-ttu-id="4c6ae-109">В архитектуре используется служба [Logic Apps][logic-apps] для оркестрации рабочих процессов и служба [управление API][apim] для создания каталогов API.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-109">That architecture uses [Logic Apps][logic-apps] to orchestrate workflows and [API Management][apim] to create catalogs of APIs.</span></span>

<span data-ttu-id="4c6ae-110">В этом варианте архитектуры добавлены два компонента, повышающих надежность и масштабируемость системы:</span><span class="sxs-lookup"><span data-stu-id="4c6ae-110">This version of the architecture adds two components that help make the system more reliable and scalable:</span></span>

- <span data-ttu-id="4c6ae-111">**[Служебная шина Azure][service-bus]**.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-111">**[Azure Service Bus][service-bus]**.</span></span> <span data-ttu-id="4c6ae-112">Это безопасный и надежный брокер сообщений.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-112">Service Bus is a secure, reliable message broker.</span></span>

- <span data-ttu-id="4c6ae-113">**[Сетка событий Azure][event-grid]**.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-113">**[Azure Event Grid][event-grid]**.</span></span> <span data-ttu-id="4c6ae-114">Это служба маршрутизации событий.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-114">Event Grid is an event routing service.</span></span> <span data-ttu-id="4c6ae-115">Она использует модель событий [публикация и подписка](../../patterns/publisher-subscriber.md) (pub/sub).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-115">It uses a [publish/subscribe](../../patterns/publisher-subscriber.md) (pub/sub) eventing model.</span></span>

<span data-ttu-id="4c6ae-116">Асинхронное взаимодействие с помощью брокера сообщений обеспечивает ряд преимуществ по сравнению с непосредственными синхронными вызовами к серверным службам:</span><span class="sxs-lookup"><span data-stu-id="4c6ae-116">Asynchronous communication using a message broker provides a number of advantages over making direct, synchronous calls to backend services:</span></span>

- <span data-ttu-id="4c6ae-117">Обеспечивает выравнивание нагрузки и способность справляться со скачками рабочих нагрузок с помощью [шаблона балансировки нагрузки на основе очередей](../../patterns/queue-based-load-leveling.md).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-117">Provides load-leveling to handle bursts in workloads, using the [Queue-Based Load Leveling pattern](../../patterns/queue-based-load-leveling.md).</span></span>
- <span data-ttu-id="4c6ae-118">Надежно отслеживает ход выполнения длительных рабочих процессов, состоящих из нескольких этапов или связанных с несколькими приложениями.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-118">Reliably tracks the progress of long-running workflows that involve multiple steps or multiple applications.</span></span>
- <span data-ttu-id="4c6ae-119">Способствует разделению задач между приложениями.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-119">Helps to decouple applications.</span></span>
- <span data-ttu-id="4c6ae-120">Интегрируется с существующими системами на основе сообщений.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-120">Integrates with existing message-based systems.</span></span>
- <span data-ttu-id="4c6ae-121">Позволяет формировать очередь заданий, если серверная система недоступна.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-121">Allows work to be queued when a backend system is not available.</span></span>

<span data-ttu-id="4c6ae-122">При использовании Сетки событий Azure различные компоненты системы могут реагировать на события по мере их возникновения. Выполнять опрос или планировать задачи не требуется.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-122">Event Grid enables the various components in the system to react to events as they happen, rather than relying on polling or scheduled tasks.</span></span> <span data-ttu-id="4c6ae-123">Как и в случае с очередью сообщений, Сетка событий Azure способствует разделению задач между приложениями и службами.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-123">As with a message queue, it helps decouple applications and services.</span></span> <span data-ttu-id="4c6ae-124">Приложение или служба публикует события, а все заинтересованные подписчики уведомляются о них.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-124">An application or service can publish events, and any interested subscribers will be notified.</span></span> <span data-ttu-id="4c6ae-125">Новые подписчики могут добавляться без обновления отправителя.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-125">New subscribers can be added without updating the sender.</span></span>

<span data-ttu-id="4c6ae-126">Многие службы Azure поддерживают отправку событий в Сетку событий Azure.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-126">Many Azure services support sending events to Event Grid.</span></span> <span data-ttu-id="4c6ae-127">Например, приложение логики может прослушивать событие при добавлении новых файлов в хранилище BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-127">For example, a logic app can listen for an event when new files are added to a blob store.</span></span> <span data-ttu-id="4c6ae-128">Эта архитектура позволяет реализовать реактивные рабочие процессы, когда при передаче файла или помещении сообщения в очередь запускается ряд процессов.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-128">This pattern enables reactive workflows, where uploading a file or putting a message on a queue kicks off a series of processes.</span></span> <span data-ttu-id="4c6ae-129">Процессы можно выполнять в параллельном режиме или в определенной последовательности.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-129">The processes might be executed in parallel or in a specific sequence.</span></span>

## <a name="recommendations"></a><span data-ttu-id="4c6ae-130">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="4c6ae-130">Recommendations</span></span>

<span data-ttu-id="4c6ae-131">Рекомендации, содержащиеся в статье [Базовые сценарии корпоративной интеграции][basic-enterprise-integration], касаются и этой архитектуры.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-131">The recommendations described in [Basic enterprise integration][basic-enterprise-integration] apply to this architecture.</span></span> <span data-ttu-id="4c6ae-132">Также применимы приведенные ниже рекомендации.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-132">The following recommendations also apply:</span></span>

### <a name="service-bus"></a><span data-ttu-id="4c6ae-133">Служебная шина Azure</span><span class="sxs-lookup"><span data-stu-id="4c6ae-133">Service Bus</span></span>

<span data-ttu-id="4c6ae-134">В Служебной шине доступны два режима доставки: *по запросу* и *принудительно*.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-134">Service Bus has two delivery modes, *pull* or *push*.</span></span> <span data-ttu-id="4c6ae-135">В модели по запросу получатель постоянно выполняет опрос на наличие новых сообщений.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-135">In the pull model, the receiver continuously polls for new messages.</span></span> <span data-ttu-id="4c6ae-136">Опрос может быть неэффективным, особенно при наличии множества очередей, каждая из которых получает несколько сообщений, или больших интервалов между сообщениями.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-136">Polling can be inefficient, especially if you have many queues that each receive a few messages, or if there a lot of time between messages.</span></span> <span data-ttu-id="4c6ae-137">В модели принудительной отправки при появлении новых сообщений Служебная шина отправляет их через Сетку событий.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-137">In the push model, Service Bus sends an event through Event Grid when there are new messages.</span></span> <span data-ttu-id="4c6ae-138">Получатель подписывается на событие.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-138">The receiver subscribes to the event.</span></span> <span data-ttu-id="4c6ae-139">Когда событие активируется, получатель извлекает следующий пакет сообщений из Служебной шины.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-139">When the event is triggered, the receiver pulls the next batch of messages from Service Bus.</span></span>

<span data-ttu-id="4c6ae-140">Если вы создаете приложение логики для получения сообщений из Служебной шины, рекомендуем использовать модель принудительной отправки, интегрированной с Сеткой событий Azure.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-140">When you create a logic app to consume Service Bus messages, we recommend using the push model with Event Grid integration.</span></span> <span data-ttu-id="4c6ae-141">Такой вариант часто более экономичен, так как приложению логики не нужно выполнять опрос Служебной шины.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-141">It's often more cost efficient, because the logic app doesn't need to poll Service Bus.</span></span> <span data-ttu-id="4c6ae-142">Дополнительные сведения см. в статье об [интеграции Служебной шины Azure со службой "Сетка событий"](/azure/service-bus-messaging/service-bus-to-event-grid-integration-concept).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-142">For more information, see [Azure Service Bus to Event Grid integration overview](/azure/service-bus-messaging/service-bus-to-event-grid-integration-concept).</span></span> <span data-ttu-id="4c6ae-143">Уведомления службы "Сетка событий Azure" сейчас доступны в Служебной шине Azure [ценовой категории "Премиум"](https://azure.microsoft.com/pricing/details/service-bus/).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-143">Currently, Service Bus [Premium tier](https://azure.microsoft.com/pricing/details/service-bus/) is required for Event Grid notifications.</span></span>

<span data-ttu-id="4c6ae-144">Используйте режим получения сообщений [PeekLock](/azure/service-bus-messaging/service-bus-messaging-overview#queues) для доступа к группе сообщений.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-144">Use [PeekLock](/azure/service-bus-messaging/service-bus-messaging-overview#queues) for accessing a group of messages.</span></span> <span data-ttu-id="4c6ae-145">При использовании PeekLock приложение логики может проверять каждое сообщение перед завершением или отменой.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-145">When you use PeekLock, the logic app can perform steps to validate each message before completing or abandoning the message.</span></span> <span data-ttu-id="4c6ae-146">Такой подход защищает от случайной потери сообщений.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-146">This approach protects against accidental message loss.</span></span>

### <a name="event-grid"></a><span data-ttu-id="4c6ae-147">Сетка событий Azure</span><span class="sxs-lookup"><span data-stu-id="4c6ae-147">Event Grid</span></span>

<span data-ttu-id="4c6ae-148">Когда активируется триггер службы "Сетка событий", это означает, что произошло *по крайней мере одно* событие.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-148">When an Event Grid trigger fires, it means *at least one* event happened.</span></span> <span data-ttu-id="4c6ae-149">Например, если приложение логики получает из Сетки событий триггеры сообщения из Служебной шины, скорее всего, для обработки доступно несколько сообщений.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-149">For example, when a logic app gets an Event Grid triggers for a Service Bus message, it should assume that several messages might be available to process.</span></span>

<span data-ttu-id="4c6ae-150">Служба "Сетка событий" использует бессерверную модель.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-150">Event Grid uses a serverless model.</span></span> <span data-ttu-id="4c6ae-151">Плата начисляется на основе количества операций (выполнения событий).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-151">Billing is calculated based on the number of operations (event executions).</span></span> <span data-ttu-id="4c6ae-152">Дополнительные сведения см. на странице [цен на службу "Сетка событий"](https://azure.microsoft.com/pricing/details/event-grid/).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-152">For more information, see [Event Grid pricing](https://azure.microsoft.com/pricing/details/event-grid/).</span></span> <span data-ttu-id="4c6ae-153">В настоящее время нет рекомендаций по уровню для службы "Сетка событий".</span><span class="sxs-lookup"><span data-stu-id="4c6ae-153">Currently, there are no tier considerations for Event Grid.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="4c6ae-154">Вопросы масштабируемости</span><span class="sxs-lookup"><span data-stu-id="4c6ae-154">Scalability considerations</span></span>

<span data-ttu-id="4c6ae-155">Служебная шина Azure уровня "Премиум" может горизонтально масштабировать число единиц обмена сообщениями для достижения более высокой масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-155">To achieve higher scalability, the Service Bus Premium tier can scale out the number of messaging units.</span></span> <span data-ttu-id="4c6ae-156">В конфигурациях уровня "Премиум" может быть одна, две или четыре единицы обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-156">Premium tier configurations can have one, two, or four messaging units.</span></span> <span data-ttu-id="4c6ae-157">Дополнительные сведения о масштабировании служебной шины см. в статье [Рекомендации по повышению производительности с помощью обмена сообщениями через служебную шину](/azure/service-bus-messaging/service-bus-performance-improvements).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-157">For more information about scaling Service Bus, see [Best practices for performance improvements by using Service Bus Messaging](/azure/service-bus-messaging/service-bus-performance-improvements).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="4c6ae-158">Вопросы доступности</span><span class="sxs-lookup"><span data-stu-id="4c6ae-158">Availability considerations</span></span>

<span data-ttu-id="4c6ae-159">См. соглашение об уровне обслуживания для каждой службы:</span><span class="sxs-lookup"><span data-stu-id="4c6ae-159">Review the SLA for each service:</span></span>

- <span data-ttu-id="4c6ae-160">[Соглашение об уровне обслуживания для службы управления API][apim-sla].</span><span class="sxs-lookup"><span data-stu-id="4c6ae-160">[API Management SLA][apim-sla]</span></span>
- <span data-ttu-id="4c6ae-161">[Соглашение об уровне обслуживания для Сетки событий Azure][event-grid-sla].</span><span class="sxs-lookup"><span data-stu-id="4c6ae-161">[Event Grid SLA][event-grid-sla]</span></span>
- <span data-ttu-id="4c6ae-162">[Соглашение об уровне обслуживания для Logic Apps][logic-apps-sla].</span><span class="sxs-lookup"><span data-stu-id="4c6ae-162">[Logic Apps SLA][logic-apps-sla]</span></span>
- <span data-ttu-id="4c6ae-163">[Соглашение об уровне обслуживания для Служебной шины Azure][sb-sla].</span><span class="sxs-lookup"><span data-stu-id="4c6ae-163">[Service Bus SLA][sb-sla]</span></span>

<span data-ttu-id="4c6ae-164">Для служебной шины Azure уровня "Премиум" рекомендуется реализовать геоизбыточное аварийное восстановление для отработки отказа при серьезном сбое.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-164">To enable failover if a serious outage occurs, consider implementing geo-disaster recovery in Service Bus Premium.</span></span> <span data-ttu-id="4c6ae-165">Дополнительные сведения см. в разделе [Географическое аварийное восстановление в служебной шине Azure](/azure/service-bus-messaging/service-bus-geo-dr).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-165">For more information, see [Azure Service Bus geo-disaster recovery](/azure/service-bus-messaging/service-bus-geo-dr).</span></span>

## <a name="security-considerations"></a><span data-ttu-id="4c6ae-166">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="4c6ae-166">Security considerations</span></span>

<span data-ttu-id="4c6ae-167">Защитите служебную шину с помощью подписанного URL-адреса (SAS).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-167">To secure Service Bus, use shared access signature (SAS).</span></span> <span data-ttu-id="4c6ae-168">Вы можете предоставить пользователю доступ к ресурсам Служебной шины Azure с определенными правами, используя [проверку подлинности на основе SAS](/azure/service-bus-messaging/service-bus-sas).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-168">You can grant a user access to Service Bus resources with specific rights by using [SAS authentication](/azure/service-bus-messaging/service-bus-sas).</span></span> <span data-ttu-id="4c6ae-169">Дополнительные сведения см. в разделе [Аутентификация и авторизация в служебной шине](/azure/service-bus-messaging/service-bus-authentication-and-authorization).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-169">For more information, see [Service Bus authentication and authorization](/azure/service-bus-messaging/service-bus-authentication-and-authorization).</span></span>

<span data-ttu-id="4c6ae-170">Если очередь служебной шины должна быть предоставлена ​​как конечная точка HTTP (чтобы разрешить публикацию новых сообщений), для ее защиты путем превращения в интерфейсную следует использовать службу управления API.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-170">If you need to expose a Service Bus queue as an HTTP endpoint, for example, to post new messages, use API Management to secure the queue by fronting the endpoint.</span></span> <span data-ttu-id="4c6ae-171">Затем при необходимости вы можете защитить конечную точку с помощью сертификатов или проверки подлинности OAuth.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-171">You can then secure the endpoint with certificates or OAuth authentication as appropriate.</span></span> <span data-ttu-id="4c6ae-172">Проще всего защитить конечную точку с помощью приложения логики с триггером HTTP-запросов и HTTP-ответов в качестве посредника.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-172">The easiest way to secure an endpoint is using a logic app with an HTTP request/response trigger as an intermediary.</span></span>

<span data-ttu-id="4c6ae-173">Служба "Сетка событий" защищает доставку событий с помощью кода проверки.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-173">The Event Grid service secures event delivery through a validation code.</span></span> <span data-ttu-id="4c6ae-174">Если вы используете события с помощью Logic Apps, проверка выполняется автоматически.</span><span class="sxs-lookup"><span data-stu-id="4c6ae-174">If you use Logic Apps to consume the event, validation is automatically performed.</span></span> <span data-ttu-id="4c6ae-175">Дополнительные сведения см. в разделе [Сетка событий: безопасность и проверка подлинности](/azure/event-grid/security-authentication).</span><span class="sxs-lookup"><span data-stu-id="4c6ae-175">For more information, see [Event Grid security and authentication](/azure/event-grid/security-authentication).</span></span>

[apim]: /azure/api-management
[apim-sla]: https://azure.microsoft.com/support/legal/sla/api-management/
[event-grid]: /azure/event-grid/
[event-grid-sla]: https://azure.microsoft.com/support/legal/sla/event-grid
[logic-apps]: /azure/logic-apps/logic-apps-overview
[logic-apps-sla]: https://azure.microsoft.com/support/legal/sla/logic-apps
[sb-sla]: https://azure.microsoft.com/support/legal/sla/service-bus/
[service-bus]: /azure/service-bus-messaging/
[basic-enterprise-integration]: ./basic-enterprise-integration.md
