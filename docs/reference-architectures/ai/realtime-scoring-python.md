---
title: Оценка моделей Python в режиме реального времени
titleSuffix: Azure Reference Architectures
description: Эта эталонная архитектура демонстрирует, как развернуть модель Python в качестве веб-службы в Azure для прогнозирования в реальном времени.
author: msalvaris
ms.date: 01/28/2019
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat-ai
ms.openlocfilehash: ba2d9a295e5a231f0ffca9e3cf2d53ace4deddfe
ms.sourcegitcommit: 1ee873aaf40010eb2a38314ac56974bc9e227736
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2019
ms.locfileid: "55141032"
---
# <a name="real-time-scoring-of-python-scikit-learn-and-deep-learning-models-on-azure"></a><span data-ttu-id="78365-103">Оценка в реальном времени моделей Python scikit-learn и глубокого обучения в Azure</span><span class="sxs-lookup"><span data-stu-id="78365-103">Real-time scoring of Python Scikit-Learn and deep learning models on Azure</span></span>

<span data-ttu-id="78365-104">Эта эталонная архитектура демонстрирует, как развернуть модель Python в качестве веб-службы в Azure для прогнозирования в реальном времени с помощью Службы машинного обучения Azure.</span><span class="sxs-lookup"><span data-stu-id="78365-104">This reference architecture shows how to deploy Python models as web services to make real-time predictions using the Azure Machine Learning service.</span></span> <span data-ttu-id="78365-105">Рассматриваются два сценария: развертывание обычных моделей Python и развертывание моделей глубокого обучения с определенными требованиями.</span><span class="sxs-lookup"><span data-stu-id="78365-105">Two scenarios are covered: deploying regular Python models, and the specific requirements of deploying deep learning models.</span></span> <span data-ttu-id="78365-106">Оба сценария используют показанную на рисунке архитектуру.</span><span class="sxs-lookup"><span data-stu-id="78365-106">Both scenarios use the architecture shown.</span></span>

<span data-ttu-id="78365-107">Два примера реализации этой архитектуры можно найти на сайте GitHub: один для [обычных моделей Python][github-python] и один для [моделей глубокого обучения][github-dl].</span><span class="sxs-lookup"><span data-stu-id="78365-107">Two reference implementations for this architecture are available on GitHub, one for [regular Python models][github-python] and one for [deep learning models][github-dl].</span></span>

![Схема архитектуры для оценки моделей Python в Azure в реальном времени](./_images/python-model-architecture.png)

## <a name="scenarios"></a><span data-ttu-id="78365-109">Сценарии</span><span class="sxs-lookup"><span data-stu-id="78365-109">Scenarios</span></span>

<span data-ttu-id="78365-110">Примеры реализации демонстрируют два сценария использования этой архитектуры.</span><span class="sxs-lookup"><span data-stu-id="78365-110">The reference implementations demonstrate two scenarios using this architecture.</span></span>

<span data-ttu-id="78365-111">**Сценарий 1: сопоставление часто задаваемых вопросов**.</span><span class="sxs-lookup"><span data-stu-id="78365-111">**Scenario 1: FAQ matching**.</span></span> <span data-ttu-id="78365-112">Этот сценарий демонстрирует, как развернуть модель сопоставления часто задаваемых вопросов в качестве веб-службы для прогнозирования вопросов пользователей.</span><span class="sxs-lookup"><span data-stu-id="78365-112">This scenario shows how to deploy a frequently asked questions (FAQ) matching model as a web service to provide predictions for user questions.</span></span> <span data-ttu-id="78365-113">В этом сценарии входными данными на схеме архитектуры служат текстовые строки, содержащие вопросы пользователей, сопоставляемые со списком часто задаваемых вопросов.</span><span class="sxs-lookup"><span data-stu-id="78365-113">For this scenario, "Input Data" in the architecture diagram refers to text strings containing user questions to match with a list of FAQs.</span></span> <span data-ttu-id="78365-114">В этом сценарии используется библиотека машинного обучения [scikit-learn][scikit] для Python, но также поддерживаются любые сценарии работы с моделями Python для прогнозирования в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="78365-114">This scenario is designed for the [scikit-learn][scikit] machine learning library for Python, but can be generalized to any scenario that uses Python models to make real-time predictions.</span></span>

<span data-ttu-id="78365-115">В этом сценарии используется набор данных вопросов Stack Overflow , которые содержат исходные вопросы, помеченные тегами JavaScript, дублирующиеся вопросы и ответы на них.</span><span class="sxs-lookup"><span data-stu-id="78365-115">This scenario uses a subset of Stack Overflow question data that includes original questions tagged as JavaScript, their duplicate questions, and their answers.</span></span> <span data-ttu-id="78365-116">В сценарии конвейер scikit-learn обучается прогнозировать возможность соответствия дублирующихся и исходных вопросов.</span><span class="sxs-lookup"><span data-stu-id="78365-116">It trains a scikit-learn pipeline to predict the match probability of a duplicate question with each of the original questions.</span></span> <span data-ttu-id="78365-117">Прогнозирование осуществляется в реальном времени с использованием конечной точки REST API.</span><span class="sxs-lookup"><span data-stu-id="78365-117">These predictions are made in real time using a REST API endpoint.</span></span>

<span data-ttu-id="78365-118">Архитектура предполагает такой алгоритм работы:</span><span class="sxs-lookup"><span data-stu-id="78365-118">The application flow for this architecture is as follows:</span></span>

1. <span data-ttu-id="78365-119">Обученная модель регистрируется в реестре моделей Машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="78365-119">The trained model is registered to the Machine Learning model registry.</span></span>
2. <span data-ttu-id="78365-120">Служба машинного обучения создает образ Docker, в который входят модель и скрипт оценки.</span><span class="sxs-lookup"><span data-stu-id="78365-120">The Machine Learning service creates a Docker image that includes the model and scoring script.</span></span>
3. <span data-ttu-id="78365-121">Решение "Машинное обучение" развертывает образ оценки в службе контейнеров Azure (AKS) в качестве веб-службы.</span><span class="sxs-lookup"><span data-stu-id="78365-121">Machine Learning deploys the scoring image on Azure Kubernetes Service (AKS) as a web service.</span></span>
4. <span data-ttu-id="78365-122">Клиент отправляет запрос HTTP POST с закодированными данными вопроса.</span><span class="sxs-lookup"><span data-stu-id="78365-122">The client sends an HTTP POST request with the encoded question data.</span></span>
5. <span data-ttu-id="78365-123">Веб-служба, созданная решением "Машинное обучение", извлекает из запроса вопрос.</span><span class="sxs-lookup"><span data-stu-id="78365-123">The web service created by Machine Learning extracts the question from the request.</span></span>
6. <span data-ttu-id="78365-124">Этот вопрос направляется в модель конвейера Scikit-learn для извлечения признаков и оценки.</span><span class="sxs-lookup"><span data-stu-id="78365-124">The question is sent to the Scikit-learn pipeline model for featurization and scoring.</span></span> 
7. <span data-ttu-id="78365-125">Затем клиенту возвращаются соответствующие вопросы и оценки из списка часто задаваемых вопросов.</span><span class="sxs-lookup"><span data-stu-id="78365-125">The matching FAQ questions with their scores are returned to the client.</span></span>

<span data-ttu-id="78365-126">Ниже приведен пример приложения, использующего полученные результаты:</span><span class="sxs-lookup"><span data-stu-id="78365-126">Here is a screenshot of the example app that consumes the results:</span></span>

![Снимок экрана с примером приложения](./_images/python-faq-matches.png)

<span data-ttu-id="78365-128">**Сценарий 2: классификация изображений.**</span><span class="sxs-lookup"><span data-stu-id="78365-128">**Scenario 2: Image classification**.</span></span> <span data-ttu-id="78365-129">Этот сценарий демонстрирует развертывание модели сверточной нейронной сети (CNN) в качестве веб-службы для прогнозной обработки изображений.</span><span class="sxs-lookup"><span data-stu-id="78365-129">This scenario shows how to deploy a Convolutional Neural Network (CNN) model as a web service to provide predictions on images.</span></span> <span data-ttu-id="78365-130">В этом сценарии входными данными на схеме архитектуры служат файлы изображений.</span><span class="sxs-lookup"><span data-stu-id="78365-130">For this scenario, "Input Data" in the architecture diagram refers to image files.</span></span> <span data-ttu-id="78365-131">Сети CNN весьма эффективны для выполнения таких задач компьютерного зрения, как классификация изображений и обнаружение объектов.</span><span class="sxs-lookup"><span data-stu-id="78365-131">CNNs are very effective in computer vision for tasks such as image classification and object detection.</span></span> <span data-ttu-id="78365-132">В этом сценарии используются платформы TensorFlow, Keras (с серверной частью TensorFlow) и PyTorch.</span><span class="sxs-lookup"><span data-stu-id="78365-132">This scenario is designed for the frameworks TensorFlow, Keras (with the TensorFlow back end), and PyTorch.</span></span> <span data-ttu-id="78365-133">Но также поддерживаются сценарии работы с моделью глубокого обучения для прогнозирования в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="78365-133">However, it can be generalized to any scenario that uses deep learning models to make real-time predictions.</span></span>

<span data-ttu-id="78365-134">В этом сценарии используется модель ResNet-152, обученная с помощью набора данных ImageNet -1K (1000 классов), для прогнозирования категории изображения (см. рисунок ниже).</span><span class="sxs-lookup"><span data-stu-id="78365-134">This scenario uses a pre-trained ResNet-152 model trained on ImageNet-1K (1,000 classes) dataset to predict which category (see figure below) an image belongs to.</span></span> <span data-ttu-id="78365-135">Прогнозирование осуществляется в реальном времени с использованием конечной точки REST API.</span><span class="sxs-lookup"><span data-stu-id="78365-135">These predictions are made in real time using a REST API endpoint.</span></span>

![Пример прогнозов](./_images/python-example-predictions.png)

<span data-ttu-id="78365-137">Модель глубокого обучения предполагает такой алгоритм работы:</span><span class="sxs-lookup"><span data-stu-id="78365-137">The application flow for the deep learning model is as follows:</span></span>

1. <span data-ttu-id="78365-138">Обученная модель глубокого обучения регистрируется в реестре моделей машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="78365-138">The deep learning model is registered to the Machine Learning model registry.</span></span>
2. <span data-ttu-id="78365-139">Служба машинного обучения создает образ Docker, в том числе модель и скрипт оценки.</span><span class="sxs-lookup"><span data-stu-id="78365-139">The Machine Learning service creates a docker image including the model and scoring script.</span></span>
3. <span data-ttu-id="78365-140">Решение "Машинное обучение" развертывает образ оценки в службе контейнеров Azure (AKS) в качестве веб-службы.</span><span class="sxs-lookup"><span data-stu-id="78365-140">Machine Learning deploys the scoring image on Azure Kubernetes Service (AKS) as a web service.</span></span>
4. <span data-ttu-id="78365-141">Клиент отправляет запрос HTTP POST с закодированными данными изображения.</span><span class="sxs-lookup"><span data-stu-id="78365-141">The client sends an HTTP POST request with the encoded image data.</span></span>
5. <span data-ttu-id="78365-142">Веб-служба, созданная решением "Машинное обучение", выполняет предварительную обработку данных образа и отправляет их в модель для оценки.</span><span class="sxs-lookup"><span data-stu-id="78365-142">The web service created by Machine Learning preprocesses the image data and sends it to the model for scoring.</span></span> 
6. <span data-ttu-id="78365-143">Затем клиенту возвращаются соответствующие категории и их оценки.</span><span class="sxs-lookup"><span data-stu-id="78365-143">The predicted categories with their scores are returned to the client.</span></span>

## <a name="architecture"></a><span data-ttu-id="78365-144">Архитектура</span><span class="sxs-lookup"><span data-stu-id="78365-144">Architecture</span></span>

<span data-ttu-id="78365-145">Архитектура состоит из следующих компонентов.</span><span class="sxs-lookup"><span data-stu-id="78365-145">This architecture consists of the following components.</span></span>

<span data-ttu-id="78365-146">**[Служба машинного обучения Azure][aml]**  — это облачная служба, которая используется для обучения, развертывания, автоматизации моделей машинного обучения и управления ими в предоставляемом облаком широком масштабе.</span><span class="sxs-lookup"><span data-stu-id="78365-146">**[Azure Machine Learning service][aml]** is a cloud service that is used to train, deploy, automate and manage machine learning models, all at the broad scale that the cloud provides.</span></span> <span data-ttu-id="78365-147">Она используется в этой архитектуре для развертывания моделей, а также для проверки подлинности, маршрутизации и балансировки нагрузки веб-службы.</span><span class="sxs-lookup"><span data-stu-id="78365-147">It is used in this architecture to manage the deployment of models as well as authentication, routing, and load balancing of the web service.</span></span>

<span data-ttu-id="78365-148">**[Виртуальная машина][vm]**.</span><span class="sxs-lookup"><span data-stu-id="78365-148">**[Virtual machine][vm]** (VM).</span></span> <span data-ttu-id="78365-149">Виртуальная машина показана в качестве примера локального или облачного устройства, способного отправлять запрос HTTP.</span><span class="sxs-lookup"><span data-stu-id="78365-149">The VM is shown as an example of a device &mdash; local or in the cloud &mdash; that can send an HTTP request.</span></span>

<span data-ttu-id="78365-150">**[Служба Azure Kubernetes][aks]** (AKS) используется для развертывания приложения в кластере Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="78365-150">**[Azure Kubernetes Service][aks]** (AKS) is used to deploy the application on a Kubernetes cluster.</span></span> <span data-ttu-id="78365-151">AKS упрощает развертывание и использование Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="78365-151">AKS simplifies the deployment and operations of Kubernetes.</span></span> <span data-ttu-id="78365-152">Кластер можно настроить с помощью виртуальных машин с обычным ЦП для обычных моделей Python или виртуальных машин с графическим процессором для моделей глубокого обучения.</span><span class="sxs-lookup"><span data-stu-id="78365-152">The cluster can be configured using CPU-only VMs for regular Python models or GPU-enabled VMs for deep learning models.</span></span>

<span data-ttu-id="78365-153">**[Реестр контейнеров Azure][acr]** предоставляет хранилище образов для всех типов развертываний контейнеров Docker, включая DC/OS, Docker Swarm и Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="78365-153">**[Azure Container Registry][acr]** enables storage of images for all types of Docker container deployments including DC/OS, Docker Swarm and Kubernetes.</span></span> <span data-ttu-id="78365-154">Образы оценки развертываются в виде контейнеров в службе контейнеров Azure и применяются для запуска скрипта оценки.</span><span class="sxs-lookup"><span data-stu-id="78365-154">The scoring images are deployed as containers on Azure Kubernetes Service and used to run the scoring script.</span></span> <span data-ttu-id="78365-155">Используемый здесь образ создается решением "Машинное обучение" на основе обученной модели и скрипта оценки, а затем помещается в реестр контейнеров Azure.</span><span class="sxs-lookup"><span data-stu-id="78365-155">The image used here is created by Machine Learning from the trained model and scoring script, and then is pushed to the Azure Container Registry.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="78365-156">Рекомендации по производительности</span><span class="sxs-lookup"><span data-stu-id="78365-156">Performance considerations</span></span>

<span data-ttu-id="78365-157">Пропускная способность является важным параметром для архитектур оценки в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="78365-157">For real-time scoring architectures, throughput performance becomes a dominant consideration.</span></span> <span data-ttu-id="78365-158">Принято считать, что для рабочей нагрузки обычных моделей Python достаточно обычных ЦП.</span><span class="sxs-lookup"><span data-stu-id="78365-158">For regular Python models, it's generally accepted that CPUs are sufficient to handle the workload.</span></span>

<span data-ttu-id="78365-159">Но для рабочих нагрузок моделей глубокого обучения, когда скорость имеет решающее значение, графические процессоры обеспечивают более высокую [производительность][gpus-vs-cpus] по сравнению с обычными ЦП.</span><span class="sxs-lookup"><span data-stu-id="78365-159">However for deep learning workloads, when speed is a bottleneck, GPUs generally provide better [performance][gpus-vs-cpus] compared to CPUs.</span></span> <span data-ttu-id="78365-160">Чтобы добиться производительности графического процессора, необходим кластер с большим количеством обычных ЦП.</span><span class="sxs-lookup"><span data-stu-id="78365-160">To match GPU performance using CPUs, a cluster with large number of CPUs is usually needed.</span></span>

<span data-ttu-id="78365-161">Обычные ЦП можно использовать в любом сценарии для этой архитектуры, но для моделей глубокого обучения графические процессоры обеспечивают гораздо более высокие значения пропускной способности по сравнению с кластером с обычными ЦП в рамках одного бюджета.</span><span class="sxs-lookup"><span data-stu-id="78365-161">You can use CPUs for this architecture in either scenario, but for deep learning models, GPUs provide significantly higher throughput values compared to a CPU cluster of similar cost.</span></span> <span data-ttu-id="78365-162">Для AKS реализована поддержка GPU, что является одним из преимуществ использования этой службы в описанной архитектуре.</span><span class="sxs-lookup"><span data-stu-id="78365-162">AKS supports the use of GPUs, which is one advantage of using AKS for this architecture.</span></span> <span data-ttu-id="78365-163">Кроме того, модели глубокого обучения обычно имеют большое количество параметров.</span><span class="sxs-lookup"><span data-stu-id="78365-163">Also, deep learning deployments typically use models with a high number of parameters.</span></span> <span data-ttu-id="78365-164">Использование GPU устраняет конкуренцию за ресурсы между моделью и веб-службой, что является проблемой при развертывании с обычными ЦП.</span><span class="sxs-lookup"><span data-stu-id="78365-164">Using GPUs prevents contention for resources between the model and the web service, which is an issue in CPU-only deployments.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="78365-165">Вопросы масштабируемости</span><span class="sxs-lookup"><span data-stu-id="78365-165">Scalability considerations</span></span>

<span data-ttu-id="78365-166">Для обычных моделей Python, в которых кластер AKS содержит виртуальные машины только с обычными ЦП, особое внимание следует уделить [масштабированию количества модулей pod][manually-scale-pods].</span><span class="sxs-lookup"><span data-stu-id="78365-166">For regular Python models, where the AKS cluster is provisioned with CPU-only VMs, take care when [scaling out the number of pods][manually-scale-pods].</span></span> <span data-ttu-id="78365-167">Целью является максимальное использование возможностей кластера.</span><span class="sxs-lookup"><span data-stu-id="78365-167">The goal is to fully utilize the cluster.</span></span> <span data-ttu-id="78365-168">Масштабирование зависит от запросов ЦП, а для модулей pod устанавливаются ограничения.</span><span class="sxs-lookup"><span data-stu-id="78365-168">Scaling depends on the CPU requests and limits defined for the pods.</span></span> <span data-ttu-id="78365-169">При работе через Kubernetes решение "Машинное обучение" также поддерживает [автомасштабирование pod][autoscale-pods] на основе данных об использовании ЦП и (или) других метрик.</span><span class="sxs-lookup"><span data-stu-id="78365-169">Machine Learning through Kubernetes also supports [pod autoscaling][autoscale-pods] based on CPU utilization or other metrics.</span></span> <span data-ttu-id="78365-170">[Средство автомасштабирования кластеров][autoscaler] (доступно в предварительной версии) может масштабировать узлы агентов на основе числа ожидающих модулей pod.</span><span class="sxs-lookup"><span data-stu-id="78365-170">The [cluster autoscaler][autoscaler] (in preview) can scale agent nodes based on the pending pods.</span></span>

<span data-ttu-id="78365-171">Ограничения на ресурсы для сценариев глубокого обучения, в которых используются виртуальные машины с графическими процессорами, предусматривают назначение каждому модулю pod одного графического процессора.</span><span class="sxs-lookup"><span data-stu-id="78365-171">For deep learning scenarios, using GPU-enabled VMs, resource limits on pods are such that one GPU is assigned to one pod.</span></span> <span data-ttu-id="78365-172">В зависимости от типа используемой виртуальной машины, вам нужно выполнить [масштабирование узлов кластера][scale-cluster] в соответствии с требованиями службы.</span><span class="sxs-lookup"><span data-stu-id="78365-172">Depending on the type of VM used, you must [scale the nodes of the cluster][scale-cluster] to meet the demand for the service.</span></span> <span data-ttu-id="78365-173">Это делается с помощью Azure CLI и kubectl.</span><span class="sxs-lookup"><span data-stu-id="78365-173">You can do this easily using the Azure CLI and kubectl.</span></span>

## <a name="monitoring-and-logging-considerations"></a><span data-ttu-id="78365-174">Мониторинг и ведение журнала запросов</span><span class="sxs-lookup"><span data-stu-id="78365-174">Monitoring and logging considerations</span></span>

### <a name="aks-monitoring"></a><span data-ttu-id="78365-175">Мониторинг AKS</span><span class="sxs-lookup"><span data-stu-id="78365-175">AKS monitoring</span></span>

<span data-ttu-id="78365-176">Чтобы отслеживать производительность AKS, используйте службу [Azure Monitor для контейнеров][monitor-containers].</span><span class="sxs-lookup"><span data-stu-id="78365-176">For visibility into AKS performance, use the [Azure Monitor for containers][monitor-containers] feature.</span></span> <span data-ttu-id="78365-177">Она позволяет собирать данные метрик памяти и процессора из контроллеров, узлов и контейнеров, доступных в Kubernetes, с помощью API метрик.</span><span class="sxs-lookup"><span data-stu-id="78365-177">It collects memory and processor metrics from controllers, nodes, and containers that are available in Kubernetes through the Metrics API.</span></span>

<span data-ttu-id="78365-178">При развертывании приложения отслеживайте кластер AKS, чтобы убедиться в том, что он работает должным образом, все узлы исправны, а модули pod запущены.</span><span class="sxs-lookup"><span data-stu-id="78365-178">While deploying your application, monitor the AKS cluster to make sure it's working as expected, all the nodes are operational, and all pods are running.</span></span> <span data-ttu-id="78365-179">Хотя можно использовать средство командной строки [kubectl][kubectl] для получения сведений о состоянии модулей pod, доступная в Kubernetes веб-панель мониторинга позволяет выполнять базовый мониторинг состояния кластера и управлять им.</span><span class="sxs-lookup"><span data-stu-id="78365-179">Although you can use the [kubectl][kubectl] command-line tool to retrieve pod status, Kubernetes also includes a web dashboard for basic monitoring of the cluster status and management.</span></span>

![Снимок экрана панели мониторинга Kubernetes](./_images/python-kubernetes-dashboard.png)

<span data-ttu-id="78365-181">Чтобы проверить общее состояние кластера и узлов, перейдите в раздел **Узлы** панели мониторинга Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="78365-181">To see the overall state of the cluster and nodes, go to the **Nodes** section of the Kubernetes dashboard.</span></span> <span data-ttu-id="78365-182">Если узел неактивен или произошел сбой, можно просмотреть журналы ошибок на этой странице.</span><span class="sxs-lookup"><span data-stu-id="78365-182">If a node is inactive or has failed, you can display the error logs from that page.</span></span> <span data-ttu-id="78365-183">В разделах **Объекты pod** и **Развертывания** содержатся сведения о количестве модулей и состоянии развертывания.</span><span class="sxs-lookup"><span data-stu-id="78365-183">Similarly, go to the **Pods** and **Deployments** sections for information about the number of pods and status of your deployment.</span></span>

### <a name="aks-logs"></a><span data-ttu-id="78365-184">Журналы AKS</span><span class="sxs-lookup"><span data-stu-id="78365-184">AKS logs</span></span>

<span data-ttu-id="78365-185">Все потоки stdout и stderr в AKS автоматически регистрируются в журналах модулей pod, содержащихся в кластере.</span><span class="sxs-lookup"><span data-stu-id="78365-185">AKS automatically logs all stdout/stderr to the logs of the pods in the cluster.</span></span> <span data-ttu-id="78365-186">Используйте kubectl, чтобы просмотреть их, а также журналы и события на уровне узла.</span><span class="sxs-lookup"><span data-stu-id="78365-186">Use kubectl to see these and also node-level events and logs.</span></span> <span data-ttu-id="78365-187">Дополнительные сведения см. в шагах по развертыванию.</span><span class="sxs-lookup"><span data-stu-id="78365-187">For details, see the deployment steps.</span></span>

<span data-ttu-id="78365-188">Используйте [Azure Monitor для контейнеров][monitor-containers] для сбора метрик и журналов с помощью контейнерной версии агента Log Analytics для Linux, который хранится в рабочей области Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="78365-188">Use [Azure Monitor for containers][monitor-containers] to collect metrics and logs through a containerized version of the Log Analytics agent for Linux, which is stored in your Log Analytics workspace.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="78365-189">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="78365-189">Security considerations</span></span>

<span data-ttu-id="78365-190">Благодаря [центру безопасности Azure][security-center] можно получить полное представление о состоянии безопасности ваших ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="78365-190">Use [Azure Security Center][security-center] to get a central view of the security state of your Azure resources.</span></span> <span data-ttu-id="78365-191">Центр безопасности отслеживает потенциальные проблемы безопасности, а также дает полное представление о работоспособности системы безопасности развертывания, хотя и не отслеживает состояние узлов агентов AKS.</span><span class="sxs-lookup"><span data-stu-id="78365-191">Security Center monitors potential security issues and provides a comprehensive picture of the security health of your deployment, although it doesn't monitor AKS agent nodes.</span></span> <span data-ttu-id="78365-192">Центр безопасности настраивается на уровне подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="78365-192">Security Center is configured per Azure subscription.</span></span> <span data-ttu-id="78365-193">Включите сбор данных безопасности, как описано в кратком руководстве [Переход подписки Azure на ценовую категорию центра безопасности "Стандартный"][get-started].</span><span class="sxs-lookup"><span data-stu-id="78365-193">Enable security data collection as described in [Onboard your Azure subscription to Security Center Standard][get-started].</span></span> <span data-ttu-id="78365-194">Когда сбор данных включен, центр безопасности автоматически проверяет все виртуальные машины, созданные для этой подписки.</span><span class="sxs-lookup"><span data-stu-id="78365-194">When data collection is enabled, Security Center automatically scans any VMs created under that subscription.</span></span>

<span data-ttu-id="78365-195">**Эксплуатация**.</span><span class="sxs-lookup"><span data-stu-id="78365-195">**Operations**.</span></span> <span data-ttu-id="78365-196">Чтобы входить в кластер AKS с помощью маркера проверки подлинности Azure Active Directory (Azure AD), настройте в AKS [проверку подлинности пользователей][aad-auth] с помощью Azure AD.</span><span class="sxs-lookup"><span data-stu-id="78365-196">To sign in to an AKS cluster using your Azure Active Directory (Azure AD) authentication token, configure AKS to use Azure AD for [user authentication][aad-auth].</span></span> <span data-ttu-id="78365-197">Администраторы кластера также могут настроить управление доступом на основе ролей (RBAC) для Kubernetes в зависимости от членства в группе каталогов или удостоверения пользователей.</span><span class="sxs-lookup"><span data-stu-id="78365-197">Cluster administrators can also configure Kubernetes role-based access control (RBAC) based on a user's identity or directory group membership.</span></span>

<span data-ttu-id="78365-198">Контролируйте доступ к развертываемым ресурсам Azure с помощью [RBAC][rbac].</span><span class="sxs-lookup"><span data-stu-id="78365-198">Use [RBAC][rbac] to control access to the Azure resources that you deploy.</span></span> <span data-ttu-id="78365-199">RBAC позволяет назначить роли авторизации участникам команды DevOps.</span><span class="sxs-lookup"><span data-stu-id="78365-199">RBAC lets you assign authorization roles to members of your DevOps team.</span></span> <span data-ttu-id="78365-200">Пользователю можно назначить несколько ролей. Можно также создать пользовательские роли, чтобы выборочно настроить [разрешения].</span><span class="sxs-lookup"><span data-stu-id="78365-200">A user can be assigned to multiple roles, and you can create custom roles for even more fine-grained [permissions].</span></span>

<span data-ttu-id="78365-201">**HTTPS**.</span><span class="sxs-lookup"><span data-stu-id="78365-201">**HTTPS**.</span></span> <span data-ttu-id="78365-202">Из соображений безопасности следует принудительно применять в приложении протокол HTTPS, перенаправляя все HTTP-запросы.</span><span class="sxs-lookup"><span data-stu-id="78365-202">As a security best practice, the application should enforce HTTPS and redirect HTTP requests.</span></span> <span data-ttu-id="78365-203">Используйте [контроллер входящего трафика][ingress-controller], чтобы развернуть обратный прокси-сервер, который завершает SSL и перенаправляет HTTP-запросы.</span><span class="sxs-lookup"><span data-stu-id="78365-203">Use an [ingress controller][ingress-controller] to deploy a reverse proxy that terminates SSL and redirects HTTP requests.</span></span> <span data-ttu-id="78365-204">Дополнительные сведения см. в статье [Создание контроллера входящего трафика HTTPS в Службе Azure Kubernetes (AKS)][https-ingress].</span><span class="sxs-lookup"><span data-stu-id="78365-204">For more information, see [Create an HTTPS ingress controller on Azure Kubernetes Service (AKS)][https-ingress].</span></span>

<span data-ttu-id="78365-205">**Проверка подлинности**.</span><span class="sxs-lookup"><span data-stu-id="78365-205">**Authentication**.</span></span> <span data-ttu-id="78365-206">Это решение не ограничивает доступ к конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="78365-206">This solution doesn't restrict access to the endpoints.</span></span> <span data-ttu-id="78365-207">Чтобы развернуть эту архитектуру в среде предприятия, защитите конечные точки с помощью ключей API и добавьте в клиентское приложение предпочитаемую процедуру аутентификации пользователей.</span><span class="sxs-lookup"><span data-stu-id="78365-207">To deploy the architecture in an enterprise setting, secure the endpoints through API keys and add some form of user authentication to the client application.</span></span>

<span data-ttu-id="78365-208">**Реестр контейнеров**.</span><span class="sxs-lookup"><span data-stu-id="78365-208">**Container registry**.</span></span> <span data-ttu-id="78365-209">Это решение использует для хранения образа Docker общедоступный реестр контейнеров Azure.</span><span class="sxs-lookup"><span data-stu-id="78365-209">This solution uses Azure Container Registry to store the Docker image.</span></span> <span data-ttu-id="78365-210">Код, от которого зависит приложение, и модель содержатся в этом образе.</span><span class="sxs-lookup"><span data-stu-id="78365-210">The code that the application depends on, and the model, are contained within this image.</span></span> <span data-ttu-id="78365-211">Корпоративные приложения должны использовать частный реестр, обеспечивающий защиту от выполнения вредоносного кода и компрометации хранящейся в контейнере информации.</span><span class="sxs-lookup"><span data-stu-id="78365-211">Enterprise applications should use a private registry to help guard against running malicious code and to help keep the information inside the container from being compromised.</span></span>

<span data-ttu-id="78365-212">**Защита от атак DDoS.**</span><span class="sxs-lookup"><span data-stu-id="78365-212">**DDoS protection**.</span></span> <span data-ttu-id="78365-213">Рассмотрите возможность подключения [Защиты от атак DDoS ценовой категории "Стандартный"][ddos].</span><span class="sxs-lookup"><span data-stu-id="78365-213">Consider enabling [DDoS Protection Standard][ddos].</span></span> <span data-ttu-id="78365-214">Хотя платформа Azure и обеспечивает базовую защиту от атак DDoS, возможности Защиты Azure от атак DDoS ценовой категории "Стандартный" по снижению рисков атак специально оптимизированы для виртуальных сетевых ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="78365-214">Although basic DDoS protection is enabled as part of the Azure platform, DDoS Protection Standard provides mitigation capabilities that are tuned specifically to Azure virtual network resources.</span></span>

<span data-ttu-id="78365-215">**Ведение журналов.**</span><span class="sxs-lookup"><span data-stu-id="78365-215">**Logging**.</span></span> <span data-ttu-id="78365-216">Следуйте рекомендациям при сохранении данных журнала, например, выполняйте очистку пользовательских паролей и других данных, которые могут использоваться в мошеннических целях.</span><span class="sxs-lookup"><span data-stu-id="78365-216">Use best practices before storing log data, such as scrubbing user passwords and other information that could be used to commit security fraud.</span></span>

## <a name="deployment"></a><span data-ttu-id="78365-217">Развертывание</span><span class="sxs-lookup"><span data-stu-id="78365-217">Deployment</span></span>

<span data-ttu-id="78365-218">Для развертывания этой эталонной архитектуры, выполните действия, описанные в репозитории GitHub:</span><span class="sxs-lookup"><span data-stu-id="78365-218">To deploy this reference architecture, follow the steps described in the GitHub repos:</span></span>

- <span data-ttu-id="78365-219">[Обычные модели Python][github-python];</span><span class="sxs-lookup"><span data-stu-id="78365-219">[Regular Python models][github-python]</span></span>
- <span data-ttu-id="78365-220">[Модели машинного обучения][github-dl].</span><span class="sxs-lookup"><span data-stu-id="78365-220">[Deep learning models][github-dl]</span></span>

<!-- links -->

[aad-auth]: /azure/aks/aad-integration
[acr]: /azure/container-registry/
[something]: https://kubernetes.io/docs/reference/access-authn-authz/authentication/
[aks]: /azure/aks/intro-kubernetes
[autoscaler]: /azure/aks/autoscaler
[autoscale-pods]: /azure/aks/tutorial-kubernetes-scale#autoscale-pods
[azcopy]: /azure/storage/common/storage-use-azcopy-linux
[ddos]: /azure/virtual-network/ddos-protection-overview
[get-started]: /azure/security-center/security-center-get-started
[github-python]: https://github.com/Microsoft/MLAKSDeployAML
[github-dl]: https://github.com/Microsoft/AKSDeploymentTutorial_AML
[gpus-vs-cpus]: https://azure.microsoft.com/en-us/blog/gpus-vs-cpus-for-deployment-of-deep-learning-models/
[https-ingress]: /azure/aks/ingress-tls
[ingress-controller]: https://kubernetes.io/docs/concepts/services-networking/ingress/
[kubectl]: https://kubernetes.io/docs/tasks/tools/install-kubectl/
[aml]: /azure/machine-learning/service/overview-what-is-azure-ml
[manually-scale-pods]: /azure/aks/tutorial-kubernetes-scale#manually-scale-pods
[monitor-containers]: /azure/monitoring/monitoring-container-insights-overview
[разрешения]: /azure/aks/concepts-identity
[permissions]: /azure/aks/concepts-identity
[rbac]: /azure/active-directory/role-based-access-control-what-is
[scale-cluster]: /azure/aks/scale-cluster
[scikit]: https://pypi.org/project/scikit-learn/
[security-center]: /azure/security-center/security-center-intro
[vm]: /azure/virtual-machines/
