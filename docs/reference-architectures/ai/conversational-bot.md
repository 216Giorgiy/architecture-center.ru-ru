---
title: Разработка чат-бота корпоративного уровня
description: Сведения о создании чат-бота корпоративного уровня с помощью Azure Bot Framework.
author: roalexan
ms.date: 01/24/2019
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat-ai
ms.openlocfilehash: 0f5de0eca6fbd35cca1a0e8443f363df09ffc6aa
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2019
ms.locfileid: "58248699"
---
# <a name="enterprise-grade-conversational-bot"></a><span data-ttu-id="f4769-103">Чат-бот корпоративного уровня</span><span class="sxs-lookup"><span data-stu-id="f4769-103">Enterprise-grade conversational bot</span></span>

<span data-ttu-id="f4769-104">Эта эталонная архитектура описывает процесс создания чат-бота корпоративного уровня с помощью [Azure Bot Framework][bot-framework].</span><span class="sxs-lookup"><span data-stu-id="f4769-104">This reference architecture describes how to build an enterprise-grade conversational bot (chatbot) using the [Azure Bot Framework][bot-framework].</span></span> <span data-ttu-id="f4769-105">Все боты отличаются друг от друга, но при работе с ними важно знать ряд распространенных шаблонов, рабочих процессов и технологий.</span><span class="sxs-lookup"><span data-stu-id="f4769-105">Each bot is different, but there are some common patterns, workflows, and technologies to be aware of.</span></span> <span data-ttu-id="f4769-106">Это особенно важно для ботов, которые обслуживают корпоративные рабочие нагрузки, ведь помимо основных функций существует много рекомендаций по проектированию.</span><span class="sxs-lookup"><span data-stu-id="f4769-106">Especially for a bot to serve enterprise workloads, there are many design considerations beyond just the core functionality.</span></span> <span data-ttu-id="f4769-107">В этой статье рассматриваются наиболее важные аспекты разработки и некоторые средства, которые позволяют создать надежные, безопасные и активно обучающиеся боты.</span><span class="sxs-lookup"><span data-stu-id="f4769-107">This article covers the most essential design aspects, and introduces the tools needed to build a robust, secure, and actively learning bot.</span></span>

<span data-ttu-id="f4769-108">[![Схема архитектуры][0]][0]</span><span class="sxs-lookup"><span data-stu-id="f4769-108">[![Diagram of the architecture][0]][0]</span></span>

<span data-ttu-id="f4769-109">Лучшие примеры служебных с открытым кодом, используемые в этой архитектуре, доступны на [GitHub][git-repo-base].</span><span class="sxs-lookup"><span data-stu-id="f4769-109">The best practice utility samples used in this architecture are fully open-sourced and available on [GitHub][git-repo-base].</span></span> 

## <a name="architecture"></a><span data-ttu-id="f4769-110">Архитектура</span><span class="sxs-lookup"><span data-stu-id="f4769-110">Architecture</span></span>

<span data-ttu-id="f4769-111">В представленной здесь архитектуре используются следующие службы Azure.</span><span class="sxs-lookup"><span data-stu-id="f4769-111">The architecture shown here uses the following Azure services.</span></span> <span data-ttu-id="f4769-112">В своем боте вы можете использовать некоторые из этих служб или включить дополнительные службы.</span><span class="sxs-lookup"><span data-stu-id="f4769-112">Your own bot may not use all of these services, or may incorporate additional services.</span></span>

### <a name="bot-logic-and-user-experience"></a><span data-ttu-id="f4769-113">Логика бота и взаимодействие с пользователем</span><span class="sxs-lookup"><span data-stu-id="f4769-113">Bot logic and user experience</span></span>

- <span data-ttu-id="f4769-114">**[Служба Bot Framework][bot-framework-service]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-114">**[Bot Framework Service][bot-framework-service]** (BFS).</span></span> <span data-ttu-id="f4769-115">Эта служба подключает бота к приложению для общения, например к Кортане, Facebook Messenger или Slack.</span><span class="sxs-lookup"><span data-stu-id="f4769-115">This service connects your bot to a communication app such as Cortana, Facebook Messenger, or Slack.</span></span> <span data-ttu-id="f4769-116">Она обеспечивает обмен данными между ботом и пользователем.</span><span class="sxs-lookup"><span data-stu-id="f4769-116">It facilitates communication between your bot and the user.</span></span>
- <span data-ttu-id="f4769-117">**[Служба приложений Azure][app-service]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-117">**[Azure App Service][app-service]**.</span></span> <span data-ttu-id="f4769-118">В Службе приложений Azure размещается логика приложения бота.</span><span class="sxs-lookup"><span data-stu-id="f4769-118">The bot application logic is hosted in Azure App Service.</span></span>

### <a name="bot-cognition-and-intelligence"></a><span data-ttu-id="f4769-119">Когнитивные и интеллектуальные возможности бота</span><span class="sxs-lookup"><span data-stu-id="f4769-119">Bot cognition and intelligence</span></span>

- <span data-ttu-id="f4769-120">**[Распознавание речи][luis]** (LUIS).</span><span class="sxs-lookup"><span data-stu-id="f4769-120">**[Language Understanding][luis]** (LUIS).</span></span> <span data-ttu-id="f4769-121">Служба LUIS входит в состав [Azure Cognitive Services][cognitive-services] и предоставляет ботам возможность понимать естественный язык, определяя намерения пользователя и сущности.</span><span class="sxs-lookup"><span data-stu-id="f4769-121">Part of [Azure Cognitive Services][cognitive-services], LUIS enables your bot to understand natural language by identifying user intents and entities.</span></span>
- <span data-ttu-id="f4769-122">**[Поиск Azure][search]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-122">**[Azure Search][search]**.</span></span> <span data-ttu-id="f4769-123">Поиск Azure — это управляемая служба, которая предоставляет индекс документов для быстрого поиска по ним.</span><span class="sxs-lookup"><span data-stu-id="f4769-123">Search is a managed service that provides a quick searchable document index.</span></span>
- <span data-ttu-id="f4769-124">**[QnA Maker][qna-maker]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-124">**[QnA Maker][qna-maker]**.</span></span> <span data-ttu-id="f4769-125">QnA Maker — это облачная служба API, которая позволяет работать с данными в форме вопросов и ответов.</span><span class="sxs-lookup"><span data-stu-id="f4769-125">QnA Maker is a cloud-based API service that creates a conversational, question-and-answer layer over your data.</span></span> <span data-ttu-id="f4769-126">Обычно в нее загружается частично структурированное содержимое, например список часто задаваемых вопросов.</span><span class="sxs-lookup"><span data-stu-id="f4769-126">Typically, it's loaded with semi-structured content such as FAQs.</span></span> <span data-ttu-id="f4769-127">Используйте ее для создания базы знаний, позволяющей отвечать на вопросы на естественном языке.</span><span class="sxs-lookup"><span data-stu-id="f4769-127">Use it to create a knowledge base for answering natural-language questions.</span></span>
- <span data-ttu-id="f4769-128">**[Веб-приложение][webapp]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-128">**[Web app][webapp]**.</span></span> <span data-ttu-id="f4769-129">Если вашему боту потребуются решения искусственного интеллекта (ИИ), не предоставляемые существующими службами, вы можете реализовать собственные пользовательские службы ИИ и разместить их в формате веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="f4769-129">If your bot needs AI solutions not provided by an existing service, you can implement your own custom AI and host it as a web app.</span></span> <span data-ttu-id="f4769-130">Так вы получите конечную веб-точку, к которой будет обращаться ваш бот.</span><span class="sxs-lookup"><span data-stu-id="f4769-130">This provides a web endpoint for your bot to call.</span></span>

### <a name="data-ingestion"></a><span data-ttu-id="f4769-131">Прием данных</span><span class="sxs-lookup"><span data-stu-id="f4769-131">Data ingestion</span></span>

<span data-ttu-id="f4769-132">Бот использует необработанные данные, которые ему нужно принять и подготовить.</span><span class="sxs-lookup"><span data-stu-id="f4769-132">The bot will rely on raw data that must be ingested and prepared.</span></span> <span data-ttu-id="f4769-133">Для оркестрации этого процесса можно применить следующие варианты.</span><span class="sxs-lookup"><span data-stu-id="f4769-133">Consider any of the following options to orchestrate this process:</span></span>

- <span data-ttu-id="f4769-134">**[Фабрика данных Azure][data-factory]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-134">**[Azure Data Factory][data-factory]**.</span></span> <span data-ttu-id="f4769-135">Фабрика данных координирует и автоматизирует перемещение и преобразование данных.</span><span class="sxs-lookup"><span data-stu-id="f4769-135">Data Factory orchestrates and automates data movement and data transformation.</span></span>
- <span data-ttu-id="f4769-136">**[Logic Apps][logic-apps]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-136">**[Logic Apps][logic-apps]**.</span></span> <span data-ttu-id="f4769-137">Logic Apps является бессерверной платформой для создания рабочих процессов, включающих приложения, данные и службы.</span><span class="sxs-lookup"><span data-stu-id="f4769-137">Logic Apps is a serverless platform for building workflows that integrate applications, data, and services.</span></span> <span data-ttu-id="f4769-138">Logic Apps предоставляет соединители данных для многих приложений, включая Office 365.</span><span class="sxs-lookup"><span data-stu-id="f4769-138">Logic Apps provides data connectors for many applications, including Office 365.</span></span>
- <span data-ttu-id="f4769-139">**[Функции Azure][functions]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-139">**[Azure Functions][functions]**.</span></span> <span data-ttu-id="f4769-140">На базе Функций Azure вы можете написать бессерверный пользовательский код, который вызывается по определенному [триггеру][functions-triggers], например при каждом добавлении документа в хранилище BLOB-объектов или в Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="f4769-140">You can use Azure Functions to write custom serverless code that is invoked by a [trigger][functions-triggers] &mdash; for example, whenever a document is added to blob storage or Cosmos DB.</span></span>

### <a name="logging-and-monitoring"></a><span data-ttu-id="f4769-141">Ведение журналов и мониторинг</span><span class="sxs-lookup"><span data-stu-id="f4769-141">Logging and monitoring</span></span>

- <span data-ttu-id="f4769-142">**[Application Insights][app-insights]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-142">**[Application Insights][app-insights]**.</span></span> <span data-ttu-id="f4769-143">Application Insights позволяет регистрировать метрики работы бота для мониторинга, диагностики и аналитики.</span><span class="sxs-lookup"><span data-stu-id="f4769-143">Use Application Insights to log the bot's application metrics for monitoring, diagnostic, and analytical purposes.</span></span>
- <span data-ttu-id="f4769-144">**[Хранилище BLOB-объектов Azure][blob]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-144">**[Azure Blob Storage][blob]**.</span></span> <span data-ttu-id="f4769-145">Хранилище BLOB-объектов оптимизировано для хранения больших объемов неструктурированных данных.</span><span class="sxs-lookup"><span data-stu-id="f4769-145">Blob storage is optimized for storing massive amounts of unstructured data.</span></span>
- <span data-ttu-id="f4769-146">**[Cosmos DB][cosmosdb]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-146">**[Cosmos DB][cosmosdb]**.</span></span> <span data-ttu-id="f4769-147">Cosmos DB подходит для хранения частично структурированных данных журналов, например бесед бота.</span><span class="sxs-lookup"><span data-stu-id="f4769-147">Cosmos DB is well-suited for storing semi-structured log data such as conversations.</span></span>
- <span data-ttu-id="f4769-148">**[Power BI][power-bi]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-148">**[Power BI][power-bi]**.</span></span> <span data-ttu-id="f4769-149">Power BI позволяет создавать для бота панели мониторинга.</span><span class="sxs-lookup"><span data-stu-id="f4769-149">Use Power BI to create monitoring dashboards for your bot.</span></span>

### <a name="security-and-governance"></a><span data-ttu-id="f4769-150">Безопасность и контроль</span><span class="sxs-lookup"><span data-stu-id="f4769-150">Security and governance</span></span>

- <span data-ttu-id="f4769-151">**[Azure Active Directory][aad]** (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="f4769-151">**[Azure Active Directory][aad]** (Azure AD).</span></span> <span data-ttu-id="f4769-152">Пользователи будут проходить проверку подлинности через поставщик удостоверений, например Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f4769-152">Users will authenticate through an identity provider such as Azure AD.</span></span> <span data-ttu-id="f4769-153">Служба Azure Bot обрабатывает поток проверки подлинности и управление маркерами OAuth.</span><span class="sxs-lookup"><span data-stu-id="f4769-153">The Bot Service handles the authentication flow and OAuth token management.</span></span> <span data-ttu-id="f4769-154">Дополнительные сведения см. в статье [Добавление проверки подлинности к боту с помощью службы Azure Bot][bot-authentication].</span><span class="sxs-lookup"><span data-stu-id="f4769-154">See [Add authentication to your bot via Azure Bot Service][bot-authentication].</span></span>
- <span data-ttu-id="f4769-155">**[Azure Key Vault][key-vault]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-155">**[Azure Key Vault][key-vault]**.</span></span> <span data-ttu-id="f4769-156">В Key Vault удобно хранить учетные данные и другие секреты.</span><span class="sxs-lookup"><span data-stu-id="f4769-156">Store credentials and other secrets using Key Vault.</span></span>

### <a name="quality-assurance-and-enhancements"></a><span data-ttu-id="f4769-157">Контроль качества и улучшения</span><span class="sxs-lookup"><span data-stu-id="f4769-157">Quality assurance and enhancements</span></span>

- <span data-ttu-id="f4769-158">**[Azure DevOps][devops]**.</span><span class="sxs-lookup"><span data-stu-id="f4769-158">**[Azure DevOps][devops]**.</span></span> <span data-ttu-id="f4769-159">Предоставляет множество служб для управления приложениями, в том числе для управления версиями, сборки, тестирования, развертывания и отслеживания проектов.</span><span class="sxs-lookup"><span data-stu-id="f4769-159">Provides many services for app management, including source control, building, testing, deployment, and project tracking.</span></span>
- <span data-ttu-id="f4769-160">**[VS Code][vscode]**  — простой редактор кода для разработки приложений.</span><span class="sxs-lookup"><span data-stu-id="f4769-160">**[VS Code][vscode]** A lightweight code editor for app development.</span></span> <span data-ttu-id="f4769-161">Также можно использовать любую другую интегрированную среду разработки со сходными функциями.</span><span class="sxs-lookup"><span data-stu-id="f4769-161">You can use any other IDE with similar features.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="f4769-162">Рекомендации по проектированию</span><span class="sxs-lookup"><span data-stu-id="f4769-162">Design considerations</span></span>

<span data-ttu-id="f4769-163">На высоком уровне функциональные возможности чат-бота можно разделить на основные ("мозг" бота) и требования окружающей среды (его "тело").</span><span class="sxs-lookup"><span data-stu-id="f4769-163">At a high level, a conversational bot can be divided into the bot functionality (the "brain") and a set of surrounding requirements (the "body").</span></span> <span data-ttu-id="f4769-164">"Мозг" содержит компоненты, имеющие отношение к предметной области, в том числе логику бота и функции машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="f4769-164">The brain includes the domain-aware components, including the bot logic and ML capabilities.</span></span> <span data-ttu-id="f4769-165">Другие компоненты не зависят от предметной области и отвечают за нефункциональные требования, например возможности CI/CD, контроль качества и безопасность.</span><span class="sxs-lookup"><span data-stu-id="f4769-165">Other components are domain agnostic and address non-functional requirements such as CI/CD, quality assurance, and security.</span></span>

![Логическая схема функциональности бота](./_images/conversational-bot-logical.png)

<span data-ttu-id="f4769-167">Прежде чем рассматривать эту архитектуру подробно, давайте разберемся с потоком данных, который проходит через каждый из ее компонентов.</span><span class="sxs-lookup"><span data-stu-id="f4769-167">Before getting into the specifics of this architecture, let's start with the data flow through each subcomponent of the design.</span></span> <span data-ttu-id="f4769-168">Поток данных включает потоки данных, которые инициируются пользователем и системой.</span><span class="sxs-lookup"><span data-stu-id="f4769-168">The data flow includes user-initiated and system-initiated data flows.</span></span>

### <a name="user-message-flow"></a><span data-ttu-id="f4769-169">Поток сообщений пользователя</span><span class="sxs-lookup"><span data-stu-id="f4769-169">User message flow</span></span>

<span data-ttu-id="f4769-170">**Проверка подлинности**.</span><span class="sxs-lookup"><span data-stu-id="f4769-170">**Authentication**.</span></span> <span data-ttu-id="f4769-171">Пользователи начинают взаимодействие с проверки подлинности, используя штатный механизм для выбранного канала связи с ботом.</span><span class="sxs-lookup"><span data-stu-id="f4769-171">Users start by authenticating themselves using whatever mechanism is provided by their channel of communication with the bot.</span></span> <span data-ttu-id="f4769-172">Bot Framework поддерживает различные каналы связи, включая Кортану, Microsoft Teams, Facebook Messenger, Kik и Slack.</span><span class="sxs-lookup"><span data-stu-id="f4769-172">The bot framework supports many communication channels, including Cortana, Microsoft Teams, Facebook Messenger, Kik, and Slack.</span></span> <span data-ttu-id="f4769-173">Полный список каналов вы найдете в статье [Подключение бота к каналам](/azure/bot-service/bot-service-manage-channels).</span><span class="sxs-lookup"><span data-stu-id="f4769-173">For a list of channels, see [Connect a bot to channels](/azure/bot-service/bot-service-manage-channels).</span></span> <span data-ttu-id="f4769-174">При создании бота с помощью службы Azure Bot канал [Веб-чат][webchat] настраивается автоматически.</span><span class="sxs-lookup"><span data-stu-id="f4769-174">When you create a bot with Azure Bot Service, the [Web Chat][webchat] channel is automatically configured.</span></span> <span data-ttu-id="f4769-175">С помощью этого канала пользователям могут напрямую взаимодействовать с ботом с веб-страницы.</span><span class="sxs-lookup"><span data-stu-id="f4769-175">This channel allows users to interact with your bot directly in a web page.</span></span> <span data-ttu-id="f4769-176">Вы также можете подключить бота к пользовательскому приложению с помощью канала [Direct Line](/azure/bot-service/bot-service-channel-connect-directline).</span><span class="sxs-lookup"><span data-stu-id="f4769-176">You can also connect the bot to a custom app by using the [Direct Line](/azure/bot-service/bot-service-channel-connect-directline) channel.</span></span> <span data-ttu-id="f4769-177">Удостоверение пользователя используется для управления доступом на основе ролей и для персонализации предоставляемого содержимого.</span><span class="sxs-lookup"><span data-stu-id="f4769-177">The user's identity is used to provide role-based access control, as well as to serve personalized content.</span></span>

<span data-ttu-id="f4769-178">**Сообщение для пользователя**.</span><span class="sxs-lookup"><span data-stu-id="f4769-178">**User message**.</span></span> <span data-ttu-id="f4769-179">После проверки подлинности пользователь отправляет боту сообщение.</span><span class="sxs-lookup"><span data-stu-id="f4769-179">Once authenticated, the user sends a message to the bot.</span></span> <span data-ttu-id="f4769-180">Бот считывает это сообщение и перенаправляет его в службу распознавания речи, такую как [LUIS](/azure/cognitive-services/luis/).</span><span class="sxs-lookup"><span data-stu-id="f4769-180">The bot reads the message and routes it to a natural language understanding service such as [LUIS](/azure/cognitive-services/luis/).</span></span> <span data-ttu-id="f4769-181">Этот этап позволяет получить **намерения** пользователя (что он хочет сделать) и **сущности** (объекты, которые интересуют пользователя).</span><span class="sxs-lookup"><span data-stu-id="f4769-181">This step gets the **intents** (what the user wants to do) and **entities** (what things the user is interested in).</span></span> <span data-ttu-id="f4769-182">На их основе бот создает запрос и передает его в службу, которая отвечает за предоставление сведений, например в [Поиск Azure][search] для поиска документов, в [QnA Maker](https://www.qnamaker.ai/) для обработки часто задаваемых вопросов или в пользовательскую базу знаний.</span><span class="sxs-lookup"><span data-stu-id="f4769-182">The bot then builds a query that it passes to a service that serves information, such as [Azure Search][search] for document retrieval, [QnA Maker](https://www.qnamaker.ai/) for FAQs, or a custom knowledge base.</span></span> <span data-ttu-id="f4769-183">Ответы от этих служб бот использует для создания ответа.</span><span class="sxs-lookup"><span data-stu-id="f4769-183">The bot uses these results to construct a response.</span></span> <span data-ttu-id="f4769-184">Чтобы получить оптимальный ответ на определенный запрос, бот может поочередно выполнить несколько запросов к этим удаленным службам.</span><span class="sxs-lookup"><span data-stu-id="f4769-184">To give the best result for a  given query, the bot might make several back-and-forth calls to these remote services.</span></span>

<span data-ttu-id="f4769-185">**Ответ**.</span><span class="sxs-lookup"><span data-stu-id="f4769-185">**Response**.</span></span> <span data-ttu-id="f4769-186">На этом этапе бот выбирает лучший ответ и отправляет его пользователю.</span><span class="sxs-lookup"><span data-stu-id="f4769-186">At this point, the bot has determined the best response and sends it to the user.</span></span> <span data-ttu-id="f4769-187">Если у ответа с наилучшим соответствием низкий показатель достоверности, ответом может являться уточняющий вопрос для устранения неоднозначности или сообщение о том, что бот не может найти правильный ответ.</span><span class="sxs-lookup"><span data-stu-id="f4769-187">If the confidence score of the best-matched answer is low, the response might be a disambiguation question or an acknowledgement that the bot could not reply adequately.</span></span>

<span data-ttu-id="f4769-188">**Ведение журналов.**</span><span class="sxs-lookup"><span data-stu-id="f4769-188">**Logging**.</span></span> <span data-ttu-id="f4769-189">При получении запроса пользователя или отправке ответа следует сохранять в хранилище журнала все сообщения, а также метрики производительности и любые полученные от внешних служб сообщения об ошибках.</span><span class="sxs-lookup"><span data-stu-id="f4769-189">When a user request is received or a response is sent, all conversation actions should be logged to a logging store, along with performance metrics and general errors from external services.</span></span> <span data-ttu-id="f4769-190">Эти журналы позднее пригодятся для диагностики проблем и улучшения системы.</span><span class="sxs-lookup"><span data-stu-id="f4769-190">These logs will be useful later when diagnosing issues and improving the system.</span></span>

<span data-ttu-id="f4769-191">**Отзывы и предложения**.</span><span class="sxs-lookup"><span data-stu-id="f4769-191">**Feedback**.</span></span> <span data-ttu-id="f4769-192">Еще один полезный прием — собирать от пользователей отзывы и оценки удовлетворенности.</span><span class="sxs-lookup"><span data-stu-id="f4769-192">Another good practice is to collect user feedback and satisfaction scores.</span></span> <span data-ttu-id="f4769-193">В дополнение к последнему ответу бот может отправлять пользователю запрос, чтобы оценить степень удовлетворенности полученным ответом.</span><span class="sxs-lookup"><span data-stu-id="f4769-193">As a follow up to the bot's final response, the bot should ask the user to rate their satisfaction with the reply.</span></span> <span data-ttu-id="f4769-194">Такие отзывы помогают решить проблемы холодного запуска или понимания естественного языка, чтобы постоянно повышать точность ответов.</span><span class="sxs-lookup"><span data-stu-id="f4769-194">Feedback can help you to solve the cold start problem of natural language understanding, and continually improve the accuracy of responses.</span></span>

### <a name="system-data-flow"></a><span data-ttu-id="f4769-195">Поток данных системы</span><span class="sxs-lookup"><span data-stu-id="f4769-195">System Data Flow</span></span>

<span data-ttu-id="f4769-196">**Извлечение, преобразование и загрузка (ETL)**.</span><span class="sxs-lookup"><span data-stu-id="f4769-196">**ETL**.</span></span> <span data-ttu-id="f4769-197">Боту для работы нужны сведения и знания, извлеченные серверной частью из необработанных данных на этапе ETL.</span><span class="sxs-lookup"><span data-stu-id="f4769-197">The bot relies on information and knowledge extracted from the raw data by an ETL process in the backend.</span></span> <span data-ttu-id="f4769-198">Это могут быть структурированные (база данных SQL), частично структурированные (системы CRM, часто задаваемые вопросы) или неструктурированные данные (документы Word, PDF-файлы, веб-журналы).</span><span class="sxs-lookup"><span data-stu-id="f4769-198">This data might be structured (SQL database), semi-structured (CRM system, FAQs), or unstructured (Word documents, PDFs, web logs).</span></span> <span data-ttu-id="f4769-199">Подсистема ETL извлекает данные по фиксированному расписанию.</span><span class="sxs-lookup"><span data-stu-id="f4769-199">An ETL subsystem extracts the data on a fixed schedule.</span></span> <span data-ttu-id="f4769-200">Содержимое преобразовывается и обогащается, а затем передается в промежуточное хранилище данных, например в Cosmos DB или хранилище BLOB-объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="f4769-200">The content is transformed and enriched, then loaded into an intermediary data store, such as Cosmos DB or Azure Blob Storage.</span></span>

<span data-ttu-id="f4769-201">Данные в промежуточном хранилище индексируются в Поиск Azure, чтобы поддерживать извлечение документов, загружаются в QnA Maker для создания пар "вопрос — ответ" или передаются в пользовательское веб-приложение для обработки неструктурированного текста.</span><span class="sxs-lookup"><span data-stu-id="f4769-201">Data in the intermediary store is then indexed into Azure Search for document retrieval, loaded into QnA Maker to create question and answer pairs, or loaded into a custom web app for unstructured text processing.</span></span> <span data-ttu-id="f4769-202">Также эти данные используются для обучения модели LUIS, которая извлекает намерения и сущности.</span><span class="sxs-lookup"><span data-stu-id="f4769-202">The data is also used to train a LUIS model for intent and entity extraction.</span></span>

<span data-ttu-id="f4769-203">**Контроль качества**.</span><span class="sxs-lookup"><span data-stu-id="f4769-203">**Quality assurance**.</span></span> <span data-ttu-id="f4769-204">Журналы бесед используются для диагностики и исправления ошибок, сбора полезных сведений об использовании бота и отслеживания общей производительности.</span><span class="sxs-lookup"><span data-stu-id="f4769-204">The conversation logs are used to diagnose and fix bugs, provide insight into how the bot is being used, and track overall performance.</span></span> <span data-ttu-id="f4769-205">Данные обратной связи полезны для повторного обучения моделей ИИ, которое позволяет повысить производительность бота.</span><span class="sxs-lookup"><span data-stu-id="f4769-205">Feedback data is useful for retraining the AI models to improve bot performance.</span></span>

## <a name="building-a-bot"></a><span data-ttu-id="f4769-206">Сборка бота</span><span class="sxs-lookup"><span data-stu-id="f4769-206">Building a bot</span></span>

<span data-ttu-id="f4769-207">Прежде, чем вы напишете первую строку кода, нужно создать функциональную спецификацию, чтобы команда разработчиков хорошо понимала все ожидаемые действия бота.</span><span class="sxs-lookup"><span data-stu-id="f4769-207">Before you even write a single line of code, it's important to write a functional specification so the development team has a clear idea of what the bot is expected to do.</span></span> <span data-ttu-id="f4769-208">Эта спецификация должна включать относительно широкий список вариантов ввода пользователя и ожидаемых ответов бота по разным предметным областям.</span><span class="sxs-lookup"><span data-stu-id="f4769-208">The specification should include a reasonably comprehensive list of user inputs and expected bot responses in various knowledge domains.</span></span> <span data-ttu-id="f4769-209">Этот документ будет бесценным руководством при разработке и тестировании бота.</span><span class="sxs-lookup"><span data-stu-id="f4769-209">This living document will be an invaluable guide for developing and testing your bot.</span></span>

### <a name="ingest-data"></a><span data-ttu-id="f4769-210">Прием данных</span><span class="sxs-lookup"><span data-stu-id="f4769-210">Ingest data</span></span>

<span data-ttu-id="f4769-211">После этого определите источники данных, которые позволят боту интеллектуально взаимодействовать с пользователями.</span><span class="sxs-lookup"><span data-stu-id="f4769-211">Next, identify the data sources that will enable the bot to interact intelligently with users.</span></span> <span data-ttu-id="f4769-212">Как упоминалось ранее, эти источники могут содержать структурированные, частично структурированные и неструктурированные наборы данных.</span><span class="sxs-lookup"><span data-stu-id="f4769-212">As mentioned earlier, these data sources could contain structured, semi-structured, or unstructured data sets.</span></span> <span data-ttu-id="f4769-213">Для начала работы мы рекомендуем один раз передать копию нужных данных в централизованное хранилище, например в Cosmos DB или службу хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="f4769-213">When you're getting started, a good approach is to make a one-off copy of the data to a central store, such as Cosmos DB or Azure Storage.</span></span> <span data-ttu-id="f4769-214">По мере развития системы можно создать конвейер автоматического приема данных, чтобы поддерживать актуальность этих данных.</span><span class="sxs-lookup"><span data-stu-id="f4769-214">As you progress, you should create an automated data ingestion pipeline to keep this data current.</span></span> <span data-ttu-id="f4769-215">Для создания конвейера автоматического приема данных можно применить Фабрику данных, Функции Azure и (или) Logic Apps.</span><span class="sxs-lookup"><span data-stu-id="f4769-215">Options for an automated ingestion pipeline include Data Factory, Functions, and Logic Apps.</span></span> <span data-ttu-id="f4769-216">В зависимости от особенностей хранилища или схемы данных вы можете сочетать эти подходы в разных комбинациях.</span><span class="sxs-lookup"><span data-stu-id="f4769-216">Depending on the data stores and the schemas, you might use a combination of these approaches.</span></span>

<span data-ttu-id="f4769-217">При начале работы имеет смысл вручную создать все нужные ресурсы Azure с помощью портала Azure.</span><span class="sxs-lookup"><span data-stu-id="f4769-217">As you get started, it's reasonable to use the Azure portal to manually create Azure resources.</span></span> <span data-ttu-id="f4769-218">Позднее можно подумать и об автоматизации развертывания этих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f4769-218">Later on, you should put more thought into automating the deployment of these resources.</span></span>

### <a name="core-bot-logic-and-ux"></a><span data-ttu-id="f4769-219">Основная логика бота и пользовательский интерфейс</span><span class="sxs-lookup"><span data-stu-id="f4769-219">Core bot logic and UX</span></span>

<span data-ttu-id="f4769-220">Подготовив спецификацию и начальный набор данных, пора приступить к реализации бота.</span><span class="sxs-lookup"><span data-stu-id="f4769-220">Once you have a specification and some data, it's time to start making your bot into reality.</span></span> <span data-ttu-id="f4769-221">Давайте рассмотрим основную логику бота.</span><span class="sxs-lookup"><span data-stu-id="f4769-221">Let's focus on the core bot logic.</span></span> <span data-ttu-id="f4769-222">Так называют код, который обрабатывает диалог с пользователем и содержит логику маршрутизации, устранения неоднозначностей и ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="f4769-222">This is the code that handles the conversation with the user, including the routing logic, disambiguation logic, and logging.</span></span> <span data-ttu-id="f4769-223">Для начала ознакомьтесь с платформой [Bot Framework][bot-framework], например изучите следующее:</span><span class="sxs-lookup"><span data-stu-id="f4769-223">Start by familiarizing yourself with the [Bot Framework][bot-framework], including:</span></span>

- <span data-ttu-id="f4769-224">Основные понятия и термины этой платформы, особенно [беседы], репликовые [шаги] и [действия].</span><span class="sxs-lookup"><span data-stu-id="f4769-224">Basic concepts and terminology used in the framework, especially [conversations], [turns], and [activities].</span></span>
- <span data-ttu-id="f4769-225">Возможности [службы соединителя бота](/azure/bot-service/rest-api/bot-framework-rest-connector-quickstart), которая обрабатывает сетевое взаимодействие между ботом и каналами.</span><span class="sxs-lookup"><span data-stu-id="f4769-225">The [Bot Connector service](/azure/bot-service/rest-api/bot-framework-rest-connector-quickstart), which handles the networking between the bot and your channels.</span></span>
- <span data-ttu-id="f4769-226">Механизмы поддержания [состояния](/azure/bot-service/bot-builder-concept-state) беседы, для которых применяется хранилище в памяти или (предпочтительно) хранилище BLOB-объектов Azure или Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="f4769-226">How conversation [state](/azure/bot-service/bot-builder-concept-state) is maintained, either in memory or better yet in a store such as Azure Blob Storage or Azure Cosmos DB.</span></span>
- <span data-ttu-id="f4769-227">[ПО промежуточного слоя](/azure/bot-service/bot-builder-basics#middleware) и его применение для подключения бота к внешним службам, таким как Cognitive Services.</span><span class="sxs-lookup"><span data-stu-id="f4769-227">[Middleware](/azure/bot-service/bot-builder-basics#middleware), and how it can be used to hook up your bot with external services, such as Cognitive Services.</span></span>

<span data-ttu-id="f4769-228">У вас есть много возможностей для расширения [взаимодействия с пользователем](/azure/bot-service/bot-service-design-user-experience).</span><span class="sxs-lookup"><span data-stu-id="f4769-228">For a rich [user experience](/azure/bot-service/bot-service-design-user-experience), there are many options.</span></span>

- <span data-ttu-id="f4769-229">Вы можете использовать [карты](/azure/bot-service/bot-service-design-user-experience#cards) для добавления кнопок, изображений, каруселей и меню.</span><span class="sxs-lookup"><span data-stu-id="f4769-229">You can use [cards](/azure/bot-service/bot-service-design-user-experience#cards) to include buttons, images, carousels, and menus.</span></span>
- <span data-ttu-id="f4769-230">Бот даже может поддерживать речь.</span><span class="sxs-lookup"><span data-stu-id="f4769-230">A bot can support speech.</span></span>
- <span data-ttu-id="f4769-231">Вы можете внедрить бот в приложение или веб-сайт, чтобы использовать возможности этого приложения или сайта.</span><span class="sxs-lookup"><span data-stu-id="f4769-231">You can even embed your bot in an app or website and use the capabilities of the app hosting it.</span></span>

<span data-ttu-id="f4769-232">Чтобы приступить к работе, создайте бот с подключением к Интернету с помощью [службы Azure Bot](/azure/bot-service/bot-service-quickstart), выбрав любой из доступных шаблонов для C# и Node.js.</span><span class="sxs-lookup"><span data-stu-id="f4769-232">To get started, you can build your bot online using the [Azure Bot Service](/azure/bot-service/bot-service-quickstart), selecting from the available C# and Node.js templates.</span></span> <span data-ttu-id="f4769-233">Когда бот станет более сложным, его лучше сначала создавать локально, а затем разворачивать в Интернете.</span><span class="sxs-lookup"><span data-stu-id="f4769-233">As your bot gets more sophisticated, however, you will need to create your bot locally then deploy it to the web.</span></span> <span data-ttu-id="f4769-234">Выберите интегрированную среду разработки, например Visual Studio или Visual Studio Code, и язык программирования.</span><span class="sxs-lookup"><span data-stu-id="f4769-234">Choose an IDE, such as Visual Studio or Visual Studio Code, and a programming language.</span></span> <span data-ttu-id="f4769-235">Пакеты SDK доступны для следующих языков:</span><span class="sxs-lookup"><span data-stu-id="f4769-235">SDKs are available for the following languages:</span></span>

- [<span data-ttu-id="f4769-236">C#</span><span class="sxs-lookup"><span data-stu-id="f4769-236">C#</span></span>](https://github.com/microsoft/botbuilder-dotnet)
- [<span data-ttu-id="f4769-237">JavaScript</span><span class="sxs-lookup"><span data-stu-id="f4769-237">JavaScript</span></span>](https://github.com/microsoft/botbuilder-js)
- <span data-ttu-id="f4769-238">[Java](https://github.com/microsoft/botbuilder-java) (предварительная версия);</span><span class="sxs-lookup"><span data-stu-id="f4769-238">[Java](https://github.com/microsoft/botbuilder-java) (preview)</span></span>
- <span data-ttu-id="f4769-239">[Python](https://github.com/microsoft/botbuilder-python) (предварительная версия).</span><span class="sxs-lookup"><span data-stu-id="f4769-239">[Python](https://github.com/microsoft/botbuilder-python) (preview)</span></span>

<span data-ttu-id="f4769-240">В качестве отправной точки можно скачать исходный код бота, созданный в службе Azure Bot.</span><span class="sxs-lookup"><span data-stu-id="f4769-240">As a starting point, you can download the source code for the bot you created using the Azure Bot Service.</span></span> <span data-ttu-id="f4769-241">Также вы можете выбрать любой из [примеров кода](https://github.com/Microsoft/BotBuilder-Samples/blob/master/README.md), где представлены как простые боты для повторения сообщений, так и более сложные системы с интеграцией служб ИИ.</span><span class="sxs-lookup"><span data-stu-id="f4769-241">You can also find [sample code](https://github.com/Microsoft/BotBuilder-Samples/blob/master/README.md), from simple echo bots to more sophisticated bots that integrate with various AI services.</span></span>

### <a name="add-smarts-to-your-bot"></a><span data-ttu-id="f4769-242">Добавьте извилин вашему боту</span><span class="sxs-lookup"><span data-stu-id="f4769-242">Add smarts to your bot</span></span>

<span data-ttu-id="f4769-243">Для простых ботов с четко определенным набором команд можно использовать набор правил для анализа пользовательского ввода по регулярным выражениям.</span><span class="sxs-lookup"><span data-stu-id="f4769-243">For a simple bot with a well-defined list of commands, you might be able to use a rules-based approach to parse the user input via regex.</span></span> <span data-ttu-id="f4769-244">Этот подход отличается детерминированностью и простотой для понимания.</span><span class="sxs-lookup"><span data-stu-id="f4769-244">This has the advantage of being deterministic and understandable.</span></span> <span data-ttu-id="f4769-245">Но если бот должен понимать намерения и сущности в сообщениях, сформулированных более естественным языком, вам помогут службы ИИ.</span><span class="sxs-lookup"><span data-stu-id="f4769-245">However, when your bot needs to understand the intents and entities of a more natural-language message, there are AI services that can help.</span></span>

- <span data-ttu-id="f4769-246">Служба LUIS разработана специально для понимания намерений и сущностей в сообщениях пользователя.</span><span class="sxs-lookup"><span data-stu-id="f4769-246">LUIS is specifically designed to understand user intents and entities.</span></span> <span data-ttu-id="f4769-247">Ее можно обучить по относительно небольшой коллекции [сообщений пользователя](/azure/cognitive-services/luis/luis-concept-utterance) с нужными ответами, чтобы служба смогла возвращать намерения и сущности для произвольного сообщения пользователя.</span><span class="sxs-lookup"><span data-stu-id="f4769-247">You train it with a moderately sized collection of relevant [user input](/azure/cognitive-services/luis/luis-concept-utterance) and desired responses, and it returns the intents and entities for a user's given message.</span></span>

- <span data-ttu-id="f4769-248">Поиск Azure может работать параллельно с LUIS.</span><span class="sxs-lookup"><span data-stu-id="f4769-248">Azure Search can work alongside LUIS.</span></span> <span data-ttu-id="f4769-249">В Поиске вы можете создать индекс, поддерживающий поиск по всем подходящим данным.</span><span class="sxs-lookup"><span data-stu-id="f4769-249">Using Search, you create searchable indexes over all relevant data.</span></span> <span data-ttu-id="f4769-250">Бот запрашивает из этих индексов сущности, извлеченные ранее службой LUIS.</span><span class="sxs-lookup"><span data-stu-id="f4769-250">The bot queries these indexes for the entities extracted by LUIS.</span></span> <span data-ttu-id="f4769-251">Поиск Azure также поддерживает [синонимы][synonyms], что позволяет расширить сеть сопоставлений с правильным словом.</span><span class="sxs-lookup"><span data-stu-id="f4769-251">Azure Search also supports [synonyms][synonyms], which can widen the net of correct word mappings.</span></span>

- <span data-ttu-id="f4769-252">Служба QnA Maker также предназначена для возврата ответов на определенные вопросы.</span><span class="sxs-lookup"><span data-stu-id="f4769-252">QnA Maker is another service that is designed to return answers for given questions.</span></span> <span data-ttu-id="f4769-253">Она обычно обучается по частично структурированным данным, таким как часто задаваемые вопросы.</span><span class="sxs-lookup"><span data-stu-id="f4769-253">It's typically trained over semi-structured data such as FAQs.</span></span>

<span data-ttu-id="f4769-254">Бот может использовать и другие службы ИИ для расширения возможностей пользователя.</span><span class="sxs-lookup"><span data-stu-id="f4769-254">Your bot can use other AI services to further enrich the user experience.</span></span> <span data-ttu-id="f4769-255">[Набор готовых служб ИИ в Cognitive Services](https://azure.microsoft.com/en-us/services/cognitive-services/?v=18.44a) (куда входят LUIS и QnA Maker) содержит службы компьютерного зрения, речи, языка, поиска и расположения.</span><span class="sxs-lookup"><span data-stu-id="f4769-255">The [Cognitive Services suite of pre-built AI](https://azure.microsoft.com/en-us/services/cognitive-services/?v=18.44a) services (which includes LUIS and QnA Maker) has services for vision, speech, language, search, and location.</span></span> <span data-ttu-id="f4769-256">Вы также можете быстро добавлять новые функциональные возможности, например перевод на другие языки, проверку орфографии, анализ тональности, распознавание текста, отслеживание расположения и модерацию содержимого.</span><span class="sxs-lookup"><span data-stu-id="f4769-256">You can quickly add functionality such as language translation, spell checking, sentiment analysis, OCR, location awareness, and content moderation.</span></span> <span data-ttu-id="f4769-257">Эти службы можно оформить как модули ПО промежуточного слоя, при подключении которых бот будет лучше и более естественно взаимодействовать с пользователем.</span><span class="sxs-lookup"><span data-stu-id="f4769-257">These services can be wired up as middleware modules in your bot to interact more naturally and intelligently with the user.</span></span>

<span data-ttu-id="f4769-258">Кроме этого, вы можете интегрировать собственную службу ИИ.</span><span class="sxs-lookup"><span data-stu-id="f4769-258">Another option is to integrate your own custom AI service.</span></span> <span data-ttu-id="f4769-259">Это более сложный подход, но зато он дает полную гибкость по выбору алгоритма, режима и моделей машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="f4769-259">This approach is more complex, but gives you complete flexibility in terms of the machine learning algorithm, training, and model.</span></span> <span data-ttu-id="f4769-260">Например, вы можете реализовать собственную модель разделов и использовать такой алгоритм, как [LDA][lda], чтобы искать схожие или подходящие документы.</span><span class="sxs-lookup"><span data-stu-id="f4769-260">For example, you could implement your own topic modeling and use algorithm such as [LDA][lda] to find similar or relevant documents.</span></span> <span data-ttu-id="f4769-261">Мы рекомендуем предоставлять пользовательское решение ИИ в виде конечной точки веб-службы и обращаться к этой точке из основной логики бота.</span><span class="sxs-lookup"><span data-stu-id="f4769-261">A good approach is to expose your custom AI solution as a web service endpoint, and call the endpoint from the core bot logic.</span></span> <span data-ttu-id="f4769-262">Такую веб-службу можно разместить в Службе приложений или в кластере виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="f4769-262">The web service could be hosted in App Service or in a cluster of VMs.</span></span> <span data-ttu-id="f4769-263">[Машинное обучение Azure][aml] предоставляет ряд служб и библиотек, которые помогут вам при [обучении](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/training) и [развертывании](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/deployment) моделей.</span><span class="sxs-lookup"><span data-stu-id="f4769-263">[Azure Machine Learning][aml] provides a number of services and libraries to assist you in [training](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/training) and [deploying](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/deployment) your models.</span></span>

## <a name="quality-assurance-and-enhancement"></a><span data-ttu-id="f4769-264">Контроль качества и улучшения</span><span class="sxs-lookup"><span data-stu-id="f4769-264">Quality assurance and enhancement</span></span>

<span data-ttu-id="f4769-265">**Ведение журналов.**</span><span class="sxs-lookup"><span data-stu-id="f4769-265">**Logging**.</span></span> <span data-ttu-id="f4769-266">Сохраняйте журналы всех бесед пользователей с ботом, а также базовые метрики производительности и любые ошибки.</span><span class="sxs-lookup"><span data-stu-id="f4769-266">Log user conversations with the bot, including the underlying performance metrics and any errors.</span></span> <span data-ttu-id="f4769-267">Эти журналы будут бесценным ресурсом для отладки проблем, анализа взаимодействия с пользователем и улучшения системы.</span><span class="sxs-lookup"><span data-stu-id="f4769-267">These logs will prove invaluable for debugging issues, understanding user interactions, and improving the system.</span></span> <span data-ttu-id="f4769-268">Для разных типов журналов лучше выбрать разные типы хранилищ.</span><span class="sxs-lookup"><span data-stu-id="f4769-268">Different data stores might be appropriate for different types of logs.</span></span> <span data-ttu-id="f4769-269">Например, служба Application Insights удобна для веб-журналов, Cosmos DB — для бесед, а служба хранилища Azure — для полезных данных большого объема.</span><span class="sxs-lookup"><span data-stu-id="f4769-269">For example, consider Application Insights for web logs, Cosmos DB for conversations, and Azure Storage for large payloads.</span></span> <span data-ttu-id="f4769-270">См. дополнительные сведения о [записи данных напрямую в службу хранилища Azure][transcript-storage].</span><span class="sxs-lookup"><span data-stu-id="f4769-270">See [Write directly to Azure Storage][transcript-storage].</span></span>

<span data-ttu-id="f4769-271">**Отзывы и предложения**.</span><span class="sxs-lookup"><span data-stu-id="f4769-271">**Feedback**.</span></span> <span data-ttu-id="f4769-272">Также важно понимать, насколько пользователи довольны своим взаимодействием с ботом.</span><span class="sxs-lookup"><span data-stu-id="f4769-272">It's also important to understand how satisfied users are with their bot interactions.</span></span> <span data-ttu-id="f4769-273">Сохраняя отзывы пользователей, вы сможете на основе этих данных выбрать аспекты взаимодействий для возможных улучшений и (или) повторно обучить модели ИИ для повышения производительности.</span><span class="sxs-lookup"><span data-stu-id="f4769-273">If you have a record of user feedback, you can use this data to focus your efforts on improving certain interactions and retraining the AI models for improved performance.</span></span> <span data-ttu-id="f4769-274">Используйте обратную связь для обучения используемых моделей, например LUIS.</span><span class="sxs-lookup"><span data-stu-id="f4769-274">Use the feedback to retrain the models, such as LUIS, in your system.</span></span>

<span data-ttu-id="f4769-275">**Тестирование**.</span><span class="sxs-lookup"><span data-stu-id="f4769-275">**Testing**.</span></span> <span data-ttu-id="f4769-276">Тестирование бота включает модульные тесты, интеграционные тесты, тесты регрессии и функциональные тесты.</span><span class="sxs-lookup"><span data-stu-id="f4769-276">Testing a bot involves unit tests, integration tests, regression tests, and functional tests.</span></span> <span data-ttu-id="f4769-277">Для тестирования мы рекомендуем сохранять реальные HTTP-ответы от внешних служб, таких как Поиск Azure или QnA Maker, чтобы воспроизводить их для тестов и избавиться от создания реальных сетевых вызовов к внешним службам.</span><span class="sxs-lookup"><span data-stu-id="f4769-277">For testing, we recommend recording real HTTP responses from external services, such as Azure Search or QnA Maker, so they can be played back during unit testing without needing to make real network calls to external services.</span></span>

>[!NOTE]
> <span data-ttu-id="f4769-278">Чтобы быстро начать разработку по этим направлениям, ознакомьтесь с репозиторием [Botbuilder Utils for JavaScript][git-repo-base].</span><span class="sxs-lookup"><span data-stu-id="f4769-278">To jump-start your development in these areas, look at the [Botbuilder Utils for JavaScript][git-repo-base].</span></span> <span data-ttu-id="f4769-279">Этот репозиторий содержит пример служебного кода для ботов, созданных с помощью [Microsoft Bot Framework версии 4][bot-framework] и работающих на Node.js.</span><span class="sxs-lookup"><span data-stu-id="f4769-279">This repo contains sample utility code for bots built with [Microsoft Bot Framework v4][bot-framework] and running Node.js.</span></span> <span data-ttu-id="f4769-280">Он содержит следующие пакеты.</span><span class="sxs-lookup"><span data-stu-id="f4769-280">It includes the following packages:</span></span>
>
> - <span data-ttu-id="f4769-281">[Хранилище журнала Cosmos DB][cosmosdb-logger].</span><span class="sxs-lookup"><span data-stu-id="f4769-281">[Cosmos DB Logging Store][cosmosdb-logger].</span></span> <span data-ttu-id="f4769-282">Способ хранения журналов бота в Cosmos DB и запросы к этим данным.</span><span class="sxs-lookup"><span data-stu-id="f4769-282">Shows how to store and query bot logs in Cosmos DB.</span></span>
> - <span data-ttu-id="f4769-283">[Хранилище журналов Application Insights][appinsights-logger].</span><span class="sxs-lookup"><span data-stu-id="f4769-283">[Application Insights Logging Store][appinsights-logger].</span></span> <span data-ttu-id="f4769-284">Способ хранения журналов бота в Application Insights и запросы к этим данным.</span><span class="sxs-lookup"><span data-stu-id="f4769-284">Shows how to store and query bot logs in Application Insights.</span></span>
> - <span data-ttu-id="f4769-285">[ПО промежуточного слоя для сбора отзывов][feedback-util].</span><span class="sxs-lookup"><span data-stu-id="f4769-285">[Feedback Collection Middleware][feedback-util].</span></span> <span data-ttu-id="f4769-286">Пример ПО промежуточного слоя, которое предоставляет механизм создания запросов и получения ответов.</span><span class="sxs-lookup"><span data-stu-id="f4769-286">Sample middleware that provides a bot user feedback-request mechanism.</span></span>
> - <span data-ttu-id="f4769-287">[Средство записи HTTP-тестов][testing util].</span><span class="sxs-lookup"><span data-stu-id="f4769-287">[Http Test Recorder][testing util].</span></span> <span data-ttu-id="f4769-288">Запись HTTP-трафика из внешних служб в журнал.</span><span class="sxs-lookup"><span data-stu-id="f4769-288">Records HTTP traffic from services external to the bot.</span></span> <span data-ttu-id="f4769-289">Он имеет встроенную поддержку LUIS, Поиска Azure и QnA Maker, но существуют и расширения для любой другой службы.</span><span class="sxs-lookup"><span data-stu-id="f4769-289">It comes pre-built with support for LUIS, Azure Search, and QnAMaker, but extensions are available to support any service.</span></span> <span data-ttu-id="f4769-290">Это поможет вам автоматизировать тестирование ботов.</span><span class="sxs-lookup"><span data-stu-id="f4769-290">This helps you automate bot testing.</span></span>
>
> <span data-ttu-id="f4769-291">Эти пакеты предоставляются в формате примеров кода для служебных программ и не предполагают никаких гарантий, обновлений или поддержки.</span><span class="sxs-lookup"><span data-stu-id="f4769-291">These packages are provided as utility sample code, and come with no guarantee of support or updates.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="f4769-292">Вопросы доступности</span><span class="sxs-lookup"><span data-stu-id="f4769-292">Availability considerations</span></span>

<span data-ttu-id="f4769-293">При развертывании новых функций или исправлений для бота лучше всего использовать несколько сред развертывания, например промежуточную и рабочую.</span><span class="sxs-lookup"><span data-stu-id="f4769-293">As you roll out new features or bug fixes to your bot, it's best to use multiple deployment environments, such as staging and production.</span></span> <span data-ttu-id="f4769-294">С помощью [слотов][slots] развертывания, предлагаемых в [Azure DevOps][devops], вы сможете полностью избавиться от времени простоя.</span><span class="sxs-lookup"><span data-stu-id="f4769-294">Using deployment [slots][slots] from [Azure DevOps][devops] allows you to do this with zero downtime.</span></span> <span data-ttu-id="f4769-295">Все обновления можно будет проверить в промежуточной среде, прежде чем переключать их в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="f4769-295">You can test your latest upgrades in the staging environment before swapping them to the production environment.</span></span> <span data-ttu-id="f4769-296">С точки зрения обработки нагрузки Служба приложений позволяет выполнять горизонтальное и вертикальное масштабирование вручную или автоматически.</span><span class="sxs-lookup"><span data-stu-id="f4769-296">In terms of handling load, App Service is designed to scale up or out manually or automatically.</span></span> <span data-ttu-id="f4769-297">Бот размещается в глобальной инфраструктуре центров обработки данных корпорации Майкрософт, а значит для него гарантируется высокий уровень доступности, включенный в соглашение об уровне обслуживания для Службы приложений.</span><span class="sxs-lookup"><span data-stu-id="f4769-297">Because your bot is hosted in Microsoft's global datacenter infrastructure, the App Service SLA promises high availability.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="f4769-298">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="f4769-298">Security considerations</span></span>

<span data-ttu-id="f4769-299">Как и любое другое приложение, бот может обрабатывать конфиденциальные данные.</span><span class="sxs-lookup"><span data-stu-id="f4769-299">As with any other application, the bot can be designed to handle sensitive data.</span></span> <span data-ttu-id="f4769-300">Это означает, что вам нужно ограничить права на вход и взаимодействие с ботом.</span><span class="sxs-lookup"><span data-stu-id="f4769-300">Therefore, restrict who can sign in and use the bot.</span></span> <span data-ttu-id="f4769-301">Примените ограничение данных, к которым осуществляется доступ, на основе удостоверений или ролей пользователей.</span><span class="sxs-lookup"><span data-stu-id="f4769-301">Also limit which data can be accessed, based on the user's identity or role.</span></span> <span data-ttu-id="f4769-302">Используйте Azure AD для управления удостоверениями и доступом, а также Key Vault для управления ключами и секретами.</span><span class="sxs-lookup"><span data-stu-id="f4769-302">Use Azure AD for identity and access control and Key Vault to manage keys and secrets.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="f4769-303">Вопросы управляемости</span><span class="sxs-lookup"><span data-stu-id="f4769-303">Manageability considerations</span></span>

### <a name="monitoring-and-reporting"></a><span data-ttu-id="f4769-304">Мониторинг и создание отчетов</span><span class="sxs-lookup"><span data-stu-id="f4769-304">Monitoring and reporting</span></span>

<span data-ttu-id="f4769-305">После того, как бот будет развернут в рабочей среде, команда DevOps должна поддерживать его в работоспособном состоянии.</span><span class="sxs-lookup"><span data-stu-id="f4769-305">Once your bot is running in production, you will need a DevOps team to keep it that way.</span></span> <span data-ttu-id="f4769-306">Постоянный мониторинг системы позволит убедиться, что бот работает с оптимальной производительностью.</span><span class="sxs-lookup"><span data-stu-id="f4769-306">Continually monitor the system to ensure the bot operates at peak performance.</span></span> <span data-ttu-id="f4769-307">Создайте панели мониторинга на основе журналов, отправляемых в Application Insights или Cosmos DB, с помощью той же службы Application Insights, Power BI или пользовательского веб-приложения для мониторинга.</span><span class="sxs-lookup"><span data-stu-id="f4769-307">Use the logs sent to Application Insights or Cosmos DB to create monitoring dashboards, either using Application Insights itself, Power BI, or a custom web app dashboard.</span></span> <span data-ttu-id="f4769-308">Отправляйте оповещения команде DevOps при возникновении критических ошибок или снижении производительности ниже допустимого порога.</span><span class="sxs-lookup"><span data-stu-id="f4769-308">Send alerts to the DevOps team if critical errors occur or performance falls below an acceptable threshold.</span></span>

### <a name="automated-resource-deployment"></a><span data-ttu-id="f4769-309">Автоматизированное развертывание ресурсов</span><span class="sxs-lookup"><span data-stu-id="f4769-309">Automated resource deployment</span></span>

<span data-ttu-id="f4769-310">Сам бот является частью более крупной системы, которая поддерживает его работу и снабжает его актуальными данными.</span><span class="sxs-lookup"><span data-stu-id="f4769-310">The bot itself is only part of a larger system that provides it with the latest data and ensures its proper operation.</span></span> <span data-ttu-id="f4769-311">Для этого нужно развернуть разные ресурсы Azure: службы оркестрации данных, например Фабрику данных; службы хранилища, например Cosmos DB и т. д.</span><span class="sxs-lookup"><span data-stu-id="f4769-311">All of these other Azure resources &mdash; data orchestration services such as Data Factory, storage services such as Cosmos DB, and so forth &mdash; must be deployed.</span></span> <span data-ttu-id="f4769-312">Azure Resource Manager предоставляет слой согласованного управления, доступный через портал Azure, PowerShell или Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="f4769-312">Azure Resource Manager provides a consistent management layer that you can access through the Azure portal, PowerShell, or the Azure CLI.</span></span> <span data-ttu-id="f4769-313">Чтобы обеспечить скорость и согласованность, мы рекомендуем автоматизировать развертывание с помощью одного из описанных подходов.</span><span class="sxs-lookup"><span data-stu-id="f4769-313">For speed and consistency, it's best to automate your deployment using one of these approaches.</span></span>

### <a name="continuous-bot-deployment"></a><span data-ttu-id="f4769-314">Непрерывное развертывание бота</span><span class="sxs-lookup"><span data-stu-id="f4769-314">Continuous bot deployment</span></span>

<span data-ttu-id="f4769-315">Вы можете развернуть логику бота прямо из интегрированной среды разработки или с помощью командной строки, например Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="f4769-315">You can deploy the bot logic directly from your IDE or from a command line, such as the Azure CLI.</span></span> <span data-ttu-id="f4769-316">По мере усложнения бота лучше всего применить процесс непрерывного развертывания на основе одного из решений CI/CD (например, Azure DevOps), как описано в статье [о непрерывном развертывании](/azure/bot-service/bot-service-build-continuous-deployment).</span><span class="sxs-lookup"><span data-stu-id="f4769-316">As your bot matures, however, it's best to use a continual deployment process using a CI/CD solution such as Azure DevOps, as described in the article [Set up continuous deployment](/azure/bot-service/bot-service-build-continuous-deployment).</span></span> <span data-ttu-id="f4769-317">Этот способ избавляет от трудностей при тестировании новых функций и исправлений, предоставляя среду, максимально приближенную к рабочим условиям.</span><span class="sxs-lookup"><span data-stu-id="f4769-317">This is a good way to ease the friction in testing new features and fixes in your bot in a near-production environment.</span></span> <span data-ttu-id="f4769-318">Также мы рекомендуем иметь несколько сред развертывания, по меньшей мере отдельные промежуточную и рабочую среды.</span><span class="sxs-lookup"><span data-stu-id="f4769-318">It's also a good idea to have multiple deployment environments, typically at least staging and production.</span></span> <span data-ttu-id="f4769-319">Azure DevOps поддерживает такой подход.</span><span class="sxs-lookup"><span data-stu-id="f4769-319">Azure DevOps supports this approach.</span></span>

<!-- links -->

[0]: ./_images/conversational-bot.png
[aad]: /azure/active-directory/
[действия]: /azure/bot-service/rest-api/bot-framework-rest-connector-activities
[activities]: /azure/bot-service/rest-api/bot-framework-rest-connector-activities
[aml]: /azure/machine-learning/service/
[app-insights]: /azure/azure-monitor/app/app-insights-overview
[app-service]: /azure/app-service/
[blob]: /azure/storage/blobs/storage-blobs-introduction
[bot-authentication]: /azure/bot-service/bot-builder-authentication
[bot-framework]: https://dev.botframework.com/
[bot-framework-service]: /azure/bot-service/bot-builder-basics
[cognitive-services]: /azure/cognitive-services/welcome
[Беседы]: /azure/bot-service/bot-service-design-conversation-flow
[conversations]: /azure/bot-service/bot-service-design-conversation-flow
[cosmosdb]: /azure/cosmos-db/
[data-factory]: /azure/data-factory/
[data-factory-ref-arch]: ../data/enterprise-bi-adf.md
[devops]: https://azure.microsoft.com/solutions/devops/
[functions]: /azure/azure-functions/
[functions-triggers]: /azure/azure-functions/functions-triggers-bindings
[git-repo-appinsights-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-app-insights
[git-repo-base]: https://github.com/Microsoft/botbuilder-utils-js
[git-repo-cosmosdb-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-cosmosdb
[git-repo-feedback-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-feedback
[git-repo-testing-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder
[testing-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder
[key-vault]: /azure/key-vault/
[lda]: https://wikipedia.org/wiki/Latent_Dirichlet_allocation/
[logic-apps]: /azure/logic-apps/logic-apps-overview
[luis]: /azure/cognitive-services/luis/
[power-bi]: /power-bi/
[qna-maker]: /azure/cognitive-services/QnAMaker/
[search]: /azure/search/
[slots]: /azure/app-service/deploy-staging-slots/
[synonyms]: /azure/search/search-synonyms
[transcript-storage]: /azure/bot-service/bot-builder-howto-v4-storage
[шаги]: /azure/bot-service/bot-builder-basics#defining-a-turn
[turns]: /azure/bot-service/bot-builder-basics#defining-a-turn
[vscode]: https://azure.microsoft.com/products/visual-studio-code/
[webapp]: /azure/app-service/overview
[webchat]: /azure/bot-service/bot-service-channel-connect-webchat?view=azure-bot-service-4.0/

[cosmosdb-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-cosmosdb
[appinsights-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-app-insights
[feedback-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-feedback
[testing util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder

