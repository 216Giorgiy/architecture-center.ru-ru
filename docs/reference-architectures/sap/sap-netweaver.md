---
title: Развертывание SAP NetWeaver (Windows) для баз сторонних поставщиков на виртуальных машинах Azure
description: Проверенные методики по запуску SAP S/4HANA в высокодоступной среде Linux в Azure.
author: lbrader
ms.date: 05/11/2018
ms.openlocfilehash: 90334e4872bdd15d59aa16286a031d07f3d1bb2f
ms.sourcegitcommit: 86d86d71e392550fd65c4f76320d7ecf0b72e1f6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/06/2018
ms.locfileid: "37864544"
---
# <a name="deploy-sap-netweaver-windows-for-anydb-on-azure-virtual-machines"></a><span data-ttu-id="c07cb-103">Развертывание SAP NetWeaver (Windows) для баз сторонних поставщиков на виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="c07cb-103">Deploy SAP NetWeaver (Windows) for AnyDB on Azure Virtual Machines</span></span>

<span data-ttu-id="c07cb-104">В этой эталонной архитектуре показан набор методик по запуску SAP NetWeaver в высокодоступной среде Windows в Azure.</span><span class="sxs-lookup"><span data-stu-id="c07cb-104">This reference architecture shows a set of proven practices for running SAP NetWeaver in a Windows environment on Azure with high availability.</span></span> <span data-ttu-id="c07cb-105">База данных сторонних поставщиков, или так называемая база данных AnyDB, — это термин SAP, который применяется к любой поддерживаемой СУБД, кроме SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="c07cb-105">The database is AnyDB, the SAP term for any supported DBMS besides SAP HANA.</span></span> <span data-ttu-id="c07cb-106">Эта архитектура развертывается с конкретными размерами виртуальных машин, которые можно изменить в соответствии с потребностями вашей организации.</span><span class="sxs-lookup"><span data-stu-id="c07cb-106">This architecture is deployed with specific virtual machine (VM) sizes that can be changed to accommodate your organization's needs.</span></span>

![](./images/sap-netweaver.png)

<span data-ttu-id="c07cb-107">*Скачайте [файл Visio][visio-download] этой архитектуры.*</span><span class="sxs-lookup"><span data-stu-id="c07cb-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE] 
> <span data-ttu-id="c07cb-108">Для развертывания этой эталонной архитектуры требуется соответствующее лицензирование продуктов SAP и другие технологии сторонних производителей.</span><span class="sxs-lookup"><span data-stu-id="c07cb-108">Deploying this reference architecture requires appropriate licensing of SAP products and other non-Microsoft technologies.</span></span>

## <a name="architecture"></a><span data-ttu-id="c07cb-109">Архитектура</span><span class="sxs-lookup"><span data-stu-id="c07cb-109">Architecture</span></span>
<span data-ttu-id="c07cb-110">Архитектура состоит из следующих компонентов инфраструктуры и основных программных компонентов.</span><span class="sxs-lookup"><span data-stu-id="c07cb-110">The architecture consists of the following infrastructure and key software components.</span></span>

<span data-ttu-id="c07cb-111">**Виртуальная сеть**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-111">**Virtual network**.</span></span> <span data-ttu-id="c07cb-112">Служба виртуальной сети Azure обеспечивает безопасное подключение ресурсов Azure друг к другу.</span><span class="sxs-lookup"><span data-stu-id="c07cb-112">The Azure Virtual Network service securely connects Azure resources to each other.</span></span> <span data-ttu-id="c07cb-113">В этой архитектуре виртуальная сеть подключается к локальной среде через VPN-шлюз, развернутый в концентраторе в рамках [звездообразной топологии](../hybrid-networking/hub-spoke.md).</span><span class="sxs-lookup"><span data-stu-id="c07cb-113">In this architecture, the virtual network connects to an on-premises environment through a VPN gateway deployed in the hub of a [hub-spoke](../hybrid-networking/hub-spoke.md).</span></span> <span data-ttu-id="c07cb-114">Периферией выступает виртуальная сеть, используемая для уровня приложений SAP и уровня базы данных.</span><span class="sxs-lookup"><span data-stu-id="c07cb-114">The spoke is the virtual network used for the SAP applications and database tier.</span></span>

<span data-ttu-id="c07cb-115">**Подсети.**</span><span class="sxs-lookup"><span data-stu-id="c07cb-115">**Subnets**.</span></span> <span data-ttu-id="c07cb-116">Виртуальная сеть подразделяется на отдельные подсети для каждого уровня: приложение (SAP NetWeaver), база данных, общие службы (jumpbox) и Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c07cb-116">The virtual network is subdivided into separate subnets for each tier: application (SAP NetWeaver), database, shared services (the jumpbox), and Active Directory.</span></span>
    
<span data-ttu-id="c07cb-117">**Виртуальные машины**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-117">**Virtual machines**.</span></span> <span data-ttu-id="c07cb-118">Эта архитектура использует виртуальные машины для уровня приложения и уровня базы данных. Они сгруппированы следующим образом:</span><span class="sxs-lookup"><span data-stu-id="c07cb-118">This architecture uses virtual machines for the application tier and database tier, grouped as follows:</span></span>

- <span data-ttu-id="c07cb-119">**SAP NetWeaver**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-119">**SAP NetWeaver**.</span></span> <span data-ttu-id="c07cb-120">На уровне приложений используются виртуальные машины Windows и выполняются центральные службы и серверы приложений SAP.</span><span class="sxs-lookup"><span data-stu-id="c07cb-120">The application tier uses Windows virtual machines and runs SAP Central Services and SAP application servers.</span></span> <span data-ttu-id="c07cb-121">Виртуальные машины, на которых выполняются центральные службы, настроены как отказоустойчивый кластер Windows Server для обеспечения высокого уровня доступности, поддерживаемого SIOS DataKeeper Cluster Edition.</span><span class="sxs-lookup"><span data-stu-id="c07cb-121">The VMs that run Central Services are configured as a Windows Server Failover Cluster for high availability, supported by SIOS DataKeeper Cluster Edition.</span></span>
- <span data-ttu-id="c07cb-122">**AnyDB**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-122">**AnyDB**.</span></span> <span data-ttu-id="c07cb-123">На уровне базы данных AnyDB выполняется как база данных-источник, например Microsoft SQL Server, Oracle или IBM DB2.</span><span class="sxs-lookup"><span data-stu-id="c07cb-123">The database tier runs AnyDB as the source database, such as Microsoft SQL Server, Oracle, or IBM DB2.</span></span>
- <span data-ttu-id="c07cb-124">**Jumpbox**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-124">**Jumpbox**.</span></span> <span data-ttu-id="c07cb-125">Он также называется узлом-бастионом.</span><span class="sxs-lookup"><span data-stu-id="c07cb-125">Also called a bastion host.</span></span> <span data-ttu-id="c07cb-126">Это безопасная виртуальная машина в сети, которую администраторы используют для подключения к другим виртуальным машинам.</span><span class="sxs-lookup"><span data-stu-id="c07cb-126">This is a secure virtual machine on the network that administrators use to connect to the other virtual machines.</span></span>
- <span data-ttu-id="c07cb-127">**Контроллеры домена Windows Server Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-127">**Windows Server Active Directory domain controllers**.</span></span> <span data-ttu-id="c07cb-128">Контроллеры домена используются для всех виртуальных машин и пользователей в домене.</span><span class="sxs-lookup"><span data-stu-id="c07cb-128">The domain controllers are used on all VMs and users in the domain.</span></span>

<span data-ttu-id="c07cb-129">**Подсистемы балансировки нагрузки.**</span><span class="sxs-lookup"><span data-stu-id="c07cb-129">**Load balancers**.</span></span> <span data-ttu-id="c07cb-130">Для достижения высокого уровня доступности используются как встроенные подсистемы балансировки нагрузки SAP, так и [Azure Load Balancer](/azure/load-balancer/load-balancer-overview).</span><span class="sxs-lookup"><span data-stu-id="c07cb-130">Both built-in SAP load balancers and [Azure Load Balancer](/azure/load-balancer/load-balancer-overview) are used to achieve HA.</span></span> <span data-ttu-id="c07cb-131">Экземпляры Azure Load Balancer распределяют трафик на виртуальные машины в подсети уровня приложения.</span><span class="sxs-lookup"><span data-stu-id="c07cb-131">Azure Load Balancer instances are used to distribute traffic to virtual machines in the application tier subnet.</span></span>

<span data-ttu-id="c07cb-132">**Группы доступности**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-132">**Availability sets**.</span></span> <span data-ttu-id="c07cb-133">Виртуальные машины для веб-диспетчера SAP, сервера приложений SAP и ролей (A)SCS объединяются в отдельные [группы доступности](/azure/virtual-machines/windows/tutorial-availability-sets). На роль выделяется по меньшей мере две виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="c07cb-133">Virtual machines for the SAP Web Dispatcher, SAP application server, and (A)SCS, roles are grouped into separate [availability sets](/azure/virtual-machines/windows/tutorial-availability-sets), and at least two virtual machines are provisioned per role.</span></span> <span data-ttu-id="c07cb-134">Таким образом виртуальные машины станут подходящими для [соглашения об уровне обслуживания (SLA)](https://azure.microsoft.com/support/legal/sla/virtual-machines) более высокого уровня.</span><span class="sxs-lookup"><span data-stu-id="c07cb-134">This makes the virtual machines eligible for a higher [service level agreement](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA).</span></span>

<span data-ttu-id="c07cb-135">**Сетевые карты**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-135">**NICs**.</span></span> <span data-ttu-id="c07cb-136">[Сетевые карты](/azure/virtual-network/virtual-network-network-interface) (NIC) позволяют осуществлять связь между всеми виртуальными машинами в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="c07cb-136">[Network interface cards](/azure/virtual-network/virtual-network-network-interface) (NICs) enable all communication of virtual machines on a virtual network.</span></span>

<span data-ttu-id="c07cb-137">**Группы безопасности сети**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-137">**Network security groups**.</span></span> <span data-ttu-id="c07cb-138">[Они](/azure/virtual-network/virtual-networks-nsg) (NSG) позволяют ограничить входящий, исходящий трафик и трафик внутри подсети в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="c07cb-138">To restrict incoming, outgoing, and intra-subnet traffic in the virtual network, you can create [network security groups](/azure/virtual-network/virtual-networks-nsg) (NSGs).</span></span>

<span data-ttu-id="c07cb-139">**Шлюз.**</span><span class="sxs-lookup"><span data-stu-id="c07cb-139">**Gateway**.</span></span> <span data-ttu-id="c07cb-140">Шлюз расширяет локальную сеть до виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="c07cb-140">A gateway extends your on-premises network to the Azure virtual network.</span></span> <span data-ttu-id="c07cb-141">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) — рекомендуемая служба Azure для создания частных подключений, которые не проходят через общедоступный Интернет, но также можно использовать [подключение типа "сеть — сеть"](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal).</span><span class="sxs-lookup"><span data-stu-id="c07cb-141">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) is the recommended Azure service for creating private connections that do not go over the public Internet, but a [Site-to-Site](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) connection can also be used.</span></span>

<span data-ttu-id="c07cb-142">**Хранилище Azure.**</span><span class="sxs-lookup"><span data-stu-id="c07cb-142">**Azure Storage**.</span></span> <span data-ttu-id="c07cb-143">Для предоставления постоянного хранилища виртуального жесткого диска (VHD) виртуальной машины требуется [хранилище Azure](/azure/storage/storage-standard-storage).</span><span class="sxs-lookup"><span data-stu-id="c07cb-143">To provide persistent storage of a virtual machine's virtual hard disk (VHD), [Azure Storage](/azure/storage/storage-standard-storage) is required.</span></span> <span data-ttu-id="c07cb-144">Ее также использует [облако-свидетель](/windows-server/failover-clustering/deploy-cloud-witness) для работы отказоустойчивого кластера.</span><span class="sxs-lookup"><span data-stu-id="c07cb-144">It is also used by [Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) to implement a failover cluster operation.</span></span> 

## <a name="recommendations"></a><span data-ttu-id="c07cb-145">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="c07cb-145">Recommendations</span></span>
<span data-ttu-id="c07cb-146">Описанная здесь архитектура может не соответствовать вашим требованиям.</span><span class="sxs-lookup"><span data-stu-id="c07cb-146">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="c07cb-147">Воспользуйтесь этими рекомендациями в качестве отправной точки.</span><span class="sxs-lookup"><span data-stu-id="c07cb-147">Use these recommendations as a starting point.</span></span>

### <a name="sap-web-dispatcher-pool"></a><span data-ttu-id="c07cb-148">Пул веб-диспетчера SAP</span><span class="sxs-lookup"><span data-stu-id="c07cb-148">SAP Web Dispatcher pool</span></span>

<span data-ttu-id="c07cb-149">Компонент "веб-диспетчер" используется как подсистема балансировки нагрузки для трафика SAP между серверами приложений SAP.</span><span class="sxs-lookup"><span data-stu-id="c07cb-149">The Web Dispatcher component is used as a load balancer for SAP traffic among the SAP application servers.</span></span> <span data-ttu-id="c07cb-150">Чтобы обеспечить высокий уровень доступности для компонента "веб-диспетчер", Azure Load Balancer реализует параллельную установку веб-диспетчера.</span><span class="sxs-lookup"><span data-stu-id="c07cb-150">To achieve high availability for the Web Dispatcher component, Azure Load Balancer is used to implement the parallel Web Dispatcher setup.</span></span> <span data-ttu-id="c07cb-151">Веб-диспетчер использует циклическую конфигурацию для распределения трафика HTTP (S) среди доступных веб-диспетчеров в пуле балансировщиков.</span><span class="sxs-lookup"><span data-stu-id="c07cb-151">Web Dispatcher uses in a round-robin configuration for HTTP(S) traffic distribution among the available Web Dispatchers in the balancers pool.</span></span>

<span data-ttu-id="c07cb-152">Дополнительные сведения см. в статье [SAP NetWeaver на виртуальных машинах Windows. Руководство по планированию и внедрению](/azure/virtual-machines/workloads/sap/planning-guide).</span><span class="sxs-lookup"><span data-stu-id="c07cb-152">For details about running SAP NetWeaver in Azure VMs, see [Azure Virtual Machines planning and implementation for SAP NetWeaver](/azure/virtual-machines/workloads/sap/planning-guide).</span></span>

### <a name="application-servers-pool"></a><span data-ttu-id="c07cb-153">Пул серверов приложений</span><span class="sxs-lookup"><span data-stu-id="c07cb-153">Application servers pool</span></span>

<span data-ttu-id="c07cb-154">Для управления группами входа для серверов приложений ABAP используется транзакция SMLG.</span><span class="sxs-lookup"><span data-stu-id="c07cb-154">To manage logon groups for ABAP application servers, the SMLG transaction is used.</span></span> <span data-ttu-id="c07cb-155">Она использует функцию балансировки нагрузки на сервере сообщений центральных служб для распределения рабочей нагрузки между пулом серверов приложений SAP для трафика SAPGUI и RFC.</span><span class="sxs-lookup"><span data-stu-id="c07cb-155">It uses the load balancing function within the message server of the Central Services to distribute workload among SAP application servers pool for SAPGUIs and RFC traffic.</span></span> <span data-ttu-id="c07cb-156">Подключение сервера приложений к высокодоступным центральным службам осуществляется по имени виртуальной сети кластера.</span><span class="sxs-lookup"><span data-stu-id="c07cb-156">The application server connection to the highly available Central Services is through the cluster virtual network name.</span></span>

### <a name="sap-central-services-cluster"></a><span data-ttu-id="c07cb-157">Кластер центральных служб SAP</span><span class="sxs-lookup"><span data-stu-id="c07cb-157">SAP Central Services cluster</span></span>

<span data-ttu-id="c07cb-158">Эта эталонная архитектура запускает центральные службы на виртуальных машинах на уровне приложений.</span><span class="sxs-lookup"><span data-stu-id="c07cb-158">This reference architecture runs Central Services on VMs in the application tier.</span></span> <span data-ttu-id="c07cb-159">Центральные службы представляют собой потенциальную единую точку отказа (SPOF) при развертывании в одну виртуальную машину. Это обычное развертывание, при котором высокий уровень доступности не требуется.</span><span class="sxs-lookup"><span data-stu-id="c07cb-159">The Central Services is a potential single point of failure (SPOF) when deployed to a single VM—typical deployment when high availability is not a requirement.</span></span> <span data-ttu-id="c07cb-160">Реализовать решение высокого уровня доступности можно с помощью кластера общих дисков или кластера общих файлов.</span><span class="sxs-lookup"><span data-stu-id="c07cb-160">To implement a high availability solution, either a shared disk cluster or a file share cluster can be used.</span></span>

<span data-ttu-id="c07cb-161">Чтобы настроить виртуальные машины для кластера общих дисков, используйте [отказоустойчивый кластер Windows Server](https://blogs.sap.com/2018/01/25/how-to-create-sap-resources-in-windows-failover-cluster/).</span><span class="sxs-lookup"><span data-stu-id="c07cb-161">To configure VMs for a shared disk cluster, use [Windows Server Failover Cluster](https://blogs.sap.com/2018/01/25/how-to-create-sap-resources-in-windows-failover-cluster/).</span></span> <span data-ttu-id="c07cb-162">Рекомендуем использовать [облако-свидетель](/windows-server/failover-clustering/deploy-cloud-witness) в качестве свидетеля кворума.</span><span class="sxs-lookup"><span data-stu-id="c07cb-162">[Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) is recommended as a quorum witness.</span></span> <span data-ttu-id="c07cb-163">Чтобы поддержать среду отказоустойчивого кластера, [SIOS DataKeeper Cluster Edition](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8) выполняет функции общего тома кластера, реплицируя независимые диски, принадлежащие узлам кластера.</span><span class="sxs-lookup"><span data-stu-id="c07cb-163">To support the failover cluster environment, [SIOS DataKeeper Cluster Edition](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8) performs the cluster shared volume function by replicating independent disks owned by the cluster nodes.</span></span> <span data-ttu-id="c07cb-164">Azure изначально не поддерживает общие диски и поэтому необходимы решения, предоставленные SIOS.</span><span class="sxs-lookup"><span data-stu-id="c07cb-164">Azure does not natively support shared disks and therefore requires solutions provided by SIOS.</span></span>

<span data-ttu-id="c07cb-165">Дополнительные сведения см. в разделе 3</span><span class="sxs-lookup"><span data-stu-id="c07cb-165">For details, see "3.</span></span> <span data-ttu-id="c07cb-166">о важном обновлении для клиентов SAP, использующих ASCS на SIOS в Azure, в записи блога [Running SAP applications on the Microsoft platform](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/) (Запуск приложений SAP на платформе Майкрософт).</span><span class="sxs-lookup"><span data-stu-id="c07cb-166">Important Update for SAP Customers Running ASCS on SIOS on Azure” at [Running SAP applications on the Microsoft platform](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/).</span></span>

<span data-ttu-id="c07cb-167">Еще один способ обработки кластеризации — реализовать кластер общих файлов с помощью отказоустойчивого кластера Windows Server.</span><span class="sxs-lookup"><span data-stu-id="c07cb-167">Another way to handle clustering is to implement a file share cluster using Windows Server Failover Cluster.</span></span> <span data-ttu-id="c07cb-168">В [SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster/) недавно изменили шаблон развертывания центральных служб для доступа к глобальным каталогам /sapmnt через UNC-путь.</span><span class="sxs-lookup"><span data-stu-id="c07cb-168">[SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster/) recently modified the Central Services deployment pattern to access the /sapmnt global directories via a UNC path.</span></span> <span data-ttu-id="c07cb-169">Это изменение [устраняет требование](https://blogs.msdn.microsoft.com/saponsqlserver/2017/08/10/high-available-ascs-for-windows-on-file-share-shared-disk-no-longer-required/) для SIOS или других решений общих дисков на виртуальных машинах центральных служб.</span><span class="sxs-lookup"><span data-stu-id="c07cb-169">This change [removes the requirement](https://blogs.msdn.microsoft.com/saponsqlserver/2017/08/10/high-available-ascs-for-windows-on-file-share-shared-disk-no-longer-required/) for SIOS or other shared disk solutions on the Central Services VMs.</span></span> <span data-ttu-id="c07cb-170">Мы по-прежнему рекомендуем убедиться, что общий ресурс UNC /sapmnt имеет [высокий уровень доступности](https://blogs.sap.com/2017/07/21/how-to-create-a-high-available-sapmnt-share/).</span><span class="sxs-lookup"><span data-stu-id="c07cb-170">It is still recommended to ensure that the /sapmnt UNC share is [highly available](https://blogs.sap.com/2017/07/21/how-to-create-a-high-available-sapmnt-share/).</span></span> <span data-ttu-id="c07cb-171">Это можно сделать в экземпляре центральных служб с помощью отказоустойчивого кластера Windows Server с функцией [масштабируемого файлового сервера](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) и [локальных дисковых пространств](https://blogs.sap.com/2018/03/07/your-sap-on-azure-part-5-ascs-high-availability-with-storage-spaces-direct/) (S2D) в Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="c07cb-171">This can be done on the Central Services instance by using Windows Server Failover Cluster with [Scale Out File Server](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) and the [Storage Spaces Direct](https://blogs.sap.com/2018/03/07/your-sap-on-azure-part-5-ascs-high-availability-with-storage-spaces-direct/) (S2D) feature in Windows Server 2016.</span></span> 

### <a name="availability-sets"></a><span data-ttu-id="c07cb-172">Группы доступности</span><span class="sxs-lookup"><span data-stu-id="c07cb-172">Availability sets</span></span>

<span data-ttu-id="c07cb-173">Группы доступности распределяют серверы между разными физическими инфраструктурами и группами обновлений для повышения доступности служб.</span><span class="sxs-lookup"><span data-stu-id="c07cb-173">Availability sets distribute servers to different physical infrastructure and update groups to improve service availability.</span></span> <span data-ttu-id="c07cb-174">Поместите виртуальные машины, которые выполняют одинаковую роль, в группы доступности во избежание простоя, вызванного обслуживанием инфраструктуры Azure, и для соответствия [Соглашениям об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA).</span><span class="sxs-lookup"><span data-stu-id="c07cb-174">Put virtual machines that perform the same role into an availability sets to help guard against downtime caused by Azure infrastructure maintenance and to meet [SLAs](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLAs).</span></span> <span data-ttu-id="c07cb-175">Рекомендуется использовать две или более виртуальных машин на группу доступности.</span><span class="sxs-lookup"><span data-stu-id="c07cb-175">Two or more virtual machines per availability set is recommended.</span></span>

<span data-ttu-id="c07cb-176">Все виртуальные машины в группе должны выполнять ту же роль.</span><span class="sxs-lookup"><span data-stu-id="c07cb-176">All virtual machines in a set must perform the same role.</span></span> <span data-ttu-id="c07cb-177">Не смешивайте серверы разных ролей в одной группе доступности.</span><span class="sxs-lookup"><span data-stu-id="c07cb-177">Do not mix servers of different roles in the same availability set.</span></span> <span data-ttu-id="c07cb-178">Например, не размещайте узел центральных служб в одной группе доступности с сервером приложений.</span><span class="sxs-lookup"><span data-stu-id="c07cb-178">For example, don't place a Central Services node in the same availability set with the application server.</span></span>

### <a name="nics"></a><span data-ttu-id="c07cb-179">сетевые карты;</span><span class="sxs-lookup"><span data-stu-id="c07cb-179">NICs</span></span>

<span data-ttu-id="c07cb-180">Обычные локальные развертывания SAP реализуют несколько сетевых карт (NIC) на один компьютер для отделения административного трафика от бизнес-трафика.</span><span class="sxs-lookup"><span data-stu-id="c07cb-180">Traditional on-premises SAP deployments implement multiple network interface cards (NICs) per machine to segregate administrative traffic from business traffic.</span></span> <span data-ttu-id="c07cb-181">В Azure виртуальная сеть представляет собой программно-определяемую сеть, которая отправляет весь трафик через одну и ту же сетевую структуру.</span><span class="sxs-lookup"><span data-stu-id="c07cb-181">On Azure, the virtual network is a software-defined network that sends all traffic through the same network fabric.</span></span> <span data-ttu-id="c07cb-182">Поэтому использование нескольких сетевых адаптеров не требуется.</span><span class="sxs-lookup"><span data-stu-id="c07cb-182">Therefore, the use of multiple NICs is unnecessary.</span></span> <span data-ttu-id="c07cb-183">Однако, если вашей организации необходимо разделить трафик, вы можете развернуть несколько сетевых карт на одну виртуальную машину, подключить каждую карту к другой подсети, а затем использовать NSG для применения различных политик управления доступом.</span><span class="sxs-lookup"><span data-stu-id="c07cb-183">However, if your organization needs to segregate traffic, you can deploy multiple NICs per VM, connect each NIC to a different subnet, and then use NSGs to enforce different access control policies.</span></span>

### <a name="subnets-and-nsgs"></a><span data-ttu-id="c07cb-184">Подсети и группы безопасности сети</span><span class="sxs-lookup"><span data-stu-id="c07cb-184">Subnets and NSGs</span></span>

<span data-ttu-id="c07cb-185">Эта архитектура подразделяет адресное пространство виртуальной сети на подсети.</span><span class="sxs-lookup"><span data-stu-id="c07cb-185">This architecture subdivides the virtual network address space into subnets.</span></span> <span data-ttu-id="c07cb-186">В основном она фокусируется на подсети уровня приложения.</span><span class="sxs-lookup"><span data-stu-id="c07cb-186">This reference architecture focuses primarily on the application tier subnet.</span></span> <span data-ttu-id="c07cb-187">Каждая подсеть может быть связана с NSG, которая определяет политики доступа для подсети.</span><span class="sxs-lookup"><span data-stu-id="c07cb-187">Each subnet can be associated with a NSG that defines the access policies for the subnet.</span></span> <span data-ttu-id="c07cb-188">Разместите серверы приложений в отдельной подсети, чтобы упростить их защиту за счет управления политиками безопасности подсети, а не отдельными серверами.</span><span class="sxs-lookup"><span data-stu-id="c07cb-188">Place application servers on a separate subnet so you can secure them more easily by managing the subnet security policies, not the individual servers.</span></span>

<span data-ttu-id="c07cb-189">Если NSG связана с подсетью, она применяется ко всем серверам в подсети.</span><span class="sxs-lookup"><span data-stu-id="c07cb-189">When a NSG is associated with a subnet, it applies to all the servers within the subnet.</span></span> <span data-ttu-id="c07cb-190">Дополнительные сведения об использовании NSG для точного управления серверами в подсети см. в [этой статье](https://azure.microsoft.com/en-us/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/).</span><span class="sxs-lookup"><span data-stu-id="c07cb-190">For more information about using NSGs for fine-grained control over the servers in a subnet, see [Filter network traffic with network security groups](https://azure.microsoft.com/en-us/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/).</span></span>

### <a name="load-balancers"></a><span data-ttu-id="c07cb-191">Балансировщики нагрузки</span><span class="sxs-lookup"><span data-stu-id="c07cb-191">Load balancers</span></span>

<span data-ttu-id="c07cb-192">[Веб-диспетчер SAP](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) обрабатывает балансировку нагрузки трафика HTTP(S) к пулу серверов приложений SAP.</span><span class="sxs-lookup"><span data-stu-id="c07cb-192">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) handles load balancing of HTTP(S) traffic to a pool of SAP application servers.</span></span>

<span data-ttu-id="c07cb-193">Для трафика от клиентов SAP GUI, подключающихся к серверу SAP по протоколу DIAG или с помощью удаленных вызовов функций (RFC), сервер обмена сообщениями центральных служб распределяет нагрузку через [группы входа](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing) сервера приложений SAP, поэтому дополнительная подсистема балансировки нагрузки не требуется.</span><span class="sxs-lookup"><span data-stu-id="c07cb-193">For traffic from SAP GUI clients connecting a SAP server via DIAG protocol or Remote Function Calls (RFC), the Central Services message server balances the load through SAP application server [logon groups](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing), so no additional load balancer is needed.</span></span>

### <a name="azure-storage"></a><span data-ttu-id="c07cb-194">Хранилище Azure</span><span class="sxs-lookup"><span data-stu-id="c07cb-194">Azure Storage</span></span>

<span data-ttu-id="c07cb-195">Для виртуальных машин сервера базы данных рекомендуем использовать хранилище Azure класса Premium для согласованных задержек чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="c07cb-195">For all database server virtual machines, we recommend using Azure Premium Storage for consistent read/write latency.</span></span> <span data-ttu-id="c07cb-196">Дополнительные сведения об использовании хранилища Azure класса Premium для всех дисков ОС и дисков данных для одноэкземплярной виртуальной машины см. в статье [Соглашение об уровне обслуживания для виртуальных машин](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="c07cb-196">For any single instance virtual machine using Premium Storage for all operating system disks and data disks, see [SLA for Virtual Machines](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span></span> <span data-ttu-id="c07cb-197">Кроме того, для производственных систем SAP мы рекомендуем во всех случаях использовать [управляемые диски Azure](/azure/storage/storage-managed-disks-overview) уровня "Премиум".</span><span class="sxs-lookup"><span data-stu-id="c07cb-197">Also, for production SAP systems, we recommend using Premium [Azure Managed Disks](/azure/storage/storage-managed-disks-overview) in all cases.</span></span> <span data-ttu-id="c07cb-198">Управляемые диски используются для управления VHD-файлами для дисков.</span><span class="sxs-lookup"><span data-stu-id="c07cb-198">For reliability, Managed Disks are used to manage the VHD files for the disks.</span></span> <span data-ttu-id="c07cb-199">Они также обеспечивают изоляцию дисков для виртуальных машин в группе доступности, что помогает избежать единых точек отказа.</span><span class="sxs-lookup"><span data-stu-id="c07cb-199">Managed disks ensure that the disks for virtual machines within an availability set are isolated to avoid single points of failure.</span></span>

<span data-ttu-id="c07cb-200">Для серверов приложений SAP, включая виртуальные машины центральных служб, можно использовать службу хранилища Azure класса Standard, чтобы уменьшить затраты, так как выполнение приложений происходит в памяти и диски используются только для ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="c07cb-200">For SAP application servers, including the Central Services virtual machines, you can use Azure Standard Storage to reduce cost, because application execution takes place in memory and disks are used for logging only.</span></span> <span data-ttu-id="c07cb-201">Однако в настоящее время хранилище класса Standard сертифицировано только для неуправляемого хранилища.</span><span class="sxs-lookup"><span data-stu-id="c07cb-201">However, at this time, Standard Storage is only certified for unmanaged storage.</span></span> <span data-ttu-id="c07cb-202">Так как серверы приложений не содержат никаких данных, вы также можете использовать меньшие диски хранилища класса Premium P4 и P6 для сокращения затрат.</span><span class="sxs-lookup"><span data-stu-id="c07cb-202">Since application servers do not host any data, you can also use the smaller P4 and P6 Premium Storage disks to help minimize cost.</span></span>

<span data-ttu-id="c07cb-203">Кроме того, с помощью службы хранилища Azure [облако-свидетель](/windows-server/failover-clustering/deploy-cloud-witness) поддерживает кворум с устройством в регионе Azure, удаленном от основного региона, где находится кластер.</span><span class="sxs-lookup"><span data-stu-id="c07cb-203">Azure Storage is also used by [Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) to maintain quorum with a device in a remote Azure region away from the primary region where the cluster resides.</span></span>

<span data-ttu-id="c07cb-204">Для хранилища резервных копий рекомендуем использовать хранилище [холодного уровня доступа](/azure/storage/storage-blob-storage-tiers) и [архивного уровня доступа](/azure/storage/storage-blob-storage-tiers) Azure.</span><span class="sxs-lookup"><span data-stu-id="c07cb-204">For the backup data store, we recommend using Azure [coolaccess tier](/azure/storage/storage-blob-storage-tiers) and [archive access tier storage](/azure/storage/storage-blob-storage-tiers).</span></span> <span data-ttu-id="c07cb-205">Эти уровни хранилища являются эффективными методами хранения данных, которые редко используются и имеют большой срок хранения.</span><span class="sxs-lookup"><span data-stu-id="c07cb-205">These storage tiers are cost-effective ways to store long-lived data that is infrequently accessed.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="c07cb-206">Рекомендации по производительности</span><span class="sxs-lookup"><span data-stu-id="c07cb-206">Performance considerations</span></span>

<span data-ttu-id="c07cb-207">Серверы приложений SAP поддерживают постоянную связь с серверами баз данных.</span><span class="sxs-lookup"><span data-stu-id="c07cb-207">SAP application servers carry on constant communications with the database servers.</span></span> <span data-ttu-id="c07cb-208">Для снижения задержки записи в журнал рассмотрите возможность включения [ускорителя записи](/azure/virtual-machines/linux/how-to-enable-write-accelerator) в приложениях с обязательным высоким уровнем производительности, выполняющихся на любых платформах баз данных, включая SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="c07cb-208">For performance-critical applications running on any database platforms, including SAP HANA, consider enabling [Write Accelerator](/azure/virtual-machines/linux/how-to-enable-write-accelerator) to improve log write latency.</span></span> <span data-ttu-id="c07cb-209">Чтобы оптимизировать межсерверную связь, используйте [ускоренную сеть](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span><span class="sxs-lookup"><span data-stu-id="c07cb-209">To optimize inter-server communications, use the [Accelerated Network](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span></span> <span data-ttu-id="c07cb-210">Обратите внимание, что эти ускорители доступны только для определенных серий виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="c07cb-210">Note that these accelerators are available only for certain VM series.</span></span>

<span data-ttu-id="c07cb-211">Чтобы добиться высокой скорости операции ввода-вывода и лучшей пропускной способности диска, к структуре хранилища Azure применяются распространенные методы [оптимизации производительности](/azure/virtual-machines/windows/premium-storage-performance) тома хранилища.</span><span class="sxs-lookup"><span data-stu-id="c07cb-211">To achieve high IOPS and disk bandwidth throughput, the common practices in storage volume [performance optimization](/azure/virtual-machines/windows/premium-storage-performance) apply to Azure storage layout.</span></span> <span data-ttu-id="c07cb-212">Например, объединение нескольких дисков вместе для создания чередующегося дискового тома повышает производительность операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="c07cb-212">For example, combining multiple disks together to create a striped disk volume improves IO performance.</span></span> <span data-ttu-id="c07cb-213">Включение кэша чтения в содержимом хранилища, которое редко изменяется, повышает скорость извлечения данных.</span><span class="sxs-lookup"><span data-stu-id="c07cb-213">Enabling the read cache on storage content that changes infrequently enhances the speed of data retrieval.</span></span>

<span data-ttu-id="c07cb-214">Рекомендации по оптимизации хранилища Azure для рабочих нагрузок SAP на SQL Server см. в записи блога [Top 10 Key Considerations for Deploying SAP Applications on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/25/top-10-key-considerations-for-deploying-sap-applications-on-azure/) (10 основных рекомендаций для развертывания приложений SAP в Azure).</span><span class="sxs-lookup"><span data-stu-id="c07cb-214">For SAP on SQL, the [Top 10 Key Considerations for Deploying SAP Applications on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/25/top-10-key-considerations-for-deploying-sap-applications-on-azure/) blog offers excellent advice on optimizing Azure storage for SAP workloads on SQL Server.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="c07cb-215">Вопросы масштабируемости</span><span class="sxs-lookup"><span data-stu-id="c07cb-215">Scalability considerations</span></span>

<span data-ttu-id="c07cb-216">На уровне приложений SAP Azure предлагает широкий диапазон размеров виртуальных машин для вертикального и горизонтального масштабирования. Полный список см. в [примечании SAP № 1928533 о поддерживаемых продуктах и типах виртуальных машин Azure для приложений SAP в Azure](https://launchpad.support.sap.com/#/notes/1928533).</span><span class="sxs-lookup"><span data-stu-id="c07cb-216">At the SAP application layer, Azure offers a wide range of virtual machine sizes for scaling up and scaling out. For an inclusive list, see [SAP note 1928533](https://launchpad.support.sap.com/#/notes/1928533) - SAP Applications on Azure: Supported Products and Azure VM Types.</span></span> <span data-ttu-id="c07cb-217">(Для доступа необходима учетная запись SAP Service Marketplace.)</span><span class="sxs-lookup"><span data-stu-id="c07cb-217">(SAP Service Marketplace account required for access).</span></span> <span data-ttu-id="c07cb-218">Вы можете увеличивать и уменьшать масштаб кластеров серверов приложений SAP и центральных служб путем добавления или удаления экземпляров.</span><span class="sxs-lookup"><span data-stu-id="c07cb-218">SAP application servers and the Central Services clusters can scale up/down or scale out by adding more instances.</span></span> <span data-ttu-id="c07cb-219">Базу данных AnyDB невозможно развернуть — можно только увеличить или уменьшить ее масштаб. Контейнер базы данных SAP для AnyDB не поддерживает сегментирование.</span><span class="sxs-lookup"><span data-stu-id="c07cb-219">The AnyDB database can scale up/down but does not scale out. The SAP database container for AnyDB does not support sharding.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="c07cb-220">Вопросы доступности</span><span class="sxs-lookup"><span data-stu-id="c07cb-220">Availability considerations</span></span>

<span data-ttu-id="c07cb-221">Обеспечение избыточности ресурсов является общей процедурой в высокодоступных инфраструктурных решениях.</span><span class="sxs-lookup"><span data-stu-id="c07cb-221">Resource redundancy is the general theme in highly available infrastructure solutions.</span></span> <span data-ttu-id="c07cb-222">Для предприятий с менее строгим SLA одноэкземплярные виртуальные машины Azure предлагают SLA с гарантией времени непрерывной работы.</span><span class="sxs-lookup"><span data-stu-id="c07cb-222">For enterprises that have a less stringent SLA, single-instance Azure VMs offer an uptime SLA.</span></span> <span data-ttu-id="c07cb-223">Дополнительные сведения см. в статье [Соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/).</span><span class="sxs-lookup"><span data-stu-id="c07cb-223">For more information, see [Azure Service Level Agreement](https://azure.microsoft.com/support/legal/sla/).</span></span>

<span data-ttu-id="c07cb-224">В этой распределенной установке приложения SAP базовая установка реплицируется для обеспечения высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="c07cb-224">In this distributed installation of the SAP application, the base installation is replicated to achieve high availability.</span></span> <span data-ttu-id="c07cb-225">Для каждого слоя архитектуры способ обеспечения высокого уровня доступности варьируется.</span><span class="sxs-lookup"><span data-stu-id="c07cb-225">For each layer of the architecture, the high availability design varies.</span></span>

### <a name="application-tier"></a><span data-ttu-id="c07cb-226">Уровень приложения</span><span class="sxs-lookup"><span data-stu-id="c07cb-226">Application tier</span></span>

<span data-ttu-id="c07cb-227">Высокая доступность для веб-диспетчера SAP достигается с помощью избыточных экземпляров.</span><span class="sxs-lookup"><span data-stu-id="c07cb-227">High availability for SAP Web Dispatcher is achieved with redundant instances.</span></span> <span data-ttu-id="c07cb-228">Дополнительные сведения см. в документации по [веб-диспетчеру SAP](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm).</span><span class="sxs-lookup"><span data-stu-id="c07cb-228">See [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm) in the SAP Documentation.</span></span>

<span data-ttu-id="c07cb-229">Высокая доступность центральных служб реализуется с помощью отказоустойчивого кластера Windows Server.</span><span class="sxs-lookup"><span data-stu-id="c07cb-229">High availability of the Central Services is implemented with Windows Server Failover Cluster.</span></span> <span data-ttu-id="c07cb-230">При развертывании в Azure система хранения данных кластера для отказоустойчивого кластера может быть настроена с помощью двух подходов: кластеризованного общего тома или общего файлового ресурса.</span><span class="sxs-lookup"><span data-stu-id="c07cb-230">When deployed on Azure, the cluster storage for the failover cluster can be configured using two approaches: either a clustered shared volume or a file share.</span></span>

<span data-ttu-id="c07cb-231">Так как общие диски недоступны для Azure, SIOS Datakeeper используется для репликации содержимого независимых дисков, прикрепленных к узлам кластера, и для абстрактного представления дисков в качестве общего тома кластера для диспетчера кластера.</span><span class="sxs-lookup"><span data-stu-id="c07cb-231">Since shared disks are not possible on Azure, SIOS Datakeeper is used to replicate the content of independent disks attached to the cluster nodes and to abstract the drives as a cluster shared volume for the cluster manager.</span></span> <span data-ttu-id="c07cb-232">Дополнительные сведения о реализации см. в [этой статье](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/).</span><span class="sxs-lookup"><span data-stu-id="c07cb-232">For implementation details, see [Clustering SAP ASCS on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/).</span></span>

<span data-ttu-id="c07cb-233">Другим вариантом является использование общего файлового ресурса, обслуживаемого [масштабируемым файловым сервером](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS).</span><span class="sxs-lookup"><span data-stu-id="c07cb-233">Another option is to use a file share served up by the [Scale Out Fileserver](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS).</span></span> <span data-ttu-id="c07cb-234">SOFS предлагает отказоустойчивые общие файловые ресурсы, которые можно использовать в качестве общего тома кластера для кластера Windows.</span><span class="sxs-lookup"><span data-stu-id="c07cb-234">SOFS offers resilient file shares you can use as a cluster shared volume for the Windows cluster.</span></span> <span data-ttu-id="c07cb-235">Кластер SOFS могут совместно использовать несколько узлов центральных служб.</span><span class="sxs-lookup"><span data-stu-id="c07cb-235">A SOFS cluster can be shared among multiple Central Services nodes.</span></span> <span data-ttu-id="c07cb-236">На момент написания этой статьи SOFS использовался только для разработки с высоким уровнем доступности, так как кластер SOFS не распространяется по регионам, чтобы обеспечить поддержку аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="c07cb-236">As of this writing, SOFS is used only for high availability design, because the SOFS cluster does not extend across regions to provide disaster recovery support.</span></span>

<span data-ttu-id="c07cb-237">Высокий уровень доступности для серверов приложений SAP достигается путем балансировки нагрузки трафика в пуле серверов приложений.</span><span class="sxs-lookup"><span data-stu-id="c07cb-237">High availability for the SAP application servers is achieved by load balancing traffic within a pool of application servers.</span></span>
<span data-ttu-id="c07cb-238">См. статью [Сертификаты и конфигурации SAP на платформе Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span><span class="sxs-lookup"><span data-stu-id="c07cb-238">See [SAP certifications and configurations running on Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span></span>

### <a name="database-tier"></a><span data-ttu-id="c07cb-239">Уровень базы данных</span><span class="sxs-lookup"><span data-stu-id="c07cb-239">Database tier</span></span>

<span data-ttu-id="c07cb-240">Эта эталонная архитектура предполагает, что база данных-источник работает в базе данных AnyDB, то есть СУБД, например SQL Server, SAP ASE, IBM DB2 или Oracle.</span><span class="sxs-lookup"><span data-stu-id="c07cb-240">This reference architecture assumes the source database is running on AnyDB—that is, a DBMS such as SQL Server, SAP ASE, IBM DB2, or Oracle.</span></span> <span data-ttu-id="c07cb-241">Встроенная функция репликации уровня базы данных обеспечивает либо ручной, либо автоматический переход на другой ресурс между реплицируемыми узлами.</span><span class="sxs-lookup"><span data-stu-id="c07cb-241">The database tier's native replication feature provides either manual or automatic failover between replicated nodes.</span></span>

<span data-ttu-id="c07cb-242">Сведения о реализации конкретных систем баз данных см. в статье [SAP NetWeaver на виртуальных машинах Windows. Руководство по развертыванию СУБД](/azure/virtual-machines/workloads/sap/dbms-guide).</span><span class="sxs-lookup"><span data-stu-id="c07cb-242">For implementation details about specific database systems, see [Azure Virtual Machines DBMS deployment for SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span></span>

## <a name="disaster-recovery-considerations"></a><span data-ttu-id="c07cb-243">Рекомендации по аварийному восстановлению</span><span class="sxs-lookup"><span data-stu-id="c07cb-243">Disaster recovery considerations</span></span>

<span data-ttu-id="c07cb-244">Для аварийного восстановления необходимо выполнить отработку отказа в дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="c07cb-244">For disaster recovery (DR), you must be able to fail over to a secondary region.</span></span> <span data-ttu-id="c07cb-245">Каждый уровень использует разную стратегию обеспечения защиты посредством аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="c07cb-245">Each tier uses a different strategy to provide disaster recovery (DR) protection.</span></span>

- <span data-ttu-id="c07cb-246">**Уровень серверов приложений**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-246">**Application servers tier**.</span></span> <span data-ttu-id="c07cb-247">Серверы приложений SAP не содержат бизнес-данных.</span><span class="sxs-lookup"><span data-stu-id="c07cb-247">SAP application servers do not contain business data.</span></span> <span data-ttu-id="c07cb-248">В Azure простой стратегией аварийного восстановления является создание серверов приложений SAP в дополнительном регионе, а затем завершение их работы.</span><span class="sxs-lookup"><span data-stu-id="c07cb-248">On Azure, a simple DR strategy is to create SAP application servers in the secondary region, then shut them down.</span></span> <span data-ttu-id="c07cb-249">При любых изменениях конфигурации или обновлениях ядра на основном сервере приложений те же изменения должны быть скопированы в виртуальные машины в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="c07cb-249">Upon any configuration changes or kernel updates on the primary application server, the same changes must be copied to the virtual machines in the secondary region.</span></span> <span data-ttu-id="c07cb-250">Например, исполняемые файлы ядра копируются на виртуальные машины аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="c07cb-250">For example, the kernel executables copied to the DR virtual machines.</span></span> <span data-ttu-id="c07cb-251">Для автоматической репликации серверов приложений в дополнительный регион рекомендуется использовать [Azure Site Recovery](/azure/site-recovery/site-recovery-overview).</span><span class="sxs-lookup"><span data-stu-id="c07cb-251">For automatic replication of application servers to a secondary region, [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) is the recommended solution.</span></span>

- <span data-ttu-id="c07cb-252">**Центральные службы**.</span><span class="sxs-lookup"><span data-stu-id="c07cb-252">**Central Services**.</span></span> <span data-ttu-id="c07cb-253">Этот компонент стека приложений SAP не сохраняет бизнес-данные.</span><span class="sxs-lookup"><span data-stu-id="c07cb-253">This component of the SAP application stack also does not persist business data.</span></span> <span data-ttu-id="c07cb-254">Вы можете создать виртуальную машину в регионе аварийного восстановления, чтобы запустить роль центральных служб.</span><span class="sxs-lookup"><span data-stu-id="c07cb-254">You can build a VM in the disaster recovery region to run the Central Services role.</span></span> <span data-ttu-id="c07cb-255">Единственное содержимое основного узла центральных служб, которое синхронизируется, — это общее содержимое /sapmnt.</span><span class="sxs-lookup"><span data-stu-id="c07cb-255">The only content from the primary Central Services node to synchronize is the /sapmnt share content.</span></span> <span data-ttu-id="c07cb-256">Кроме того, если изменения конфигурации или обновления ядра происходят на основных серверах центральных служб, их необходимо повторить на виртуальной машине в регионе аварийного восстановления, где запущены центральные службы.</span><span class="sxs-lookup"><span data-stu-id="c07cb-256">Also, if configuration changes or kernel updates take place on the primary Central Services servers, they must be repeated on the VM in the disaster recovery region running Central Services.</span></span> <span data-ttu-id="c07cb-257">Синхронизировать два сервера можно либо с помощью Azure Site Recovery, выполнив репликацию узлов кластера, либо просто с помощью запланированного задания копирования, при котором /sapmnt копируется в регион аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="c07cb-257">To synchronize the two servers, you can use either Azure Site Recovery to replicate the cluster nodes or simply use a regularly scheduled copy job to copy /sapmnt to the disaster recovery region.</span></span> <span data-ttu-id="c07cb-258">Сведения о простом процессе репликации, создания, копирования и тестирования отработки отказа см. в документе [SAP NetWeaver: Building a Hyper-V & Microsoft Azure–based Disaster Recovery Solution](http://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx) (Создание решения аварийного восстановления на основе Microsoft Azure и Hyper-V в SAP NetWeaver) в разделе 4.3</span><span class="sxs-lookup"><span data-stu-id="c07cb-258">For details about this simple replication method's build, copy, and test failover process, download [SAP NetWeaver: Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution](http://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx), and refer to "4.3.</span></span> <span data-ttu-id="c07cb-259">о слое единой точки отказа SAP (ASCS).</span><span class="sxs-lookup"><span data-stu-id="c07cb-259">SAP SPOF layer (ASCS)."</span></span>

- <span data-ttu-id="c07cb-260">**Уровень базы данных.**</span><span class="sxs-lookup"><span data-stu-id="c07cb-260">**Database tier**.</span></span> <span data-ttu-id="c07cb-261">Аварийное восстановление лучше всего реализовать с помощью собственной интегрированной технологии репликации базы данных.</span><span class="sxs-lookup"><span data-stu-id="c07cb-261">DR is best implemented with the database's own integrated replication technology.</span></span> <span data-ttu-id="c07cb-262">Например, в случае с SQL Server мы рекомендуем создать реплики в удаленном регионе с помощью группы доступности AlwaysOn, асинхронно реплицируя транзакции с помощью перехода на другой ресурс вручную.</span><span class="sxs-lookup"><span data-stu-id="c07cb-262">In the case of SQL Server, for example, we recommend using AlwaysOn Availability Group to establish a replica in a remote region, replicating transactions asynchronously with manual failover.</span></span> <span data-ttu-id="c07cb-263">Асинхронная репликация позволяет избежать влияния на производительность интерактивных рабочих нагрузок на основном сайте.</span><span class="sxs-lookup"><span data-stu-id="c07cb-263">Asynchronous replication avoids an impact to the performance of interactive workloads at the primary site.</span></span> <span data-ttu-id="c07cb-264">Переход на другой ресурс вручную дает возможность оценить влияние аварийного восстановления и решить, продолжить ли использование сайта аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="c07cb-264">Manual failover offers the opportunity for a person to evaluate the DR impact and decide if operating from the DR site is justified.</span></span>

<span data-ttu-id="c07cb-265">Чтобы использовать Azure Site Recovery для автоматического создания полностью реплицированного производственного исходного сайта, запустите настроенные [скрипты развертывания](/azure/site-recovery/site-recovery-runbook-automation).</span><span class="sxs-lookup"><span data-stu-id="c07cb-265">To use Azure Site Recovery to automatically build out a fully replicated production site of your original, you must run customized [deployment scripts](/azure/site-recovery/site-recovery-runbook-automation).</span></span> <span data-ttu-id="c07cb-266">Сначала Site Recovery развертывает виртуальные машины в группах доступности, а затем запускает скрипты для добавления ресурсов, таких как подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="c07cb-266">Site Recovery first deploys the VMs in availability sets, then runs scripts to add resources such as load balancers.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="c07cb-267">Вопросы управляемости</span><span class="sxs-lookup"><span data-stu-id="c07cb-267">Manageability considerations</span></span>

<span data-ttu-id="c07cb-268">Azure предоставляет несколько функций для [мониторинга и диагностики](/azure/architecture/best-practices/monitoring) во всей инфраструктуре.</span><span class="sxs-lookup"><span data-stu-id="c07cb-268">Azure provides several functions for [monitoring and diagnostics](/azure/architecture/best-practices/monitoring) of the overall infrastructure.</span></span> <span data-ttu-id="c07cb-269">Кроме того, расширенный мониторинг виртуальных машин Azure обрабатывается с помощью Azure Operations Management Suite (OMS).</span><span class="sxs-lookup"><span data-stu-id="c07cb-269">Also, enhanced monitoring of Azure virtual machines is handled by Azure Operations Management Suite (OMS).</span></span>

<span data-ttu-id="c07cb-270">Чтобы обеспечить мониторинг ресурсов на основе SAP и производительности служб инфраструктуры SAP, используйте расширение [улучшенного мониторинга Azure для SAP](/azure/virtual-machines/workloads/sap/deployment-guide#detailed-tasks-for-sap-software-deployment).</span><span class="sxs-lookup"><span data-stu-id="c07cb-270">To provide SAP-based monitoring of resources and service performance of the SAP infrastructure, the [Azure SAP Enhanced Monitoring](/azure/virtual-machines/workloads/sap/deployment-guide#detailed-tasks-for-sap-software-deployment) extension is used.</span></span> <span data-ttu-id="c07cb-271">Это расширение передает статистику мониторинга Azure в приложение SAP для мониторинга операционной системы и функций DBACockpit.</span><span class="sxs-lookup"><span data-stu-id="c07cb-271">This extension feeds Azure monitoring statistics into the SAP application for operating system monitoring and DBA Cockpit functions.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="c07cb-272">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="c07cb-272">Security considerations</span></span>

<span data-ttu-id="c07cb-273">SAP имеет свой собственный механизм управления пользователями для управления доступом на основе ролей и авторизации в приложении SAP.</span><span class="sxs-lookup"><span data-stu-id="c07cb-273">SAP has its own Users Management Engine (UME) to control role-based access and authorization within the SAP application.</span></span> <span data-ttu-id="c07cb-274">Дополнительные сведения см. в [руководстве по безопасности сервера приложений SAP NetWeaver для ABAP](https://help.sap.com/doc/7b932ef4728810148a4b1a83b0e91070/1610 001/en-US/frameset.htm?4dde53b3e9142e51e10000000a42189c.html) и [руководстве по безопасности сервера приложений SAP NetWeaver для Java](https://help.sap.com/doc/saphelp_snc_uiaddon_10/1.0/en-US/57/d8bfcf38f66f48b95ce1f52b3f5184/frameset.htm).</span><span class="sxs-lookup"><span data-stu-id="c07cb-274">For details, see [SAP NetWeaver Application Server for ABAP Security Guide](https://help.sap.com/doc/7b932ef4728810148a4b1a83b0e91070/1610 001/en-US/frameset.htm?4dde53b3e9142e51e10000000a42189c.html) and [SAP NetWeaver Application Server Java Security Guide](https://help.sap.com/doc/saphelp_snc_uiaddon_10/1.0/en-US/57/d8bfcf38f66f48b95ce1f52b3f5184/frameset.htm).</span></span>

<span data-ttu-id="c07cb-275">Чтобы обеспечить дополнительную сетевую безопасность, рассмотрите возможность внедрения [сети периметра](../dmz/secure-vnet-hybrid.md), которая создает брандмауэр перед подсетью для веб-диспетчера с помощью сетевого виртуального модуля.</span><span class="sxs-lookup"><span data-stu-id="c07cb-275">For additional network security, consider implementing a [network DMZ](../dmz/secure-vnet-hybrid.md), which uses a network virtual appliance to create a firewall in front of the subnet for Web Dispatcher.</span></span>

<span data-ttu-id="c07cb-276">Для обеспечения безопасности инфраструктуры данные шифруются при передаче и во время хранения.</span><span class="sxs-lookup"><span data-stu-id="c07cb-276">For infrastructure security, data is encrypted in transit and at rest.</span></span> <span data-ttu-id="c07cb-277">С помощью указаний в разделе "Вопросы безопасности" в статье [SAP NetWeaver на виртуальных машинах Windows. Руководство по планированию и внедрению](/azure/virtual-machines/workloads/sap/planning-guide) начните реализовать защиту сети.</span><span class="sxs-lookup"><span data-stu-id="c07cb-277">The "Security considerations” section of the [SAP NetWeaver on Azure Virtual Machines (VMs) – Planning and Implementation Guide](/azure/virtual-machines/workloads/sap/planning-guide) begins to address network security.</span></span> <span data-ttu-id="c07cb-278">В руководстве также указаны порты сети, которые необходимо открыть на брандмауэрах, чтобы разрешить взаимодействие с приложением.</span><span class="sxs-lookup"><span data-stu-id="c07cb-278">The guide also specifies the network ports you must open on the firewalls to allow application communication.</span></span>

<span data-ttu-id="c07cb-279">Выполнить шифрование дисков виртуальной машины Windows можно с помощью [шифрования дисков Azure](/azure/security/azure-security-disk-encryption).</span><span class="sxs-lookup"><span data-stu-id="c07cb-279">To encrypt Windows virtual machine disks, you can use [Azure Disk Encryption](/azure/security/azure-security-disk-encryption).</span></span> <span data-ttu-id="c07cb-280">Эта технология использует возможность BitLocker Windows, чтобы обеспечить шифрование тома для дисков ОС и дисков данных.</span><span class="sxs-lookup"><span data-stu-id="c07cb-280">It uses the BitLocker feature of Windows to provide volume encryption for the operating system and the data disks.</span></span> <span data-ttu-id="c07cb-281">Шифрование дисков Azure также работает в Azure Key Vault, что позволяет управлять секретами и ключами шифрования дисков в подписке Key Vault и контролировать их.</span><span class="sxs-lookup"><span data-stu-id="c07cb-281">The solution also works with Azure Key Vault to help you control and manage the disk-encryption keys and secrets in your key vault subscription.</span></span> <span data-ttu-id="c07cb-282">Данные на дисках виртуальной машины шифруются в хранилище Azure, когда они неактивны.</span><span class="sxs-lookup"><span data-stu-id="c07cb-282">Data on the virtual machine disks are encrypted at rest in your Azure storage.</span></span>

## <a name="communities"></a><span data-ttu-id="c07cb-283">Сообщества</span><span class="sxs-lookup"><span data-stu-id="c07cb-283">Communities</span></span>

<span data-ttu-id="c07cb-284">Участники сообществ отвечают на вопросы и помогают настроить успешное развертывание.</span><span class="sxs-lookup"><span data-stu-id="c07cb-284">Communities can answer questions and help you set up a successful deployment.</span></span> <span data-ttu-id="c07cb-285">Рассмотрим следующее:</span><span class="sxs-lookup"><span data-stu-id="c07cb-285">Consider the following:</span></span>

- [<span data-ttu-id="c07cb-286">Запись блога по запуску приложений SAP на платформе Майкрософт</span><span class="sxs-lookup"><span data-stu-id="c07cb-286">Running SAP Applications on the Microsoft Platform Blog</span></span>](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)
- [<span data-ttu-id="c07cb-287">Поддержка сообщества Azure</span><span class="sxs-lookup"><span data-stu-id="c07cb-287">Azure Community Support</span></span>](https://azure.microsoft.com/support/community/)
- [<span data-ttu-id="c07cb-288">Сообщество SAP</span><span class="sxs-lookup"><span data-stu-id="c07cb-288">SAP Community</span></span>](https://www.sap.com/community.html)
- [<span data-ttu-id="c07cb-289">Stack Overflow</span><span class="sxs-lookup"><span data-stu-id="c07cb-289">Stack Overflow</span></span>](https://stackoverflow.com/tags/sap/)

[visio-download]: https://archcenter.blob.core.windows.net/cdn/sap-reference-architectures.vsdx