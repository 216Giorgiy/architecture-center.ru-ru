---
title: Запуск SAP HANA на крупных экземплярах Azure
description: Методики по запуску SAP HANA в среде с высоким уровнем доступности на крупных экземплярах Azure.
author: lbrader
ms.date: 05/16/2018
ms.openlocfilehash: d9d619dd7fb17c7cf0a66ce73c1e067ec97a2401
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/28/2018
ms.locfileid: "47429712"
---
# <a name="run-sap-hana-on-azure-large-instances"></a>Запуск SAP HANA на крупных экземплярах Azure

В этой эталонной архитектуре показан набор проверенных методик по запуску SAP HANA в Azure (крупные экземпляры) с высокой доступностью и аварийным восстановлением. Предложение "Крупные экземпляры SAP HANA" развертывается на физических серверах в регионах Azure. 

![0][0]

*Скачайте [файл Visio][visio-download] этой архитектуры.*

> [!NOTE]
> Для развертывания этой эталонной архитектуры требуется соответствующее лицензирование продуктов SAP и другие технологии сторонних производителей.

## <a name="architecture"></a>Архитектура

Архитектура состоит из следующих компонентов инфраструктуры.

- **Виртуальная сеть**. Служба [виртуальной сети Azure][vnet] надежно соединяет ресурсы Azure друг с другом и подразделяется на отдельные [подсети][subnet] для каждого уровня. Уровни приложений SAP развернуты на виртуальной машине Azure для подключения к уровню баз данных HANA, находящемуся в крупных экземплярах.

- **Виртуальные машины**. Виртуальные машины используются на уровне приложений SAP и уровне общих служб. Последний содержит среду jumpbox, с помощью которой администраторы настраивают крупные экземпляры HANA и предоставляют доступ к другим виртуальным машинам. 

- **Крупный экземпляр HANA**. На [физическом сервере][physical], сертифицированном для соответствия стандартам Tailored Datacenter Integration (TDI) SAP HANA, выполняется SAP HANA. Эта архитектура использует два крупных экземпляра HANA: первичную и вторичную единицу вычислений. Высокий уровень доступности на уровне данных обеспечивается с помощью системы репликации (HSR) HANA.

- **Пара высокого уровня доступности**. Группа блейд-серверов крупных экземпляров HANA находится под общим управлением для обеспечения избыточности и надежности приложений. 

- **MSEE (Microsoft Enterprise Edge)**. MSEE — это точка подключения от поставщика услуг связи или периферийной сети через канал ExpressRoute. 

- **Сетевые карты (NIC)**. Для обеспечения связи сервер крупного экземпляра HANA предоставляет четыре виртуальных сетевых адаптера по умолчанию. Этой архитектуре необходим один сетевой адаптер для связи с клиентом, второй — для связи между узлами, требуемой HSR, третий — для хранилища крупных экземпляров HANA и четвертый — для подключения iSCSI, используемого для кластеризации с высоким уровнем доступности.
    
- **Хранилище сетевой файловой системы (NFS)**. Сервер [NFS][nfs] поддерживает сетевую общую папку, которая обеспечивает сохраняемость данных для крупного экземпляра HANA.

- **ExpressRoute.** [ExpressRoute][expressroute] — рекомендуемая сетевая служба Azure для создания частных подключений между локальной сетью и виртуальными сетями Azure, которые не осуществляются через общедоступный Интернет. Виртуальные машины Azure подключаются к крупным экземплярам HANA с помощью другого подключения ExpressRoute. Подключение ExpressRoute между виртуальной сетью Azure и крупными экземплярами HANA настраивается как часть предложения Майкрософт.

- **Шлюз.** Через шлюз ExpressRoute виртуальная сеть Azure, используемая для уровня приложений SAP, подключается к сети крупного экземпляра HANA. Воспользуйтесь номером SKU ["Высокопроизводительный" или "Очень высокая производительность"][sku].

- **Аварийное восстановление**. По запросу настраивается репликация хранилища с первичного сайта на [сайт аварийного восстановления][DR-site], расположенный в другом регионе.  
 
## <a name="recommendations"></a>Рекомендации
Так как требования различны, воспользуйтесь этими рекомендациями в качестве отправной точки.

### <a name="hana-large-instances-compute"></a>Вычисления крупных экземпляров HANA
[Крупные экземпляры][physical] представляют собой физические серверы на базе архитектуры ЦП Intel EX E7. Они настроены в стеке крупных экземпляров, то есть ряда обычных или блейд-серверов. Единица вычислений соответствует одному обычному или блейд-серверу, а стек состоит из нескольких обычных или блейд-серверов. В рамках стека крупных экземпляров серверы не используются совместно. Они предназначены для развертывания одного клиента SAP HANA.

Для крупных экземпляров HANA доступны различные номера SKU, поддерживающие до 20 ТБ памяти на один экземпляр (60 ТБ при масштабном развертывании) для S/4HANA или других рабочих нагрузок SAP HANA. Доступны [два класса][classes] серверов:

- Класс типа I: S72, S72m, S144, S144m, S192 и S192m.

- Класс типа II: S384, S384m, S384xm, S576m, S768m и S960m.

Например, номер SKU S72 поставляется с оперативной памятью 768 ГБ, 3 TB хранилища и 2 процессорами Intel Xeon (E7-8890 v3) с 36 ядрами. Выберите номер SKU, соответствующий требованиям к размеру, которые вы определили во время сеансов создания архитектуры и проектирования. Всегда проверяйте, соответствует ли ваш размер правильному номеру SKU. Возможности и требования к развертыванию [различаются в зависимости от типа][type], а доступность зависит от [региона][region]. Вы также можете перейти с номера SKU нижнего уровня на номер SKU более высокого уровня.

Корпорация Майкрософт помогает настроить крупный экземпляр, но вы должны выполнять проверку параметров конфигурации операционной системы. Обязательно просмотрите самые последние примечания SAP для вашего выпуска Linux.

### <a name="storage"></a>Хранилище
Структура хранилища реализована в соответствии с рекомендацией TDI для SAP HANA. Крупные экземпляры HANA поставляются с конфигурацией определенного хранилища для стандартных спецификаций TDI. Однако вы можете приобрести дополнительное хранилище с шагом в 1 ТБ. 

Для поддержки требований критически важных сред, включая быстрое восстановление, используется NFS, а не непосредственно подключенное хранилище. Сервер хранилища NFS для крупных экземпляров HANA размещен в мультитенантной среде, в которой клиенты разделены и защищены за счет изоляции вычислений, сетей и хранилищ.

Поддерживать высокий уровень доступности на основном сайте можно с помощью различных структур хранилищ. Например, при масштабном развертывании с несколькими узлами хранилище является общим. Еще одним вариантом обеспечения высокого уровня доступности является репликация на основе приложений, например HSR. Однако для аварийного восстановления используется репликация хранилища на основе моментальных снимков.

### <a name="networking"></a>Сеть
В этой архитектуре используются и виртуальные, и физические сети. Виртуальная сеть является частью Azure IaaS и подключается к дискретной физической сети крупных экземпляров HANA через каналы [ExpressRoute][expressroute]. Распределенный шлюз подключает ваши рабочие нагрузки в виртуальной сети Azure к вашим локальным сайтам.

Сети крупных экземпляров HANA изолированы друг от друга для обеспечения безопасности. Экземпляры, размещенные в разных регионах, не взаимодействуют друг с другом, за исключением выполнения выделенной репликации хранилища. Однако для использования HSR требуется межрегиональная связь. Для обеспечения межрегиональной HSR можно использовать [таблицы маршрутизации IP][ip] или прокси-серверы.

Все виртуальные сети Azure, которые подключаются к крупным экземплярам HANA в одном регионе, могут быть [подключены][cross-connected] через ExpressRoute к крупным экземплярам HANA в дополнительном регионе.

ExpressRoute для крупных экземпляров HANA по умолчанию настраивается во время подготовки. Для установки требуется конкретная структура сети, а также требуемые диапазоны адресов CIDR и маршрутизация домена. Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)][HLI-infrastructure].

## <a name="scalability-considerations"></a>Вопросы масштабируемости
Для увеличения или уменьшения масштаба крупных экземпляров HANA доступно множество размеров серверов. Они разделены на [тип I и II][classes] и настроены для разных рабочих нагрузок. Выберите размер, который может увеличиться с вашей рабочей нагрузкой в течение следующих трех лет. Кроме того, доступны обязательства на один год.

Для развертывания BW/4HANA в качестве стратегии секционирования базы данных обычно используется масштабное развертывание с несколькими узлами. Чтобы выполнить развертывание, перед установкой спланируйте размещение таблиц HANA. В этой инфраструктуре несколько узлов подключаются к общему тому хранилища, что позволяет быстро перейти на резервные узлы в случае сбоя одного из рабочих узлов вычислений в системе HANA.

Масштаб S/4HANA и SAP Business Suite в HANA на одном блейд-сервере может быть увеличен до 20 ТБ с одним крупным экземпляром HANA.

Для новых сценариев доступно средство определения требований к памяти для реализации программного обеспечения SAP на базе HANA — [SAP Quick Sizer][quick-sizer]. Требования к памяти для HANA повышаются по мере роста объема данных. Спрогнозируйте будущее потребление, исходя из текущего потребления памяти в вашей системе, а затем сопоставьте свои требования с одним из размеров крупных экземпляров HANA.

Если у вас уже есть развертывания SAP, вы можете использовать предоставляемые SAP отчеты, чтобы проверить показатели потребления памяти имеющимися системами и определить требования к памяти для экземпляра HANA. К примеру, см. приведенные ниже примечания SAP. 

- Примечание SAP [№ 1793345][sap-1793345] об определении размера для SAP Suite в HANA.
- Примечание SAP [№ 1872170][sap-1872170] с отчетом для определения размера Suite в HANA и S/4 HANA.
- Примечание SAP [№ 2121330][sap-2121330] с часто задаваемыми вопросами об отчете для определения размера SAP BW в HANA.
- Примечание SAP [№ 1736976][sap-1736976] с отчетом для определения размера BW в HANA.
- Примечание SAP [№ 2296290][sap-2296290] с новым отчетом для определения размера BW в HANA.

## <a name="availability-considerations"></a>Вопросы доступности

Обеспечение избыточности ресурсов является общей процедурой в высокодоступных инфраструктурных решениях. Для предприятий с менее строгим SLA одноэкземплярные виртуальные машины Azure предлагают SLA с гарантией времени непрерывной работы. Дополнительные сведения см. в статье [Соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/).

Сотрудничайте с SAP, вашим системным интегратором или корпорацией Майкрософт, чтобы правильно создать архитектуру и реализовать стратегию [обеспечения высокой доступности и аварийного восстановления][hli-hadr]. Эта архитектура соответствует [соглашению об уровне обслуживания][sla] Azure для HANA в Azure (крупные экземпляры). Чтобы оценить требования к доступности, рассмотрите любые единые точки отказа, желаемый уровень бесперебойной работы для служб и следующие метрики:

- Целевое время восстановления (RTO) — это время, в течение которого сервер крупных экземпляров HANA недоступен.

- Целевая точка восстановления (RPO) представляет собой максимально допустимый период, в течение которого данные клиента могут быть потеряны из-за сбоя.

Для обеспечения высокого уровня доступности разверните несколько экземпляров в паре HA и используйте HSR в синхронном режиме, чтобы минимизировать потерю данных и время простоя. В дополнение к локальной настройке высокого уровня доступности с двумя узлами HSR поддерживает многоуровневую репликацию, при которой третий узел в отдельном регионе Azure регистрирует вторичную реплику кластеризованной пары HSR в качестве своей цели репликации. Таким образом создается последовательная цепочка репликации. Отработка отказа на узел аварийного восстановления выполняется вручную.

При настройке HSR для крупных экземпляров HASA с автоматическим переходом на другой ресурс можно попросить команду Microsoft Service Management настроить [устройство STONITH][stonith] для имеющихся серверов. 

## <a name="disaster-recovery-considerations"></a>Рекомендации по аварийному восстановлению
Эта архитектура поддерживает [аварийное восстановление][hli-dr] между крупными экземплярами HANA в разных регионах Azure. Существует два способа поддержки аварийного восстановления в крупных экземплярах HANA:

- Репликация хранилища. Содержимое первичного хранилища постоянно реплицируется в удаленные системы хранения аварийного восстановления, которые доступны на сервере аварийного восстановления крупных экземпляров HANA. В репликации хранилища база данных HANA не загружается в память. Этот вариант аварийного восстановления проще с точки зрения администрирования. Чтобы определить, подходит ли вам данная стратегия, рассмотрите время загрузки базы данных в отношении соглашения об уровне обслуживания по доступности. Репликация хранилища также позволяет выполнять восстановление на определенный момент времени. Если настроено многоцелевое (оптимизированное по стоимости) аварийное восстановление, необходимо приобрести дополнительное хранилище того же размера в расположении аварийного восстановления. Корпорация Майкрософт в качестве части предложения крупных экземпляров HANA предоставляет самостоятельно выполняемые [моментальные снимки хранилища и сценарии отработки отказа][scripts] для отработки отказа HANA.

- Многоуровневая HSR с третьей репликой в регионе аварийного восстановления (где база данных HANA загружается в память). Этот вариант поддерживает более быстрое восстановление, однако не поддерживает восстановление на определенный момент времени. Для HSR требуется вторичная система. Репликация системы HANA для сайта аварийного восстановления осуществляется через прокси-серверы, такие как nginx, или IP-таблицы. 

> [!NOTE]
> Вы можете оптимизировать эту эталонную архитектуру с точки зрения затрат, работая в среде с одним экземпляром. Такой [оптимизированный по стоимости сценарий](https://blogs.sap.com/2016/07/19/new-whitepaper-for-high-availability-for-sap-hana-cost-optimized-scenario/) подходит для непроизводственных рабочих нагрузок HANA. 

## <a name="backup-considerations"></a>Рекомендации по резервному копированию
На основе ваших бизнес-требований выберите один из нескольких вариантов, доступных для [резервного копирования и восстановления][hli-backup].

| Вариант резервного копирования                   | Преимущества                                                                                                   | Недостатки                                                       |
|---------------------------------|--------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
| Резервное копирование HANA        | Из собственной системы в SAP. Встроенная проверка согласованности.                                                             | Медленное резервное копирование и восстановление. Потребление дискового пространства. |
| Моментальный снимок HANA      | Из собственной системы в SAP. Быстрое резервное копирование и восстановление.                                                               |                                       |
| Моментальный снимок хранилища   | Включен в крупных экземплярах HANA. Оптимизированное аварийное восстановление для крупных экземпляров HANA. Поддержка резервного копирования загрузочного тома. | Максимальное количество моментальных снимков на один том — 254.                          |
| Резервное копирование журналов         | Требуется для восстановления до точки во времени.                                                                   |                                                            |
| Другие средства резервного копирования | Расположение избыточных резервных копий.                                                                             | Дополнительные затраты на лицензирование.                                |

## <a name="manageability-considerations"></a>Вопросы управляемости
Отслеживайте ресурсы крупных экземпляров HANA, такие как ЦП, память, пропускная способность сети и дисковое пространство, с помощью SAP HANA Studio, SAP HANA Cockpit, SAP Solution Manager и других собственных средств Linux. Крупные экземпляры HANA не поставляются со встроенными средствами мониторинга. Корпорация Майкрософт предоставляет ресурсы, помогающие [устранять неполадки и выполнять отслеживание][hli-troubleshoot] в соответствии с требованиями вашей организации, а группа поддержки Майкрософт поможет вам в устранении технических неполадок. 

Если вам нужна большая вычислительная мощность, перейдите на больший номер SKU. 

## <a name="security-considerations"></a>Вопросы безопасности
- По умолчанию крупные экземпляры HANA используют шифрование хранилища на основе TDE (прозрачное шифрование данных) для неактивных данных.

- Данные, передаваемые между крупными экземплярами HANA и виртуальными машинами, не зашифрованы. Чтобы зашифровать передачу данных, включите шифрование для конкретного приложения. См. примечание SAP [2159014][sap-2159014] о часто задаваемых вопросах по безопасности SAP HANA.

- Изоляция обеспечивает безопасность между клиентами в мультитенантной среде крупных экземпляров HANA. Клиенты изолируются с помощью собственной виртуальной локальной сети.

- Дополнительные сведения см. в статье [Рекомендации по обеспечению безопасности в сети Azure][network-best-practices].

- Как и при любом развертывании, рекомендуем [усилить защиту ОС][os-hardening].

- Для обеспечения физической безопасности доступ к центрам обработки данных Azure может получить только авторизованный персонал. Клиенты не имеют доступа к физическим серверам.

Дополнительные сведения см. в статье с [общими сведениями о безопасности SAP HANA][sap-security]. (Для доступа необходима учетная запись SAP Service Marketplace.)

## <a name="communities"></a>Сообщества
Участники сообществ отвечают на вопросы и помогают настроить успешное развертывание. Рассмотрим следующее:

* [Запись блога по запуску приложений SAP на платформе Майкрософт][running-sap-blog]
* [Поддержка сообщества Azure][azure-forum]
* [Сообщество SAP][sap-community]
* [Stack Overflow для SAP][stack-overflow]

[azure-forum]: https://azure.microsoft.com/support/forums/
[azure-large-instances]: /azure/virtual-machines/workloads/sap/hana-overview-architecture
[classes]: /azure/virtual-machines/workloads/sap/hana-overview-architecture
[cross-connected]: /azure/virtual-machines/workloads/sap/hana-overview-high-availability-disaster-recovery#network-considerations-for-disaster-recovery-with-hana-large-instances
[dr-site]: /azure/virtual-machines/workloads/sap/hana-overview-high-availability-disaster-recovery
[expressroute]: /azure/architecture/reference-architectures/hybrid-networking/expressroute
[filter-network]: https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/
[hli-dr]: /azure/virtual-machines/workloads/sap/hana-overview-high-availability-disaster-recovery#network-considerations-for-disaster-recovery-with-hana-large-instances
[hli-backup]: /azure/virtual-machines/workloads/sap/hana-overview-high-availability-disaster-recovery#backup-and-restore
[hli-hadr]: /azure/virtual-machines/workloads/sap/hana-overview-high-availability-disaster-recovery?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json
[hli-infrastructure]: /azure/virtual-machines/workloads/sap/hana-overview-infrastructure-connectivity
[hli-overview]: /azure/virtual-machines/workloads/sap/hana-overview-architecture
[hli-troubleshoot]: /azure/virtual-machines/workloads/sap/troubleshooting-monitoring
[ip]: https://blogs.msdn.microsoft.com/saponsqlserver/2018/02/10/setting-up-hana-system-replication-on-azure-hana-large-instances/
[network-best-practices]: /azure/security/azure-security-network-security-best-practices
[nfs]: /azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs
[os-hardening]: /azure/security/azure-security-iaas
[physical]: /azure/virtual-machines/workloads/sap/hana-overview-architecture
[planning]: /azure/vpn-gateway/vpn-gateway-plan-design
[protecting-sap]: https://blogs.msdn.microsoft.com/saponsqlserver/2016/05/06/protecting-sap-systems-running-on-vmware-with-azure-site-recovery/
[ref-arch]: /azure/architecture/reference-architectures/
[running-SAP]: https://blogs.msdn.microsoft.com/saponsqlserver/2016/06/07/sap-on-sql-general-update-for-customers-partners-june-2016/
[region]: https://azure.microsoft.com/global-infrastructure/services/
[running-sap-blog]: https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/
[quick-sizer]: https://service.sap.com/quicksizing
[sap-1793345]: https://launchpad.support.sap.com/#/notes/1793345
[sap-1872170]: https://launchpad.support.sap.com/#/notes/1872170
[sap-2121330]: https://launchpad.support.sap.com/#/notes/2121330
[sap-2159014]: https://launchpad.support.sap.com/#/notes/2159014
[sap-1736976]: https://launchpad.support.sap.com/#/notes/1736976
[sap-2296290]: https://launchpad.support.sap.com/#/notes/2296290
[sap-community]: https://www.sap.com/community.html
[sap-security]: https://archive.sap.com/documents/docs/DOC-62943
[scripts]: /azure/virtual-machines/workloads/sap/hana-overview-high-availability-disaster-recovery
[sku]: /azure/expressroute/expressroute-about-virtual-network-gateways
[sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines
[stack-overflow]: https://stackoverflow.com/tags/sap/info
[stonith]: /azure/virtual-machines/workloads/sap/ha-setup-with-stonith
[subnet]: /azure/virtual-network/virtual-network-manage-subnet
[swd]: https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm
[type]: /azure/virtual-machines/workloads/sap/hana-installation
[vnet]: /azure/virtual-network/virtual-networks-overview
[0]: ./images/sap-hana-large-instances.png "Архитектура SAP HANA в крупных экземплярах Azure"

[visio-download]: https://archcenter.blob.core.windows.net/cdn/sap-reference-architectures.vsdx