---
title: SAP S/4HANA для виртуальных машин Linux в Azure
description: Проверенные методики по запуску SAP S/4HANA в высокодоступной среде Linux в Azure.
author: lbrader
ms.date: 05/11/2018
ms.openlocfilehash: ab056a01f05bde9e9dc7a4439baed367ee663f93
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/28/2018
ms.locfileid: "47429593"
---
# <a name="sap-s4hana-for-linux-virtual-machines-on-azure"></a><span data-ttu-id="51cd6-103">SAP S/4HANA для виртуальных машин Linux в Azure</span><span class="sxs-lookup"><span data-stu-id="51cd6-103">SAP S/4HANA for Linux Virtual Machines on Azure</span></span>

<span data-ttu-id="51cd6-104">Эта эталонная архитектура демонстрирует набор проверенных методик для запуска S/4HANA в среде высокой доступности, которая поддерживает аварийное восстановление в Azure.</span><span class="sxs-lookup"><span data-stu-id="51cd6-104">This reference architecture shows a set of proven practices for running S/4HANA in a high availability environment that supports disaster recovery on Azure.</span></span> <span data-ttu-id="51cd6-105">Эта архитектура развертывается с конкретными размерами виртуальных машин, которые можно изменить в соответствии с потребностями вашей организации.</span><span class="sxs-lookup"><span data-stu-id="51cd6-105">This architecture is deployed with specific virtual machine (VM) sizes that can be changed to accommodate your organization's needs.</span></span> 

![](./images/sap-s4hana.png)

<span data-ttu-id="51cd6-106">*Скачайте [файл Visio][visio-download] этой архитектуры.*</span><span class="sxs-lookup"><span data-stu-id="51cd6-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE] 
> <span data-ttu-id="51cd6-107">Для развертывания этой эталонной архитектуры требуется соответствующее лицензирование продуктов SAP и другие технологии сторонних производителей.</span><span class="sxs-lookup"><span data-stu-id="51cd6-107">Deploying this reference architecture requires appropriate licensing of SAP products and other non-Microsoft technologies.</span></span>

## <a name="architecture"></a><span data-ttu-id="51cd6-108">Архитектура</span><span class="sxs-lookup"><span data-stu-id="51cd6-108">Architecture</span></span>
 
<span data-ttu-id="51cd6-109">Эта эталонная архитектура описывает корпоративные системы производственного уровня.</span><span class="sxs-lookup"><span data-stu-id="51cd6-109">This reference architecture describes a enterprise-grade, production-level system.</span></span> <span data-ttu-id="51cd6-110">Эта конфигурация может быть сведена к одной виртуальной машине в соответствии с вашими бизнес-требованиями.</span><span class="sxs-lookup"><span data-stu-id="51cd6-110">To suit your business needs, this configuration can be reduced to a single virtual machine.</span></span> <span data-ttu-id="51cd6-111">Ниже приведены обязательные компоненты.</span><span class="sxs-lookup"><span data-stu-id="51cd6-111">However, the following components are required:</span></span>

<span data-ttu-id="51cd6-112">**Виртуальная сеть**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-112">**Virtual network**.</span></span> <span data-ttu-id="51cd6-113">Служба [виртуальной сети Azure](/azure/virtual-network/virtual-networks-overview) обеспечивает безопасное подключение ресурсов Azure друг к другу.</span><span class="sxs-lookup"><span data-stu-id="51cd6-113">The [Azure Virtual Network](/azure/virtual-network/virtual-networks-overview) service securely connects Azure resources to each other.</span></span> <span data-ttu-id="51cd6-114">В этой архитектуре виртуальная сеть подключается к локальной среде через шлюз, развернутый в концентраторе в рамках [звездообразной топологии](../hybrid-networking/hub-spoke.md).</span><span class="sxs-lookup"><span data-stu-id="51cd6-114">In this architecture, the virtual network connects to an on-premises environment through a gateway deployed in the hub of a [hub-spoke topology](../hybrid-networking/hub-spoke.md).</span></span> <span data-ttu-id="51cd6-115">Периферией выступает виртуальная сеть, используемая для приложений SAP.</span><span class="sxs-lookup"><span data-stu-id="51cd6-115">The spoke is the virtual network used for the SAP applications.</span></span>

<span data-ttu-id="51cd6-116">**Подсети.**</span><span class="sxs-lookup"><span data-stu-id="51cd6-116">**Subnets**.</span></span> <span data-ttu-id="51cd6-117">Виртуальная сеть подразделяется на отдельные [подсети](/azure/virtual-network/virtual-network-manage-subnet) для каждого уровня: шлюз, приложение, база данных и общие службы.</span><span class="sxs-lookup"><span data-stu-id="51cd6-117">The virtual network is subdivided into separate [subnets](/azure/virtual-network/virtual-network-manage-subnet) for each tier: gateway, application, database, and shared services .</span></span> 

<span data-ttu-id="51cd6-118">**Виртуальные машины**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-118">**Virtual machines**.</span></span> <span data-ttu-id="51cd6-119">В этой архитектуре используются виртуальные машины под управлением Linux для уровня приложения и уровня базы данных, сгруппированные следующим образом:</span><span class="sxs-lookup"><span data-stu-id="51cd6-119">This architecture uses virtual machines running Linux for the application tier and database tier, grouped as follows:</span></span>

- <span data-ttu-id="51cd6-120">**Уровень приложения**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-120">**Application tier**.</span></span> <span data-ttu-id="51cd6-121">Включает пул серверов переднего плана Fiori, пул веб-диспетчера SAP, пул серверов приложений и кластер центральных служб SAP.</span><span class="sxs-lookup"><span data-stu-id="51cd6-121">Includes the Fiori Front-end Server pool, SAP Web Dispatcher pool, application server pool, and SAP Central Services cluster.</span></span> <span data-ttu-id="51cd6-122">Для обеспечения высокой доступности центральных служб на виртуальных машинах Azure Linux требуется высокодоступная служба сетевой файловой системы (NFS).</span><span class="sxs-lookup"><span data-stu-id="51cd6-122">For high availability of Central Services on Azure Linux virtual machines, a highly available Network File System (NFS) service is required.</span></span>
- <span data-ttu-id="51cd6-123">**Кластер NFS**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-123">**NFS cluster**.</span></span> <span data-ttu-id="51cd6-124">Эта архитектура использует сервер [NFS](/azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs), запущенный в кластере Linux, для хранения данных, совместно используемых системами SAP.</span><span class="sxs-lookup"><span data-stu-id="51cd6-124">This architecture uses an [NFS](/azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs) server running on a Linux cluster to store data shared between SAP systems.</span></span> <span data-ttu-id="51cd6-125">Этот централизованный кластер можно использовать в нескольких системах SAP.</span><span class="sxs-lookup"><span data-stu-id="51cd6-125">This centralized cluster can be shared across multiple SAP systems.</span></span> <span data-ttu-id="51cd6-126">Для обеспечения высокой доступности службы NFS используется соответствующее расширение высокой доступности для выбранного дистрибутива Linux.</span><span class="sxs-lookup"><span data-stu-id="51cd6-126">For high availability of the NFS service, the appropriate High Availability Extension for the selected Linux distribution is used.</span></span>
- <span data-ttu-id="51cd6-127">**SAP HANA**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-127">**SAP HANA**.</span></span> <span data-ttu-id="51cd6-128">Уровень базы данных использует две или более виртуальные машины Linux в кластере для достижения высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="51cd6-128">The database tier uses two or more Linux virtual machines in a cluster to achieve high availability.</span></span> <span data-ttu-id="51cd6-129">Репликация системы HANA (HSR) используется для репликации содержимого между первичной и вторичной системами HANA.</span><span class="sxs-lookup"><span data-stu-id="51cd6-129">HANA System Replication (HSR) is used to replicate contents between primary and secondary HANA systems.</span></span> <span data-ttu-id="51cd6-130">Кластеризация Linux применяется для обнаружения сбоев системы и упрощения автоматического перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="51cd6-130">Linux clustering is used to detect system failures and facilitate automatic failover.</span></span> <span data-ttu-id="51cd6-131">Механизм ограждения на основе хранилища или облака обеспечивает изоляцию или завершение работы неисправной системы во избежание состояния разделения вычислительных мощностей кластера.</span><span class="sxs-lookup"><span data-stu-id="51cd6-131">A storage-based or cloud-based fencing mechanism can be used to ensure the failed system is isolated or shut down to avoid the cluster split-brain condition.</span></span>
- <span data-ttu-id="51cd6-132">**Jumpbox**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-132">**Jumpbox**.</span></span> <span data-ttu-id="51cd6-133">Он также называется узлом-бастионом.</span><span class="sxs-lookup"><span data-stu-id="51cd6-133">Also called a bastion host.</span></span> <span data-ttu-id="51cd6-134">Это безопасная виртуальная машина в сети, которую администраторы используют для подключения к другим виртуальным машинам.</span><span class="sxs-lookup"><span data-stu-id="51cd6-134">This is a secure virtual machine on the network that administrators use to connect to the other virtual machines.</span></span> <span data-ttu-id="51cd6-135">Она может работать под управлением Windows или Linux.</span><span class="sxs-lookup"><span data-stu-id="51cd6-135">It can run Windows or Linux.</span></span> <span data-ttu-id="51cd6-136">Windows Jumpbox упрощает работу в Интернете при использовании инструментов управления HANA Cockpit или HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="51cd6-136">Use a Windows jumpbox for web browsing convenience when using HANA Cockpit or HANA Studio management tools.</span></span>

<span data-ttu-id="51cd6-137">**Подсистемы балансировки нагрузки.**</span><span class="sxs-lookup"><span data-stu-id="51cd6-137">**Load balancers**.</span></span> <span data-ttu-id="51cd6-138">Для достижения высокого уровня доступности используются как встроенные подсистемы балансировки нагрузки SAP, так и [Azure Load Balancer](/azure/load-balancer/load-balancer-overview).</span><span class="sxs-lookup"><span data-stu-id="51cd6-138">Both built-in SAP load balancers and [Azure Load Balancer](/azure/load-balancer/load-balancer-overview) are used to achieve HA.</span></span> <span data-ttu-id="51cd6-139">Экземпляры Azure Load Balancer распределяют трафик на виртуальные машины в подсети уровня приложения.</span><span class="sxs-lookup"><span data-stu-id="51cd6-139">Azure Load Balancer instances are used to distribute traffic to virtual machines in the application tier subnet.</span></span>

<span data-ttu-id="51cd6-140">**Группы доступности**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-140">**Availability sets**.</span></span> <span data-ttu-id="51cd6-141">Виртуальные машины для всех пулов и кластеров (веб-диспетчер, серверы приложений SAP, центральные службы, NFS и HANA) объединяются в отдельные [группы доступности](/azure/virtual-machines/windows/tutorial-availability-sets) и по крайней мере две виртуальные машины подготавливаются в каждой роли.</span><span class="sxs-lookup"><span data-stu-id="51cd6-141">Virtual machines for all pools and clusters (Web Dispatcher, SAP application servers, Central Services, NFS, and HANA) are grouped into separate [availability sets](/azure/virtual-machines/windows/tutorial-availability-sets), and at least two virtual machines are provisioned per role.</span></span> <span data-ttu-id="51cd6-142">Таким образом виртуальные машины станут подходящими для [соглашения об уровне обслуживания (SLA)](https://azure.microsoft.com/support/legal/sla/virtual-machines) более высокого уровня.</span><span class="sxs-lookup"><span data-stu-id="51cd6-142">This makes the virtual machines eligible for a higher [service level agreement](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA).</span></span> 

<span data-ttu-id="51cd6-143">**Сетевые карты**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-143">**NICs**.</span></span> <span data-ttu-id="51cd6-144">[Сетевые карты](/azure/virtual-network/virtual-network-network-interface) (NIC) позволяют осуществлять связь между всеми виртуальными машинами в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="51cd6-144">[Network interface cards](/azure/virtual-network/virtual-network-network-interface) (NICs) enable all communication of virtual machines on a virtual network.</span></span>

<span data-ttu-id="51cd6-145">**Группы безопасности сети**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-145">**Network security groups**.</span></span> <span data-ttu-id="51cd6-146">[Они](/azure/virtual-network/virtual-networks-nsg) позволяют ограничить входящий, исходящий трафик и трафик внутри подсети в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="51cd6-146">To restrict incoming, outgoing, and intra-subnet traffic in the virtual network, [network security groups](/azure/virtual-network/virtual-networks-nsg) (NSGs) are used.</span></span>

<span data-ttu-id="51cd6-147">**Шлюз.**</span><span class="sxs-lookup"><span data-stu-id="51cd6-147">**Gateway**.</span></span> <span data-ttu-id="51cd6-148">Шлюз расширяет локальную сеть до виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="51cd6-148">A gateway extends your on-premises network to the Azure virtual network.</span></span> <span data-ttu-id="51cd6-149">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) — рекомендуемая служба Azure для создания частных подключений, которые не проходят через общедоступный Интернет, но также можно использовать [подключение типа "сеть — сеть"](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal).</span><span class="sxs-lookup"><span data-stu-id="51cd6-149">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) is the recommended Azure service for creating private connections that do not go over the public Internet, but a [Site-to-Site](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) connection can also be used.</span></span> 

<span data-ttu-id="51cd6-150">**Хранилище Azure.**</span><span class="sxs-lookup"><span data-stu-id="51cd6-150">**Azure Storage**.</span></span> <span data-ttu-id="51cd6-151">Для предоставления постоянного хранилища виртуального жесткого диска (VHD) виртуальной машины требуется [хранилище Azure](/azure/storage/).</span><span class="sxs-lookup"><span data-stu-id="51cd6-151">To provide persistent storage of a virtual machine's virtual hard disk (VHD), [Azure Storage](/azure/storage/) is required.</span></span> 

## <a name="recommendations"></a><span data-ttu-id="51cd6-152">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="51cd6-152">Recommendations</span></span>

<span data-ttu-id="51cd6-153">Эта архитектура описывает небольшое корпоративное развертывание производственного уровня.</span><span class="sxs-lookup"><span data-stu-id="51cd6-153">This architecture describes a small production-level enterprise deployment.</span></span> <span data-ttu-id="51cd6-154">Ваше развертывание будет отличаться в зависимости от ваших бизнес-требований.</span><span class="sxs-lookup"><span data-stu-id="51cd6-154">Your deployment will differ based on your business requirements.</span></span> <span data-ttu-id="51cd6-155">Воспользуйтесь этими рекомендациями в качестве отправной точки.</span><span class="sxs-lookup"><span data-stu-id="51cd6-155">Use these recommendations as a starting point.</span></span>

### <a name="virtual-machines"></a><span data-ttu-id="51cd6-156">Виртуальные машины</span><span class="sxs-lookup"><span data-stu-id="51cd6-156">Virtual machines</span></span>

<span data-ttu-id="51cd6-157">В пулах и кластерах серверов приложений настройте количество виртуальных машин на основе ваших требований.</span><span class="sxs-lookup"><span data-stu-id="51cd6-157">In application server pools and clusters, adjust the number of virtual machines based on your requirements.</span></span> <span data-ttu-id="51cd6-158">В статье [SAP NetWeaver на виртуальных машинах Windows. Руководство по планированию и внедрению](/azure/virtual-machines/workloads/sap/planning-guide) содержатся сведения о запуске SAP NetWeaver на виртуальных машинах, но эта информация также относится к SAP S/4HANA.</span><span class="sxs-lookup"><span data-stu-id="51cd6-158">The [Azure Virtual Machines planning and implementation guide](/azure/virtual-machines/workloads/sap/planning-guide) includes details about running SAP NetWeaver on virtual machines, but the information applies to SAP S/4HANA as well.</span></span>

<span data-ttu-id="51cd6-159">Подробнее о поддержке SAP для типов виртуальных машин Azure и о показателях пропускной способности (SAPS) см. в [примечании к SAP № 1928533](https://launchpad.support.sap.com/#/notes/1928533).</span><span class="sxs-lookup"><span data-stu-id="51cd6-159">For details about SAP support for Azure virtual machine types and throughput metrics (SAPS), see [SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533).</span></span> 

### <a name="sap-web-dispatcher-pool"></a><span data-ttu-id="51cd6-160">Пул веб-диспетчера SAP</span><span class="sxs-lookup"><span data-stu-id="51cd6-160">SAP Web Dispatcher pool</span></span>

<span data-ttu-id="51cd6-161">Компонент "веб-диспетчер" используется как подсистема балансировки нагрузки для трафика SAP между серверами приложений SAP.</span><span class="sxs-lookup"><span data-stu-id="51cd6-161">The Web Dispatcher component is used as a load balancer for SAP traffic among the SAP application servers.</span></span> <span data-ttu-id="51cd6-162">Чтобы обеспечить высокую доступность компонента веб-диспетчера, Azure Load Balancer реализует параллельную настройку веб-диспетчера в циклической конфигурации для распределения трафика HTTP(S) среди доступных веб-диспетчеров в серверном пуле балансировщиков.</span><span class="sxs-lookup"><span data-stu-id="51cd6-162">To achieve high availability for the Web Dispatcher component, Azure Load Balancer is used to implement the parallel Web Dispatcher setup in a round-robin configuration for HTTP(S) traffic distribution among the available Web Dispatchers in the balancers back-end pool.</span></span> 

### <a name="fiori-front-end-server"></a><span data-ttu-id="51cd6-163">Сервер переднего плана Fiori</span><span class="sxs-lookup"><span data-stu-id="51cd6-163">Fiori Front-end Server</span></span>

<span data-ttu-id="51cd6-164">Сервер переднего плана Fiori использует [шлюз NetWeaver](https://help.sap.com/doc/saphelp_gateway20sp12/2.0/en-US/76/08828d832e4aa78748e9f82204a864/content.htm?no_cache=true).</span><span class="sxs-lookup"><span data-stu-id="51cd6-164">The Fiori Front-end Server uses a [NetWeaver Gateway](https://help.sap.com/doc/saphelp_gateway20sp12/2.0/en-US/76/08828d832e4aa78748e9f82204a864/content.htm?no_cache=true).</span></span> <span data-ttu-id="51cd6-165">Для небольших развертываний его можно загрузить на сервер Fiori.</span><span class="sxs-lookup"><span data-stu-id="51cd6-165">For small deployments, it can be loaded on the Fiori server.</span></span> <span data-ttu-id="51cd6-166">Для крупных развертываний можно развернуть отдельный сервер для шлюза NetWeaver перед пулом серверов переднего плана Fiori.</span><span class="sxs-lookup"><span data-stu-id="51cd6-166">For large deployments, a separate server for the NetWeaver Gateway may be deployed in front of the Fiori Front-end Server pool.</span></span>

### <a name="application-servers-pool"></a><span data-ttu-id="51cd6-167">Пул серверов приложений</span><span class="sxs-lookup"><span data-stu-id="51cd6-167">Application servers pool</span></span>

<span data-ttu-id="51cd6-168">Для управления группами входа для серверов приложений ABAP используется транзакция SMLG.</span><span class="sxs-lookup"><span data-stu-id="51cd6-168">To manage logon groups for ABAP application servers, the SMLG transaction is used.</span></span> <span data-ttu-id="51cd6-169">Она использует функцию балансировки нагрузки на сервере сообщений центральных служб для распределения рабочей нагрузки между пулом серверов приложений SAP для трафика SAPGUI и RFC.</span><span class="sxs-lookup"><span data-stu-id="51cd6-169">It uses the load balancing function within the message server of the Central Services to distribute workload among SAP application servers pool for SAPGUIs and RFC traffic.</span></span> <span data-ttu-id="51cd6-170">Подключение сервера приложений к высокодоступным центральным службам осуществляется по имени виртуальной сети кластера.</span><span class="sxs-lookup"><span data-stu-id="51cd6-170">The application server connection to the highly available Central Services is through the cluster virtual network name.</span></span> <span data-ttu-id="51cd6-171">Это позволяет избежать необходимости изменять профиль сервера приложений для подключения к центральным службам после локального перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="51cd6-171">This avoids the need to change the application server profile for Central Services connectivity after a local failover.</span></span> 

### <a name="sap-central-services-cluster"></a><span data-ttu-id="51cd6-172">Кластер центральных служб SAP</span><span class="sxs-lookup"><span data-stu-id="51cd6-172">SAP Central Services cluster</span></span>

<span data-ttu-id="51cd6-173">Центральные службы могут быть развернуты на одной виртуальной машине, если высокая доступность не является обязательной.</span><span class="sxs-lookup"><span data-stu-id="51cd6-173">Central Services can be deployed to a single virtual machine when high availability is not a requirement.</span></span> <span data-ttu-id="51cd6-174">Однако единственная виртуальная машина становится потенциальной единой точкой отказа (SPOF) для среды SAP.</span><span class="sxs-lookup"><span data-stu-id="51cd6-174">However, the single virtual machine becomes a potential single point of failure (SPOF) for the SAP environment.</span></span> <span data-ttu-id="51cd6-175">Для высокодоступного развертывания центральных служб используется высокодоступный кластер NFS и высокодоступный кластер центральных служб.</span><span class="sxs-lookup"><span data-stu-id="51cd6-175">For a highly available Central Services deployment, a highly available NFS cluster and a highly available Central Services cluster are used.</span></span>

### <a name="nfs-cluster"></a><span data-ttu-id="51cd6-176">Кластер NFS</span><span class="sxs-lookup"><span data-stu-id="51cd6-176">NFS cluster</span></span>

<span data-ttu-id="51cd6-177">DRBD (распределенное реплицированное блочное устройство) используется для репликации между узлами кластера NFS.</span><span class="sxs-lookup"><span data-stu-id="51cd6-177">DRBD (Distributed Replicated Block Device) is used for replication between the nodes of the NFS cluster.</span></span>

### <a name="availability-sets"></a><span data-ttu-id="51cd6-178">Группы доступности</span><span class="sxs-lookup"><span data-stu-id="51cd6-178">Availability sets</span></span>

<span data-ttu-id="51cd6-179">Группы доступности распределяют серверы между разными физическими инфраструктурами и группами обновлений для повышения доступности служб.</span><span class="sxs-lookup"><span data-stu-id="51cd6-179">Availability sets distribute servers to different physical infrastructure and update groups to improve service availability.</span></span> <span data-ttu-id="51cd6-180">Поместите виртуальные машины, которые выполняют одинаковую роль, в группы доступности во избежание простоя, вызванного обслуживанием инфраструктуры Azure, и для соответствия [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="51cd6-180">Put virtual machines that perform the same role into an availability sets to help guard against downtime caused by Azure infrastructure maintenance and to meet [SLAs](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span></span> <span data-ttu-id="51cd6-181">Рекомендуется использовать две или более виртуальных машин на группу доступности.</span><span class="sxs-lookup"><span data-stu-id="51cd6-181">Two or more virtual machines per availability set is recommended.</span></span>

<span data-ttu-id="51cd6-182">Все виртуальные машины в группе должны выполнять ту же роль.</span><span class="sxs-lookup"><span data-stu-id="51cd6-182">All virtual machines in a set must perform the same role.</span></span> <span data-ttu-id="51cd6-183">Не смешивайте серверы разных ролей в одной группе доступности.</span><span class="sxs-lookup"><span data-stu-id="51cd6-183">Do not mix servers of different roles in the same availability set.</span></span> <span data-ttu-id="51cd6-184">Например, не размещайте узел ASCS в одной группе доступности с сервером приложений.</span><span class="sxs-lookup"><span data-stu-id="51cd6-184">For example, don't place a ASCS node in the same availability set with the application server.</span></span>

### <a name="nics"></a><span data-ttu-id="51cd6-185">сетевые карты;</span><span class="sxs-lookup"><span data-stu-id="51cd6-185">NICs</span></span>

<span data-ttu-id="51cd6-186">Традиционные локальные ландшафты SAP реализуют несколько сетевых карт (NIC) на компьютер для отделения административного трафика от бизнес-трафика.</span><span class="sxs-lookup"><span data-stu-id="51cd6-186">Traditional on-premises SAP landscapes implement multiple network interface cards (NICs) per machine to segregate administrative traffic from business traffic.</span></span> <span data-ttu-id="51cd6-187">В Azure виртуальная сеть представляет собой программно-определяемую сеть, которая отправляет весь трафик через одну и ту же сетевую структуру.</span><span class="sxs-lookup"><span data-stu-id="51cd6-187">On Azure, the virtual network is a software-defined network that sends all traffic through the same network fabric.</span></span> <span data-ttu-id="51cd6-188">Поэтому использование нескольких сетевых адаптеров не требуется.</span><span class="sxs-lookup"><span data-stu-id="51cd6-188">Therefore, the use of multiple NICs is unnecessary.</span></span> <span data-ttu-id="51cd6-189">Однако, если вашей организации необходимо разделить трафик, вы можете развернуть несколько сетевых карт на одну виртуальную машину, подключить каждую карту к другой подсети, а затем использовать NSG для применения различных политик управления доступом.</span><span class="sxs-lookup"><span data-stu-id="51cd6-189">However, if your organization needs to segregate traffic, you can deploy multiple NICs per VM, connect each NIC to a different subnet, and then use NSGs to enforce different access control policies.</span></span>

### <a name="subnets-and-nsgs"></a><span data-ttu-id="51cd6-190">Подсети и группы безопасности сети</span><span class="sxs-lookup"><span data-stu-id="51cd6-190">Subnets and NSGs</span></span>

<span data-ttu-id="51cd6-191">Эта архитектура подразделяет адресное пространство виртуальной сети на подсети.</span><span class="sxs-lookup"><span data-stu-id="51cd6-191">This architecture subdivides the virtual network address space into subnets.</span></span> <span data-ttu-id="51cd6-192">Каждая подсеть может быть связана с NSG, которая определяет политики доступа для подсети.</span><span class="sxs-lookup"><span data-stu-id="51cd6-192">Each subnet can be associated with a NSG that defines the access policies for the subnet.</span></span> <span data-ttu-id="51cd6-193">Разместите серверы приложений в отдельной подсети, чтобы упростить их защиту за счет управления политиками безопасности подсети, а не отдельными серверами.</span><span class="sxs-lookup"><span data-stu-id="51cd6-193">Place application servers on a separate subnet so you can secure them more easily by managing the subnet security policies, not the individual servers.</span></span>

<span data-ttu-id="51cd6-194">Когда NSG связывается с подсетью, она применяется ко всем серверам в подсети.</span><span class="sxs-lookup"><span data-stu-id="51cd6-194">When a NSG is associated with a subnet, it then applies to all the servers within the subnet.</span></span> <span data-ttu-id="51cd6-195">Дополнительные сведения об использовании NSG для точного управления серверами в подсети см. в [этой статье](https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/).</span><span class="sxs-lookup"><span data-stu-id="51cd6-195">For more information about using NSGs for fine-grained control over the servers in a subnet, see [Filter network traffic with network security groups](https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/).</span></span>

<span data-ttu-id="51cd6-196">См. также сведения в статье [Планирование и проектирование VPN-шлюза](/azure/vpn-gateway/vpn-gateway-plan-design).</span><span class="sxs-lookup"><span data-stu-id="51cd6-196">See also [Planning and design for VPN Gateway](/azure/vpn-gateway/vpn-gateway-plan-design).</span></span>

### <a name="load-balancers"></a><span data-ttu-id="51cd6-197">Балансировщики нагрузки</span><span class="sxs-lookup"><span data-stu-id="51cd6-197">Load balancers</span></span>

<span data-ttu-id="51cd6-198">[Веб диспетчер SAP](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) управляет балансировкой нагрузки трафика HTTP(S), включая приложения типа Fiori, поступающего в пул серверов приложений SAP.</span><span class="sxs-lookup"><span data-stu-id="51cd6-198">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) handles load balancing of HTTP(S) traffic including Fiori style applications to a pool of SAP application servers.</span></span> 

<span data-ttu-id="51cd6-199">Для трафика клиентов SAP GUI, подключающихся к серверу SAP через DIAG или удаленные вызовы функций (RFC), сервер обмена сообщениями центральных служб балансирует нагрузку через [группы входа](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing) сервера приложений SAP, поэтому дополнительный балансировщик нагрузки не требуется.</span><span class="sxs-lookup"><span data-stu-id="51cd6-199">For traffic from SAP GUI clients connecting a SAP server via DIAG or Remote Function Calls (RFC), the Central Service message server balances the load through SAP application server [logon groups](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing), so no additional load balancer is needed.</span></span> 

### <a name="azure-storage"></a><span data-ttu-id="51cd6-200">Хранилище Azure</span><span class="sxs-lookup"><span data-stu-id="51cd6-200">Azure Storage</span></span>

<span data-ttu-id="51cd6-201">Мы рекомендуем использовать хранилище Azure класса Premium для виртуальных машин сервера баз данных.</span><span class="sxs-lookup"><span data-stu-id="51cd6-201">We recommend using Azure Premium Storage for the database server virtual machines.</span></span> <span data-ttu-id="51cd6-202">Хранилище класса Premium обеспечивает постоянно низкую задержку чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="51cd6-202">Premium storage provides consistent read/write latency.</span></span> <span data-ttu-id="51cd6-203">Подробнее об использовании хранилища класса Premium для дисков операционной системы и дисков данных для одноэкземплярной виртуальной машины см. в статье [Соглашение об уровне обслуживания для виртуальных машин](https://azure.microsoft.com/support/legal/sla/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="51cd6-203">For details about using Premium Storage for the operating system disks and data disks of a single-instance virtual machine, see [SLA for Virtual Machines](https://azure.microsoft.com/support/legal/sla/virtual-machines/).</span></span> 

<span data-ttu-id="51cd6-204">Для всех производственных систем SAP мы рекомендуем использовать [управляемые диски Azure уровня "Премиум"](/azure/storage/storage-managed-disks-overview).</span><span class="sxs-lookup"><span data-stu-id="51cd6-204">For all production SAP systems, we recommend using Premium [Azure Managed Disks](/azure/storage/storage-managed-disks-overview).</span></span> <span data-ttu-id="51cd6-205">Управляемые диски используются для управления VHD-файлами для дисков, что повышает надежность.</span><span class="sxs-lookup"><span data-stu-id="51cd6-205">Managed Disks are used to manage the VHD files for the disks, adding reliability.</span></span> <span data-ttu-id="51cd6-206">Они также обеспечивают изоляцию дисков для виртуальных машин в группе доступности, что помогает избежать единых точек отказа.</span><span class="sxs-lookup"><span data-stu-id="51cd6-206">They also ensure that the disks for virtual machines within an availability set are isolated to avoid single points of failure.</span></span>

<span data-ttu-id="51cd6-207">Для серверов приложений SAP, включая виртуальные машины центральных служб, можно использовать службу хранилища Azure класса Standard для снижения расходов, так как выполнение приложений происходит в памяти и диски используются только для ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="51cd6-207">For SAP application servers, including the Central Services virtual machines, you can use Azure Standard Storage to reduce cost, because application execution takes place in memory and uses disks for logging only.</span></span> <span data-ttu-id="51cd6-208">Однако в настоящее время хранилище класса Standard сертифицировано только для неуправляемого хранилища.</span><span class="sxs-lookup"><span data-stu-id="51cd6-208">However, at this time, Standard Storage is only certified for unmanaged storage.</span></span> <span data-ttu-id="51cd6-209">Так как серверы приложений не содержат никаких данных, вы также можете использовать меньшие диски хранилища класса Premium P4 и P6 для сокращения затрат.</span><span class="sxs-lookup"><span data-stu-id="51cd6-209">Since application servers do not host any data, you can also use the smaller P4 and P6 Premium Storage disks to help minimize cost.</span></span>

<span data-ttu-id="51cd6-210">Для хранения резервных копий данных рекомендуется использовать [хранилище холодного уровня доступа или архивного уровня доступа](/azure/storage/storage-blob-storage-tiers) Azure.</span><span class="sxs-lookup"><span data-stu-id="51cd6-210">For the backup data store, we recommend using Azure [cool access tier storage and/or archive access tier storage](/azure/storage/storage-blob-storage-tiers).</span></span> <span data-ttu-id="51cd6-211">Эти уровни хранилища являются эффективными методами хранения данных, которые редко используются и имеют большой срок хранения.</span><span class="sxs-lookup"><span data-stu-id="51cd6-211">These storage tiers are cost-effective ways to store long-lived data that is less frequently accessed.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="51cd6-212">Рекомендации по производительности</span><span class="sxs-lookup"><span data-stu-id="51cd6-212">Performance considerations</span></span>

<span data-ttu-id="51cd6-213">Серверы приложений SAP поддерживают постоянную связь с серверами баз данных.</span><span class="sxs-lookup"><span data-stu-id="51cd6-213">SAP application servers carry on constant communications with the database servers.</span></span> <span data-ttu-id="51cd6-214">Для виртуальных машин базы данных HANA рассмотрите возможность включения [ускорителя записи](/azure/virtual-machines/linux/how-to-enable-write-accelerator), позволяющего снизить задержку записи в журнал.</span><span class="sxs-lookup"><span data-stu-id="51cd6-214">For the HANA database virtual machines, consider enabling [Write Accelerator](/azure/virtual-machines/linux/how-to-enable-write-accelerator) to improve log write latency.</span></span> <span data-ttu-id="51cd6-215">Чтобы оптимизировать межсерверную связь, используйте [ускоренную сеть](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span><span class="sxs-lookup"><span data-stu-id="51cd6-215">To optimize inter-server communications, use the [Accelerated Network](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span></span> <span data-ttu-id="51cd6-216">Обратите внимание, что эти ускорители доступны только для определенных серий виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="51cd6-216">Note that these accelerators are available only for certain VM series.</span></span>

<span data-ttu-id="51cd6-217">Чтобы добиться высокой скорости операции ввода-вывода и лучшей пропускной способности диска, к структуре хранилища Azure применяются распространенные методы [оптимизации производительности](/azure/virtual-machines/linux/premium-storage-performance) тома хранилища.</span><span class="sxs-lookup"><span data-stu-id="51cd6-217">To achieve high IOPS and disk bandwidth throughput, the common practices in storage volume [performance optimization](/azure/virtual-machines/linux/premium-storage-performance) apply to Azure storage layout.</span></span> <span data-ttu-id="51cd6-218">Например, объединение нескольких дисков вместе для создания чередующегося дискового тома повышает производительность операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="51cd6-218">For example, combining multiple disks together to create a striped disk volume improves IO performance.</span></span> <span data-ttu-id="51cd6-219">Включение кэша чтения в содержимом хранилища, которое редко изменяется, повышает скорость извлечения данных.</span><span class="sxs-lookup"><span data-stu-id="51cd6-219">Enabling the read cache on storage content that changes infrequently enhances the speed of data retrieval.</span></span> <span data-ttu-id="51cd6-220">Дополнительные сведения о требованиях к производительности см. в [примечании SAP 1943937 о средстве проверки конфигурации оборудования](https://launchpad.support.sap.com/#/notes/1943937) (для доступа требуется учетная запись SAP Service Marketplace).</span><span class="sxs-lookup"><span data-stu-id="51cd6-220">For details about performance requirements, see [SAP note 1943937 - Hardware Configuration Check Tool](https://launchpad.support.sap.com/#/notes/1943937) (SAP Service Marketplace account required for access).</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="51cd6-221">Вопросы масштабируемости</span><span class="sxs-lookup"><span data-stu-id="51cd6-221">Scalability considerations</span></span>

<span data-ttu-id="51cd6-222">На уровне приложений SAP Azure предлагает широкий диапазон размеров виртуальных машин для вертикального и горизонтального масштабирования. Полный список см. в [примечании SAP № 1928533 о поддерживаемых продуктах и типах виртуальных машин Azure для приложений SAP в Azure](https://launchpad.support.sap.com/#/notes/1928533) (для доступа требуется учетная запись SAP Service Marketplace).</span><span class="sxs-lookup"><span data-stu-id="51cd6-222">At the SAP application layer, Azure offers a wide range of virtual machine sizes for scaling up and scaling out. For an inclusive list, see [SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533) - SAP Applications on Azure: Supported Products and Azure VM types (SAP Service Marketplace account required for access).</span></span> <span data-ttu-id="51cd6-223">По мере того, как мы продолжаем сертифицировать больше типов виртуальных машин, вы можете масштабировать ресурсы с помощью одного и того же облачного развертывания.</span><span class="sxs-lookup"><span data-stu-id="51cd6-223">As we continue to certify more virtual machines types, you can scale up or down with the same cloud deployment.</span></span> 

<span data-ttu-id="51cd6-224">На уровне базы данных эта архитектура запускает HANA на виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="51cd6-224">At the database layer, this architecture runs HANA on VMs.</span></span> <span data-ttu-id="51cd6-225">Если ваша рабочая нагрузка превышает максимальный размер виртуальной машины, корпорация Майкрософт также предлагает [крупные экземпляры Azure](/azure/virtual-machines/workloads/sap/hana-overview-architecture) для SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="51cd6-225">If your workload exceeds the maximum VM size, Microsoft also offers [Azure Large Instances](/azure/virtual-machines/workloads/sap/hana-overview-architecture) for SAP HANA.</span></span> <span data-ttu-id="51cd6-226">Эти физические серверы расположены совместно в сертифицированном центре обработки данных Майкрософт Azure и на момент написания этой статьи обеспечивают до 20 ТБ объема памяти для одного экземпляра.</span><span class="sxs-lookup"><span data-stu-id="51cd6-226">These physical servers are co-located in a Microsoft Azure certified datacenter and as of this writing, provide up to 20 TB of memory capacity for a single instance.</span></span> <span data-ttu-id="51cd6-227">Также возможны конфигурации с несколькими узлами и общей емкостью памяти до 60 ТБ.</span><span class="sxs-lookup"><span data-stu-id="51cd6-227">Multi-node configuration is also possible with a total memory capacity of up to 60 TB.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="51cd6-228">Вопросы доступности</span><span class="sxs-lookup"><span data-stu-id="51cd6-228">Availability considerations</span></span>

<span data-ttu-id="51cd6-229">Обеспечение избыточности ресурсов является общей процедурой в высокодоступных инфраструктурных решениях.</span><span class="sxs-lookup"><span data-stu-id="51cd6-229">Resource redundancy is the general theme in highly available infrastructure solutions.</span></span> <span data-ttu-id="51cd6-230">Для предприятий с менее строгим SLA одноэкземплярные виртуальные машины Azure предлагают SLA с гарантией времени непрерывной работы.</span><span class="sxs-lookup"><span data-stu-id="51cd6-230">For enterprises that have a less stringent SLA, single-instance Azure VMs offer an uptime SLA.</span></span> <span data-ttu-id="51cd6-231">Дополнительные сведения см. в статье [Соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/).</span><span class="sxs-lookup"><span data-stu-id="51cd6-231">For more information, see [Azure Service Level Agreement](https://azure.microsoft.com/support/legal/sla/).</span></span>

<span data-ttu-id="51cd6-232">В этой распределенной установке приложения SAP базовая установка реплицируется для обеспечения высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="51cd6-232">In this distributed installation of the SAP application, the base installation is replicated to achieve high availability.</span></span> <span data-ttu-id="51cd6-233">Для каждого слоя архитектуры способ обеспечения высокого уровня доступности варьируется.</span><span class="sxs-lookup"><span data-stu-id="51cd6-233">For each layer of the architecture, the high availability design varies.</span></span> 

### <a name="application-tier"></a><span data-ttu-id="51cd6-234">Уровень приложения</span><span class="sxs-lookup"><span data-stu-id="51cd6-234">Application tier</span></span>

- <span data-ttu-id="51cd6-235">Веб-диспетчер.</span><span class="sxs-lookup"><span data-stu-id="51cd6-235">Web Dispatcher.</span></span> <span data-ttu-id="51cd6-236">Высокий уровень доступности достигается с помощью избыточного количества экземпляров веб-диспетчера.</span><span class="sxs-lookup"><span data-stu-id="51cd6-236">High availability is achieved with redundant Web Dispatcher instances.</span></span> <span data-ttu-id="51cd6-237">Дополнительные сведения см. в документации по [веб-диспетчеру SAP](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm).</span><span class="sxs-lookup"><span data-stu-id="51cd6-237">See [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm) in the SAP documentation.</span></span>
- <span data-ttu-id="51cd6-238">Серверы Fiori.</span><span class="sxs-lookup"><span data-stu-id="51cd6-238">Fiori servers.</span></span> <span data-ttu-id="51cd6-239">Высокий уровень доступности достигается путем балансировки нагрузки трафика в пуле серверов.</span><span class="sxs-lookup"><span data-stu-id="51cd6-239">High availability is achieved by load balancing traffic within a pool of servers.</span></span>
- <span data-ttu-id="51cd6-240">Центральные службы.</span><span class="sxs-lookup"><span data-stu-id="51cd6-240">Central Services.</span></span> <span data-ttu-id="51cd6-241">Для высокой доступности центральных служб на виртуальных машинах Linux в Azure используется соответствующее расширение высокой доступности для выбранного дистрибутива Linux, а на высокодоступном кластере NFS размещено хранилище DRBD.</span><span class="sxs-lookup"><span data-stu-id="51cd6-241">For high availability of Central Services on Azure Linux virtual machines, the appropriate High Availability Extension for the selected Linux distribution is used, and the highly available NFS cluster hosts DRBD storage.</span></span>
- <span data-ttu-id="51cd6-242">Серверы приложений.</span><span class="sxs-lookup"><span data-stu-id="51cd6-242">Application servers.</span></span> <span data-ttu-id="51cd6-243">Высокий уровень доступности достигается путем балансировки нагрузки трафика в пуле серверов приложений.</span><span class="sxs-lookup"><span data-stu-id="51cd6-243">High availability is achieved by load balancing traffic within a pool of application servers.</span></span>

### <a name="database-tier"></a><span data-ttu-id="51cd6-244">Уровень базы данных</span><span class="sxs-lookup"><span data-stu-id="51cd6-244">Database tier</span></span>

<span data-ttu-id="51cd6-245">Эта эталонная архитектура представляет собой высокодоступную систему баз данных SAP HANA, состоящую из двух виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="51cd6-245">This reference architecture depicts a highly available SAP HANA database system consisting of two Azure virtual machines.</span></span> <span data-ttu-id="51cd6-246">Встроенная функция репликации системы базы данных обеспечивает либо ручной, либо автоматический переход на другой ресурс между реплицируемыми узлами:</span><span class="sxs-lookup"><span data-stu-id="51cd6-246">The database tier's native system replication feature provides either manual or automatic failover between replicated nodes:</span></span>

- <span data-ttu-id="51cd6-247">Для перехода на другой ресурс вручную разверните несколько экземпляров и используйте систему репликации HANA (HSR).</span><span class="sxs-lookup"><span data-stu-id="51cd6-247">For manual failover, deploy more than one HANA instance and use HANA System Replication (HSR).</span></span>
- <span data-ttu-id="51cd6-248">Для автоматического перехода на другой ресурс используйте как HSR, так и расширение Linux High Availability Extension (HAE) для вашего дистрибутива Linux.</span><span class="sxs-lookup"><span data-stu-id="51cd6-248">For automatic failover, use both HSR and Linux High Availability Extension (HAE) for your Linux distribution.</span></span> <span data-ttu-id="51cd6-249">Linux HAE предоставляет кластерные службы для ресурсов HANA, обнаруживает события сбоя и оркеструет отработку отказа неисправных служб с переносом на работоспособный узел.</span><span class="sxs-lookup"><span data-stu-id="51cd6-249">Linux HAE provides the cluster services to the HANA resources, detecting failure events and orchestrating the failover of errant services to the healthy node.</span></span> 

<span data-ttu-id="51cd6-250">См. статью [Сертификаты и конфигурации SAP на платформе Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span><span class="sxs-lookup"><span data-stu-id="51cd6-250">See [SAP certifications and configurations running on Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span></span>

### <a name="disaster-recovery-considerations"></a><span data-ttu-id="51cd6-251">Рекомендации по аварийному восстановлению</span><span class="sxs-lookup"><span data-stu-id="51cd6-251">Disaster recovery considerations</span></span>
<span data-ttu-id="51cd6-252">Каждый уровень использует разную стратегию обеспечения защиты посредством аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="51cd6-252">Each tier uses a different strategy to provide disaster recovery (DR) protection.</span></span>

- <span data-ttu-id="51cd6-253">**Уровень серверов приложений**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-253">**Application servers tier**.</span></span> <span data-ttu-id="51cd6-254">Серверы приложений SAP не содержат бизнес-данных.</span><span class="sxs-lookup"><span data-stu-id="51cd6-254">SAP application servers do not contain business data.</span></span> <span data-ttu-id="51cd6-255">В Azure простой стратегией аварийного восстановления является создание серверов приложений SAP в дополнительном регионе, а затем завершение их работы.</span><span class="sxs-lookup"><span data-stu-id="51cd6-255">On Azure, a simple DR strategy is to create SAP application servers in the secondary region, then shut them down.</span></span> <span data-ttu-id="51cd6-256">При любых изменениях конфигурации или обновлениях ядра на основном сервере приложений те же изменения должны быть применены к виртуальным машинам в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="51cd6-256">Upon any configuration changes or kernel updates on the primary application server, the same changes must be applied to the virtual machines in the secondary region.</span></span> <span data-ttu-id="51cd6-257">Например, скопируйте исполняемые файлы ядра SAP на виртуальные машины аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="51cd6-257">For example, copy the SAP kernel executables to the DR virtual machines.</span></span> <span data-ttu-id="51cd6-258">Для автоматической репликации серверов приложений в дополнительный регион рекомендуется использовать [Azure Site Recovery](/azure/site-recovery/site-recovery-overview).</span><span class="sxs-lookup"><span data-stu-id="51cd6-258">For automatic replication of application servers to a secondary region, [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) is the recommended solution.</span></span> <span data-ttu-id="51cd6-259">На момент написания этой статьи ASR пока не поддерживает репликацию настройки конфигурации ускоренной сети на виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="51cd6-259">As of the writing of this paper, ASR doesn't yet support the replication of the Accelerated Network configuration setting in Azure VMs.</span></span>

- <span data-ttu-id="51cd6-260">**Центральные службы**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-260">**Central Services**.</span></span> <span data-ttu-id="51cd6-261">Этот компонент стека приложений SAP не сохраняет бизнес-данные.</span><span class="sxs-lookup"><span data-stu-id="51cd6-261">This component of the SAP application stack also does not persist business data.</span></span> <span data-ttu-id="51cd6-262">Вы можете создать виртуальную машину в дополнительном регионе для запуска роли централизованных служб.</span><span class="sxs-lookup"><span data-stu-id="51cd6-262">You can build a VM in the secondary region to run the Central Services role.</span></span> <span data-ttu-id="51cd6-263">Единственное содержимое основного узла центральных служб, которое синхронизируется, — это общее содержимое /sapmnt.</span><span class="sxs-lookup"><span data-stu-id="51cd6-263">The only content from the primary Central Services node to synchronize is the /sapmnt share content.</span></span> <span data-ttu-id="51cd6-264">Кроме того, если изменения конфигурации или обновления ядра происходят на основных серверах центральных служб, их необходимо повторить на виртуальной машине в дополнительном регионе, где запущены центральные службы.</span><span class="sxs-lookup"><span data-stu-id="51cd6-264">Also, if configuration changes or kernel updates take place on the primary Central Services servers, they must be repeated on the VM in the secondary region running Central Services.</span></span> <span data-ttu-id="51cd6-265">Синхронизировать два сервера можно либо с помощью Azure Site Recovery, выполнив репликацию узлов кластера, либо просто с помощью запланированного задания копирования, при котором /sapmnt копируется в регион аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="51cd6-265">To synchronize the two servers, you can use either Azure Site Recovery, to replicate the cluster nodes, or simply use a regularly scheduled copy job to copy /sapmnt to the DR side.</span></span> <span data-ttu-id="51cd6-266">Сведения о процессе создания, копирования и тестирования отработки отказа можно получить, скачав документ [SAP NetWeaver: Building a Hyper-V & Microsoft Azure–based Disaster Recovery Solution](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx) (Создание решения аварийного восстановления на основе Microsoft Azure и Hyper-V в SAP NetWeaver) и просмотрев сведения в разделе 4.3 "Уровень SAP SPOF (ASCS)."</span><span class="sxs-lookup"><span data-stu-id="51cd6-266">For details about the build, copy, and test failover process, download [SAP NetWeaver: Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx), and refer to section 4.3, "SAP SPOF layer (ASCS)."</span></span> <span data-ttu-id="51cd6-267">Этот документ относится к NetWeaver, работающему в Windows, но вы можете создать эквивалентную конфигурацию для Linux.</span><span class="sxs-lookup"><span data-stu-id="51cd6-267">This paper applies to NetWeaver running on Windows, but you can create the equivalent configuration for Linux.</span></span> <span data-ttu-id="51cd6-268">Для центральных служб используйте [Azure Site Recovery](/en-us/azure/site-recovery/site-recovery-overview) для репликации узлов кластера и хранилища.</span><span class="sxs-lookup"><span data-stu-id="51cd6-268">For Central Services, use [Azure Site Recovery](/en-us/azure/site-recovery/site-recovery-overview) to replicate the cluster nodes and storage.</span></span> <span data-ttu-id="51cd6-269">Для Linux создайте геокластер с тремя узлами, используя расширение высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="51cd6-269">For Linux, create a three node geo-cluster using a High Availability Extension.</span></span> 

- <span data-ttu-id="51cd6-270">**Уровень базы данных SAP**.</span><span class="sxs-lookup"><span data-stu-id="51cd6-270">**SAP database tier**.</span></span> <span data-ttu-id="51cd6-271">Используйте HSR для репликации, поддерживаемой HANA.</span><span class="sxs-lookup"><span data-stu-id="51cd6-271">Use HSR for HANA-supported replication.</span></span> <span data-ttu-id="51cd6-272">В дополнение к локальной настройке высокого уровня доступности с двумя узлами HSR поддерживает многоуровневую репликацию, при которой третий узел в отдельном регионе Azure действует как чужой объект, а не часть кластера и регистрирует вторичную реплику кластеризованной пары HSR в качестве своей цели репликации.</span><span class="sxs-lookup"><span data-stu-id="51cd6-272">In addition to a local, two-node high availability setup, HSR supports multi-tier replication where a third node in a separate Azure region acts as a foreign entity, not part of the cluster, and registers to the secondary replica of the clustered HSR pair as its replication target.</span></span> <span data-ttu-id="51cd6-273">Таким образом создается цепочка репликации.</span><span class="sxs-lookup"><span data-stu-id="51cd6-273">This form a replication daisy chain.</span></span> <span data-ttu-id="51cd6-274">Отработка отказа на узел аварийного восстановления выполняется вручную.</span><span class="sxs-lookup"><span data-stu-id="51cd6-274">The failover to the DR node is a manual process.</span></span>

<span data-ttu-id="51cd6-275">Чтобы использовать Azure Site Recovery для автоматического создания полностью реплицированного исходного рабочего сайта, нужно запустить индивидуальные [скрипты развертывания](/azure/site-recovery/site-recovery-runbook-automation).</span><span class="sxs-lookup"><span data-stu-id="51cd6-275">To use Azure Site Recovery to automatically build a fully replicated production site of your original, you must run customized [deployment scripts](/azure/site-recovery/site-recovery-runbook-automation).</span></span> <span data-ttu-id="51cd6-276">Сначала Site Recovery развертывает виртуальные машины в группах доступности, а затем запускает скрипты для добавления ресурсов, таких как балансировщики нагрузки.</span><span class="sxs-lookup"><span data-stu-id="51cd6-276">Site Recovery first deploys the virtual machines in availability sets, then runs scripts to add resources such as load balancers.</span></span> 

## <a name="manageability-considerations"></a><span data-ttu-id="51cd6-277">Вопросы управляемости</span><span class="sxs-lookup"><span data-stu-id="51cd6-277">Manageability considerations</span></span>

<span data-ttu-id="51cd6-278">SAP HANA имеет функцию резервного копирования, которая использует базовую инфраструктуру Azure.</span><span class="sxs-lookup"><span data-stu-id="51cd6-278">SAP HANA has a backup feature that makes use of the underlying Azure infrastructure.</span></span> <span data-ttu-id="51cd6-279">Чтобы создать резервную копию базы данных SAP HANA, выполняющейся на виртуальных машинах Azure, для обеспечения согласованности файлов резервных копий используются моментальный снимок SAP HANA и моментальный снимок хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="51cd6-279">To back up the SAP HANA database running on Azure virtual machines, both the SAP HANA snapshot and Azure storage snapshot are used to ensure the backup files' consistency.</span></span> <span data-ttu-id="51cd6-280">Дополнительные сведения см. в статьях [Руководство по резервному копированию SAP HANA на виртуальных машинах Azure](/azure/virtual-machines/workloads/sap/sap-hana-backup-guide) и [Вопросы о службе архивации Azure](/azure/backup/backup-azure-backup-faq).</span><span class="sxs-lookup"><span data-stu-id="51cd6-280">For details, see [Backup guide for SAP HANA on Azure Virtual Machines](/azure/virtual-machines/workloads/sap/sap-hana-backup-guide) and the [Azure Backup service FAQ](/azure/backup/backup-azure-backup-faq).</span></span> <span data-ttu-id="51cd6-281">Моментальный снимок хранилища Azure поддерживается только в одноконтейнерных развертываниях HANA.</span><span class="sxs-lookup"><span data-stu-id="51cd6-281">Only HANA single container deployments support Azure storage snapshot.</span></span>

### <a name="identity-management"></a><span data-ttu-id="51cd6-282">Управление удостоверениями</span><span class="sxs-lookup"><span data-stu-id="51cd6-282">Identity management</span></span>

<span data-ttu-id="51cd6-283">Контролируйте доступ к ресурсам с помощью централизованной системы управления идентификацией на всех уровнях:</span><span class="sxs-lookup"><span data-stu-id="51cd6-283">Control access to resources by using a centralized identity management system at all levels:</span></span>

- <span data-ttu-id="51cd6-284">Предоставляйте доступ к ресурсам Azure через [управление доступом на основе ролей](/azure/active-directory/role-based-access-control-what-is) (RBAC).</span><span class="sxs-lookup"><span data-stu-id="51cd6-284">Provide access to Azure resources through [role-based access control](/azure/active-directory/role-based-access-control-what-is) (RBAC).</span></span> 
- <span data-ttu-id="51cd6-285">Предоставляйте доступ к виртуальным машинам Azure через LDAP, Azure Active Directory, Kerberos или другую систему.</span><span class="sxs-lookup"><span data-stu-id="51cd6-285">Grant access to Azure VMs through LDAP, Azure Active Directory, Kerberos, or another system.</span></span> 
- <span data-ttu-id="51cd6-286">Поддерживайте доступ в самих приложениях через службы, предоставляемые SAP, или используйте [OAuth 2.0 и Azure Active Directory](/azure/active-directory/develop/active-directory-protocols-oauth-code).</span><span class="sxs-lookup"><span data-stu-id="51cd6-286">Support access within the apps themselves through the services that SAP provides, or use [OAuth 2.0 and Azure Active Directory](/azure/active-directory/develop/active-directory-protocols-oauth-code).</span></span> 

### <a name="monitoring"></a><span data-ttu-id="51cd6-287">Мониторинг</span><span class="sxs-lookup"><span data-stu-id="51cd6-287">Monitoring</span></span>

<span data-ttu-id="51cd6-288">Azure предоставляет несколько функций для [мониторинга и диагностики](/azure/architecture/best-practices/monitoring) во всей инфраструктуре.</span><span class="sxs-lookup"><span data-stu-id="51cd6-288">Azure provides several functions for [monitoring and diagnostics](/azure/architecture/best-practices/monitoring) of the overall infrastructure.</span></span> <span data-ttu-id="51cd6-289">Кроме того, расширенный мониторинг виртуальных машин Azure (Windows или Linux) обрабатывается с помощью Azure Operations Management Suite (OMS).</span><span class="sxs-lookup"><span data-stu-id="51cd6-289">Also, enhanced monitoring of Azure virtual machines (Linux or Windows) is handled by Azure Operations Management Suite (OMS).</span></span> 

<span data-ttu-id="51cd6-290">Чтобы обеспечить мониторинг ресурсов на основе SAP и производительности служб инфраструктуры SAP, используйте расширение [улучшенного мониторинга Azure для SAP](/azure/virtual-machines/workloads/sap/deployment-guide#d98edcd3-f2a1-49f7-b26a-07448ceb60ca).</span><span class="sxs-lookup"><span data-stu-id="51cd6-290">To provide SAP-based monitoring of resources and service performance of the SAP infrastructure, the [Azure SAP Enhanced Monitoring](/azure/virtual-machines/workloads/sap/deployment-guide#d98edcd3-f2a1-49f7-b26a-07448ceb60ca) extension is used.</span></span> <span data-ttu-id="51cd6-291">Это расширение передает статистику мониторинга Azure в приложение SAP для мониторинга операционной системы и функций DBACockpit.</span><span class="sxs-lookup"><span data-stu-id="51cd6-291">This extension feeds Azure monitoring statistics into the SAP application for operating system monitoring and DBA Cockpit functions.</span></span> <span data-ttu-id="51cd6-292">"Расширенный мониторинг" SAP является обязательным компонентом для запуска SAP в Azure.</span><span class="sxs-lookup"><span data-stu-id="51cd6-292">SAP enhanced monitoring is a mandatory prerequisite to run SAP on Azure.</span></span> <span data-ttu-id="51cd6-293">Ознакомьтесь с информацией в примечании [SAP 2191498](https://launchpad.support.sap.com/#/notes/2191498) "SAP on Linux with Azure: Enhanced Monitoring" (SAP на платформе Linux в Azure: расширенный мониторинг).</span><span class="sxs-lookup"><span data-stu-id="51cd6-293">For details, see [SAP Note 2191498](https://launchpad.support.sap.com/#/notes/2191498) – "SAP on Linux with Azure: Enhanced Monitoring."</span></span>

## <a name="security-considerations"></a><span data-ttu-id="51cd6-294">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="51cd6-294">Security considerations</span></span>

<span data-ttu-id="51cd6-295">SAP имеет свой собственный механизм управления пользователями для управления доступом на основе ролей и авторизации в приложении SAP.</span><span class="sxs-lookup"><span data-stu-id="51cd6-295">SAP has its own Users Management Engine (UME) to control role-based access and authorization within the SAP application.</span></span> <span data-ttu-id="51cd6-296">Дополнительные сведения см. в статье [SAP HANA Security - An Overview](https://archive.sap.com/documents/docs/DOC-62943) (Общие сведения о безопасности SAP HANA). (Для доступа необходима учетная запись SAP Service Marketplace.)</span><span class="sxs-lookup"><span data-stu-id="51cd6-296">For details, see [SAP HANA Security—An Overview](https://archive.sap.com/documents/docs/DOC-62943) (SAP Service Marketplace account required for access.)</span></span>

<span data-ttu-id="51cd6-297">Для дополнительной сетевой безопасности рассмотрите возможность внедрения [сети периметра](/azure/architecture/reference-architectures/dmz/secure-vnet-hybrid), которая использует сетевое виртуальное устройство для создания брандмауэра перед подсетями для пулов веб-диспетчера и пулов серверов переднего плана Fiori.</span><span class="sxs-lookup"><span data-stu-id="51cd6-297">For additional network security, consider implementing a [Network DMZ](/azure/architecture/reference-architectures/dmz/secure-vnet-hybrid), which uses a network virtual appliance to create a firewall in front of the subnet for Web Dispatcher and Fiori Front-End Server pools.</span></span>

<span data-ttu-id="51cd6-298">Для обеспечения безопасности инфраструктуры данные шифруются при передаче и во время хранения.</span><span class="sxs-lookup"><span data-stu-id="51cd6-298">For infrastructure security, data is encrypted in transit and at rest.</span></span> <span data-ttu-id="51cd6-299">С помощью указаний в разделе "Рекомендации по безопасности" в статье [SAP NetWeaver на виртуальных машинах Windows. Руководство по планированию и внедрению](/azure/virtual-machines/workloads/sap/planning-guide) начните реализовать защиту сети. Эта статья также применяется к S/4HANA.</span><span class="sxs-lookup"><span data-stu-id="51cd6-299">The "Security considerations" section of the [SAP NetWeaver on Azure Virtual Machines–Planning and Implementation Guide](/azure/virtual-machines/workloads/sap/planning-guide) begins to address network security and applies to S/4HANA.</span></span> <span data-ttu-id="51cd6-300">В руководстве также указаны порты сети, которые необходимо открыть на брандмауэрах, чтобы разрешить взаимодействие с приложением.</span><span class="sxs-lookup"><span data-stu-id="51cd6-300">The guide also specifies the network ports you must open on the firewalls to allow application communication.</span></span> 

<span data-ttu-id="51cd6-301">Чтобы выполнить шифрование дисков виртуальной машины Linux IaaS, можно использовать [шифрование дисков Azure](/azure/security/azure-security-disk-encryption).</span><span class="sxs-lookup"><span data-stu-id="51cd6-301">To encrypt Linux IaaS virtual machine disks, you can use [Azure Disk Encryption](/azure/security/azure-security-disk-encryption).</span></span> <span data-ttu-id="51cd6-302">Эта технология использует функции DM-Crypt в Linux, которые обеспечивают шифрование томов для дисков ОС и дисков данных.</span><span class="sxs-lookup"><span data-stu-id="51cd6-302">It uses the DM-Crypt feature of Linux to provide volume encryption for the operating system and the data disks.</span></span> <span data-ttu-id="51cd6-303">Шифрование дисков Azure также работает в Azure Key Vault, что позволяет управлять секретами и ключами шифрования дисков в подписке Key Vault и контролировать их.</span><span class="sxs-lookup"><span data-stu-id="51cd6-303">The solution also works with Azure Key Vault to help you control and manage the disk-encryption keys and secrets in your key vault subscription.</span></span> <span data-ttu-id="51cd6-304">Данные на дисках виртуальной машины шифруются в хранилище Azure, когда они неактивны.</span><span class="sxs-lookup"><span data-stu-id="51cd6-304">Data on the virtual machine disks are encrypted at rest in your Azure storage.</span></span>

<span data-ttu-id="51cd6-305">Для шифрования неактивных данных SAP HANA рекомендуется использовать собственную технологию шифрования SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="51cd6-305">For SAP HANA data-at-rest encryption, we recommend using the SAP HANA native encryption technology.</span></span> 

> [!NOTE]
> <span data-ttu-id="51cd6-306">Не применяйте шифрование неактивных данных HANA и шифрование дисков Azure на том же сервере.</span><span class="sxs-lookup"><span data-stu-id="51cd6-306">Do not use the HANA data-at-rest encryption with Azure Disk Encryption on the same server.</span></span> <span data-ttu-id="51cd6-307">Для HANA используйте только шифрование данных HANA.</span><span class="sxs-lookup"><span data-stu-id="51cd6-307">For HANA, use only HANA data encryption.</span></span>

## <a name="communities"></a><span data-ttu-id="51cd6-308">Сообщества</span><span class="sxs-lookup"><span data-stu-id="51cd6-308">Communities</span></span>

<span data-ttu-id="51cd6-309">Участники сообществ отвечают на вопросы и помогают настроить успешное развертывание.</span><span class="sxs-lookup"><span data-stu-id="51cd6-309">Communities can answer questions and help you set up a successful deployment.</span></span> <span data-ttu-id="51cd6-310">Рассмотрим следующее:</span><span class="sxs-lookup"><span data-stu-id="51cd6-310">Consider the following:</span></span>

- [<span data-ttu-id="51cd6-311">Запись блога по запуску приложений SAP на платформе Майкрософт</span><span class="sxs-lookup"><span data-stu-id="51cd6-311">Running SAP Applications on the Microsoft Platform Blog</span></span>](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)
- [<span data-ttu-id="51cd6-312">Поддержка сообщества Azure</span><span class="sxs-lookup"><span data-stu-id="51cd6-312">Azure Community Support</span></span>](https://azure.microsoft.com/support/community/)
- [<span data-ttu-id="51cd6-313">Сообщество SAP</span><span class="sxs-lookup"><span data-stu-id="51cd6-313">SAP Community</span></span>](https://www.sap.com/community.html)
- [<span data-ttu-id="51cd6-314">Stack Overflow</span><span class="sxs-lookup"><span data-stu-id="51cd6-314">Stack Overflow</span></span>](https://stackoverflow.com/tags/sap/)

[visio-download]: https://archcenter.blob.core.windows.net/cdn/sap-reference-architectures.vsdx
