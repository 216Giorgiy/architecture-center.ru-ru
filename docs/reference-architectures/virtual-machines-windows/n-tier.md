---
title: "Запуск виртуальных машин Windows в n-уровневой архитектуре"
description: "Эта статья содержит способы реализации многоуровневой архитектуры в Azure и уделяет особое внимание доступности, безопасности, масштабируемости и безопасности управляемости."
author: MikeWasson
ms.date: 11/22/2016
pnp.series.title: Windows VM workloads
pnp.series.next: multi-region-application
pnp.series.prev: multi-vm
ms.openlocfilehash: f3c375f8fccc633d9525a8afbd11c13037265f4a
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
# <a name="run-windows-vms-for-an-n-tier-application"></a><span data-ttu-id="4ddc7-103">Запуск виртуальных машин Windows для n-уровневого приложения</span><span class="sxs-lookup"><span data-stu-id="4ddc7-103">Run Windows VMs for an N-tier application</span></span>

<span data-ttu-id="4ddc7-104">В этой эталонной архитектуре показан набор методик по запуску виртуальных машин Windows для n-уровневого приложения.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-104">This reference architecture shows a set of proven practices for running Windows virtual machines (VMs) for an N-tier application.</span></span> [<span data-ttu-id="4ddc7-105">**Разверните это решение**.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-105">**Deploy this solution**.</span></span>](#deploy-the-solution) 

<span data-ttu-id="4ddc7-106">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="4ddc7-106">![[0]][0]</span></span>

<span data-ttu-id="4ddc7-107">*Скачайте [файл Visio][visio-download] этой архитектуры.*</span><span class="sxs-lookup"><span data-stu-id="4ddc7-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="4ddc7-108">Архитектура</span><span class="sxs-lookup"><span data-stu-id="4ddc7-108">Architecture</span></span> 

<span data-ttu-id="4ddc7-109">Существует много способов реализовать n-уровневую архитектуру.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-109">There are many ways to implement an N-tier architecture.</span></span> <span data-ttu-id="4ddc7-110">На диаграмме показано стандартное трехуровневое веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-110">The diagram shows a typical 3-tier web application.</span></span> <span data-ttu-id="4ddc7-111">Эта архитектура создана на основе архитектуры из статьи [Запуск виртуальных машин с балансировкой нагрузки для обеспечения масштабируемости и доступности][multi-vm].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-111">This architecture builds on [Run load-balanced VMs for scalability and availability][multi-vm].</span></span> <span data-ttu-id="4ddc7-112">На веб- и бизнес-уровнях используются виртуальные машины с балансировкой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-112">The web and business tiers use load-balanced VMs.</span></span>

* <span data-ttu-id="4ddc7-113">**Группы доступности.**</span><span class="sxs-lookup"><span data-stu-id="4ddc7-113">**Availability sets.**</span></span> <span data-ttu-id="4ddc7-114">Создайте [группу доступности][azure-availability-sets] для каждого уровня и подготовьте по крайней мере две виртуальные машины для каждого уровня.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-114">Create an [availability set][azure-availability-sets] for each tier, and provision at least two VMs in each tier.</span></span> <span data-ttu-id="4ddc7-115">Таким образом виртуальные машины станут подходящими для [соглашения об уровне обслуживания (SLA)][vm-sla] более высокого уровня для виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-115">This makes the VMs eligible for a higher [service level agreement (SLA)][vm-sla] for VMs.</span></span>
* <span data-ttu-id="4ddc7-116">**Подсети.**</span><span class="sxs-lookup"><span data-stu-id="4ddc7-116">**Subnets.**</span></span> <span data-ttu-id="4ddc7-117">Создайте отдельные подсети для каждого уровня.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-117">Create a separate subnet for each tier.</span></span> <span data-ttu-id="4ddc7-118">Укажите диапазон адресов и маску подсети с помощью нотации [CIDR].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-118">Specify the address range and subnet mask using [CIDR] notation.</span></span> 
* <span data-ttu-id="4ddc7-119">**Подсистемы балансировки нагрузки.**</span><span class="sxs-lookup"><span data-stu-id="4ddc7-119">**Load balancers.**</span></span> <span data-ttu-id="4ddc7-120">[Подсистема балансировки нагрузки с доступом к Интернету][load-balancer-external] передает входящий интернет-трафик на веб-уровень, а [внутренняя подсистема балансировки нагрузки][load-balancer-internal] передает сетевой трафик из веб-уровня на бизнес-уровень.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-120">Use an [Internet-facing load balancer][load-balancer-external] to distribute incoming Internet traffic to the web tier, and an [internal load balancer][load-balancer-internal] to distribute network traffic from the web tier to the business tier.</span></span>
* <span data-ttu-id="4ddc7-121">**Jumpbox.**</span><span class="sxs-lookup"><span data-stu-id="4ddc7-121">**Jumpbox.**</span></span> <span data-ttu-id="4ddc7-122">Он также называется [узлом-бастионом].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-122">Also called a [bastion host].</span></span> <span data-ttu-id="4ddc7-123">Безопасная виртуальная машина в сети, которую администраторы используют для подключения к другим виртуальным машинам.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-123">A secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="4ddc7-124">В jumpbox есть NSG, обеспечивающая удаленный трафик только из общедоступных IP-адресов из списка надежных отправителей.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-124">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="4ddc7-125">NSG должна пропускать трафик с удаленного рабочего стола (RDP).</span><span class="sxs-lookup"><span data-stu-id="4ddc7-125">The NSG should permit remote desktop (RDP) traffic.</span></span>
* <span data-ttu-id="4ddc7-126">**Мониторинг.**</span><span class="sxs-lookup"><span data-stu-id="4ddc7-126">**Monitoring.**</span></span> <span data-ttu-id="4ddc7-127">Программное обеспечение для мониторинга, например [Nagios], [Zabbix] или [Icinga], позволяет получить глубокое представление о времени отклика, времени доступности виртуальной машины и общей работоспособности вашей системы.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-127">Monitoring software such as [Nagios], [Zabbix], or [Icinga] can give you insight into response time, VM uptime, and the overall health of your system.</span></span> <span data-ttu-id="4ddc7-128">Установите программное обеспечение для мониторинга на виртуальной машине, которая размещена в отдельной подсети управления.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-128">Install the monitoring software on a VM that's placed in a separate management subnet.</span></span>
* <span data-ttu-id="4ddc7-129">**Группы безопасности сети.**</span><span class="sxs-lookup"><span data-stu-id="4ddc7-129">**NSGs.**</span></span> <span data-ttu-id="4ddc7-130">[Группы безопасности сети][nsg] (NSG) позволяют ограничить сетевой трафик в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-130">Use [network security groups][nsg] (NSGs) to restrict network traffic within the VNet.</span></span> <span data-ttu-id="4ddc7-131">Например, в приведенной здесь трехуровневой архитектуре уровень базы данных не принимает трафик из веб-интерфейса, а только с бизнес-уровня и подсети управления.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-131">For example, in the 3-tier architecture shown here, the database tier does not accept traffic from the web front end, only from the business tier and the management subnet.</span></span>
* <span data-ttu-id="4ddc7-132">**Группа доступности AlwaysOn SQL Server.**</span><span class="sxs-lookup"><span data-stu-id="4ddc7-132">**SQL Server Always On Availability Group.**</span></span> <span data-ttu-id="4ddc7-133">Обеспечивает высокий уровень доступности на уровне данных, включив репликацию и отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-133">Provides high availability at the data tier, by enabling replication and failover.</span></span>
* <span data-ttu-id="4ddc7-134">**Серверы доменных служб Active Directory (AD DS).**</span><span class="sxs-lookup"><span data-stu-id="4ddc7-134">**Active Directory Domain Services (AD DS) Servers**.</span></span> <span data-ttu-id="4ddc7-135">До Windows Server 2016 группы доступности Always On SQL Server требовалось присоединять к домену.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-135">Prior to Windows Server 2016, SQL Server Always On Availability Groups must be joined to a domain.</span></span> <span data-ttu-id="4ddc7-136">Это связано с тем, что группы доступности зависят от технологии отказоустойчивого кластера Windows Server.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-136">This is because Availability Groups depend on Windows Server Failover Cluster (WSFC) technology.</span></span> <span data-ttu-id="4ddc7-137">Windows Server 2016 предоставляет возможность создать отказоустойчивый кластер без Active Directory. В этом случае серверы доменных служб Active Directory не нужны для этой архитектуры.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-137">Windows Server 2016 introduces the ability to create a Failover Cluster without Active Directory, in which case the AD DS servers are not required for this architecture.</span></span> <span data-ttu-id="4ddc7-138">Дополнительные сведения см. в разделе [What's new in Failover Clustering in Windows Server 2016][wsfc-whats-new] (Новые возможности отказоустойчивой кластеризации в Windows Server 2016).</span><span class="sxs-lookup"><span data-stu-id="4ddc7-138">For more information, see [What's new in Failover Clustering in Windows Server 2016][wsfc-whats-new].</span></span>

## <a name="recommendations"></a><span data-ttu-id="4ddc7-139">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="4ddc7-139">Recommendations</span></span>

<span data-ttu-id="4ddc7-140">Требования могут отличаться от архитектуры, описанной здесь.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-140">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="4ddc7-141">Воспользуйтесь этими рекомендациями в качестве отправной точки.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-141">Use these recommendations as a starting point.</span></span> 

### <a name="vnet--subnets"></a><span data-ttu-id="4ddc7-142">Виртуальная сеть и подсети</span><span class="sxs-lookup"><span data-stu-id="4ddc7-142">VNet / Subnets</span></span>

<span data-ttu-id="4ddc7-143">При создании виртуальной сети определите, сколько IP-адресов требуется для ресурсов в каждой подсети.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-143">When you create the VNet, determine how many IP addresses your resources in each subnet require.</span></span> <span data-ttu-id="4ddc7-144">Укажите маску подсети и достаточно большой диапазон адресов виртуальной сети для требуемых IP-адресов с помощью нотации [CIDR].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-144">Specify a subnet mask and a VNet address range large enough for the required IP addresses, using [CIDR] notation.</span></span> <span data-ttu-id="4ddc7-145">Используйте адресное пространство, которое входит в диапазон стандартных [блоков частных IP-адресов][private-ip-space], например 10.0.0.0/8, 172.16.0.0/12 и 192.168.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-145">Use an address space that falls within the standard [private IP address blocks][private-ip-space], which are 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16.</span></span>

<span data-ttu-id="4ddc7-146">Выберите диапазон адресов, который не перекрывает локальную сеть, если вам нужно позже настроить шлюз между виртуальной сетью и локальной сетью.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-146">Choose an address range that does not overlap with your on-premises network, in case you need to set up a gateway between the VNet and your on-premise network later.</span></span> <span data-ttu-id="4ddc7-147">Создав виртуальную сеть, изменить диапазон адресов нельзя.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-147">Once you create the VNet, you can't change the address range.</span></span>

<span data-ttu-id="4ddc7-148">Проектируйте подсети с учетом требований к функциональности и безопасности.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-148">Design subnets with functionality and security requirements in mind.</span></span> <span data-ttu-id="4ddc7-149">Все виртуальные машины в пределах одного уровня или одной роли должны входить в одну и ту же подсеть, которая может быть надежным периметром безопасности.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-149">All VMs within the same tier or role should go into the same subnet, which can be a security boundary.</span></span> <span data-ttu-id="4ddc7-150">Дополнительные сведения о проектировании виртуальных сетей и подсетей см. в статье [Планирование и проектирование виртуальных сетей Azure][plan-network].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-150">For more information about designing VNets and subnets, see [Plan and design Azure Virtual Networks][plan-network].</span></span>

<span data-ttu-id="4ddc7-151">Для каждой подсети укажите адресное пространство подсети в нотации CIDR.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-151">For each subnet, specify the address space for the subnet in CIDR notation.</span></span> <span data-ttu-id="4ddc7-152">Например, 10.0.0.0/24 создает диапазон из 256 IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-152">For example, '10.0.0.0/24' creates a range of 256 IP addresses.</span></span> <span data-ttu-id="4ddc7-153">Виртуальные машины могут использовать 251 из них (пять зарезервированы).</span><span class="sxs-lookup"><span data-stu-id="4ddc7-153">VMs can use 251 of these; five are reserved.</span></span> <span data-ttu-id="4ddc7-154">Убедитесь, что диапазоны адресов не перекрываются между подсетями.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-154">Make sure the address ranges don't overlap across subnets.</span></span> <span data-ttu-id="4ddc7-155">Ознакомьтесь со статьей [Виртуальная сеть Azure: часто задаваемые вопросы][vnet faq].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-155">See the [Virtual Network FAQ][vnet faq].</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="4ddc7-156">Группы безопасности сети</span><span class="sxs-lookup"><span data-stu-id="4ddc7-156">Network security groups</span></span>

<span data-ttu-id="4ddc7-157">С помощью правил NSG можно ограничить трафик между уровнями.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-157">Use NSG rules to restrict traffic between tiers.</span></span> <span data-ttu-id="4ddc7-158">Например, в показанной выше трехуровневой архитектуре веб-уровень не взаимодействует напрямую с уровнем базы данных.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-158">For example, in the 3-tier architecture shown above, the web tier does not communicate directly with the database tier.</span></span> <span data-ttu-id="4ddc7-159">Чтобы обеспечить эту возможность, уровень базы данных должен блокировать входящий трафик из подсети веб-уровня.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-159">To enforce this, the database tier should block incoming traffic from the web tier subnet.</span></span>  

1. <span data-ttu-id="4ddc7-160">Создайте NSG и свяжите ее с подсетью уровня базы данных.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-160">Create an NSG and associate it to the database tier subnet.</span></span>
2. <span data-ttu-id="4ddc7-161">Добавьте правило, которое запрещает весь входящий трафик от виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-161">Add a rule that denies all inbound traffic from the VNet.</span></span> <span data-ttu-id="4ddc7-162">(В правиле используйте тег `VIRTUAL_NETWORK`.)</span><span class="sxs-lookup"><span data-stu-id="4ddc7-162">(Use the `VIRTUAL_NETWORK` tag in the rule.)</span></span> 
3. <span data-ttu-id="4ddc7-163">Добавьте правило с более высоким приоритетом, которое разрешает входящий трафик из подсети бизнес-уровня.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-163">Add a rule with a higher priority that allows inbound traffic from the business tier subnet.</span></span> <span data-ttu-id="4ddc7-164">Это правило переопределяет предыдущее и позволяет бизнес-уровню взаимодействовать с уровнем базы данных.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-164">This rule overrides the previous rule, and allows the business tier to talk to the database tier.</span></span>
4. <span data-ttu-id="4ddc7-165">Добавьте правило, которое разрешает входящий трафик из самой подсети уровня базы данных.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-165">Add a rule that allows inbound traffic from within the database tier subnet itself.</span></span> <span data-ttu-id="4ddc7-166">Это правило обеспечивает взаимодействие между виртуальными машинами на уровне базы данных, которое необходимо для репликации и отработки отказа базы данных.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-166">This rule allows communication between VMs in the database tier, which is needed for database replication and failover.</span></span>
5. <span data-ttu-id="4ddc7-167">Добавьте правило, которое разрешает трафик RDP из подсети jumpbox.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-167">Add a rule that allows RDP traffic from the jumpbox subnet.</span></span> <span data-ttu-id="4ddc7-168">Это правило позволяет администраторам подключаться к уровню базы данных из jumpbox.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-168">This rule lets administrators connect to the database tier from the jumpbox.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="4ddc7-169">NSG имеет стандартные правила, которые разрешают любой входящий трафик из виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-169">An NSG has default rules that allow any inbound traffic from within the VNet.</span></span> <span data-ttu-id="4ddc7-170">Эти правила нельзя удалить, однако их можно переопределить, создав правила с более высоким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-170">These rules can't be deleted, but you can override them by creating higher priority rules.</span></span>
   > 
   > 

### <a name="load-balancers"></a><span data-ttu-id="4ddc7-171">Балансировщики нагрузки</span><span class="sxs-lookup"><span data-stu-id="4ddc7-171">Load balancers</span></span>

<span data-ttu-id="4ddc7-172">Внешняя подсистема балансировки нагрузки передает трафик Интернета на веб-уровень.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-172">The external load balancer distributes Internet traffic to the web tier.</span></span> <span data-ttu-id="4ddc7-173">Создайте общедоступный IP-адрес для этой подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-173">Create a public IP address for this load balancer.</span></span> <span data-ttu-id="4ddc7-174">Ознакомьтесь со статьей [Создание балансировщика нагрузки для Интернета на портале Azure][lb-external-create].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-174">See [Creating an Internet-facing load balancer][lb-external-create].</span></span>

<span data-ttu-id="4ddc7-175">Внутренняя подсистема балансировки нагрузки передает сетевой трафик с веб-уровня на бизнес-уровень.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-175">The internal load balancer distributes network traffic from the web tier to the business tier.</span></span> <span data-ttu-id="4ddc7-176">Чтобы предоставить этой системе балансировки нагрузки частный IP-адрес, создайте внешнюю IP-конфигурацию и свяжите ее с подсетью для бизнес-уровня.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-176">To give this load balancer a private IP address, create a frontend IP configuration and associate it with the subnet for the business tier.</span></span> <span data-ttu-id="4ddc7-177">Ознакомьтесь со статьей [Создание подсистемы балансировки нагрузки на портале Azure][lb-internal-create].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-177">See [Get started creating an Internal load balancer][lb-internal-create].</span></span>

### <a name="sql-server-always-on-availability-groups"></a><span data-ttu-id="4ddc7-178">Группы доступности AlwaysOn SQL Server</span><span class="sxs-lookup"><span data-stu-id="4ddc7-178">SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="4ddc7-179">Мы рекомендуем использовать [группы доступности AlwaysOn][sql-alwayson] для обеспечения высокого уровня доступности SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-179">We recommend [Always On Availability Groups][sql-alwayson] for SQL Server high availability.</span></span> <span data-ttu-id="4ddc7-180">До Windows Server 2016 для групп доступности Always On требовался контроллер домена, а все узлы в группе доступности должны были находиться в одном домене AD.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-180">Prior to Windows Server 2016, Always On Availability Groups require a domain controller, and all nodes in the availability group must be in the same AD domain.</span></span>

<span data-ttu-id="4ddc7-181">Другие уровни подключаются к базе данных с помощью [прослушивателя групп доступности][sql-alwayson-listeners].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-181">Other tiers connect to the database through an [availability group listener][sql-alwayson-listeners].</span></span> <span data-ttu-id="4ddc7-182">Прослушиватель позволяет клиенту SQL подключаться, не зная имени физического экземпляра SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-182">The listener enables a SQL client to connect without knowing the name of the physical instance of SQL Server.</span></span> <span data-ttu-id="4ddc7-183">Виртуальные машины, которые обращаются к базе данных, должны быть присоединены к домену.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-183">VMs that access the database must be joined to the domain.</span></span> <span data-ttu-id="4ddc7-184">Клиент (в этом случае другой уровень) использует DNS для разрешения имени виртуальной сети прослушивателя в IP-адресах.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-184">The client (in this case, another tier) uses DNS to resolve the listener's virtual network name into IP addresses.</span></span>

<span data-ttu-id="4ddc7-185">Настройте группы доступности AlwaysOn SQL Server следующим образом:</span><span class="sxs-lookup"><span data-stu-id="4ddc7-185">Configure the SQL Server Always On Availability Group as follows:</span></span>

1. <span data-ttu-id="4ddc7-186">Создайте кластер отказоустойчивой кластеризации Windows Server, группу доступности AlwaysOn SQL Server и первичную реплику.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-186">Create a Windows Server Failover Clustering (WSFC) cluster, a SQL Server Always On Availability Group, and a primary replica.</span></span> <span data-ttu-id="4ddc7-187">Дополнительные сведения см. в статье [Начало работы с группами доступности AlwaysOn (SQL Server)][sql-alwayson-getting-started].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-187">For more information, see [Getting Started with Always On Availability Groups][sql-alwayson-getting-started].</span></span> 
2. <span data-ttu-id="4ddc7-188">Создайте внутреннюю подсистему балансировки нагрузки со статическим частным IP-адресом.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-188">Create an internal load balancer with a static private IP address.</span></span>
3. <span data-ttu-id="4ddc7-189">Создайте прослушиватель группы доступности и сопоставьте его DNS-имя с IP-адресом внутренней подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-189">Create an availability group listener, and map the listener's DNS name to the IP address of an internal load balancer.</span></span> 
4. <span data-ttu-id="4ddc7-190">Создайте правило подсистемы балансировки нагрузки для порта прослушивания SQL Server (по умолчанию используется TCP-порт 1433).</span><span class="sxs-lookup"><span data-stu-id="4ddc7-190">Create a load balancer rule for the SQL Server listening port (TCP port 1433 by default).</span></span> <span data-ttu-id="4ddc7-191">Правило подсистемы балансировки нагрузки должно включать *плавающий IP-адрес*, также называемый прямым ответом от сервера.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-191">The load balancer rule must enable *floating IP*, also called Direct Server Return.</span></span> <span data-ttu-id="4ddc7-192">В результате виртуальная машина будет отправлять ответ клиенту напрямую, что позволяет использовать прямое соединение с первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-192">This causes the VM to reply directly to the client, which enables a direct connection to the primary replica.</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="4ddc7-193">Если плавающий IP-адрес включен, номер внешнего порта должен совпадать с номером внутреннего порта в правиле подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-193">When floating IP is enabled, the front-end port number must be the same as the back-end port number in the load balancer rule.</span></span>
  > 
  > 

<span data-ttu-id="4ddc7-194">Если клиент SQL пытается выполнить подключение, подсистема балансировки нагрузки направляет запрос на подключение в первичную реплику.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-194">When a SQL client tries to connect, the load balancer routes the connection request to the primary replica.</span></span> <span data-ttu-id="4ddc7-195">Если происходит отработка отказа с переходом на другую реплику, подсистема балансировки нагрузки автоматически направляет последующие запросы в новую первичную реплику.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-195">If there is a failover to another replica, the load balancer automatically routes subsequent requests to a new primary replica.</span></span> <span data-ttu-id="4ddc7-196">Дополнительные сведения см. в статье [Настройка подсистемы балансировки нагрузки для группы доступности AlwaysOn в Azure][sql-alwayson-ilb].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-196">For more information, see [Configure an ILB listener for SQL Server Always On Availability Groups][sql-alwayson-ilb].</span></span>

<span data-ttu-id="4ddc7-197">Во время отработки отказа имеющиеся клиентские подключения закрыты.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-197">During a failover, existing client connections are closed.</span></span> <span data-ttu-id="4ddc7-198">После отработки отказа новые соединения направляются в новую первичную реплику.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-198">After the failover completes, new connections will be routed to the new primary replica.</span></span>

<span data-ttu-id="4ddc7-199">Если приложение выполняет значительно больше операций чтения, чем записи, вы можете разгрузить некоторые запросы только для чтения во вторичную реплику.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-199">If your application makes significantly more reads than writes, you can offload some of the read-only queries to a secondary replica.</span></span> <span data-ttu-id="4ddc7-200">Ознакомьтесь с разделом [Соединение с помощью прослушивателя со вторичной репликой только для чтения (маршрутизация только для чтения)][sql-alwayson-read-only-routing].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-200">See [Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)][sql-alwayson-read-only-routing].</span></span>

<span data-ttu-id="4ddc7-201">Протестируйте развертывание, [принудительно выполнив отработку отказа][sql-alwayson-force-failover] группы доступности вручную.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-201">Test your deployment by [forcing a manual failover][sql-alwayson-force-failover] of the availability group.</span></span>

### <a name="jumpbox"></a><span data-ttu-id="4ddc7-202">Jumpbox</span><span class="sxs-lookup"><span data-stu-id="4ddc7-202">Jumpbox</span></span>

<span data-ttu-id="4ddc7-203">jumpbox будет иметь минимальные требования к производительности, поэтому выберите небольшой размер виртуальной машины для jumpbox, например Standard A1.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-203">The jumpbox will have minimal performance requirements, so select a small VM size for the jumpbox such as Standard A1.</span></span> 

<span data-ttu-id="4ddc7-204">Создайте [общедоступный IP-адрес] для jumpbox.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-204">Create a [public IP address] for the jumpbox.</span></span> <span data-ttu-id="4ddc7-205">Поместите jumpbox в виртуальную сеть вместе с другими виртуальными машинами, однако в отдельную подсеть управления.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-205">Place the jumpbox in the same VNet as the other VMs, but in a separate management subnet.</span></span>

<span data-ttu-id="4ddc7-206">Запретите доступ по протоколу RDP из общедоступного Интернета к виртуальным машинам, которые выполняют рабочую нагрузку приложения.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-206">Do not allow RDP access from the public Internet to the VMs that run the application workload.</span></span> <span data-ttu-id="4ddc7-207">Вместо этого все доступы по протоколу RDP к этим виртуальным машинам должны проходить через jumpbox.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-207">Instead, all RDP access to these VMs must come through the jumpbox.</span></span> <span data-ttu-id="4ddc7-208">Администратор выполняет вход в jumpbox, а затем вход в другую виртуальную машину из jumpbox.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-208">An administrator logs into the jumpbox, and then logs into the other VM from the jumpbox.</span></span> <span data-ttu-id="4ddc7-209">jumpbox разрешает RDP трафик из Интернета, однако только из известных и безопасных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-209">The jumpbox allows RDP traffic from the Internet, but only from known, safe IP addresses.</span></span>

<span data-ttu-id="4ddc7-210">Чтобы защитить jumpbox, создайте NSG и примените ее к подсети jumpbox.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-210">To secure the jumpbox, create an NSG and apply it to the jumpbox subnet.</span></span> <span data-ttu-id="4ddc7-211">Добавьте правило NSG, разрешающее подключения по протоколу RDP только из безопасного набора общедоступных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-211">Add an NSG rule that allows RDP connections only from a safe set of public IP addresses.</span></span> <span data-ttu-id="4ddc7-212">NSG можно подключить к подсети или сетевому адаптеру jumpbox.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-212">The NSG can be attached either to the subnet or to the jumpbox NIC.</span></span> <span data-ttu-id="4ddc7-213">В этом случае рекомендуется подключить ее к сетевому адаптеру, чтобы трафик RDP разрешался только для jumpbox, даже если вы добавили другие виртуальные машины в ту же подсеть.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-213">In this case, we recommend attaching it to the NIC, so RDP traffic is permitted only to the jumpbox, even if you add other VMs to the same subnet.</span></span>

<span data-ttu-id="4ddc7-214">Настройте NSG для других подсетей, чтобы разрешить трафик RDP из подсети управления.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-214">Configure the NSGs for the other subnets to allow RDP traffic from the management subnet.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="4ddc7-215">Вопросы доступности</span><span class="sxs-lookup"><span data-stu-id="4ddc7-215">Availability considerations</span></span>

<span data-ttu-id="4ddc7-216">Использование нескольких виртуальных машин на уровне базы данных не приводит автоматически к высокой доступности базы данных.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-216">At the database tier, having multiple VMs does not automatically translate into a highly available database.</span></span> <span data-ttu-id="4ddc7-217">Для реляционной базы данных обычно требуется выполнить репликацию и отработку отказа, чтобы обеспечить высокий уровень доступности.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-217">For a relational database, you will typically need to use replication and failover to achieve high availability.</span></span> <span data-ttu-id="4ddc7-218">Для SQL Server мы рекомендуем использовать [группы доступности AlwaysOn][sql-alwayson].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-218">For SQL Server, we recommend using [Always On Availability Groups][sql-alwayson].</span></span> 

<span data-ttu-id="4ddc7-219">Если требуется более высокий уровень доступности, чем обеспечивает [соглашение об уровне обслуживания Azure для виртуальных машин][vm-sla], реплицируйте приложение в два региона и используйте диспетчер трафика Azure для отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-219">If you need higher availability than the [Azure SLA for VMs][vm-sla] provides, replicate the application across two regions and use Azure Traffic Manager for failover.</span></span> <span data-ttu-id="4ddc7-220">Дополнительные сведения см. в статье [Запуск виртуальных машин Windows в нескольких регионах для обеспечения высокой доступности][multi-dc].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-220">For more information, see [Run Windows VMs in multiple regions for high availability][multi-dc].</span></span>   

## <a name="security-considerations"></a><span data-ttu-id="4ddc7-221">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="4ddc7-221">Security considerations</span></span>

<span data-ttu-id="4ddc7-222">Выполните шифрование конфиденциальных неактивных данных и используйте [Azure Key Vault][azure-key-vault] для управления ключами шифрования базы данных.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-222">Encrypt sensitive data at rest and use [Azure Key Vault][azure-key-vault] to manage the database encryption keys.</span></span> <span data-ttu-id="4ddc7-223">Key Vault может хранить ключи шифрования в аппаратных модулях безопасности.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-223">Key Vault can store encryption keys in hardware security modules (HSMs).</span></span> <span data-ttu-id="4ddc7-224">Дополнительные сведения см. в статье [Настройка интеграции Azure Key Vault для SQL Server на виртуальных машинах Azure (Resource Manager)][sql-keyvault]. Рекомендуется также хранить секреты приложения, например строки подключения к базе данных, в Key Vault.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-224">For more information, see [Configure Azure Key Vault Integration for SQL Server on Azure VMs][sql-keyvault] It's also recommended to store application secrets, such as database connection strings, in Key Vault.</span></span>

<span data-ttu-id="4ddc7-225">Попробуйте добавить сетевой виртуальный модуль (NVA), чтобы создать сеть периметра между Интернетом и виртуальною сетью Azure.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-225">Consider adding a network virtual appliance (NVA) to create a DMZ between the Internet and the Azure virtual network.</span></span> <span data-ttu-id="4ddc7-226">Сетевой виртуальный модуль — это универсальный термин для виртуального модуля, который может выполнять сетевые задачи, например брандмауэра, проверки пакетов, аудита и пользовательской маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-226">NVA is a generic term for a virtual appliance that can perform network-related tasks, such as firewall, packet inspection, auditing, and custom routing.</span></span> <span data-ttu-id="4ddc7-227">Дополнительные сведения см. в статье [Сеть периметра между Azure и Интернетом][dmz].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-227">For more information, see [Implementing a DMZ between Azure and the Internet][dmz].</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="4ddc7-228">Вопросы масштабируемости</span><span class="sxs-lookup"><span data-stu-id="4ddc7-228">Scalability considerations</span></span>

<span data-ttu-id="4ddc7-229">Подсистемы балансировки нагрузки передают сетевой трафик на веб- и бизнес-уровни.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-229">The load balancers distribute network traffic to the web and business tiers.</span></span> <span data-ttu-id="4ddc7-230">Выполните горизонтальное масштабирование, добавив новые экземпляры виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-230">Scale horizontally by adding new VM instances.</span></span> <span data-ttu-id="4ddc7-231">Обратите внимание, что можно масштабировать веб- и бизнес-уровни независимо друг от друга в зависимости от нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-231">Note that you can scale the web and business tiers independently, based on load.</span></span> <span data-ttu-id="4ddc7-232">Чтобы снизить уровень усложнений, которые могут возникать из-за необходимости использовать привязку клиента, виртуальные машины на веб-уровне должны быть без отслеживания состояния.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-232">To reduce possible complications caused by the need to maintain client affinity, the VMs in the web tier should be stateless.</span></span> <span data-ttu-id="4ddc7-233">Виртуальные машины, на которых размещена бизнес-логика, также должны быть без отслеживания состояния.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-233">The VMs hosting the business logic should also be stateless.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="4ddc7-234">Вопросы управляемости</span><span class="sxs-lookup"><span data-stu-id="4ddc7-234">Manageability considerations</span></span>

<span data-ttu-id="4ddc7-235">Упростите управление всей системой, используя централизованные инструменты администрирования, например [службу автоматизации Azure][azure-administration], [Microsoft Operations Management Suite][operations-management-suite], [Chef][chef] или [Puppet][puppet].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-235">Simplify management of the entire system by using centralized administration tools such as [Azure Automation][azure-administration], [Microsoft Operations Management Suite][operations-management-suite], [Chef][chef], or [Puppet][puppet].</span></span> <span data-ttu-id="4ddc7-236">Эти инструменты могут консолидировать сведения о диагностике и работоспособности, собранные из нескольких виртуальных машин, чтобы обеспечить полное представление системы.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-236">These tools can consolidate diagnostic and health information captured from multiple VMs to provide an overall view of the system.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="4ddc7-237">Развертывание решения</span><span class="sxs-lookup"><span data-stu-id="4ddc7-237">Deploy the solution</span></span>

<span data-ttu-id="4ddc7-238">Пример развертывания для этой архитектуры можно найти на портале [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="4ddc7-238">A deployment for this architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="4ddc7-239">Архитектура развертывается в три этапа.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-239">The architecture is deployed in three stages.</span></span> <span data-ttu-id="4ddc7-240">Чтобы развернуть эту архитектуру, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-240">To deploy the architecture, follow these steps:</span></span> 

1. <span data-ttu-id="4ddc7-241">Нажмите кнопку ниже, чтобы приступить к первому этапу развертывания:</span><span class="sxs-lookup"><span data-stu-id="4ddc7-241">Click the button below to begin the first stage of deployment:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fvirtual-machines%2Fn-tier-windows%2FvirtualNetwork.azuredeploy.json" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>
2. <span data-ttu-id="4ddc7-242">Ссылка откроется на портале Azure, где нужно задать следующие значения.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-242">Once the link has opened in the Azure portal, enter the follow values:</span></span> 
   * <span data-ttu-id="4ddc7-243">Имя **группы ресурсов** уже определено в файле параметров, поэтому выберите **Создать** и введите `ra-ntier-sql-network-rg` в текстовом поле.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-243">The **Resource group** name is already defined in the parameter file, so select **Create New** and enter `ra-ntier-sql-network-rg` in the text box.</span></span>
   * <span data-ttu-id="4ddc7-244">В раскрывающемся списке **Расположение** выберите регион.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-244">Select the region from the **Location** drop down box.</span></span>
   * <span data-ttu-id="4ddc7-245">Не изменяйте поля **Template Root Uri** (Корневой URI шаблона) или **Parameter Root Uri** (Корневой URI параметра).</span><span class="sxs-lookup"><span data-stu-id="4ddc7-245">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   * <span data-ttu-id="4ddc7-246">Прочтите условия использования и установите флажок **Я принимаю указанные выше условия**.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-246">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   * <span data-ttu-id="4ddc7-247">Нажмите кнопку **Приобрести**.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-247">Click on the **Purchase** button.</span></span>
3. <span data-ttu-id="4ddc7-248">Проверьте уведомления с портала Azure на наличие сообщения о том, что первый этап развертывания завершен.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-248">Check Azure portal notification for a message that the first stage of the deployment is complete.</span></span>
4. <span data-ttu-id="4ddc7-249">Нажмите кнопку ниже, чтобы приступить ко второму этапу развертывания:</span><span class="sxs-lookup"><span data-stu-id="4ddc7-249">Click the button below to begin the second stage of the deployment:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fvirtual-machines%2Fn-tier-windows%2Fworkload.azuredeploy.json" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>
5. <span data-ttu-id="4ddc7-250">Ссылка откроется на портале Azure, где нужно задать следующие значения.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-250">Once the link has opened in the Azure portal, enter the follow values:</span></span> 
   * <span data-ttu-id="4ddc7-251">Имя **группы ресурсов** уже определено в файле параметров, поэтому выберите **Создать** и введите `ra-ntier-sql-workload-rg` в текстовом поле.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-251">The **Resource group** name is already defined in the parameter file, so select **Create New** and enter `ra-ntier-sql-workload-rg` in the text box.</span></span>
   * <span data-ttu-id="4ddc7-252">В раскрывающемся списке **Расположение** выберите регион.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-252">Select the region from the **Location** drop down box.</span></span>
   * <span data-ttu-id="4ddc7-253">Не изменяйте поля **Template Root Uri** (Корневой URI шаблона) или **Parameter Root Uri** (Корневой URI параметра).</span><span class="sxs-lookup"><span data-stu-id="4ddc7-253">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   * <span data-ttu-id="4ddc7-254">Прочтите условия использования и установите флажок **Я принимаю указанные выше условия**.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-254">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   * <span data-ttu-id="4ddc7-255">Нажмите кнопку **Приобрести**.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-255">Click on the **Purchase** button.</span></span>
6. <span data-ttu-id="4ddc7-256">Проверьте уведомления с портала Azure на наличие сообщения, что второй этап развертывания завершен.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-256">Check Azure portal notification for a message that the second stage of deployment is complete.</span></span>
7. <span data-ttu-id="4ddc7-257">Нажмите кнопку ниже, чтобы приступить к третьему этапу развертывания.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-257">Click the button below to begin the third stage of the deployment:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fvirtual-machines%2Fn-tier-windows%2Fsecurity.azuredeploy.json" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>
8. <span data-ttu-id="4ddc7-258">Ссылка откроется на портале Azure, где нужно задать следующие значения.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-258">Once the link has opened in the Azure portal, enter the follow values:</span></span> 
   * <span data-ttu-id="4ddc7-259">Имя **группы ресурсов** уже определено в файле параметров, поэтому выберите **Использовать имеющийся** и введите `ra-ntier-sql-network-rg` в текстовом поле.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-259">The **Resource group** name is already defined in the parameter file, so select **Use Existing** and enter `ra-ntier-sql-network-rg` in the text box.</span></span>
   * <span data-ttu-id="4ddc7-260">В раскрывающемся списке **Расположение** выберите регион.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-260">Select the region from the **Location** drop down box.</span></span>
   * <span data-ttu-id="4ddc7-261">Не изменяйте поля **Template Root Uri** (Корневой URI шаблона) или **Parameter Root Uri** (Корневой URI параметра).</span><span class="sxs-lookup"><span data-stu-id="4ddc7-261">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   * <span data-ttu-id="4ddc7-262">Прочтите условия использования и установите флажок **Я принимаю указанные выше условия**.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-262">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   * <span data-ttu-id="4ddc7-263">Нажмите кнопку **Приобрести**.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-263">Click on the **Purchase** button.</span></span>
9. <span data-ttu-id="4ddc7-264">Проверьте уведомления с портала Azure на наличие сообщения о том, что третий этап развертывания завершен.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-264">Check Azure portal notification for a message that the third stage of the deployment is complete.</span></span>
10. <span data-ttu-id="4ddc7-265">В файлах параметров содержится жестко заданное имя пользователя с ролью администратора и пароль. Мы настоятельно рекомендуем немедленно изменить эти параметры на всех виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-265">The parameter files include a hard-coded administrator user names and passwords, and it is strongly recommended that you immediately change both on all the VMs.</span></span> <span data-ttu-id="4ddc7-266">Щелкните каждую виртуальную машину на портале Azure и выберите **Сброс пароля** в колонке **Поддержка и устранение неполадок**.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-266">Click on each VM in the Azure portal then click on **Reset password** in the **Support + troubleshooting** blade.</span></span> <span data-ttu-id="4ddc7-267">В раскрывающемся списке **Режим** выберите **Сбросить пароль** и введите новое **имя пользователя** и **пароль**.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-267">Select **Reset password** in the **Mode** dropdown box, then select a new **User name** and **Password**.</span></span> <span data-ttu-id="4ddc7-268">Нажмите кнопку **Обновить**, чтобы сохранить новое имя пользователя и пароль.</span><span class="sxs-lookup"><span data-stu-id="4ddc7-268">Click the **Update** button to save the new user name and password.</span></span> 


<!-- links -->
[dmz]: ../dmz/secure-vnet-dmz.md
[multi-dc]: multi-region-application.md
[multi-vm]: multi-vm.md
[n-tier]: n-tier.md

[azure-administration]: /azure/automation/automation-intro
[azure-availability-sets]: /azure/virtual-machines/virtual-machines-windows-manage-availability#configure-each-application-tier-into-separate-availability-sets
[azure-cli]: /azure/virtual-machines-command-line-tools
[azure-key-vault]: https://azure.microsoft.com/services/key-vault
[узлом-бастионом]: https://en.wikipedia.org/wiki/Bastion_host
[CIDR]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[chef]: https://www.chef.io/solutions/azure/
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/n-tier-windows
[lb-external-create]: /azure/load-balancer/load-balancer-get-started-internet-portal
[lb-internal-create]: /azure/load-balancer/load-balancer-get-started-ilb-arm-portal
[load-balancer-external]: /azure/load-balancer/load-balancer-internet-overview
[load-balancer-internal]: /azure/load-balancer/load-balancer-internal-overview
[nsg]: /azure/virtual-network/virtual-networks-nsg
[operations-management-suite]: https://www.microsoft.com/server-cloud/operations-management-suite/overview.aspx
[plan-network]: /azure/virtual-network/virtual-network-vnet-plan-design-arm
[private-ip-space]: https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces
[общедоступный IP-адрес]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[puppet]: https://puppetlabs.com/blog/managing-azure-virtual-machines-puppet
[sql-alwayson]: https://msdn.microsoft.com/library/hh510230.aspx
[sql-alwayson-force-failover]: https://msdn.microsoft.com/library/ff877957.aspx
[sql-alwayson-getting-started]: https://msdn.microsoft.com/library/gg509118.aspx
[sql-alwayson-ilb]: /azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-alwayson-int-listener
[sql-alwayson-listeners]: https://msdn.microsoft.com/library/hh213417.aspx
[sql-alwayson-read-only-routing]: https://technet.microsoft.com/library/hh213417.aspx#ConnectToSecondary
[sql-keyvault]: /azure/virtual-machines/virtual-machines-windows-ps-sql-keyvault
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines
[vnet faq]: /azure/virtual-network/virtual-networks-faq
[wsfc-whats-new]: https://technet.microsoft.com/windows-server-docs/failover-clustering/whats-new-in-failover-clustering
[Nagios]: https://www.nagios.org/
[Zabbix]: http://www.zabbix.com/
[Icinga]: http://www.icinga.org/
[visio-download]: https://archcenter.azureedge.net/cdn/vm-reference-architectures.vsdx
[0]: ./images/n-tier-diagram.png "N-уровневая архитектура с использованием Microsoft Azure"