---
title: Запуск фермы SharePoint Server 2016 высокого уровня доступности в Azure
description: Проверенные подходы, касающиеся настройки фермы SharePoint Server 2016 высокого уровня доступности в Azure.
author: njray
ms.date: 07/14/2018
ms.openlocfilehash: ff690300cb5f4af301bcfac58ac10b9b3c47f96d
ms.sourcegitcommit: 71cbef121c40ef36e2d6e3a088cb85c4260599b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/14/2018
ms.locfileid: "39060903"
---
# <a name="run-a-high-availability-sharepoint-server-2016-farm-in-azure"></a><span data-ttu-id="4a492-103">Запуск фермы SharePoint Server 2016 высокого уровня доступности в Azure</span><span class="sxs-lookup"><span data-stu-id="4a492-103">Run a high availability SharePoint Server 2016 farm in Azure</span></span>

<span data-ttu-id="4a492-104">В этой эталонной архитектуре представлен набор проверенных подходов, касающихся настройки фермы SharePoint Server 2016 высокого уровня доступности в Azure с использованием топологии MinRole и групп доступности AlwaysOn SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4a492-104">This reference architecture shows a set of proven practices for setting up a high availability SharePoint Server 2016 farm on Azure, using MinRole topology and SQL Server Always On availability groups.</span></span> <span data-ttu-id="4a492-105">Ферма SharePoint развертывается в защищенной виртуальной сети без конечной точки с выходом в Интернет.</span><span class="sxs-lookup"><span data-stu-id="4a492-105">The SharePoint farm is deployed in a secured virtual network with no Internet-facing endpoint or presence.</span></span> [<span data-ttu-id="4a492-106">**Развернуть это решение**.</span><span class="sxs-lookup"><span data-stu-id="4a492-106">**Deploy this solution**.</span></span>](#deploy-the-solution) 

![](./images/sharepoint-ha.png)

<span data-ttu-id="4a492-107">*Скачайте [файл Visio][visio-download] этой архитектуры.*</span><span class="sxs-lookup"><span data-stu-id="4a492-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="4a492-108">Архитектура</span><span class="sxs-lookup"><span data-stu-id="4a492-108">Architecture</span></span>

<span data-ttu-id="4a492-109">Эта архитектура создана на основе архитектуры, описанной в статье [Run Windows VMs for an N-tier application][windows-n-tier] (Запуск виртуальных машин Windows для n-уровневого приложения).</span><span class="sxs-lookup"><span data-stu-id="4a492-109">This architecture builds on the one shown in [Run Windows VMs for an N-tier application][windows-n-tier].</span></span> <span data-ttu-id="4a492-110">Она развертывает ферму SharePoint Server 2016 высокого уровня доступности в виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="4a492-110">It deploys a SharePoint Server 2016 farm with high availability inside an Azure virtual network (VNet).</span></span> <span data-ttu-id="4a492-111">Эта архитектура подходит для тестовой или рабочей среды, гибридной инфраструктуры SharePoint с Office 365 или в качестве основы для сценария аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="4a492-111">This architecture is suitable for a test or production environment, a SharePoint hybrid infrastructure with Office 365, or as the basis for a disaster recovery scenario.</span></span>

<span data-ttu-id="4a492-112">Она состоит из следующих компонентов:</span><span class="sxs-lookup"><span data-stu-id="4a492-112">The architecture consists of the following components:</span></span>

- <span data-ttu-id="4a492-113">**Группы ресурсов**.</span><span class="sxs-lookup"><span data-stu-id="4a492-113">**Resource groups**.</span></span> <span data-ttu-id="4a492-114">[Группа ресурсов][resource-group] представляет собой контейнер, содержащий связанные ресурсы Azure.</span><span class="sxs-lookup"><span data-stu-id="4a492-114">A [resource group][resource-group] is a container that holds related Azure resources.</span></span> <span data-ttu-id="4a492-115">Одна группа ресурсов используется для серверов SharePoint, а другая — для компонентов инфраструктуры, не зависящих от виртуальных машин, таких как виртуальная сеть и подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4a492-115">One resource group is used for the SharePoint servers, and another resource group is used for infrastructure components that are independent of VMs, such as the virtual network and load balancers.</span></span>

- <span data-ttu-id="4a492-116">**Виртуальная сеть**.</span><span class="sxs-lookup"><span data-stu-id="4a492-116">**Virtual network (VNet)**.</span></span> <span data-ttu-id="4a492-117">Виртуальные машины развертываются в виртуальной сети с уникальным адресным пространством интрасети.</span><span class="sxs-lookup"><span data-stu-id="4a492-117">The VMs are deployed in a VNet with a unique intranet address space.</span></span> <span data-ttu-id="4a492-118">Затем виртуальная сеть подразделяется на подсети.</span><span class="sxs-lookup"><span data-stu-id="4a492-118">The VNet is further subdivided into subnets.</span></span> 

- <span data-ttu-id="4a492-119">**Виртуальные машины**.</span><span class="sxs-lookup"><span data-stu-id="4a492-119">**Virtual machines (VMs)**.</span></span> <span data-ttu-id="4a492-120">Виртуальные машины развертываются в виртуальной сети, затем им назначаются частные статические IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="4a492-120">The VMs are deployed into the VNet, and private static IP addresses are assigned to all of the VMs.</span></span> <span data-ttu-id="4a492-121">Статические IP-адреса рекомендуется использовать для виртуальных машин под управлением SQL Server и SharePoint Server 2016, чтобы избежать проблем с кэшированием IP-адресов и изменением адресов после перезагрузки.</span><span class="sxs-lookup"><span data-stu-id="4a492-121">Static IP addresses are recommended for the VMs running SQL Server and SharePoint Server 2016, to avoid issues with IP address caching and changes of addresses after a restart.</span></span>

- <span data-ttu-id="4a492-122">**Группы доступности**.</span><span class="sxs-lookup"><span data-stu-id="4a492-122">**Availability sets**.</span></span> <span data-ttu-id="4a492-123">Поместите виртуальные машины для каждой роли SharePoint в отдельные [группы доступности][availability-set] и подготовьте по крайней мере две виртуальные машины для каждой роли.</span><span class="sxs-lookup"><span data-stu-id="4a492-123">Place the VMs for each SharePoint role into separate [availability sets][availability-set], and provision at least two virtual machines (VMs) for each role.</span></span> <span data-ttu-id="4a492-124">Таким образом виртуальные машины станут подходящими для соглашения об уровне обслуживания (SLA) более высокого уровня.</span><span class="sxs-lookup"><span data-stu-id="4a492-124">This makes the VMs eligible for a higher service level agreement (SLA).</span></span> 

- <span data-ttu-id="4a492-125">**Внутренний балансировщик нагрузки**.</span><span class="sxs-lookup"><span data-stu-id="4a492-125">**Internal load balancer**.</span></span> <span data-ttu-id="4a492-126">[Подсистема балансировки нагрузки][load-balancer] распределяет трафик запросов SharePoint из локальной сети в интерфейсные веб-серверы фермы SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4a492-126">The [load balancer][load-balancer] distributes SharePoint request traffic from the on-premises network to the front-end web servers of the SharePoint farm.</span></span> 

- <span data-ttu-id="4a492-127">**Группы безопасности сети (NSG)**.</span><span class="sxs-lookup"><span data-stu-id="4a492-127">**Network security groups (NSGs)**.</span></span> <span data-ttu-id="4a492-128">Для каждой подсети, содержащей виртуальные машины, создается [группа безопасности сети][nsg].</span><span class="sxs-lookup"><span data-stu-id="4a492-128">For each subnet that contains virtual machines, a [network security group][nsg] is created.</span></span> <span data-ttu-id="4a492-129">Использование NSG позволяет ограничить сетевой трафик в виртуальной сети, чтобы изолировать подсети.</span><span class="sxs-lookup"><span data-stu-id="4a492-129">Use NSGs to restrict network traffic within the VNet, in order to isolate subnets.</span></span> 

- <span data-ttu-id="4a492-130">**Шлюз**.</span><span class="sxs-lookup"><span data-stu-id="4a492-130">**Gateway**.</span></span> <span data-ttu-id="4a492-131">Шлюз обеспечивает соединение между локальной и виртуальной сетями Azure.</span><span class="sxs-lookup"><span data-stu-id="4a492-131">The gateway provides a connection between your on-premises network and the Azure virtual network.</span></span> <span data-ttu-id="4a492-132">Для соединения может использоваться ExpressRoute или VPN "сеть — сеть".</span><span class="sxs-lookup"><span data-stu-id="4a492-132">Your connection can use ExpressRoute or site-to-site VPN.</span></span> <span data-ttu-id="4a492-133">Дополнительные сведения см. в статье [Connect an on-premises network to Azure][hybrid-ra] (Подключение локальной сети к Azure).</span><span class="sxs-lookup"><span data-stu-id="4a492-133">For more information, see [Connect an on-premises network to Azure][hybrid-ra].</span></span>

- <span data-ttu-id="4a492-134">**Контроллеры домена Windows Server Active Directory (AD)**.</span><span class="sxs-lookup"><span data-stu-id="4a492-134">**Windows Server Active Directory (AD) domain controllers**.</span></span> <span data-ttu-id="4a492-135">В этой эталонной архитектуре развертываются контроллеры домена Windows Server AD.</span><span class="sxs-lookup"><span data-stu-id="4a492-135">This reference architecture deploys Windows Server AD domain controllers.</span></span> <span data-ttu-id="4a492-136">Эти контроллеры домена выполняются в виртуальной сети Azure и имеют отношения доверия с лесом Windows Server AD в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="4a492-136">These domain controllers run in the Azure VNet and have a trust relationship with the on-premises Windows Server AD forest.</span></span> <span data-ttu-id="4a492-137">Интернет-запросы клиента к ресурсам фермы SharePoint проходят проверку подлинности в виртуальной сети Azure вместо отправки трафика проверки подлинности через подключение шлюза в локальную сеть.</span><span class="sxs-lookup"><span data-stu-id="4a492-137">Client web requests for SharePoint farm resources are authenticated in the VNet rather than sending that authentication traffic across the gateway connection to the on-premises network.</span></span> <span data-ttu-id="4a492-138">В службе доменных имен (DNS) создается интрасеть A или записи CNAME, чтобы пользователи интрасети могли разрешить имя фермы SharePoint в частный IP-адрес внутренней подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4a492-138">In DNS, intranet A or CNAME records are created so that intranet users can resolve the name of the SharePoint farm to the private IP address of the internal load balancer.</span></span>

  <span data-ttu-id="4a492-139">SharePoint Server 2016 также поддерживает использование [доменных служб Azure Active Directory](/azure/active-directory-domain-services/).</span><span class="sxs-lookup"><span data-stu-id="4a492-139">SharePoint Server 2016 also supports using [Azure Active Directory Domain Services](/azure/active-directory-domain-services/).</span></span> <span data-ttu-id="4a492-140">Доменные службы Azure AD предоставляют управляемые доменные службы, избавляя вас от необходимости развертывать контроллеры доменов в Azure и управлять ими.</span><span class="sxs-lookup"><span data-stu-id="4a492-140">Azure AD Domain Services provides managed domain services, so that you don't need to deploy and manage domain controllers in Azure.</span></span>

- <span data-ttu-id="4a492-141">**Группа доступности AlwaysOn SQL Server.**</span><span class="sxs-lookup"><span data-stu-id="4a492-141">**SQL Server Always On Availability Group**.</span></span> <span data-ttu-id="4a492-142">Для обеспечения высокого уровня доступности базы данных SQL Server мы рекомендуем воспользоваться инструкциями, приведенными в статье [Группы доступности AlwaysOn (SQL Server)][sql-always-on].</span><span class="sxs-lookup"><span data-stu-id="4a492-142">For high availability of the SQL Server database, we recommend [SQL Server Always On Availability Groups][sql-always-on].</span></span> <span data-ttu-id="4a492-143">Для SQL Server используются две виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="4a492-143">Two virtual machines are used for SQL Server.</span></span> <span data-ttu-id="4a492-144">Одна из них содержит реплику базы данных-источника, а другая — вторичную реплику.</span><span class="sxs-lookup"><span data-stu-id="4a492-144">One contains the primary database replica and the other contains the secondary replica.</span></span> 

- <span data-ttu-id="4a492-145">**Виртуальная машина узла большинства**.</span><span class="sxs-lookup"><span data-stu-id="4a492-145">**Majority node VM**.</span></span> <span data-ttu-id="4a492-146">Эта виртуальная машина позволяет установить кворум в отказоустойчивом кластере.</span><span class="sxs-lookup"><span data-stu-id="4a492-146">This VM allows the failover cluster to establish quorum.</span></span> <span data-ttu-id="4a492-147">Дополнительные сведения см. в разделе [Общее представление о конфигурациях кворума в отказоустойчивом кластере][sql-quorum].</span><span class="sxs-lookup"><span data-stu-id="4a492-147">For more information, see [Understanding Quorum Configurations in a Failover Cluster][sql-quorum].</span></span>

- <span data-ttu-id="4a492-148">**Серверы SharePoint**.</span><span class="sxs-lookup"><span data-stu-id="4a492-148">**SharePoint servers**.</span></span> <span data-ttu-id="4a492-149">Серверы SharePoint выполняют роли внешнего веб-интерфейса, кэширования, приложения и поиска.</span><span class="sxs-lookup"><span data-stu-id="4a492-149">The SharePoint servers perform the web front-end, caching, application, and search roles.</span></span> 

- <span data-ttu-id="4a492-150">**Jumpbox**.</span><span class="sxs-lookup"><span data-stu-id="4a492-150">**Jumpbox**.</span></span> <span data-ttu-id="4a492-151">Он также называется [узлом-бастионом][bastion-host].</span><span class="sxs-lookup"><span data-stu-id="4a492-151">Also called a [bastion host][bastion-host].</span></span> <span data-ttu-id="4a492-152">Это безопасная виртуальная машина в сети, которую администраторы используют для подключения к другим виртуальным машинам.</span><span class="sxs-lookup"><span data-stu-id="4a492-152">This is a secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="4a492-153">В jumpbox есть NSG, обеспечивающая удаленный трафик только из общедоступных IP-адресов из списка надежных отправителей.</span><span class="sxs-lookup"><span data-stu-id="4a492-153">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="4a492-154">NSG должна пропускать трафик с удаленного рабочего стола (RDP).</span><span class="sxs-lookup"><span data-stu-id="4a492-154">The NSG should permit remote desktop (RDP) traffic.</span></span>

## <a name="recommendations"></a><span data-ttu-id="4a492-155">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="4a492-155">Recommendations</span></span>

<span data-ttu-id="4a492-156">Описанная здесь архитектура может не соответствовать вашим требованиям.</span><span class="sxs-lookup"><span data-stu-id="4a492-156">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="4a492-157">Воспользуйтесь этими рекомендациями в качестве отправной точки.</span><span class="sxs-lookup"><span data-stu-id="4a492-157">Use these recommendations as a starting point.</span></span>

### <a name="resource-group-recommendations"></a><span data-ttu-id="4a492-158">Рекомендации по группам ресурсов</span><span class="sxs-lookup"><span data-stu-id="4a492-158">Resource group recommendations</span></span>

<span data-ttu-id="4a492-159">Мы рекомендуем разделять группы ресурсов в соответствии с ролью сервера и создать отдельную группу ресурсов для компонентов инфраструктуры, которые являются глобальными ресурсами.</span><span class="sxs-lookup"><span data-stu-id="4a492-159">We recommend separating resource groups according to the server role, and having a separate resource group for infrastructure components that are global resources.</span></span> <span data-ttu-id="4a492-160">В этой архитектуре ресурсы SharePoint образуют одну группу, а SQL Server и другие ресурсы программы — другую.</span><span class="sxs-lookup"><span data-stu-id="4a492-160">In this architecture, the SharePoint resources form one group, while the SQL Server and other utility assets form another.</span></span>

### <a name="virtual-network-and-subnet-recommendations"></a><span data-ttu-id="4a492-161">Рекомендации по виртуальной сети и подсети</span><span class="sxs-lookup"><span data-stu-id="4a492-161">Virtual network and subnet recommendations</span></span>

<span data-ttu-id="4a492-162">Используйте одну подсеть для каждой роли SharePoint и по одной подсети для шлюза и jumpbox.</span><span class="sxs-lookup"><span data-stu-id="4a492-162">Use one subnet for each SharePoint role, plus a subnet for the gateway and one for the jumpbox.</span></span> 

<span data-ttu-id="4a492-163">Подсети шлюза необходимо присвоить имя *GatewaySubnet*.</span><span class="sxs-lookup"><span data-stu-id="4a492-163">The gateway subnet must be named *GatewaySubnet*.</span></span> <span data-ttu-id="4a492-164">Назначьте подсети шлюза адресное пространство из последней части адресного пространства виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="4a492-164">Assign the gateway subnet address space from the last part of the virtual network address space.</span></span> <span data-ttu-id="4a492-165">Дополнительные сведения см. в статье [Connect an on-premises network to Azure using a VPN gateway][hybrid-vpn-ra] (Подключение локальной сети к Azure с использованием VPN-шлюза).</span><span class="sxs-lookup"><span data-stu-id="4a492-165">For more information, see [Connect an on-premises network to Azure using a VPN gateway][hybrid-vpn-ra].</span></span>

### <a name="vm-recommendations"></a><span data-ttu-id="4a492-166">Рекомендации по виртуальным машинам</span><span class="sxs-lookup"><span data-stu-id="4a492-166">VM recommendations</span></span>

<span data-ttu-id="4a492-167">Исходя из размеров виртуальных машин Standard DSv2, для этой архитектуры требуется как минимум 38 ядер:</span><span class="sxs-lookup"><span data-stu-id="4a492-167">Based on Standard DSv2 virtual machine sizes, this architecture requires a minimum of 38 cores:</span></span>

- <span data-ttu-id="4a492-168">8 серверов SharePoint на Standard_DS3_v2 (4 ядра для каждого) = 32 ядра</span><span class="sxs-lookup"><span data-stu-id="4a492-168">8 SharePoint servers on Standard_DS3_v2 (4 cores each) = 32 cores</span></span>
- <span data-ttu-id="4a492-169">2 контроллера домена Active Directory на Standard_DS1_v2 (1 ядро для каждого) = 2 ядра</span><span class="sxs-lookup"><span data-stu-id="4a492-169">2 Active Directory domain controllers on Standard_DS1_v2 (1 core each) = 2 cores</span></span>
- <span data-ttu-id="4a492-170">2 виртуальные машины SQL Server на Standard_DS1_v2 = 2 ядра</span><span class="sxs-lookup"><span data-stu-id="4a492-170">2 SQL Server VMs on Standard_DS1_v2 = 2 cores</span></span>
- <span data-ttu-id="4a492-171">1 узел большинства на Standard_DS1_v2 = 1 ядро</span><span class="sxs-lookup"><span data-stu-id="4a492-171">1 majority node on Standard_DS1_v2 = 1 core</span></span>
- <span data-ttu-id="4a492-172">1 сервер управления на Standard_DS1_v2 = 1 ядро</span><span class="sxs-lookup"><span data-stu-id="4a492-172">1 management server on Standard_DS1_v2 = 1 core</span></span>

<span data-ttu-id="4a492-173">Общее число ядер будет зависеть от выбранных размеров виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="4a492-173">The total number of cores will depend on the VM sizes that you select.</span></span> <span data-ttu-id="4a492-174">Дополнительные сведения см. в разделе [Рекомендации по SharePoint Server](#sharepoint-server-recommendations) ниже.</span><span class="sxs-lookup"><span data-stu-id="4a492-174">For more information, see [SharePoint Server recommendations](#sharepoint-server-recommendations) below.</span></span>

<span data-ttu-id="4a492-175">Убедитесь, что в вашей подписке Azure достаточно квоты на ядра виртуальных машин для развертывания, иначе развертывание завершится сбоем.</span><span class="sxs-lookup"><span data-stu-id="4a492-175">Make sure your Azure subscription has enough VM core quota for the deployment, or the deployment will fail.</span></span> <span data-ttu-id="4a492-176">Ознакомьтесь со статьей [Подписка Azure, границы, квоты и ограничения службы][quotas].</span><span class="sxs-lookup"><span data-stu-id="4a492-176">See [Azure subscription and service limits, quotas, and constraints][quotas].</span></span> 
 
### <a name="nsg-recommendations"></a><span data-ttu-id="4a492-177">Рекомендации по NSG</span><span class="sxs-lookup"><span data-stu-id="4a492-177">NSG recommendations</span></span>

<span data-ttu-id="4a492-178">Мы рекомендуем использовать одну NSG для каждой подсети, содержащей виртуальные машины, что позволит обеспечить изоляцию подсетей.</span><span class="sxs-lookup"><span data-stu-id="4a492-178">We recommend having one NSG for each subnet that contains VMs, to enable subnet isolation.</span></span> <span data-ttu-id="4a492-179">Если необходимо настроить изоляцию подсетей, добавьте правила NSG, которые определяют разрешенный или запрещенный входящий и исходящий трафик для каждой подсети.</span><span class="sxs-lookup"><span data-stu-id="4a492-179">If you want to configure subnet isolation, add NSG rules that define the allowed or denied inbound or outbound traffic for each subnet.</span></span> <span data-ttu-id="4a492-180">Дополнительные сведения см. в статье [Фильтрация сетевого трафика с помощью групп безопасности сети][virtual-networks-nsg].</span><span class="sxs-lookup"><span data-stu-id="4a492-180">For more information, see [Filter network traffic with network security groups][virtual-networks-nsg].</span></span> 

<span data-ttu-id="4a492-181">Не назначайте NSG подсети шлюза, иначе шлюз прекратит работу.</span><span class="sxs-lookup"><span data-stu-id="4a492-181">Do not assign an NSG to the gateway subnet, or the gateway will stop functioning.</span></span> 

### <a name="storage-recommendations"></a><span data-ttu-id="4a492-182">Рекомендации по хранению данных</span><span class="sxs-lookup"><span data-stu-id="4a492-182">Storage recommendations</span></span>

<span data-ttu-id="4a492-183">Для конфигурации хранилища виртуальных машин в ферме должны использоваться соответствующие рекомендации для локальных развертываний.</span><span class="sxs-lookup"><span data-stu-id="4a492-183">The storage configuration of the VMs in the farm should match the appropriate best practices used for on-premises deployments.</span></span> <span data-ttu-id="4a492-184">На серверах SharePoint должен быть отдельный диск для журналов.</span><span class="sxs-lookup"><span data-stu-id="4a492-184">SharePoint servers should have a separate disk for logs.</span></span> <span data-ttu-id="4a492-185">Для серверов SharePoint, на которых размещены роли индекса поиска, требуется дополнительное место на диске для хранения индекса поиска.</span><span class="sxs-lookup"><span data-stu-id="4a492-185">SharePoint servers hosting search index roles require additional disk space for the search index to be stored.</span></span> <span data-ttu-id="4a492-186">В SQL Server принято разделять данные и журналы.</span><span class="sxs-lookup"><span data-stu-id="4a492-186">For SQL Server, the standard practice is to separate data and logs.</span></span> <span data-ttu-id="4a492-187">Добавьте дополнительные диски для хранения резервных копий базы данных и используйте отдельный диск для [tempdb][tempdb].</span><span class="sxs-lookup"><span data-stu-id="4a492-187">Add more disks for database backup storage, and use a separate disk for [tempdb][tempdb].</span></span>

<span data-ttu-id="4a492-188">Для повышения надежности мы рекомендуем использовать [Управляемые диски Azure][managed-disks].</span><span class="sxs-lookup"><span data-stu-id="4a492-188">For best reliability, we recommend using [Azure Managed Disks][managed-disks].</span></span> <span data-ttu-id="4a492-189">Использование Управляемых дисков обеспечивает изоляцию дисков для виртуальных машин в группе доступности, что помогает избежать единых точек отказа.</span><span class="sxs-lookup"><span data-stu-id="4a492-189">Managed disks ensure that the disks for VMs within an availability set are isolated to avoid single points of failure.</span></span> 

> [!NOTE]
> <span data-ttu-id="4a492-190">Сейчас в шаблоне Resource Manager для этой эталонной архитектуры управляемые диски не используются.</span><span class="sxs-lookup"><span data-stu-id="4a492-190">Currently the Resource Manager template for this reference architecture does not use managed disks.</span></span> <span data-ttu-id="4a492-191">Мы намерены обновить шаблон для использования управляемых дисков.</span><span class="sxs-lookup"><span data-stu-id="4a492-191">We are planning to update the template to use managed disks.</span></span>

<span data-ttu-id="4a492-192">Используйте управляемые диски класса "Премиум" для всех виртуальных машин SharePoint и SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4a492-192">Use Premium managed disks for all SharePoint and SQL Server VMs.</span></span> <span data-ttu-id="4a492-193">Для сервера узла большинства, контроллеров домена и сервера управления можно использовать управляемые диски уровня "Стандартный".</span><span class="sxs-lookup"><span data-stu-id="4a492-193">You can use Standard managed disks for the majority node server, the domain controllers, and the management server.</span></span> 

### <a name="sharepoint-server-recommendations"></a><span data-ttu-id="4a492-194">Рекомендации по SharePoint Server</span><span class="sxs-lookup"><span data-stu-id="4a492-194">SharePoint Server recommendations</span></span>

<span data-ttu-id="4a492-195">Перед настройкой фермы SharePoint убедитесь в наличии одной учетной записи службы Windows Server Active Directory для каждой службы.</span><span class="sxs-lookup"><span data-stu-id="4a492-195">Before configuring the SharePoint farm, make sure you have one Windows Server Active Directory service account per service.</span></span> <span data-ttu-id="4a492-196">Для этой архитектуры необходимы как минимум следующие учетные записи на уровне домена для изоляции привилегий для каждой роли:</span><span class="sxs-lookup"><span data-stu-id="4a492-196">For this architecture, you need at a minimum the following domain-level accounts to isolate privilege per role:</span></span>

- <span data-ttu-id="4a492-197">учетная запись службы SQL Server;</span><span class="sxs-lookup"><span data-stu-id="4a492-197">SQL Server Service account</span></span>
- <span data-ttu-id="4a492-198">учетная запись для настройки пользователей;</span><span class="sxs-lookup"><span data-stu-id="4a492-198">Setup User account</span></span>
- <span data-ttu-id="4a492-199">учетная запись фермы серверов;</span><span class="sxs-lookup"><span data-stu-id="4a492-199">Server Farm account</span></span>
- <span data-ttu-id="4a492-200">учетная запись Службы поиска;</span><span class="sxs-lookup"><span data-stu-id="4a492-200">Search Service account</span></span>
- <span data-ttu-id="4a492-201">учетная запись для доступа к содержимому;</span><span class="sxs-lookup"><span data-stu-id="4a492-201">Content Access account</span></span>
- <span data-ttu-id="4a492-202">учетные записи пула веб-приложений;</span><span class="sxs-lookup"><span data-stu-id="4a492-202">Web App Pool accounts</span></span>
- <span data-ttu-id="4a492-203">учетные записи пула приложений службы;</span><span class="sxs-lookup"><span data-stu-id="4a492-203">Service App Pool accounts</span></span>
- <span data-ttu-id="4a492-204">учетная запись суперпользователя кэша;</span><span class="sxs-lookup"><span data-stu-id="4a492-204">Cache Super User account</span></span>
- <span data-ttu-id="4a492-205">учетная запись суперчитателя кэша.</span><span class="sxs-lookup"><span data-stu-id="4a492-205">Cache Super Reader account</span></span>

<span data-ttu-id="4a492-206">Для всех ролей, кроме индексатора поиска, мы рекомендуем использовать размер виртуальной машины [Standard_DS3_v2][vm-sizes-general].</span><span class="sxs-lookup"><span data-stu-id="4a492-206">For all roles except the Search Indexer, we recommended using the [Standard_DS3_v2][vm-sizes-general] VM size.</span></span> <span data-ttu-id="4a492-207">Размер индексатора поиска должен быть как минимум [Standard_DS13_v2][vm-sizes-memory].</span><span class="sxs-lookup"><span data-stu-id="4a492-207">The Search Indexer should be at least the [Standard_DS13_v2][vm-sizes-memory] size.</span></span> 

> [!NOTE]
> <span data-ttu-id="4a492-208">В шаблоне Resource Manager для этой эталонной архитектуры используется индексатор поиска меньшего размера DS3 для тестирования развертывания.</span><span class="sxs-lookup"><span data-stu-id="4a492-208">The Resource Manager template for this reference architecture uses the smaller DS3 size for the Search Indexer, for purposes of testing the deployment.</span></span> <span data-ttu-id="4a492-209">Для развертывания в рабочей среде используйте размер DS13 или больше.</span><span class="sxs-lookup"><span data-stu-id="4a492-209">For a production deployment, use the DS13 size or larger.</span></span> 

<span data-ttu-id="4a492-210">Для производственных рабочих нагрузок см. сведения в статье [Требования к оборудованию и программному обеспечению для SharePoint Server 2016][sharepoint-reqs].</span><span class="sxs-lookup"><span data-stu-id="4a492-210">For production workloads, see [Hardware and software requirements for SharePoint Server 2016][sharepoint-reqs].</span></span> 

<span data-ttu-id="4a492-211">В соответствии с требованиями к пропускной способности диска, которая составляет как минимум 200 МБ/с, запланируйте архитектуру поиска.</span><span class="sxs-lookup"><span data-stu-id="4a492-211">To meet the support requirement for disk throughput of 200 MB per second minimum, make sure to plan the Search architecture.</span></span> <span data-ttu-id="4a492-212">Дополнительные сведения см. в статье [Планирование архитектуры поиска в корпоративной среде в SharePoint Server 2013][sharepoint-search].</span><span class="sxs-lookup"><span data-stu-id="4a492-212">See [Plan enterprise search architecture in SharePoint Server 2013][sharepoint-search].</span></span> <span data-ttu-id="4a492-213">Кроме того, следуйте указаниям, изложенным в статье [Best practices for crawling in SharePoint Server][sharepoint-crawling] (Рекомендации по сканированию в SharePoint Server 2016).</span><span class="sxs-lookup"><span data-stu-id="4a492-213">Also follow the guidelines in [Best practices for crawling in SharePoint Server 2016][sharepoint-crawling].</span></span>

<span data-ttu-id="4a492-214">В дополнение к этому можно сохранить данные компонента поиска в отдельном томе хранилища или в разделе с высокой производительностью.</span><span class="sxs-lookup"><span data-stu-id="4a492-214">In addition, store the search component data on a separate storage volume or partition with high performance.</span></span> <span data-ttu-id="4a492-215">Чтобы снизить нагрузку и повысить пропускную способность, настройте учетные записи пользователей кэша объектов, необходимые для этой архитектуры.</span><span class="sxs-lookup"><span data-stu-id="4a492-215">To reduce load and improve throughput, configure the object cache user accounts, which are required in this architecture.</span></span> <span data-ttu-id="4a492-216">Разделите файлы операционной системы Windows Server, программные файлы и журналы диагностики SharePoint Server 2016 во всех трех отдельных томах или разделах с обычным уровнем производительности.</span><span class="sxs-lookup"><span data-stu-id="4a492-216">Split the Windows Server operating system files, the SharePoint Server 2016 program files, and diagnostics logs across three separate storage volumes or partitions with normal performance.</span></span> 

<span data-ttu-id="4a492-217">Дополнительные сведения об этих рекомендациях см. в статье [Начальное развертывание учетных записей администраторов и служб в SharePoint Server][sharepoint-accounts].</span><span class="sxs-lookup"><span data-stu-id="4a492-217">For more information about these recommendations, see [Initial deployment administrative and service accounts in SharePoint Server 2016][sharepoint-accounts].</span></span>

### <a name="hybrid-workloads"></a><span data-ttu-id="4a492-218">Гибридные рабочие нагрузки</span><span class="sxs-lookup"><span data-stu-id="4a492-218">Hybrid workloads</span></span>

<span data-ttu-id="4a492-219">Эта эталонная архитектура развертывает ферму SharePoint Server 2016, которую можно использовать в качестве [гибридной среды SharePoint][sharepoint-hybrid]&mdash;, что представляет собой расширение с SharePoint Server 2016 до Office 365 SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="4a492-219">This reference architecture deploys a SharePoint Server 2016 farm that can be used as a [SharePoint hybrid environment][sharepoint-hybrid] &mdash; that is, extending SharePoint Server 2016 to Office 365 SharePoint Online.</span></span> <span data-ttu-id="4a492-220">При наличии Office Online Server см. сведения в статье [Office Web Apps and Office Online Server supportability in Azure][office-web-apps] (Поддержка веб-приложений Office и Office Online Server в Azure).</span><span class="sxs-lookup"><span data-stu-id="4a492-220">If you have Office Online Server, see [Office Web Apps and Office Online Server supportability in Azure][office-web-apps].</span></span>

<span data-ttu-id="4a492-221">Приложения служб по умолчанию в этом развертывании поддерживают гибридные рабочие нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4a492-221">The default service applications in this deployment are designed to support hybrid workloads.</span></span> <span data-ttu-id="4a492-222">Все гибридные рабочие нагрузки SharePoint Server 2016 и Office 365 можно развертывать в эту ферму без изменений в инфраструктуре SharePoint с одним исключением: облачное гибридное приложение службы поиска не следует развертывать на серверах, где размещается имеющаяся топология поиска.</span><span class="sxs-lookup"><span data-stu-id="4a492-222">All SharePoint Server 2016 and Office 365 hybrid workloads can be deployed to this farm without changes to the SharePoint infrastructure, with one exception: The Cloud Hybrid Search Service Application must not be deployed onto servers hosting an existing search topology.</span></span> <span data-ttu-id="4a492-223">Таким образом для поддержки этого гибридного сценария к ферме необходимо добавить одну или несколько виртуальных машин на основе ролей поиска.</span><span class="sxs-lookup"><span data-stu-id="4a492-223">Therefore, one or more search-role-based VMs must be added to the farm to support this hybrid scenario.</span></span>

### <a name="sql-server-always-on-availability-groups"></a><span data-ttu-id="4a492-224">Группы доступности AlwaysOn SQL Server</span><span class="sxs-lookup"><span data-stu-id="4a492-224">SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="4a492-225">В этой архитектуре используются виртуальные машины SQL Server, так как SharePoint Server 2016 не может использовать базу данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="4a492-225">This architecture uses SQL Server virtual machines because SharePoint Server 2016 cannot use Azure SQL Database.</span></span> <span data-ttu-id="4a492-226">Для поддержки высокой доступности в SQL Server мы рекомендуем использовать группы доступности AlwaysOn, определяющие набор баз данных, для которых выполняется отработка отказа вместе, в результате чего повышается их уровень доступности и их легко восстановить.</span><span class="sxs-lookup"><span data-stu-id="4a492-226">To support high availability in SQL Server, we recommend using Always On Availability Groups, which specify a set of databases that fail over together, making them highly-available and recoverable.</span></span> <span data-ttu-id="4a492-227">В этой эталонной архитектуре базы данных создаются во время развертывания, но вам необходимо вручную включить группы доступности AlwaysOn и добавить базы данных SharePoint в группу доступности.</span><span class="sxs-lookup"><span data-stu-id="4a492-227">In this reference architecture, the databases are created during deployment, but you must manually enable Always On Availability Groups and add the SharePoint databases to an availability group.</span></span> <span data-ttu-id="4a492-228">Дополнительные сведения см. в статье [Этап 5. Создание фермы SharePoint в интрасети с помощью Azure: создание группы доступности и добавление баз данных SharePoint][create-availability-group].</span><span class="sxs-lookup"><span data-stu-id="4a492-228">For more information, see [Create the availability group and add the SharePoint databases][create-availability-group].</span></span>

<span data-ttu-id="4a492-229">Мы также рекомендуем добавить в кластер IP-адрес прослушивателя, который является частным IP-адресом внутренней подсистемы балансировки нагрузки для виртуальных машин SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4a492-229">We also recommend adding a listener IP address to the cluster, which is the private IP address of the internal load balancer for the SQL Server virtual machines.</span></span>

<span data-ttu-id="4a492-230">Рекомендуемые размеры виртуальных машин и другие рекомендации по повышению производительности для SQL Server в Azure см. в [этой статье][sql-performance].</span><span class="sxs-lookup"><span data-stu-id="4a492-230">For recommended VM sizes and other performance recommendations for SQL Server running in Azure, see [Performance best practices for SQL Server in Azure Virtual Machines][sql-performance].</span></span> <span data-ttu-id="4a492-231">Кроме того, следуйте указаниям, приведенным в статье [Рекомендации по использованию SQL Server в ферме SharePoint Server][sql-sharepoint-best-practices].</span><span class="sxs-lookup"><span data-stu-id="4a492-231">Also follow the recommendations in [Best practices for SQL Server in a SharePoint Server 2016 farm][sql-sharepoint-best-practices].</span></span>

<span data-ttu-id="4a492-232">Мы рекомендуем разместить сервер узла большинства на компьютере, отдельном от партнеров репликации.</span><span class="sxs-lookup"><span data-stu-id="4a492-232">We recommend that the majority node server reside on a separate computer from the replication partners.</span></span> <span data-ttu-id="4a492-233">Сервер позволяет партнерскому серверу вторичной репликации в сеансе в режиме высокой безопасности определить, следует ли начать процедуру автоматической отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="4a492-233">The server enables the secondary replication partner server in a high-safety mode session to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="4a492-234">В отличие от двух партнеров сервер узла большинства не обслуживает базу данных, но поддерживает автоматический переход на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="4a492-234">Unlike the two partners, the majority node server doesn't serve the database but rather supports automatic failover.</span></span> 

## <a name="scalability-considerations"></a><span data-ttu-id="4a492-235">Вопросы масштабируемости</span><span class="sxs-lookup"><span data-stu-id="4a492-235">Scalability considerations</span></span>

<span data-ttu-id="4a492-236">Чтобы масштабировать имеющиеся серверы, просто измените размер виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="4a492-236">To scale up the existing servers, simply change the VM size.</span></span> 

<span data-ttu-id="4a492-237">Используя возможность [MinRoles][minroles] в SharePoint Server 2016, можно масштабировать серверы в зависимости от роли сервера, а также удалить серверы из роли.</span><span class="sxs-lookup"><span data-stu-id="4a492-237">With the [MinRoles][minroles] capability in SharePoint Server 2016, you can scale out servers based on the server's role and also remove servers from a role.</span></span> <span data-ttu-id="4a492-238">Во время добавления серверов к роли можно указать любые одиночные или объединенные роли.</span><span class="sxs-lookup"><span data-stu-id="4a492-238">When you add servers to a role, you can specify any of the single roles or one of the combined roles.</span></span> <span data-ttu-id="4a492-239">Тем не менее при добавлении серверов в роль Поиска необходимо также перенастроить топологию поиска с использованием PowerShell.</span><span class="sxs-lookup"><span data-stu-id="4a492-239">If you add servers to the Search role, however, you must also reconfigure the search topology using PowerShell.</span></span> <span data-ttu-id="4a492-240">Вы также можете преобразовать роли с помощью MinRoles.</span><span class="sxs-lookup"><span data-stu-id="4a492-240">You can also convert roles using MinRoles.</span></span> <span data-ttu-id="4a492-241">Дополнительные сведения см. в статье [Управление фермой серверов MinRole в SharePoint Server 2016][sharepoint-minrole].</span><span class="sxs-lookup"><span data-stu-id="4a492-241">For more information, see [Managing a MinRole Server Farm in SharePoint Server 2016][sharepoint-minrole].</span></span>

<span data-ttu-id="4a492-242">Обратите внимание, что SharePoint Server 2016 не поддерживает использование масштабируемых наборов виртуальных машин для автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="4a492-242">Note that SharePoint Server 2016 doesn't support using virtual machine scale sets for auto-scaling.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="4a492-243">Вопросы доступности</span><span class="sxs-lookup"><span data-stu-id="4a492-243">Availability considerations</span></span>

<span data-ttu-id="4a492-244">Эта эталонная архитектура поддерживает высокий уровень доступности в регионе Azure, так как в каждой роли по крайней мере две виртуальные машины развернуты в группе доступности.</span><span class="sxs-lookup"><span data-stu-id="4a492-244">This reference architecture supports high availability within an Azure region, because each role has at least two VMs deployed in an availability set.</span></span>

<span data-ttu-id="4a492-245">Для защиты от региональных сбоев создайте отдельную ферму аварийного восстановления в другом регионе Azure.</span><span class="sxs-lookup"><span data-stu-id="4a492-245">To protect against a regional failure, create a separate disaster recovery farm in a different Azure region.</span></span> <span data-ttu-id="4a492-246">Ваши целевое время восстановления и целевые точки восстановления определяют требования к установке.</span><span class="sxs-lookup"><span data-stu-id="4a492-246">Your recovery time objectives (RTOs) and recovery point objectives (RPOs) will determine the setup requirements.</span></span> <span data-ttu-id="4a492-247">Дополнительные сведения см. в статье [Выбор стратегии аварийного восстановления для SharePoint Server][sharepoint-dr].</span><span class="sxs-lookup"><span data-stu-id="4a492-247">For details, see [Choose a disaster recovery strategy for SharePoint 2016][sharepoint-dr].</span></span> <span data-ttu-id="4a492-248">Дополнительный регион должен быть *сопряженным* с основным регионом.</span><span class="sxs-lookup"><span data-stu-id="4a492-248">The secondary region should be a *paired region* with the primary region.</span></span> <span data-ttu-id="4a492-249">На случай масштабного сбоя в каждой паре определяется приоритетный регион для восстановления.</span><span class="sxs-lookup"><span data-stu-id="4a492-249">In the event of a broad outage, recovery of one region is prioritized out of every pair.</span></span> <span data-ttu-id="4a492-250">Дополнительные сведения см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure][paired-regions].</span><span class="sxs-lookup"><span data-stu-id="4a492-250">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][paired-regions].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="4a492-251">Вопросы управляемости</span><span class="sxs-lookup"><span data-stu-id="4a492-251">Manageability considerations</span></span>

<span data-ttu-id="4a492-252">Для эксплуатации и обслуживания серверов, ферм серверов и сайтов выполните рекомендации для операций с SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4a492-252">To operate and maintain servers, server farms, and sites, follow the recommended practices for SharePoint operations.</span></span> <span data-ttu-id="4a492-253">Дополнительные сведения см. в статье [Операции для SharePoint Server][sharepoint-ops].</span><span class="sxs-lookup"><span data-stu-id="4a492-253">For more information, see [Operations for SharePoint Server 2016][sharepoint-ops].</span></span>

<span data-ttu-id="4a492-254">Задачи, которые следует учитывать при управлении SQL Server в среде SharePoint, могут отличаться от тех, которые обычно применяются для приложения базы данных.</span><span class="sxs-lookup"><span data-stu-id="4a492-254">The tasks to consider when managing SQL Server in a SharePoint environment may differ from the ones typically considered for a database application.</span></span> <span data-ttu-id="4a492-255">Рекомендуется выполнять еженедельное полное резервное копирование всех баз данных SQL и добавочное ежедневное резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="4a492-255">A best practice is to fully back up all SQL databases weekly with incremental nightly backups.</span></span> <span data-ttu-id="4a492-256">Выполняйте резервное копирование журналов транзакций каждые 15 минут.</span><span class="sxs-lookup"><span data-stu-id="4a492-256">Back up transaction logs every 15 minutes.</span></span> <span data-ttu-id="4a492-257">Другой подход заключается в реализации задач обслуживания SQL Server в базах данных при отключении встроенных задач обслуживания SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4a492-257">Another practice is to implement SQL Server maintenance tasks on the databases while disabling the built-in SharePoint ones.</span></span> <span data-ttu-id="4a492-258">Дополнительные сведения см. в статье [Настройка и планирование загрузки SQL Server и хранилища (SharePoint Server)][sql-server-capacity-planning].</span><span class="sxs-lookup"><span data-stu-id="4a492-258">For more information, see [Storage and SQL Server capacity planning and configuration][sql-server-capacity-planning].</span></span> 

## <a name="security-considerations"></a><span data-ttu-id="4a492-259">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="4a492-259">Security considerations</span></span>

<span data-ttu-id="4a492-260">Для процессов проверки подлинности и присоединения к домену в учетных записях службы на уровне домена, используемых для запуска SharePoint Server 2016, должны быть контроллеры домена Windows Server AD.</span><span class="sxs-lookup"><span data-stu-id="4a492-260">The domain-level service accounts used to run SharePoint Server 2016 require Windows Server AD domain controllers for domain-join and authentication processes.</span></span> <span data-ttu-id="4a492-261">Доменные службы Azure Active Directory не могут использоваться для этой цели.</span><span class="sxs-lookup"><span data-stu-id="4a492-261">Azure Active Directory Domain Services can't be used for this purpose.</span></span> <span data-ttu-id="4a492-262">Для расширения инфраструктуры удостоверений Windows Server AD, имеющейся в интрасети, эта архитектура использует два контроллера домена реплики Windows Server AD имеющегося леса Windows Server AD в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="4a492-262">To extend the Windows Server AD identity infrastructure already in place in the intranet, this architecture uses two Windows Server AD replica domain controllers of an existing on-premises Windows Server AD forest.</span></span>

<span data-ttu-id="4a492-263">Кроме того, рекомендуется всегда планировать усиление безопасности.</span><span class="sxs-lookup"><span data-stu-id="4a492-263">In addition, it's always wise to plan for security hardening.</span></span> <span data-ttu-id="4a492-264">К другим рекомендациям относится:</span><span class="sxs-lookup"><span data-stu-id="4a492-264">Other recommendations include:</span></span>

- <span data-ttu-id="4a492-265">Добавьте правила в NSG, чтобы изолировать подсети и роли.</span><span class="sxs-lookup"><span data-stu-id="4a492-265">Add rules to NSGs to isolate subnets and roles.</span></span>
- <span data-ttu-id="4a492-266">Не присваивайте виртуальным машинам общедоступные IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="4a492-266">Don't assign public IP addresses to VMs.</span></span>
- <span data-ttu-id="4a492-267">Для обнаружения сетевых вторжений и анализа полезных данных в интерфейсных веб-серверах используйте виртуальный сетевой модуль вместо внутренней подсистемы балансировки нагрузки Azure.</span><span class="sxs-lookup"><span data-stu-id="4a492-267">For intrusion detection and analysis of payloads, consider using a network virtual appliance in front of the front-end web servers instead of an internal Azure load balancer.</span></span>
- <span data-ttu-id="4a492-268">В качестве альтернативы используйте политики IPsec для шифрования трафика открытого текста между серверами.</span><span class="sxs-lookup"><span data-stu-id="4a492-268">As an option, use IPsec policies for encryption of cleartext traffic between servers.</span></span> <span data-ttu-id="4a492-269">Если также выполняется изоляция подсети, обновите правила группы безопасности вашей сети, чтобы разрешить трафик IPsec.</span><span class="sxs-lookup"><span data-stu-id="4a492-269">If you are also doing subnet isolation, update your network security group rules to allow IPsec traffic.</span></span>
- <span data-ttu-id="4a492-270">Установите агенты защиты от вредоносных программ для виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="4a492-270">Install anti-malware agents for the VMs.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="4a492-271">Развертывание решения</span><span class="sxs-lookup"><span data-stu-id="4a492-271">Deploy the solution</span></span>

<span data-ttu-id="4a492-272">Пример развертывания для этой архитектуры можно найти на портале [GitHub][github].</span><span class="sxs-lookup"><span data-stu-id="4a492-272">A deployment for this reference architecture is available on [GitHub][github].</span></span> <span data-ttu-id="4a492-273">Полное развертывание может занять несколько часов.</span><span class="sxs-lookup"><span data-stu-id="4a492-273">The entire deployment can take several hours to complete.</span></span>

<span data-ttu-id="4a492-274">Развертывание создает в вашей подписке следующие группы ресурсов:</span><span class="sxs-lookup"><span data-stu-id="4a492-274">The deployment creates the following resource groups in your subscription:</span></span>

- <span data-ttu-id="4a492-275">ra-onprem-sp2016-rg</span><span class="sxs-lookup"><span data-stu-id="4a492-275">ra-onprem-sp2016-rg</span></span>
- <span data-ttu-id="4a492-276">ra-sp2016-network-rg</span><span class="sxs-lookup"><span data-stu-id="4a492-276">ra-sp2016-network-rg</span></span>

<span data-ttu-id="4a492-277">Файлы параметров шаблона ссылаются на эти имена, поэтому, если вы их изменяете, соответствующим образом обновите файлы параметров.</span><span class="sxs-lookup"><span data-stu-id="4a492-277">The template parameter files refer to these names, so if you change them, update the parameter files to match.</span></span> 

<span data-ttu-id="4a492-278">Файлы параметров содержат запрограммированный пароль в различных расположениях.</span><span class="sxs-lookup"><span data-stu-id="4a492-278">The parameter files include a hard-coded password in various places.</span></span> <span data-ttu-id="4a492-279">Измените эти значения перед развертыванием.</span><span class="sxs-lookup"><span data-stu-id="4a492-279">Change these values before you deploy.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="4a492-280">предварительным требованиям</span><span class="sxs-lookup"><span data-stu-id="4a492-280">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deploy-the-solution"></a><span data-ttu-id="4a492-281">Развертывание решения</span><span class="sxs-lookup"><span data-stu-id="4a492-281">Deploy the solution</span></span> 

1. <span data-ttu-id="4a492-282">Выполните приведенную ниже команду, чтобы развернуть имитированную локальную сеть.</span><span class="sxs-lookup"><span data-stu-id="4a492-282">Run the following command to deploy a simulated on-premises network.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p onprem.json --deploy
    ```

2. <span data-ttu-id="4a492-283">Выполните приведенную ниже команду, чтобы развернуть виртуальную сеть Azure и VPN-шлюз.</span><span class="sxs-lookup"><span data-stu-id="4a492-283">Run the following command to deploy the Azure VNet and the VPN gateway.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p connections.json --deploy
    ```

3. <span data-ttu-id="4a492-284">Выполните приведенную ниже команду, чтобы развернуть Jumpbox, контроллеры домена AD и виртуальные машины SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4a492-284">Run the following command to deploy the jumpbox, AD domain controllers, and SQL Server VMs.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure1.json --deploy
    ```

4. <span data-ttu-id="4a492-285">Выполните приведенную ниже команду, чтобы создать отказоустойчивый кластер и группу доступности.</span><span class="sxs-lookup"><span data-stu-id="4a492-285">Run the following command to create the failover cluster and the availability group.</span></span> 

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure2-cluster.json --deploy

5. Run the following command to deploy the remaining VMs.

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure3.json --deploy
    ```

<span data-ttu-id="4a492-286">На этом этапе проверьте, можно ли установить подключение TCP между веб-интерфейсом и подсистемой балансировки нагрузки для группы доступности AlwaysOn на платформе SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4a492-286">At this point, verify that you can make a TCP conection from the web front end to the load balancer for the SQL Server Always On availability group.</span></span> <span data-ttu-id="4a492-287">Для этого выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="4a492-287">To do so, perform the following steps:</span></span>

1. <span data-ttu-id="4a492-288">Используйте портал Azure для поиска в группе ресурсов `ra-sp2016-network-rg` виртуальной машины с именем `ra-sp-jb-vm1`.</span><span class="sxs-lookup"><span data-stu-id="4a492-288">Use the Azure portal to find the VM named `ra-sp-jb-vm1` in the `ra-sp2016-network-rg` resource group.</span></span> <span data-ttu-id="4a492-289">Это виртуальная машина Jumpbox.</span><span class="sxs-lookup"><span data-stu-id="4a492-289">This is the jumpbox VM.</span></span>

2. <span data-ttu-id="4a492-290">Нажмите `Connect`, чтобы открыть сеанс удаленного рабочего стола для виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="4a492-290">Click `Connect` to open a remote desktop session to the VM.</span></span> <span data-ttu-id="4a492-291">Используйте пароль, указанный в файле параметров `azure1.json`.</span><span class="sxs-lookup"><span data-stu-id="4a492-291">Use the password that you specified in the `azure1.json` parameter file.</span></span>

3. <span data-ttu-id="4a492-292">Из сеанса удаленного рабочего стола выполните вход по адресу 10.0.5.4.</span><span class="sxs-lookup"><span data-stu-id="4a492-292">From the Remote Desktop session, log into 10.0.5.4.</span></span> <span data-ttu-id="4a492-293">Это IP-адрес виртуальной машины с именем `ra-sp-app-vm1`.</span><span class="sxs-lookup"><span data-stu-id="4a492-293">This is the IP address of the VM named `ra-sp-app-vm1`.</span></span>

4. <span data-ttu-id="4a492-294">Откройте консоль PowerShell на виртуальной машине и используйте командлет `Test-NetConnection`, чтобы убедиться, что вы можете подключиться к подсистеме балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4a492-294">Open a PowerShell console in the VM, and use the `Test-NetConnection` cmdlet to verify that you can connect to the load balancer.</span></span>

    ```powershell
    Test-NetConnection 10.0.3.100 -Port 1433
    ```

<span data-ttu-id="4a492-295">Результат должен выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="4a492-295">The output should look similar to the following:</span></span>

```powershell
ComputerName     : 10.0.3.100
RemoteAddress    : 10.0.3.100
RemotePort       : 1433
InterfaceAlias   : Ethernet 3
SourceAddress    : 10.0.0.132
TcpTestSucceeded : True
```

<span data-ttu-id="4a492-296">Если не удается получить такой результат, перезапустите виртуальную машину `ra-sp-sql-vm2` с помощью портала Azure.</span><span class="sxs-lookup"><span data-stu-id="4a492-296">If it fails, use the Azure Portal to restart the VM named `ra-sp-sql-vm2`.</span></span> <span data-ttu-id="4a492-297">Когда виртуальная машина перезапустится, еще раз выполните команду `Test-NetConnection`.</span><span class="sxs-lookup"><span data-stu-id="4a492-297">After the VM restarts, run the `Test-NetConnection` command again.</span></span> <span data-ttu-id="4a492-298">Возможно, после перезапуска виртуальной машины потребуется подождать около минуты, пока не установится подключение.</span><span class="sxs-lookup"><span data-stu-id="4a492-298">You may need to wait about a minute after the VM restarts for the connection to succeed.</span></span> 

<span data-ttu-id="4a492-299">Выполните развертывание, как указано ниже.</span><span class="sxs-lookup"><span data-stu-id="4a492-299">Now complete the deployment as follows.</span></span>

1. <span data-ttu-id="4a492-300">Выполните приведенную ниже команду, чтобы развернуть основной узел фермы SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4a492-300">Run the following command to deploy the SharePoint farm primary node.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure4-sharepoint-server.json --deploy
    ```

2. <span data-ttu-id="4a492-301">Выполните приведенную ниже команду, чтобы развернуть кэш, функцию поиска и веб-часть SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4a492-301">Run the following command to deploy the SharePoint cache, search, and web.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure5-sharepoint-farm.json --deploy
    ```

3. <span data-ttu-id="4a492-302">Выполните приведенную ниже команду, чтобы создать правила группы безопасности сети.</span><span class="sxs-lookup"><span data-stu-id="4a492-302">Run the following command to create the NSG rules.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure6-security.json --deploy
    ```

### <a name="validate-the-deployment"></a><span data-ttu-id="4a492-303">Проверка развертывания</span><span class="sxs-lookup"><span data-stu-id="4a492-303">Validate the deployment</span></span>

1. <span data-ttu-id="4a492-304">На [портале Azure][azure-portal] перейдите к группе ресурсов `ra-onprem-sp2016-rg`.</span><span class="sxs-lookup"><span data-stu-id="4a492-304">In the [Azure portal][azure-portal], navigate to the `ra-onprem-sp2016-rg` resource group.</span></span>

2. <span data-ttu-id="4a492-305">В списке ресурсов выберите ресурс виртуальной машины с именем `ra-onpr-u-vm1`.</span><span class="sxs-lookup"><span data-stu-id="4a492-305">In the list of resources, select the VM resource named `ra-onpr-u-vm1`.</span></span> 

3. <span data-ttu-id="4a492-306">Подключитесь к виртуальной машине, как описано в разделе [Подключение к виртуальной машине][connect-to-vm].</span><span class="sxs-lookup"><span data-stu-id="4a492-306">Connect to the VM, as described in [Connect to virtual machine][connect-to-vm].</span></span> <span data-ttu-id="4a492-307">Имя пользователя — `\onpremuser`.</span><span class="sxs-lookup"><span data-stu-id="4a492-307">The user name is `\onpremuser`.</span></span>

5.  <span data-ttu-id="4a492-308">После установки удаленного подключения к виртуальной машине откройте браузер на виртуальной машине и перейдите по адресу `http://portal.contoso.local`.</span><span class="sxs-lookup"><span data-stu-id="4a492-308">When the remote connection to the VM is established, open a browser in the VM and navigate to `http://portal.contoso.local`.</span></span>

6.  <span data-ttu-id="4a492-309">В поле **Безопасность Windows** войдите на портал SharePoint, использовав `contoso.local\testuser` в качестве имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="4a492-309">In the **Windows Security** box, log on to the SharePoint portal using `contoso.local\testuser` for the user name.</span></span>

<span data-ttu-id="4a492-310">В результате такого входа создается туннель из домена Fabrikam.com, используемого в локальной сети, к домену contoso.local, используемому на портале SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4a492-310">This logon tunnels from the Fabrikam.com domain used by the on-premises network to the contoso.local domain used by the SharePoint portal.</span></span> <span data-ttu-id="4a492-311">Когда откроется сайт SharePoint, вы увидите корневой демонстрационный сайт.</span><span class="sxs-lookup"><span data-stu-id="4a492-311">When the SharePoint site opens, you'll see the root demo site.</span></span>

<span data-ttu-id="4a492-312">**_Авторы этой эталонной архитектуры_**&mdash; Джо Дэвис (Joe Davies), Боб Фокс (Bob Fox), Нэйл Ходжкинсон (Neil Hodgkinson), Пол Сторк (Paul Stork)</span><span class="sxs-lookup"><span data-stu-id="4a492-312">**_Contributors to this reference architecture_** &mdash;  Joe Davies, Bob Fox, Neil Hodgkinson, Paul Stork</span></span>

<!-- links -->

[availability-set]: /azure/virtual-machines/windows/manage-availability
[azure-portal]: https://portal.azure.com
[azure-ps]: /powershell/azure/overview
[azure-pricing]: https://azure.microsoft.com/pricing/calculator/
[bastion-host]: https://en.wikipedia.org/wiki/Bastion_host
[create-availability-group]: https://technet.microsoft.com/library/mt793548(v=office.16).aspx
[connect-to-vm]: /azure/virtual-machines/windows/quick-create-portal#connect-to-virtual-machine
[github]: https://github.com/mspnp/reference-architectures
[hybrid-ra]: ../hybrid-networking/index.md
[hybrid-vpn-ra]: ../hybrid-networking/vpn.md
[load-balancer]: /azure/load-balancer/load-balancer-internal-overview
[managed-disks]: /azure/storage/storage-managed-disks-overview
[minroles]: https://technet.microsoft.com/library/mt346114(v=office.16).aspx
[nsg]: /azure/virtual-network/virtual-networks-nsg
[office-web-apps]: https://support.microsoft.com/help/3199955/office-web-apps-and-office-online-server-supportability-in-azure
[paired-regions]: /azure/best-practices-availability-paired-regions
[readme]: https://github.com/mspnp/reference-architectures/tree/master/sharepoint/sharepoint-2016
[resource-group]: /azure/azure-resource-manager/resource-group-overview
[quotas]: /azure/azure-subscription-service-limits
[sharepoint-accounts]: https://technet.microsoft.com/library/ee662513(v=office.16).aspx
[sharepoint-crawling]: https://technet.microsoft.com/library/dn535606(v=office.16).aspx
[sharepoint-dr]: https://technet.microsoft.com/library/ff628971(v=office.16).aspx
[sharepoint-hybrid]: https://aka.ms/sphybrid
[sharepoint-minrole]: https://technet.microsoft.com/library/mt743705(v=office.16).aspx
[sharepoint-ops]: https://technet.microsoft.com/library/cc262289(v=office.16).aspx
[sharepoint-reqs]: https://technet.microsoft.com/library/cc262485(v=office.16).aspx
[sharepoint-search]: https://technet.microsoft.com/library/dn342836.aspx
[sql-always-on]: /sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server
[sql-performance]: /virtual-machines/windows/sql/virtual-machines-windows-sql-performance
[sql-server-capacity-planning]: https://technet.microsoft.com/library/cc298801(v=office.16).aspx
[sql-quorum]: https://technet.microsoft.com/library/cc731739(v=ws.11).aspx
[sql-sharepoint-best-practices]: https://technet.microsoft.com/library/hh292622(v=office.16).aspx
[tempdb]: /sql/relational-databases/databases/tempdb-database
[virtual-networks-nsg]: /azure/virtual-network/virtual-networks-nsg
[visio-download]: https://archcenter.blob.core.windows.net/cdn/Sharepoint-2016.vsdx
[vm-sizes-general]: /azure/virtual-machines/windows/sizes-general
[vm-sizes-memory]: /azure/virtual-machines/windows/sizes-memory
[windows-n-tier]: ../virtual-machines-windows/n-tier.md
