---
title: Эталонная архитектура Интернета вещей Azure
description: Рекомендуемая архитектура для приложений Интернета вещей в Azure, использующая компоненты платформы как услуги (PaaS)
titleSuffix: Azure Reference Architectures
author: MikeWasson
ms.date: 01/09/2019
ms.openlocfilehash: 5a4b104044f3e64ffdce98e3952201d397d41f33
ms.sourcegitcommit: 700a4f6ce61b1ebe68e227fc57443e49282e35aa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/07/2019
ms.locfileid: "55887358"
---
# <a name="azure-iot-reference-architecture"></a><span data-ttu-id="3d9ec-103">Эталонная архитектура Интернета вещей Azure</span><span class="sxs-lookup"><span data-stu-id="3d9ec-103">Azure IoT reference architecture</span></span>

<span data-ttu-id="3d9ec-104">В этой эталонной архитектуре показана рекомендуемая архитектура для приложений Интернета вещей в Azure, использующая компоненты платформы как услуги (PaaS).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-104">This reference architecture shows a recommended architecture for IoT applications on Azure using PaaS (platform-as-a-service) components.</span></span>

![Схема архитектуры](./_images/iot.png)

<span data-ttu-id="3d9ec-106">Приложения Интернета вещей можно описать как **вещи** (устройства) для передачи данных, которые создают **аналитические сведения**.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-106">IoT applications can be described as **things** (devices) sending data that generates **insights**.</span></span> <span data-ttu-id="3d9ec-107">Эти сведения создают **действия** для улучшения компании или процессов.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-107">These insights generate **actions** to improve a business or process.</span></span> <span data-ttu-id="3d9ec-108">Например, модуль (вещь), отправляющий данные температуры.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-108">An example is an engine (the thing) sending temperature data.</span></span> <span data-ttu-id="3d9ec-109">Эти данные используются для оценки правильности работы модуля (анализ).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-109">This data is used to evaluate whether the engine is performing as expected (the insight).</span></span> <span data-ttu-id="3d9ec-110">Аналитические сведения используются, чтобы упреждающе назначить приоритет расписания обслуживания для модуля (действие).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-110">The insight is used to proactively prioritize the maintenance schedule for the engine (the action).</span></span>

<span data-ttu-id="3d9ec-111">Эта эталонная архитектура использует компоненты Azure PaaS (платформа как услуга).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-111">This reference architecture uses Azure PaaS (platform-as-a-service) components.</span></span> <span data-ttu-id="3d9ec-112">Другие варианты создания решений Интернета вещей в Azure:</span><span class="sxs-lookup"><span data-stu-id="3d9ec-112">Other options for building IoT solutions on Azure include:</span></span>

- <span data-ttu-id="3d9ec-113">[Azure IoT Central](/azure/iot-central/).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-113">[Azure IoT Central](/azure/iot-central/).</span></span> <span data-ttu-id="3d9ec-114">IoT Central — это полностью управляемое решение SaaS (программное обеспечение как услуга).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-114">IoT Central is a fully managed SaaS (software-as-a-service) solution.</span></span> <span data-ttu-id="3d9ec-115">Оно абстрагирует технические решения и позволяет сосредоточиться исключительно на собственном.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-115">It abstracts the technical choices and lets you focus on your solution exclusively.</span></span> <span data-ttu-id="3d9ec-116">Однако вместе с простотой вы получаете меньше настраиваемых решений, чем в решении на основе PaaS.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-116">This simplicity comes with a tradeoff in being less customizable than a PaaS-based solution.</span></span>
- <span data-ttu-id="3d9ec-117">С помощью компонентов ОС, таких как стек SMACK (Spark, Mesos, Akka, Cassandra, Kafka), оно развертывается на виртуальные машины Azure.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-117">Using OSS components such as the SMACK stack (Spark, Mesos, Akka, Cassandra, Kafka) deployed on Azure VMs.</span></span> <span data-ttu-id="3d9ec-118">Такой подход обеспечивает больший контроль, но и более сложен.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-118">This approach offers a great deal of control but is more complex.</span></span>

<span data-ttu-id="3d9ec-119">На высшем уровне существует два способа обработки данных телеметрии: "горячий" и "холодный" путь.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-119">At a high level, there are two ways to process telemetry data, hot path and cold path.</span></span> <span data-ttu-id="3d9ec-120">Разница связана с требованиями к задержке и доступу к данным.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-120">The difference has to do with requirements for latency and data access.</span></span>

- <span data-ttu-id="3d9ec-121">**"Горячий" путь** позволяет анализировать данные в режиме реального времени по мере их поступления.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-121">The **hot path** analyzes data in near-real-time, as it arrives.</span></span> <span data-ttu-id="3d9ec-122">При применении этого способа данные телеметрии должны обрабатываться с очень низкой задержкой.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-122">In the hot path, telemetry must be processed with very low latency.</span></span> <span data-ttu-id="3d9ec-123">"Горячий" путь обычно реализуется с помощью подсистемы потоковой обработки.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-123">The hot path is typically implemented using a stream processing engine.</span></span> <span data-ttu-id="3d9ec-124">Выходные данные могут инициировать оповещение или записываться в структурированный формат, который можно запросить с помощью средств аналитики.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-124">The output may trigger an alert, or be written to a structured format that can be queried using analytical tools.</span></span>
- <span data-ttu-id="3d9ec-125">**"Холодный" путь** позволяет выполнить пакетную обработку в течение более длительных интервалов (ежечасно или ежедневно).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-125">The **cold path** performs batch processing at longer intervals (hourly or daily).</span></span> <span data-ttu-id="3d9ec-126">"Холодный" путь обычно работает с большими объемами данных, однако результаты не требуются также своевременно, как в "горячем" пути.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-126">The cold path typically operates over large volumes of data, but the results don't need to be as timely as the hot path.</span></span> <span data-ttu-id="3d9ec-127">В "холодном" пути собираются необработанные данные телеметрии, а затем передаются в процесс пакетной обработки.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-127">In the cold path, raw telemetry is captured and then fed into a batch process.</span></span>

## <a name="architecture"></a><span data-ttu-id="3d9ec-128">Архитектура</span><span class="sxs-lookup"><span data-stu-id="3d9ec-128">Architecture</span></span>

<span data-ttu-id="3d9ec-129">Архитектура состоит из следующих компонентов.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-129">This architecture consists of the following components.</span></span> <span data-ttu-id="3d9ec-130">Для некоторых приложений могут требоваться лишь некоторые из перечисленных здесь компонентов.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-130">Some applications may not require every component listed here.</span></span>

<span data-ttu-id="3d9ec-131">**Устройства Интернета вещей**.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-131">**IoT devices**.</span></span> <span data-ttu-id="3d9ec-132">Устройства можно безопасно зарегистрировать в облаке и подключать к нему для отправки и получения данных.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-132">Devices can securely register with the cloud, and can connect to the cloud to send and receive data.</span></span> <span data-ttu-id="3d9ec-133">Некоторые устройства могут быть **пограничными устройствами**, выполняющими определенную обработку данных на самом устройстве или в полевом шлюзе.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-133">Some devices may be **edge devices** that perform some data processing on the device itself or in a field gateway.</span></span> <span data-ttu-id="3d9ec-134">Мы рекомендуем использовать [Azure IoT Edge](/azure/iot-edge/) для обработки пограничных устройств.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-134">We recommend [Azure IoT Edge](/azure/iot-edge/) for edge processing.</span></span>

<span data-ttu-id="3d9ec-135">**Облачный шлюз**.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-135">**Cloud gateway**.</span></span> <span data-ttu-id="3d9ec-136">Облачный шлюз предоставляет центр облачных вычислений устройств для безопасного подключения к облаку и отправки данных.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-136">A cloud gateway provides a cloud hub for devices to connect securely to the cloud and send data.</span></span> <span data-ttu-id="3d9ec-137">Он также предоставляет возможности управления устройствами, включая команды и контроль устройств.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-137">It also provides device management, capabilities, including command and control of devices.</span></span> <span data-ttu-id="3d9ec-138">Для облачного шлюза мы рекомендуем использовать [Центр Интернета вещей](/azure/iot-hub/).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-138">For the cloud gateway, we recommend [IoT Hub](/azure/iot-hub/).</span></span> <span data-ttu-id="3d9ec-139">Центр Интернета вещей — это размещенная облачная служба, которая принимает данные о событиях с устройств, действуя как брокер сообщений между устройствами и серверными службами.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-139">IoT Hub is a hosted cloud service that ingests events from devices, acting as a message broker between devices and backend services.</span></span> <span data-ttu-id="3d9ec-140">Центр Интернета вещей предоставляет безопасное подключение, получение данных событий, двусторонний обмен сообщениями и управление устройствами.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-140">IoT Hub provides secure connectivity, event ingestion, bidirectional communication, and device management.</span></span>

<span data-ttu-id="3d9ec-141">**Подготовка устройства**.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-141">**Device provisioning.**</span></span> <span data-ttu-id="3d9ec-142">При регистрации и подключении большого набора устройств мы рекомендуем использовать [Службу подготовки устройств к добавлению в Центр Интернета вещей](/azure/iot-dps/) (DPS).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-142">For registering and connecting large sets of devices, we recommend using the [IoT Hub Device Provisioning Service](/azure/iot-dps/) (DPS).</span></span> <span data-ttu-id="3d9ec-143">DPS позволяет назначать и регистрировать устройства в определенные конечные точки Центра Интернета вещей Azure в нужном масштабе.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-143">DPS lets you assign and register devices to specific Azure IoT Hub endpoints at scale.</span></span>

<span data-ttu-id="3d9ec-144">**Потоковая обработка.**</span><span class="sxs-lookup"><span data-stu-id="3d9ec-144">**Stream processing**.</span></span> <span data-ttu-id="3d9ec-145">Потоковая передача анализирует большие потоки записей данных и оценивает правила для этих потоков.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-145">Stream processing analyzes large streams of data records and evaluates rules for those streams.</span></span> <span data-ttu-id="3d9ec-146">Для обработки потоков данных рекомендуем использовать [Azure Stream Analytics](/azure/stream-analytics/).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-146">For stream processing, we recommend [Azure Stream Analytics](/azure/stream-analytics/).</span></span> <span data-ttu-id="3d9ec-147">Stream Analytics может выполнять сложный анализ в необходимом масштабе с помощью функций ограничения окна, агрегаций потока и внешних соединителей источников данных.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-147">Stream Analytics can execute complex analysis at scale, using time windowing functions, stream aggregations, and external data source joins.</span></span> <span data-ttu-id="3d9ec-148">Кроме того, вы можете использовать Apache Spark в [Azure Databricks](/azure/azure-databricks/).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-148">Another option is Apache Spark on [Azure Databricks](/azure/azure-databricks/).</span></span>

<span data-ttu-id="3d9ec-149">Машинное обучение позволяет выполнять алгоритмы прогнозирования на основе архивных данных телеметрии, включая такие сценарии, как прогнозное обслуживание.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-149">Machine learning allows predictive algorithms to be executed over historical telemetry data, enabling scenarios such as predictive maintenance.</span></span> <span data-ttu-id="3d9ec-150">Для машинного обучения рекомендуем использовать [службу "Машинное обучение Azure"](/azure/machine-learning/service/).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-150">For machine learning, we recommend [Azure Machine Learning Service](/azure/machine-learning/service/).</span></span>

<span data-ttu-id="3d9ec-151">**Хранилище "горячего" пути** содержит данные, которые должны быть сразу же доступны на устройстве для создания отчетов и визуализации.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-151">**Warm path storage** holds data that must be available immediately from device for reporting and visualization.</span></span> <span data-ttu-id="3d9ec-152">В качестве хранилища "горячего" пути мы рекомендуем использовать [Cosmos DB](/azure/cosmos-db/introduction).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-152">For warm path storage, we recommend [Cosmos DB](/azure/cosmos-db/introduction).</span></span> <span data-ttu-id="3d9ec-153">Cosmos DB — это многомодельная глобально распределенная база данных.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-153">Cosmos DB is a globally distributed, multi-model database.</span></span>

<span data-ttu-id="3d9ec-154">**Хранилище "холодного" пути** содержит данные, которые хранятся долгосрочно и используются в пакетной обработке.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-154">**Cold path storage** holds data that is kept longer term and is used for batch processing.</span></span> <span data-ttu-id="3d9ec-155">В качестве хранилища "холодного" пути мы рекомендуем использовать [хранилище BLOB-объектов Azure](/azure/storage/blobs/storage-blobs-introduction).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-155">For cold path storage, we recommend [Azure Blob Storage](/azure/storage/blobs/storage-blobs-introduction).</span></span> <span data-ttu-id="3d9ec-156">Данные можно заархивировать в хранилище BLOB-объектов на неопределенное время без лишних затрат. Такие данные легко доступны для пакетной обработки.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-156">Data can be archived in Blob storage indefinitely at low cost, and is easily accessible for batch processing.</span></span>

<span data-ttu-id="3d9ec-157">При **преобразовании данных** выполняются действия с потоком данных телеметрии или его объединение.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-157">**Data transformation** manipulates or aggregates the telemetry stream.</span></span> <span data-ttu-id="3d9ec-158">Примеры включают преобразование протоколов, например, преобразование двоичных данных в JSON или объединение точек данных.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-158">Examples include protocol transformation, such as converting binary data to JSON, or combining data points.</span></span> <span data-ttu-id="3d9ec-159">Если данные необходимо преобразовать до поступления в Центр Интернета вещей, мы рекомендуем использовать [шлюз протокола](/azure/iot-hub/iot-hub-protocol-gateway) (не показано).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-159">If the data must be transformed before reaching IoT Hub, we recommend using a [protocol gateway](/azure/iot-hub/iot-hub-protocol-gateway) (not shown).</span></span> <span data-ttu-id="3d9ec-160">В противном случае данные можно преобразовать после поступления в Центр Интернета вещей.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-160">Otherwise, data can be transformed after it reaches IoT Hub.</span></span> <span data-ttu-id="3d9ec-161">В этом случае мы рекомендуем использовать [Функции Azure](/azure/azure-functions/).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-161">In that case, we recommend using [Azure Functions](/azure/azure-functions/).</span></span> <span data-ttu-id="3d9ec-162">В службе "Функции" есть встроенная интеграция с Центром Интернета вещей, Cosmos DB и хранилищем BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-162">Functions has built-in integration with IoT Hub, Cosmos DB, and Blob Storage.</span></span>

<span data-ttu-id="3d9ec-163">При **интеграции бизнес-процессов** действия выполняются на основе аналитических сведений из данных устройства.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-163">**Business process integration** performs actions based on insights from the device data.</span></span> <span data-ttu-id="3d9ec-164">Сюда входит хранение информационных сообщений, создание оповещений, отправка электронной почты или текстовых сообщений или интеграция с CRM.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-164">This could include storing informational messages, raising alarms, sending email or SMS messages, or integrating with CRM.</span></span> <span data-ttu-id="3d9ec-165">Для интеграции бизнес-процессов мы рекомендуем использовать [Azure Logic Apps](/azure/logic-apps/logic-apps-overview).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-165">We recommend using [Azure Logic Apps](/azure/logic-apps/logic-apps-overview) for business process integration.</span></span>

<span data-ttu-id="3d9ec-166">**Управление пользователями** позволяет настроить ограничение пользователей или групп для выполнения действий на устройствах, таких как обновление встроенного ПО.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-166">**User management** restricts which users or groups can perform actions on devices, such as upgrading firmware.</span></span> <span data-ttu-id="3d9ec-167">Оно также определяет возможности для пользователей в приложениях.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-167">It also defines capabilities for users in applications.</span></span> <span data-ttu-id="3d9ec-168">Для аутентификации и авторизации пользователей мы рекомендуем использовать [Azure Active Directory](/azure/active-directory/).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-168">We recommend using [Azure Active Directory](/azure/active-directory/) to authenticate and authorize users.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="3d9ec-169">Вопросы масштабируемости</span><span class="sxs-lookup"><span data-stu-id="3d9ec-169">Scalability considerations</span></span>

<span data-ttu-id="3d9ec-170">Приложение Интернета вещей следует создавать как отдельную службу, которую можно масштабировать независимо от других.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-170">An IoT application should be built as discrete services that can scale independently.</span></span> <span data-ttu-id="3d9ec-171">Учитывайте следующие моменты масштабируемости:</span><span class="sxs-lookup"><span data-stu-id="3d9ec-171">Consider the following scalability points:</span></span>

<span data-ttu-id="3d9ec-172">**Центр Интернета вещей**.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-172">**IoTHub**.</span></span> <span data-ttu-id="3d9ec-173">Для Центра Интернета вещей необходимо учитывать следующие факторы масштабирования:</span><span class="sxs-lookup"><span data-stu-id="3d9ec-173">For IoT Hub, consider the following scale factors:</span></span>

- <span data-ttu-id="3d9ec-174">максимальная [дневная квота](/azure/iot-hub/iot-hub-devguide-quotas-throttling) сообщений в Центре Интернета вещей;</span><span class="sxs-lookup"><span data-stu-id="3d9ec-174">The maximum [daily quota](/azure/iot-hub/iot-hub-devguide-quotas-throttling) of messages into IoT Hub.</span></span>
- <span data-ttu-id="3d9ec-175">квота на число подключенных устройств в экземпляре Центра Интернета вещей;</span><span class="sxs-lookup"><span data-stu-id="3d9ec-175">The quota of connected devices in an IoT Hub instance.</span></span>
- <span data-ttu-id="3d9ec-176">пропускная способность приема данных &mdash; насколько быстро Центр Интернета вещей может принимать сообщения;</span><span class="sxs-lookup"><span data-stu-id="3d9ec-176">Ingestion throughput &mdash; how quickly IoT Hub can ingest messages.</span></span>
- <span data-ttu-id="3d9ec-177">пропускная способность обработки &mdash; скорость обработки входящих сообщений.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-177">Processing throughput &mdash; how quickly the incoming messages are processed.</span></span>

<span data-ttu-id="3d9ec-178">Каждый центр Интернета вещей подготавливается с определенным количеством единиц для каждого конкретного уровня.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-178">Each IoT hub is provisioned with a certain number of units in a specific tier.</span></span> <span data-ttu-id="3d9ec-179">Уровень и число единиц определяют максимальную дневную квоту сообщений, которые вы можете отправить в центр.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-179">The tier and number of units determine the maximum daily quota of messages that devices can send to the hub.</span></span> <span data-ttu-id="3d9ec-180">Дополнительные сведения см. в разделе о квотах и регулировании Центра Интернета вещей.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-180">For more information, see IoT Hub quotas and throttling.</span></span> <span data-ttu-id="3d9ec-181">Вы можете увеличить масштаб, не прерывая имеющиеся операции.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-181">You can scale up a hub without interrupting existing operations.</span></span>

<span data-ttu-id="3d9ec-182">**Stream Analytics**.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-182">**Stream Analytics**.</span></span> <span data-ttu-id="3d9ec-183">Задания Stream Analytics лучше всего масштабируются, если они параллельны во всех точках конвейера Stream Analytics, от ввода данных до запроса и вывода данных.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-183">Stream Analytics jobs scale best if they are parallel at all points in the Stream Analytics pipeline, from input to query to output.</span></span> <span data-ttu-id="3d9ec-184">Полностью параллельные задания позволяют Stream Analytics разделить работу между несколькими вычислительными узлами.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-184">A fully parallel job allows Stream Analytics to split the work across multiple compute nodes.</span></span> <span data-ttu-id="3d9ec-185">В противном случае Stream Analytics должен объединять данные потока в одном расположении.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-185">Otherwise, Stream Analytics has to combine the stream data into one place.</span></span> <span data-ttu-id="3d9ec-186">Дополнительные сведения см. в статье [Использование параллелизации запросов в Azure Stream Analytics](/azure/stream-analytics/stream-analytics-parallelization).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-186">For more information, see [Leverage query parallelization in Azure Stream Analytics](/azure/stream-analytics/stream-analytics-parallelization).</span></span>

<span data-ttu-id="3d9ec-187">Центр Интернета вещей автоматически разбивает сообщения устройств на основе идентификатора устройства.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-187">IoT Hub automatically partitions device messages based on the device ID.</span></span> <span data-ttu-id="3d9ec-188">Все сообщения с определенного устройства будут всегда доставляться в тот же раздел, однако в одном разделе всегда будут сообщения с нескольких устройств.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-188">All of the messages from a particular device will always arrive on the same partition, but a single partition will have messages from multiple devices.</span></span> <span data-ttu-id="3d9ec-189">Таким образом, единицей измерения параллелизации является идентификатор раздела.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-189">Therefore, the unit of parallelization is the partition ID.</span></span>

<span data-ttu-id="3d9ec-190">**Функции**.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-190">**Functions**.</span></span> <span data-ttu-id="3d9ec-191">При чтении из конечной точки Центров событий существует максимальное количество экземпляров для каждого раздела Центра событий.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-191">When reading from the Event Hubs endpoint, there is a maximum of function instance per event hub partition.</span></span> <span data-ttu-id="3d9ec-192">Максимальная скорость обработки определяется тем, как быстро один экземпляр функции может обрабатывать события из одного раздела.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-192">The maximum processing rate is determined by how fast one function instance can process the events from a single partition.</span></span> <span data-ttu-id="3d9ec-193">Функция должна обрабатывать сообщения в пакетах.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-193">The function should process messages in batches.</span></span>

<span data-ttu-id="3d9ec-194">**Cosmos DB**.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-194">**Cosmos DB**.</span></span> <span data-ttu-id="3d9ec-195">Чтобы расширить коллекцию Cosmos DB, создайте коллекцию с ключом раздела и включите его в каждый написанный вами документ.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-195">To scale out a Cosmos DB collection, create the collection with a partition key and include the partition key in each document that you write.</span></span> <span data-ttu-id="3d9ec-196">Дополнительные сведения см. в разделе [с рекомендациями по выбору ключа раздела](/azure/cosmos-db/partition-data#best-practices-when-choosing-a-partition-key).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-196">For more information, see [Best practices when choosing a partition key](/azure/cosmos-db/partition-data#best-practices-when-choosing-a-partition-key).</span></span>

- <span data-ttu-id="3d9ec-197">Если вы храните и обновляете один документ на каждом устройстве, идентификатор устройства будет хорошим ключом раздела.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-197">If you store and update a single document per device, the device ID is a good partition key.</span></span> <span data-ttu-id="3d9ec-198">Операции записи равномерно распределяются между ключами.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-198">Writes are evenly distributed across the keys.</span></span> <span data-ttu-id="3d9ec-199">Размер каждой секции строго ограничен, так как для значения каждого ключа есть по одному документу.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-199">The size of each partition is strictly bounded, because there is a single document for each key value.</span></span>
- <span data-ttu-id="3d9ec-200">Если вы храните отдельный документ для каждого сообщения устройства, использование идентификатора устройства в качестве ключа раздела быстро приведет к превышению ограничения в 10 ГБ на раздел.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-200">If you store a separate document for every device message, using the device ID as a partition key would quickly exceed the 10-GB limit per partition.</span></span> <span data-ttu-id="3d9ec-201">Идентификатор сообщения в этом случае является более оптимальным ключом раздела.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-201">Message ID is a better partition key in that case.</span></span> <span data-ttu-id="3d9ec-202">Обычно вы все равно включаете идентификатор устройства в документ для индексации и запросов.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-202">Typically you would still include device ID in the document for indexing and querying.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="3d9ec-203">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="3d9ec-203">Security considerations</span></span>

### <a name="trustworthy-and-secure-communication"></a><span data-ttu-id="3d9ec-204">Надежный и безопасный обмен данными</span><span class="sxs-lookup"><span data-stu-id="3d9ec-204">Trustworthy and secure communication</span></span>

<span data-ttu-id="3d9ec-205">Все данные, поступающие с устройства и отправляющиеся на него, должны быть надежными.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-205">All information received from and sent to a device must be trustworthy.</span></span> <span data-ttu-id="3d9ec-206">Если устройство не может поддерживать следующие возможности шифрования, оно должно быть ограничено локальными сетями и вся межсетевая связь должна проходить через полевой шлюз:</span><span class="sxs-lookup"><span data-stu-id="3d9ec-206">Unless a device can support the following cryptographic capabilities, it should be constrained to local networks and all internetwork communication should go through a field gateway:</span></span>

- <span data-ttu-id="3d9ec-207">Шифрование данных с помощью надежно защищенного, публично проанализированного и широко реализованного алгоритма шифрования с симметричным ключом.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-207">Data encryption with a provably secure, publicly analyzed, and broadly implemented symmetric-key encryption algorithm.</span></span>
- <span data-ttu-id="3d9ec-208">Цифровая подпись с помощью надежно защищенного, публично проанализированного и широко реализованного алгоритма шифрования с симметричным ключом.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-208">Digital signature with a provably secure, publicly analyzed, and broadly implemented symmetric-key signature algorithm.</span></span>
- <span data-ttu-id="3d9ec-209">Поддержка TLS 1.2 для TCP или других путей обмена данными на основе потоковой передачи или DTLS 1.2 для путей обмена данными на основе датаграммы.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-209">Support for either TLS 1.2 for TCP or other stream-based communication paths or DTLS 1.2 for datagram-based communication paths.</span></span> <span data-ttu-id="3d9ec-210">Поддержка обработки сертификата X.509 является необязательной. Ее можно заменить более эффективным с точки зрения вычислений и сети режимом ключа с предварительным общим доступом для TLS, который можно реализовать с поддержкой алгоритмов AES и SHA-2.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-210">Support of X.509 certificate handling is optional and can be replaced by the more compute-efficient and wire-efficient pre-shared key mode for TLS, which can be implemented with support for the AES and SHA-2 algorithms.</span></span>
- <span data-ttu-id="3d9ec-211">Обновляемое хранилище ключей и ключи для каждого устройства.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-211">Updateable key-store and per-device keys.</span></span> <span data-ttu-id="3d9ec-212">Каждое устройство должно иметь уникальный материальный ключ или маркеры, которые идентифицируют его в системе.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-212">Each device must have unique key material or tokens that identify it toward the system.</span></span> <span data-ttu-id="3d9ec-213">Устройствам следует безопасно хранить ключи (например, с помощью безопасного хранилища ключей).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-213">The devices should store the key securely on the device (for example, using a secure key-store).</span></span> <span data-ttu-id="3d9ec-214">Устройство должно иметь возможность периодически обновлять ключи или маркеры или мгновенно в аварийных ситуациях, например при нарушении системы безопасности.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-214">The device should be able to update the keys or tokens periodically, or reactively in emergency situations such as a system breach.</span></span>
- <span data-ttu-id="3d9ec-215">Встроенное ПО и программное обеспечение приложения на устройстве должны позволять применение обновлений для исправления обнаруженных уязвимостей безопасности.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-215">The firmware and application software on the device must allow for updates to enable the repair of discovered security vulnerabilities.</span></span>

<span data-ttu-id="3d9ec-216">Тем не менее многие устройства слишком ограничены для поддержки таких требований.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-216">However, many devices are too constrained to support these requirements.</span></span> <span data-ttu-id="3d9ec-217">В этом случае следует использовать полевой шлюз.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-217">In that case, a field gateway should be used.</span></span> <span data-ttu-id="3d9ec-218">Безопасное подключение устройств к полевому шлюзу через локальную сеть и шлюз обеспечивает безопасный обмен данными с облаком.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-218">Devices connect securely to the field gateway through a local area network, and the gateway enables secure communication to the cloud.</span></span>

### <a name="physical-tamper-proofing"></a><span data-ttu-id="3d9ec-219">Проверка физического незаконного изменения данных</span><span class="sxs-lookup"><span data-stu-id="3d9ec-219">Physical tamper proofing</span></span>

<span data-ttu-id="3d9ec-220">Чтобы обеспечить целостность системы безопасности и надежность системы, архитектура устройства должна включать функции, защищающие от попыток физической манипуляции.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-220">It is strongly recommended that device design incorporates features that defend against physical manipulation attempts, to help ensure the security integrity and trustworthiness of the overall system.</span></span>

<span data-ttu-id="3d9ec-221">Например: </span><span class="sxs-lookup"><span data-stu-id="3d9ec-221">For example:</span></span>

- <span data-ttu-id="3d9ec-222">Выберите микроконтроллеры, микропроцессоры или вспомогательное оборудование, которое предоставляет безопасное хранилище и использует криптографический материал ключа, такой как интеграция доверенного платформенного модуля (TPM).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-222">Choose microcontrollers/microprocessors or auxiliary hardware that provide secure storage and use of cryptographic key material, such as trusted platform module (TPM) integration.</span></span>
- <span data-ttu-id="3d9ec-223">Безопасный загрузчик и безопасная загрузка программного обеспечения, привязанная в доверенном платформенном модуле.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-223">Secure boot loader and secure software loading, anchored in the TPM.</span></span>
- <span data-ttu-id="3d9ec-224">Используйте датчики, чтобы обнаружить попытки вторжения и манипуляции средой устройства путем оповещения и потенциального цифрового самоуничтожения устройства.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-224">Use sensors to detect intrusion attempts and attempts to manipulate the device environment with alerting and potentially “digital self-destruction” of the device.</span></span>

<span data-ttu-id="3d9ec-225">Дополнительные сведения о безопасности см. в статье [Архитектура безопасности Интернета вещей](/azure/iot-fundamentals/iot-security-architecture).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-225">For additional security considerations, see [Internet of Things (IoT) security architecture](/azure/iot-fundamentals/iot-security-architecture).</span></span>

### <a name="monitoring-and-logging"></a><span data-ttu-id="3d9ec-226">Мониторинг и ведение журнала</span><span class="sxs-lookup"><span data-stu-id="3d9ec-226">Monitoring and logging</span></span>

<span data-ttu-id="3d9ec-227">Системы мониторинга и ведения журнала используются для определения работоспособности устройства и устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-227">Logging and monitoring systems are used to determine whether the solution is functioning and to help troubleshoot problems.</span></span> <span data-ttu-id="3d9ec-228">Они помогают ответить на следующие вопросы по операциям:</span><span class="sxs-lookup"><span data-stu-id="3d9ec-228">Monitoring and logging systems help answer the following operational questions:</span></span>

- <span data-ttu-id="3d9ec-229">Есть ли в устройствах или системах ошибки?</span><span class="sxs-lookup"><span data-stu-id="3d9ec-229">Are devices or systems in an error condition?</span></span>
- <span data-ttu-id="3d9ec-230">Правильно ли устройства или системы настроены?</span><span class="sxs-lookup"><span data-stu-id="3d9ec-230">Are devices or systems correctly configured?</span></span>
- <span data-ttu-id="3d9ec-231">Создают ли устройства или системы точные данные?</span><span class="sxs-lookup"><span data-stu-id="3d9ec-231">Are devices or systems generating accurate data?</span></span>
- <span data-ttu-id="3d9ec-232">Соответствуют ли системы ожиданиям компании и клиентов?</span><span class="sxs-lookup"><span data-stu-id="3d9ec-232">Are systems meeting the expectations of both the business and end customers?</span></span>

<span data-ttu-id="3d9ec-233">Средства ведения журнала и мониторинга обычно состоят из следующих четырех компонентов:</span><span class="sxs-lookup"><span data-stu-id="3d9ec-233">Logging and monitoring tools are typically comprised of the following four components:</span></span>

- <span data-ttu-id="3d9ec-234">средства проверки производительности системы и визуализации временной шкалы для мониторинга системы и базового устранения неполадок;</span><span class="sxs-lookup"><span data-stu-id="3d9ec-234">System performance and timeline visualization tools to monitor the system and for basic troubleshooting.</span></span>
- <span data-ttu-id="3d9ec-235">прием данных в буфере, что позволяет поместить в буфер данные журнала;</span><span class="sxs-lookup"><span data-stu-id="3d9ec-235">Buffered data ingestion, to buffer log data.</span></span>
- <span data-ttu-id="3d9ec-236">постоянное хранилище для хранения данных журнала;</span><span class="sxs-lookup"><span data-stu-id="3d9ec-236">Persistence store to store log data.</span></span>
- <span data-ttu-id="3d9ec-237">возможности поиска и запросов для просмотра данных журнала, используемых при детальном устранении неполадок.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-237">Search and query capabilities, to view log data for use in detailed troubleshooting.</span></span>

<span data-ttu-id="3d9ec-238">Системы мониторинга предоставляют аналитические сведения о работоспособности, безопасности, стабильности и производительности решения Интернета вещей.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-238">Monitoring systems provide insights into the health, security, and stability, and performance of an IoT solution.</span></span> <span data-ttu-id="3d9ec-239">Эти системы также могут предоставлять более подробное представление, записывать изменения конфигурации компонентов и предоставлять извлеченные данные журнала, с помощью которых можно выявить потенциальные уязвимости системы безопасности, улучшить процесс управления инцидентами и помочь владельцу системы устранять неполадки.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-239">These systems can also provide a more detailed view, recording component configuration changes and providing extracted logging data that can surface potential security vulnerabilities, enhance the incident management process, and help the owner of the system troubleshoot problems.</span></span> <span data-ttu-id="3d9ec-240">Комплексные решения для мониторинга включают возможность запрашивать информацию для определенных подсистем или выполнять статистическую обработку в нескольких подсистемах.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-240">Comprehensive monitoring solutions include the ability to query information for specific subsystems or aggregating across multiple subsystems.</span></span>

<span data-ttu-id="3d9ec-241">Разработку системы мониторинга следует начинать с определения работоспособных операций, соблюдения нормативных требований и требований к аудиту.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-241">Monitoring system development should begin by defining healthy operation, regulatory compliance, and audit requirements.</span></span> <span data-ttu-id="3d9ec-242">Собранные метрики могут включать:</span><span class="sxs-lookup"><span data-stu-id="3d9ec-242">Metrics collected may include:</span></span>

- <span data-ttu-id="3d9ec-243">физические устройства, пограничные устройства и компоненты инфраструктуры, сообщающие об изменениях конфигурации;</span><span class="sxs-lookup"><span data-stu-id="3d9ec-243">Physical devices, edge devices, and infrastructure components reporting configuration changes.</span></span>
- <span data-ttu-id="3d9ec-244">приложения, сообщающие об изменениях конфигурации, журналах аудита безопасности, сведения о частоте запросов, времени отклика, частоте появления ошибок и статистику сборки мусора для управляемых языков;</span><span class="sxs-lookup"><span data-stu-id="3d9ec-244">Applications reporting configuration changes, security audit logs, request rates, response times, error rates, and garbage collection statistics for managed languages.</span></span>
- <span data-ttu-id="3d9ec-245">базы данных, постоянные хранилища, кэши, сообщающие о производительности запросов и записи, изменениях схемы, журналах аудита безопасности, блокировках и взаимоблокировках, производительности индекса, потреблении ЦП, памяти и диска;</span><span class="sxs-lookup"><span data-stu-id="3d9ec-245">Databases, persistence stores, and caches reporting query and write performance, schema changes, security audit log, locks or deadlocks, index performance, CPU, memory, and disk usage.</span></span>
- <span data-ttu-id="3d9ec-246">управляемые службы (IaaS, PaaS, SaaS и FaaS), которые сообщают о метриках работоспособности и изменениях конфигурации, влияющих на работоспособность и производительность зависимой системы.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-246">Managed services (IaaS, PaaS, SaaS, and FaaS) reporting health metrics and configuration changes that impact dependent system health and performance.</span></span>

<span data-ttu-id="3d9ec-247">Визуализация метрик мониторинга позволяет операторам получать оповещения о нестабильности системы и облегчает реагирование на инциденты.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-247">Visualization of monitoring metrics alert operators to system instabilities and facilitate incident response.</span></span>

### <a name="tracing-telemetry"></a><span data-ttu-id="3d9ec-248">Трассировка данных телеметрии</span><span class="sxs-lookup"><span data-stu-id="3d9ec-248">Tracing telemetry</span></span>

<span data-ttu-id="3d9ec-249">Трассировка данных телеметрии позволяет оператору отслеживать перемещение фрагмента данных телеметрии по системе с момента его создания.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-249">Tracing telemetry allows an operator to follow the journey of a piece of telemetry from creation through the system.</span></span> <span data-ttu-id="3d9ec-250">Трассировка очень важна для отладки и устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-250">Tracing is important for debugging and troubleshooting.</span></span> <span data-ttu-id="3d9ec-251">В решениях Интернета вещей, которые используют Центр Интернета вещей и [пакеты SDK для устройств Центра Интернета вещей](/azure/iot-hub/iot-hub-devguide-sdks), датаграммы трассировки можно создавать в качестве сообщений из облака на устройство и включать в поток телеметрии.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-251">For IoT solutions that use Azure IoT Hub and the [IoT Hub Device SDKs](/azure/iot-hub/iot-hub-devguide-sdks), tracing datagrams can be originated as Cloud-to-Device messages and included in the telemetry stream.</span></span>

### <a name="logging"></a><span data-ttu-id="3d9ec-252">Ведение журналов</span><span class="sxs-lookup"><span data-stu-id="3d9ec-252">Logging</span></span>

<span data-ttu-id="3d9ec-253">Системы ведения журнала являются неотъемлемой частью понимания действий, выполненных решением, произошедших сбоев и могут помочь в устранении этих сбоев.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-253">Logging systems are integral in understanding what actions or activities a solution has performed, failures that have occurred, and can provide help in fixing those failures.</span></span> <span data-ttu-id="3d9ec-254">Вы можете проанализировать журналы, чтобы помочь понять и исправить ошибки, улучшить характеристики производительности, а также обеспечить соответствие действующим правилам и нормам.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-254">Logs can be analyzed to help understand and remedy error conditions, enhance performance characteristics, and ensure compliance with governing rule and regulations.</span></span>

<span data-ttu-id="3d9ec-255">Несмотря на то что ведение журнала обычным текстом меньше влияет на первоначальные затраты на разработку, компьютеру сложнее его анализировать и читать.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-255">Though plain-text logging is lower impact on upfront development costs, it is more challenging for a machine to parse/read.</span></span> <span data-ttu-id="3d9ec-256">Мы рекомендуем использовать структурированное ведение журнала, чтобы собранная информация была доступна для анализа компьютером и удобной для чтения.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-256">We recommend structured logging be used, as collected information is both machine parsable and human readable.</span></span> <span data-ttu-id="3d9ec-257">Структурированное ведение журнала добавляет ситуационный контекст и метаданные к информации журнала.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-257">Structured logging adds situational context and metadata to the log information.</span></span> <span data-ttu-id="3d9ec-258">При структурированном ведении журнала свойства привилегированы и отформатированы по парам "ключ — значение" или имеют предопределенную схему для улучшения возможностей поиска и запросов.</span><span class="sxs-lookup"><span data-stu-id="3d9ec-258">In structured logging, properties are first class citizens formatted as key/value pairs, or with a fixed schema, to enhance search and query capabilities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3d9ec-259">Дополнительная информация</span><span class="sxs-lookup"><span data-stu-id="3d9ec-259">Next steps</span></span>

- <span data-ttu-id="3d9ec-260">Дополнительные сведения о рекомендуемой архитектуре и вариантах реализации см. в PDF-документе об [эталонной архитектуре Центра Интернета вещей Microsoft Azure](http://aka.ms/iotrefarchitecture).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-260">For a more detailed discussion of the recommended architecture and implementation choices, see [Microsoft Azure IoT Reference Architecture](http://aka.ms/iotrefarchitecture) (PDF).</span></span>

- <span data-ttu-id="3d9ec-261">Подробную документацию по различным службам Интернета вещей Azure см. в статье [Принципы работы Azure IoT](/azure/iot-fundamentals/).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-261">For detailed documentation of the various Azure IoT services, see [Azure IoT Fundamentals](/azure/iot-fundamentals/).</span></span>

- <span data-ttu-id="3d9ec-262">Пример реализации решения для Интернета вещей можно найти в [GitHub](https://github.com/mspnp/iot-guidance).</span><span class="sxs-lookup"><span data-stu-id="3d9ec-262">A sample IoT implementation is available on [GitHub](https://github.com/mspnp/iot-guidance).</span></span>
