---
title: "Запуск сервера Jenkins в Azure"
description: "На схеме этой эталонной архитектуры показано развертывание и применение в Azure масштабируемого корпоративного сервера Jenkins, защищенного с помощью единого входа (SSO)."
author: njray
ms.date: 01/21/18
ms.openlocfilehash: 9cab4990b259695f310da339bfef3060b0905640
ms.sourcegitcommit: 3426a9c5ed937f097725c487cf3d073ae5e2a347
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2018
---
# <a name="run-a-jenkins-server-on-azure"></a><span data-ttu-id="f7371-103">Запуск сервера Jenkins в Azure</span><span class="sxs-lookup"><span data-stu-id="f7371-103">Run a Jenkins server on Azure</span></span>

<span data-ttu-id="f7371-104">На схеме этой эталонной архитектуры показано развертывание и применение в Azure масштабируемого корпоративного сервера Jenkins, защищенного с помощью единого входа (SSO).</span><span class="sxs-lookup"><span data-stu-id="f7371-104">This reference architecture shows how to deploy and operate a scalable, enterprise-grade Jenkins server on Azure secured with single sign-on (SSO).</span></span> <span data-ttu-id="f7371-105">В этой архитектуре также используется платформа Azure Monitor, позволяющая отслеживать состояние сервера Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-105">The architecture also uses Azure Monitor to monitor the state of the Jenkins server.</span></span> [<span data-ttu-id="f7371-106">**Разверните это решение**.</span><span class="sxs-lookup"><span data-stu-id="f7371-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

![Сервер Jenkins, работающий в Azure][0]

<span data-ttu-id="f7371-108">*Скачайте [файл Visio](https://arch-center.azureedge.net/cdn/Jenkins-architecture.vsdx), который содержит схему этой архитектуры.*</span><span class="sxs-lookup"><span data-stu-id="f7371-108">*Download a [Visio file](https://arch-center.azureedge.net/cdn/Jenkins-architecture.vsdx) that contains this architecture diagram.*</span></span>

<span data-ttu-id="f7371-109">Эта архитектура поддерживает аварийное восстановление с помощью служб Azure, но не распространяется на более сложные сценарии горизонтального масштабирования, предусматривающие использование нескольких главных серверов или высокий уровень доступности без простоев.</span><span class="sxs-lookup"><span data-stu-id="f7371-109">This architecture supports disaster recovery with Azure services but does not cover more advanced scale-out scenarios involving multiple masters or high availability (HA) with no downtime.</span></span> <span data-ttu-id="f7371-110">Чтобы получить общее представление о различных компонентах Azure, а также ознакомиться с пошаговым руководством по созданию конвейера непрерывной интеграции и непрерывной доставки в Azure, см. раздел [Jenkins в Azure][jenkins-on-azure].</span><span class="sxs-lookup"><span data-stu-id="f7371-110">For general insights about the various Azure components, including a step-by-step tutorial about building out a CI/CD pipeline on Azure, see [Jenkins on  Azure][jenkins-on-azure].</span></span>

<span data-ttu-id="f7371-111">В этом документе описываются основные операции Azure, необходимые для поддержки Jenkins, включая использование службы хранилища Azure для поддержания артефактов сборки, элементы безопасности, необходимые для единого входа, другие службы, которые можно интегрировать, и возможности масштабирования конвейера.</span><span class="sxs-lookup"><span data-stu-id="f7371-111">The focus of this document is on the core Azure operations needed to support Jenkins, including the use of Azure Storage to maintain build artifacts, the security items needed for SSO, other services that can be integrated, and scalability for the pipeline.</span></span> <span data-ttu-id="f7371-112">Эта архитектура предназначена для работы с существующим репозиторием системы управления версиями.</span><span class="sxs-lookup"><span data-stu-id="f7371-112">The architecture is designed to work with an existing source control repository.</span></span> <span data-ttu-id="f7371-113">Например, для начала работы с заданиями Jenkins часто используются фиксации GitHub.</span><span class="sxs-lookup"><span data-stu-id="f7371-113">For example, a common scenario is to start Jenkins jobs based on GitHub commits.</span></span>

## <a name="architecture"></a><span data-ttu-id="f7371-114">Архитектура</span><span class="sxs-lookup"><span data-stu-id="f7371-114">Architecture</span></span>

<span data-ttu-id="f7371-115">Она состоит из следующих компонентов:</span><span class="sxs-lookup"><span data-stu-id="f7371-115">The architecture consists of the following components:</span></span>

-   <span data-ttu-id="f7371-116">**Группа ресурсов.**</span><span class="sxs-lookup"><span data-stu-id="f7371-116">**Resource group.**</span></span> <span data-ttu-id="f7371-117">[Группа ресурсов][rg] используется для объединения ресурсов Azure по времени существования, владельцу и другим критериям, а также для управления этими ресурсами.</span><span class="sxs-lookup"><span data-stu-id="f7371-117">A [resource group][rg] is used to group Azure assets so they can be managed by lifetime, owner, and other criteria.</span></span> <span data-ttu-id="f7371-118">Группы ресурсов позволяют развертывать и отслеживать несколько ресурсов Azure как одну группу, для которой, помимо прочего, можно отслеживать выставляемые счета.</span><span class="sxs-lookup"><span data-stu-id="f7371-118">Use resource groups to deploy and monitor Azure assets as a group and track billing costs by resource group.</span></span> <span data-ttu-id="f7371-119">Можно также удалить ресурсы в виде набора, что очень удобно для тестирования развернутых служб.</span><span class="sxs-lookup"><span data-stu-id="f7371-119">You can also delete resources as a set, which is very useful for test deployments.</span></span>

-   <span data-ttu-id="f7371-120">**Сервер Jenkins.**</span><span class="sxs-lookup"><span data-stu-id="f7371-120">**Jenkins server**.</span></span> <span data-ttu-id="f7371-121">Для запуска [Jenkins][azure-market] как сервера автоматизации, который выполняет роль главного сервера Jenkins, развертывается виртуальная машина.</span><span class="sxs-lookup"><span data-stu-id="f7371-121">A virtual machine is deployed to run [Jenkins][azure-market] as an automation server and serve as Jenkins Master.</span></span> <span data-ttu-id="f7371-122">В этой эталонной архитектуре используется [шаблон решения для Jenkins в Azure][solution], установленный на виртуальной машине Linux (Ubuntu 16.04 LTS) в Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-122">This reference architecture uses the [solution template for Jenkins on Azure][solution], installed on a Linux (Ubuntu 16.04 LTS) virtual machine on Azure.</span></span> <span data-ttu-id="f7371-123">Другие предложения Jenkins доступны в Azure Marketplace.</span><span class="sxs-lookup"><span data-stu-id="f7371-123">Other Jenkins offerings are available in the Azure Marketplace.</span></span>

    > [!NOTE]
    > <span data-ttu-id="f7371-124">Nginx устанавливается на виртуальной машине и выполняет роль обратного прокси-сервера для Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-124">Nginx is installed on the VM to act as a reverse proxy to Jenkins.</span></span> <span data-ttu-id="f7371-125">Сервер Nginx можно настроить, чтобы разрешить использование SSL на сервере Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-125">You can configure Nginx to enable SSL for the Jenkins server.</span></span>
    > 
    > 

-   <span data-ttu-id="f7371-126">**Виртуальная сеть**.</span><span class="sxs-lookup"><span data-stu-id="f7371-126">**Virtual network**.</span></span> <span data-ttu-id="f7371-127">[Виртуальная сеть][vnet] связывает ресурсы Azure между собой и обеспечивает логическую изоляцию.</span><span class="sxs-lookup"><span data-stu-id="f7371-127">A [virtual network][vnet] connects Azure resources to each other and provides logical isolation.</span></span> <span data-ttu-id="f7371-128">В этой архитектуре сервер Jenkins работает в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="f7371-128">In this architecture, the Jenkins server runs in a virtual network.</span></span>

-   <span data-ttu-id="f7371-129">**Подсети.**</span><span class="sxs-lookup"><span data-stu-id="f7371-129">**Subnets**.</span></span> <span data-ttu-id="f7371-130">Сервер Jenkins изолирован в [подсети][subnet]. Это упрощает управление сетевым трафиком и его разделение без ущерба для производительности.</span><span class="sxs-lookup"><span data-stu-id="f7371-130">The Jenkins server is isolated in a [subnet][subnet] to make it easier to manage and segregate network traffic without impacting performance.</span></span>

-   <span data-ttu-id="f7371-131">**Группы безопасности сети.**</span><span class="sxs-lookup"><span data-stu-id="f7371-131">**NSGs**.</span></span> <span data-ttu-id="f7371-132">С помощью [групп безопасности сети][nsg] (NSG) можно ограничить трафик, направляющийся из Интернета в подсеть виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="f7371-132">Use [network security groups][nsg] (NSGs) to restrict network traffic from the Internet to the subnet of a virtual network.</span></span>

-   <span data-ttu-id="f7371-133">**Управляемые диски.**</span><span class="sxs-lookup"><span data-stu-id="f7371-133">**Managed disks**.</span></span> <span data-ttu-id="f7371-134">[Управляемый диск][managed-disk] — это постоянный виртуальный жесткий диск (VHD), который обеспечивает хранение приложений, поддержание состояния сервера Jenkins и выполнение аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="f7371-134">A [managed disk][managed-disk] is a persistent virtual hard disk (VHD) used for application storage and also to maintain the state of the Jenkins server and provide disaster recovery.</span></span> <span data-ttu-id="f7371-135">Диски данных хранятся в хранилище Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-135">Data disks are stored in Azure Storage.</span></span> <span data-ttu-id="f7371-136">Для повышения производительности рекомендуем использовать [хранилище класса Premium][premium].</span><span class="sxs-lookup"><span data-stu-id="f7371-136">For high performance, [premium storage][premium] is recommended.</span></span>

-   <span data-ttu-id="f7371-137">**Хранилище BLOB-объектов Azure.**</span><span class="sxs-lookup"><span data-stu-id="f7371-137">**Azure Blob Storage**.</span></span> <span data-ttu-id="f7371-138">[Подключаемый модуль службы хранилища Azure][configure-storage] использует хранилище BLOB-объектов Azure для хранения артефактов сборки, которые создаются и совместно используются в других сборках Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-138">The [Windows Azure Storage plugin][configure-storage] uses Azure Blob  Storage to store the build artifacts that are created and shared with other Jenkins builds.</span></span>

-   <span data-ttu-id="f7371-139">**Azure Active Directory (Azure AD).**</span><span class="sxs-lookup"><span data-stu-id="f7371-139">**Azure Active Directory (Azure AD)**.</span></span> <span data-ttu-id="f7371-140">[Azure AD][azure-ad] поддерживает проверку подлинности пользователей, позволяя настроить единый вход.</span><span class="sxs-lookup"><span data-stu-id="f7371-140">[Azure AD][azure-ad] supports user authentication, allowing you to set up SSO.</span></span> <span data-ttu-id="f7371-141">[Субъекты-службы][service-principal] Azure AD определяют политику и разрешения для авторизации каждой роли в рабочем процессе с помощью [управления доступом на основе ролей][rbac] (RBAC).</span><span class="sxs-lookup"><span data-stu-id="f7371-141">Azure AD [service principals][service-principal] define the policy and permissions for each role authorization in the workflow via [role-based access control][rbac] (RBAC).</span></span> <span data-ttu-id="f7371-142">Каждый субъект-служба связан с заданием Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-142">Each service principal is associated with a Jenkins job.</span></span>

-   <span data-ttu-id="f7371-143">**Azure Key Vault.**</span><span class="sxs-lookup"><span data-stu-id="f7371-143">**Azure Key Vault.**</span></span> <span data-ttu-id="f7371-144">Для управления секретами и криптографическими ключами, используемыми для подготовки ресурсов Azure в случаях, когда требуется применять секреты, в этой архитектуре используется [Key Vault][key-vault].</span><span class="sxs-lookup"><span data-stu-id="f7371-144">To manage secrets and cryptographic keys used to provision Azure resources when secrets are required, this architecture uses [Key Vault][key-vault].</span></span> <span data-ttu-id="f7371-145">Дополнительные справочные сведения о хранении секретов, связанных с приложением в конвейере, см. также на странице подключаемого модуля для хранения [учетных данных Azure][configure-credential] в Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-145">For added help storing secrets associated with the application in the pipeline, see also the [Azure Credentials][configure-credential] plugin for Jenkins.</span></span>

-   <span data-ttu-id="f7371-146">**Службы мониторинга Azure.**</span><span class="sxs-lookup"><span data-stu-id="f7371-146">**Azure monitoring services**.</span></span> <span data-ttu-id="f7371-147">Эта служба обеспечивает [мониторинг][monitor] виртуальной машины Azure, на которой размещен сервер Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-147">This service [monitors][monitor] the Azure virtual machine hosting Jenkins.</span></span> <span data-ttu-id="f7371-148">Развернутая служба отслеживает состояние виртуальной машины и загрузку ЦП и отправляет соответствующие оповещения.</span><span class="sxs-lookup"><span data-stu-id="f7371-148">This deployment monitors the virtual machine status and CPU utilization and sends alerts.</span></span>

## <a name="recommendations"></a><span data-ttu-id="f7371-149">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="f7371-149">Recommendations</span></span>

<span data-ttu-id="f7371-150">Следующие рекомендации применимы для большинства ситуаций.</span><span class="sxs-lookup"><span data-stu-id="f7371-150">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="f7371-151">Следуйте этим рекомендациям, если они не противоречат особым требованиям для вашего случая.</span><span class="sxs-lookup"><span data-stu-id="f7371-151">Follow these recommendations unless you have a specific requirement that overrides them.</span></span>

### <a name="azure-ad"></a><span data-ttu-id="f7371-152">Azure AD</span><span class="sxs-lookup"><span data-stu-id="f7371-152">Azure AD</span></span>

<span data-ttu-id="f7371-153">Клиент [Azure AD][azure-ad] для подписки Azure обеспечивает единый вход для пользователей Jenkins и позволяет настроить [субъекты-службы][service-principal], которые предоставляют заданиям Jenkins доступ к ресурсам Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-153">The [Azure AD][azure-ad] tenant for your Azure subscription is used to enable SSO for Jenkins users and set up [service principals][service-principal] that enable Jenkins jobs to access Azure resources.</span></span>

<span data-ttu-id="f7371-154">Проверка подлинности и авторизация с использованием единого входа реализуются за счет подключаемого модуля Azure AD, установленного на сервере Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-154">SSO authentication and authorization are implemented by the Azure AD plugin  installed on the Jenkins server.</span></span> <span data-ttu-id="f7371-155">Технология единого входа позволяет проходить проверку подлинности, используя корпоративные учетные данные из Azure AD, при входе на сервер Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-155">SSO allows you to authenticate using your organization credentials from Azure AD when logging on to the Jenkins server.</span></span> <span data-ttu-id="f7371-156">При настройке подключаемого модуля Azure AD можно указать уровень авторизованного доступа к серверу Jenkins для того или иного пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7371-156">When configuring the Azure AD plugin, you can specify the level of a user’s authorized access to the Jenkin server.</span></span>

<span data-ttu-id="f7371-157">Чтобы обеспечить доступ к ресурсам Azure для заданий Jenkins, администратор Azure AD создает субъекты-службы.</span><span class="sxs-lookup"><span data-stu-id="f7371-157">To provide Jenkins jobs with access to Azure resources, an Azure AD administrator creates service principals.</span></span> <span data-ttu-id="f7371-158">Они предоставляют приложениям (в нашем случае это задания Jenkins) [доступ к ресурсам Azure с авторизацией и проверкой подлинности][ad-sp].</span><span class="sxs-lookup"><span data-stu-id="f7371-158">These grant applications—in this case, the Jenkins jobs—[authenticated, authorized access][ad-sp] to Azure resources.</span></span>

<span data-ttu-id="f7371-159">[RBAC][rbac] дополнительно определяет и контролирует доступ пользователей и субъектов-служб к ресурсам Azure согласно назначенным ролям.</span><span class="sxs-lookup"><span data-stu-id="f7371-159">[RBAC][rbac] further defines and controls access to Azure resources for users or service principals through their assigned role.</span></span> <span data-ttu-id="f7371-160">Поддерживаются как встроенные, так и пользовательские роли.</span><span class="sxs-lookup"><span data-stu-id="f7371-160">Both built-in and custom roles are supported.</span></span> <span data-ttu-id="f7371-161">Роли также помогают защитить конвейер и гарантируют правильное назначение и авторизацию обязанностей пользователя или агента.</span><span class="sxs-lookup"><span data-stu-id="f7371-161">Roles also help secure the pipeline and ensure that a user’s or agent’s responsibilities are assigned and authorized correctly.</span></span> <span data-ttu-id="f7371-162">Кроме того, RBAC можно настроить таким образом, чтобы ограничить доступ к ресурсам Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-162">In addition, RBAC can be set up to limit access to Azure assets.</span></span> <span data-ttu-id="f7371-163">Например, можно разрешить пользователю работать с ресурсами только в определенной группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f7371-163">For example, a user can be limited to working with only the assets in a particular resource group.</span></span>

### <a name="storage"></a><span data-ttu-id="f7371-164">Хранилище</span><span class="sxs-lookup"><span data-stu-id="f7371-164">Storage</span></span>

<span data-ttu-id="f7371-165">С помощью [подключаемого модуля службы хранилища Azure][storage-plugin] для Jenkins, установленного из Azure Marketplace, можно хранить артефакты сборки, чтобы использовать их в других сборках и тестах.</span><span class="sxs-lookup"><span data-stu-id="f7371-165">Use the Jenkins [Windows Azure Storage plugin][storage-plugin], which is installed from the Azure Marketplace, to store build artifacts that can be shared with other builds and tests.</span></span> <span data-ttu-id="f7371-166">Чтобы использовать этот подключаемый модуль для заданий Jenkins, сначала необходимо настроить учетную запись хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-166">An Azure Storage account must be configured before this plugin can be used by the Jenkins jobs.</span></span>

### <a name="jenkins-azure-plugins"></a><span data-ttu-id="f7371-167">Подключаемые модули Azure для Jenkins</span><span class="sxs-lookup"><span data-stu-id="f7371-167">Jenkins Azure plugins</span></span>

<span data-ttu-id="f7371-168">Шаблон решения для Jenkins в Azure устанавливает несколько подключаемых модулей Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-168">The solution template for Jenkins on Azure installs several Azure plugins.</span></span> <span data-ttu-id="f7371-169">Группа разработчиков DevOps Azure создает и обслуживает шаблон решения и указанные ниже подключаемые модули, которые могут работать с другими предложениями Jenkins в Azure Marketplace, а также с любым главным сервером Jenkins, настроенным в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="f7371-169">The Azure DevOps Team builds and maintains the solution template and the following plugins, which work with other Jenkins offerings in Azure Marketplace as well as any Jenkins master set up on premises:</span></span>

-   <span data-ttu-id="f7371-170">[Подключаемый модуль Azure AD][configure-azure-ad] обеспечивает поддержку единого входа на сервере Jenkins для пользователей Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f7371-170">[Azure AD plugin][configure-azure-ad] allows the Jenkins server to support SSO for users based on Azure AD.</span></span>

-   <span data-ttu-id="f7371-171">Подключаемый модуль [агентов виртуальных машин Azure][configure-agent] создает агенты Jenkins на виртуальных машинах Azure с помощью шаблона Azure Resource Manager (ARM).</span><span class="sxs-lookup"><span data-stu-id="f7371-171">[Azure VM Agents][configure-agent] plugin uses an Azure Resource Manager (ARM) template to create Jenkins agents in Azure virtual machines.</span></span>

-   <span data-ttu-id="f7371-172">Подключаемый модуль [учетных данных Azure][configure-credential] позволяет хранить учетные данные субъекта-службы Azure в Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-172">[Azure Credentials][configure-credential] plugin allows you to store Azure service principal credentials in Jenkins.</span></span>

-   <span data-ttu-id="f7371-173">[Подключаемый модуль службы хранилища Azure][configure-storage] отправляет артефакты сборки в [хранилище BLOB-объектов Azure][blob] или скачивает из него зависимости сборки.</span><span class="sxs-lookup"><span data-stu-id="f7371-173">[Windows Azure Storage plugin][configure-storage] uploads build artifacts to, or downloads build dependencies from, [Azure Blob storage][blob].</span></span>

<span data-ttu-id="f7371-174">Также рекомендуем просмотреть постоянно пополняющийся список всех доступных подключаемых модулей Azure, работающих с ресурсами Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-174">We also recommend reviewing the growing list of all available Azure plugins that work with Azure resources.</span></span> <span data-ttu-id="f7371-175">Чтобы просмотреть последнюю версию всего списка, перейдите на страницу [индекса подключаемых модулей Jenkins][index] и выполните поиск по термину "Azure".</span><span class="sxs-lookup"><span data-stu-id="f7371-175">To see all the latest list, visit [Jenkins Plugin Index][index] and search for Azure.</span></span> <span data-ttu-id="f7371-176">Например, для развертывания доступны следующие подключаемые модули:</span><span class="sxs-lookup"><span data-stu-id="f7371-176">For example, the following plugins are available for deployment:</span></span>

-   <span data-ttu-id="f7371-177">Подключаемый модуль [агентов контейнеров Azure][container-agents] позволяет запускать контейнер в качестве агента в Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-177">[Azure Container Agents][container-agents] helps you to run a container as an agent in Jenkins.</span></span>

-   <span data-ttu-id="f7371-178">Подключаемый модуль [непрерывного развертывания Kubernetes](https://aka.ms/azjenkinsk8s) развертывает конфигурации ресурсов в кластере Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="f7371-178">[Kubernetes Continuous Deploy](https://aka.ms/azjenkinsk8s) deploys resource configurations to a Kubernetes cluster.</span></span>

-   <span data-ttu-id="f7371-179">Подключаемый модуль [службы контейнеров Azure][acs] развертывает конфигурации в Службе контейнеров Azure с помощью Kubernetes, в DC/OS с помощью Marathon или Docker Swarm.</span><span class="sxs-lookup"><span data-stu-id="f7371-179">[Azure Container Service][acs] deploys configurations to Azure Container Service with Kubernetes, DC/OS with Marathon, or Docker Swarm.</span></span>

-   <span data-ttu-id="f7371-180">Подключаемый модуль [службы "Функций Azure"][functions] развертывает проект в функции Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-180">[Azure Functions][functions] deploys your project to Azure Function.</span></span>

-   <span data-ttu-id="f7371-181">Подключаемый модуль [службы приложений Azure][app-service] выполняет развертывание в службе приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-181">[Azure App Service][app-service] deploys to Azure App Service.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="f7371-182">Вопросы масштабируемости</span><span class="sxs-lookup"><span data-stu-id="f7371-182">Scalability considerations</span></span>

<span data-ttu-id="f7371-183">Для поддержки очень больших рабочих нагрузок предусмотрено масштабирование Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-183">Jenkins can scale to support very large workloads.</span></span> <span data-ttu-id="f7371-184">Эластичные сборки не следует запускать на главном сервере Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-184">For elastic builds, do not run builds on the Jenkins master server.</span></span> <span data-ttu-id="f7371-185">Вместо этого перенесите задачи сборки на агенты Jenkins, которые можно масштабировать при необходимости.</span><span class="sxs-lookup"><span data-stu-id="f7371-185">Instead, offload build tasks to Jenkins agents, which can be elastically scaled in and out as need.</span></span> <span data-ttu-id="f7371-186">Есть два варианта масштабирования агентов.</span><span class="sxs-lookup"><span data-stu-id="f7371-186">Consider two options for scaling agents:</span></span>

- <span data-ttu-id="f7371-187">Использование подключаемого модуля [агентов виртуальных машин Azure][vm-agent] для создания агентов Jenkins, работающих на виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-187">Use the [Azure VM Agents][vm-agent] plugin to create Jenkins agents that run in Azure VMs.</span></span> <span data-ttu-id="f7371-188">Этот подключаемый модуль обеспечивает гибкое горизонтальное масштабирование агентов, в котором могут быть задействованы различные типы виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="f7371-188">This plugin enables elastic scale-out for agents and can use distinct types of virtual machines.</span></span> <span data-ttu-id="f7371-189">Вы можете выбрать другой базовый образ в Azure Marketplace или применить пользовательский образ.</span><span class="sxs-lookup"><span data-stu-id="f7371-189">You can select a different base image from Azure Marketplace or use a custom image.</span></span> <span data-ttu-id="f7371-190">Дополнительные сведения о масштабировании агентов Jenkins см. в разделе документации Jenkins, посвященном [архитектуре с возможностью масштабирования][scale].</span><span class="sxs-lookup"><span data-stu-id="f7371-190">For details about how the Jenkins agents scale, see [Architecting for Scale][scale] in the Jenkins documentation.</span></span>

- <span data-ttu-id="f7371-191">Использование подключаемого модуля [агентов контейнеров Azure][container-agents] для запуска контейнера в качестве агента в [Службе контейнеров Azure с помощью Kubernetes](/azure/container-service/kubernetes/) или в службе [Экземпляры контейнеров Azure](/azure/container-instances/).</span><span class="sxs-lookup"><span data-stu-id="f7371-191">Use the [Azure Container Agents][container-agents] plugin to run a container as an agent in either [Azure Container Service with Kubernetes](/azure/container-service/kubernetes/), or [Azure Container Instances](/azure/container-instances/).</span></span>

<span data-ttu-id="f7371-192">Масштабирование виртуальных машин обычно дороже, чем масштабирование контейнеров.</span><span class="sxs-lookup"><span data-stu-id="f7371-192">Virtual machines generally cost more to scale than containers.</span></span> <span data-ttu-id="f7371-193">Но если для масштабирования нужно использовать контейнеры, их нужно применять и в процессе сборки.</span><span class="sxs-lookup"><span data-stu-id="f7371-193">To use containers for scaling, however, your build process must run with containers.</span></span>

<span data-ttu-id="f7371-194">Кроме того, в службе хранилища Azure можно предоставлять общий доступ к артефактам сборки, которые могут использовать другие агенты сборки на следующем этапе конвейера.</span><span class="sxs-lookup"><span data-stu-id="f7371-194">Also, use Azure Storage to share build artifacts that may be used in the next stage of the pipeline by other build agents.</span></span>

### <a name="scaling-the-jenkins-server"></a><span data-ttu-id="f7371-195">Масштабирование сервера Jenkins</span><span class="sxs-lookup"><span data-stu-id="f7371-195">Scaling the Jenkins server</span></span> 

<span data-ttu-id="f7371-196">Размер виртуальной машины с сервером Jenkins можно увеличивать и уменьшать (масштабировать).</span><span class="sxs-lookup"><span data-stu-id="f7371-196">You can scale the Jenkins server VM up or down by changing the VM size.</span></span> <span data-ttu-id="f7371-197">В [шаблоне решения для Jenkins в Azure][azure-market] по умолчанию указан размер DS2 v2 (с двумя процессорами и 7 ГБ памяти).</span><span class="sxs-lookup"><span data-stu-id="f7371-197">The [solution template for Jenkins on Azure][azure-market] specifies the DS2 v2 size (with two CPUs, 7 GB) by default.</span></span> <span data-ttu-id="f7371-198">Этот размер подходит для небольших и средних рабочих нагрузок команды сотрудников.</span><span class="sxs-lookup"><span data-stu-id="f7371-198">This size handles a small to medium team workload.</span></span> <span data-ttu-id="f7371-199">Размер виртуальной машины можно изменить, выбрав другой вариант при сборке сервера.</span><span class="sxs-lookup"><span data-stu-id="f7371-199">Change the VM size by choosing a different option when building out the server.</span></span> 

<span data-ttu-id="f7371-200">Выбор правильного размера сервера зависит от объема ожидаемой рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f7371-200">Selecting the correct server size depends on the size of the expected workload.</span></span> <span data-ttu-id="f7371-201">Сообщество Jenkins составило и обновляет [руководство по выбору размера][selection-guide], которое поможет определить конфигурацию, максимально соответствующую вашим требованиям.</span><span class="sxs-lookup"><span data-stu-id="f7371-201">The Jenkins community maintains a [selection guide][selection-guide] to help identify the configuration that best meets your requirements.</span></span> <span data-ttu-id="f7371-202">В Azure доступны разные [размеры виртуальных машин Linux][sizes-linux], подходящие для любых требований.</span><span class="sxs-lookup"><span data-stu-id="f7371-202">Azure offers many [sizes for Linux VMs][sizes-linux] to meet any requirements.</span></span> <span data-ttu-id="f7371-203">Дополнительные сведения о масштабировании главного сервера Jenkins см. в [рекомендациях][best-practices] сообщества Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-203">For more information about scaling the Jenkins master, refer to the Jenkins community of [best practices][best-practices], which also includes details about scaling Jenkins master.</span></span>


## <a name="availability-considerations"></a><span data-ttu-id="f7371-204">Вопросы доступности</span><span class="sxs-lookup"><span data-stu-id="f7371-204">Availability considerations</span></span>

<span data-ttu-id="f7371-205">Оцените требования к доступности для своего рабочего процесса и продумайте, как восстановить состояние Jenkins, если главный сервер выйдет из строя.</span><span class="sxs-lookup"><span data-stu-id="f7371-205">Assess the availability requirements for your workflow and how to recover the Jenkin state should the Jenkin server goes down.</span></span> <span data-ttu-id="f7371-206">Для оценки требований к доступности рекомендуем использовать две общие метрики:</span><span class="sxs-lookup"><span data-stu-id="f7371-206">To assess your availability requirements, consider two common metrics:</span></span>

-   <span data-ttu-id="f7371-207">Целевое время восстановления (RTO) указывает, как долго вы сможете обходиться без сервера Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-207">Recovery Time Objective (RTO) specifies how long you can go without Jenkins.</span></span>

-   <span data-ttu-id="f7371-208">Целевая точка восстановления (RPO) указывает, какой объем данных допустимо потерять, если нарушение работы служб повлияет на функционирование сервера Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-208">Recovery Point Objective (RPO) indicates how much data you can afford to lose if a disruption in service affects Jenkins.</span></span>

<span data-ttu-id="f7371-209">На практике под терминами RTO и RPO подразумеваются избыточность и резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="f7371-209">In practice, RTO and RPO imply redundancy and backup.</span></span> <span data-ttu-id="f7371-210">Доступность означает не восстановление оборудования — оно относится к платформе Azure, — а поддержание состояния сервера Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-210">Availability is not a question of hardware recovery—that is part of Azure—but rather ensuring you maintain the state of your Jenkins server.</span></span> <span data-ttu-id="f7371-211">В этой эталонной архитектуре применяется [Соглашение об уровне обслуживания Azure][sla] (SLA), которое гарантирует 99,9 % времени непрерывной работы для отдельно взятой виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="f7371-211">This reference architecture uses the [Azure service level agreement][sla] (SLA), which guarantees 99.9-percent uptime for a single virtual machine.</span></span> <span data-ttu-id="f7371-212">Если это соглашение не соответствует вашим требованиям ко времени непрерывной работы, разработайте план аварийного восстановления или выполните развертывание [с несколькими главными серверами Jenkins][multi-master] (не рассматривается в этом документе).</span><span class="sxs-lookup"><span data-stu-id="f7371-212">If this SLA doesn't meet your uptime requirements, make sure you have a plan for disaster recovery, or consider using a [multi-master Jenkins server][multi-master] deployment (not covered in this document).</span></span>

<span data-ttu-id="f7371-213">На седьмом шаге развертывания рекомендуем воспользоваться [скриптами][disaster] аварийного восстановления, чтобы создать учетную запись хранения Azure с управляемыми дисками для сохранения состояния сервера Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-213">Consider using the disaster recovery [scripts][disaster] in step 7 of the deployment to create an Azure Storage account with managed disks to store the Jenkins server state.</span></span> <span data-ttu-id="f7371-214">Если сервер Jenkins выйдет из строя, его можно будет восстановить до состояния, сохраненного в этой отдельной учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="f7371-214">If Jenkins goes down, it can be restored to the state stored in this separate storage account.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="f7371-215">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="f7371-215">Security considerations</span></span>

<span data-ttu-id="f7371-216">Используйте описанные ниже методы для обеспечения безопасности главного сервера Jenkins, так как в своем первоначальном состоянии он не является защищенным.</span><span class="sxs-lookup"><span data-stu-id="f7371-216">Use the following approaches to help lock down security on a basic Jenkins server, since in its basic state, it is not secure.</span></span>

-   <span data-ttu-id="f7371-217">Настройте безопасный вход на сервер Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-217">Set up a way to secure logon to the Jenkin server.</span></span> <span data-ttu-id="f7371-218">Протокол HTTP не является безопасным по умолчанию. В этой архитектуре используется HTTP и общедоступный IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="f7371-218">HTTP is not secure By default, this architecture uses HTTP and has a public IP.</span></span> <span data-ttu-id="f7371-219">Рекомендуем настроить [HTTPS на сервере Nginx][nginx] для безопасного входа.</span><span class="sxs-lookup"><span data-stu-id="f7371-219">Consider setting up [HTTPS on the Nginx server][nginx] being used for a secure logon.</span></span>

    > [!NOTE]
    > <span data-ttu-id="f7371-220">При добавлении протокола SSL на сервер создайте правило NSG для подсети Jenkins, чтобы открыть порт 443.</span><span class="sxs-lookup"><span data-stu-id="f7371-220">When adding SSL to your server, create an NSG rule for the Jenkins subnet to open port 443.</span></span> <span data-ttu-id="f7371-221">Дополнительные сведения см. в статье [Как открыть порты для виртуальной машины Windows с помощью портала Azure][port443].</span><span class="sxs-lookup"><span data-stu-id="f7371-221">For more information, see [How to open ports to a virtual machine with the Azure portal][port443].</span></span>
    > 

-   <span data-ttu-id="f7371-222">Конфигурация Jenkins должна запрещать подделку межсайтовых запросов (Manage Jenkins \> Configure Global Security (Управление Jenkins > Настройка глобальной безопасности)).</span><span class="sxs-lookup"><span data-stu-id="f7371-222">Ensure that the Jenkins configuration prevents cross site request forgery (Manage Jenkins \> Configure Global Security).</span></span> <span data-ttu-id="f7371-223">Это значение по умолчанию для сервера Microsoft Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-223">This is the default for Microsoft Jenkins Server.</span></span>

-   <span data-ttu-id="f7371-224">Настройте доступ только для чтения к информационной панели Jenkins с помощью [подключаемого модуля стратегии авторизации матрицы][matrix].</span><span class="sxs-lookup"><span data-stu-id="f7371-224">Configure read-only access to the Jenkins dashboard by using the [Matrix Authorization Strategy Plugin][matrix].</span></span>

-   <span data-ttu-id="f7371-225">Установите подключаемый модуль [учетных данных Azure][configure-credential], чтобы с помощью Key Vault управлять секретами для ресурсов Azure, агентов в конвейере и компонентов сторонних разработчиков.</span><span class="sxs-lookup"><span data-stu-id="f7371-225">Install the [Azure Credentials][configure-credential] plugin to use Key Vault to handle secrets for the Azure assets, the agents in the pipeline, and third-party components.</span></span>

-   <span data-ttu-id="f7371-226">Создайте профиль безопасности, который определяет ресурсы, необходимые пользователям, службам и агентам конвейеров для выполнения заданий (но не более того).</span><span class="sxs-lookup"><span data-stu-id="f7371-226">Create a security profile that defines the resources required by users, services, and pipeline agents to do their jobs—but no more.</span></span> <span data-ttu-id="f7371-227">Этот шаг становится критически важным при настройке параметров безопасности.</span><span class="sxs-lookup"><span data-stu-id="f7371-227">This step becomes critical when considering your security settings.</span></span>

<span data-ttu-id="f7371-228">Заданиям Jenkins часто требуются секреты для доступа к службам Azure с обязательной авторизацией (например, к Службе контейнеров Azure).</span><span class="sxs-lookup"><span data-stu-id="f7371-228">Jenkins jobs often require secrets to access Azure services that require authorization, such as Azure Container Service.</span></span> <span data-ttu-id="f7371-229">Для безопасного управления этими секретами используйте [Key Vault][key-vault] совместно с [подключаемым модулем учетных данных Azure ][configure-credential].</span><span class="sxs-lookup"><span data-stu-id="f7371-229">Use [Key Vault][key-vault] along with the [Azure Credential plugin][configure-credential] to manage these secrets securely.</span></span> <span data-ttu-id="f7371-230">В Key Vault можно хранить учетные данные, пароли, маркеры и другие секретные данные субъектов-служб.</span><span class="sxs-lookup"><span data-stu-id="f7371-230">Use Key Vault to store service principal credentials, passwords, tokens, and other secrets.</span></span>

<span data-ttu-id="f7371-231">Благодаря [центру безопасности Azure][security-center] можно получить полное представление о состоянии безопасности ваших ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-231">To get a central view of the security state of your Azure resources, use [Azure Security Center][security-center].</span></span> <span data-ttu-id="f7371-232">Центр безопасности отслеживает потенциальные проблемы безопасности, а также обеспечивает полное представление о состоянии системы безопасности развертывания.</span><span class="sxs-lookup"><span data-stu-id="f7371-232">Security Center monitors potential security issues and provides a comprehensive picture of the security health of your deployment.</span></span> <span data-ttu-id="f7371-233">Центр безопасности настраивается на уровне подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-233">Security Center is configured per Azure subscription.</span></span> <span data-ttu-id="f7371-234">Включите сбор данных о безопасности, как описано в [кратком руководстве по использованию центра безопасности Azure][quick-start].</span><span class="sxs-lookup"><span data-stu-id="f7371-234">Enable security data collection as described in the [Azure Security Center quick start guide][quick-start].</span></span> <span data-ttu-id="f7371-235">Когда сбор данных включен, центр безопасности автоматически проверяет все виртуальные машины, созданные для этой подписки.</span><span class="sxs-lookup"><span data-stu-id="f7371-235">When data collection is enabled, Security Center automatically scans any virtual machines created under that subscription.</span></span>

<span data-ttu-id="f7371-236">Сервер Jenkins оснащен собственной системой управления пользователями, а участники сообщества Jenkins разработали рекомендации по [защите экземпляра Jenkins в Azure][secure-jenkins].</span><span class="sxs-lookup"><span data-stu-id="f7371-236">The Jenkins server has its own user management system, and the Jenkins community provides best practices for [securing a Jenkins instance on Azure][secure-jenkins].</span></span> <span data-ttu-id="f7371-237">Эти рекомендации реализованы в шаблоне решения для Jenkins в Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-237">The solution template for Jenkins on Azure implements these best practices.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="f7371-238">Вопросы управляемости</span><span class="sxs-lookup"><span data-stu-id="f7371-238">Manageability considerations</span></span>

<span data-ttu-id="f7371-239">Развернутые ресурсы Azure можно упорядочить с помощью групп ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f7371-239">Use resource groups to organize the Azure resources that are deployed.</span></span> <span data-ttu-id="f7371-240">Развертывайте рабочие среды и среды разработки и тестирования в отдельных группах. Это позволит отслеживать ресурсы в каждой среде и оплачивать счета отдельно для каждой группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f7371-240">Deploy production environments and development/test environments in separate resource groups, so that you can monitor each environment’s resources and roll up billing costs by resource group.</span></span> <span data-ttu-id="f7371-241">Можно также удалить ресурсы в виде набора, что очень удобно для тестирования развернутых служб.</span><span class="sxs-lookup"><span data-stu-id="f7371-241">You can also delete resources as a set, which is very useful for test deployments.</span></span>

<span data-ttu-id="f7371-242">Azure предоставляет несколько функций для [мониторинга и диагностики][monitoring-diag] во всей инфраструктуре.</span><span class="sxs-lookup"><span data-stu-id="f7371-242">Azure provides several features for [monitoring and diagnostics][monitoring-diag] of the overall infrastructure.</span></span> <span data-ttu-id="f7371-243">Для наблюдения за загрузкой ЦП в этой архитектуре развернута служба Azure Monitor.</span><span class="sxs-lookup"><span data-stu-id="f7371-243">To monitor CPU usage, this architecture deploys Azure Monitor.</span></span> <span data-ttu-id="f7371-244">С ее помощью, например, можно отслеживать загрузку ЦП и настроить отправку уведомлений в случае, если этот показатель превысит 80 %.</span><span class="sxs-lookup"><span data-stu-id="f7371-244">For example, you can use Azure Monitor to monitor CPU utilization, and send a notification if CPU usage exceeds 80 percent.</span></span> <span data-ttu-id="f7371-245">(Высокая загрузка ЦП указывает на то, что может потребоваться масштабирование виртуальной машины с сервером Jenkins.) Также можно уведомить указанного пользователя в случае неисправности или недоступности виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="f7371-245">(High CPU usage indicates that you might want to scale up the Jenkins server VM.) You can also notify a designated user if the VM fails or becomes unavailable.</span></span>

## <a name="communities"></a><span data-ttu-id="f7371-246">Сообщества</span><span class="sxs-lookup"><span data-stu-id="f7371-246">Communities</span></span>

<span data-ttu-id="f7371-247">Участники сообществ отвечают на вопросы и помогают настроить успешное развертывание.</span><span class="sxs-lookup"><span data-stu-id="f7371-247">Communities can answer questions and help you set up a successful deployment.</span></span> <span data-ttu-id="f7371-248">Рассмотрим следующее:</span><span class="sxs-lookup"><span data-stu-id="f7371-248">Consider the following:</span></span>

-   <span data-ttu-id="f7371-249">[блог сообщества Jenkins](https://jenkins.io/node/);</span><span class="sxs-lookup"><span data-stu-id="f7371-249">[Jenkins Community Blog](https://jenkins.io/node/)</span></span>
-   <span data-ttu-id="f7371-250">[форум Azure](https://azure.microsoft.com/support/forums/);</span><span class="sxs-lookup"><span data-stu-id="f7371-250">[Azure Forum](https://azure.microsoft.com/support/forums/)</span></span>
-   <span data-ttu-id="f7371-251">[раздел, посвященный Jenkins, на сайте Stack Overflow](https://stackoverflow.com/tags/jenkins/info).</span><span class="sxs-lookup"><span data-stu-id="f7371-251">[Stack Overflow Jenkins](https://stackoverflow.com/tags/jenkins/info)</span></span>

<span data-ttu-id="f7371-252">Дополнительные советы и рекомендации от сообщества Jenkins см. [здесь][jenkins-best].</span><span class="sxs-lookup"><span data-stu-id="f7371-252">For more best practices from the Jenkins community, visit [Jenkins best practices][jenkins-best].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="f7371-253">Развертывание решения</span><span class="sxs-lookup"><span data-stu-id="f7371-253">Deploy the solution</span></span>

<span data-ttu-id="f7371-254">Для развертывания этой архитектуры выполните следующие действия, чтобы установить [шаблон решения для Jenkins в Azure][azure-market]. Затем установите скрипты для настройки мониторинга и аварийного восстановления, как описано далее.</span><span class="sxs-lookup"><span data-stu-id="f7371-254">To deploy this architecture, follow the steps below to install the [solution template for Jenkins on Azure][azure-market], then install the scripts that set up monitoring and disaster recovery in the steps below.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="f7371-255">предварительным требованиям</span><span class="sxs-lookup"><span data-stu-id="f7371-255">Prerequisites</span></span>

- <span data-ttu-id="f7371-256">Для этой эталонной архитектуры требуется подписка Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-256">This reference architecture requires an Azure subscription.</span></span> 
- <span data-ttu-id="f7371-257">Для создания субъекта-службы Azure необходимы права администратора для клиента Azure AD, связанного с развернутым сервером Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-257">To create an Azure service principal, you must have admin rights to the Azure AD tenant that is associated with the deployed Jenkins server.</span></span>
- <span data-ttu-id="f7371-258">В этих инструкциях предполагается, что администратор Jenkins является также пользователем Azure по меньшей мере с правами участника.</span><span class="sxs-lookup"><span data-stu-id="f7371-258">These instructions assume that the Jenkins administrator is also an Azure user with at least Contributor privileges.</span></span>

### <a name="step-1-deploy-the-jenkins-server"></a><span data-ttu-id="f7371-259">Шаг 1. Развертывание сервера Jenkins</span><span class="sxs-lookup"><span data-stu-id="f7371-259">Step 1: Deploy the Jenkins server</span></span>

1.  <span data-ttu-id="f7371-260">Откройте [образ Azure Marketplace для Jenkins][azure-market] в браузере и нажмите кнопку **ПОЛУЧИТЬ** в левой части страницы.</span><span class="sxs-lookup"><span data-stu-id="f7371-260">Open the [Azure marketplace image for Jenkins][azure-market] in your web browser and select **GET IT NOW** from the left side of the page.</span></span>

2.  <span data-ttu-id="f7371-261">Просмотрите сведения о ценах и выберите **Продолжить**, а затем нажмите **Создание**, чтобы настроить сервер Jenkins на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-261">Review the pricing details and select **Continue**, then select **Create** to configure the Jenkins server in the Azure portal.</span></span>

<span data-ttu-id="f7371-262">Подробные инструкции см. в статье [Создание сервера Jenkins на виртуальной машине Azure под управлением Linux на портале Azure][create-jenkins].</span><span class="sxs-lookup"><span data-stu-id="f7371-262">For detailed instructions, see [Create a Jenkins server on an Azure Linux VM from the Azure portal][create-jenkins].</span></span> <span data-ttu-id="f7371-263">Для этой архитектуры достаточно запустить сервер от имени администратора.</span><span class="sxs-lookup"><span data-stu-id="f7371-263">For this reference architecture, it is sufficient to get the server up and running with the admin logon.</span></span> <span data-ttu-id="f7371-264">Затем можно подготовить его для использования других служб.</span><span class="sxs-lookup"><span data-stu-id="f7371-264">Then you can provision it to use various other services.</span></span>

### <a name="step-2-set-up-sso"></a><span data-ttu-id="f7371-265">Шаг 2. Настройка единого входа</span><span class="sxs-lookup"><span data-stu-id="f7371-265">Step 2: Set up SSO</span></span>

<span data-ttu-id="f7371-266">Этот шаг выполняет администратор Jenkins, который также должен иметь учетную запись пользователя в каталоге подписки Azure AD. Кроме того, ему должна быть назначена роль участника.</span><span class="sxs-lookup"><span data-stu-id="f7371-266">The step is run by the Jenkins administrator, who must also have a user account in the subscription’s Azure AD directory and must be assigned the Contributor role.</span></span>

<span data-ttu-id="f7371-267">Используйте [подключаемый модуль Azure AD][configure-azure-ad] из центра обновления Jenkins на сервере Jenkins и следуйте инструкциям по настройке единого входа.</span><span class="sxs-lookup"><span data-stu-id="f7371-267">Use the [Azure AD Plugin][configure-azure-ad] from the Jenkins Update Center in the Jenkin server and follow the instructions to set up SSO.</span></span>

### <a name="step-3-provision-jenkins-server-with-azure-vm-agent-plugin"></a><span data-ttu-id="f7371-268">Шаг 3. Подготовка сервера Jenkins с помощью подключаемого модуля агента виртуальной машины Azure</span><span class="sxs-lookup"><span data-stu-id="f7371-268">Step 3: Provision Jenkins server with Azure VM Agent plugin</span></span>

<span data-ttu-id="f7371-269">Этот шаг выполняет администратор Jenkins, который настраивает уже установленный подключаемый модуль агента виртуальной машины Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-269">The step is run by the Jenkins administrator to set up the Azure VM Agent plugin, which is already installed.</span></span>

<span data-ttu-id="f7371-270">[Чтобы настроить подключаемый модуль, выполните эти действия][configure-agent].</span><span class="sxs-lookup"><span data-stu-id="f7371-270">[Follow these steps to configure the plugin][configure-agent].</span></span> <span data-ttu-id="f7371-271">Сведения о настройке субъектов-служб для использования с подключаемым модулем см. в статье [Масштабирование развертываний Jenkins в соответствии с требованиями агентов виртуальных машин Azure][scale-agent].</span><span class="sxs-lookup"><span data-stu-id="f7371-271">For a tutorial about setting up service principals for the plugin, see [Scale your  Jenkins deployments to meet demand with Azure VM agents][scale-agent].</span></span>

### <a name="step-4-provision-jenkins-server-with-azure-storage"></a><span data-ttu-id="f7371-272">Шаг 4. Подготовка сервера Jenkins с помощью службы хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="f7371-272">Step 4: Provision Jenkins server with Azure Storage</span></span>

<span data-ttu-id="f7371-273">Этот шаг выполняет администратор Jenkins, который настраивает установленный подключаемый модуль.</span><span class="sxs-lookup"><span data-stu-id="f7371-273">The step is run by the Jenkins administrator, who sets up the Windows Azure Storage Plugin, which is already installed.</span></span>

<span data-ttu-id="f7371-274">[Чтобы настроить подключаемый модуль, выполните эти действия][configure-storage].</span><span class="sxs-lookup"><span data-stu-id="f7371-274">[Follow these steps to configure the plugin][configure-storage].</span></span>

### <a name="step-5-provision-jenkins-server-with-azure-credential-plugin"></a><span data-ttu-id="f7371-275">Шаг 5. Подготовка сервера Jenkins с помощью подключаемого модуля учетных данных Azure</span><span class="sxs-lookup"><span data-stu-id="f7371-275">Step 5: Provision Jenkins server with Azure Credential plugin</span></span>

<span data-ttu-id="f7371-276">Этот шаг выполняет администратор Jenkins, который настраивает уже установленный подключаемый модуль учетных данных Azure.</span><span class="sxs-lookup"><span data-stu-id="f7371-276">The step is run by the Jenkins administrator to set up the Azure Credential plugin, which is already installed.</span></span>

<span data-ttu-id="f7371-277">[Чтобы настроить подключаемый модуль, выполните эти действия][configure-credential].</span><span class="sxs-lookup"><span data-stu-id="f7371-277">[Follow these steps to configure the plugin][configure-credential].</span></span>

### <a name="step-6-provision-jenkins-server-for-monitoring-by-the-azure-monitor-service"></a><span data-ttu-id="f7371-278">Шаг 6. Подготовка сервера Jenkins для наблюдения с помощью Azure Monitor</span><span class="sxs-lookup"><span data-stu-id="f7371-278">Step 6: Provision Jenkins server for monitoring by the Azure Monitor Service</span></span>

<span data-ttu-id="f7371-279">Чтобы настроить мониторинг для сервера Jenkins, следуйте инструкциям из статьи [Создание оповещений метрик в Azure Monitor для служб Azure с помощью портала Azure][create-metric].</span><span class="sxs-lookup"><span data-stu-id="f7371-279">To set up monitoring for your Jenkins server, follow the instructions in [Create metric alerts in Azure Monitor for Azure services][create-metric].</span></span>

### <a name="step-7-provision-jenkins-server-with-managed-disks-for-disaster-recovery"></a><span data-ttu-id="f7371-280">Шаг 7. Подготовка сервера Jenkins с помощью управляемых дисков для аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="f7371-280">Step 7: Provision Jenkins server with Managed Disks for disaster recovery</span></span>

<span data-ttu-id="f7371-281">Группа продукта Microsoft Jenkins разработала скрипты аварийного восстановления, с помощью которых можно создать управляемый диск для сохранения состояния Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f7371-281">The Microsoft Jenkins product group has created disaster recovery scripts that build a managed disk used to save the Jenkins state.</span></span> <span data-ttu-id="f7371-282">Если сервер выйдет из строя, можно будет восстановить его последнее состояние.</span><span class="sxs-lookup"><span data-stu-id="f7371-282">If the server goes down, it can be restored to its latest state.</span></span>

<span data-ttu-id="f7371-283">Скачайте и запустите скрипты аварийного восстановления из [GitHub][disaster].</span><span class="sxs-lookup"><span data-stu-id="f7371-283">Download and run the disaster recovery scripts from [GitHub][disaster].</span></span>

[acs]: https://aka.ms/azjenkinsacs
[ad-sp]: /azure/active-directory/develop/active-directory-integrating-applications
[app-service]: https://plugins.jenkins.io/azure-app-service
[azure-ad]: /azure/active-directory/
[azure-market]: https://azuremarketplace.microsoft.com/marketplace/apps/azure-oss.jenkins?tab=Overview
[best-practices]: https://jenkins.io/doc/book/architecting-for-scale/
[blob]: /azure/storage/common/storage-java-jenkins-continuous-integration-solution
[configure-azure-ad]: https://plugins.jenkins.io/azure-ad
[configure-agent]: https://plugins.jenkins.io/azure-vm-agents
[configure-credential]: https://plugins.jenkins.io/azure-credentials
[configure-storage]: https://plugins.jenkins.io/windows-azure-storage
[container-agents]: https://aka.ms/azcontaineragent
[create-jenkins]: /azure/jenkins/install-jenkins-solution-template
[create-metric]: /azure/monitoring-and-diagnostics/insights-alerts-portal
[disaster]: https://github.com/Azure/jenkins/tree/master/disaster_recovery
[functions]: https://aka.ms/azjenkinsfunctions
[index]: https://plugins.jenkins.io
[jenkins-best]: https://wiki.jenkins.io/display/JENKINS/Jenkins+Best+Practices
[jenkins-on-azure]: /azure/jenkins/
[key-vault]: /azure/key-vault/
[managed-disk]: /azure/virtual-machines/linux/managed-disks-overview
[matrix]: https://plugins.jenkins.io/matrix-auth
[monitor]: /azure/monitoring-and-diagnostics/
[monitoring-diag]: /azure/architecture/best-practices/monitoring
[multi-master]: https://jenkins.io/doc/book/architecting-for-scale/
[nginx]: https://www.digitalocean.com/community/tutorials/how-to-create-an-ssl-certificate-on-nginx-for-ubuntu-14-04
[nsg]: /azure/virtual-network/virtual-networks-nsg
[quick-start]: /azure/security-center/security-center-get-started
[port443]: /azure/virtual-machines/windows/nsg-quickstart-portal
[premium]: /azure/virtual-machines/linux/premium-storage
[rbac]: /azure/active-directory/role-based-access-control-what-is
[rg]: /azure/azure-resource-manager/resource-group-overview
[scale]: https://jenkins.io/doc/book/architecting-for-scale/
[scale-agent]: /azure/jenkins/jenkins-azure-vm-agents
[selection-guide]: https://jenkins.io/doc/book/hardware-recommendations/
[service-principal]: /azure/active-directory/develop/active-directory-application-objects
[secure-jenkins]: https://jenkins.io/blog/2017/04/20/secure-jenkins-on-azure/
[security-center]: /azure/security-center/security-center-intro
[sizes-linux]: /azure/virtual-machines/linux/sizes?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json
[solution]: https://azure.microsoft.com/blog/announcing-the-solution-template-for-jenkins-on-azure/
[sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines/
[storage-plugin]: https://wiki.jenkins.io/display/JENKINS/Windows+Azure+Storage+Plugin
[subnet]: /azure/virtual-network/virtual-network-manage-subnet
[vm-agent]: https://wiki.jenkins.io/display/JENKINS/Azure+VM+Agents+plugin
[vnet]: /azure/virtual-network/virtual-networks-overview
[0]: ./images/jenkins-server.png 
