---
title: Запуск виртуальной машины Windows в Azure
titleSuffix: Azure Reference Architectures
description: Рекомендации по запуску виртуальных машин Windows в Azure.
author: telmosampaio
ms.date: 09/13/2018
ms.openlocfilehash: 9a6725bfebf468cc3ce7e9ba618d30c30b7d6046
ms.sourcegitcommit: 88a68c7e9b6b772172b7faa4b9fd9c061a9f7e9d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/08/2018
ms.locfileid: "53120039"
---
# <a name="run-a-windows-virtual-machine-on-azure"></a><span data-ttu-id="8f0db-103">Запуск виртуальной машины Windows в Azure</span><span class="sxs-lookup"><span data-stu-id="8f0db-103">Run a Windows virtual machine on Azure</span></span>

<span data-ttu-id="8f0db-104">В этой статье приведены проверенные способы запуска виртуальных машин Windows в Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-104">This article shows proven practices for running a Windows virtual machine (VM) on Azure.</span></span> <span data-ttu-id="8f0db-105">Она содержит рекомендации для подготовки виртуальной машины, а также компоненты хранилища и сетевые компоненты.</span><span class="sxs-lookup"><span data-stu-id="8f0db-105">It includes recommendations for provisioning the VM along with networking and storage components.</span></span> <span data-ttu-id="8f0db-106">[**Разверните это решение**](#deploy-the-solution).</span><span class="sxs-lookup"><span data-stu-id="8f0db-106">[**Deploy this solution**](#deploy-the-solution).</span></span>

![Архитектура с одной виртуальной машиной Windows в Azure](./images/single-vm-diagram.png)

## <a name="components"></a><span data-ttu-id="8f0db-108">Компоненты</span><span class="sxs-lookup"><span data-stu-id="8f0db-108">Components</span></span>

<span data-ttu-id="8f0db-109">Для подготовки виртуальной машины Azure требуются некоторые дополнительные компоненты, помимо самой виртуальной машины, такие как сеть и хранилище.</span><span class="sxs-lookup"><span data-stu-id="8f0db-109">Provisioning an Azure VM requires some additional components besides the VM itself, including networking and storage resources.</span></span>

- <span data-ttu-id="8f0db-110">**Группа ресурсов**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-110">**Resource group**.</span></span> <span data-ttu-id="8f0db-111">[Группа ресурсов][resource-manager-overview] представляет собой логический контейнер, содержащий связанные ресурсы Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-111">A [resource group][resource-manager-overview] is a logical container that holds related Azure resources.</span></span> <span data-ttu-id="8f0db-112">Как правило, группы ресурсов создаются в зависимости от времени существования ресурсов и пользователя, который ими управляет.</span><span class="sxs-lookup"><span data-stu-id="8f0db-112">In general, group resources based on their lifetime and who will manage them.</span></span>

- <span data-ttu-id="8f0db-113">**Виртуальная машина**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-113">**VM**.</span></span> <span data-ttu-id="8f0db-114">Виртуальную машину можно подготовить на основе списка опубликованных образов, пользовательского управляемого образа или файла виртуального жесткого диска (VHD), передав его в хранилище BLOB-объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-114">You can provision a VM from a list of published images, or from a custom managed image or virtual hard disk (VHD) file uploaded to Azure Blob storage.</span></span>

- <span data-ttu-id="8f0db-115">**Управляемые диски.**</span><span class="sxs-lookup"><span data-stu-id="8f0db-115">**Managed Disks**.</span></span> <span data-ttu-id="8f0db-116">Служба [Управляемые диски Azure][managed-disks] упрощает управление дисками благодаря автоматической обработке хранилища.</span><span class="sxs-lookup"><span data-stu-id="8f0db-116">[Azure Managed Disks][managed-disks] simplify disk management by handling the storage for you.</span></span> <span data-ttu-id="8f0db-117">Диск операционной системы — это диск VHD, расположенный в [службе хранилища Azure][azure-storage], поэтому он работает, даже если хост-компьютер отключен.</span><span class="sxs-lookup"><span data-stu-id="8f0db-117">The OS disk is a VHD stored in [Azure Storage][azure-storage], so it persists even when the host machine is down.</span></span> <span data-ttu-id="8f0db-118">Кроме того, рекомендуем создать один или несколько [дисков данных][data-disk] на постоянных виртуальных жестких дисках, которые используются для данных приложений.</span><span class="sxs-lookup"><span data-stu-id="8f0db-118">We also recommend creating one or more [data disks][data-disk], which are persistent VHDs used for application data.</span></span>

- <span data-ttu-id="8f0db-119">**Временный диск**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-119">**Temporary disk**.</span></span> <span data-ttu-id="8f0db-120">Виртуальная машина создается с временным диском (в Windows это диск `D:`).</span><span class="sxs-lookup"><span data-stu-id="8f0db-120">The VM is created with a temporary disk (the `D:` drive on Windows).</span></span> <span data-ttu-id="8f0db-121">Временный диск хранится на физическом диске хост-компьютера.</span><span class="sxs-lookup"><span data-stu-id="8f0db-121">This disk is stored on a physical drive on the host machine.</span></span> <span data-ttu-id="8f0db-122">Он *не* хранится в службе хранилища Azure и может быть удален во время перезагрузки и других событий жизненного цикла виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="8f0db-122">It is *not* saved in Azure Storage and may be deleted during reboots and other VM lifecycle events.</span></span> <span data-ttu-id="8f0db-123">Используйте этот диск только для временных данных, таких как данные страниц или файлы подкачки.</span><span class="sxs-lookup"><span data-stu-id="8f0db-123">Use this disk only for temporary data, such as page or swap files.</span></span>

- <span data-ttu-id="8f0db-124">**Виртуальная сеть**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-124">**Virtual network (VNet)**.</span></span> <span data-ttu-id="8f0db-125">Каждая виртуальная машина Azure развертывается в виртуальной сети, которую можно разделить на несколько подсетей.</span><span class="sxs-lookup"><span data-stu-id="8f0db-125">Every Azure VM is deployed into a VNet that can be segmented into multiple subnets.</span></span>

- <span data-ttu-id="8f0db-126">**Сетевой интерфейс (сетевой адаптер)**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-126">**Network interface (NIC)**.</span></span> <span data-ttu-id="8f0db-127">Сетевой адаптер обеспечивает взаимодействие виртуальной машины и виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="8f0db-127">The NIC enables the VM to communicate with the virtual network.</span></span>

- <span data-ttu-id="8f0db-128">**Общедоступный IP-адрес.**</span><span class="sxs-lookup"><span data-stu-id="8f0db-128">**Public IP address**.</span></span> <span data-ttu-id="8f0db-129">Общедоступный IP-адрес используется для обмена данными с виртуальной машиной&mdash;. Например, через удаленный рабочий стол.</span><span class="sxs-lookup"><span data-stu-id="8f0db-129">A public IP address is needed to communicate with the VM &mdash; for example, via remote desktop (RDP).</span></span>

- <span data-ttu-id="8f0db-130">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-130">**Azure DNS**.</span></span> <span data-ttu-id="8f0db-131">[Azure DNS][azure-dns] — это служба размещения для доменов DNS, которая предоставляет разрешение имен с помощью инфраструктуры Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-131">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="8f0db-132">Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, API и инструментов и оплачивать использование, как и другие службы Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-132">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>

- <span data-ttu-id="8f0db-133">**Группа безопасности сети**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-133">**Network security group (NSG)**.</span></span> <span data-ttu-id="8f0db-134">[Группы безопасности сети][nsg] позволяют разрешать или запрещать сетевой трафик к виртуальным машинам.</span><span class="sxs-lookup"><span data-stu-id="8f0db-134">[Network security groups][nsg] are used to allow or deny network traffic to VMs.</span></span> <span data-ttu-id="8f0db-135">Группы безопасности сети могут быть связаны с подсетями или отдельными экземплярами виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="8f0db-135">NSGs can be associated either with subnets or with individual VM instances.</span></span>

- <span data-ttu-id="8f0db-136">**Диагностика.**</span><span class="sxs-lookup"><span data-stu-id="8f0db-136">**Diagnostics**.</span></span> <span data-ttu-id="8f0db-137"> Ведение журналов диагностики очень важно для устранения неполадок виртуальной машины и управления ею.</span><span class="sxs-lookup"><span data-stu-id="8f0db-137">Diagnostic logging is crucial for managing and troubleshooting the VM.</span></span>

## <a name="vm-recommendations"></a><span data-ttu-id="8f0db-138">Рекомендации по виртуальным машинам</span><span class="sxs-lookup"><span data-stu-id="8f0db-138">VM recommendations</span></span>

<span data-ttu-id="8f0db-139">В Azure доступны виртуальные машины разных размеров.</span><span class="sxs-lookup"><span data-stu-id="8f0db-139">Azure offers many different virtual machine sizes.</span></span> <span data-ttu-id="8f0db-140">Дополнительные сведения см. в статье [Размеры виртуальных машин Windows в Azure][virtual-machine-sizes].</span><span class="sxs-lookup"><span data-stu-id="8f0db-140">For more information, see [Sizes for virtual machines in Azure][virtual-machine-sizes].</span></span> <span data-ttu-id="8f0db-141">При перемещении имеющейся рабочей нагрузки в Azure выберите начальный размер виртуальной машины, который точнее всего соответствует характеристикам локальных серверов.</span><span class="sxs-lookup"><span data-stu-id="8f0db-141">If you are moving an existing workload to Azure, start with the VM size that's the closest match to your on-premises servers.</span></span> <span data-ttu-id="8f0db-142">Затем измерьте производительность фактической рабочей нагрузки по таким показателям, как потребление ЦП, памяти и дисковых операций ввода-вывода в секунду, и при необходимости измените размер виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="8f0db-142">Then measure the performance of your actual workload with respect to CPU, memory, and disk input/output operations per second (IOPS), and adjust the size as needed.</span></span> <span data-ttu-id="8f0db-143">Если для виртуальной машины требуется несколько сетевых адаптеров, помните, что их максимально возможное число зависит от [размера каждой виртуальной машины][vm-size-tables].</span><span class="sxs-lookup"><span data-stu-id="8f0db-143">If you require multiple NICs for your VM, be aware that a maximum number of NICs is defined for each [VM size][vm-size-tables].</span></span>

<span data-ttu-id="8f0db-144">Обычно следует выбирать регион Azure, расположенный как можно ближе к внутренним пользователям или клиентам.</span><span class="sxs-lookup"><span data-stu-id="8f0db-144">Generally, choose an Azure region that is closest to your internal users or customers.</span></span> <span data-ttu-id="8f0db-145">Но виртуальные машины некоторых размеров доступны не во всех регионах.</span><span class="sxs-lookup"><span data-stu-id="8f0db-145">However, not all VM sizes are available in all regions.</span></span> <span data-ttu-id="8f0db-146">См. дополнительные сведения о [доступности служб в разных регионах][services-by-region].</span><span class="sxs-lookup"><span data-stu-id="8f0db-146">For more information, see [Services by region][services-by-region].</span></span> <span data-ttu-id="8f0db-147">Чтобы получить список размеров виртуальных машин, доступных в определенном регионе, выполните следующую команду в интерфейсе командной строки Azure:</span><span class="sxs-lookup"><span data-stu-id="8f0db-147">For a list of the VM sizes available in a specific region, run the following command from the Azure command-line interface (CLI):</span></span>

```azurecli
az vm list-sizes --location <location>
```

<span data-ttu-id="8f0db-148">Дополнительные сведения о том, как выбрать опубликованный образ виртуальной машины, см. в руководстве по [поиску образов виртуальных машин Windows][select-vm-image].</span><span class="sxs-lookup"><span data-stu-id="8f0db-148">For information about choosing a published VM image, see [Find Windows VM images][select-vm-image].</span></span>

<span data-ttu-id="8f0db-149">Включите мониторинг и диагностику, в том числе базовые метрики работоспособности, а также ведение журналов инфраструктуры диагностики и [диагностику загрузки][boot-diagnostics].</span><span class="sxs-lookup"><span data-stu-id="8f0db-149">Enable monitoring and diagnostics, including basic health metrics, diagnostics infrastructure logs, and [boot diagnostics][boot-diagnostics].</span></span> <span data-ttu-id="8f0db-150">Если виртуальную машину невозможно загрузить, для обнаружения неисправностей можно использовать диагностику загрузки.</span><span class="sxs-lookup"><span data-stu-id="8f0db-150">Boot diagnostics can help you diagnose boot failure if your VM gets into a non-bootable state.</span></span> <span data-ttu-id="8f0db-151">Дополнительные сведения см. в статье [Включение мониторинга и диагностики][enable-monitoring].</span><span class="sxs-lookup"><span data-stu-id="8f0db-151">For more information, see [Enable monitoring and diagnostics][enable-monitoring].</span></span>

## <a name="disk-and-storage-recommendations"></a><span data-ttu-id="8f0db-152">Рекомендации по дискам и хранилищам</span><span class="sxs-lookup"><span data-stu-id="8f0db-152">Disk and storage recommendations</span></span>

<span data-ttu-id="8f0db-153">Чтобы обеспечить оптимальную производительность дисковых операций ввода-вывода, рекомендуем использовать [хранилище класса Premium][premium-storage], в котором данные хранятся на твердотельных накопителях (SSD).</span><span class="sxs-lookup"><span data-stu-id="8f0db-153">For best disk I/O performance, we recommend [Premium Storage][premium-storage], which stores data on solid-state drives (SSDs).</span></span> <span data-ttu-id="8f0db-154">Цена зависит от производительности подготовленного диска.</span><span class="sxs-lookup"><span data-stu-id="8f0db-154">Cost is based on the capacity of the provisioned disk.</span></span> <span data-ttu-id="8f0db-155">Скорость выполнения операций ввода-вывода и пропускная способность (т. е. скорость передачи данных) также зависят от размера диска. Поэтому во время подготовки диска следует учитывать все эти факторы.</span><span class="sxs-lookup"><span data-stu-id="8f0db-155">IOPS and throughput (that is, data transfer rate) also depend on disk size, so when you provision a disk, consider all three factors (capacity, IOPS, and throughput).</span></span>

<span data-ttu-id="8f0db-156">Мы также рекомендуем использовать [Управляемые диски][managed-disks].</span><span class="sxs-lookup"><span data-stu-id="8f0db-156">We also recommend using [Managed Disks][managed-disks].</span></span> <span data-ttu-id="8f0db-157">Управляемым дискам не требуется учетная запись хранения.</span><span class="sxs-lookup"><span data-stu-id="8f0db-157">Managed disks do not require a storage account.</span></span> <span data-ttu-id="8f0db-158">Просто укажите размер и тип диска, и он будет развернут как высокодоступный ресурс.</span><span class="sxs-lookup"><span data-stu-id="8f0db-158">You simply specify the size and type of disk and it is deployed as a highly available resource.</span></span>

<span data-ttu-id="8f0db-159">Добавьте один или несколько дисков данных.</span><span class="sxs-lookup"><span data-stu-id="8f0db-159">Add one or more data disks.</span></span> <span data-ttu-id="8f0db-160">Создаваемый диск VHD не форматируется.</span><span class="sxs-lookup"><span data-stu-id="8f0db-160">When you create a VHD, it is unformatted.</span></span> <span data-ttu-id="8f0db-161">Чтобы отформатировать диск, войдите в систему виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="8f0db-161">Log into the VM to format the disk.</span></span> <span data-ttu-id="8f0db-162">Если это возможно, устанавливайте приложения на диск данных, а не на диск операционной системы.</span><span class="sxs-lookup"><span data-stu-id="8f0db-162">When possible, install applications on a data disk, not the OS disk.</span></span> <span data-ttu-id="8f0db-163">Для работы некоторых устаревших приложений может потребоваться установить компоненты на диске С. В этом случае вы можете [изменить размер диска ОС][resize-os-disk], используя PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8f0db-163">Some legacy applications might need to install components on the C: drive; in that case, you can [resize the OS disk][resize-os-disk] using PowerShell.</span></span>

<span data-ttu-id="8f0db-164">Создайте учетную запись хранения для хранения журналов диагностики.</span><span class="sxs-lookup"><span data-stu-id="8f0db-164">Create a storage account to hold diagnostic logs.</span></span> <span data-ttu-id="8f0db-165">Учетной записи локально избыточного хранилища достаточно для хранения журналов диагностики.</span><span class="sxs-lookup"><span data-stu-id="8f0db-165">A standard locally redundant storage (LRS) account is sufficient for diagnostic logs.</span></span>

> [!NOTE]
> <span data-ttu-id="8f0db-166">Если вы не используете Управляемые диски, создайте отдельные учетные записи хранения Azure для виртуальных жестких дисков (VHD) каждой виртуальной машины, чтобы не превышать [ограничения по операциям ввода-вывода][vm-disk-limits] для учетных записей хранения.</span><span class="sxs-lookup"><span data-stu-id="8f0db-166">If you aren't using Managed Disks, create separate Azure storage accounts for each VM to hold the virtual hard disks (VHDs), in order to avoid hitting the [(IOPS) limits][vm-disk-limits] for storage accounts.</span></span> <span data-ttu-id="8f0db-167">Учтите общие ограничения на количество операций ввода-вывода для учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="8f0db-167">Be aware of the total I/O limits of the storage account.</span></span> <span data-ttu-id="8f0db-168">Дополнительные сведения см. в разделе [Ограничения для дисков виртуальной машины][vm-disk-limits].</span><span class="sxs-lookup"><span data-stu-id="8f0db-168">For more information, see [virtual machine disk limits][vm-disk-limits].</span></span>

## <a name="network-recommendations"></a><span data-ttu-id="8f0db-169">Рекомендации по сети</span><span class="sxs-lookup"><span data-stu-id="8f0db-169">Network recommendations</span></span>

<span data-ttu-id="8f0db-170">Общедоступный IP-адрес может быть динамическим или статическим.</span><span class="sxs-lookup"><span data-stu-id="8f0db-170">The public IP address can be dynamic or static.</span></span> <span data-ttu-id="8f0db-171">По умолчанию используется динамический IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="8f0db-171">The default is dynamic.</span></span>

- <span data-ttu-id="8f0db-172">Зарезервируйте [статический IP-адрес][static-ip], если вам нужен постоянный IP-адрес, например, для создания записи типа А в DNS или добавления IP-адреса в список надежных адресов.</span><span class="sxs-lookup"><span data-stu-id="8f0db-172">Reserve a [static IP address][static-ip] if you need a fixed IP address that won't change &mdash; for example, if you need to create a DNS 'A' record or add the IP address to a safe list.</span></span>
- <span data-ttu-id="8f0db-173">Можно также создать полное доменное имя для IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="8f0db-173">You can also create a fully qualified domain name (FQDN) for the IP address.</span></span> <span data-ttu-id="8f0db-174">Затем вы сможете зарегистрировать в DNS [запись CNAME][cname-record], которая указывает на полное доменное имя.</span><span class="sxs-lookup"><span data-stu-id="8f0db-174">You can then register a [CNAME record][cname-record] in DNS that points to the FQDN.</span></span> <span data-ttu-id="8f0db-175">Дополнительные сведения см. в руководстве по [созданию полного доменного имени на портале Azure][fqdn].</span><span class="sxs-lookup"><span data-stu-id="8f0db-175">For more information, see [Create a fully qualified domain name in the Azure portal][fqdn].</span></span>

<span data-ttu-id="8f0db-176">Все группы безопасности сети содержат набор [правил по умолчанию][nsg-default-rules], включая правило, которое блокирует весь входящий интернет-трафик.</span><span class="sxs-lookup"><span data-stu-id="8f0db-176">All NSGs contain a set of [default rules][nsg-default-rules], including a rule that blocks all inbound Internet traffic.</span></span> <span data-ttu-id="8f0db-177">Правила по умолчанию нельзя удалить, но их можно переопределить другими правилами.</span><span class="sxs-lookup"><span data-stu-id="8f0db-177">The default rules cannot be deleted, but other rules can override them.</span></span> <span data-ttu-id="8f0db-178">Чтобы разрешить интернет-трафик, создайте правила, разрешающие входящий трафик для определенных портов &mdash; например, это может быть порт 80 для протокола HTTP.</span><span class="sxs-lookup"><span data-stu-id="8f0db-178">To enable Internet traffic, create rules that allow inbound traffic to specific ports &mdash; for example, port 80 for HTTP.</span></span>

<span data-ttu-id="8f0db-179">Чтобы включить доступ по протоколу RDP, добавьте правило группы безопасности сети, которое разрешает входящий трафик через TCP-порт 3389.</span><span class="sxs-lookup"><span data-stu-id="8f0db-179">To enable RDP, add an NSG rule that allows inbound traffic to TCP port 3389.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="8f0db-180">Вопросы масштабируемости</span><span class="sxs-lookup"><span data-stu-id="8f0db-180">Scalability considerations</span></span>

<span data-ttu-id="8f0db-181">Размер виртуальной машины можно [увеличивать и уменьшать][vm-resize].</span><span class="sxs-lookup"><span data-stu-id="8f0db-181">You can scale a VM up or down by [changing the VM size][vm-resize].</span></span> <span data-ttu-id="8f0db-182">Для горизонтального развертывания разместите две или больше виртуальных машин за подсистемой балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="8f0db-182">To scale out horizontally, put two or more VMs behind a load balancer.</span></span> <span data-ttu-id="8f0db-183">Дополнительные сведения см. в руководстве по [эталонной архитектуре n-уровневых приложений](./n-tier-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="8f0db-183">For more information, see the [N-tier reference architecture](./n-tier-sql-server.md).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="8f0db-184">Вопросы доступности</span><span class="sxs-lookup"><span data-stu-id="8f0db-184">Availability considerations</span></span>

<span data-ttu-id="8f0db-185">Для повышения уровня доступности разверните несколько виртуальных машин в группе доступности.</span><span class="sxs-lookup"><span data-stu-id="8f0db-185">For higher availability, deploy multiple VMs in an availability set.</span></span> <span data-ttu-id="8f0db-186">Это также позволит использовать дополнительные услуги в рамках [соглашения об уровне обслуживания][vm-sla].</span><span class="sxs-lookup"><span data-stu-id="8f0db-186">This also provides a higher [service level agreement (SLA)][vm-sla].</span></span>

<span data-ttu-id="8f0db-187">На виртуальную машину могут влиять процедуры [планового][planned-maintenance] и [внепланового технического обслуживания][manage-vm-availability].</span><span class="sxs-lookup"><span data-stu-id="8f0db-187">Your VM may be affected by [planned maintenance][planned-maintenance] or [unplanned maintenance][manage-vm-availability].</span></span> <span data-ttu-id="8f0db-188">Чтобы определить, вызвана ли перезагрузка плановым техническим обслуживанием, изучите [журналы перезагрузки виртуальной машины][reboot-logs].</span><span class="sxs-lookup"><span data-stu-id="8f0db-188">You can use [VM reboot logs][reboot-logs] to determine whether a VM reboot was caused by planned maintenance.</span></span>

<span data-ttu-id="8f0db-189">Чтобы избежать случайной потери данных во время обычной работы (например, из-за ошибки пользователя), следует реализовать создание резервных копий на определенный момент времени с помощью [моментальных снимков больших двоичных объектов][blob-snapshot] или других инструментов.</span><span class="sxs-lookup"><span data-stu-id="8f0db-189">To protect against accidental data loss during normal operations (for example, because of user error), you should also implement point-in-time backups, using [blob snapshots][blob-snapshot] or another tool.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="8f0db-190">Вопросы управляемости</span><span class="sxs-lookup"><span data-stu-id="8f0db-190">Manageability considerations</span></span>

<span data-ttu-id="8f0db-191">**Группы ресурсов.**</span><span class="sxs-lookup"><span data-stu-id="8f0db-191">**Resource groups**.</span></span> <span data-ttu-id="8f0db-192">Поместите тесно связанные ресурсы с одинаковым жизненным циклом в одну [группу ресурсов][resource-manager-overview].</span><span class="sxs-lookup"><span data-stu-id="8f0db-192">Put closely associated resources that share the same lifecycle into the same [resource group][resource-manager-overview].</span></span> <span data-ttu-id="8f0db-193">Группы ресурсов позволяют развертывать и отслеживать несколько ресурсов как одну группу, для которой, помимо прочего, можно отслеживать выставляемые счета.</span><span class="sxs-lookup"><span data-stu-id="8f0db-193">Resource groups allow you to deploy and monitor resources as a group and track billing costs by resource group.</span></span> <span data-ttu-id="8f0db-194">Можно также удалить ресурсы в виде набора, что очень удобно для тестирования развернутых служб.</span><span class="sxs-lookup"><span data-stu-id="8f0db-194">You can also delete resources as a set, which is very useful for test deployments.</span></span> <span data-ttu-id="8f0db-195">Присвойте понятные имена ресурсам, чтобы упростить поиск определенного ресурса и получить сведения о его роли.</span><span class="sxs-lookup"><span data-stu-id="8f0db-195">Assign meaningful resource names to simplify locating a specific resource and understanding its role.</span></span> <span data-ttu-id="8f0db-196">Дополнительные сведения см. в руководстве по [рекомендуемым соглашениям об именовании ресурсов Azure][naming-conventions].</span><span class="sxs-lookup"><span data-stu-id="8f0db-196">For more information, see [Recommended Naming Conventions for Azure Resources][naming-conventions].</span></span>

<span data-ttu-id="8f0db-197">**Остановка виртуальной машины.**</span><span class="sxs-lookup"><span data-stu-id="8f0db-197">**Stopping a VM**.</span></span> <span data-ttu-id="8f0db-198">Azure различает состояния "Остановлена" и "Освобождена".</span><span class="sxs-lookup"><span data-stu-id="8f0db-198">Azure makes a distinction between "stopped" and "deallocated" states.</span></span> <span data-ttu-id="8f0db-199">Вы оплачиваете использование остановленных виртуальных машин, но не оплачиваете освобожденные виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="8f0db-199">You are charged when the VM status is stopped, but not when the VM is deallocated.</span></span> <span data-ttu-id="8f0db-200">Также это можно сделать с помощью кнопки **Прервать** на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-200">In the Azure portal, the **Stop** button deallocates the VM.</span></span> <span data-ttu-id="8f0db-201">Если вы войдете в виртуальную машину и завершите работу операционной системы, виртуальная машина будет остановлена, а **не** освобождена, поэтому с вас по-прежнему будет взиматься плата.</span><span class="sxs-lookup"><span data-stu-id="8f0db-201">If you shut down through the OS while logged in, the VM is stopped but **not** deallocated, so you will still be charged.</span></span>

<span data-ttu-id="8f0db-202">**Удаление виртуальной машины**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-202">**Deleting a VM**.</span></span> <span data-ttu-id="8f0db-203"> Если вы удалите виртуальную машину, виртуальные жесткие диски останутся.</span><span class="sxs-lookup"><span data-stu-id="8f0db-203">If you delete a VM, the VHDs are not deleted.</span></span> <span data-ttu-id="8f0db-204">Это означает, что вы можете удалить виртуальную машину без потери данных.</span><span class="sxs-lookup"><span data-stu-id="8f0db-204">That means you can safely delete the VM without losing data.</span></span> <span data-ttu-id="8f0db-205">Тем не менее плата за хранение по-прежнему будет взиматься.</span><span class="sxs-lookup"><span data-stu-id="8f0db-205">However, you will still be charged for storage.</span></span> <span data-ttu-id="8f0db-206">Чтобы удалить виртуальный жесткий диск, удалите соответствующий файл из [хранилища BLOB-объектов][blob-storage].</span><span class="sxs-lookup"><span data-stu-id="8f0db-206">To delete the VHD, delete the file from [Blob storage][blob-storage].</span></span> <span data-ttu-id="8f0db-207">Чтобы предотвратить случайное удаление, используйте [блокировку ресурсов][resource-lock]. Так вы сможете заблокировать всю группу или отдельные ресурсы (например, виртуальную машину).</span><span class="sxs-lookup"><span data-stu-id="8f0db-207">To prevent accidental deletion, use a [resource lock][resource-lock] to lock the entire resource group or lock individual resources, such as a VM.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="8f0db-208">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="8f0db-208">Security considerations</span></span>

<span data-ttu-id="8f0db-209">Благодаря [центру безопасности Azure][security-center] можно получить полное представление о состоянии безопасности ваших ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-209">Use [Azure Security Center][security-center] to get a central view of the security state of your Azure resources.</span></span> <span data-ttu-id="8f0db-210">Центр безопасности отслеживает потенциальные проблемы безопасности, а также обеспечивает полное представление о состоянии системы безопасности развертывания.</span><span class="sxs-lookup"><span data-stu-id="8f0db-210">Security Center monitors potential security issues and provides a comprehensive picture of the security health of your deployment.</span></span> <span data-ttu-id="8f0db-211">Центр безопасности настраивается на уровне подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-211">Security Center is configured per Azure subscription.</span></span> <span data-ttu-id="8f0db-212">Включите сбор данных о безопасности, как описано в [кратком руководстве по использованию центра безопасности Azure][security-center-get-started].</span><span class="sxs-lookup"><span data-stu-id="8f0db-212">Enable security data collection as described in the [Azure Security Center quick start guide][security-center-get-started].</span></span> <span data-ttu-id="8f0db-213">Когда сбор данных включен, центр безопасности автоматически проверяет все виртуальные машины, созданные для этой подписки.</span><span class="sxs-lookup"><span data-stu-id="8f0db-213">When data collection is enabled, Security Center automatically scans any VMs created under that subscription.</span></span>

<span data-ttu-id="8f0db-214">**Управление исправлениями**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-214">**Patch management**.</span></span> <span data-ttu-id="8f0db-215">Если эта функция включена, центр безопасности проверяет наличие необходимых обновлений для системы безопасности и критических обновлений.</span><span class="sxs-lookup"><span data-stu-id="8f0db-215">If enabled, Security Center checks whether any security and critical updates are missing.</span></span> <span data-ttu-id="8f0db-216">Установите для виртуальной машины [параметры групповой политики][group-policy], разрешающие автоматическое обновление системы.</span><span class="sxs-lookup"><span data-stu-id="8f0db-216">Use [Group Policy settings][group-policy] on the VM to enable automatic system updates.</span></span>

<span data-ttu-id="8f0db-217">**Антивредоносная программа**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-217">**Antimalware**.</span></span> <span data-ttu-id="8f0db-218"> Если эта функция включена, то Центр безопасности проверяет, установлена ли антивредоносное ПО.</span><span class="sxs-lookup"><span data-stu-id="8f0db-218">If enabled, Security Center checks whether antimalware software is installed.</span></span> <span data-ttu-id="8f0db-219">Центр безопасности позволяет также установить антивредоносное ПО с помощью портала Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-219">You can also use Security Center to install antimalware software from inside the Azure portal.</span></span>

<span data-ttu-id="8f0db-220">**Эксплуатация**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-220">**Operations**.</span></span> <span data-ttu-id="8f0db-221">Используйте [управление доступом на основе ролей (RBAC)][rbac] для управления доступом к развертываемым ресурсам Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-221">Use [role-based access control (RBAC)][rbac] to control access to the Azure resources that you deploy.</span></span> <span data-ttu-id="8f0db-222">RBAC позволяет назначить роли авторизации участникам команды DevOps.</span><span class="sxs-lookup"><span data-stu-id="8f0db-222">RBAC lets you assign authorization roles to members of your DevOps team.</span></span> <span data-ttu-id="8f0db-223">Например, роль "Читатель" позволяет просматривать ресурсы Azure, но не позволяет создавать и удалять их или управлять ими.</span><span class="sxs-lookup"><span data-stu-id="8f0db-223">For example, the Reader role can view Azure resources but not create, manage, or delete them.</span></span> <span data-ttu-id="8f0db-224">Некоторые роли относятся к определенным типам ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-224">Some roles are specific to particular Azure resource types.</span></span> <span data-ttu-id="8f0db-225">Например, роль "Участник виртуальных машин" позволяет перезапустить виртуальную машину или отменить ее выделение, сбросить пароль администратора, создать новую виртуальную машину и т. д.</span><span class="sxs-lookup"><span data-stu-id="8f0db-225">For example, the Virtual Machine Contributor role can restart or deallocate a VM, reset the administrator password, create a new VM, and so on.</span></span> <span data-ttu-id="8f0db-226">Для этой архитектуры могут оказаться полезными и другие [встроенные роли RBAC][rbac-roles], например [Пользователь DevTest Labs][rbac-devtest] и [Участник сетей][rbac-network].</span><span class="sxs-lookup"><span data-stu-id="8f0db-226">Other [built-in RBAC roles][rbac-roles] that may be useful for this architecture include [DevTest Labs User][rbac-devtest] and [Network Contributor][rbac-network].</span></span> <span data-ttu-id="8f0db-227">Пользователю можно назначить несколько ролей. Можно также создать пользовательские роли, чтобы более детально настроить разрешения.</span><span class="sxs-lookup"><span data-stu-id="8f0db-227">A user can be assigned to multiple roles, and you can create custom roles for even more fine-grained permissions.</span></span>

> [!NOTE]
> <span data-ttu-id="8f0db-228">RBAC не ограничивает действия, которые может выполнять пользователь, вошедший в виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="8f0db-228">RBAC does not limit the actions that a user logged into a VM can perform.</span></span> <span data-ttu-id="8f0db-229">Эти разрешения определяются типом учетной записи в гостевой ОС.</span><span class="sxs-lookup"><span data-stu-id="8f0db-229">Those permissions are determined by the account type on the guest OS.</span></span>

<span data-ttu-id="8f0db-230">Просматривать действия по подготовке и другие события для виртуальной машины можно с помощью [журналов аудита][audit-logs].</span><span class="sxs-lookup"><span data-stu-id="8f0db-230">Use [audit logs][audit-logs] to see provisioning actions and other VM events.</span></span>

<span data-ttu-id="8f0db-231">**Шифрование данных**.</span><span class="sxs-lookup"><span data-stu-id="8f0db-231">**Data encryption**.</span></span> <span data-ttu-id="8f0db-232">Если нужно шифровать диски ОС и диски данных, рекомендуем применить [шифрование дисков Azure][disk-encryption].</span><span class="sxs-lookup"><span data-stu-id="8f0db-232">Consider [Azure Disk Encryption][disk-encryption] if you need to encrypt the OS and data disks.</span></span>

<span data-ttu-id="8f0db-233">**Защита от атак DDoS.**</span><span class="sxs-lookup"><span data-stu-id="8f0db-233">**DDoS protection**.</span></span> <span data-ttu-id="8f0db-234">Рекомендуем включить [Защиту от атак DDoS ценовой категории "Стандартный"](/azure/virtual-network/ddos-protection-overview), которая предоставляет дополнительные средства устранения атак DDoS для ресурсов в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="8f0db-234">We recommend enabling [DDoS Protection Standard](/azure/virtual-network/ddos-protection-overview), which provides additional DDoS mitigation for resources in a VNet.</span></span> <span data-ttu-id="8f0db-235">На платформе Azure автоматически включается Защита от атак DDoS ценовой категории "Базовый". Но мы советуем активировать Защиту от атак DDoS ценовой категории "Стандартный", которая обеспечивает возможности по устранению рисков, специально настроенные для ресурсов виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0db-235">Although basic DDoS protection is automatically enabled as part of the Azure platform, DDoS Protection Standard provides mitigation capabilities that are tuned specifically to Azure Virtual Network resources.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="8f0db-236">Развертывание решения</span><span class="sxs-lookup"><span data-stu-id="8f0db-236">Deploy the solution</span></span>

<span data-ttu-id="8f0db-237">Пример развертывания для этой архитектуры можно найти на портале [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="8f0db-237">A deployment for this architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="8f0db-238">Он позволяет развернуть следующее:</span><span class="sxs-lookup"><span data-stu-id="8f0db-238">It deploys the following:</span></span>

- <span data-ttu-id="8f0db-239">Виртуальную сеть с одной подсетью, называющейся **web**, которая используется для размещения виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="8f0db-239">A virtual network with a single subnet named **web** used to host the VM.</span></span>
- <span data-ttu-id="8f0db-240">Группу безопасности сети с двумя правилами для входящего трафика, позволяющими передавать HTTP- и RDP-трафик в виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="8f0db-240">An NSG with two incoming rules to allow RDP and HTTP traffic to the VM.</span></span>
- <span data-ttu-id="8f0db-241">Виртуальную машину, которая содержит последнюю версию Windows Server 2016 Datacenter Edition.</span><span class="sxs-lookup"><span data-stu-id="8f0db-241">A VM running the latest version of Windows Server 2016 Datacenter Edition.</span></span>
- <span data-ttu-id="8f0db-242">Пример расширения пользовательских скриптов, которое форматирует два диска данных, и скрипт PowerShell DSC, который развертывает службы IIS.</span><span class="sxs-lookup"><span data-stu-id="8f0db-242">A sample custom script extension that formats the two data disks, and a PowerShell DSC script that deploys Internet Information Services (IIS).</span></span>

### <a name="prerequisites"></a><span data-ttu-id="8f0db-243">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="8f0db-243">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deployment-steps"></a><span data-ttu-id="8f0db-244">Шаги по развертыванию</span><span class="sxs-lookup"><span data-stu-id="8f0db-244">Deployment steps</span></span>

<span data-ttu-id="8f0db-245">Чтобы развернуть эту эталонную архитектуру, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="8f0db-245">To deploy this reference architecture, follow these steps:</span></span>

1. <span data-ttu-id="8f0db-246">Перейдите в папку `virtual-machines\single-vm\parameters\windows` репозитория, скачанного на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="8f0db-246">Navigate to the `virtual-machines\single-vm\parameters\windows` folder for the repository you downloaded in the prerequisites step above.</span></span>

2. <span data-ttu-id="8f0db-247">Откройте файл `single-vm-v2.json` и введите имя пользователя и пароль в кавычках, а затем сохраните файл.</span><span class="sxs-lookup"><span data-stu-id="8f0db-247">Open the `single-vm-v2.json` file and enter a username and password between the quotes, then save the file.</span></span>

    ```json
    "adminUsername": "",
    "adminPassword": "",
    ```

3. <span data-ttu-id="8f0db-248">Запустите `azbb`, чтобы развернуть пример виртуальной машины, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="8f0db-248">Run `azbb` to deploy the sample VM as shown below.</span></span>

  ```azurecli
  azbb -s <subscription_id> -g <resource_group_name> -l <location> -p single-vm-v2.json --deploy
  ```

<span data-ttu-id="8f0db-249">Для проверки развертывания выполните следующую команду Azure CLI, чтобы найти общедоступный IP-адрес виртуальной машины:</span><span class="sxs-lookup"><span data-stu-id="8f0db-249">To verify the deployment, run the following Azure CLI command to find the public IP address of the VM:</span></span>

```azurecli
az vm show -n ra-single-windows-vm1 -g <resource-group-name> -d -o table
```

<span data-ttu-id="8f0db-250">По этому адресу в веб-браузере должна открыться домашняя страница IIS по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="8f0db-250">If you navigate to this address in a web browser, you should see the default IIS homepage.</span></span>

<span data-ttu-id="8f0db-251">Сведения о настройке этого развертывания см. в нашем [репозитории GitHub][git].</span><span class="sxs-lookup"><span data-stu-id="8f0db-251">For information about customizing this deployment, visit our [GitHub repository][git].</span></span>

<!-- links -->
[audit-logs]: https://azure.microsoft.com/blog/analyze-azure-audit-logs-in-powerbi-more/
[availability-set]: /azure/virtual-machines/virtual-machines-windows-create-availability-set
[azbb]: https://github.com/mspnp/template-building-blocks/wiki/Install-Azure-Building-Blocks
[azbbv2]: https://github.com/mspnp/template-building-blocks
[azure-cli-2]: /cli/azure/install-azure-cli?view=azure-cli-latest
[azure-dns]: /azure/dns/dns-overview
[azure-storage]: /azure/storage/storage-introduction
[blob-snapshot]: /azure/storage/storage-blob-snapshots
[blob-storage]: /azure/storage/storage-introduction
[boot-diagnostics]: https://azure.microsoft.com/blog/boot-diagnostics-for-virtual-machines-v2/
[cname-record]: https://en.wikipedia.org/wiki/CNAME_record
[data-disk]: /azure/virtual-machines/virtual-machines-windows-about-disks-vhds
[disk-encryption]: /azure/security/azure-security-disk-encryption
[enable-monitoring]: /azure/monitoring-and-diagnostics/insights-how-to-use-diagnostics
[fqdn]: /azure/virtual-machines/virtual-machines-windows-portal-create-fqdn
[git]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/single-vm
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/single-vm
[group-policy]: https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn595129(v=ws.11)
[log-collector]: https://azure.microsoft.com/blog/simplifying-virtual-machine-troubleshooting-using-azure-log-collector/
[manage-vm-availability]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[managed-disks]: /azure/storage/storage-managed-disks-overview
[naming-conventions]: ../../best-practices/naming-conventions.md
[nsg]: /azure/virtual-network/virtual-networks-nsg
[nsg-default-rules]: /azure/virtual-network/virtual-networks-nsg#default-rules
[planned-maintenance]: /azure/virtual-machines/virtual-machines-windows-planned-maintenance
[premium-storage]: /azure/virtual-machines/windows/premium-storage
[premium-storage-supported]: /azure/virtual-machines/windows/premium-storage#supported-vms
[rbac]: /azure/active-directory/role-based-access-control-what-is
[rbac-roles]: /azure/active-directory/role-based-access-built-in-roles
[rbac-devtest]: /azure/active-directory/role-based-access-built-in-roles#devtest-labs-user
[rbac-network]: /azure/active-directory/role-based-access-built-in-roles#network-contributor
[reboot-logs]: https://azure.microsoft.com/blog/viewing-vm-reboot-logs/
[ref-arch-repo]: https://github.com/mspnp/reference-architectures
[resize-os-disk]: /azure/virtual-machines/virtual-machines-windows-expand-os-disk
[resource-lock]: /azure/resource-group-lock-resources
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[security-center]: /azure/security-center/security-center-intro
[security-center-get-started]: /azure/security-center/security-center-get-started
[select-vm-image]: /azure/virtual-machines/virtual-machines-windows-cli-ps-findimage
[services-by-region]: https://azure.microsoft.com/regions/#services
[static-ip]: /azure/virtual-network/virtual-networks-reserved-public-ip
[virtual-machine-sizes]: /azure/virtual-machines/virtual-machines-windows-sizes
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[vm-disk-limits]: /azure/azure-subscription-service-limits#virtual-machine-disk-limits
[vm-resize]: /azure/virtual-machines/virtual-machines-linux-change-vm-size
[vm-size-tables]: /azure/virtual-machines/virtual-machines-windows-sizes
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines
