---
title: Виртуальный центр обработки данных Azure. Общие сведения о сетевой инфраструктуре
description: Узнайте, как создать виртуальный центр обработки данных в Azure
author: tracsman
manager: rossort
tags: azure-resource-manager
ms.service: virtual-network
ms.date: 09/24/2018
ms.author: jonor
ms.openlocfilehash: b10930ac6d6458872d8b626825d21bd0bed2b807
ms.sourcegitcommit: 16bc6a91b6b9565ca3bcc72d6eb27c2c4ae935e4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2018
ms.locfileid: "52550467"
---
# <a name="azure-virtual-datacenter-a-network-perspective"></a>Виртуальный центр обработки данных Azure. Общие сведения о сетевой инфраструктуре

## <a name="overview"></a>Обзор
Переместив локальные приложения в Azure (даже без значительных изменений), организации могут пользоваться преимуществами безопасной и экономичной инфраструктуры. Такой подход называется **lift- and -shift**. Чтобы использовать возможности Azure в полном объеме, включая преимущества гибких облачных вычислений, организациям нужно модернизировать свою архитектуру. Microsoft Azure предоставляет гипермасштабируемые службы и инфраструктуру, а также разные варианты гибридных подключений, гарантируя надежность и предлагая возможности корпоративного класса. 

Клиенты могут обращаться к этим облачным службам через Интернет или с помощью службы Azure ExpressRoute, которая позволяет создавать подключения к частной сети. Платформа Microsoft Azure позволяет клиентам легко добавлять в свою инфраструктуру облачные решения и создавать многоуровневую архитектуру. Кроме того, партнеры Майкрософт предоставляют расширенные возможности, предлагая службы безопасности и виртуальные устройства, оптимизированные для работы в Azure.

Эта статья содержит сведения о шаблонах и проектах, которые можно использовать для решения задач, связанных с безопасностью, производительностью и масштабированием архитектуры. Все эти вопросы являются актуальными для многих клиентов, которые планируют массовый перенос своих решений в облако. Здесь также обсуждается то, как разные роли ИТ-специалистов соотносятся с задачами управления системой с учетом требований безопасности и необходимости оптимизировать затраты.

## <a name="what-is-a-virtual-datacenter"></a>Что такое виртуальный центр обработки данных?
Изначально облачные решения разрабатывались для размещения относительно изолированных отдельных приложений для общедоступного использования. Этот подход был оптимальным несколько лет. Затем преимущества облачных решений стали очевидными, и облака стали использоваться для размещения нескольких крупномасштабных рабочих нагрузок. При этом в контексте жизненного цикла облачной службы актуализировались вопросы, связанные с обеспечением безопасности, надежности и производительности, а также оптимизации затрат для развертываний в одном или нескольких регионах.

На следующей схеме облачного развертывания **красным прямоугольником** обозначена область с недостаточным уровнем защиты. **Желтый прямоугольник** отражает возможности оптимизации сетевых виртуальных устройств для разных рабочих нагрузок.

[![0]][0]

Виртуальный центр обработки данных (ВЦОД) позволяет выполнять масштабирование, реализуя поддержку корпоративных рабочих нагрузок. Также он помогает решать проблемы, связанные с поддержкой крупномасштабных приложений в общедоступном облаке.

ВЦОД — это не просто рабочие нагрузки приложений в облаке. Это также сети, службы безопасности, средства управления и инфраструктура. Примерами являются службы каталогов и DNS. ВЦОД обеспечивает обратное частное подключение к локальной сети или центру обработки данных. Так как все больше и больше рабочих нагрузок переносится в Azure, важно подумать о поддержке инфраструктуры и объектов, размещающих эти рабочие нагрузки. Понимание того, как структурированы ресурсы, — это лучшее лекарство против распространения сотен **изолированных рабочих нагрузок**, которым требуется отдельное управление с использованием независимого потока данных, моделей безопасности и решений для обеспечения соответствия требованиям.

ВЦОД — это коллекция отдельных, но связанных сущностей с общими функциями поддержки, возможностями и инфраструктурой. Использование рабочих нагрузок в качестве интегрированного ВЦОД сопряжено с такими преимуществами, как сокращение затрат на масштабирование ресурсов, оптимизация защиты за счет централизации потока данных и компонентов, а также упрощение операций, управления и аудита соответствия.

> [!NOTE]  
> Важно понимать, что ВЦОД — это **не** отдельный продукт Azure. Это сочетание разных функций и компонентов, реализуемое в соответствии с вашими требованиями. ВЦОД помогает оптимизировать использование ресурсов Azure и рабочих нагрузок, расширяя возможности работы с облаком. Таким образом, ВЦОД представляет модульный подход к созданию ИТ-служб в Azure с учетом корпоративных ролей и обязанностей.

ВЦОД может помочь предприятиям реализовать следующие сценарии для рабочих нагрузок и приложений в Azure:

-   размещение нескольких связанных рабочих нагрузок;
-   перенос рабочих нагрузок из локальной среды в Azure;
-   обеспечение общей или централизованной защиты и доступности рабочих нагрузок;
-   сбалансированное применение ролей централизованной ИТ-команды и команды Azure DevOps в рамках крупного предприятия.

Преимущества ВЦОД обеспечиваются централизованной топологией типа "звезда", которая включает следующие компоненты Azure: 

- [виртуальная сеть Azure][VNet]; 
- [группы безопасности сети (NSG)][NSG];
- [пиринг между виртуальными сетями][VNetPeering]; 
- [определяемые пользователем маршруты][UDR];
- службы идентификации Azure с функциями [управления доступом на основе ролей (RBAC)][RBAC]; 
- (дополнительно) [Брандмауэр Azure][AzFW], [Azure DNS][DNS], [Azure Front Door Service][AFD] и [Виртуальная глобальная сеть Azure][vWAN].

## <a name="who-should-implement-a-virtual-datacenter"></a>Кто отвечает за реализацию ВЦОД?
Любой клиент Azure, которому нужно переместить несколько рабочих нагрузок в Azure, может воспользоваться преимуществами использования общих ресурсов. Использование шаблонов и компонентов при создании ВЦОД может оказаться эффективным даже для отдельных приложений разных размеров.

Если в вашей организации есть команды или отделы, которые занимаются централизованным ИТ-управлением, а также решением вопросов, связанными с сетями, безопасностью и соответствием, ВЦОД поможет им реализовать политики, разделить обязанности и обеспечить единообразие базовых компонентов. При этом свобода действий разработчиков ограничивается только актуальными требованиями.

Организации, которые ориентированы на процессы Azure DevOps, могут использовать возможности ВЦОД для предоставления авторизованных групп ресурсов Azure и обеспечения полного контроля над ними. В рамках этого подхода группы представляют собой подписки или группы ресурсов в общей подписке. При этом требования к безопасности и сети будут соответствовать стандартам, определенным централизованной политикой в центральной виртуальной сети и группе ресурсов.

## <a name="considerations-when-you-implement-a-virtual-datacenter"></a>Рекомендации по реализации ВЦОД
При разработке ВЦОД следует обеспечить следующее:

-   службы идентификации и каталогов;
-   решения для обеспечения безопасности;
-   возможность подключения к облаку;
-   возможность подключения в пределах облака.

### <a name="identity-and-directory-services"></a>Службы идентификации и каталогов
Службы идентификации и каталогов — главный компонент всех ВЦОД, как в локальной, так и в облачной средах. Удостоверения связаны со всеми аспектами авторизации пользователей и их доступа к службам в пределах ВЦОД. Чтобы обеспечить доступ к учетной записи и ресурсам Azure только авторизованным пользователям и процессам, Azure использует несколько типов учетных данных для аутентификации. К ним относятся пароли для доступа к учетной записи Azure, криптографические ключи, цифровые подписи и сертификаты. 

[Многофакторная идентификация Azure][MFA] — это дополнительное решение для обеспечения безопасности при получении доступа к службам Azure. Оно обеспечивает строгую аутентификацию на основе разных решений. Пользователи могут выбрать наиболее удобный для них способ: телефонный звонок, текстовое сообщение или уведомление через мобильное приложение. 

Любое крупное предприятие должно разработать процесс управления идентификацией, включая управление индивидуальными удостоверениями, проверку подлинности и авторизацию, а также использование ролей и привилегий в ВЦОД и за его пределами. Это позволяет усилить защиту и повысить производительность, одновременно снижая затраты, время простоя, а также необходимость в повторяющихся и выполняемых вручную задачах.

Предприятиям и организациям может требоваться определенное сочетание служб для реализации разных бизнес-решений. А сотрудники часто используют разные роли при работе с разными проектами. ВЦОД требует слаженного взаимодействия между разными командами, для каждой из которых предусмотрены конкретные определения ролей. Все это позволяет надлежащим образом управлять рабочими системами. Процесс назначения обязанностей, разрешений и прав может быть очень непростым. Управление удостоверениями в ВЦОД реализуется с помощью [Azure Active Directory (Azure AD)][AAD] и управления доступом на основе ролей (RBAC).

Служба каталогов — это общая информационная инфраструктура для поиска, администрирования и организации ежедневно используемых элементов и сетевых ресурсов. Эти ресурсы могут включать тома, папки, файлы, принтеры, пользователей, группы, устройства и другие объекты. Каждый ресурс в сети считается объектом сервера каталогов. Сведения о ресурсе хранятся в виде коллекции атрибутов, связанных с этим ресурсом или объектом.

Все бизнес-службы Microsoft Online используют Azure Active Directory (Azure AD) для входа и других задач, связанных с идентификацией. Azure Active Directory (Azure AD) — это комплексное высокодоступное облачное решение для управления удостоверениями и доступом, предоставляющее базовые службы каталогов, расширенные функции управления удостоверениями и функции управления доступом к приложениям. Azure AD можно интегрировать с локальным экземпляром Active Directory для включения единого входа для всех облачных и локальных приложений. Атрибуты пользователя локальной службы Active Directory могут автоматически синхронизироваться с Azure AD.

Для назначения всех разрешений в ВЦОД не требуется отдельный глобальный администратор. Вместо этого получить разрешения, необходимые для управления собственными ресурсами, может каждый отдел (группа пользователей или служб в службе каталогов). Структурирование разрешений требует балансировки. Слишком много разрешений негативно влияет на производительность. А их недостаток или отсутствие повышает риски безопасности. Управление доступом на основе ролей (RBAC) Azure помогает решить эту задачу, предоставляя выборочный доступ к ресурсам ВЦОД.

#### <a name="security-infrastructure"></a>Инфраструктура безопасности
Инфраструктура безопасности обеспечивается разделением трафика в определенных сегментах виртуальной сети ВЦОД, а также управлением входящим и исходящим потоками в пределах всего центра. В основе Azure лежит мультитенантная архитектура, которая блокирует несанкционированный и непреднамеренный трафик между развертываниями, используя изоляцию виртуальной сети (VNet), списки управления доступом (ACL), подсистемы балансировки нагрузки, IP-фильтры и политики потока трафика. Преобразование сетевых адресов (NAT) отделяет внутренний и внешний сетевой трафик.

Структура Azure выделяет ресурсы инфраструктуры для рабочих нагрузок клиента и управляет исходящим и входящим обменом данными виртуальных машин. Низкоуровневая оболочка Azure принудительно разделяет память и процессы между виртуальными машинами и обеспечивает безопасную передачу сетевого трафика клиентам гостевой ОС.

#### <a name="connectivity-to-the-cloud"></a>подключения к облаку;
Для реализации ВЦОД требуется подключение к внешним сетям, чтобы предлагать службы клиентам, партнерам и внутренним пользователям. Обычно это подразумевает подключение не только к Интернету, но также к локальным сетям и центрам обработки данных.

Пользователи управляют доступом к службам из Интернета с помощью [Брандмауэра Azure][AzFW] или других видов сетевых виртуальных модулей (NVA), пользовательских политик маршрутизации с использованием [определяемых пользователем маршрутов][UDR], а также сетевой фильтрации с использованием [групп безопасности сети][NSG]. Рекомендуется, чтобы все связанные с Интернетом ресурсы были дополнительно защищены с помощью [Защиты от атак DDoS уровня "Стандартный"][DDOS].

Предприятиям часто требуется подключать ВЦОД к локальным центрам обработки данных или другим ресурсам. Таким образом, подключение между Azure и локальными сетями — важный аспект при проектировании эффективной архитектуры. У предприятий есть два варианта обеспечить взаимодействие между ВЦОД и локальными решениями в Azure: подключение через Интернет и (или) частные прямые соединения.

[Azure VPN типа "сеть — сеть"] [ VPN] подключает локальный центр обработки данных предприятия к ВЦОД через Интернет. Трафик через VPN шифруется с помощью туннелирования IPSec и IKE. Подключение "сеть — сеть" в Azure — это гибкое и быстро настраиваемое подключение. Использование VPN не сопряжено с последующими затратами, так как все подключения устанавливаются через Интернет.

Используемая для большого количества VPN-подключений [Виртуальная глобальная сеть Azure][vWAN], — это сетевая служба, которая обеспечивает оптимизированное и автоматизированное подключение "ветвь — ветвь" через Azure. Виртуальная глобальная сеть позволяет подключать и настраивать устройства ветви для обмена данными с Azure. Такое подключение можно установить вручную или с помощью устройств провайдеров через партнера Виртуальной глобальной сети. Использование нужных устройств провайдеров упрощает использование, подключение и управление конфигурацией. Встроенная панель управления глобальной сетью Azure отображает актуальные сведения по устранению неполадок, что экономит время и позволяет быстро просматривать данные о масштабных подключениях "сеть — сеть".

[ExpressRoute][ExR] — это служба подключения Azure, которая позволяет создавать частные подключения между ВЦОД и локальной сетью предприятия. Она обеспечивает повышенный уровень безопасности, надежности и быстродействия (до 10 Гбит/с) с последовательной задержкой. ExpressRoute подходит для использования с ВЦОД, так как клиенты ExpressRoute могут использовать правила соответствия, связанные с частными подключениями. С помощью [ExpressRoute Direct][ExRD] можно подключаться непосредственно к маршрутизаторам Майкрософт со скоростью 100 Гбит/с для клиентов, которым требуется большая пропускная способность.

Развертывание подключений ExpressRoute обычно требует участия поставщика услуг ExpressRoute. Для клиентов, которым необходимо быстро приступить к работе, мы рекомендуем поначалу использовать VPN типа "сеть — сеть", чтобы установить подключение между ВЦОД и локальными ресурсами. Когда физическое подключение с поставщиком услуг будет установлено, выберите подключение ExpressRoute.

#### <a name="connectivity-within-the-cloud"></a>Возможность подключения в пределах облака
[Виртуальные сети][VNet] и [пиринговые виртуальные сети][VNetPeering] — это основные сетевые службы подключения в пределах ВЦОД. Виртуальная сеть обеспечивает естественную границу изоляции для ресурсов ВЦОД. Пиринг между виртуальными сетями разрешает внутренние взаимодействия между разными виртуальными сетями в одном или нескольких регионах Azure. Управление трафиком пределах одной или нескольких виртуальных сетей должно выполняться в соответствии с набором правил безопасности, заданных через списки управления доступом (см. сведения о [группах безопасности сети][NSG], [сетевых виртуальных модулях (NVA)][NVA] и [настраиваемых таблицах маршрутизации][UDR]).

## <a name="virtual-datacenter-overview"></a>Общие сведения о ВЦОД

### <a name="topology"></a>Топология
**Звезда**  — это модель архитектуры, расширяющая ВЦОД в пределах одного региона Azure.

[![1]][1]

Центральная зона (концентратор) контролирует и проверяет входящий и исходящий трафик между разными зонами, включая Интернет, а также локальные периферийные зоны. Топология типа "звезда" позволяет ИТ-отделу применять политики безопасности в центральном расположении, одновременно минимизируя уязвимости и ошибки в конфигурации.

В концентраторе содержатся общие компоненты служб, используемые периферийными зонами. Их примеры представлены ниже.

-   Инфраструктура Windows Active Directory для проверки подлинности внешних пользователей, которые пытаются получить доступ из ненадежных сетей, до предоставления таким пользователям доступа к рабочим нагрузкам в периферийных зонах. Сюда входят связанные службы федерации Active Directory (AD FS).
-   Служба DNS для разрешения имен рабочих нагрузок в периферийных зонах и получения доступа к ресурсам локально и в Интернете, если [Azure DNS][DNS] не используется.
-   Инфраструктура открытых ключей (PKI) для реализации единого входа в рабочие нагрузки.
-   Управление TCP- и UDP-трафиком между зонами периферийными зонами и Интернетом.
-   Управление потоком между периферийными зонами и локальными ресурсами.
-   Управление потоком между несколькими периферийными зонами (при необходимости).

ВЦОД снижает общую стоимость за счет использования общей центральной инфраструктуры между несколькими периферийными зонами.

Роль каждой периферийной зоны может заключаться в размещении различных типов рабочих нагрузок. Использование периферийных зон также позволяют реализовать модульный подход для повторяемых развертываний одних и тех же рабочих нагрузок в среде разработки и тестирования, пользовательского приемочного тестирования, а также подготовительной и рабочей среде. Также эти зоны можно использовать для разделения и включения различных групп в пределах организации, например, групп DevOps в Azure. В пределах периферийной зоны можно развернуть базовую рабочую нагрузку или сложные многоуровневые рабочие нагрузки с управлением трафиком между уровнями.

#### <a name="subscription-limits-and-multiple-hubs"></a>Ограничения подписки и несколько центральных зон
В Azure каждый компонент (независимо от типа) развертывается в подписке Azure. Изоляция компонентов Azure в разных подписках Azure может удовлетворять требования различных бизнес-решений, включая настройку дифференцированных уровней доступа и авторизации.

Единую реализацию ВЦОД можно масштабировать для создания большого количества периферийных зон. Но, как и в случае с любой ИТ-системой, у этой платформы есть свои ограничения. Развертывание концентратора привязано к определенной подписке Azure, которая имеет ограничения, например максимальное количество пиринговых виртуальных сетей. См. дополнительные сведения об [ограничениях подписок и служб Azure, границах и квотах][Limits]. В случаях, когда ограничения могут представлять проблему, архитектуру можно дополнительно масштабировать. Вы можете расширить модель, включив в топологию типа "звезда" кластер. Связать несколько концентраторов в одном или нескольких регионах Azure можно с помощью пиринга между виртуальными сетями, подключения ExpressRoute, Виртуальной глобальной сети или VPN типа "сеть — сеть".

[![2]][2]

Включение нескольких концентраторов приводит к увеличению затрат и действий по управлению системой. Это может быть оправдано только требованиями масштабируемости (в соответствии с системными ограничениями или избыточностью) и региональной репликации (для обеспечения производительности или аварийного восстановления). В сценариях, требующих несколько концентраторов, все концентраторы должны обеспечивать один набор служб для упрощения выполнения операций.

#### <a name="interconnection-between-spokes"></a>Взаимодействие между периферийными зонами
В пределах отдельной периферийной зоны можно реализовать сложные многоуровневые рабочие нагрузки. Многоуровневые конфигурации можно реализовать, используя одну подсеть для каждого уровня в той же виртуальной сети. Фильтровать потоки можно с помощью групп безопасности сети.

Архитектор может развернуть многоуровневую рабочую нагрузку в пределах нескольких виртуальных сетей. Используя пиринг между виртуальными сетями, периферийные зоны могут подключаться к другим периферийным зонам в пределах одного или нескольких концентраторов. Типичным примером такого сценария является случай, когда серверы обработки приложения располагаются в одной периферийной зоне или виртуальной сети, а база данных развернута в другой периферийной зоне или виртуальной сети. В этом случае периферийные зоны могут легко обмениваться данными через пиринговые виртуальные сети, не используя при этом концентратор. При этом требуется тщательно проверить архитектуру и систему безопасности, чтобы обход концентратора не сопровождался обходом важных элементов безопасности или аудита, которые могут существовать только в концентраторе.

[![3]][3]

Периферийные зоны могут также взаимодействовать с периферийной зоной, выполняющей функции концентратора. В рамках этого подхода создается двухуровневая иерархия: периферийная зона высокого уровня (уровень 0) становится концентратором подчиненных периферийных зон (уровень 1) иерархии. Периферийные зоны ВЦОД должны направлять трафик в концентратор, чтобы подключиться к локальной сети или Интернету. Такая архитектура концентратора представляет сложную маршрутизацию, что сводит на нет преимущества отдельной звездообразной связи.

Хотя Azure допускает сложные топологии, одним из основных принципов концепции ВЦОД является повторяемость и простота. Чтобы свести к минимуму действия по управлению системой, в качестве эталонной архитектуры ВЦОД рекомендуется использовать простую топологию тира "звезда".

### <a name="components"></a>Компоненты
ВЦОД состоит из четырех базовых типов компонентов: **инфраструктуры**, **сетей периметра**, **рабочих нагрузок** и **системы мониторинга**.

Каждый тип компонента состоит из различных функций и ресурсов Azure. ВЦОД предприятия состоит из экземпляров компонентов нескольких типов и нескольких вариантов компонентов одного типа. Например, у вас может быть несколько логически разделенных экземпляров рабочей нагрузки, представляющих разные приложения. В конечном итоге все эти различные экземпляры и типы компонентов используются для создания ВЦОД.

[![4]][4]

На схеме обобщенной архитектуры ВЦОД показаны разные типы компонентов, которые используются в разных зонах топологии типа "звезда". На схеме показаны компоненты инфраструктуры в различных частях архитектуры.

Для локального или виртуального центра обработки данных рекомендуется, чтобы права доступа и привилегии предоставлялись на основе группы. Работа с группами, а не отдельными пользователями, обеспечивает согласованность политик доступа между группами, а также предотвращает появления ошибок в конфигурации. Включение пользователей в соответствующие группы и их исключение оттуда не влияет на актуальность привилегий определенного пользователя.

Каждая группа роли должна содержать уникальный префикс в своем имени, позволяя легко определять связь между определенной группой и определенной рабочей нагрузкой. Например, рабочая нагрузка, размещающая службы проверки подлинности, должна содержать группы с именами **AuthServiceNetOps**, **AuthServiceSecOps**, **AuthServiceDevOps** и **AuthServiceInfraOps**. Для централизованных ролей или ролей, не связанных с определенной службой, должен использоваться префикс **Corp**, например, **CorpNetOps**.

Многие организации используют разновидность следующих групп для предоставления основной декомпозиции ролей:

-   Центральная ИТ-группа **Corp**, имеет права владения для управления компонентами инфраструктуры. Примерами являются сетевые компоненты и система безопасности. Группе должна быть назначена роль участника в подписке, а также предоставлены права управления концентратором и права участника сети в периферийных зонах. Крупные организации часто разделяют эти функции между несколькими командами. Примеры — команда, отвечающая за сетевые операции (**CorpNetOps**), которая фокусируется на сетевых компонентах, а также команда, отвечающая за операции системы безопасности (**CorpSecOps**), которая фокусируется на политиках безопасности и брандмауэра. В этом конкретном случае требуется создание двух разных групп для назначения этих пользовательских ролей.
-   Группа разработки и тестирования **AppDevOps** отвечает за развертывание рабочих нагрузок (приложений или служб). Эта группа выполняет роль участника виртуальной машины для развертываний IaaS, а также одну или несколько ролей участника PaaS. См. дополнительные сведения о [встроенных ролях для ресурсов Azure][Roles]. При необходимости группе разработки и тестирования может потребоваться право на просмотр политик безопасности, групп безопасности сети и политик маршрутизации в пределах концентратора или определенной периферийной зоны. Кроме ролей участника для рабочих нагрузок этой группе также потребуется роль читателя сетей.
-   Группа операций и обслуживания (**CorpInfraOps** или **AppInfraOps**) отвечает за управление рабочими нагрузками в рабочей среде. Эта группа должна быть участником подписки для рабочих нагрузок в любой рабочей подписке. Некоторые организации могут также определить необходимость в дополнительной эскалации группы службы поддержки с помощью роли участника подписки в рабочей среде и подписке центрального концентратора. Это позволит им решить потенциальные проблемы с конфигурацией в рабочей среде.

ВЦОД структурирован таким образом, что созданные группы для центральных ИТ-групп, управляющих концентратором, содержат соответствующие группы на уровне рабочей нагрузки. Кроме возможности управлять ресурсами концентратора только центральные ИТ-группы могут управлять внешним доступом и разрешениями верхнего уровня в подписке. Тем не менее группы рабочей нагрузки могут управлять ресурсами и разрешениями своих виртуальных сетей независимо от центральных ИТ-групп.

ВЦОД должен быть секционирован для безопасного размещения нескольких проектов в различных бизнес-решениях. Для всех проектов требуются разные изолированные среды, включая среду разработки, среду пользовательского приемочного тестирования (UAT), а также рабочую среду. Отдельные подписки Azure для каждой из этих сред обеспечивают естественную изоляцию.

[![5]][5]

На предыдущей схеме показана связь между проектами организации, пользователями, группами и средами, в которых развернуты компоненты Azure.

Обычно в сфере ИТ среда (или уровень) представляет систему, в которой развертываются и выполняются несколько приложений. Крупные предприятия используют среду разработки, в которой вносятся и тестируются изменения, и рабочую среду, которую используют пользователи. Эти среды изолированы друг от друга, часто с помощью нескольких промежуточных сред. Это позволяет выполнять поэтапное развертывание, тестирование и откат в случае возникновения проблем. Архитектуры развертывания существенно различаются, но обычно соблюдается базовая последовательность: развертывание и перенос в рабочую среду (этапы **DEV** и **PROD** соответственно).

Общая архитектура для этих типов многоуровневых сред включает среду Azure DevOps для разработки и тестирования, среду UAT (промежуточная среда) и рабочую среду. Организации могут использовать один или несколько клиентов Azure AD для определения доступа к этим средам и соответствующих прав. На предыдущей схеме показана ситуация, когда используются два разных клиента Azure AD: один для DevOps и UAT, а другой — исключительно для рабочей среды.

Наличие разных клиентов Azure AD обеспечивает разделение между средами. Одна группа пользователей (например, центральная ИТ-команда) должна пройти проверку подлинности с помощью другого URI, чтобы получить доступ к другому клиенту AD и изменить роли или разрешения Azure DevOps или рабочих сред проекта. Выполнение проверки подлинности другого пользователя для доступа к другим средам минимизирует возможные простои и предотвращает появление других проблем, вызванных человеческим фактором.

#### <a name="component-type-infrastructure"></a>Тип компонента: инфраструктура
В этом типе компонента размещается большая часть вспомогательной инфраструктуры. С этим компонентом большую часть времени работает централизованная ИТ-команда и команда по обеспечению соответствия и безопасности.

[![6]][6]

Компоненты инфраструктуры обеспечивают взаимодействие между различными компонентами ВЦОД. Они присутствуют в концентраторе и периферийных зонах. Управлением компонентами инфраструктуры и их обслуживанием обычно занимается центральная ИТ-команда или команда обеспечения безопасности.

Одна из основных задач группы ИТ-инфраструктуры — обеспечение согласованности схем IP-адреса на предприятии. Присваиваемый ВЦРД диапазон частных IP-адресов должен быть согласованным. Нельзя допускать перекрытие частных IP-адресов, назначенных в локальных сетях.

Хотя преобразование NAT в локальных пограничных маршрутизаторах или средах Azure позволяет избежать конфликтов IP-адресов, оно усложняет работу компонентов инфраструктуры. Простота управления должна быть главной характеристикой ВЦОД. Следовательно, использовать NAT для обработки IP-адресов не рекомендуется.

Инфраструктура включает следующие компоненты:

-   [**Службы удостоверений и каталогов**][AAD]. Доступ к каждому типу ресурса в Azure регулируется удостоверением, хранящимся в службе каталогов. В службе каталогов хранится список пользователей и права доступа к ресурсам в определенной подписке Azure. Эти службы могут существовать только в облаке или их можно синхронизировать с локальным удостоверением, хранящимся в Azure Active Directory.
-   [**Виртуальная сеть**][VPN]. Виртуальные сети — один из основных компонентов ВЦОД. С помощью виртуальных сетей можно создавать границы изоляции трафика на платформе Azure. Виртуальная сеть состоит из одного или нескольких сегментов виртуальной сети, каждый из которых содержит определенный сетевой префикс IP-адреса (подсеть). Виртуальная сеть определяет внутреннюю область периметра, где виртуальные машины IaaS и службы PaaS могут осуществлять закрытый обмен данными. Виртуальные машины и службы PaaS в одной виртуальной сети не могут напрямую обращаться к виртуальным машинам (и службам PaaS) в другой виртуальной сети, даже если обе виртуальные сети созданы одним клиентом в одной подписке. Изоляция очень важна, так как она гарантирует, что виртуальные машины и коммуникации клиента останутся закрытыми в пределах виртуальной сети.
-   [**UDR**][UDR]. Трафик в виртуальной сети перенаправляется по умолчанию на основе системной таблицы маршрутизации. Определяемый пользователем маршрут — это настраиваемая таблица маршрутизации, которую администраторы сети могут связать с одной или несколькими подсетями. Эта связь перезаписывает поведение системной таблицы маршрутизации и определяет путь обмена данными в пределах виртуальной сети. Наличие маршрутов, определяемых пользователем, гарантирует, что исходящий трафик из периферийной зоны проходит через определенные настраиваемые виртуальные машины, сетевые виртуальные устройства и подсистемы балансировки нагрузки в концентраторе и периферийных зонах.
-   [**Группа безопасности сети (NSG)**][NSG]. Группа безопасности сети представляет список правил безопасности, которые действуют как средство фильтрации трафика для исходных и целевых IP-адресов, протоколов, а также исходных и целевых IP-портов. NSG можно применять к подсети и (или) виртуальной плате сетевого адаптера, связанной с виртуальной машиной Azure. NSG необходимы для реализации правильного управления потоком в концентраторе и периферийных зонах. Уровень безопасности, обеспечиваемый NSG, зависит от того, какие порты вы открываете и с какой целью. Клиенты должны применять дополнительные фильтры для каждой виртуальной машины с помощью брандмауэров на основе узла, например IPtables или брандмауэра Windows.
-   [**DNS**][DNS]. Разрешение имен ресурсов в виртуальных сетях ВЦОД обеспечивается через службу доменных имен (DNS). Azure предоставляет службы DNS как для [общедоступного][DNS], так и для [частного][PrivateDNS] разрешения имен. Частные зоны обеспечивают разрешение имен внутри виртуальной сети и между виртуальными сетями. Частные зоны могут охватывать виртуальные сети в пределах одного или нескольких регионов и подписок. Для общедоступного разрешения Azure DNS предоставляет службу размещения для доменов DNS. Она предоставляет разрешение имен с помощью инфраструктуры Microsoft Azure. Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, API и инструментов и оплачивать использование, как и другие службы Azure.
-   [**Подписка**][SubMgmt] и [**управление группой ресурсов**][RGMgmt]. Подписка определяет естественную границу, чтобы создать несколько групп ресурсов в Azure. Ресурсы в подписке собраны вместе в логические контейнеры, которые называются **группами ресурсов**. Группа ресурсов — это логическая группа для организации ресурсов ВЦОД.
-   [**RBAC**][RBAC]. RBAC позволяет сопоставить роли в организации с правами доступа к определенным ресурсам Azure, чтобы ограничить для пользователей доступный набор действий. С помощью RBAC доступ предоставляется путем назначения соответствующей роли пользователям, группам и приложениям в определенной области. Областью назначения роли может быть подписка Azure, группа ресурсов или отдельный ресурс. RBAC разрешает наследование разрешений. Роли, назначенной в родительской области, предоставляется доступ к содержащимся в ней дочерним элементам. С помощью RBAC вы можете распределить обязанности и предоставить пользователям доступ, требуемый для выполнения поставленных задач. Например, RBAC может использоваться для предоставления одному сотруднику прав управления виртуальными машинами в подписке, а другому — прав управления базами данных SQL в той же подписке.
-   [**Пиринг между виртуальными сетями**][VNetPeering]. Основной механизм, используемый для создания инфраструктуры ВЦОД, — это пиринг между виртуальными сетями. Пиринг позволяет создать подключение между двумя виртуальными сетями в одном или нескольких регионах через сеть центра обработки данных Azure или глобальную магистральную сеть Azure соответственно.

#### <a name="component-type-perimeter-networks"></a>Тип компонента: сети периметра
Компоненты [сети периметра][DMZ] (сети DMZ) обеспечивают сетевые подключения локальных или физических сетей центра обработки данных, а также двухстороннюю связь с Интернетом. Этот компонент большую часть времени используют команды по работе с сетями и обеспечению безопасности.

Прежде чем попасть на внутренние серверы в периферийных зонах, входящие пакеты должны пройти через устройства безопасности в концентраторе, такие как брандмауэры, IDS и IPS. Пакеты, направленные в Интернет рабочими нагрузками, также должны пройти через защитные устройства сети периметра перед выходом из сети. Это удобно для применения политик, выполнения проверок и аудита.

Сеть периметра включает следующие компоненты:

-   [виртуальные сети][VNet], [определяемые пользователем маршруты][UDR] и [группы безопасности сети][NSG];
-   [сетевые виртуальные модули][NVA];
-   [Azure Load Balancer][ALB];
-   [Шлюз приложений Azure][AppGW] и [брандмауэр веб-приложения (WAF)][WAF];
-   [общедоступные IP-адреса][PIP];
-   [Azure Front Door][AFD];
-   [Брандмауэр Azure][AzFW].

Как правило, центральная ИТ-команда и команда по обеспечению безопасности отвечают за определение требований и операций в сетях периметра.

[![7]][7]

На предыдущей схеме показано применение двух периметров с доступом в Интернет и локальную сеть. Оба периметра располагаются в концентраторе. В концентраторе сети периметра сеть с доступом в Интернет можно масштабировать для поддержки большого количества бизнес-решений с помощью нескольких ферм брандмауэров веб-приложения (WAF) и (или) экземпляров брандмауэров Azure. В концентраторе виртуальной глобальной сети высоко масштабируемые подключения "ветвь — ветвь" и "ветвь — Azure" осуществляется через VPN или ExpressRoute.

[**Виртуальные сети**][VNet]. Обычно концентратор создается в виртуальной сети с несколькими подсетями для размещения другого типа служб, выполняющих фильтрацию и анализ трафика в Интернет и обратно через NVA, WAF и экземпляры Шлюзов приложения Azure.

[**Определяемые пользователем маршруты**][UDR]. С помощью определяемых пользователем маршрутов клиенты могут развертывать брандмауэры, IDS или IPS и другие виртуальные устройства, а также направлять сетевой трафик через эти устройства безопасности. Это позволяет применять, контролировать и проверять политики границ безопасности. Определяемые пользователем маршруты можно создавать в концентраторе и периферийных зонах, чтобы обеспечить передачу трафика через определенные пользовательские виртуальные машины, виртуальные сетевые устройства и подсистемы балансировки нагрузки, используемые ВЦОД. Чтобы убедиться, что трафик, созданный виртуальными машинами, находящимися в периферийной, передается в правильные виртуальные устройства, задайте определяемый пользователем маршрут в подсетях периферийной зоны. Создайте интерфейсный IP-адрес для внутренней подсистемы балансировки нагрузки в качестве следующего прыжка. Внутренняя подсистема балансировки нагрузки распределяет внутренний трафик на виртуальные устройства (внутренний пул подсистемы балансировки нагрузки).

[**Брандмауэр Azure**][AzFW] — это управляемая облачная служба сетевой безопасности, которая защищает ресурсы виртуальной сети Azure. Это высокодоступная служба с полным отслеживанием состояния и неограниченными возможностями облачного масштабирования. Вы можете централизованно создавать, применять и регистрировать политики приложений и сетевых подключений в подписках и виртуальных сетях. Брандмауэр Azure использует статический общедоступный IP-адрес для ресурсов виртуальной сети. Он разрешает внешним брандмауэрам идентифицировать трафик, поступающий из вашей виртуальной сети. Служба полностью интегрирована с Azure Monitor для ведения журналов и аналитики.

[**Сетевые виртуальные устройства**][NVA]. В концентраторе сеть периметра с доступом в Интернет обычно управляется с помощью экземпляра Брандмауэра Azure, фермы брандмауэров или брандмауэров веб-приложений (WAF).

Разные бизнес-приложения обычно используют многие веб-приложения, которые, как правило, являются уязвимыми. Брандмауэры веб-приложений — это особый тип продукта, используемый для обнаружения атак, направленных на веб-приложения (HTTP и HTTPS). Это отличает их от обычных брандмауэров. По сравнению с традиционными брандмауэрами WAF содержит набор специальных функций для защиты внутренних веб-серверов от угроз.

При этом отдельный ВЦОД должен размещаться в одном регионе, так как требования подписки запрещают использование нескольких регионов. Из-за этого требования такой ВЦОД становится уязвимым к региональным сбоям.

Фермы Брандмауэра Azure или фермы брандмауэра NVA используют общую панель администрирования. Предоставляемый набор правил безопасности помогает защитить рабочие нагрузки, размещенные в периферийных зонах, а также управлять доступом к локальным сетям. Брандмауэр Azure является масштабируемым решением, тогда как брандмауэры NVA можно масштабировать вручную за подсистемой балансировки нагрузки. Как правило, ПО фермы брандмауэра является менее специализированным по сравнению с WAF. Но оно предоставляет больше возможностей фильтрации и проверки любого типа трафика (входящего и исходящего). Если используются брандмауэры NVA, их можно развернуть из Azure Marketplace.

Рекомендуется использовать один набор экземпляров Брандмауэров Azure или брандмауэров NVA для трафика в Интернете и другой — для трафика в локальной среде. Использование только одного набора брандмауэров в обоих случаях представляет угрозу безопасности, так как между двумя наборами сетевого трафика отсутствует периметр безопасности. Использование отдельных уровней брандмауэра упрощает проверку правил безопасности, а также помогает понять, какие правила соответствуют определенным входящим сетевым запросам.

Большинство крупных предприятий управляют несколькими доменами. [Azure DNS][DNS] можно использовать для размещения DNS-записей определенного домена. Например, виртуальный IP-адрес (VIP) внешней подсистемы балансировки нагрузки Azure (или брандмауэры WAF) можно зарегистрировать в записи Azure DNS типа **A**. [**Частная зона DNS**][PrivateDNS] также доступна для управления частными адресными пространствами в пределах виртуальных сетей.

[**Azure Load Balancer**][ALB] — это служба 4-го уровня, работающая с протоколами TCP или UDP. Она используется для распределения входящего трафика между экземплярами служб в наборе балансировки нагрузки. Трафик, отправленный в подсистему балансировки нагрузки из интерфейсных конечных точек (конечных точек общедоступного IP-адреса или частного IP-адреса) может распространяться с преобразованием адреса и без него в набор серверного пула IP-адресов. Примеры — виртуальные сетевые устройства и виртуальные машины.

Azure Load Balancer также может проверять работоспособность разных экземпляров сервера. Если проба не отвечает, подсистема балансировки нагрузки останавливает отправку трафика в неработоспособный экземпляр. В ВЦОД внешняя подсистема балансировки нагрузки в концентраторе распределяет трафик между NVA. В периферийных зонах она отвечает за балансировку трафика между разными виртуальными машинами многоуровневого приложения.

[**Azure Front Door**][AFD] — это высокодоступная и масштабируемая платформа от Майкрософт для ускорения веб-приложений, глобальная подсистема балансировки нагрузки HTTP, средство защиты приложений и сеть доставки содержимого. Front Door выполняется более чем в 100 расположениях на границе глобальной сети Майкрософт. С помощью Front Door можно создавать, использовать и масштабировать динамические веб-приложения и статическое содержимое. Front Door обеспечивает для приложения следующие преимущества: 
* Высокие показатели производительности для пользователей.
* Унифицированная автоматизация регионального или маркированного обслуживания.
* Автоматизация операций по обеспечению непрерывности бизнес-процессов и аварийного восстановления (BCDR).
* Унифицированные сведения о клиентах или пользователях. 
* Кэширование. 
* Полезные сведения об услугах. Платформа гарантирует производительность и надежность, а также поддерживает Соглашения об уровне обслуживания, сертификаты соответствия и проверенные способы обеспечения безопасности, разработанные, реализуемые и поддерживаемые платформой Azure.

[**Шлюз приложений**][AppGW] — это выделенный виртуальный модуль, который предоставляет контроллер доставки приложений (ADC) как услугу, обеспечивая для приложения разные функции балансировки нагрузки уровня 7. Вы можете оптимизировать производительность веб-фермы за счет разгрузки SSL-терминации, требующей интенсивного использования ЦП, в экземпляре Шлюза приложений. Он также предоставляет другие возможности маршрутизации уровня 7, включая: 
* Циклическое распределение входящего трафика. 
* Сходство сеансов на основе файлов cookie. 
* Маршрутизация на основе URL-путей. 
* Возможность размещения нескольких веб-сайтов за одним экземпляром Шлюза приложений. Брандмауэр веб-приложений (WAF) также предоставляется как часть SKU WAF Шлюза приложений. Этот SKU обеспечивает защиту веб-приложений от распространенных веб-уязвимостей и эксплойтов. Шлюз приложений можно настроить как шлюз с доступом в Интернет и (или) внутренний шлюз или. 

[**Общедоступные IP-адреса**][PIP]. Некоторые функции Azure позволяют связывать конечные точки службы с общедоступным IP-адресом для получения доступа к ресурсам из Интернета. Эта конечная точка использует преобразование сетевых адресов (NAT) для маршрутизации трафика на внутренний адрес и порт в виртуальной сети Azure. Это основной путь передачи внешнего трафика в виртуальную сеть. Общедоступные IP-адреса можно настроить, чтобы определить, какой трафик следует пропускать в виртуальную сеть, а также как и где его следует пропускать.

[**Защита от атак DDoS Azure уровня "Стандартный"**][DDOS] предоставляет дополнительные возможности по устранению рисков по сравнению с [уровнем службы "Базовый"][DDOS], которые разработаны для ресурсов виртуальной сети Azure. Службу "Защита от атак DDoS" уровня "Стандартный" легко включить, и для ее использования не нужно изменять приложение. Политики защиты корректируются на основе мониторинга выделенного трафика и алгоритмов машинного обучения. Они применяются к общедоступным IP-адресам, связанным с ресурсами, развернутыми в виртуальных сетях, такими как Azure Load Balancer, Шлюз приложений Azure и экземпляры Azure Service Fabric. Данные телеметрии доступны в представлениях Azure Monitor в режиме реального времени во время атаки и после ее окончания. Можно также включить защиту на прикладном уровне с помощью брандмауэра веб-приложения в Шлюзе приложений Azure. Защита обеспечивается для общедоступных IP-адресов Azure IPv4.

#### <a name="component-type-monitoring"></a>Тип компонента: мониторинг
Компоненты мониторинга обеспечивают видимость и оповещения, получаемые от всех других типов компонентов. У всех групп должен быть доступ к мониторингу соответствующих компонентов и служб. Если у вас есть централизованная служба поддержки или операционная группа, им понадобится интегрированный доступ к данным, предоставляемый этими компонентами.

Azure предлагает несколько типов служб ведения журналов и мониторинга для отслеживания поведения размещенных ресурсов Azure. Регулирование рабочих нагрузок и управление ими в Azure основано не только на сборе данных журнала, но также на возможности активировать действия на основе определенных сообщаемых событий.

[**Azure Monitor**][Monitor]. Azure предлагает несколько служб, которые по отдельности выполняют определенную роль или задачу в пространстве мониторинга. Вместе эти службы предоставляют комплексное решение для сбора, анализа и использования телеметрии из вашего приложения и ресурсов Azure, которые их поддерживают. Они также могут выполнять мониторинг критически важных локальных ресурсов и предоставлять гибридную среду мониторинга. Понимание имеющихся инструментов и данных является первым шагом в разработке комплексной стратегии мониторинга для вашего приложения.

Есть два основных типа журналов в Azure:

-   [Журнал действий][ActLog] (прежнее название — **журнал операций**) предоставляет сведения об операциях, выполняемых в ресурсах в подписке Azure. Эти журналы предоставляют отчет о событиях уровня управления в подписках. Журналы аудита ведутся для каждого ресурса Azure.

-   [Журналы диагностики Azure][DiagLog] генерируются ресурсом. Они содержат подробные и своевременные данные о работе этого ресурса. Содержимое этих журналов зависит от типа ресурса.

[![9]][9]

В ВЦОД очень важно отслеживать журналы NSG, в частности, следующие:

-   [Журналы событий][NSGLog]. Эти журналы предоставляют сведения о правилах NSG, примененных к виртуальным машинам и ролям экземпляров на основе MAC-адреса.
-   [Журналы счетчиков][NSGLog].Они позволяют отслеживать, сколько раз каждое правило NSG применялось для запрета или разрешения трафика.

Все журналы можно хранить в учетных записях хранения Azure для аудита, статического анализа или резервного копирования. Если журналы хранятся в учетной записи хранения Azure, клиенты могут использовать разные типы платформ для извлечения, подготовки, анализа и визуализации этих данных для создания отчета о состоянии и работоспособности облачных ресурсов. 

У крупных предприятий должна быть стандартная платформа для мониторинга локальных систем, которую они могут расширить для интеграции журналов, созданных облачными развертываниями. С помощью [Log Analytics][https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-queries] организации могут хранить все журналы в облаке. Log Analytics реализуется как облачная служба. Поэтому подготовка к работе и запуск выполняются быстро и без значительных инвестиций в службы инфраструктуры. Кроме того, Log Analytics поддерживает интеграцию с компонентами System Center, такими как System Center Operations Manager, благодаря чему существующие инвестиции в средства управления также охватывают и облачные решения. 

Log Analytics — это служба в Azure, которая помогает выполнять сбор, сопоставление, поиск и действия в отношении данных журналов и производительности, созданных операционными системами, приложениями и облачными компонентами инфраструктуры. Эта служба предоставляет клиентам полезные сведения об операциях в реальном времени, используя интегрированный поиск и настраиваемые панели мониторинга для анализа всех записей всех рабочих нагрузок в ВЦОД.

[Наблюдатель за сетями Azure][NetWatch] предоставляет инструменты для мониторинга, диагностики, просмотра метрик и включения или отключения журналов для ресурсов в виртуальной сети Azure. Это многоаспектная служба, обеспечивающая следующие возможности:
-    мониторинг взаимодействия между виртуальной машиной и конечной точкой;
-    просмотр ресурсов и их связей в виртуальной сети;
-    диагностика проблем с фильтрацией входящего или исходящего трафика виртуальной машины;
-    диагностика проблем с сетевой маршрутизацией на виртуальной машине;
-    диагностика исходящих подключений виртуальной машины;
-    сбор пакетов, направляющихся в виртуальную машину и из нее;
-    диагностика проблем со шлюзом и подключениями виртуальной сети Azure;
-    определение относительных задержек между регионами Azure и поставщиками услуг Интернета;
-    просмотр правил безопасности для сетевого интерфейса;
-    просмотр метрик сети;
-    анализ трафика, направляющегося в группу безопасности сети или из нее;
-    просмотр журналов диагностики для сетевых ресурсов.

Решение [Монитор производительности сети][NPM] в Operations Management Suite предоставляет подробные сведения о сети, включая единое представление сетей Azure и локальных сетей. Это решение имеет отдельные функции мониторинга для ExpressRoute и общедоступных служб.

#### <a name="component-type-workloads"></a>Тип компонента: рабочие нагрузки
Именно здесь находятся ваши фактические приложения и службы. Команды разработчиков приложений также работают с этим компонентом большую часть времени.

Возможности рабочих нагрузок на самом деле безграничны. Ниже приведены несколько возможных типов рабочих нагрузок:

**Внутренние бизнес-приложения**— приложения для компьютера, которые являются чрезвычайно важными для выполняющихся корпоративных операций. У них есть некоторые общие характеристики:

-   **интерактивность** — данные вводятся и возвращаются результаты или отчеты;
-   **активное использование данных** — данные интенсивно используются с частым доступом к базам данных или другому хранилищу;
-   **интеграция** — интеграция с другими системами в пределах и за пределами организации.

**Веб-сайты для клиентов (для Интернета или внутреннего использования)**. Большинство приложений, взаимодействующих с Интернетом, — это веб-сайты. Azure позволяет запускать веб-сайты на виртуальной машине IaaS или на сайте [Службы приложений Microsoft Azure с помощью веб-приложений Azure][WebApps] (PaaS). Веб-приложения поддерживают интеграцию с виртуальными сетями, что позволяет развертывать веб-приложения в периферийной зоне ВЦОД. При использовании веб-сайтов с доступом в Интернет благодаря интеграции виртуальной сети вам не нужно предоставлять соответствующую конечную точку для своих приложений. Вместо этого вы можете использовать ресурсы через частные адреса, не маршрутизируемые в Интернет, из виртуальной частной сети.

**Большие данные и аналитика** Когда данные необходимо масштабировать до очень большого объема, базы данных могут не справиться с этим. Технология Apache Hadoop предлагает систему для параллельного запуска распределенных запросов в большом количестве узлов. Клиенты могут выполнять рабочие нагрузки данных на виртуальных машинах IaaS или в PaaS ([Azure HDInsight][HDI]). HDInsight поддерживает развертывание в виртуальной сети на основе расположения. Это решение можно развернуть в кластере в периферийной зоне ВЦОД.

**События и обмен сообщениями**. [Центры событий Azure][EventHubs] — это гипермасштабируемая служба обработки данных телеметрии. Она собирает, преобразовывает и хранит миллионы событий. Используемая в качестве распределенной платформы потоковой передачи, она гарантирует низкую задержку и позволяет настраивать время хранения. Так вы можете принимать большие объемы данных телеметрии в Azure и читать эти данные из нескольких приложений. Используя Центры событий, отдельный поток может поддерживать обработку конвейеров в режиме реального времени и на основе пакетов.

Вы можете реализовать высоконадежную облачную систему для обмена сообщениями между приложениями и службами, используя [Служебную шину Azure][ServiceBus]. Это решение обеспечивает асинхронный обмен сообщениями через брокер между клиентом и сервером, обработку сообщений в порядке поступления, а также предлагает возможность публикации и подписки.

[![10]][10]

### <a name="multiple-vdc-implementations"></a>Варианты реализации ВЦОД


Отдельный ВЦОД размещается в одном регионе. Он уязвим к простоям, которые могут охватывать весь регион. Клиентам, которым требуется более высокий уровень обслуживания согласно SLA, необходимо защитить службы, развернув один проект в нескольких ВЦОД в разных регионах.

Также мы рекомендуем рассмотреть еще несколько распространенных сценариев, требующих развертывания нескольких ВЦОД:

-   региональное или глобальное присутствие;
-   аварийное восстановление;
-   перенаправление трафика между центрами обработки данных

#### <a name="regional-and-global-presence"></a>региональное или глобальное присутствие
Центры обработки данных Azure присутствуют в разных регионах по всему миру. Выбирая вариант с несколькими центрами обработки данных Azure, клиенты должны учитывать два связанных фактора: географическое расстояние и задержку. Чтобы обеспечить оптимальное взаимодействие, клиентам необходимо рассчитать географическое расстояние между разными ВЦОД, а также расстояние между ВЦОД и пользователями.

Регион Azure, в котором размещаются ВЦОД, должен соответствовать нормативным требованиям, установленным законодательными органами, которым подчиняется организация.

#### <a name="disaster-recovery"></a>Аварийное восстановление
Реализация плана аварийного восстановления связана с типом соответствующей рабочей нагрузки и возможностью синхронизации состояния рабочей нагрузки между разными ВЦОД. В идеале, большинство клиентов хотят синхронизировать данные приложений между развертываниями, выполняющимися в двух разных ВЦОД, для реализации быстрой отработки отказа. Большинство приложений чувствительны к задержке, что может привести к потенциальному истечению времени ожидания и задержке синхронизации данных.

Для мониторинга синхронизации или пульса приложений в разных ВЦОД требуется настроить обмен данными между этими центрами. Два ВЦОД в разных регионах можно подключить следующим образом:

-   пиринг между виртуальными сетями для подключения концентраторов в разных регионах;
-   частный пиринг ExpressRoute, когда концентраторы ВЦОД подключены к одному каналу ExpressRoute;
-   несколько каналов ExpressRoute, подключенных через корпоративную магистраль, и одноранговая сеть ВЦОД, подключенная к каналам ExpressRoute;
-   VPN-подключения "сеть — сеть" между концентраторами ВЦОД в каждом регионе Azure.

Как правило, подключение ExpressRoute или пиринг между виртуальными сетями являются предпочтительными механизмами из-за более высокой пропускной способности и последовательной задержки при передаче через опорную сеть Майкрософт.

Для проверки приложения, распределенного между несколькими ВЦОД, расположенными в разных регионах, используется стандартный подход. Клиентам следует выполнить проверку сети, чтобы оценить задержку и пропускную способность подключений. Затем следует выбрать способ репликации данных (синхронный или асинхронный), а также определить оптимальное целевое время восстановления для рабочих нагрузок.

#### <a name="mechanism-to-divert-traffic-between-datacenters"></a>Механизм перенаправления трафика между центрами обработки данных
Один из эффективных способов перенаправления входящего трафика между разными ВЦОД — использование DNS. [Диспетчер трафика Azure][TM] использует механизм DNS, чтобы направлять трафик пользователей в наиболее оптимальную общедоступную конечную точку в ВЦОД. С помощью проб диспетчер трафика периодически проверяет работоспособность службы общедоступных конечных точек в разных ВЦОД. В случае сбоя этих конечных точек выполняется автоматическое перенаправление в дополнительный ВЦОД.

Диспетчер трафика работает в общедоступных конечных точках Azure. Например, он может управлять трафиком или перенаправлять его в виртуальные машины Azure и веб-приложения в соответствующем ВЦОД. Диспетчер трафика устойчив к сбоям, включая сбой всего региона Azure. Он управляет распределением пользовательского трафика для конечных точек службы в разных ВЦОД на основе нескольких критериев. Примеры — сбой службы в определенном ВЦОД или выбор ВЦОД с самой низкой задержкой сети для клиента.

### <a name="conclusion"></a>Заключение
ВЦОД — это решение для перемещения центра обработки данных в облако, которое использует разные функции и компоненты для создания масштабируемой архитектуры в Azure. Оно расширяет возможности использования облачных ресурсов, сокращает затраты и упрощает системное регулирование. Принцип работы ВЦОД основан на использовании топологии типа "звезда", которая предоставляет распространенные общие службы в концентраторе и позволяет размещать определенные приложения и рабочие нагрузки в периферийных зонах. ВЦОД соответствует структуре корпоративных ролей, которая координирует совместную работу разных отделов, Включая основную ИТ-группу, группу Azure DevOps, а также группы эксплуатации и обслуживания. Каждому отделу назначаются определенные роли и обязанности. Реализация ВЦОД соответствует требованиям к миграции **lift- and -shift**. Но это решение также предоставляет разные преимущества при выполнении собственных развертываний в облаке.

## <a name="references"></a>Ссылки
В этом руководстве рассмотрены следующие функции и компоненты:

| | | |
|-|-|-|
|Сетевые решения|Балансировка нагрузки|Соединение|
|[Виртуальная сеть Azure][VNet]</br>[Группы безопасности сети][NSG]</br>[Журналы групп безопасности сети][NSGLog]</br>[Определяемые пользователем маршруты][UDR]</br>[Сетевые виртуальные модули][NVA]</br>[Общедоступные IP-адреса][PIP]</br>[Защита от атак DDoS Azure][DDOS]</br>[Брандмауэр Azure][AzFW]</br>[Azure DNS][DNS]|[Azure Front Door][AFD]</br>[Azure Load Balancer (уровень 3)][ALB]</br>[Шлюз приложений (уровень 7)][AppGW]</br>[Брандмауэр веб-приложения][WAF]</br>[Диспетчер трафика Azure][TM]</br></br></br></br></br> |[Пиринг между виртуальными сетями][VNetPeering]</br>[Виртуальная частная сеть][VPN]</br>[Виртуальная глобальная сеть][vWAN]</br>[ExpressRoute][ExR]</br>[ExpressRoute Direct][ExRD]</br></br></br></br></br>
|Удостоверение</br>|Мониторинг</br>|Рекомендации</br>|
|[Azure Active Directory][AAD]</br>[Многофакторная идентификация][MFA]</br>[Управление доступом на основе ролей][RBAC]</br>[Роли Azure AD по умолчанию][Roles]</br></br></br> |[Наблюдатель за сетями][NetWatch]</br>[Azure Monitor][Monitor]</br>[Журнал действий][ActLog]</br>[Мониторинг журналов диагностики][DiagLog]</br>[Microsoft Operations Management Suite][OMS]</br>[Монитор производительности сети][NPM]|[Рекомендации по обеспечению сети периметра][DMZ]</br>[Управление подпиской][SubMgmt]</br>[Управление группой ресурсов][RGMgmt]</br>[Ограничения подписки Azure][Limits] </br></br></br>|
|Прочие службы Azure|
|[Веб-приложения][WebApps]</br>[HDInsight (Hadoop)][HDI]</br>[Центры событий][EventHubs]</br>[Служебная шина][ServiceBus]|

## <a name="next-steps"></a>Дополнительная информация
 - Ознакомьтесь с понятием [пиринга между виртуальными сетями][VNetPeering] — базовой технологией подключения в топологии типа "звезда", используемой в ВЦОД.
 - Реализуйте [Azure AD][AAD], чтобы приступить к работе с [RBAC][RBAC].
 - Разработайте модель управления ресурсами и подпиской, а также модель RBAC для обеспечения необходимой структуры, требований и политик организации. Планирование является самым важным действием. Учитывайте это при реорганизации, слиянии, реализации новых разработок и других возможностей.

<!--Image References-->
[0]: ./images/networking-redundant-equipment.png "Примеры совмещения компонентов" 
[1]: ./images/networking-vdc-high-level.png "Подробный пример звездообразной топологии в VDC"
[2]: ./images/networking-hub-spokes-cluster.png "Кластер со звездообразной топологией"
[3]: ./images/networking-spoke-to-spoke.png "Подключение типа "луч — луч" в звездообразной топологии"
[4]: ./images/networking-vdc-block-level-diagram.png "Схема VDC на уровне блоков"
[5]: ./images/networking-users-groups-subsciptions.png "Пользователи, группы, подписки и проекты"
[6]: ./images/networking-infrastructure-high-level.png "Общая схема инфраструктуры"
[7]: ./images/networking-highlevel-perimeter-networks.png "Общая схема инфраструктуры"
[8]: ./images/networking-vnet-peering-perimeter-neworks.png "Пиринг виртуальных сетей и сети периметра"
[9]: ./images/networking-high-level-diagram-monitoring.png "Общая схема мониторинга"
[10]: ./images/networking-high-level-workloads.png "Общая схема рабочих нагрузок"

<!--Link References-->
[Limits]: /azure/azure-subscription-service-limits
[Roles]: /azure/role-based-access-control/built-in-roles
[VNet]: /azure/virtual-network/virtual-networks-overview
[NSG]: /azure/virtual-network/virtual-networks-nsg
[DNS]: /azure/dns/dns-overview
[PrivateDNS]: /azure/dns/private-dns-overview
[VNetPeering]: /azure/virtual-network/virtual-network-peering-overview 
[UDR]: /azure/virtual-network/virtual-networks-udr-overview 
[RBAC]: /azure/role-based-access-control/overview
[MFA]: /azure/multi-factor-authentication/multi-factor-authentication
[AAD]: /azure/active-directory/active-directory-whatis
[VPN]: /azure/vpn-gateway/vpn-gateway-about-vpngateways 
[ExR]: /azure/expressroute/expressroute-introduction
[ExRD]: https://docs.microsoft.com/en-us/azure/expressroute/expressroute-erdirect-about
[vWAN]: /azure/virtual-wan/virtual-wan-about
[NVA]: /azure/architecture/reference-architectures/dmz/nva-ha
[AzFW]: /azure/firewall/overview
[SubMgmt]: /azure/architecture/cloud-adoption/appendix/azure-scaffold 
[RGMgmt]: /azure/azure-resource-manager/resource-group-overview
[DMZ]: /azure/best-practices-network-security
[ALB]: /azure/load-balancer/load-balancer-overview
[DDOS]: /azure/virtual-network/ddos-protection-overview
[PIP]: /azure/virtual-network/resource-groups-networking#public-ip-address
[AFD]: https://docs.microsoft.com/en-us/azure/frontdoor/front-door-overview
[AppGW]: /azure/application-gateway/application-gateway-introduction
[WAF]: /azure/application-gateway/application-gateway-web-application-firewall-overview
[Monitor]: /azure/monitoring-and-diagnostics/
[ActLog]: /azure/monitoring-and-diagnostics/monitoring-overview-activity-logs 
[DiagLog]: /azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs
[NSGLog]: /azure/virtual-network/virtual-network-nsg-manage-log
[OMS]: /azure/operations-management-suite/operations-management-suite-overview
[NPM]: /azure/log-analytics/log-analytics-network-performance-monitor
[NetWatch]: /azure/network-watcher/network-watcher-monitoring-overview
[WebApps]: /azure/app-service/
[HDI]: /azure/hdinsight/hdinsight-hadoop-introduction
[EventHubs]: /azure/event-hubs/event-hubs-what-is-event-hubs 
[ServiceBus]: /azure/service-bus-messaging/service-bus-messaging-overview
[TM]: /azure/traffic-manager/traffic-manager-overview

