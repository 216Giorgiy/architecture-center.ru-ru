---
title: Виртуальный центр обработки данных Azure. Перспектива сети
description: Узнайте, как создать виртуальный центр обработки данных в Azure
author: tracsman
manager: rossort
tags: azure-resource-manager
ms.topic: guide
ms.service: architecture-center
ms.subservice: enterprise-cloud-adoption
ms.custom: virtual-network
ms.date: 11/28/2018
ms.author: jonor
ms.openlocfilehash: 72b8bd7f49be990758aa10a42b9806e037e907e8
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59640997"
---
# <a name="azure-virtual-datacenter-a-network-perspective"></a>Виртуальный центр обработки данных Azure. Перспектива сети

## <a name="overview"></a>Обзор

Переместив локальные приложения в Azure, организации могут пользоваться преимуществами безопасной и экономичной инфраструктуры, даже если приложения переносятся с минимальными изменениями. Тем не менее для получения максимальной гибкости облачных вычислений организациям необходимо модернизировать свою архитектуру, чтобы использовать возможности Azure в полном объеме.

Microsoft Azure предоставляет гипермасштабируемые службы и инфраструктуру, а также надежность и возможности корпоративного класса. Эти службы и инфраструктура предлагают множество вариантов гибридного подключения, поэтому клиенты могут выбрать доступ к ним через общедоступный Интернет или через частное подключение Azure ExpressRoute. Кроме того, партнеры Майкрософт предоставляют расширенные возможности, предлагая службы безопасности и виртуальные устройства, оптимизированные для работы в Azure.

Клиенты могут обращаться к этим облачным службам через Интернет или с помощью службы Azure ExpressRoute, которая позволяет создавать подключения к частной сети. Платформа Microsoft Azure позволяет клиентам легко добавлять в свою инфраструктуру облачные решения и создавать многоуровневую архитектуру. Кроме того, партнеры Майкрософт предоставляют расширенные возможности, предлагая службы безопасности и виртуальные устройства, оптимизированные для работы в Azure.

## <a name="what-is-the-virtual-datacenter"></a>Что такое виртуальный центр обработки данных?

С самого начала облако являлось платформой для размещения общедоступных приложений. Предприятия начали понимать ценность облака и начали перемещать в него внутренние бизнес-приложения. Эти типы приложений обеспечили дополнительные параметры безопасности, надежности, производительности и стоимости, которым требовалась дополнительная гибкость способа предоставления облачных услуг. Именно поэтому были созданы новая инфраструктура и сетевые службы, разработанные для обеспечения этой гибкости, а также новые функции масштабирования, аварийного восстановления и другие возможности.

## <a name="what-is-a-virtual-datacenter"></a>Что такое виртуальный центр обработки данных?

Изначально облачные решения разрабатывались для размещения относительно изолированных отдельных приложений для общедоступного использования. Этот подход был оптимальным несколько лет. Затем преимущества облачных решений стали очевидными, и облака стали использоваться для размещения нескольких крупномасштабных рабочих нагрузок. При этом в контексте жизненного цикла облачной службы актуализировались вопросы, связанные с обеспечением безопасности, надежности и производительности, а также оптимизации затрат для развертываний в одном или нескольких регионах.

На следующей схеме облачного развертывания **красным прямоугольником** обозначена область с недостаточным уровнем защиты. **Желтый прямоугольник** показано место для оптимизации сетевых виртуальных устройств для рабочих нагрузок.

[![0]][0]

Виртуальный центр обработки данных (VDC) – концепция, которая появилась из необходимости обеспечить масштабирование для поддержки корпоративных рабочих нагрузок и в то же время устранить проблемы, возникающие при поддержке масштабных приложений в общедоступном облаке.

Реализация виртуального центра обработки данных не только представляет рабочие нагрузки приложения в облаке, но и обеспечивает сетевые подключения, безопасность, управление и инфраструктуру (например, DNS и службы каталогов). По мере того как все больше корпоративных рабочих нагрузок в Azure, важно подумать о поддержке инфраструктуры и объекты, которые эти рабочие нагрузки, помещаются в. Верное понимание того, как структурированы ресурсы, может помочь избежать распространения сотен "островов рабочих нагрузок", которым требуется отдельное управление с независимым потоком данных, моделями безопасности и подходом к решению проблем соответствия требованиям.

Концепция виртуального центра обработки данных – это набор рекомендаций для реализации коллекции отдельных объектов, связанных между собой общими вспомогательными функциями, возможностями и инфраструктурой. Рассматривая рабочие нагрузки через группу связанных элементов виртуального центра обработки данных, становятся очевидными такие преимущества, как потенциальная экономия затрат на масштабирование ресурсов, оптимизированная безопасность за счет централизации потока данных и компонентов, а также упрощение операций, управления и проверок на соответствие требованиям.

> [!NOTE]
> Важно понимать, что виртуальный центр обработки данных – это **НЕ** отдельный продукт Azure, а сочетание различных функций и возможностей, которое позволяет обеспечить полное соответствие вашим требованиям. ВЦОД помогает оптимизировать использование ресурсов Azure и рабочих нагрузок, расширяя возможности работы с облаком. Это модульный подход к созданию ИТ-служб в Azure при соблюдении организационных ролей и обязанностей предприятия.

Реализация виртуального центра обработки данных может помочь предприятиям реализовать следующие сценарии для рабочих нагрузок и приложений в Azure:

- размещение нескольких связанных рабочих нагрузок;
- перенос рабочих нагрузок из локальной среды в Azure;
- обеспечение общей или централизованной защиты и доступности рабочих нагрузок;
- сбалансированное применение ролей централизованной ИТ-команды и команды Azure DevOps в рамках крупного предприятия.

Преимущества виртуального центра обработки данных обеспечиваются централизованной звездообразной топологией сети, а также такими службами и компонентами Azure, как:

* [Виртуальная сеть Azure][VNet],
* [Группы безопасности сети][NSG],
* [Пиринг виртуальной сети][VNetPeering],
* [Определенные пользователем маршруты (UDR)][UDR], а также
* Идентификатор Azure с [управлением доступом на основе ролей (RBAC)][RBAC] и при необходимости [брандмауэром Azure][AzFW], [Azure DNS][DNS], [Azure Front Door][AFD] и [Виртуальная глобальная сеть Azure][vWAN].

## <a name="who-should-implement-a-virtual-datacenter"></a>Кто отвечает за реализацию виртуального центра обработки данных?

Любой клиент Azure, принявший решение использовать облако, может выиграть за счет эффективной настройки набора ресурсов для общего использования всеми приложениями. В зависимости от масштабов использование шаблонов и компонентов, применяемых для реализации виртуального центра обработки данных, может оказаться эффективным даже для отдельных приложений.

Если у вашей организации есть централизованные отделы или команды, которые занимаются информационными и сетевыми технологиями, а также обеспечением безопасности и соответствия требованиям, виртуальный центр обработки данных поможет вам реализовать политики, разделить обязанности, обеспечить единообразие базовых общих компонентов и предоставить при этом командам разработчиков необходимый уровень свободы действий в соответствии с вашими требованиями.

Организации, которые предпочитают DevOps, также могут использовать основные концепции виртуального центра обработки данных для предоставления авторизованных групп ресурсов Azure, а также обеспечить полный контроль в таких группах (на уровне подписки или группе ресурсов в общей подписке). При этом границы безопасности и сети будут соответствовать стандартам, определенным централизованной политикой в центральной виртуальной сети и группе ресурсов.

## <a name="considerations-for-implementing-a-virtual-datacenter"></a>Рекомендации по реализации виртуального центра обработки данных

При разработке реализации виртуального центра обработки данных стоит рассмотреть следующие критически важные вопросы:

### <a name="identity-and-directory-service"></a>Службы удостоверений и каталогов

Службы идентификации и каталогов – главный компонент всех центров обработки данных как в локальной, так и в облачной среде. Удостоверения связаны со всеми аспектами авторизации пользователей и их доступа к службам в пределах реализации виртуального центра обработки данных. Чтобы обеспечить доступ к учетной записи и ресурсам Azure только авторизованным пользователям и процессам, Azure использует несколько типов учетных данных для аутентификации. К ним относятся пароли (для доступа к учетной записи Azure), криптографические ключи, цифровые подписи и сертификаты. [Многофакторная идентификация Azure (MFA)][MFA] – это дополнительный слой обеспечения безопасности для получения доступа к службам Azure. Azure MFA обеспечивает надежную проверку подлинности с использованием ряда простых вариантов подтверждения &mdash; телефонный звонок, текстовое сообщение или уведомление мобильного приложения &mdash; и позволять клиентам выбирать предпочтительный.

Любое крупное предприятие должно разработать процесс управления удостоверениями с описанием принципов управления индивидуальными удостоверениями, их проверки подлинности, авторизации, использования ролей и привилегий в виртуальном центре обработки данных. Цели такого процесса — повышение безопасности и производительности при одновременном снижении затрат, времени простоя, а также повторяющихся и выполняемых вручную задач.

Предприятиям или организациям может потребоваться нужное сочетание служб для различных бизнес-приложений, так как сотрудники часто используют разные роли при работе с различными проектами. ВЦОД требует слаженного взаимодействия между разными командами, для каждой из которых предусмотрены конкретные определения ролей. Все это позволяет надлежащим образом управлять рабочими системами. Процесс назначения обязанностей, разрешений и прав может быть очень непростым. Управление удостоверениями в виртуальном центре обработки данных реализуется с помощью [Azure Active Directory *(Azure AD)*][AAD] и управления доступом на основе ролей (RBAC).

Служба каталогов — это общая информационная инфраструктура для поиска, администрирования и организации ежедневно используемых элементов и сетевых ресурсов. Эти ресурсы могут включать тома, папки, файлы, принтеры, пользователей, группы, устройства и другие объекты. Каждый ресурс в сети считается объектом сервера каталогов. Сведения о ресурсе хранятся в виде коллекции атрибутов, связанных с этим ресурсом или объектом.

Все бизнес-службы Microsoft Online используют Azure Active Directory (Azure AD) для входа и других задач, связанных с идентификацией. Azure Active Directory (Azure AD) — это комплексное высокодоступное облачное решение для управления удостоверениями и доступом, предоставляющее базовые службы каталогов, расширенные функции управления удостоверениями и функции управления доступом к приложениям. Azure AD можно интегрировать с локальным экземпляром Active Directory для включения единого входа для всех облачных и локальных приложений. Атрибуты пользователя локальной службы Active Directory могут автоматически синхронизироваться с Azure AD.

Для назначения всех разрешений в виртуальном центре обработки данных не требуется отдельный глобальный администратор. Вместо этого получить разрешения, необходимые для управления собственными ресурсами в виртуальном центре обработки данных, может каждый отдел (группа пользователей или служб в службе каталогов). Структурирование разрешений требует балансировки. Большое количество разрешений может препятствовать оптимальной производительности, а недостаточное или отсутствие некоторых — может повысить риски для системы безопасности. Управление доступом на основе ролей (RBAC) Azure помогает решить эту задачу, обеспечивая точное управление доступом для ресурсов в виртуальном центре обработки данных.

#### <a name="security-infrastructure"></a>инфраструктуру безопасности;

Инфраструктура безопасности относится к разделению трафика в конкретном сегменте виртуальной сети реализации виртуального центра обработки данных. Эта инфраструктура определяет, как в реализации виртуального центра обработки данных контролируются входящий и исходящий трафик. В основе Azure лежит мультитенантная архитектура, которая предотвращает несанкционированный и непреднамеренный трафик между развертываниями, используя изоляцию виртуальной сети (VNet), списки управления доступом (ACL), подсистемы балансировки нагрузки, IP-фильтры и политики потока трафика. Преобразование сетевых адресов (NAT) отделяет внутренний и внешний сетевой трафик.

Структура Azure выделяет ресурсы инфраструктуры для рабочих нагрузок клиента и управляет исходящим и входящим обменом данными виртуальных машин. Низкоуровневая оболочка Azure принудительно разделяет память и процессы между виртуальными машинами и обеспечивает безопасную передачу сетевого трафика клиентам гостевой ОС.

#### <a name="connectivity-to-the-cloud"></a>подключения к облаку;

Для реализации виртуального центра обработки данных требуется подключение к внешним сетям, чтобы предлагать службы клиентам, партнерам и/или внутренним пользователям. Эта потребность в возможности подключения касается не только Интернета, но также локальных сетей и центров обработки данных.

Пользователи управляют доступом к службам из Интернета с помощью [Брандмауэра Azure][AzFW] или других видов сетевых виртуальных модулей (NVA), пользовательских политик маршрутизации с использованием [определяемых пользователем маршрутов][UDR], а также сетевой фильтрации с использованием [групп безопасности сети][NSG]. Рекомендуется, чтобы все связанные с Интернетом ресурсы были дополнительно защищены с помощью [Защиты от атак DDoS уровня "Стандартный"][DDOS].

Предприятиям может потребоваться подключать виртуальный центр обработки данных к локальным центрам обработки данных или другим ресурсам. Эта возможность подключения между Azure и локальными сетями – важный аспект при проектировании эффективной архитектуры. Предприятия могут использовать два разных способа, чтобы обеспечить это взаимодействие: подключение через Интернет и/или частные прямые соединения.

[**VPN-подключение Azure типа "сеть-сеть"**][VPN] – это служба взаимодействия локальных сетей и виртуального центра обработки данных через Интернет, которое реализуется через защищенные зашифрованные подключения (туннели IPsec или IKE). Подключение типа "сеть — сеть" Azure — это гибкое подключение, которое можно быстро создать. Оно не требует последующего снабжения, так как все подключения выполняются через Интернет.

Используемая для большого количества VPN-подключений, [**Виртуальная глобальная сеть Azure**][vWAN] – это сетевая служба, которая обеспечивает оптимизированное и автоматизированное подключение "ветвь-ветвь" через Azure. Виртуальная глобальная сеть позволяет подключать и настраивать устройства ветви для взаимодействия с Azure. Подключение и настройку можно выполнить вручную или с помощью устройств провайдеров через партнера виртуальной глобальной сети. Использование нужных устройств провайдеров позволяет облегчить использование, подключение и управление конфигурацией. Встроенная панель управления глобальной виртуальной сетью Azure обеспечивает мгновенное устранение неполадок, что экономит время и предоставляет простой способ просмотра широкомасштабных подключений типа "сайт — сайт".

[**ExpressRoute**][ExR] – это служба подключения Azure, которая позволяет создавать частные подключения между реализацией виртуального центра обработки данных и любыми локальными сетями. Подключения ExpressRoute не осуществляются через общедоступный Интернет и обеспечивают повышенный уровень безопасности, надежности и быстродействия (до 10 Гбит/с) с низкими и последовательными задержками. ExpressRoute подходит для использования с виртуальным центром обработки данных, так как клиенты ExpressRoute могут получить преимущества правил соответствия, связанных с частными подключениями. С помощью [ExpressRoute Direct][ExRD], вы можно подключиться непосредственно к маршрутизаторы Майкрософт на 100 Гбит/с для клиентов с большего размера требования к пропускной способности.

Развертывание подключений ExpressRoute обычно требует участия поставщика услуг ExpressRoute. Для клиентов, которым необходимо быстро приступить к работе, рекомендуется поначалу использовать VPN-подключения типа "сеть-сеть", чтобы установить подключение между виртуальным центром обработки данных и локальными ресурсами, а после выбрать подключение ExpressRoute, когда выполнено ваше физическое соединение с поставщиком услуг.

#### <a name="connectivity-within-the-cloud"></a>*Подключения в облаке*

[Виртуальные сети][VNet] и [пиринг виртуальных сетей][VNetPeering] – основные сетевые службы подключения в виртуальном центре обработки данных. Виртуальная сеть гарантирует естественную границу изоляции для ресурсов VDC, а пиринг виртуальных сетей разрешает внутренние взаимодействия между различными виртуальными сетями в одном или даже в разных регионах Azure. Управление трафиком внутри виртуальной сети и между виртуальными сетями требуется в соответствии с набором правил безопасности, заданных через списки управления доступом ([группы безопасности сети][NSG]), [виртуальных сетевых устройств ] [ NVA]и настраиваемые таблицы маршрутизации ([UDR][UDR]).

## <a name="virtual-datacenter-overview"></a>Общие сведения о ВЦОД

### <a name="topology"></a>Топология

_Звезда_ – это модель проектирования топологии сети для реализации виртуального центра обработки данных.

[![1]][1]

Центральная зона (концентратор) контролирует и проверяет входящий и исходящий трафик между разными зонами, включая Интернет, а также локальные периферийные зоны. Топология типа "звезда" позволяет ИТ-отделу применять политики безопасности в центральном расположении, одновременно минимизируя уязвимости и ошибки в конфигурации.

В центре содержатся общие компоненты службы, используемые периферийными зонами. Их примеры представлены ниже.

- Инфраструктура Windows Active Directory для проверки подлинности внешних пользователей, которые пытаются получить доступ из ненадежных сетей, до предоставления таким пользователям доступа к рабочим нагрузкам в периферийных зонах. Сюда входят связанные службы федерации Active Directory (AD FS).
- Служба DNS для разрешения имен рабочих нагрузок в периферийных зонах и получения доступа к ресурсам локально и в Интернете, если [Azure DNS][DNS] не используется.
- Инфраструктура открытых ключей (PKI) для реализации единого входа в рабочие нагрузки.
- Управление TCP- и UDP-трафиком между зонами периферийными зонами и Интернетом.
- Управление потоком между периферийными зонами и локальными ресурсами.
- Управление потоком между несколькими периферийными зонами (при необходимости).

VDC снижает общую стоимость за счте использования общей центральной инфраструктуры между несколькими периферийными зонами.

Роль каждой периферийной зоны может заключаться в размещении различных типов рабочих нагрузок. Использование периферийных зон также позволяют реализовать модульный подход для повторяемых развертываний одних и тех же рабочих нагрузок в среде разработки и тестирования, пользовательского приемочного тестирования, а также подготовительной и рабочей среде. Также эти зоны можно использовать для разделения и включения различных групп в пределах организации, например, групп DevOps в Azure. В пределах периферийной зоны можно развернуть базовую рабочую нагрузку или сложные многоуровневые рабочие нагрузки с управлением трафиком между уровнями.

#### <a name="subscription-limits-and-multiple-hubs"></a>Ограничения подписки и несколько центральных зон

В Azure каждый компонент (независимо от типа) развертывается в подписке Azure. Изоляция компонентов Azure в разных подписках Azure может удовлетворять требования различных бизнес-приложений, например настройку дифференцированных уровней доступа и авторизации.

Единую реализацию виртуального центра обработки данных можно масштабировать для большого количества периферийных зон, несмотря на то что, как и в случае с любой ИТ-системой, существуют ограничения платформы. Развертывание концентратора привязано к определенной подписке Azure с установленными ограничениями (например, максимальное число пиринга виртуальных сетей;. дополнительные сведения см. в статье [Подписка Azure, границы, квоты и ограничения службы][Limits]). В случаях, когда ограничения становятся проблемой, архитектуру можно далее масштабировать, расширяя отдельную звездообразную модель до кластера. Несколько концентраторов в одном или нескольких регионах Azure могут быть взаимосвязаны с помощью пиринга виртуальных сетей, подключения ExpressRoute, Виртуальной глобальной сети или VPN типа "сеть — сеть".

[![2]][2]

Включение нескольких концентраторов приводит к увеличению затрат и действий по управлению системой. Он может быть оправдано только соответствующей масштабируемости, ограничения системы или избыточности и региональной репликацией для повышения производительности конечного пользователя или аварийного восстановления. В сценариях, требующих несколько концентраторов, все концентраторы должны обеспечивать один набор служб для упрощения выполнения операций.

#### <a name="interconnection-between-spokes"></a>Взаимодействие между периферийными зонами

Внутри отдельной периферийной зоны можно реализовать сложных многоуровневых рабочих нагрузках. Многоуровневые конфигурации можно реализовать с помощью подсетей (одна подсеть для каждого уровня) в одной виртуальной сети и фильтрации потоков с помощью групп безопасности сети.

Архитектор может развернуть многоуровневую рабочую нагрузку в пределах нескольких виртуальных сетей. Используя пиринг между виртуальными сетями, периферийные зоны могут подключаться к другим периферийным зонам в пределах одного или нескольких концентраторов. Типичным примером такого сценария является случай, когда серверы обработки приложения располагаются в одной периферийной зоне или виртуальной сети, а база данных развернута в другой периферийной зоне или виртуальной сети. В этом случае периферийные зоны могут легко обмениваться данными через пиринговые виртуальные сети, не используя при этом концентратор. При этом требуется тщательно проверить архитектуру и систему безопасности, чтобы обход концентратора не сопровождался обходом важных элементов безопасности или аудита, которые могут существовать только в концентраторе.

[![3]][3]

Периферийные зоны могут также взаимодействовать с периферийной зоной, выполняющей функции концентратора. Этот подход создает двухуровневую иерархию: Периферийная зона высокого уровня (уровень 0) становится концентратором подчиненных периферийных зон (уровень 1) иерархии. Периферийные зоны виртуального центра обработки данных реализации являются обязательными для переадресации трафика в центральный концентратор, чтобы трафик может проходить в место назначения в локальной сети или Интернету. Архитектура с двумя уровнями концентраторов представляет сложную маршрутизацию, который удаляет преимущества звездообразной связи.

Несмотря на то что Azure допускает сложные топологии, одним из основных принципов концепции VDC является повторяемость и простота. Чтобы свести к минимуму действия по управлению системой, в качестве эталонной архитектуры ВЦОД рекомендуется использовать простую топологию тира "звезда".

### <a name="components"></a>Компоненты

Виртуальный центр обработки данных состоит из компонентов четырех базовых типов: **инфраструктуры**, **сетей периметра**, **рабочих нагрузок** и **мониторинга**.

Каждый тип компонента состоит из различных функций и ресурсов Azure. Ваш виртуальный центр обработки данных состоит из экземпляров нескольких типов компонентов и нескольких вариантов одного типа компонента. Например, у вас может быть много разных, логически разделенных экземпляров рабочей нагрузки, представляющих разные приложения. В конечном итоге все эти различные экземпляры и типы компонентов используются для создания VDC.

[![4]][4]

На схеме высокоуровневой архитектуры виртуального центра обработки данных выше показаны разные типы компонентов, которые используются в различных зонах звездообразной топологии. На схеме показаны компоненты инфраструктуры в различных частях архитектуры.

В общем рекомендуется, чтобы права доступа и привилегии предоставлялись на основе группы. Работа с группами, а не отдельным пользователям упрощает обслуживание политик доступа, предоставляя согласованный способ управления группами, а также помогает минимизировать ошибки конфигурации. Назначение и удаление пользователей в соответствующих группах позволит обеспечить актуальность привилегий определенного пользователя.

Каждая группа роли должна содержать уникальный префикс в своем имени, позволяя легко определять связь между определенной группой и определенной рабочей нагрузкой. Например, рабочая нагрузка, размещающая службы проверки подлинности, должна содержать группы с именами **AuthServiceNetOps**, **AuthServiceSecOps**, **AuthServiceDevOps** и **AuthServiceInfraOps**. Для централизованных ролей или ролей, не связанных с определенной службой, должен использоваться префикс **Corp**, например, **CorpNetOps**.

Многие организации используют разновидность следующих групп для предоставления основной декомпозиции ролей:

- Центральная ИТ-группа **Corp**, имеет права владения для управления компонентами инфраструктуры. Примерами являются сетевые компоненты и система безопасности. Группе должна быть назначена роль участника в подписке, а также предоставлены права управления концентратором и права участника сети в периферийных зонах. Крупные организации часто разделяют эти функции между несколькими командами. Примеры — команда, отвечающая за сетевые операции (**CorpNetOps**), которая фокусируется на сетевых компонентах, а также команда, отвечающая за операции системы безопасности (**CorpSecOps**), которая фокусируется на политиках безопасности и брандмауэра. В этом конкретном случае требуется создание двух разных групп для назначения этих пользовательских ролей.
- Группа разработки и тестирования **AppDevOps** отвечает за развертывание рабочих нагрузок (приложений или служб). Эта группа выполняет роль участника виртуальной машины для развертываний IaaS, а также одну или несколько ролей участника PaaS. См. дополнительные сведения о [встроенных ролях для ресурсов Azure][Roles]. При необходимости группе разработки и тестирования может потребоваться право на просмотр политик безопасности, групп безопасности сети и политик маршрутизации в пределах концентратора или определенной периферийной зоны. Кроме ролей участника для рабочих нагрузок этой группе также потребуется роль читателя сетей.
- Группа операций и обслуживания (**CorpInfraOps** или **AppInfraOps**) отвечает за управление рабочими нагрузками в рабочей среде. Эта группа должна быть участником подписки для рабочих нагрузок в любой рабочей подписке. Некоторые организации могут также определить необходимость в дополнительной эскалации группы службы поддержки с помощью роли участника подписки в рабочей среде и подписке центрального концентратора. Это позволит им решить потенциальные проблемы с конфигурацией в рабочей среде.

Виртуальный центр обработки данных разработана таким образом, чтобы группы, созданные для центрального ИТ-отдел, управляющих концентратором, содержат соответствующие группы на уровне рабочей нагрузки. Кроме управления ресурсами концентратора только центральные ИТ-группы могут управлять внешним доступом и разрешениями верхнего уровня в подписке. Группы рабочей нагрузки также — возможность управлять ресурсами и разрешениями своих виртуальных сетей, независимо от центрального ИТ.

Виртуальный центр обработки данных секционирован для безопасного размещения нескольких проектов в различных сферах деятельности (LOB). Всем проектам необходимы разные изолированные среды (разработки, UAT, рабочая среда). Отдельные подписки Azure для каждой из этих сред обеспечивают естественную изоляцию.

[![5]][5]

На предыдущей схеме показана связь между проектами организации, пользователями, группами и средами, в которых развернуты компоненты Azure.

Обычно в сфере ИТ среда (или уровень) представляет систему, в которой развертываются и выполняются несколько приложений. Крупные предприятия используют среду разработки (где внести изменения и тестировать) и рабочую среду (которую используют пользователи). Эти среды отделены, часто с помощью нескольких промежуточных сред, что позволяет выполнять поэтапное развертывание, тестирование и откат в случае возникновения проблем. Архитектуры развертывания сильно различаются, но обычно соблюдается основной процесс начала развертывания (разработка) и окончания развертывания (рабочая среда).

Общая архитектура для этих типов многоуровневых сред включает среду Azure DevOps для разработки и тестирования, среду UAT (промежуточная среда) и рабочую среду. Организации могут использовать один или несколько клиентов Azure AD для определения доступа к этим средам и соответствующих прав. На предыдущей схеме показана ситуация, когда используются два разных клиента Azure AD: один для DevOps и UAT, а другой — исключительно для рабочей среды.

Наличие разных клиентов Azure AD обеспечивает разделение между средами. Одна группа пользователей (например, центральная ИТ-команда) должна пройти проверку подлинности с помощью другого URI, чтобы получить доступ к другому клиенту AD и изменить роли или разрешения Azure DevOps или рабочих сред проекта. Выполнение проверки подлинности другого пользователя для доступа к другим средам минимизирует возможные простои и предотвращает появление других проблем, вызванных человеческим фактором.

#### <a name="component-type-infrastructure"></a>Тип компонента: Инфраструктура

В этом типе компонента размещается большая часть вспомогательной инфраструктуры. Здесь также проводят большую часть времени группы централизованной ИТ-инфраструктуры и группы по обеспечению соответствия требованиям и безопасности.

[![6]][6]

Компоненты инфраструктуры обеспечивают взаимодействие для различных компонентов виртуального центра обработки данных и присутствуют в концентраторе и периферийных зонах. Ответственность за управление компонентами инфраструктуры и их обслуживание обычно возлагается на группу централизованной ИТ-инфраструктуры или группу безопасности.

Одна из основных задач группы ИТ-инфраструктуры — обеспечение согласованности схем IP-адреса на предприятии. Диапазон частных IP-адресов, назначенный виртуальным центром обработки данных, должен быть согласован и не должен перекрываться с IP-адресами, назначенными локальным сетям.

Хотя преобразование NAT в локальных пограничных маршрутизаторах или средах Azure может помочь избежать конфликтов IP-адресов, оно усложняет работу компонентов инфраструктуры. Простота управления – одна из основных целей использования виртуального центра обработки данных, поэтому мы не рекомендуем применять преобразование сетевых адресов для обхода конфликта IP-адресов.

Инфраструктура включает следующие компоненты:

- [**Службы удостоверений и каталогов**][AAD]. Доступ к каждому типу ресурса в Azure регулируется удостоверением, хранящимся в службе каталогов. В службе каталогов хранится не только список пользователей, но также права доступа к ресурсам в определенной подписке Azure. Эти службы могут существовать только в облаке или их можно синхронизировать с локальным удостоверением, хранящимся в Active Directory.
- [**Виртуальная сеть**][VPN]. Виртуальные сети – это один из основных компонентов виртуального центра обработки данных. Они позволяют создавать границы изоляции трафика на платформе Azure. Виртуальная сеть состоит из одного или нескольких сегментов виртуальной сети, каждый из которых содержит определенный сетевой префикс IP-адреса (подсеть). Виртуальная сеть определяет внутреннюю область периметра, где виртуальные машины IaaS и службы PaaS могут устанавливать конфиденциальный канал связи. Виртуальные машины (и службы PaaS) в одной виртуальной сети не могут напрямую обращаться к виртуальным машинам (и службам PaaS) в другой виртуальной сети, даже если обе виртуальные сети созданы одним клиентом в одной подписке. Это критически важное свойство, которое гарантирует, что виртуальные машины и все коммуникации клиента останутся закрытыми в пределах виртуальной сети.
- [**UDR**][UDR]. Трафик в виртуальной сети перенаправляется по умолчанию на основе системной таблицы маршрутизации. Маршрут, определенный пользователем, представляет настраиваемую таблицу маршрутизации, которую сетевые администраторы могут связать с одной или несколькими подсетями, чтобы перезаписать поведение системной таблицы маршрутизации и определить путь обмена данными в виртуальной сети. Наличие маршрутов, определенных пользователем, гарантирует, что исходящий трафик из периферийной зоны проходит через определенные настраиваемые виртуальные машины, сетевые виртуальные устройства и подсистемы балансировки нагрузки в концентраторе и периферийных зонах.
- [**Группа безопасности сети (NSG)**][NSG]. Группа безопасности сети приведен список правил безопасности, которые действуют как фильтрация трафика для источников IP-адреса, IP-адрес назначения, протоколы, порты IP-адрес источника и порты назначения IP-адреса. Эти группы можно применить к подсети, виртуальной плате сетевого адаптера, связанной с виртуальной машиной Azure или и к тому, и к другому. Группы безопасности сети необходимы для реализации правильного управления потоком в концентраторе и периферийных зонах. Уровень безопасности, обеспечиваемый этой группой, определяется функцией, с помощью которой вы можете открыть определенные порты для определенной цели. Клиенты должны применить дополнительные фильтры для каждой виртуальной машины с помощью брандмауэров на основе узла, например iptables или брандмауэра Windows.
- [**DNS**][DNS]. Разрешение имен ресурсов в виртуальных сетях реализации виртуального центра обработки данных обеспечивается через службу доменных имен (DNS). Azure предоставляет службы DNS как для [общедоступного][DNS], так и для [частного][PrivateDNS] разрешения имен. Частные зоны обеспечивают разрешение имен внутри виртуальной сети и между виртуальными сетями. Частные зоны могут не только охватывать виртуальные сети в том ж регионе, но также сети в разных регионах и подписках. Для общедоступного разрешения Azure DNS предоставляет службу размещения для доменов DNS, которая в свою очередь предоставляет разрешение имен с помощью инфраструктуры Microsoft Azure. Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, API и инструментов и оплачивать использование, как и другие службы Azure.
- [**Подписка**][SubMgmt] и [**управление группой ресурсов**][RGMgmt]. Подписка определяет естественную границу, чтобы создать несколько групп ресурсов в Azure. Ресурсы в подписке собраны вместе в логические контейнеры, которые называются группами ресурсов. Группа ресурсов представляет собой логическую группу для организации ресурсов реализации виртуального центра обработки данных.
- [**RBAC**][RBAC]. Через RBAC можно сопоставить роль в организации с правами доступа к определенным ресурсам Azure, позволяя предоставить пользователям разрешения только на определенный набор действий (т. е. ограничить их). С помощью RBAC доступ предоставляется путем назначения соответствующей роли пользователям, группам и приложениям в определенной области. Областью назначения роли может быть подписка Azure, группа ресурсов или отдельный ресурс. RBAC разрешает наследование разрешений. Роли, назначенной в родительской области, предоставляется доступ также к содержащимся в ней дочерним элементам. С помощью RBAC вы можете распределить обязанности и предоставить пользователям доступ на уровне, который им необходим для выполнения поставленных задач. Например, можно использовать RBAC, чтобы разрешить одному сотруднику управлять виртуальными машинами в подписке, а другому — управлять в ней базами данных SQL.
- [**Пиринговая связь между виртуальными сетями**][VNetPeering]. Основная функция, используемая для создания инфраструктуры виртуального центра обработки данных, – пиринг виртуальных сетей. Это механизм, который соединяет две виртуальные сети в одном регионе через сеть центра обработки данных Azure или с помощью международной магистрали Azure для сетей в разных регионах.

#### <a name="component-type-perimeter-networks"></a>Тип компонента: сети периметра

Компоненты [сети периметра][DMZ] обеспечивают сетевые подключения между локальными или физическими сетями центра обработки данных, а также двухстороннюю связь с Интернетом. Сетевые группы и группы по обеспечению безопасности также проводят здесь большую часть времени.

Прежде чем попасть на внутренние серверы в периферийных зонах, входящие пакеты должны пройти через устройства безопасности в концентраторе, такие как брандмауэры, IDS и IPS. Пакеты, направленные в Интернет рабочими нагрузками, также должны пройти через защитные устройства сети периметра перед выходом из сети. Это удобно для применения политик, выполнения проверок и аудита.

Компоненты сети периметра предоставляют следующие возможности:

- [виртуальные сети][VNet], [определяемые пользователем маршруты][UDR] и [группы безопасности сети][NSG];
- [сетевые виртуальные модули][NVA];
- [Azure Load Balancer][ALB];
- [Шлюз приложений Azure][AppGW] и [брандмауэр веб-приложения (WAF)][WAF];
- [Общедоступные IP-адреса][PIP].
- [Azure Front Door][AFD]
- [Брандмауэр Azure][AzFW]

Как правило, центральная ИТ-команда и команда по обеспечению безопасности отвечают за определение требований и операций в сетях периметра.

[![7]][7]

На предыдущей схеме показано применение двух периметров с доступом в Интернет и локальную сеть. Оба периметра располагаются в концентраторах сети периметра и виртуальной глобальной сети. В концентраторе сети периметра сеть с доступом в Интернет можно масштабировать для поддержки большого количества бизнес-приложений с помощью нескольких ферм брандмауэров веб-приложения (WAF) и/или брандмауэров Azure. В концентраторе виртуальной глобальной сети высокомасштабируемые подключения типа "ветвь-ветвь" и "ветвь-Azure" осуществляются через VPN-подключение или ExpressRoute.

[**Виртуальные сети**][VNet]. Обычно концентратор создается в виртуальной сети с несколькими подсетями для размещения другого типа служб, выполняющих фильтрацию и анализ трафика в Интернет и обратно через NVA, WAF и экземпляры Шлюзов приложения Azure.

[**UDR**][UDR]. С помощью UDR клиенты могут развернуть брандмауэр, устройство IDS/IPS или другие виртуальные устройства и направить сетевой трафик через эти устройства безопасности, что позволяет применять, контролировать и проверять политики границ безопасности. UDR можно создать в концентраторе и периферийных зонах для обеспечения передачи трафика через определенные пользовательские виртуальные машины, виртуальные сетевые устройства и подсистемы балансировки нагрузки, используемые виртуальным центром обработки данных. Чтобы гарантировать, что трафик, созданный виртуальными машинами, находящимися в периферийной зоне изменится на правильный виртуальные устройства, определяемый пользователем Маршрут должен задаваться в подсетях периферийной зоны, настроив интерфейсный IP-адрес внутреннего балансировщика нагрузки, как следующий прыжок. Внутренняя подсистема балансировки нагрузки распределяет внутренний трафик на виртуальные устройства (внутренний пул подсистемы балансировки нагрузки).

[**Брандмауэр Azure**][AzFW] — это управляемая облачная служба сетевой безопасности, которая защищает ресурсы виртуальной сети Azure. Это высокодоступная служба с полным отслеживанием состояния и неограниченными возможностями облачного масштабирования. Вы можете централизованно создавать, применять и регистрировать политики приложений и сетевых подключений в подписках и виртуальных сетях. Брандмауэр Azure использует статический общедоступный IP-адрес для ресурсов виртуальной сети. Он разрешает внешним брандмауэрам идентифицировать трафик, поступающий из вашей виртуальной сети. Служба полностью интегрирована с Azure Monitor для ведения журналов и аналитики.

[**Сетевые виртуальные устройства**][NVA]. В концентраторе сеть периметра с доступом в Интернет обычно управляется с помощью экземпляра Брандмауэра Azure, фермы брандмауэров или брандмауэров веб-приложений (WAF).

Разные бизнес-приложения обычно используют многие веб-приложения, которые, как правило, являются уязвимыми. Брандмауэры веб-приложений — это особый тип продукта, используемый для обнаружения атак, направленных на веб-приложения (HTTP и HTTPS). Это отличает их от обычных брандмауэров. По сравнению с традиционными брандмауэрами WAF содержит набор специальных функций для защиты внутренних веб-серверов от угроз.

Как брандмауэр Azure, так и брандмауэр NVA используют общую панель администрирования с набором правил безопасности для защиты рабочих нагрузок, размещенных в периферийных зонах, а также управления доступом к локальным сетям. Брандмауэр Azure имеет встроенную масштабируемость, тогда как брандмауэры NVA можно масштабировать вручную за подсистемой балансировки нагрузки. Как правило, программное обеспечение фермы брандмауэра менее специализированное по сравнению с ПО WAF, но включает более широкую область для фильтрации и проверки любого типа трафика (входящего и исходящего). Если используется подход NVA, их можно найти и развернуть с рынка Azure.

Используйте один набор брандмауэров Azure (или NVA) для трафика, поступающего из Интернета, и другой набор – для трафика, создаваемого локальными системами. Использование только одного набора брандмауэров в обоих случаях представляет угрозу безопасности, так как между двумя наборами сетевого трафика отсутствует периметр безопасности. Использование отдельных уровней брандмауэра упрощает проверку правил безопасности, а также позволяет понять, какие правила соответствуют определенным входящим сетевым запросам.

Рекомендуется использовать один набор экземпляров Брандмауэров Azure или брандмауэров NVA для трафика в Интернете и другой — для трафика в локальной среде. Использование только одного набора брандмауэров в обоих случаях представляет угрозу безопасности, так как между двумя наборами сетевого трафика отсутствует периметр безопасности. Использование отдельных уровней брандмауэра упрощает проверку правил безопасности, а также помогает понять, какие правила соответствуют определенным входящим сетевым запросам.

[**Azure Load Balancer**][ALB] обеспечивает высокий уровень доступности (уровень 4) (TCP, UDP), который может распределять входящий трафик между экземплярами службы, определенными в наборе балансировки нагрузки. Трафик, отправленный в подсистему балансировки нагрузки из интерфейсных конечных точек (общедоступные конечные точки IP-адрес или частным конечным точкам IP-адрес) может распространяться с или без преобразования адресов в набор внутреннего пула IP-адресов (например, виртуальные машины или виртуальные сетевые устройства).

Azure Load Balancer может проверять работоспособность различных экземпляров сервера в также и при сбое экземпляра для зондирования, балансировщик нагрузки прекращает отправку трафика в неработоспособный экземпляр. В виртуальном центре обработки данных внешний балансировщик нагрузки развернут в концентраторе и периферийных зонах. В концентраторе балансировщик нагрузки используется для эффективной маршрутизации трафика к службам в периферийных зонах, а в самих периферийных зонах – для управления трафиком приложений.

[**Azure Front Door**][AFD] (AFD) – это высокодоступная и масштабируемая платформа для ускорения веб-приложений корпорации Майкрософт, глобальной балансировки нагрузки HTTP, защиты приложений и сети доставки содержимого. Служба AFD, работающая в более чем 100 расположениях на границе глобальной сети корпорации Майкрософт, позволяет создавать, управлять и масштабировать динамическое веб-приложение и статическое содержимое. Служба AFD предоставляет вашему приложению производительность конечного пользователя мирового класса, единую автоматизацию регионального/маркированного обслуживания, автоматизацию BCDR, унифицированную клиентскую/пользовательскую информацию, кэширование и полезные сведения об услугах. Платформа обеспечивает производительность, надежность и поддержку соглашения об уровне обслуживания, сертификаты соответствия и проверенные методы безопасности, разработанные, эксплуатируемые и поддерживаемые платформой Azure.

[**Шлюз приложений**][AppGW]. Шлюз приложений Microsoft Azure – это выделенный виртуальный модуль, предоставляющий контроллер доставки приложений (ADC) как услугу, предлагая для приложения множество функций балансировки нагрузки уровня 7. Таким образом, вы можете оптимизировать производительность веб-фермы за счет выполнения операции завершения SSL-запросов, требующей интенсивного использования ЦП, на шлюзе приложений. Кроме того, пользователи получают другие возможности маршрутизации уровня 7, включая распределение входящего трафика методом циклического перебора, соответствие сеансу на основе файлов cookie, маршрутизацию на основе URL-путей и возможность размещения нескольких веб-сайтов за одним шлюзом приложений. Брандмауэр веб-приложений (WAF) также предоставляется как часть SKU WAF шлюза приложений. Этот SKU обеспечивает защиту веб-приложений от распространенных веб-уязвимостей и эксплойтов. Шлюз приложений можно настроить как шлюз с выходом в Интернет, внутренний шлюз или их сочетание.

[**Общедоступные IP-адреса**][PIP]. Некоторые функции Azure позволяют связывать конечные точки службы с общедоступным IP-адресом для получения доступа к ресурсам из Интернета. Эта конечная точка использует преобразование сетевых адресов (NAT) для маршрутизации трафика на внутренний адрес и порт в виртуальной сети Azure. Это основной путь передачи внешнего трафика в виртуальную сеть. Общедоступные IP-адреса можно настроить, чтобы определить, какой трафик следует пропускать в виртуальную сеть, а также как и где его следует пропускать.

[**Защита от атак DDoS Azure уровня "Стандартный"**][DDOS] предоставляет дополнительные возможности по устранению рисков по сравнению с [уровнем службы "Базовый"][DDOS], которые разработаны для ресурсов виртуальной сети Azure. Службу "Защита от атак DDoS" уровня "Стандартный" легко включить, и для ее использования не нужно изменять приложение. Политики защиты корректируются на основе мониторинга выделенного трафика и алгоритмов машинного обучения. Они применяются к общедоступным IP-адресам, связанным с ресурсами, развернутыми в виртуальных сетях, такими как Azure Load Balancer, Шлюз приложений Azure и экземпляры Azure Service Fabric. Данные телеметрии доступны в представлениях Azure Monitor в режиме реального времени во время атаки и после ее окончания. Можно также включить защиту на прикладном уровне с помощью брандмауэра веб-приложения в Шлюзе приложений Azure. Защита обеспечивается для общедоступных IP-адресов Azure IPv4.

#### <a name="component-type-monitoring"></a>Тип компонента: Мониторинг

Компоненты мониторинга обеспечивают видимость и оповещения, получаемые от всех других типов компонентов. У всех групп должен быть доступ к мониторингу соответствующих компонентов и служб. Если у вас есть централизованная служба поддержки или операционные группы, им необходим интегрированный доступ к данным, которые обеспечивают эти компоненты.

Azure предлагает несколько типов служб ведения журналов и мониторинга для отслеживания поведения размещенных ресурсов Azure. Регулирование рабочих нагрузок и управление ими в Azure основано не только на сборе данных журнала, но также на возможности активировать действия на основе определенных сообщаемых событий.

[**Azure Monitor**][Monitor]. Azure предлагает несколько служб, которые по отдельности выполняют определенную роль или задачу в пространстве мониторинга. Вместе эти службы предоставляют комплексное решение для сбора, анализа и использования телеметрии из вашего приложения и ресурсов Azure, которые их поддерживают. Они также могут выполнять мониторинг критически важных локальных ресурсов и предоставлять гибридную среду мониторинга. Понимание имеющихся инструментов и данных является первым шагом в разработке комплексной стратегии мониторинга для вашего приложения.

Есть два основных типа журналов в Azure:

- [Журнал действий][ActLog] (прежнее название — **журнал операций**) предоставляет сведения об операциях, выполняемых в ресурсах в подписке Azure. Эти журналы предоставляют отчет о событиях уровня управления в подписках. Журналы аудита ведутся для каждого ресурса Azure.

- [Журналы диагностики Azure][DiagLog] генерируются ресурсом. Они содержат подробные и своевременные данные о работе этого ресурса. Содержимое этих журналов зависит от типа ресурса.

[![9]][9]

Очень важно отслеживать журналы групп безопасности сети, в частности:

- [Журналы событий][NSGLog]. Эти журналы предоставляют сведения о правилах NSG, примененных к виртуальным машинам и ролям экземпляров на основе MAC-адреса.
- [Журналы счетчиков][NSGLog].Они позволяют отслеживать, сколько раз каждое правило NSG применялось для запрета или разрешения трафика.

Все журналы можно хранить в учетных записях хранения Azure для аудита, статического анализа или резервного копирования. Если журналы хранятся в учетной записи хранения Azure, клиенты могут использовать разные типы платформ для извлечения, подготовки, анализа и визуализации этих данных для создания отчета о состоянии и работоспособности облачных ресурсов.

У крупных предприятий должна быть стандартная платформа для мониторинга локальных систем, которую они могут расширить для интеграции журналов, созданных облачными развертываниями. С помощью [Azure Log Analytics](/azure/log-analytics/log-analytics-queries) организации могут хранить все журналы в облаке. Log Analytics реализуется как облачная служба. Поэтому подготовка к работе и запуск выполняются быстро и без значительных инвестиций в службы инфраструктуры. Кроме того, Log Analytics поддерживает интеграцию с компонентами System Center, такими как System Center Operations Manager, благодаря чему существующие инвестиции в средства управления также охватывают и облачные решения.

Log Analytics — это служба в Azure, которая помогает выполнять сбор, сопоставление, поиск и действия в отношении данных журналов и производительности, созданных операционными системами, приложениями и облачными компонентами инфраструктуры. Эта служба предоставляет клиентам полезные сведения об операциях в режиме реального времени, используя интегрированный поиск и настраиваемые панели мониторинга для анализа всех записей всех рабочих нагрузок в вашем виртуальном центре обработки данных.

[Наблюдатель за сетями Azure][NetWatch] предоставляет инструменты для мониторинга, диагностики, просмотра метрик и включения или отключения журналов для ресурсов в виртуальной сети Azure. Это многоаспектная служба, обеспечивающая следующие возможности:

- мониторинг взаимодействия между виртуальной машиной и конечной точкой;
- просмотр ресурсов и их связей в виртуальной сети;
- диагностика проблем с фильтрацией входящего или исходящего трафика виртуальной машины;
- диагностика проблем с сетевой маршрутизацией на виртуальной машине;
- диагностика исходящих подключений виртуальной машины;
- сбор пакетов, направляющихся в виртуальную машину и из нее;
- диагностика проблем со шлюзом и подключениями виртуальной сети Azure;
- определение относительных задержек между регионами Azure и поставщиками услуг Интернета;
- просмотр правил безопасности для сетевого интерфейса;
- просмотр метрик сети;
- анализ трафика, направляющегося в группу безопасности сети или из нее;
- просмотр журналов диагностики для сетевых ресурсов.

Решение [Монитор производительности сети][NPM] в Operations Management Suite предоставляет подробные сведения о сети, включая единое представление сетей Azure и локальных сетей. Это решение имеет отдельные функции мониторинга для ExpressRoute и общедоступных служб.

#### <a name="component-type-workloads"></a>Тип компонента: Рабочие нагрузки

Именно здесь находятся ваши фактические приложения и службы. Группы разработчиков приложения также проводят здесь большую часть времени.

Возможности рабочих нагрузок на самом деле безграничны. Ниже приведены всего несколько возможных типов рабочих нагрузок.

**Внутренние бизнес-приложения**. Бизнес-приложения — приложения для компьютера, которые являются чрезвычайно важными для выполняющихся корпоративных операций. У них есть некоторые общие характеристики.

- **интерактивность** — данные вводятся и возвращаются результаты или отчеты;
- **активное использование данных** — данные интенсивно используются с частым доступом к базам данных или другому хранилищу;
- **интеграция** — интеграция с другими системами в пределах и за пределами организации.

**Веб-сайты для клиентов (для Интернета или внутреннего использования)**. Большинство приложений, взаимодействующих с Интернетом, — это веб-сайты. Azure предлагает возможность запуска веб-сайта на виртуальной машине IaaS или на сайте [веб-приложений Azure][WebApps] (PaaS). Веб-приложения Azure поддерживают интеграцию с виртуальными сетями, что позволяет развертывать веб-приложения в периферийной зоне сети. Внутренний веб-сайтов не нужно предоставлять общедоступную конечную точку Интернет, так как ресурсы, доступны через частные адреса маршрутизации Интернета из виртуальной сети частный.

**Большие данные / аналитика**. Когда данные необходимо масштабировать до очень большого объема, базы данных могут не справиться с этим. Технология Hadoop предлагает систему для параллельного запуска распределенных запросов в большом количестве узлов. Клиенты могут выполнить рабочие нагрузки данных на виртуальных машинах IaaS или в PaaS ([HDInsight][HDI]). HDInsight поддерживает развертывание в виртуальную сеть на основе расположения. Развертывание можно выполнить в кластер в периферийной зоне VDC.

**События и обмен сообщениями**. [Центры событий Azure][EventHubs] — это служба обработки данных телеметрии с высокой степенью масштабируемости. Она собирает, преобразовывает и хранит миллионы событий. Эта распределенная платформа для потоковой передачи данных с низкой задержкой и настраиваемым временем хранения позволяет принимать большие объемы данных телеметрии в Azure, а также считывать эти данные из нескольких приложений. С Центрами событий отдельный поток может поддерживать обработку конвейеров в режиме реального времени и на основе пакетов.

Вы можете реализовать высоконадежную облачную систему для обмена сообщениями между приложениями и службами, используя [Служебную шину Azure][ServiceBus]. Это решение обеспечивает асинхронный обмен сообщениями через брокер между клиентом и сервером, обработку сообщений в порядке поступления, а также предлагает возможность публикации и подписки.

[![10]][10]

### <a name="making-the-vdc-highly-available-multiple-vdcs"></a>Обеспечение высокой доступности виртуальных центров обработки данных: несколько виртуальных центров обработки данных

Как вы заметили, в этой статье основное внимание уделяется конструктору отдельного виртуального центра обработки данных. Здесь описываются базовые компоненты и архитектура, обеспечивающие отказоустойчивость этого центра. Функции Azure, например Azure load balancer, NVA, доступности, наборы масштабирования, и другие механизмы обеспечивают систему, позволяет создавать в рабочих службах надежные уровни SLA.

Однако, поскольку один виртуальный центр обработки данных обычно реализуется в пределах одного региона, он может быть уязвим к любому серьезному сбою, который затрагивает весь этот регион. Клиентам, которым требуется более высокий уровень обслуживания согласно соглашению об уровне обслуживания, необходимо защитить службы, развернув один проект в нескольких виртуальных центрах обработки данных в разных регионах.

Также мы рекомендуем рассмотреть еще несколько распространенных сценариев, требующих развертывания нескольких ВЦОД:

- региональное или глобальное присутствие;
- Аварийное восстановление.
- перенаправление трафика между центрами обработки данных

#### <a name="regionalglobal-presence"></a>Региональное и глобальное присутствие

Центры обработки данных Azure присутствуют в различных регионах по всему миру. При выборе нескольких центров обработки данных Azure клиенты должны учитывать два связанных фактора: географические расстояния и задержку. Чтобы обеспечить лучшее взаимодействие с пользователем, оцените географическое расстояние между каждым виртуальным центром обработки данных, а также расстояние между каждым виртуальным центром обработки данных и пользователем.

Регион, в котором размещаются виртуальные центры обработки данных, должен соответствовать нормативным требованиям, установленным законодательными органами, которым подчиняется организация.

#### <a name="disaster-recovery"></a>Аварийное восстановление

Разработка плана аварийного восстановления зависит от типов рабочих нагрузок и способности синхронизировать состояние этих рабочих нагрузок между различными реализациями виртуального центра обработки данных. В идеале большинству клиентов нужен быстрый механизм переключения при отказе, и для этого может потребоваться синхронизация данных приложения между развертываниями, в которых используются несколько реализаций виртуального центра обработки данных. Однако при разработке планов аварийного восстановления важно учитывать, что большинство приложений чувствительны к задержке, которая может быть вызвана этой синхронизацией данных.

Для мониторинга синхронизации и пульса приложений в разных виртуальных центрах обработки данных требуется, чтобы они взаимодействовали через сеть. Два виртуальных центра обработки данных в разных регионах можно подключить через:

- Пиринг виртуальной сети — Пиринг виртуальной сети можно соединять концентраторы между регионами.
- Частный пиринг ExpressRoute, когда концентраторы в каждой реализации виртуального центра обработки данных подключены к одному каналу ExpressRoute.
- Несколько каналов ExpressRoute, подключенных через корпоративную магистраль, и несколько реализации виртуального центра обработки данных, подключенных к каналам ExpressRoute.
- Сеть-сеть VPN-подключений между зоне концентратора реализации виртуального центра обработки данных в каждом регионе Azure.

Обычно пиринг виртуальных сетей или подключения ExpressRoute – предпочтительные типы подключений из-за более высокой пропускной способности и последовательных уровней задержки при передаче через магистраль Майкрософт.

Рекомендуется, чтобы клиенты выполнили тестовую проверку сети, чтобы проверить задержку и пропускную способность подключений и на основе полученных данных решили, какая репликация данных более подходящая. Также важно взвесить эти результаты с точки зрения оптимальной цели времени восстановления (RTO).

#### <a name="disaster-recovery-diverting-traffic-from-one-region-to-another"></a>Аварийное восстановление: перенаправление трафика из одного региона в другой

[Диспетчер трафика Azure][TM] периодически проверяет работоспособность службы общедоступных конечных точек в разных виртуальных центрах обработки данных, а в случае сбоя этих конечных точек выполняет автоматическое перенаправление в дополнительный виртуальный центр обработки данных, используя службу доменных имен (DNS).

Поскольку он использует DNS, диспетчер трафика предназначен только для использования с общедоступными конечными точками Azure.  Служба обычно используется для управления или перенаправления трафика на виртуальные машины Azure и веб-приложения в работоспособном экземпляре реализации виртуального центра обработки данных. Диспетчер трафика остается устойчивым даже в случае сбоя во всем регионе Azure. Он может управлять распределением пользовательского трафика для конечных точек службы в разных виртуальных центрах обработки данных на основе нескольких критериев. Например, сбой службы в конкретной реализации виртуального центра обработки данных или выбор реализации виртуального центра обработки данных с самой низкой задержкой в сети.

### <a name="summary"></a>Сводка

Виртуальный центр обработки данных – это подход к миграции центра обработки данных для создания масштабируемой архитектуры в Azure, которая максимально увеличивает использование облачных ресурсов, снижает затраты и упрощает управление системой. Виртуальный центр обработки данных основан на использовании звездообразной топологии, которая предоставляет распространенные общие службы в концентраторе и позволяет размещать конкретные приложения и рабочие нагрузки в периферийных зонах. Виртуальный центр обработки данных также соответствует структуре корпоративных ролей при совместной работе разных отделов (например, центрального ИТ-отдела, DevOps, операционного отдела и отдела обслуживания) во время исполнения своих особых ролей. Виртуальный центр обработки данных удовлетворяет требования миграции lift-and-shift, а также предоставляет множество преимуществ для системных развертываний в облаке.

## <a name="references"></a>Ссылки

В этом руководстве были рассмотрены приведенные ниже функции и компоненты. Дополнительные сведения см. в следующих ссылках.

| | | |
|-|-|-|
|Сетевые функции|Балансировка нагрузки|Соединение|
|[Виртуальные сети Azure][VNet]</br>[Группы безопасности сети][NSG].</br>[Журналы групп безопасности сети][NSGLog]</br>[Определяемая пользователем маршрутизация][UDR]</br>[Сетевые виртуальные устройства][NVA]</br>[Общедоступные IP-адреса][PIP]</br>[Azure DDOS][DDOS]</br>[Брандмауэр Azure][AzFW]</br>[Azure DNS][DNS]|[Azure Front Door][AFD]</br>[Azure Load Balancer (уровень 3)][ALB]</br>[Шлюз приложений (уровень 7)][AppGW]</br>[Брандмауэр веб-приложения][WAF]</br>[Диспетчер трафика Azure][TM]</br></br></br></br></br> |[Пиринг виртуальных сетей][VNetPeering]</br>[Виртуальная частная сеть][VPN]</br>[Виртуальная глобальная сеть][vWAN]</br>[ExpressRoute][ExR]</br>[ExpressRoute Direct][ExRD]</br></br></br></br></br>
|Удостоверение</br>|Мониторинг</br>|Рекомендации</br>|
|[Azure Active Directory][AAD]</br>[Многофакторная идентификация][MFA]</br>[Элементы управления доступом на основе ролей][RBAC]</br>[Роли Azure AD по умолчанию][Roles]</br></br></br> |[Наблюдатель за сетями][NetWatch]</br>[Azure Monitor][Monitor]</br>[Журналы действий][ActLog]</br>[Журналы диагностики][DiagLog]</br>[Microsoft Operations Management Suite][OMS]</br>[Монитор производительности сети][NPM]|[Сети периметра: рекомендации][DMZ]</br>[Управление подпиской][SubMgmt]</br>[Управление группой ресурсов][RGMgmt]</br>[Ограничения подписки Azure][Limits] </br></br></br>|
|Прочие службы Azure|
|[Веб-приложения Azure][WebApps]</br>[HDInsights (Hadoop)][HDI]</br>[Центры событий][EventHubs]</br>[Служебная шина][ServiceBus]|

## <a name="next-steps"></a>Следующие шаги

- Ознакомьтесь с понятием [пиринговой связи между виртуальными сетями][VNetPeering] — базовой технологией подключения в звездообразной топологии VDC.
- Реализуйте [Azure AD][AAD], чтобы приступить к анализу [RBAC][RBAC].
- Разработайте модель управления ресурсами и подпиской, а также модель RBAC для обеспечения необходимой структуры, требований и политик организации. Планирование является самым важным действием: для реорганизации, слияния, новых разработок и т. д.

<!--Image References-->
[0]: ./images/networking-redundant-equipment.png "примеры перекрытия компонента"
[1]: ./images/networking-vdc-high-level.png "Подробный пример звездообразной топологии в VDC"
[2]: ./images/networking-hub-spokes-cluster.png "Кластер со звездообразной топологией"
[3]: ./images/networking-spoke-to-spoke.png "Подключение типа луч — луч в звездообразной топологии"
[4]: ./images/networking-vdc-block-level-diagram.png "Схема VDC на уровне блоков"
[5]: ./images/networking-users-groups-subsciptions.png "Пользователи, группы, подписки и проекты"
[6]: ./images/networking-infrastructure-high-level.png "Общая схема инфраструктуры"
[7]: ./images/networking-highlevel-perimeter-networks.png "Общая схема инфраструктуры"
[8]: ./images/networking-vnet-peering-perimeter-neworks.png "Пиринг виртуальных сетей и сети периметра"
[9]: ./images/networking-high-level-diagram-monitoring.png "Общая схема мониторинга"
[10]: ./images/networking-high-level-workloads.png "Общая схема рабочих нагрузок"

<!--Link References-->
[Limits]: /azure/azure-subscription-service-limits
[Roles]: /azure/role-based-access-control/built-in-roles
[VNet]: /azure/virtual-network/virtual-networks-overview
[NSG]: /azure/virtual-network/virtual-networks-nsg
[DNS]: /azure/dns/dns-overview
[PrivateDNS]: /azure/dns/private-dns-overview
[VNetPeering]: /azure/virtual-network/virtual-network-peering-overview
[UDR]: /azure/virtual-network/virtual-networks-udr-overview
[RBAC]: /azure/role-based-access-control/overview
[MFA]: /azure/multi-factor-authentication/multi-factor-authentication
[AAD]: /azure/active-directory/active-directory-whatis
[VPN]: /azure/vpn-gateway/vpn-gateway-about-vpngateways
[ExR]: /azure/expressroute/expressroute-introduction
[ExRD]: /azure/expressroute/expressroute-erdirect-about
[vWAN]: /azure/virtual-wan/virtual-wan-about
[NVA]: /azure/architecture/reference-architectures/dmz/nva-ha
[AzFW]: /azure/firewall/overview
[SubMgmt]: /azure/architecture/cloud-adoption/appendix/azure-scaffold
[RGMgmt]: /azure/azure-resource-manager/resource-group-overview
[DMZ]: /azure/best-practices-network-security
[ALB]: /azure/load-balancer/load-balancer-overview
[DDOS]: /azure/virtual-network/ddos-protection-overview
[PIP]: /azure/virtual-network/resource-groups-networking#public-ip-address
[AFD]: /azure/frontdoor/front-door-overview
[AppGW]: /azure/application-gateway/application-gateway-introduction
[WAF]: /azure/application-gateway/application-gateway-web-application-firewall-overview
[Monitor]: /azure/monitoring-and-diagnostics/
[ActLog]: /azure/monitoring-and-diagnostics/monitoring-overview-activity-logs
[DiagLog]: /azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs
[NSGLog]: /azure/virtual-network/virtual-network-nsg-manage-log
[OMS]: /azure/operations-management-suite/operations-management-suite-overview
[NPM]: /azure/log-analytics/log-analytics-network-performance-monitor
[NetWatch]: /azure/network-watcher/network-watcher-monitoring-overview
[WebApps]: /azure/app-service/
[HDI]: /azure/hdinsight/hdinsight-hadoop-introduction
[EventHubs]: /azure/event-hubs/event-hubs-what-is-event-hubs
[ServiceBus]: /azure/service-bus-messaging/service-bus-messaging-overview
[TM]: /azure/traffic-manager/traffic-manager-overview
