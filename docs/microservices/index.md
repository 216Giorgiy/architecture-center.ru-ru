---
title: Проектирование, создание и использование микрослужб в Azure с помощью Kubernetes
description: Проектирование, создание и использование микрослужб в Azure.
author: MikeWasson
ms.date: 10/23/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: 90a6550264e5afd1fc2eda79eeff6557dc7c4163
ms.sourcegitcommit: 273e690c0cfabbc3822089c7d8bc743ef41d2b6e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2019
ms.locfileid: "55897734"
---
# <a name="designing-building-and-operating-microservices-on-azure"></a>Проектирование, создание и использование микрослужб в Azure

![Схема службы доставки дронами](./images/drone.svg)

Архитектура микрослужб широко используется для создания устойчивых, высокомасштабируемых, независимо развертываемых и быстро развивающихся облачных приложений. Но это не просто специальный термин. Применение микрослужб требует другого подхода к разработке и созданию приложений.

В этой серии статей мы рассмотрим, как создать и запустить архитектуру микрослужб в Azure. Будут рассмотрены следующие задачи:

- использование предметно-ориентированного проектирования (DDD) для проектирования архитектуры микрослужб;
- выбор правильных технологий Azure для вычислений, хранения, обмена сообщениями и других элементов проектирования;
- изучение шаблонов проектирования микрослужб;
- проектирование для обеспечения устойчивости, масштабируемости и производительности;
- создание конвейера непрерывной интеграции и непрерывной доставки.

В рамках всего руководства мы будем рассматривать комплексный сценарий: служба доставки, которая позволяет клиентам планировать забор и доставку посылок с помощью дронов. Код для реализации примера можно найти на портале GitHub.

[![GitHub](../_images/github.png) Пример реализации][drone-ri]

Но давайте начнем с основ. Что такое микрослужбы и какие преимущества связаны с использованием архитектуры микрослужб?

<!-- markdownlint-disable MD026 -->

## <a name="why-build-microservices"></a>Что дает создание микрослужб?

<!-- markdownlint-enable MD026 -->

Архитектура микрослужб предполагает, что приложение состоит из множества небольших независимых служб. Ниже приведены свойства микрослужб.

- Каждая микрослужба реализует возможности одной компании.
- Микрослужба достаточно мала. Поэтому создать и обслуживать ее может небольшая команда разработчиков.
- Микрослужбы выполняют отдельные процессы и при этом обмениваются данными через точно определенные API-интерфейсы или шаблоны обмена сообщениями.
- Микрослужбы не используют общие хранилища данных и схемы данных. Каждая микрослужба отвечает за управление собственными данными.
- Микрослужбы используют отдельные базы кода, но не общий исходный код. При этом они могут использовать общие библиотеки служебных программ.
- Каждую микрослужбу можно развертывать и обновлять отдельно.

При правильном проектировании микрослужбы могут предоставить ряд полезных преимуществ.

- **Гибкость.** Так как микрослужбы развертываются независимо друг от друга, вы можете легко управлять исправлениями ошибок и выпусками компонентов. Вы можете обновить службу без повторного развертывания всего приложения, а также откатить обновление, если что-то работает неправильно. Во многих традиционных приложениях ошибка, выявляемая в одной части приложения, может заблокировать процесс выпуска. В результате новые компоненты могут находится в ожидании интеграции, тестирования и публикации исправлений.

- **Меньше кода и небольшие команды разработчиков.** Микрослужба должна быть достаточно небольшой, чтобы одна команда, которая разрабатывает компонент, могла создать, проверить и развернуть его. Небольшие базы кода легче анализировать. В больших монолитных приложениях со временем зависимости в коде усложняются, и, чтобы добавить новый компонент, нужно изменять код в нескольких местах. Благодаря использованию отдельных баз кода и хранилищ данных в архитектуре микрослужб становится меньше зависимостей, что упрощает добавление новых компонентов. Небольшое количество разработчиков в команде также способствует повышению уровня гибкости. Согласно "правилу двух пицц" команда должна настолько малой, чтобы всех участников можно было накормить двумя пиццами. Конечно же, это не точное определение, ведь все зависит от аппетита. Но суть в том, что большие команды, как правило, менее продуктивны из-за замедленного обмена данными, больших расходов на управление и снижения гибкости.

- **Сочетание технологий**. При необходимости команды могут применять те технологии, которые лучше всего соответствуют особенностям используемых служб, с помощью стеков технологий.

- **Устойчивость.** Если одна микрослужба станет недоступна, это не нарушит работу всего приложения, так как все вышестоящие микрослужбы спроектированы правильно реагировать на ошибки (например, путем реализации автоматического выключения).

- **Масштабируемость**. Архитектура микрослужб позволяет масштабировать каждую микрослужбу отдельно. Благодаря этому можно масштабировать подсистемы, для которых требуются дополнительные ресурсы, не масштабируя все приложение. Если службы развернуты в контейнерах, вы также можете создать на одном узле пакеты микрослужб с более высокой плотностью, оптимизируя использование ресурсов.

- **Изоляция данных**. Гораздо проще обновлять схему, так как это отражается на работе только одной микрослужбы. В монолитном приложении обновление схемы может быть очень сложной задачей, так как разные части приложения могут использовать одни и те же данные. Из-за этого внесение любых изменений в схему может оказаться рискованным.

## <a name="no-free-lunch"></a>Обратная сторона медали

Все эти преимущества имеют и обратную сторону. В этой серии статей описано, как устранять некоторые проблемы с созданием устойчивых, масштабируемых и управляемых микрослужб.

- **Границы служб**. При создании микрослужб необходимо тщательно продумать, как определить границы между службами. Так как службы создаются и развертываются в рабочей среде, в рамках этих границ могут возникнуть трудности с рефакторингом. Правильное определение границ — одна из основных проблем при проектировании архитектуры микрослужб. Каким должен быть размер службы? Когда компоненты нужно распределить между несколькими службами, а когда — оставить в пределах одной службы? В этом руководстве мы рассмотрим подход, в котором для определения границ используется предметно-ориентированное проектирование. Сначала [анализируется предметная область](./domain-analysis.md) для определения ограниченного контекста, а затем применяется набор [тактических шаблонов DDD](./microservice-boundaries.md) на основе функциональных и нефункциональных требований.

- **Согласованность и целостность данных**. Основной принцип работы микрослужб заключается в том, что каждая служба управляет собственными данными. Это обеспечивает независимость служб, но может привести к избыточности или проблемам с целостностью данных. Некоторые из этих проблем рассмотрены в статье [Проектирование микрослужб: рекомендации по работе с данными](./data-considerations.md).

- **Перегрузки и задержки сети.** Использование большого числа мелких служб может привести к интенсивному обмену данными между ними и увеличению совокупной задержки. В статье [Проектирование микрослужб: обмен данными между службами](./interservice-communication.md) приводятся рекомендации по настройке обмена сообщениями между службами. В микрослужбах можно применять как синхронную, так и асинхронную передачу данных. Важно правильно [спроектировать API](./api-design.md), чтобы обеспечить слабую связь между службами, а также настроить их независимое развертывание и обновление.

- **Сложность.** Приложение для микрослужб содержит больше перемещаемых частей. Каждая служба может быть простой, но вместе они должны работать как единое целое. Операция одного пользователя может задействовать несколько служб. В статье [Проектирование микрослужб: прием данных и рабочий процесс](./ingestion-workflow.md) рассматриваются некоторые проблемы, связанные с принятием запросов при высокой пропускной способности, согласованием рабочего процесса и обработкой сбоев.

- **Взаимодействие клиентов с приложением.**  Как клиенты должны взаимодействовать со службами при разделении приложения на несколько небольших служб? Может ли клиент вызывать каждую службу напрямую или он должен направлять запросы через [шлюз API](./gateway.md)?

- **Мониторинг**. Мониторинг распределенного приложения может быть гораздо сложнее, чем мониторинг монолитного приложения, так как вам нужно сопоставлять данные телеметрии из нескольких служб. Решение этих проблем приводится в статье [Проектирование микрослужб: ведение журнала и мониторинг](./logging-monitoring.md).

- **Непрерывная интеграция и непрерывная поставка (CI/CD)**. Одной из основных целей микрослужб является обеспечение гибкости. Для этого требуется наладить автоматизированный и бесперебойный процесс [CI/CD](./ci-cd.md), с помощью которого вы сможете быстро и надежно развертывать отдельные службы в тестовой и рабочей средах.

## <a name="the-drone-delivery-application"></a>Приложение доставки беспилотными летательными аппаратами

Чтобы изучить эти проблемы и продемонстрировать некоторые рекомендации по использованию архитектуры микрослужб, мы создали пример реализации, который назвали приложением доставки беспилотными летательными аппаратами. Этот пример реализации можно найти на портале [GitHub][drone-ri].

Компания Fabrikam запускает службу доставки беспилотными летательными аппаратами. Она управляет парком таких аппаратов. Организации регистрируются с помощью службы, и пользователи могут отправить заявку на использование беспилотного летательного аппарата, чтобы забрать посылки для доставки. Когда клиент планирует отгрузку, серверная система назначает аппарат и сообщает пользователю предполагаемое время доставки. В ходе доставки клиент может отслеживать местоположение аппарата, получая актуальные сведения об ожидаемом времени доставки.

Этот сценарий довольной сложный, так как его этапы включают планирование загруженности беспилотных летательных аппаратов, отслеживание посылок, управление учетными записями пользователей, а также хранение и анализ исторических данных. Кроме того, компания Fabrikam хочет быстро выйти на рынок, а затем быстро повторить этот процесс, добавив новые функции и возможности. Приложение должно работать в масштабе облака с высоким целевым уровнем обслуживания. Компания также ожидает, что в разных частях системы требования к хранению данных и выполнению запросов будут очень отличаться. С учетом всех этих факторов Fabrikam выбрала архитектуру микрослужб для приложения доставки беспилотными летательными аппаратами.

> [!NOTE]
> Если вам нужна помощь в выборе между микрослужбами и другими архитектурами, ознакомьтесь с [руководством по архитектуре приложений Azure](../guide/index.md).

В примере реализации используется Kubernetes со [Службой Azure Kubernetes](/azure/aks/) (AKS). Но большинство общих архитектурных решений и задач будут применимы к любому оркестратору контейнера, включая [Azure Service Fabric](/azure/service-fabric/).

> [!div class="nextstepaction"]
> [Анализ предметной области](./domain-analysis.md)

<!-- links -->

[drone-ri]: https://github.com/mspnp/microservices-reference-implementation
