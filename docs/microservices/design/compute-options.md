# <a name="choosing-a-compute-option-for-microservices"></a>Выбор варианта вычисления для микрослужб

Термин *вычислительная служба* означает модель размещения вычислительных ресурсов, которые используются для выполнения приложения. Для архитектуры микрослужб особенно популярными являются два подхода:

- Служба оркестратора, которая управляет службами, выполняющимися на выделенных узлах (виртуальных машинах).
- Бессерверная архитектура, которая использует функции как услугу (FaaS).

Хотя это не единственные варианты, они оба являются проверенными подходами к созданию микрослужб. В приложение могут быть включены оба эти подхода.

## <a name="service-orchestrators"></a>Оркестраторы служб

Оркестратор выполняет задачи, связанные с развертыванием набора служб и управлением ним. К этим задачам относятся размещение служб на узлах, мониторинг состояния работоспособности служб, перезапуск неработоспособных служб, балансировка нагрузки сетевого трафика между экземплярами службы, обнаружение служб, масштабирование количества экземпляров службы и применение обновления конфигурации. Среди популярных оркестраторов можно назвать Kubernetes, Service Fabric, DC/OS и Docker Swarm.

Для платформы Azure мы рекомендуем рассмотреть следующие варианты:

- [Azure Kubernetes Service](/azure/aks/) (AKS) — это управляемая служба Kubernetes. AKS реализует среду Kubernetes и предоставляет конечные точки API Kubernetes, а также содержит и администрирует плоскость управления Kubernetes, выполняя автоматические обновления, автоматическое исправление, автомасштабирование и другие задачи управления. Вы можете думать об AKS как о "программных интерфейсах API Kubernetes как услуге".

- [Service Fabric](/azure/service-fabric/) — это платформа распределенных систем для упаковки и развертывания микрослужб, а также управления ими. Микрослужбы могут быть развернуты в Service Fabric в виде контейнеров, исполняемых двоичных файлов или [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction). Используя модель программирования Reliable Services, службы могут напрямую использовать API программирования Service Fabric, чтобы отправлять запросы к системе, формировать отчеты о состоянии, получать уведомления об изменениях конфигурации и кода, а также обнаруживать другие службы. Ключевое отличие Service Fabric — активная ориентация на создание служб с отслеживанием состояния с использованием [Reliable Collections](/azure/service-fabric/service-fabric-reliable-services-reliable-collections).

- Другие параметры, такие как Docker Enterprise Edition и Mesosphere DC/OS можно запускать в среде IaaS в Azure. Шаблоны развертывания можно найти на [Azure Marketplace](https://azuremarketplace.microsoft.com).

## <a name="containers"></a>Контейнеры

Иногда о контейнерах и микрослужбах говорят так, как будто это одно и то же. Это в корне неверно. Для создания микрослужб не нужны контейнеры. Тем не менее, контейнеры имеют некоторые преимущества, которые особенно актуальны для микрослужб, в частности:

- **Мобильность.** Образ контейнера представляет собой изолированный пакет, для запуска которого не нужно устанавливать библиотеки или другие зависимости. Благодаря этому их легче развертывать. Контейнеры можно быстро запустить и остановить, что позволяет развернуть новые экземпляры, чтобы обрабатывать большую нагрузку или восстанавливаться после сбоев узлов.

- **Плотность**. По сравнению с виртуальными машинами, контейнеры имеют меньшую плотность, так как они совместно используют ресурсы ОС. Благодаря этому можно упаковать несколько контейнеров в единый узел, что особенно полезно, когда приложение состоит из множества небольших служб.

- **Изоляция ресурсов**. Вы можете ограничить объем ресурсов памяти и ЦП, которые доступны для контейнера, чтобы неконтролируемый процесс не исчерпал ресурсы узла. См. дополнительные сведения о [шаблоне отсеков](../../patterns/bulkhead.md).

## <a name="serverless-functions-as-a-service"></a>Бессерверная архитектура (функции как услуга)

При использовании [бессерверной](https://azure.microsoft.com/solutions/serverless/) архитектуры не нужно управлять виртуальными машинами или инфраструктурой виртуальных сетей. Вместо этого, вы развертываете код, который будет передан службой размещения в виртуальную машину для выполнения. Этот подход поддерживает небольшие детализированные функции, которые координируются с использованием триггеров, основанных на событиях. Например, сообщение, помещенное в очередь, может запустить функцию, которая считывает из очереди и обрабатывает сообщение.

[Функции Azure](/azure/azure-functions/) — это служба бессерверных вычислений, которая поддерживает различные триггеры функций, включая HTTP-запросы, очереди служебной шины и концентраторов событий события. Полный список см. в разделе [триггеры функций Azure и основные понятия привязки](/azure/azure-functions/functions-triggers-bindings). Также рассмотрите возможность ["Сетка событий Azure"](/azure/event-grid/), это управляемая служба маршрутизации событий в Azure.

<!-- markdownlint-disable MD026 -->

## <a name="orchestrator-or-serverless"></a>Архитектура с оркестрацией или независимая от сервера

<!-- markdownlint-enable MD026 -->

Ниже приведено несколько факторов, которые нужно учитывать при выборе между архитектурой с оркестратором и бессерверной архитектурой.

**Управляемость**. Бессерверными приложениями легче управлять, так как всеми вычислительными ресурсами управляет платформа. При использовании оркестратора некоторые аспекты администрирования и настройки кластера представлены на абстрактном уровне, он не полностью скрывает базовые виртуальные машины. При использовании оркестратора вам будет необходимо думать о таких проблемах, как балансировка нагрузки, использование ЦП и памяти, а также работа сети.

**Гибкость и контроль**. С помощью оркестратора у вас появится больше контроля над настройкой служб и кластера, а также управлением ими. Компромисс является дополнительной сложностью. При использовании бессерверной архитектуры вы теряете некоторую часть контроля, так как эти детали абстрагированы.

**Мобильность.** Все перечисленные здесь оркестраторы (Kubernetes, DC/OS, Docker Swarm и Service Fabric) могут работать в локальной среде или в нескольких общедоступных облаках.

**Интеграция приложений**. Создание сложного приложения с бессерверной архитектурой может оказаться трудной задачей. Единственным вариантом в Azure является использование [Azure Logic Apps](/azure/logic-apps/) для координации набора функций Azure. Пример этого подхода представлен в статье [Создание функции, интегрируемой с Azure Logic Apps](/azure/azure-functions/functions-twitter-email).

**Стоимость**. С оркестратором вы платите за виртуальные машины, которые работают в кластере. С независимым от сервера приложением вы платите только за фактически использованные вычислительные ресурсы. В обоих случаях вам необходимо учитывать стоимость любых дополнительных служб, таких как хранилища, базы данных и службы обмена сообщениями.

**Масштабируемость**. Функции Azure масштабируются автоматически в соответствии с требованиями в зависимости от числа входящих событий. При использовании оркестратора вы можете выполнить масштабирование, увеличив количество экземпляров службы, запущенных в кластере. Вы также можете изменить масштаб, добавив дополнительные виртуальные машины в кластер.

В эталонной реализации в основном используется Kubernetes, но мы также использовали службу "Функции Azure" для службы "История доставки". Функции Azure подходят этой конкретной службе, так как это управляемая событиями рабочая нагрузка. Так как для вызова функции используется триггер Центров событий, службе требуется минимальное количество кода. Кроме того, служба "История доставки" не является частью основного рабочего процесса, поэтому ее запуск за пределами кластера Kubernetes не повлияет на совокупную задержку инициированных пользователем операций.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Обмен данными между службами](./interservice-communication.md)
