# <a name="choosing-a-compute-option-for-microservices"></a><span data-ttu-id="0ddd2-101">Выбор варианта вычисления для микрослужб</span><span class="sxs-lookup"><span data-stu-id="0ddd2-101">Choosing a compute option for microservices</span></span>

<span data-ttu-id="0ddd2-102">Термин *вычислительная служба* означает модель размещения вычислительных ресурсов, которые используются для выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-102">The term *compute* refers to the hosting model for the computing resources that your application runs on.</span></span> <span data-ttu-id="0ddd2-103">Для архитектуры микрослужб особенно популярными являются два подхода:</span><span class="sxs-lookup"><span data-stu-id="0ddd2-103">For a microservices architecture, two approaches are especially popular:</span></span>

- <span data-ttu-id="0ddd2-104">Служба оркестратора, которая управляет службами, выполняющимися на выделенных узлах (виртуальных машинах).</span><span class="sxs-lookup"><span data-stu-id="0ddd2-104">A service orchestrator that manages services running on dedicated nodes (VMs).</span></span>
- <span data-ttu-id="0ddd2-105">Бессерверная архитектура, которая использует функции как услугу (FaaS).</span><span class="sxs-lookup"><span data-stu-id="0ddd2-105">A serverless architecture using functions as a service (FaaS).</span></span>

<span data-ttu-id="0ddd2-106">Хотя это не единственные варианты, они оба являются проверенными подходами к созданию микрослужб.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-106">While these aren't the only options, they are both proven approaches to building microservices.</span></span> <span data-ttu-id="0ddd2-107">В приложение могут быть включены оба эти подхода.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-107">An application might include both approaches.</span></span>

## <a name="service-orchestrators"></a><span data-ttu-id="0ddd2-108">Оркестраторы служб</span><span class="sxs-lookup"><span data-stu-id="0ddd2-108">Service orchestrators</span></span>

<span data-ttu-id="0ddd2-109">Оркестратор выполняет задачи, связанные с развертыванием набора служб и управлением ним.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-109">An orchestrator handles tasks related to deploying and managing a set of services.</span></span> <span data-ttu-id="0ddd2-110">К этим задачам относятся размещение служб на узлах, мониторинг состояния работоспособности служб, перезапуск неработоспособных служб, балансировка нагрузки сетевого трафика между экземплярами службы, обнаружение служб, масштабирование количества экземпляров службы и применение обновления конфигурации.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-110">These tasks include placing services on nodes, monitoring the health of services, restarting unhealthy services, load balancing network traffic across service instances, service discovery, scaling the number of instances of a service, and applying configuration updates.</span></span> <span data-ttu-id="0ddd2-111">Среди популярных оркестраторов можно назвать Kubernetes, Service Fabric, DC/OS и Docker Swarm.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-111">Popular orchestrators include Kubernetes, Service Fabric, DC/OS, and Docker Swarm.</span></span>

<span data-ttu-id="0ddd2-112">Для платформы Azure мы рекомендуем рассмотреть следующие варианты:</span><span class="sxs-lookup"><span data-stu-id="0ddd2-112">On the Azure platform, consider the following options:</span></span>

- <span data-ttu-id="0ddd2-113">[Azure Kubernetes Service](/azure/aks/) (AKS) — это управляемая служба Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-113">[Azure Kubernetes Service](/azure/aks/) (AKS) is a managed Kubernetes service.</span></span> <span data-ttu-id="0ddd2-114">AKS реализует среду Kubernetes и предоставляет конечные точки API Kubernetes, а также содержит и администрирует плоскость управления Kubernetes, выполняя автоматические обновления, автоматическое исправление, автомасштабирование и другие задачи управления.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-114">AKS provisions Kubernetes and exposes the Kubernetes API endpoints, but hosts and manages the Kubernetes control plane, performing automated upgrades, automated patching, autoscaling, and other management tasks.</span></span> <span data-ttu-id="0ddd2-115">Вы можете думать об AKS как о "программных интерфейсах API Kubernetes как услуге".</span><span class="sxs-lookup"><span data-stu-id="0ddd2-115">You can think of AKS as being "Kubernetes APIs as a service."</span></span>

- <span data-ttu-id="0ddd2-116">[Service Fabric](/azure/service-fabric/) — это платформа распределенных систем для упаковки и развертывания микрослужб, а также управления ими.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-116">[Service Fabric](/azure/service-fabric/) is a distributed systems platform for packaging, deploying, and managing microservices.</span></span> <span data-ttu-id="0ddd2-117">Микрослужбы могут быть развернуты в Service Fabric в виде контейнеров, исполняемых двоичных файлов или [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction).</span><span class="sxs-lookup"><span data-stu-id="0ddd2-117">Microservices can be deployed to Service Fabric as containers, as binary executables, or as [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction).</span></span> <span data-ttu-id="0ddd2-118">Используя модель программирования Reliable Services, службы могут напрямую использовать API программирования Service Fabric, чтобы отправлять запросы к системе, формировать отчеты о состоянии, получать уведомления об изменениях конфигурации и кода, а также обнаруживать другие службы.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-118">Using the Reliable Services programming model, services can directly use Service Fabric programming APIs to query the system, report health, receive notifications about configuration and code changes, and discover other services.</span></span> <span data-ttu-id="0ddd2-119">Ключевое отличие Service Fabric — активная ориентация на создание служб с отслеживанием состояния с использованием [Reliable Collections](/azure/service-fabric/service-fabric-reliable-services-reliable-collections).</span><span class="sxs-lookup"><span data-stu-id="0ddd2-119">A key differentiation with Service Fabric is its strong focus on building stateful services using [Reliable Collections](/azure/service-fabric/service-fabric-reliable-services-reliable-collections).</span></span>

- <span data-ttu-id="0ddd2-120">Другие параметры, такие как Docker Enterprise Edition и Mesosphere DC/OS можно запускать в среде IaaS в Azure.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-120">Other options such as Docker Enterprise Edition and Mesosphere DC/OS can run in an IaaS environment on Azure.</span></span> <span data-ttu-id="0ddd2-121">Шаблоны развертывания можно найти на [Azure Marketplace](https://azuremarketplace.microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="0ddd2-121">You can find deployment templates on [Azure Marketplace](https://azuremarketplace.microsoft.com).</span></span>

## <a name="containers"></a><span data-ttu-id="0ddd2-122">Контейнеры</span><span class="sxs-lookup"><span data-stu-id="0ddd2-122">Containers</span></span>

<span data-ttu-id="0ddd2-123">Иногда о контейнерах и микрослужбах говорят так, как будто это одно и то же.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-123">Sometimes people talk about containers and microservices as if they were the same thing.</span></span> <span data-ttu-id="0ddd2-124">Это в корне неверно. Для создания микрослужб не нужны контейнеры. Тем не менее, контейнеры имеют некоторые преимущества, которые особенно актуальны для микрослужб, в частности:</span><span class="sxs-lookup"><span data-stu-id="0ddd2-124">While that's not true &mdash; you don't need containers to build microservices &mdash; containers do have some benefits that are particularly relevant to microservices, such as:</span></span>

- <span data-ttu-id="0ddd2-125">**Мобильность.**</span><span class="sxs-lookup"><span data-stu-id="0ddd2-125">**Portability**.</span></span> <span data-ttu-id="0ddd2-126">Образ контейнера представляет собой изолированный пакет, для запуска которого не нужно устанавливать библиотеки или другие зависимости.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-126">A container image is a standalone package that runs without needing to install libraries or other dependencies.</span></span> <span data-ttu-id="0ddd2-127">Благодаря этому их легче развертывать.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-127">That makes them easy to deploy.</span></span> <span data-ttu-id="0ddd2-128">Контейнеры можно быстро запустить и остановить, что позволяет развернуть новые экземпляры, чтобы обрабатывать большую нагрузку или восстанавливаться после сбоев узлов.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-128">Containers can be started and stopped quickly, so you can spin up new instances to handle more load or to recover from node failures.</span></span>

- <span data-ttu-id="0ddd2-129">**Плотность**.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-129">**Density**.</span></span> <span data-ttu-id="0ddd2-130">По сравнению с виртуальными машинами, контейнеры имеют меньшую плотность, так как они совместно используют ресурсы ОС.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-130">Containers are lightweight compared with running a virtual machine, because they share OS resources.</span></span> <span data-ttu-id="0ddd2-131">Благодаря этому можно упаковать несколько контейнеров в единый узел, что особенно полезно, когда приложение состоит из множества небольших служб.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-131">That makes it possible to pack multiple containers onto a single node, which is especially useful when the application consists of many small services.</span></span>

- <span data-ttu-id="0ddd2-132">**Изоляция ресурсов**.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-132">**Resource isolation**.</span></span> <span data-ttu-id="0ddd2-133">Вы можете ограничить объем ресурсов памяти и ЦП, которые доступны для контейнера, чтобы неконтролируемый процесс не исчерпал ресурсы узла.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-133">You can limit the amount of memory and CPU that is available to a container, which can help to ensure that a runaway process doesn't exhaust the host resources.</span></span> <span data-ttu-id="0ddd2-134">См. дополнительные сведения о [шаблоне отсеков](../../patterns/bulkhead.md).</span><span class="sxs-lookup"><span data-stu-id="0ddd2-134">See the [Bulkhead pattern](../../patterns/bulkhead.md) for more information.</span></span>

## <a name="serverless-functions-as-a-service"></a><span data-ttu-id="0ddd2-135">Бессерверная архитектура (функции как услуга)</span><span class="sxs-lookup"><span data-stu-id="0ddd2-135">Serverless (Functions as a Service)</span></span>

<span data-ttu-id="0ddd2-136">При использовании [бессерверной](https://azure.microsoft.com/solutions/serverless/) архитектуры не нужно управлять виртуальными машинами или инфраструктурой виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-136">With a [serverless](https://azure.microsoft.com/solutions/serverless/) architecture, you don't manage the VMs or the virtual network infrastructure.</span></span> <span data-ttu-id="0ddd2-137">Вместо этого, вы развертываете код, который будет передан службой размещения в виртуальную машину для выполнения.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-137">Instead, you deploy code and the hosting service handles putting that code onto a VM and executing it.</span></span> <span data-ttu-id="0ddd2-138">Этот подход поддерживает небольшие детализированные функции, которые координируются с использованием триггеров, основанных на событиях.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-138">This approach tends to favor small granular functions that are coordinated using event-based triggers.</span></span> <span data-ttu-id="0ddd2-139">Например, сообщение, помещенное в очередь, может запустить функцию, которая считывает из очереди и обрабатывает сообщение.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-139">For example, a message being placed onto a queue might trigger a function that reads from the queue and processes the message.</span></span>

<span data-ttu-id="0ddd2-140">[Функции Azure](/azure/azure-functions/) — это служба бессерверных вычислений, которая поддерживает различные триггеры функций, включая HTTP-запросы, очереди служебной шины и концентраторов событий события.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-140">[Azure Functions](/azure/azure-functions/) is a serverless compute service that supports various function triggers, including HTTP requests, Service Bus queues, and Event Hubs events.</span></span> <span data-ttu-id="0ddd2-141">Полный список см. в разделе [триггеры функций Azure и основные понятия привязки](/azure/azure-functions/functions-triggers-bindings).</span><span class="sxs-lookup"><span data-stu-id="0ddd2-141">For a complete list, see [Azure Functions triggers and bindings concepts](/azure/azure-functions/functions-triggers-bindings).</span></span> <span data-ttu-id="0ddd2-142">Также рассмотрите возможность ["Сетка событий Azure"](/azure/event-grid/), это управляемая служба маршрутизации событий в Azure.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-142">Also consider [Azure Event Grid](/azure/event-grid/), which is a managed event routing service in Azure.</span></span>

<!-- markdownlint-disable MD026 -->

## <a name="orchestrator-or-serverless"></a><span data-ttu-id="0ddd2-143">Архитектура с оркестрацией или независимая от сервера</span><span class="sxs-lookup"><span data-stu-id="0ddd2-143">Orchestrator or serverless?</span></span>

<!-- markdownlint-enable MD026 -->

<span data-ttu-id="0ddd2-144">Ниже приведено несколько факторов, которые нужно учитывать при выборе между архитектурой с оркестратором и бессерверной архитектурой.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-144">Here are some factors to consider when choosing between an orchestrator approach and a serverless approach.</span></span>

<span data-ttu-id="0ddd2-145">**Управляемость**. Бессерверными приложениями легче управлять, так как всеми вычислительными ресурсами управляет платформа.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-145">**Manageability** A serverless application is easy to manage, because the platform manages all the of compute resources for you.</span></span> <span data-ttu-id="0ddd2-146">При использовании оркестратора некоторые аспекты администрирования и настройки кластера представлены на абстрактном уровне, он не полностью скрывает базовые виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-146">While an orchestrator abstracts some aspects of managing and configuring a cluster, it does not completely hide the underlying VMs.</span></span> <span data-ttu-id="0ddd2-147">При использовании оркестратора вам будет необходимо думать о таких проблемах, как балансировка нагрузки, использование ЦП и памяти, а также работа сети.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-147">With an orchestrator, you will need to think about issues such as load balancing, CPU and memory usage, and networking.</span></span>

<span data-ttu-id="0ddd2-148">**Гибкость и контроль**.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-148">**Flexibility and control**.</span></span> <span data-ttu-id="0ddd2-149">С помощью оркестратора у вас появится больше контроля над настройкой служб и кластера, а также управлением ими.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-149">An orchestrator gives you a great deal of control over configuring and managing your services and the cluster.</span></span> <span data-ttu-id="0ddd2-150">Компромисс является дополнительной сложностью.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-150">The tradeoff is additional complexity.</span></span> <span data-ttu-id="0ddd2-151">При использовании бессерверной архитектуры вы теряете некоторую часть контроля, так как эти детали абстрагированы.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-151">With a serverless architecture, you give up some degree of control because these details are abstracted.</span></span>

<span data-ttu-id="0ddd2-152">**Мобильность.**</span><span class="sxs-lookup"><span data-stu-id="0ddd2-152">**Portability**.</span></span> <span data-ttu-id="0ddd2-153">Все перечисленные здесь оркестраторы (Kubernetes, DC/OS, Docker Swarm и Service Fabric) могут работать в локальной среде или в нескольких общедоступных облаках.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-153">All of the orchestrators listed here (Kubernetes, DC/OS, Docker Swarm, and Service Fabric) can run on-premises or in multiple public clouds.</span></span>

<span data-ttu-id="0ddd2-154">**Интеграция приложений**.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-154">**Application integration**.</span></span> <span data-ttu-id="0ddd2-155">Создание сложного приложения с бессерверной архитектурой может оказаться трудной задачей.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-155">It can be challenging to build a complex application using a serverless architecture.</span></span> <span data-ttu-id="0ddd2-156">Единственным вариантом в Azure является использование [Azure Logic Apps](/azure/logic-apps/) для координации набора функций Azure.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-156">One option in Azure is to use [Azure Logic Apps](/azure/logic-apps/) to coordinate a set of Azure Functions.</span></span> <span data-ttu-id="0ddd2-157">Пример этого подхода представлен в статье [Создание функции, интегрируемой с Azure Logic Apps](/azure/azure-functions/functions-twitter-email).</span><span class="sxs-lookup"><span data-stu-id="0ddd2-157">For an example of this approach, see [Create a function that integrates with Azure Logic Apps](/azure/azure-functions/functions-twitter-email).</span></span>

<span data-ttu-id="0ddd2-158">**Стоимость**.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-158">**Cost**.</span></span> <span data-ttu-id="0ddd2-159">С оркестратором вы платите за виртуальные машины, которые работают в кластере.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-159">With an orchestrator, you pay for the VMs that are running in the cluster.</span></span> <span data-ttu-id="0ddd2-160">С независимым от сервера приложением вы платите только за фактически использованные вычислительные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-160">With a serverless application, you pay only for the actual compute resources consumed.</span></span> <span data-ttu-id="0ddd2-161">В обоих случаях вам необходимо учитывать стоимость любых дополнительных служб, таких как хранилища, базы данных и службы обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-161">In both cases, you need to factor in the cost of any additional services, such as storage, databases, and messaging services.</span></span>

<span data-ttu-id="0ddd2-162">**Масштабируемость**.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-162">**Scalability**.</span></span> <span data-ttu-id="0ddd2-163">Функции Azure масштабируются автоматически в соответствии с требованиями в зависимости от числа входящих событий.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-163">Azure Functions scales automatically to meet demand, based on the number of incoming events.</span></span> <span data-ttu-id="0ddd2-164">При использовании оркестратора вы можете выполнить масштабирование, увеличив количество экземпляров службы, запущенных в кластере.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-164">With an orchestrator, you can scale out by increasing the number of service instances running in the cluster.</span></span> <span data-ttu-id="0ddd2-165">Вы также можете изменить масштаб, добавив дополнительные виртуальные машины в кластер.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-165">You can also scale by adding additional VMs to the cluster.</span></span>

<span data-ttu-id="0ddd2-166">В эталонной реализации в основном используется Kubernetes, но мы также использовали службу "Функции Azure" для службы "История доставки".</span><span class="sxs-lookup"><span data-stu-id="0ddd2-166">Our reference implementation primarily uses Kubernetes, but we did use Azure Functions for one service, namely the Delivery History service.</span></span> <span data-ttu-id="0ddd2-167">Функции Azure подходят этой конкретной службе, так как это управляемая событиями рабочая нагрузка.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-167">Azure Functions was a good fit for this particular service, because it's is an event-driven workload.</span></span> <span data-ttu-id="0ddd2-168">Так как для вызова функции используется триггер Центров событий, службе требуется минимальное количество кода.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-168">By using an Event Hubs trigger to invoke the function, the service needed a minimal amount of code.</span></span> <span data-ttu-id="0ddd2-169">Кроме того, служба "История доставки" не является частью основного рабочего процесса, поэтому ее запуск за пределами кластера Kubernetes не повлияет на совокупную задержку инициированных пользователем операций.</span><span class="sxs-lookup"><span data-stu-id="0ddd2-169">Also, the Delivery History service is not part of the main workflow, so running it outside of the Kubernetes cluster doesn't affect the end-to-end latency of user-initiated operations.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0ddd2-170">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="0ddd2-170">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="0ddd2-171">Обмен данными между службами</span><span class="sxs-lookup"><span data-stu-id="0ddd2-171">Interservice communication</span></span>](./interservice-communication.md)
