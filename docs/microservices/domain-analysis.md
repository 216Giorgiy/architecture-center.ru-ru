---
title: Анализ предметной области для микрослужб
description: Анализ предметной области для микрослужб.
author: MikeWasson
ms.date: 10/23/2018
ms.openlocfilehash: 7355c80dae9673378631e84a80b9e798d8ec4d4e
ms.sourcegitcommit: 1f4cdb08fe73b1956e164ad692f792f9f635b409
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2019
ms.locfileid: "54113014"
---
# <a name="designing-microservices-domain-analysis"></a><span data-ttu-id="d2d04-103">Проектирование микрослужб. Анализ домена</span><span class="sxs-lookup"><span data-stu-id="d2d04-103">Designing microservices: Domain analysis</span></span>

<span data-ttu-id="d2d04-104">Одной из основных проблем, связанных с микрослужбами, является определение границ отдельных служб.</span><span class="sxs-lookup"><span data-stu-id="d2d04-104">One of the biggest challenges of microservices is to define the boundaries of individual services.</span></span> <span data-ttu-id="d2d04-105">Общее правило состоит в том, что служба должна выполнять что-то одно, но правильное применение этого правила требует тщательного планирования.</span><span class="sxs-lookup"><span data-stu-id="d2d04-105">The general rule is that a service should do "one thing" &mdash; but putting that rule into practice requires careful thought.</span></span> <span data-ttu-id="d2d04-106">Механического процесса, создающего "правильную" структуру, не существует.</span><span class="sxs-lookup"><span data-stu-id="d2d04-106">There is no mechanical process that will produce the "right" design.</span></span> <span data-ttu-id="d2d04-107">Необходимо подробно рассмотреть предметную отрасль, требования и цели вашего бизнеса.</span><span class="sxs-lookup"><span data-stu-id="d2d04-107">You have to think deeply about your business domain, requirements, and goals.</span></span> <span data-ttu-id="d2d04-108">В противном случае можно столкнуться с непродуманной структурой, в которой есть некоторые нежелательные характеристики, такие как скрытые зависимости между службами, тесная взаимозависимость или плохо разработанные интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="d2d04-108">Otherwise, you can end up with a haphazard design that exhibits some undesirable characteristics, such as hidden dependencies between services, tight coupling, or poorly designed interfaces.</span></span> <span data-ttu-id="d2d04-109">В этой главе рассматривается проектирование микрослужб с использованием предметно-ориентированного подхода.</span><span class="sxs-lookup"><span data-stu-id="d2d04-109">In this chapter, we take a domain-driven approach to designing microservices.</span></span>

<span data-ttu-id="d2d04-110">Микрослужбы нужно разрабатывать с учетом бизнес-возможностей, а не горизонтальных слоев, таких как доступ к данным или обмен сообщениями.</span><span class="sxs-lookup"><span data-stu-id="d2d04-110">Microservices should be designed around business capabilities, not horizontal layers such as data access or messaging.</span></span> <span data-ttu-id="d2d04-111">Кроме того, службы должны иметь слабую взаимозависимость и высокую функциональную слаженность.</span><span class="sxs-lookup"><span data-stu-id="d2d04-111">In addition, they should have loose coupling and high functional cohesion.</span></span> <span data-ttu-id="d2d04-112">Микрослужбы *имеют слабую взаимозависимость*, если можно изменить одну службу без необходимости одновременного обновления других служб.</span><span class="sxs-lookup"><span data-stu-id="d2d04-112">Microservices are *loosely coupled* if you can change one service without requiring other services to be updated at the same time.</span></span> <span data-ttu-id="d2d04-113">Микрослужба считается *слаженной*, если у нее есть одна определенная цель, например управление учетными записями пользователей или отслеживание истории поставок.</span><span class="sxs-lookup"><span data-stu-id="d2d04-113">A microservice is *cohesive* if it has a single, well-defined purpose, such as managing user accounts or tracking delivery history.</span></span> <span data-ttu-id="d2d04-114">Служба должна содержать знания о предметной области и отделять эти знания от клиентов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-114">A service should encapsulate domain knowledge and abstract that knowledge from clients.</span></span> <span data-ttu-id="d2d04-115">Например, клиент должен иметь возможность запланировать полет дрона, не зная подробностей алгоритма планирования или управления парком дронов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-115">For example, a client should be able to schedule a drone without knowing the details of the scheduling algorithm or how the drone fleet is managed.</span></span>

<span data-ttu-id="d2d04-116">Предметно-ориентированное проектирование (DDD) предоставляет платформу, которая может помочь в разработке набора хорошо продуманных микрослужб.</span><span class="sxs-lookup"><span data-stu-id="d2d04-116">Domain-driven design (DDD) provides a framework that can get you most of the way to a set of well-designed microservices.</span></span> <span data-ttu-id="d2d04-117">Этот алгоритм имеет два отдельных этапа: стратегический и тактический.</span><span class="sxs-lookup"><span data-stu-id="d2d04-117">DDD has two distinct phases, strategic and tactical.</span></span> <span data-ttu-id="d2d04-118">На стратегическом этапе определяется масштабная структура системы.</span><span class="sxs-lookup"><span data-stu-id="d2d04-118">In strategic DDD, you are defining the large-scale structure of the system.</span></span> <span data-ttu-id="d2d04-119">Этот этап помогает гарантировать, что архитектура ориентирована на бизнес-возможности.</span><span class="sxs-lookup"><span data-stu-id="d2d04-119">Strategic DDD helps to ensure that your architecture remains focused on business capabilities.</span></span> <span data-ttu-id="d2d04-120">Тактический этап предоставляет набор конструктивных шаблонов, которые можно использовать для создания модели предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-120">Tactical DDD provides a set of design patterns that you can use to create the domain model.</span></span> <span data-ttu-id="d2d04-121">Эти шаблоны включают в себя сущности, статистические выражения и службы предметных областей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-121">These patterns include entities, aggregates, and domain services.</span></span> <span data-ttu-id="d2d04-122">Эти тактические шаблоны помогают создавать микрослужбы, имеющие слабую взаимозависимость и хорошую слаженность.</span><span class="sxs-lookup"><span data-stu-id="d2d04-122">These tactical patterns will help you to design microservices that are both loosely coupled and cohesive.</span></span>

![Схема процесса предметно-ориентированного проектирования (DDD)](./images/ddd-process.png)

<span data-ttu-id="d2d04-124">В этой и следующей главах мы рассмотрим приведенные ниже шаги, применяя их к приложению доставки с помощью дронов:</span><span class="sxs-lookup"><span data-stu-id="d2d04-124">In this chapter and the next, we'll walk through the following steps, applying them to the Drone Delivery application:</span></span>

1. <span data-ttu-id="d2d04-125">Начните с анализа предметной области бизнеса, чтобы разобраться в функциональных требованиях приложения.</span><span class="sxs-lookup"><span data-stu-id="d2d04-125">Start by analyzing the business domain to understand the application's functional requirements.</span></span> <span data-ttu-id="d2d04-126">В результате вы получите неформальное описание предметной области, которое можно разделить на более формальный набор моделей предметных областей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-126">The output of this step is an informal description of the domain, which can be refined into a more formal set of domain models.</span></span>

2. <span data-ttu-id="d2d04-127">Затем определите *ограниченные контексты* предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-127">Next, define the *bounded contexts* of the domain.</span></span> <span data-ttu-id="d2d04-128">Каждый ограниченный контекст содержит модель предметной области, которая представляет определенную подобласть крупного приложения.</span><span class="sxs-lookup"><span data-stu-id="d2d04-128">Each bounded context contains a domain model that represents a particular subdomain of the larger application.</span></span>

3. <span data-ttu-id="d2d04-129">В рамках ограниченного контекста примените тактические шаблоны DDD, чтобы определить сущности, статистические выражения и службы предметных областей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-129">Within a bounded context, apply tactical DDD patterns to define entities, aggregates, and domain services.</span></span>

4. <span data-ttu-id="d2d04-130">На основе результатов предыдущего шага идентифицируйте микрослужбы в своем приложении.</span><span class="sxs-lookup"><span data-stu-id="d2d04-130">Use the results from the previous step to identify the microservices in your application.</span></span>

<span data-ttu-id="d2d04-131">В этой главе мы рассмотрим первые три шага, которые в первую очередь касаются предметно-ориентированного проектирования.</span><span class="sxs-lookup"><span data-stu-id="d2d04-131">In this chapter, we cover the first three steps, which are primarily concerned with DDD.</span></span> <span data-ttu-id="d2d04-132">В следующей главе мы определим микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="d2d04-132">In the next chapter, we will identify the microservices.</span></span> <span data-ttu-id="d2d04-133">Важно помнить, что предметно-ориентированное проектирование — это итеративный текущий процесс.</span><span class="sxs-lookup"><span data-stu-id="d2d04-133">However, it's important to remember that DDD is an iterative, ongoing process.</span></span> <span data-ttu-id="d2d04-134">Ограничения службы не зафиксированы.</span><span class="sxs-lookup"><span data-stu-id="d2d04-134">Service boundaries aren't fixed in stone.</span></span> <span data-ttu-id="d2d04-135">По мере развития приложения можно разбить службу на несколько небольших служб.</span><span class="sxs-lookup"><span data-stu-id="d2d04-135">As an application evolves, you may decide to break apart a service into several smaller services.</span></span>

> [!NOTE]
> <span data-ttu-id="d2d04-136">Эта глава не предназначена для демонстрации полного и исчерпывающего анализа предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-136">This chapter is not meant to show a complete and comprehensive domain analysis.</span></span> <span data-ttu-id="d2d04-137">Мы намеренно приводим небольшой пример, чтобы продемонстрировать основные аспекты.</span><span class="sxs-lookup"><span data-stu-id="d2d04-137">We deliberately kept the example brief, in order to illustrate the main points.</span></span> <span data-ttu-id="d2d04-138">Общие сведения о проблемно-ориентированном проектировании можно найти в *одноименной книге* Эрика Эванса (Eric Evans), в которой был впервые представлен этот термин.</span><span class="sxs-lookup"><span data-stu-id="d2d04-138">For more background on DDD, we recommend Eric Evans' *Domain-Driven Design*, the book that first introduced the term.</span></span> <span data-ttu-id="d2d04-139">Другим хорошим справочником является книга Вона Вернона (Vaughn Vernon) *Реализация методов предметно-ориентированного проектирования*.</span><span class="sxs-lookup"><span data-stu-id="d2d04-139">Another good reference is *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span>

## <a name="analyze-the-domain"></a><span data-ttu-id="d2d04-140">Анализ предметной области</span><span class="sxs-lookup"><span data-stu-id="d2d04-140">Analyze the domain</span></span>

<span data-ttu-id="d2d04-141">Используя подход DDD, можно создавать микрослужбы так, чтобы каждая форма службы естественным образом совпадала с функциональным бизнес-требованием.</span><span class="sxs-lookup"><span data-stu-id="d2d04-141">Using a DDD approach will help you to design microservices so that every service forms a natural fit to a functional business requirement.</span></span> <span data-ttu-id="d2d04-142">Так вы сможете избежать ловушки, когда ограничения организации или технологии будут определять структуру.</span><span class="sxs-lookup"><span data-stu-id="d2d04-142">It can help you to avoid the trap of letting organizational boundaries or technology choices dictate your design.</span></span>

<span data-ttu-id="d2d04-143">Прежде чем написать код, необходимо иметь общее представление о создаваемой системе.</span><span class="sxs-lookup"><span data-stu-id="d2d04-143">Before writing any code, you need a bird's eye view of the system that you are creating.</span></span> <span data-ttu-id="d2d04-144">DDD начинается с моделирования предметной области бизнеса и создания *ее модели*.</span><span class="sxs-lookup"><span data-stu-id="d2d04-144">DDD starts by modeling the business domain and creating a *domain model*.</span></span> <span data-ttu-id="d2d04-145">Модель предметной области является абстрактной моделью предметной области бизнеса.</span><span class="sxs-lookup"><span data-stu-id="d2d04-145">The domain model is an abstract model of the business domain.</span></span> <span data-ttu-id="d2d04-146">Она извлекает и организует знания о предметной области, а также предоставляет общий язык для разработчиков и экспертов соответствующей сферы.</span><span class="sxs-lookup"><span data-stu-id="d2d04-146">It distills and organizes domain knowledge, and provides a common language for developers and domain experts.</span></span>

<span data-ttu-id="d2d04-147">Начните с составления схемы всех бизнес-функций и их связей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-147">Start by mapping all of the business functions and their connections.</span></span> <span data-ttu-id="d2d04-148">Это совместный процесс, в котором участвуют эксперты в соответствующей сфере, архитекторы ПО и другие заинтересованные лица.</span><span class="sxs-lookup"><span data-stu-id="d2d04-148">This will likely be a collaborative effort that involves domain experts, software architects, and other stakeholders.</span></span> <span data-ttu-id="d2d04-149">Какой-либо конкретный формализм использовать необязательно.</span><span class="sxs-lookup"><span data-stu-id="d2d04-149">You don't need to use any particular formalism.</span></span>  <span data-ttu-id="d2d04-150">Нарисуйте схему на бумаге или доске.</span><span class="sxs-lookup"><span data-stu-id="d2d04-150">Sketch a diagram or draw on whiteboard.</span></span>

<span data-ttu-id="d2d04-151">Создавая схему, можно начать определять дискретные подобласти.</span><span class="sxs-lookup"><span data-stu-id="d2d04-151">As you fill in the diagram, you may start to identify discrete subdomains.</span></span> <span data-ttu-id="d2d04-152">Какие функции тесно связаны?</span><span class="sxs-lookup"><span data-stu-id="d2d04-152">Which functions are closely related?</span></span> <span data-ttu-id="d2d04-153">Какие функции являются основными для бизнеса, а какие предоставляют вспомогательные службы?</span><span class="sxs-lookup"><span data-stu-id="d2d04-153">Which functions are core to the business, and which provide ancillary services?</span></span> <span data-ttu-id="d2d04-154">Что такое схема зависимостей?</span><span class="sxs-lookup"><span data-stu-id="d2d04-154">What is the dependency graph?</span></span> <span data-ttu-id="d2d04-155">На начальном этапе технологии и подробности реализации не важны.</span><span class="sxs-lookup"><span data-stu-id="d2d04-155">During this initial phase, you aren't concerned with technologies or implementation details.</span></span> <span data-ttu-id="d2d04-156">Все же следует отметить место, где приложение нужно будет интегрировать с внешними системами, такими как CRM, система обработки оплаты или выставления счетов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-156">That said, you should note the place where the application will need to integrate with external systems, such as CRM, payment processing, or billing systems.</span></span>

## <a name="drone-delivery-analyzing-the-business-domain"></a><span data-ttu-id="d2d04-157">Доставка с помощью дронов. Анализ предметной области для бизнеса</span><span class="sxs-lookup"><span data-stu-id="d2d04-157">Drone Delivery: Analyzing the business domain</span></span>

<span data-ttu-id="d2d04-158">После первоначального анализа предметной области команда Fabrikam создала приблизительный эскиз, представляющий предметную область "Доставка с помощью дронов".</span><span class="sxs-lookup"><span data-stu-id="d2d04-158">After some initial domain analysis, the Fabrikam team came up with a rough sketch that depicts the Drone Delivery domain.</span></span>

![Схема предметной области для службы доставки дронами](./images/ddd1.svg)

- <span data-ttu-id="d2d04-160">Функция **Доставка** размещается в центре схемы, так как она является основной для бизнеса.</span><span class="sxs-lookup"><span data-stu-id="d2d04-160">**Shipping** is placed in the center of the diagram, because it's core to the business.</span></span> <span data-ttu-id="d2d04-161">Все остальное в схеме предназначено для обеспечения этой функции.</span><span class="sxs-lookup"><span data-stu-id="d2d04-161">Everything else in the diagram exists to enable this functionality.</span></span>
- <span data-ttu-id="d2d04-162">**Управление дронами** также является ключевой бизнес-функцией.</span><span class="sxs-lookup"><span data-stu-id="d2d04-162">**Drone management** is also core to the business.</span></span> <span data-ttu-id="d2d04-163">Функция, которая тесно связана с управлением дронами, включает **их ремонт** и использование **прогнозного анализа** для прогнозирования, когда дроны нуждаются в обслуживании.</span><span class="sxs-lookup"><span data-stu-id="d2d04-163">Functionality that is closely related to drone management includes **drone repair** and using **predictive analysis** to predict when drones need servicing and maintenance.</span></span>
- <span data-ttu-id="d2d04-164">**Анализ ETA** предоставляет оценки времени приема и доставки.</span><span class="sxs-lookup"><span data-stu-id="d2d04-164">**ETA analysis** provides time estimates for pickup and delivery.</span></span>
- <span data-ttu-id="d2d04-165">**Транспортировка сторонними лицами** позволяет приложению планировать другие способы транспортировки, если груз невозможно полностью отправить с помощью дрона.</span><span class="sxs-lookup"><span data-stu-id="d2d04-165">**Third-party transportation** will enable the application to schedule alternative transportation methods if a package cannot be shipped entirely by drone.</span></span>
- <span data-ttu-id="d2d04-166">**Совместное использование дрона** является возможным расширением основной бизнес-функции.</span><span class="sxs-lookup"><span data-stu-id="d2d04-166">**Drone sharing** is a possible extension of the core business.</span></span> <span data-ttu-id="d2d04-167">В определенные часы у компании может быть избыточное количество дронов, которые можно сдавать в аренду, чтобы они не простаивали.</span><span class="sxs-lookup"><span data-stu-id="d2d04-167">The company may have excess drone capacity during certain hours, and could rent out drones that would otherwise be idle.</span></span> <span data-ttu-id="d2d04-168">Этой возможности не будет в первоначальной версии.</span><span class="sxs-lookup"><span data-stu-id="d2d04-168">This feature will not be in the initial release.</span></span>
- <span data-ttu-id="d2d04-169">**Видеонаблюдение** является еще одной областью расширения деятельности для компании.</span><span class="sxs-lookup"><span data-stu-id="d2d04-169">**Video surveillance** is another area that the company might expand into later.</span></span>
- <span data-ttu-id="d2d04-170">**Учетные записи пользователей**, **Выставление счетов** и **Центр обработки вызовов** — это подобласти, используемые для поддержки основных бизнес-процессов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-170">**User accounts**, **Invoicing**, and **Call center** are subdomains that support the core business.</span></span>

<span data-ttu-id="d2d04-171">Обратите внимание, что на этом этапе никаких решений о реализации и технологиях не принималось.</span><span class="sxs-lookup"><span data-stu-id="d2d04-171">Notice that at this point in the process, we haven't made any decisions about implementation or technologies.</span></span> <span data-ttu-id="d2d04-172">Некоторые из подсистем могут включать внешние программные системы или сторонние службы.</span><span class="sxs-lookup"><span data-stu-id="d2d04-172">Some of the subsystems may involve external software systems or third-party services.</span></span> <span data-ttu-id="d2d04-173">Тем не менее приложению необходимо взаимодействовать с этими системами и службами, поэтому важно включить их в модель предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-173">Even so, the application needs to interact with these systems and services, so it's important to include them in the domain model.</span></span>

> [!NOTE]
> <span data-ttu-id="d2d04-174">Если приложение зависит от внешней системы, есть риск, что может произойти утечка схемы данных внешней системы или API в приложение, что может скомпрометировать архитектурный проект.</span><span class="sxs-lookup"><span data-stu-id="d2d04-174">When an application depends on an external system, there is a risk that the external system's data schema or API will leak into your application, ultimately compromising the architectural design.</span></span> <span data-ttu-id="d2d04-175">Это особенно верно в отношении устаревших систем, которые могут не следовать современным рекомендациям и могут использовать сложные схемы данных или устаревшие API.</span><span class="sxs-lookup"><span data-stu-id="d2d04-175">This is particularly true with legacy systems that may not follow modern best practices, and may use convoluted data schemas or obsolete APIs.</span></span> <span data-ttu-id="d2d04-176">В этом случае важно иметь четко определенную границу между внешними системами и приложением.</span><span class="sxs-lookup"><span data-stu-id="d2d04-176">In that case, it's important to have a well-defined boundary between these external systems and the application.</span></span> <span data-ttu-id="d2d04-177">Вы можете использовать [шаблон подавления](../patterns/strangler.md) или [шаблон уровня защиты от повреждений](../patterns/anti-corruption-layer.md) для этой цели.</span><span class="sxs-lookup"><span data-stu-id="d2d04-177">Consider using the [Strangler pattern](../patterns/strangler.md) or the [Anti-Corruption Layer pattern](../patterns/anti-corruption-layer.md) for this purpose.</span></span>

## <a name="define-bounded-contexts"></a><span data-ttu-id="d2d04-178">Определение ограниченных контекстов</span><span class="sxs-lookup"><span data-stu-id="d2d04-178">Define bounded contexts</span></span>

<span data-ttu-id="d2d04-179">Модель предметной области включает представления реальных вещей &mdash; пользователей, дронов, грузов и т. д.</span><span class="sxs-lookup"><span data-stu-id="d2d04-179">The domain model will include representations of real things in the world &mdash; users, drones, packages, and so forth.</span></span> <span data-ttu-id="d2d04-180">Однако это не значит, что каждая часть системы должна использовать одни и те же представления для одних и тех же вещей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-180">But that doesn't mean that every part of the system needs to use the same representations for the same things.</span></span>

<span data-ttu-id="d2d04-181">Например, подсистемы, обрабатывающие ремонт дронов и прогнозную аналитику, должны представлять множество физических характеристик дронов, таких как история обслуживания, пробег, срок службы, номер модели, характеристики работы и т. д.</span><span class="sxs-lookup"><span data-stu-id="d2d04-181">For example, subsystems that handle drone repair and predictive analysis will need to represent many physical characteristics drones, such as their maintenance history, mileage, age, model number, performance characteristics, and so on.</span></span> <span data-ttu-id="d2d04-182">Однако при планировании доставки это нам неинтересно.</span><span class="sxs-lookup"><span data-stu-id="d2d04-182">But when it's time to schedule a delivery, we don't care about those things.</span></span> <span data-ttu-id="d2d04-183">Подсистеме планирования необходимо знать, доступен ли дрон, а также предполагаемое время для приема и доставки (ETA).</span><span class="sxs-lookup"><span data-stu-id="d2d04-183">The scheduling subsystem only needs to know whether a drone is available, and the ETA for pickup and delivery.</span></span>

<span data-ttu-id="d2d04-184">Если бы мы попытались создать единую модель для обеих этих подсистем, это было бы излишне сложным.</span><span class="sxs-lookup"><span data-stu-id="d2d04-184">If we tried to create a single model for both of these subsystems, it would be unnecessarily complex.</span></span> <span data-ttu-id="d2d04-185">С течением времени модель будет все сложнее видоизменять, так как любые изменения должны будут удовлетворять несколько команд, работающих над отдельными подсистемами.</span><span class="sxs-lookup"><span data-stu-id="d2d04-185">It would also become harder for the model to evolve over time, because any changes will need to satisfy multiple teams working on separate subsystems.</span></span> <span data-ttu-id="d2d04-186">Поэтому зачастую лучше разрабатывать отдельные модели, которые представляют один и тот же объект реального мира (в данном случае дрон) в двух разных контекстах.</span><span class="sxs-lookup"><span data-stu-id="d2d04-186">Therefore, it's often better to design separate models that represent the same real-world entity (in this case, a drone) in two different contexts.</span></span> <span data-ttu-id="d2d04-187">Каждая модель содержит только те функции и атрибуты, которые имеют отношение к конкретному контексту.</span><span class="sxs-lookup"><span data-stu-id="d2d04-187">Each model contains only the features and attributes that are relevant within its particular context.</span></span>

<span data-ttu-id="d2d04-188">Именно здесь вступает в действие концепция *ограниченных контекстов*, существующая в рамках предметно-ориентированного проектирования.</span><span class="sxs-lookup"><span data-stu-id="d2d04-188">This is where the DDD concept of *bounded contexts* comes into play.</span></span> <span data-ttu-id="d2d04-189">Ограниченный контекст — это просто граница внутри предметной области, где применяется конкретная модель предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-189">A bounded context is simply the boundary within a domain where a particular domain model applies.</span></span> <span data-ttu-id="d2d04-190">Рассматривая предыдущую схему, можно группировать функции в зависимости от того, будут ли различные функции использовать одну модель предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-190">Looking at the previous diagram, we can group functionality according to whether various functions will share a single domain model.</span></span>

![Схема ограниченных контекстов](./images/ddd2.svg)

<span data-ttu-id="d2d04-192">Ограниченные контексты не обязательно изолировать друг от друга.</span><span class="sxs-lookup"><span data-stu-id="d2d04-192">Bounded contexts are not necessarily isolated from one another.</span></span> <span data-ttu-id="d2d04-193">На этой схеме сплошные линии, соединяющие ограниченные контексты, представляют места, где взаимодействуют два ограниченных контекста.</span><span class="sxs-lookup"><span data-stu-id="d2d04-193">In this diagram, the solid lines connecting the bounded contexts represent places where two bounded contexts interact.</span></span> <span data-ttu-id="d2d04-194">Например, область "Доставка" зависит от области "Учетные записи пользователей" для получения информации о клиентах и от области "Управление дронами" для планирования полетов отдельных дронов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-194">For example, Shipping depends on User Accounts to get information about customers, and on Drone Management to schedule drones from the fleet.</span></span>

<span data-ttu-id="d2d04-195">В книге *Проблемно-ориентированное проектирование* Эрик Эванс описывает шаблоны по поддержке целостности модели предметной области при взаимодействии с другим ограниченным контекстом.</span><span class="sxs-lookup"><span data-stu-id="d2d04-195">In the book *Domain Driven Design*, Eric Evans describes several patterns for maintaining the integrity of a domain model when it interacts with another bounded context.</span></span> <span data-ttu-id="d2d04-196">Одним из основных принципов микрослужб является то, что службы обмениваются данными через четко определенные API.</span><span class="sxs-lookup"><span data-stu-id="d2d04-196">One of the main principles of microservices is that services communicate through well-defined APIs.</span></span> <span data-ttu-id="d2d04-197">Этот подход соответствует двум шаблонам, которые Эванс называет открытой службой размещения и опубликованным языком.</span><span class="sxs-lookup"><span data-stu-id="d2d04-197">This approach corresponds to two patterns that Evans calls Open Host Service and Published Language.</span></span> <span data-ttu-id="d2d04-198">Идея открытой службы размещения заключается в том, что подсистема определяет формальный протокол (API), через который другие подсистемы могут взаимодействовать с ней.</span><span class="sxs-lookup"><span data-stu-id="d2d04-198">The idea of Open Host Service is that a subsystem defines a formal protocol (API) for other subsystems to communicate with it.</span></span> <span data-ttu-id="d2d04-199">Опубликованный язык расширяет эту идею, публикуя API в форме, которую другие команды могут использовать для написания клиентов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-199">Published Language extends this idea by publishing the API in a form that other teams can use to write clients.</span></span> <span data-ttu-id="d2d04-200">В главе, посвященной [созданию API](./api-design.md), мы обсудим использование [спецификации OpenAPI](https://www.openapis.org/specification/repo) (ранее известной как Swagger) для определения описаний зависящего от языка интерфейса для REST API, выраженных в формате JSON или YAML.</span><span class="sxs-lookup"><span data-stu-id="d2d04-200">In the chapter on [API Design](./api-design.md), we discuss using [OpenAPI Specification](https://www.openapis.org/specification/repo) (formerly known as Swagger) to define language-agnostic interface descriptions for REST APIs, expressed in JSON or YAML format.</span></span>

<span data-ttu-id="d2d04-201">В оставшейся части этого руководства мы сконцентрируемся на ограниченном контексте доставки.</span><span class="sxs-lookup"><span data-stu-id="d2d04-201">For the rest of this journey, we will focus on the Shipping bounded context.</span></span>

## <a name="tactical-ddd"></a><span data-ttu-id="d2d04-202">Тактическое предметно-ориентированное проектирование</span><span class="sxs-lookup"><span data-stu-id="d2d04-202">Tactical DDD</span></span>

<span data-ttu-id="d2d04-203">На стратегическом этапе предметно-ориентированного проектирования составляется схема предметной области бизнеса и определяются ограниченные контексты для модели предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-203">During the strategic phase of DDD, you are mapping out the business domain and defining bounded contexts for your domain models.</span></span> <span data-ttu-id="d2d04-204">На тактическом этапе модели предметной области определяются с более высокой точностью.</span><span class="sxs-lookup"><span data-stu-id="d2d04-204">Tactical DDD is when you define your domain models with more precision.</span></span> <span data-ttu-id="d2d04-205">Тактические шаблоны применяются в рамках одного ограниченного контекста.</span><span class="sxs-lookup"><span data-stu-id="d2d04-205">The tactical patterns are applied within a single bounded context.</span></span> <span data-ttu-id="d2d04-206">В архитектуре микрослужб нас особенно интересуют шаблоны статистических выражений и сущностей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-206">In a microservices architecture, we are particularly interested in the entity and aggregate patterns.</span></span> <span data-ttu-id="d2d04-207">Применение этих шаблонов помогает определить естественные границы служб в приложении (см. в [следующей главе](./microservice-boundaries.md)).</span><span class="sxs-lookup"><span data-stu-id="d2d04-207">Applying these patterns will help us to identify natural boundaries for the services in our application (see [next chapter](./microservice-boundaries.md)).</span></span> <span data-ttu-id="d2d04-208">Как правило, микрослужба должна быть не меньше статистического выражения и не больше ограниченного контекста.</span><span class="sxs-lookup"><span data-stu-id="d2d04-208">As a general principle, a microservice should be no smaller than an aggregate, and no larger than a bounded context.</span></span> <span data-ttu-id="d2d04-209">Сначала рассмотрим тактические шаблоны.</span><span class="sxs-lookup"><span data-stu-id="d2d04-209">First, we'll review the tactical patterns.</span></span> <span data-ttu-id="d2d04-210">Затем мы применим их к ограниченному контексту доставки в приложении доставки с помощью дронов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-210">Then we'll apply them to the Shipping bounded context in the Drone Delivery application.</span></span>

### <a name="overview-of-the-tactical-patterns"></a><span data-ttu-id="d2d04-211">Общие сведения о тактических шаблонах</span><span class="sxs-lookup"><span data-stu-id="d2d04-211">Overview of the tactical patterns</span></span>

<span data-ttu-id="d2d04-212">Этот раздел содержит краткую сводку тактических шаблонов DDD. Так что, если вы уже знакомы с ними, можете переходить к следующему разделу.</span><span class="sxs-lookup"><span data-stu-id="d2d04-212">This section provides a brief summary of the tactical DDD patterns, so if you are already familiar with DDD, you can probably skip this section.</span></span> <span data-ttu-id="d2d04-213">Более подробно шаблоны описаны в главах 5&ndash;6 книги Эрика Эванса и в книге Вона Вернона *Реализация методов предметно-ориентированного проектирования*.</span><span class="sxs-lookup"><span data-stu-id="d2d04-213">The patterns are described in more detail in chapters 5 &ndash; 6 of Eric Evans' book, and in *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span>

![Схема тактических шаблонов в проблемно-ориентированном проектировании](./images/ddd-patterns.png)

<span data-ttu-id="d2d04-215">**Сущности**.</span><span class="sxs-lookup"><span data-stu-id="d2d04-215">**Entities**.</span></span> <span data-ttu-id="d2d04-216">Сущность представляет собой объект с уникальным идентификатором, который сохраняется с течением времени.</span><span class="sxs-lookup"><span data-stu-id="d2d04-216">An entity is an object with a unique identity that persists over time.</span></span> <span data-ttu-id="d2d04-217">Например, в банковском приложении клиенты и учетные записи выступают сущностями.</span><span class="sxs-lookup"><span data-stu-id="d2d04-217">For example, in a banking application, customers and accounts would be entities.</span></span>

- <span data-ttu-id="d2d04-218">У сущности в системе есть уникальный идентификатор, который может использоваться для поиска или извлечения объекта.</span><span class="sxs-lookup"><span data-stu-id="d2d04-218">An entity has a unique identifier in the system, which can be used to look up or retrieve the entity.</span></span> <span data-ttu-id="d2d04-219">Это не означает, что идентификатор всегда предоставляется пользователям напрямую.</span><span class="sxs-lookup"><span data-stu-id="d2d04-219">That doesn't mean the identifier is always exposed directly to users.</span></span> <span data-ttu-id="d2d04-220">Это может быть GUID или первичный ключ в базе данных.</span><span class="sxs-lookup"><span data-stu-id="d2d04-220">It could be a GUID or a primary key in a database.</span></span>
- <span data-ttu-id="d2d04-221">Идентификатор может охватывать несколько ограниченных контекстов. Срок его действия может превышать время существования приложения.</span><span class="sxs-lookup"><span data-stu-id="d2d04-221">An identity may span multiple bounded contexts, and may endure beyond the lifetime of the application.</span></span> <span data-ttu-id="d2d04-222">Например, номера банковских счетов или идентификаторы, выданные правительством, не привязаны к времени существования конкретного приложения.</span><span class="sxs-lookup"><span data-stu-id="d2d04-222">For example, bank account numbers or government-issued IDs are not tied to the lifetime of a particular application.</span></span>
- <span data-ttu-id="d2d04-223">Атрибуты сущности могут изменяться со временем.</span><span class="sxs-lookup"><span data-stu-id="d2d04-223">The attributes of an entity may change over time.</span></span> <span data-ttu-id="d2d04-224">Например, имя или адрес пользователя могут измениться, но сущность останется одной и той же.</span><span class="sxs-lookup"><span data-stu-id="d2d04-224">For example, a person's name or address might change, but they are still the same person.</span></span>
- <span data-ttu-id="d2d04-225">Сущность может содержать ссылки на другие сущности.</span><span class="sxs-lookup"><span data-stu-id="d2d04-225">An entity can hold references to other entities.</span></span>

<span data-ttu-id="d2d04-226">**Объекты-значения**.</span><span class="sxs-lookup"><span data-stu-id="d2d04-226">**Value objects**.</span></span> <span data-ttu-id="d2d04-227">Объект-значение не имеет идентификатора.</span><span class="sxs-lookup"><span data-stu-id="d2d04-227">A value object has no identity.</span></span> <span data-ttu-id="d2d04-228">Он определяется только значениями его атрибутов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-228">It is defined only by the values of its attributes.</span></span> <span data-ttu-id="d2d04-229">Объекты-значения также являются неизменяемыми.</span><span class="sxs-lookup"><span data-stu-id="d2d04-229">Value objects are also immutable.</span></span> <span data-ttu-id="d2d04-230">Чтобы обновить объект-значение, всегда создавайте новый экземпляр для замены старого.</span><span class="sxs-lookup"><span data-stu-id="d2d04-230">To update a value object, you always create a new instance to replace the old one.</span></span> <span data-ttu-id="d2d04-231">Объекты-значения могут иметь методы, которые внедряют логику предметной области, но эти методы не должны иметь побочных эффектов для состояния объекта.</span><span class="sxs-lookup"><span data-stu-id="d2d04-231">Value objects can have methods that encapsulate domain logic, but those methods should have no side-effects on the object's state.</span></span> <span data-ttu-id="d2d04-232">К самым распространенным примерам объектов-значений относятся цвета, даты и время, а также значения валюты.</span><span class="sxs-lookup"><span data-stu-id="d2d04-232">Typical examples of value objects include colors, dates and times, and currency values.</span></span>

<span data-ttu-id="d2d04-233">**Статистические выражения**.</span><span class="sxs-lookup"><span data-stu-id="d2d04-233">**Aggregates**.</span></span> <span data-ttu-id="d2d04-234">Статистическое выражение определяет границу согласованности одной или нескольких сущностей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-234">An aggregate defines a consistency boundary around one or more entities.</span></span> <span data-ttu-id="d2d04-235">Одна сущность в статистическом выражении является корневой.</span><span class="sxs-lookup"><span data-stu-id="d2d04-235">Exactly one entity in an aggregate is the root.</span></span> <span data-ttu-id="d2d04-236">Поиск выполняется по идентификатору корневой сущности.</span><span class="sxs-lookup"><span data-stu-id="d2d04-236">Lookup is done using the root entity's identifier.</span></span> <span data-ttu-id="d2d04-237">Любые другие сущности в статистическом выражении являются дочерними элементами корневой сущности, на которые ссылаются следующие указатели корневой сущности.</span><span class="sxs-lookup"><span data-stu-id="d2d04-237">Any other entities in the aggregate are children of the root, and are referenced by following pointers from the root.</span></span>

<span data-ttu-id="d2d04-238">Статистические выражения предназначены для моделирования транзакционных инвариантов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-238">The purpose of an aggregate is to model transactional invariants.</span></span> <span data-ttu-id="d2d04-239">Вещи в реальном мире имеют сложные сети связей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-239">Things in the real world have complex webs of relationships.</span></span> <span data-ttu-id="d2d04-240">Клиенты размещают заказы, заказы содержат продукты, продукты поставляются поставщиками и т. д.</span><span class="sxs-lookup"><span data-stu-id="d2d04-240">Customers create orders, orders contain products, products have suppliers, and so on.</span></span> <span data-ttu-id="d2d04-241">Если приложение изменяет несколько связанных объектов, как оно гарантирует согласованность?</span><span class="sxs-lookup"><span data-stu-id="d2d04-241">If the application modifies several related objects, how does it guarantee consistency?</span></span> <span data-ttu-id="d2d04-242">Как отслеживать инварианты и применять их?</span><span class="sxs-lookup"><span data-stu-id="d2d04-242">How do we keep track of invariants and enforce them?</span></span>  

<span data-ttu-id="d2d04-243">Традиционные приложения часто используют транзакции базы данных для обеспечения согласованности.</span><span class="sxs-lookup"><span data-stu-id="d2d04-243">Traditional applications have often used database transactions to enforce consistency.</span></span> <span data-ttu-id="d2d04-244">Однако в распределенном приложении это, как правило, нецелесообразно.</span><span class="sxs-lookup"><span data-stu-id="d2d04-244">In a distributed application, however, that's often not feasible.</span></span> <span data-ttu-id="d2d04-245">Одна бизнес-транзакция может охватывать несколько хранилищ данных, долго выполняться или включать сторонние службы.</span><span class="sxs-lookup"><span data-stu-id="d2d04-245">A single business transaction may span multiple data stores, or may be long running, or may involve third-party services.</span></span> <span data-ttu-id="d2d04-246">В конечном итоге обеспечение требуемых для предметной области инвариантов зависит от приложения, а не от уровня данных.</span><span class="sxs-lookup"><span data-stu-id="d2d04-246">Ultimately it's up to the application, not the data layer, to enforce the invariants required for the domain.</span></span> <span data-ttu-id="d2d04-247">Вот что должны моделировать статистические выражения.</span><span class="sxs-lookup"><span data-stu-id="d2d04-247">That's what aggregates are meant to model.</span></span>

> [!NOTE]
> <span data-ttu-id="d2d04-248">Статистическое выражение может состоять из одной сущности без каких-либо дочерних сущностей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-248">An aggregate might consist of a single entity, without child entities.</span></span> <span data-ttu-id="d2d04-249">Этот объект является статистическим выражением благодаря транзакционной границе.</span><span class="sxs-lookup"><span data-stu-id="d2d04-249">What makes it an aggregate is the transactional boundary.</span></span>

<span data-ttu-id="d2d04-250">**Службы предметных областей и службы приложений**.</span><span class="sxs-lookup"><span data-stu-id="d2d04-250">**Domain and application services**.</span></span> <span data-ttu-id="d2d04-251">В терминологии DDD служба является объектом, который реализует логику без удержания какого-либо состояния.</span><span class="sxs-lookup"><span data-stu-id="d2d04-251">In DDD terminology, a service is an object that implements some logic without holding any state.</span></span> <span data-ttu-id="d2d04-252">Эванс различает *службы предметных областей*, которые содержат логику предметной области, и *службы приложений*, которые предоставляют технические функциональные возможности, такие как проверка подлинности пользователя или отправка текстового сообщения.</span><span class="sxs-lookup"><span data-stu-id="d2d04-252">Evans distinguishes between *domain services*, which encapsulate domain logic, and *application services*, which provide technical functionality, such as user authentication or sending an SMS message.</span></span> <span data-ttu-id="d2d04-253">Службы предметных областей часто используются для моделирования реакции на событие, охватывающей несколько сущностей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-253">Domain services are often used to model behavior that spans multiple entities.</span></span>

> [!NOTE]
> <span data-ttu-id="d2d04-254">Термин *служба* перегружен в разработке программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="d2d04-254">The term *service* is overloaded in software development.</span></span> <span data-ttu-id="d2d04-255">Приведенное здесь определение не связано непосредственно с микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="d2d04-255">The definition here is not directly related to microservices.</span></span>

<span data-ttu-id="d2d04-256">**События предметной области**.</span><span class="sxs-lookup"><span data-stu-id="d2d04-256">**Domain events**.</span></span> <span data-ttu-id="d2d04-257">События предметной области могут использоваться для уведомления других частей системы, когда происходит событие.</span><span class="sxs-lookup"><span data-stu-id="d2d04-257">Domain events can be used to notify other parts of the system when something happens.</span></span> <span data-ttu-id="d2d04-258">Как следует из названия, события предметной области должны означать что-то внутри предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-258">As the name suggests, domain events should mean something within the domain.</span></span> <span data-ttu-id="d2d04-259">Например, "в таблицу вставлена запись" не является событием предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-259">For example, "a record was inserted into a table" is not a domain event.</span></span> <span data-ttu-id="d2d04-260">"Доставка отменена" — пример события предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-260">"A delivery was cancelled" is a domain event.</span></span> <span data-ttu-id="d2d04-261">События предметной области особенно важны в архитектуре микрослужб.</span><span class="sxs-lookup"><span data-stu-id="d2d04-261">Domain events are especially relevant in a microservices architecture.</span></span> <span data-ttu-id="d2d04-262">Так как микрослужбы распределены и не имеют общих хранилищ данных, события предметной области предоставляют микрослужбам способ координации друг с другом.</span><span class="sxs-lookup"><span data-stu-id="d2d04-262">Because microservices are distributed and don't share data stores, domain events provide a way for microservices to coordinate with each other.</span></span> <span data-ttu-id="d2d04-263">В главе об [обмене данными между службами](./interservice-communication.md) более подробно рассматривается асинхронный обмен сообщениями.</span><span class="sxs-lookup"><span data-stu-id="d2d04-263">The chapter [Interservice communication](./interservice-communication.md) discusses asynchronous messaging in more detail.</span></span>

<span data-ttu-id="d2d04-264">Есть также несколько других шаблонов DDD, которые не перечислены здесь, включая фабрики, репозитории и модули.</span><span class="sxs-lookup"><span data-stu-id="d2d04-264">There are a few other DDD patterns not listed here, including factories, repositories, and modules.</span></span> <span data-ttu-id="d2d04-265">Эти шаблоны могут быть полезны при реализации микрослужбы, однако они менее актуальны при разработке границ между микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="d2d04-265">These can be useful patterns for when you are implementing a microservice, but they are less relevant when designing the boundaries between microservice.</span></span>

## <a name="drone-delivery-applying-the-patterns"></a><span data-ttu-id="d2d04-266">Доставка с помощью дронов. Применение шаблонов</span><span class="sxs-lookup"><span data-stu-id="d2d04-266">Drone delivery: Applying the patterns</span></span>

<span data-ttu-id="d2d04-267">Мы начнем со сценариев, которые должен обрабатывать ограниченный контекст доставки.</span><span class="sxs-lookup"><span data-stu-id="d2d04-267">We start with the scenarios that the Shipping bounded context must handle.</span></span>

- <span data-ttu-id="d2d04-268">Клиент может запросить дрон, чтобы быстро принять товар у компании, зарегистрированной в службе доставки с помощью дронов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-268">A customer can request a drone to pick up goods from a business that is registered with the drone delivery service.</span></span>
- <span data-ttu-id="d2d04-269">Отправитель создает тег (штрихкод или RFID) для размещения на грузе.</span><span class="sxs-lookup"><span data-stu-id="d2d04-269">The sender generates a tag (barcode or RFID) to put on the package.</span></span>
- <span data-ttu-id="d2d04-270">Дрон примет и доставит груз из исходного расположения в целевое.</span><span class="sxs-lookup"><span data-stu-id="d2d04-270">A drone will pick up and deliver a package from the source location to the destination location.</span></span>
- <span data-ttu-id="d2d04-271">Когда клиент планирует доставку, система выдает предполагаемое время приема и доставки на основе информации о маршруте, погодных условиях и исторических данных.</span><span class="sxs-lookup"><span data-stu-id="d2d04-271">When a customer schedules a delivery, the system provides an ETA based on route information, weather conditions, and historical data.</span></span>
- <span data-ttu-id="d2d04-272">Когда дрон в пути, пользователь может отслеживать его расположение и последнее ETA.</span><span class="sxs-lookup"><span data-stu-id="d2d04-272">When the drone is in flight, a user can track the current location and the latest ETA.</span></span>
- <span data-ttu-id="d2d04-273">Пока дрон не получил груз, клиент может отменить доставку.</span><span class="sxs-lookup"><span data-stu-id="d2d04-273">Until a drone has picked up the package, the customer can cancel a delivery.</span></span>
- <span data-ttu-id="d2d04-274">Клиент уведомляется о завершении доставки.</span><span class="sxs-lookup"><span data-stu-id="d2d04-274">The customer is notified when the delivery is completed.</span></span>
- <span data-ttu-id="d2d04-275">Отправитель может запросить подтверждение от клиента в форме подписи или отпечатка пальца.</span><span class="sxs-lookup"><span data-stu-id="d2d04-275">The sender can request delivery confirmation from the customer, in the form of a signature or finger print.</span></span>
- <span data-ttu-id="d2d04-276">Пользователи могут просмотреть историю завершенной доставки.</span><span class="sxs-lookup"><span data-stu-id="d2d04-276">Users can look up the history of a completed delivery.</span></span>

<span data-ttu-id="d2d04-277">В этих сценариях команды разработки определили следующие **сущности**:</span><span class="sxs-lookup"><span data-stu-id="d2d04-277">From these scenarios, the development team identified the following **entities**.</span></span>

- <span data-ttu-id="d2d04-278">доставка;</span><span class="sxs-lookup"><span data-stu-id="d2d04-278">Delivery</span></span>
- <span data-ttu-id="d2d04-279">Package</span><span class="sxs-lookup"><span data-stu-id="d2d04-279">Package</span></span>
- <span data-ttu-id="d2d04-280">дрон;</span><span class="sxs-lookup"><span data-stu-id="d2d04-280">Drone</span></span>
- <span data-ttu-id="d2d04-281">Учетная запись.</span><span class="sxs-lookup"><span data-stu-id="d2d04-281">Account</span></span>
- <span data-ttu-id="d2d04-282">Подтверждение</span><span class="sxs-lookup"><span data-stu-id="d2d04-282">Confirmation</span></span>
- <span data-ttu-id="d2d04-283">Уведомление</span><span class="sxs-lookup"><span data-stu-id="d2d04-283">Notification</span></span>
- <span data-ttu-id="d2d04-284">Тег</span><span class="sxs-lookup"><span data-stu-id="d2d04-284">Tag</span></span>

<span data-ttu-id="d2d04-285">Первые четыре сущности (доставка, груз, дрон и учетная запись) являются **статистическими выражениями**, которые представляют границы согласованности транзакций.</span><span class="sxs-lookup"><span data-stu-id="d2d04-285">The first four, Delivery, Package, Drone, and Account, are all **aggregates** that represent transactional consistency boundaries.</span></span> <span data-ttu-id="d2d04-286">Подтверждения и уведомления являются дочерними сущностями доставки, а теги — дочерними сущностями грузов.</span><span class="sxs-lookup"><span data-stu-id="d2d04-286">Confirmations and Notifications are child entities of Deliveries, and Tags are child entities of Packages.</span></span>

<span data-ttu-id="d2d04-287">**Объекты-значения** в этом проекте включают расположение, ETA, вес и размер груза.</span><span class="sxs-lookup"><span data-stu-id="d2d04-287">The **value objects** in this design include Location, ETA, PackageWeight, and PackageSize.</span></span>

<span data-ttu-id="d2d04-288">Для демонстрации ниже приведена схема UML статистического выражения доставки.</span><span class="sxs-lookup"><span data-stu-id="d2d04-288">To illustrate, here is a UML diagram of the Delivery aggregate.</span></span> <span data-ttu-id="d2d04-289">Обратите внимание, что оно содержит ссылки на другие статистические выражения, включая учетную запись, груз и дрон.</span><span class="sxs-lookup"><span data-stu-id="d2d04-289">Notice that it holds references to other aggregates, including Account, Package, and Drone.</span></span>

![Схема UML статистического выражения доставки](./images/delivery-entity.png)

<span data-ttu-id="d2d04-291">Есть два события предметной области:</span><span class="sxs-lookup"><span data-stu-id="d2d04-291">There are two domain events:</span></span>

- <span data-ttu-id="d2d04-292">когда дрон выполняет доставку, одноименная сущность отправляет события DroneStatus (состояние дрона), которые описывают его расположение и состояние (в пути, приземлился);</span><span class="sxs-lookup"><span data-stu-id="d2d04-292">While a drone is in flight, the Drone entity sends DroneStatus events that describe the drone's location and status (in-flight, landed).</span></span>

- <span data-ttu-id="d2d04-293">сущность доставки отправляет события DeliveryTracking при каждом изменении этапа доставки.</span><span class="sxs-lookup"><span data-stu-id="d2d04-293">The Delivery entity sends DeliveryTracking events whenever the stage of a delivery changes.</span></span> <span data-ttu-id="d2d04-294">К ним относятся DeliveryCreated (доставка создана), DeliveryRescheduled (доставка перепланирована), DeliveryHeadedToDropoff (груз направляется в конечный пункт) и DeliveryCompleted (доставка завершена).</span><span class="sxs-lookup"><span data-stu-id="d2d04-294">These include DeliveryCreated, DeliveryRescheduled, DeliveryHeadedToDropoff, and DeliveryCompleted.</span></span>

<span data-ttu-id="d2d04-295">Обратите внимание, что эти события описывают вещи, которые важны в модели предметной области.</span><span class="sxs-lookup"><span data-stu-id="d2d04-295">Notice that these events describe things that are meaningful within the domain model.</span></span> <span data-ttu-id="d2d04-296">Они описывают что-то о предметной области и не привязаны к конкретной конструкции языка программирования.</span><span class="sxs-lookup"><span data-stu-id="d2d04-296">They describe something about the domain, and aren't tied to a particular programming language construct.</span></span>

<span data-ttu-id="d2d04-297">Команда разработчиков определила еще одну область функций, которая не соответствует полностью ни одной из уже описанных сущностей.</span><span class="sxs-lookup"><span data-stu-id="d2d04-297">The development team identified one more area of functionality, which doesn't fit neatly into any of the entities described so far.</span></span> <span data-ttu-id="d2d04-298">Некоторая часть системы должна координировать все шаги, связанные с планированием или обновлением доставки.</span><span class="sxs-lookup"><span data-stu-id="d2d04-298">Some part of the system must coordinate all of the steps involved in scheduling or updating a delivery.</span></span> <span data-ttu-id="d2d04-299">Таким образом, команда разработчиков добавляет две **службы предметных областей** в проект: *планировщик*, управляющий действиями, и *контролер*, отслеживающий состояние каждого шага, чтобы определить, есть ли шаги, которые завершились со сбоем и в каких истекло время ожидания. Это разновидность [шаблона "планировщик, агент, контролер"](../patterns/scheduler-agent-supervisor.md).</span><span class="sxs-lookup"><span data-stu-id="d2d04-299">Therefore, the development team added two **domain services** to the design: a *Scheduler* that coordinates the steps, and a *Supervisor* that monitors the status of each step, in order to detect whether any steps have failed or timed out. This is a variation of the [Scheduler Agent Supervisor pattern](../patterns/scheduler-agent-supervisor.md).</span></span>

![Схема пересмотренный модели предметной области](./images/drone-ddd.png)

> [!div class="nextstepaction"]
> [<span data-ttu-id="d2d04-301">Определение границ микрослужбы</span><span class="sxs-lookup"><span data-stu-id="d2d04-301">Identifying microservice boundaries</span></span>](./microservice-boundaries.md)
