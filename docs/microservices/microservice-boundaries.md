---
title: "Определение границ микрослужбы"
description: "Определение границ микрослужбы"
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: e4f11da9f970724c55ad99824f808a10c4558971
ms.sourcegitcommit: 744ad1381e01bbda6a1a7eff4b25e1a337385553
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2018
---
# <a name="designing-microservices-identifying-microservice-boundaries"></a><span data-ttu-id="017ec-103">Проектирование микрослужб: определение границ микрослужбы</span><span class="sxs-lookup"><span data-stu-id="017ec-103">Designing microservices: Identifying microservice boundaries</span></span>

<span data-ttu-id="017ec-104">Какой размер является подходящим для микрослужбы?</span><span class="sxs-lookup"><span data-stu-id="017ec-104">What is the right size for a microservice?</span></span> <span data-ttu-id="017ec-105">Вам часто приходилось слышать ответ наподобие "не слишком большой и не слишком маленький". Это, конечно, верно, но как реализовать это на практике?</span><span class="sxs-lookup"><span data-stu-id="017ec-105">You often hear something to the effect of, "not too big and not too small" &mdash; and while that's certainly correct, it's not very helpful in practice.</span></span> <span data-ttu-id="017ec-106">Если вы начнете с тщательно разработанной модели предметной области, то так гораздо легче рассуждать о микрослужбах.</span><span class="sxs-lookup"><span data-stu-id="017ec-106">But if you start from a carefully designed domain model, it's much easier to reason about microservices.</span></span>

![](./images/bounded-contexts.png)

## <a name="from-domain-model-to-microservices"></a><span data-ttu-id="017ec-107">От модели предметной области к микрослужбам</span><span class="sxs-lookup"><span data-stu-id="017ec-107">From domain model to microservices</span></span>

<span data-ttu-id="017ec-108">В [предыдущей части](./domain-analysis.md) мы определили набор ограниченных контекстов для приложения доставки с помощью дронов.</span><span class="sxs-lookup"><span data-stu-id="017ec-108">In the [previous chapter](./domain-analysis.md), we defined a set of bounded contexts for the Drone Delivery application.</span></span> <span data-ttu-id="017ec-109">Затем мы подробнее рассмотрели один из ограниченных контекстов, а именно ограниченный контекст доставки, и определили для него набор сущностей, статистических выражений и служб предметных областей.</span><span class="sxs-lookup"><span data-stu-id="017ec-109">Then we looked more closely at one of these bounded contexts, the Shipping bounded context, and identified a set of entities, aggregates, and domain services for that bounded context.</span></span>

<span data-ttu-id="017ec-110">Теперь вы готовы перейти от модели предметной области к разработке приложения.</span><span class="sxs-lookup"><span data-stu-id="017ec-110">Now we're ready to go from domain model to application design.</span></span> <span data-ttu-id="017ec-111">Ниже представлен подход, который можно использовать для определения микрослужб на основе модели предметной области.</span><span class="sxs-lookup"><span data-stu-id="017ec-111">Here's an approach that you can use to derive microservices from the domain model.</span></span>

1. <span data-ttu-id="017ec-112">Начните с ограниченного контекста.</span><span class="sxs-lookup"><span data-stu-id="017ec-112">Start with a bounded context.</span></span> <span data-ttu-id="017ec-113">В целом функциональность в микрослужбе не должна охватывать более одного ограниченного контекста.</span><span class="sxs-lookup"><span data-stu-id="017ec-113">In general, the functionality in a microservice should not span more than one bounded context.</span></span> <span data-ttu-id="017ec-114">Согласно определению ограниченный контекст помечает границу конкретной модели предметной области.</span><span class="sxs-lookup"><span data-stu-id="017ec-114">By definition, a bounded context marks the boundary of a particular domain model.</span></span> <span data-ttu-id="017ec-115">Если микрослужба охватывает разные модели предметной области, вам нужно вернуться назад и уточнить анализ предметной области.</span><span class="sxs-lookup"><span data-stu-id="017ec-115">If you find that a microservice mixes different domain models together, that's a sign that you may need to go back and refine your domain analysis.</span></span>

2. <span data-ttu-id="017ec-116">Затем проанализируйте статистические выражения в модели предметной области.</span><span class="sxs-lookup"><span data-stu-id="017ec-116">Next, look at the aggregates in your domain model.</span></span> <span data-ttu-id="017ec-117">Статистические выражения часто являются хорошими кандидатами для микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="017ec-117">Aggregates are often good candidates for microservices.</span></span> <span data-ttu-id="017ec-118">Хорошо спроектированные статистические выражения демонстрируют характеристики хорошо спроектированной микрослужбы, например:</span><span class="sxs-lookup"><span data-stu-id="017ec-118">A well-designed aggregate exhibits many of the characteristics of a well-designed microservice, such as:</span></span>

    - <span data-ttu-id="017ec-119">Статистические выражения скорее происходят из бизнес-требований, нежели из технических соображений, таких как доступ к данным или обмен сообщениями.</span><span class="sxs-lookup"><span data-stu-id="017ec-119">An aggregates is derived from business requirements, rather than technical concerns such as data access or messaging.</span></span>  
    - <span data-ttu-id="017ec-120">Статистические выражения должны иметь высокую функциональную слаженность.</span><span class="sxs-lookup"><span data-stu-id="017ec-120">An aggregate should have high functional cohesion.</span></span>
    - <span data-ttu-id="017ec-121">Статистическое выражение является границей сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="017ec-121">An aggregate is a boundary of persistence.</span></span>
    - <span data-ttu-id="017ec-122">Статистические выражения должны быть слабо связаны.</span><span class="sxs-lookup"><span data-stu-id="017ec-122">Aggregates should be loosely coupled.</span></span> 
    
3. <span data-ttu-id="017ec-123">Службы предметных областей также являются хорошими кандидатами для микрослужб.</span><span class="sxs-lookup"><span data-stu-id="017ec-123">Domain services are also good candidates for microservices.</span></span> <span data-ttu-id="017ec-124">Это операции без учета состояния в нескольких статистических выражениях.</span><span class="sxs-lookup"><span data-stu-id="017ec-124">Domain services are stateless operations across multiple aggregates.</span></span> <span data-ttu-id="017ec-125">Типичным примером является рабочий процесс, который охватывает несколько микрослужб.</span><span class="sxs-lookup"><span data-stu-id="017ec-125">A typical example is a workflow that involves several microservices.</span></span> <span data-ttu-id="017ec-126">Такой пример реализован в приложении доставки с помощью дронов.</span><span class="sxs-lookup"><span data-stu-id="017ec-126">We'll see an example of this in the Drone Delivery application.</span></span>

4. <span data-ttu-id="017ec-127">И наконец, рассмотрим требования, не касающиеся функциональности.</span><span class="sxs-lookup"><span data-stu-id="017ec-127">Finally, consider non-functional requirements.</span></span> <span data-ttu-id="017ec-128">Рассмотрите такие факторы, как размер команды, тип данных, технологии, требования к масштабируемости, доступности и безопасности.</span><span class="sxs-lookup"><span data-stu-id="017ec-128">Look at factors such as team size, data types, technologies, scalability requirements, availability requirements, and security requirements.</span></span> <span data-ttu-id="017ec-129">Возможно, из-за них вам придется разделить микрослужбу на две или более меньшие службы или сделать противоположное (объединить несколько микрослужб в одну).</span><span class="sxs-lookup"><span data-stu-id="017ec-129">These factors may lead you to further decompose a microservice into two or more smaller services, or do the opposite and combine several microservices into one.</span></span> 

<span data-ttu-id="017ec-130">Когда вы определите микрослужбы в приложении, поверьте структуру на соответствие следующим условиям:</span><span class="sxs-lookup"><span data-stu-id="017ec-130">After you identify the microservices in your application, validate your design against the following criteria:</span></span>

- <span data-ttu-id="017ec-131">Каждая из служб отвечает за одну функциональность.</span><span class="sxs-lookup"><span data-stu-id="017ec-131">Each service has a single responsibility.</span></span>
- <span data-ttu-id="017ec-132">Между службами отсутствуют частые вызовы.</span><span class="sxs-lookup"><span data-stu-id="017ec-132">There are no chatty calls between services.</span></span> <span data-ttu-id="017ec-133">Если после разделения функциональности на две службы они станут отправлять слишком много вызовов, это может быть признаком того, что функции принадлежат к одной службе.</span><span class="sxs-lookup"><span data-stu-id="017ec-133">If splitting functionality into two services causes them to be overly chatty, it may be a symptom that these functions belong in the same service.</span></span>
- <span data-ttu-id="017ec-134">Каждая из служб достаточно небольшая, так что ее может независимо создать команда из нескольких человек.</span><span class="sxs-lookup"><span data-stu-id="017ec-134">Each service is small enough that it can be built by a small team working independently.</span></span>
- <span data-ttu-id="017ec-135">Нет никаких взаимных зависимостей, из-за которых необходимо развертывать две или больше микрослужб в связке.</span><span class="sxs-lookup"><span data-stu-id="017ec-135">There are no inter-dependencies that will require two or more services to be deployed in lock-step.</span></span> <span data-ttu-id="017ec-136">Всегда должна быть возможность развернуть службу без повторного развертывания других служб.</span><span class="sxs-lookup"><span data-stu-id="017ec-136">It should always be possible to deploy a service without redeploying any other services.</span></span>
- <span data-ttu-id="017ec-137">Службы не имеют тесной связи и могут развиваться независимо.</span><span class="sxs-lookup"><span data-stu-id="017ec-137">Services are not tightly coupled, and can evolve independently.</span></span>
- <span data-ttu-id="017ec-138">Границы вашей службы не будут создавать проблем с согласованностью или целостностью данных.</span><span class="sxs-lookup"><span data-stu-id="017ec-138">Your service boundaries will not create problems with data consistency or integrity.</span></span> <span data-ttu-id="017ec-139">Иногда важно поддерживать согласованность данных, разместив функциональность в одной микрослужбе.</span><span class="sxs-lookup"><span data-stu-id="017ec-139">Sometimes it's important to maintain data consistency by putting functionality into a single microservice.</span></span> <span data-ttu-id="017ec-140">Тем не менее, подумайте, действительно ли вам нужна высокая согласованность.</span><span class="sxs-lookup"><span data-stu-id="017ec-140">That said, consider whether you really need strong consistency.</span></span> <span data-ttu-id="017ec-141">Существуют стратегии для обеспечения итоговой согласованности в распределенной системе, а преимущества декомпозиции служб часто перевешивают проблемы поддержки такой согласованности.</span><span class="sxs-lookup"><span data-stu-id="017ec-141">There are strategies for addressing eventual consistency in a distributed system, and the benefits of decomposing services often outweigh the challenges of managing eventual consistency.</span></span>

<span data-ttu-id="017ec-142">Прежде всего, важно быть прагматичным и помнить, что предметно-ориентированное проектирование является итеративным процессом.</span><span class="sxs-lookup"><span data-stu-id="017ec-142">Above all, it's important to be pragmatic, and remember that domain-driven design is an iterative process.</span></span> <span data-ttu-id="017ec-143">В случае сомнений начинайте с недетализированных микрослужб.</span><span class="sxs-lookup"><span data-stu-id="017ec-143">When in doubt, start with more coarse-grained microservices.</span></span> <span data-ttu-id="017ec-144">Разделить микрослужбу на две меньшие службы проще, чем выполнить рефакторинг функциональности между несколькими существующими микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="017ec-144">Splitting a microservice into two smaller services is easier than refactoring functionality across several existing microservices.</span></span>
  
## <a name="drone-delivery-defining-the-microservices"></a><span data-ttu-id="017ec-145">Доставка с помощью дронов: определение микрослужб</span><span class="sxs-lookup"><span data-stu-id="017ec-145">Drone Delivery: Defining the microservices</span></span>

<span data-ttu-id="017ec-146">Напомним, что команда разработчиков определила четыре статистических выражения &mdash; "Доставка", "Посылка", "Дрон" и "Учетная запись" &mdash; и две службы предметных областей "Планировщик" и "Контролер".</span><span class="sxs-lookup"><span data-stu-id="017ec-146">Recall that the development team had identified the four aggregates &mdash; Delivery, Package, Drone, and Account &mdash; and two domain services, Scheduler and Supervisor.</span></span> 

<span data-ttu-id="017ec-147">"Доставка" и "Посылка" являются очевидными кандидатами для микрослужб.</span><span class="sxs-lookup"><span data-stu-id="017ec-147">Delivery and Package are obvious candidates for microservices.</span></span> <span data-ttu-id="017ec-148">"Планировщик" и "Контролер" координируют действия, выполняемые другими микрослужбами, поэтому имеет смысл внедрить эти службы предметных областей в качестве микрослужб.</span><span class="sxs-lookup"><span data-stu-id="017ec-148">The Scheduler and Supervisor coordinate the activities performed by other microservices, so it makes sense to implement these domain services as microservices.</span></span>  

<span data-ttu-id="017ec-149">"Дрон" и "Учетная запись" интересны тем, что они принадлежат к другим ограниченным контекстам.</span><span class="sxs-lookup"><span data-stu-id="017ec-149">Drone and Account are interesting because they belong to other bounded contexts.</span></span> <span data-ttu-id="017ec-150">Один из вариантов заключается в том, чтобы "Планировщик" напрямую вызывал ограниченные контексты "Дрон" и "Учетная запись".</span><span class="sxs-lookup"><span data-stu-id="017ec-150">One option is for the Scheduler to call the Drone and Account bounded contexts directly.</span></span> <span data-ttu-id="017ec-151">Также можно создать микрослужбы"Дрон" и "Учетная запись" внутри ограниченного контекста доставки.</span><span class="sxs-lookup"><span data-stu-id="017ec-151">Another option is to create Drone and Account microservices inside the Shipping bounded context.</span></span> <span data-ttu-id="017ec-152">Эти микрослужбы будут посредниками между ограниченными контекстами, предоставляя API или схемы данных, которые более подходят для контекста доставки.</span><span class="sxs-lookup"><span data-stu-id="017ec-152">These microservices would mediate between the bounded contexts, by exposing APIs or data schemas that are more suited to the Shipping context.</span></span>

<span data-ttu-id="017ec-153">Подробности об ограниченных контекстах "Дрон" и "Учетная запись" выходят за рамки этого руководства, поэтому мы создали для них макеты служб в нашей эталонной реализации.</span><span class="sxs-lookup"><span data-stu-id="017ec-153">The details of the Drone and Account bounded contexts are beyond the scope of this guidance, so we created mock services for them in our reference implementation.</span></span> <span data-ttu-id="017ec-154">Но в этой ситуации необходимо учитывать некоторые факторы:</span><span class="sxs-lookup"><span data-stu-id="017ec-154">But here are some factors to consider in this situation:</span></span>

- <span data-ttu-id="017ec-155">Какова нагрузка на сеть для прямого вызова другого ограниченного контекста?</span><span class="sxs-lookup"><span data-stu-id="017ec-155">What is the network overhead of calling directly into the other bounded context?</span></span> 

- <span data-ttu-id="017ec-156">Подходит ли схема данных другого ограниченного контекста для этого контекста или лучше иметь схему, предназначенную для этого ограниченного контекста?</span><span class="sxs-lookup"><span data-stu-id="017ec-156">Is the data schema for the other bounded context suitable for this context, or is it better to have a schema that's tailored to this bounded context?</span></span> 

- <span data-ttu-id="017ec-157">Является ли другой ограниченный контекст устаревшей системой?</span><span class="sxs-lookup"><span data-stu-id="017ec-157">Is the other bounded context a legacy system?</span></span> <span data-ttu-id="017ec-158">Если так, то можно создать службу, которая действует как [уровень защиты от повреждений](../patterns/anti-corruption-layer.md) для преобразования между старой системой и современным приложением.</span><span class="sxs-lookup"><span data-stu-id="017ec-158">If so, you might create a service that acts as an [anti-corruption layer](../patterns/anti-corruption-layer.md) to translate between the legacy system and the modern application.</span></span> 

- <span data-ttu-id="017ec-159">Какова структура команды?</span><span class="sxs-lookup"><span data-stu-id="017ec-159">What is the team structure?</span></span> <span data-ttu-id="017ec-160">Легко ли взаимодействовать с командой, ответственной за другой ограниченный контекст?</span><span class="sxs-lookup"><span data-stu-id="017ec-160">Is it easy to communicate with the team that's responsible for the other bounded context?</span></span> <span data-ttu-id="017ec-161">Если нет, тогда создайте службу, которая будет посредником между двумя контекстами, что может помочь снизить стоимость взаимодействия между командами.</span><span class="sxs-lookup"><span data-stu-id="017ec-161">If not, creating a service that mediates between the two contexts can help to mitigate the cost of cross-team communication.</span></span>

<span data-ttu-id="017ec-162">До сих пор мы не рассматривали каких-либо нефункциональных требований.</span><span class="sxs-lookup"><span data-stu-id="017ec-162">So far, we haven't considered any non-functional requirements.</span></span> <span data-ttu-id="017ec-163">Думая о требованиях к пропускной способности приложений, команда разработчиков решила создать отдельную микрослужбу приема, которая отвечает за прием клиентских запросов.</span><span class="sxs-lookup"><span data-stu-id="017ec-163">Thinking about the application's throughput requirements, the development team decided to create a separate Ingestion microservice that is responsible for ingesting client requests.</span></span> <span data-ttu-id="017ec-164">Эта микрослужба будет выполнять [выравнивание нагрузки](../patterns/queue-based-load-leveling.md), помещая входящие запросы в буфер для обработки.</span><span class="sxs-lookup"><span data-stu-id="017ec-164">This microservice will implement [load leveling](../patterns/queue-based-load-leveling.md) by putting incoming requests into a buffer for processing.</span></span> <span data-ttu-id="017ec-165">Планировщик будет считывать запросы из буфера и выполнять рабочий процесс.</span><span class="sxs-lookup"><span data-stu-id="017ec-165">The Scheduler will read the requests from the buffer and execute the workflow.</span></span> 

<span data-ttu-id="017ec-166">Чтобы удовлетворить нефункциональные требования, команде пришлось создать еще одну дополнительную службу.</span><span class="sxs-lookup"><span data-stu-id="017ec-166">Non-functional requirements led the team to create one additional service.</span></span> <span data-ttu-id="017ec-167">До сих пор все службы касались процесса планирования и доставки посылок в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="017ec-167">All of the services so far have been about the process of scheduling and delivering packages in real time.</span></span> <span data-ttu-id="017ec-168">Но для анализа данных системе также необходимо сохранять историю каждой доставки в объект для долговременного хранения.</span><span class="sxs-lookup"><span data-stu-id="017ec-168">But the system also needs to store the history of every delivery in long-term storage for data analysis.</span></span> <span data-ttu-id="017ec-169">Команда возложила ответственность за это на службу доставки.</span><span class="sxs-lookup"><span data-stu-id="017ec-169">The team considered making this the responsibility of the Delivery service.</span></span> <span data-ttu-id="017ec-170">Тем не менее, требования к хранилищу данных совершенно различны для исторического анализа и текущих операций (см. [рекомендации в отношении данных](./data-considerations.md)).</span><span class="sxs-lookup"><span data-stu-id="017ec-170">However, the data storage requirements are quite different for historical analysis versus in-flight operations (see [Data considerations](./data-considerations.md)).</span></span> <span data-ttu-id="017ec-171">Поэтому команда решила создать отдельную службу истории доставки, которая будет прослушивать события для отслеживания доставки из службы доставки и записывать их в долговременное хранилище.</span><span class="sxs-lookup"><span data-stu-id="017ec-171">Therefore, the team decided to create a separate Delivery History service, which will listen for DeliveryTracking events from the Delivery service and write the events into long-term storage.</span></span>

<span data-ttu-id="017ec-172">На следующей схеме показана структура на этом конкретном этапе:</span><span class="sxs-lookup"><span data-stu-id="017ec-172">The following diagram shows the design at this point:</span></span>
 
![](./images/microservices.png)

## <a name="choosing-a-compute-option"></a><span data-ttu-id="017ec-173">Выбор варианта вычисления</span><span class="sxs-lookup"><span data-stu-id="017ec-173">Choosing a compute option</span></span>

<span data-ttu-id="017ec-174">Термин *вычислительная служба* означает модель размещения вычислительных ресурсов, которые используются для выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="017ec-174">The term *compute* refers to the hosting model for the computing resources that your application runs on.</span></span> <span data-ttu-id="017ec-175">Для архитектуры микрослужб особенно популярными являются два подхода:</span><span class="sxs-lookup"><span data-stu-id="017ec-175">For a microservices architecture, two approaches are especially popular:</span></span>

- <span data-ttu-id="017ec-176">Служба оркестратора, которая управляет службами, выполняющимися на выделенных узлах (виртуальных машинах).</span><span class="sxs-lookup"><span data-stu-id="017ec-176">A service orchestrator that manages services running on dedicated nodes (VMs).</span></span>
- <span data-ttu-id="017ec-177">Бессерверная архитектура, которая использует функции как услугу (FaaS).</span><span class="sxs-lookup"><span data-stu-id="017ec-177">A serverless architecture using functions as a service (FaaS).</span></span> 

<span data-ttu-id="017ec-178">Хотя это не единственные варианты, они оба являются проверенными подходами к созданию микрослужб.</span><span class="sxs-lookup"><span data-stu-id="017ec-178">While these aren't the only options, they are both proven approaches to building microservices.</span></span> <span data-ttu-id="017ec-179">В приложение могут быть включены оба эти подхода.</span><span class="sxs-lookup"><span data-stu-id="017ec-179">An application might include both approaches.</span></span>

### <a name="service-orchestrators"></a><span data-ttu-id="017ec-180">Оркестраторы служб</span><span class="sxs-lookup"><span data-stu-id="017ec-180">Service orchestrators</span></span>

<span data-ttu-id="017ec-181">Оркестратор выполняет задачи, связанные с развертыванием набора служб и управлением ним.</span><span class="sxs-lookup"><span data-stu-id="017ec-181">An orchestrator handles tasks related to deploying and managing a set of services.</span></span> <span data-ttu-id="017ec-182">К этим задачам относятся размещение служб на узлах, мониторинг состояния работоспособности служб, перезапуск неработоспособных служб, балансировка нагрузки сетевого трафика между экземплярами службы, обнаружение служб, масштабирование количества экземпляров службы и применение обновления конфигурации.</span><span class="sxs-lookup"><span data-stu-id="017ec-182">These tasks include placing services on nodes, monitoring the health of services, restarting unhealthy services, load balancing network traffic across service instances, service discovery, scaling the number of instances of a service, and applying configuration updates.</span></span> <span data-ttu-id="017ec-183">Популярными оркестрами являются Kubernetes, DC/OS, Docker Swarm и Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="017ec-183">Popular orchestrators include Kubernetes, DC/OS, Docker Swarm, and Service Fabric.</span></span> 

- <span data-ttu-id="017ec-184">[Служба контейнеров Azure](/azure/container-service/) (ACS) — это служба Azure, которая позволяет развертывать готовые для рабочей среды кластеры Kubernetes, DC/OS или Docker Swarm.</span><span class="sxs-lookup"><span data-stu-id="017ec-184">[Azure Container Service](/azure/container-service/) (ACS) is an Azure service that lets you deploy a production-ready Kubernetes, DC/OS, or Docker Swarm cluster.</span></span>

- <span data-ttu-id="017ec-185">[Служба контейнеров Azure](/azure/aks/) (AKS) является управляемой службой Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="017ec-185">[AKS (Azure Container Service)](/azure/aks/) is a managed Kubernetes service.</span></span> <span data-ttu-id="017ec-186">AKS реализует среду Kubernetes и предоставляет конечные точки API Kubernetes, а также содержит и администрирует плоскость управления Kubernetes, выполняя автоматические обновления, автоматическое исправление, автомасштабирование и другие задачи управления.</span><span class="sxs-lookup"><span data-stu-id="017ec-186">AKS provisions Kubernetes and exposes the Kubernetes API endpoints, but hosts and manages the Kubernetes control plane, performing automated upgrades, automated patching, autoscaling, and other management tasks.</span></span> <span data-ttu-id="017ec-187">Вы можете думать об AKS как о "программных интерфейсах API Kubernetes как услуге".</span><span class="sxs-lookup"><span data-stu-id="017ec-187">You can think of AKS as being "Kubernetes APIs as a service."</span></span> <span data-ttu-id="017ec-188">В момент написания этой статьи доступна предварительная версия AKS.</span><span class="sxs-lookup"><span data-stu-id="017ec-188">At the time of writing, AKS is still in preview.</span></span> <span data-ttu-id="017ec-189">Тем не менее, ожидается, что AKS станет предпочтительным вариантом для выполнения Kubernetes в Azure.</span><span class="sxs-lookup"><span data-stu-id="017ec-189">However, it's expected that AKS will become the preferred way to run Kubernetes in Azure.</span></span> 

- <span data-ttu-id="017ec-190">[Service Fabric](/azure/service-fabric/) — это платформа распределенных систем для упаковки и развертывания микрослужб, а также управления ими.</span><span class="sxs-lookup"><span data-stu-id="017ec-190">[Service Fabric](/azure/service-fabric/) is a distributed systems platform for packaging, deploying, and managing microservices.</span></span> <span data-ttu-id="017ec-191">Микрослужбы могут быть развернуты в Service Fabric в виде контейнеров, исполняемых двоичных файлов или [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction).</span><span class="sxs-lookup"><span data-stu-id="017ec-191">Microservices can be deployed to Service Fabric as containers, as binary executables, or as [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction).</span></span> <span data-ttu-id="017ec-192">Используя модель программирования Reliable Services, службы могут напрямую использовать API программирования Service Fabric, чтобы отправлять запросы к системе, формировать отчеты о состоянии, получать уведомления об изменениях конфигурации и кода, а также обнаруживать другие службы.</span><span class="sxs-lookup"><span data-stu-id="017ec-192">Using the Reliable Services programming model, services can directly use Service Fabric programming APIs to query the system, report health, receive notifications about configuration and code changes, and discover other services.</span></span> <span data-ttu-id="017ec-193">Ключевое отличие Service Fabric — активная ориентация на создание служб с отслеживанием состояния с использованием [Reliable Collections](/azure/service-fabric/service-fabric-reliable-services-reliable-collections).</span><span class="sxs-lookup"><span data-stu-id="017ec-193">A key differentiation with Service Fabric is its strong focus on building stateful services using [Reliable Collections](/azure/service-fabric/service-fabric-reliable-services-reliable-collections).</span></span>

### <a name="containers"></a><span data-ttu-id="017ec-194">Контейнеры</span><span class="sxs-lookup"><span data-stu-id="017ec-194">Containers</span></span>

<span data-ttu-id="017ec-195">Иногда о контейнерах и микрослужбах говорят так, как будто это одно и то же.</span><span class="sxs-lookup"><span data-stu-id="017ec-195">Sometimes people talk about containers and microservices as if they were the same thing.</span></span> <span data-ttu-id="017ec-196">Это в корне неверно. Для создания микрослужб не нужны контейнеры. Тем не менее, контейнеры имеют некоторые преимущества, которые особенно актуальны для микрослужб, в частности:</span><span class="sxs-lookup"><span data-stu-id="017ec-196">While that's not true &mdash; you don't need containers to build microservices &mdash; containers do have some benefits that are particularly relevant to microservices, such as:</span></span>

- <span data-ttu-id="017ec-197">**Мобильность.**</span><span class="sxs-lookup"><span data-stu-id="017ec-197">**Portability**.</span></span> <span data-ttu-id="017ec-198">Образ контейнера представляет собой изолированный пакет, для запуска которого не нужно устанавливать библиотеки или другие зависимости.</span><span class="sxs-lookup"><span data-stu-id="017ec-198">A container image is a standalone package that runs without needing to install libraries or other dependencies.</span></span> <span data-ttu-id="017ec-199">Благодаря этому их легче развертывать.</span><span class="sxs-lookup"><span data-stu-id="017ec-199">That makes them easy to deploy.</span></span> <span data-ttu-id="017ec-200">Контейнеры можно быстро запустить и остановить, что позволяет развернуть новые экземпляры, чтобы обрабатывать большую нагрузку или восстанавливаться после сбоев узлов.</span><span class="sxs-lookup"><span data-stu-id="017ec-200">Containers can be started and stopped quickly, so you can spin up new instances to handle more load or to recover from node failures.</span></span> 

- <span data-ttu-id="017ec-201">**Плотность**.</span><span class="sxs-lookup"><span data-stu-id="017ec-201">**Density**.</span></span> <span data-ttu-id="017ec-202">По сравнению с виртуальными машинами, контейнеры имеют меньшую плотность, так как они совместно используют ресурсы ОС.</span><span class="sxs-lookup"><span data-stu-id="017ec-202">Containers are lightweight compared with running a virtual machine, because they share OS resources.</span></span> <span data-ttu-id="017ec-203">Благодаря этому можно упаковать несколько контейнеров в единый узел, что особенно полезно, когда приложение состоит из множества небольших служб.</span><span class="sxs-lookup"><span data-stu-id="017ec-203">That makes it possible to pack multiple containers onto a single node, which is especially useful when the application consists of many small services.</span></span>

- <span data-ttu-id="017ec-204">**Изоляция ресурсов**.</span><span class="sxs-lookup"><span data-stu-id="017ec-204">**Resource isolation**.</span></span> <span data-ttu-id="017ec-205">Вы можете ограничить объем ресурсов памяти и ЦП, которые доступны для контейнера, чтобы неконтролируемый процесс не исчерпал ресурсы узла.</span><span class="sxs-lookup"><span data-stu-id="017ec-205">You can limit the amount of memory and CPU that is available to a container, which can help to ensure that a runaway process doesn't exhaust the host resources.</span></span> <span data-ttu-id="017ec-206">Дополнительные сведения см. в статье [Шаблон отсеков](../patterns/bulkhead.md).</span><span class="sxs-lookup"><span data-stu-id="017ec-206">See the [Bulkhead Pattern](../patterns/bulkhead.md) for more information.</span></span>

### <a name="serverless-functions-as-a-service"></a><span data-ttu-id="017ec-207">Бессерверная архитектура (функции как услуга)</span><span class="sxs-lookup"><span data-stu-id="017ec-207">Serverless (Functions as a Service)</span></span>

<span data-ttu-id="017ec-208">При использовании бессерверной архитектуры не нужно управлять виртуальными машинами или инфраструктурой виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="017ec-208">With a serverless architecture, you don't manage the VMs or the virtual network infrastructure.</span></span> <span data-ttu-id="017ec-209">Вместо этого, вы развертываете код, который будет передан службой размещения в виртуальную машину для выполнения.</span><span class="sxs-lookup"><span data-stu-id="017ec-209">Instead, you deploy code and the hosting service handles putting that code onto a VM and executing it.</span></span> <span data-ttu-id="017ec-210">Этот подход поддерживает небольшие детализированные функции, которые координируются с использованием триггеров, основанных на событиях.</span><span class="sxs-lookup"><span data-stu-id="017ec-210">This approach tends to favor small granular functions that are coordinated using event-based triggers.</span></span> <span data-ttu-id="017ec-211">Например, сообщение, помещенное в очередь, может запустить функцию, которая считывает из очереди и обрабатывает сообщение.</span><span class="sxs-lookup"><span data-stu-id="017ec-211">For example, a message being placed onto a queue might trigger a function that reads from the queue and processes the message.</span></span>

<span data-ttu-id="017ec-212">[Функции Azure][functions] — это независимая от сервера служба вычислений, которая поддерживает различные триггеры функций, в том числе HTTP-запросы, очереди служебной шины и события концентраторов событий.</span><span class="sxs-lookup"><span data-stu-id="017ec-212">[Azure Functions][functions] is a serverless compute service that supports various function triggers, including HTTP requests, Service Bus queues, and Event Hubs events.</span></span> <span data-ttu-id="017ec-213">Полный список см. в статье [Основные понятия триггеров и привязок в Функциях Azure][functions-triggers].</span><span class="sxs-lookup"><span data-stu-id="017ec-213">For a complete list, see [Azure Functions triggers and bindings concepts][functions-triggers].</span></span> <span data-ttu-id="017ec-214">Также рассмотрите возможность использования [Сетки событий Azure][event-grid]. Это управляемая служба маршрутизации событий в Azure.</span><span class="sxs-lookup"><span data-stu-id="017ec-214">Also consider [Azure Event Grid][event-grid], which is a managed event routing service in Azure.</span></span>

### <a name="orchestrator-or-serverless"></a><span data-ttu-id="017ec-215">Архитектура с оркестрацией или независимая от сервера</span><span class="sxs-lookup"><span data-stu-id="017ec-215">Orchestrator or serverless?</span></span>

<span data-ttu-id="017ec-216">Ниже приведено несколько факторов, которые нужно учитывать при выборе между архитектурой с оркестратором и бессерверной архитектурой.</span><span class="sxs-lookup"><span data-stu-id="017ec-216">Here are some factors to consider when choosing between an orchestrator approach and a serverless approach.</span></span>

<span data-ttu-id="017ec-217">**Управляемость**. Бессерверными приложениями легче управлять, так как всеми вычислительными ресурсами управляет платформа.</span><span class="sxs-lookup"><span data-stu-id="017ec-217">**Manageability** A serverless application is easy to manage, because the platform manages all the of compute resources for you.</span></span> <span data-ttu-id="017ec-218">При использовании оркестратора некоторые аспекты администрирования и настройки кластера представлены на абстрактном уровне, он не полностью скрывает базовые виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="017ec-218">While an orchestrator abstracts some aspects of managing and configuring a cluster, it does not completely hide the underlying VMs.</span></span> <span data-ttu-id="017ec-219">При использовании оркестратора вам будет необходимо думать о таких проблемах, как балансировка нагрузки, использование ЦП и памяти, а также работа сети.</span><span class="sxs-lookup"><span data-stu-id="017ec-219">With an orchestrator, you will need to think about issues such as load balancing, CPU and memory usage, and networking.</span></span>

<span data-ttu-id="017ec-220">**Гибкость и контроль**.</span><span class="sxs-lookup"><span data-stu-id="017ec-220">**Flexibility and control**.</span></span> <span data-ttu-id="017ec-221">С помощью оркестратора у вас появится больше контроля над настройкой служб и кластера, а также управлением ими.</span><span class="sxs-lookup"><span data-stu-id="017ec-221">An orchestrator gives you a great deal of control over configuring and managing your services and the cluster.</span></span> <span data-ttu-id="017ec-222">Компромисс является дополнительной сложностью.</span><span class="sxs-lookup"><span data-stu-id="017ec-222">The tradeoff is additional complexity.</span></span> <span data-ttu-id="017ec-223">При использовании бессерверной архитектуры вы теряете некоторую часть контроля, так как эти детали абстрагированы.</span><span class="sxs-lookup"><span data-stu-id="017ec-223">With a serverless architecture, you give up some degree of control because these details are abstracted.</span></span>

<span data-ttu-id="017ec-224">**Мобильность.**</span><span class="sxs-lookup"><span data-stu-id="017ec-224">**Portability**.</span></span> <span data-ttu-id="017ec-225">Все перечисленные здесь оркестраторы (Kubernetes, DC/OS, Docker Swarm и Service Fabric) могут работать в локальной среде или в нескольких общедоступных облаках.</span><span class="sxs-lookup"><span data-stu-id="017ec-225">All of the orchestrators listed here (Kubernetes, DC/OS, Docker Swarm, and Service Fabric) can run on-premises or in multiple public clouds.</span></span> 

<span data-ttu-id="017ec-226">**Интеграция приложений**.</span><span class="sxs-lookup"><span data-stu-id="017ec-226">**Application integration**.</span></span> <span data-ttu-id="017ec-227">Создание сложного приложения с бессерверной архитектурой может оказаться трудной задачей.</span><span class="sxs-lookup"><span data-stu-id="017ec-227">It can be challenging to build a complex application using a serverless architecture.</span></span> <span data-ttu-id="017ec-228">Единственным вариантом в Azure является использование [Azure Logic Apps](/azure/logic-apps/) для координации набора функций Azure.</span><span class="sxs-lookup"><span data-stu-id="017ec-228">One option in Azure is to use [Azure Logic Apps](/azure/logic-apps/) to coordinate a set of Azure Functions.</span></span> <span data-ttu-id="017ec-229">Пример этого подхода представлен в статье [Создание функции, интегрируемой с Azure Logic Apps](/azure/azure-functions/functions-twitter-email).</span><span class="sxs-lookup"><span data-stu-id="017ec-229">For an example of this approach, see [Create a function that integrates with Azure Logic Apps](/azure/azure-functions/functions-twitter-email).</span></span>

<span data-ttu-id="017ec-230">**Стоимость**.</span><span class="sxs-lookup"><span data-stu-id="017ec-230">**Cost**.</span></span> <span data-ttu-id="017ec-231">С оркестратором вы платите за виртуальные машины, которые работают в кластере.</span><span class="sxs-lookup"><span data-stu-id="017ec-231">With an orchestrator, you pay for the VMs that are running in the cluster.</span></span> <span data-ttu-id="017ec-232">С независимым от сервера приложением вы платите только за фактически использованные вычислительные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="017ec-232">With a serverless application, you pay only for the actual compute resources consumed.</span></span> <span data-ttu-id="017ec-233">В обоих случаях вам необходимо учитывать стоимость любых дополнительных служб, таких как хранилища, базы данных и службы обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="017ec-233">In both cases, you need to factor in the cost of any additional services, such as storage, databases, and messaging services.</span></span>

<span data-ttu-id="017ec-234">**Масштабируемость**.</span><span class="sxs-lookup"><span data-stu-id="017ec-234">**Scalability**.</span></span> <span data-ttu-id="017ec-235">Функции Azure масштабируются автоматически в соответствии с требованиями в зависимости от числа входящих событий.</span><span class="sxs-lookup"><span data-stu-id="017ec-235">Azure Functions scales automatically to meet demand, based on the number of incoming events.</span></span> <span data-ttu-id="017ec-236">При использовании оркестратора вы можете выполнить масштабирование, увеличив количество экземпляров службы, запущенных в кластере.</span><span class="sxs-lookup"><span data-stu-id="017ec-236">With an orchestrator, you can scale out by increasing the number of service instances running in the cluster.</span></span> <span data-ttu-id="017ec-237">Вы также можете изменить масштаб, добавив дополнительные виртуальные машины в кластер.</span><span class="sxs-lookup"><span data-stu-id="017ec-237">You can also scale by adding additional VMs to the cluster.</span></span>

<span data-ttu-id="017ec-238">В эталонной реализации в основном используется Kubernetes, но мы также использовали службу "Функции Azure" для службы "История доставки".</span><span class="sxs-lookup"><span data-stu-id="017ec-238">Our reference implementation primarily uses Kubernetes, but we did use Azure Functions for one service, namely the Delivery History service.</span></span> <span data-ttu-id="017ec-239">Функции Azure подходят этой конкретной службе, так как это управляемая событиями рабочая нагрузка.</span><span class="sxs-lookup"><span data-stu-id="017ec-239">Azure Functions was a good fit for this particular service, because it's is an event-driven workload.</span></span> <span data-ttu-id="017ec-240">Так как для вызова функции используется триггер концентраторов событий, службе требуется минимальное количество кода.</span><span class="sxs-lookup"><span data-stu-id="017ec-240">By using an Event Hubs trigger to invoke the function, the service needed a minimal amount of code.</span></span> <span data-ttu-id="017ec-241">Кроме того, служба "История доставки" не является частью основного рабочего процесса, поэтому ее запуск за пределами кластера Kubernetes не повлияет на совокупную задержку инициированных пользователем операций.</span><span class="sxs-lookup"><span data-stu-id="017ec-241">Also, the Delivery History service is not part of the main workflow, so running it outside of the Kubernetes cluster doesn't affect the end-to-end latency of user-initiated operations.</span></span> 

> [!div class="nextstepaction"]
> [<span data-ttu-id="017ec-242">Рекомендации в отношении данных</span><span class="sxs-lookup"><span data-stu-id="017ec-242">Data considerations</span></span>](./data-considerations.md)

<!-- links -->

[acs-engine]: https://github.com/Azure/acs-engine
[acs-faq]: /azure/container-service/dcos-swarm/container-service-faq
[event-grid]: /azure/event-grid/
[functions]: /azure/azure-functions/functions-overview
[functions-triggers]: /azure/azure-functions/functions-triggers-bindings
