---
title: Масштабируемая обработка заказов
titleSuffix: Azure Example Scenarios
description: Создание конвейера обработки заказа с высокой степенью масштабируемости с помощью Azure Cosmos DB.
author: alexbuckgit
ms.date: 07/10/2018
ms.topic: example-scenario
ms.service: architecture-center
ms.subservice: example-scenario
social_image_url: /azure/architecture/example-scenario/data/media/architecture-ecommerce-order-processing.png
ms.openlocfilehash: 3bb6e0998f2832bfdb20ba8b7bbf099cf6ac0423
ms.sourcegitcommit: 3b15d65e7c35a19506e562c444343f8467b6a073
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2019
ms.locfileid: "54908416"
---
# <a name="scalable-order-processing-on-azure"></a>Масштабируемая обработка заказов в Azure

Этот пример сценария относится к организациям, которым требуется высокая степень масштабируемости и устойчивая архитектура для обработки заказов через Интернет. Потенциальные приложения включают точки продажи для электронной коммерции и розничной торговли, выполнение заказов, резервирование и отслеживание оборудования.

В этом сценарии применяется подход источника событий с использованием модели функционального программирования, реализованной с помощью микрослужб. Каждая микрослужба считается обработчиком потоков. Вся бизнес-логика реализуется через микрослужбы. Этот подход обеспечивает высокий уровень доступности и устойчивости, георепликацию и высокую производительность.

Использование управляемых служб Azure, таких как Cosmos DB и HDInsight, поможет сократить затраты за счет использования опыта корпорации Майкрософт в области хранения и извлечения данных в глобальных масштабах. В этом сценарии конкретно рассматривается сценарий электронной коммерции или розничной торговли. Если у вас есть другие потребности в службах данных, изучите список доступных [полностью управляемых интеллектуальных служб баз данных в Azure][product-category].

## <a name="relevant-use-cases"></a>Варианты соответствующего использования

Другие варианты использования:

- Серверные системы для точек продажи для электронной коммерции или розничной торговли.
- Системы управления запасами.
- Систем выполнения заказов.
- Другие сценарии интеграции, относящиеся к конвейеру обработки заказов.

## <a name="architecture"></a>Архитектура

![Пример архитектуры для конвейера масштабируемой обработки заказов][architecture]

Эта архитектура подробно описывает ключевые компоненты конвейера обработки заказа. Данные передаются в сценарии следующим образом:

1. Сообщения о событиях вводятся в систему с помощью клиентского приложения (синхронно, по протоколу HTTP) и различных серверных систем (асинхронно с помощью Apache Kafka). Эти сообщения передаются в конвейер обработки команд.
2. С помощью микрослужбы обработчика команд каждое сообщение о событии принимается и сопоставляется с одной из определенных команд. Обработчик команд извлекает любое текущее состояние, соответствующее выполнению команды, из базы данных моментальных снимков потока событий. Затем выполняется команда и выходные данные команды выдаются как новое событие.
3. Каждое событие, выданное как выходные данные команды, фиксируется в базе данных потока событий с помощью Cosmos DB.
4. Для каждой операции вставки или обновления базы данных, привязанной к базе данных потока событий, вызывается событие с помощью канала изменений Cosmos DB. Подчиненные системы могут подписаться на любые темы событий, связанные с этой системой.
5. Все события из канала изменений Cosmos DB также отправляются в микрослужбу моментальных снимков потока событий, которая вычисляет любое изменения состояния, вызванное произошедшими событиями. Затем новое состояние фиксируется в базе данных моментальных снимков потока событий, хранящейся в Cosmos DB. База данных моментальных снимков предоставляет глобально распределенный источник данных с низкой задержкой для текущего состояния всех элементов данных. Она обеспечивает полную запись всех сообщений о событиях, прошедших через архитектуру, за счет чего обеспечивается надежное тестирование, устранение неполадок и сценарии аварийного восстановления.

### <a name="components"></a>Компоненты

- [Cosmos DB](/azure/cosmos-db/introduction) — это глобально распределенная многомодельная база данных Майкрософт, которая позволяет решениям гибко и независимо масштабировать пропускную способность и ресурсы хранилища в любом числе регионов. Она гарантирует пропускную способность, задержку, доступность и согласованность в соответствии с комплексными Соглашениями об уровне обслуживания (SLA). Этот сценарий использует Cosmos DB для хранения потока событий и моментальных снимков, а также использует функции [канала изменений Cosmos DB][docs-cosmos-db-change-feed] для обеспечения целостности данных и восстановления после сбоев.
- [Apache Kafka в HDInsight](/azure/hdinsight/kafka/apache-kafka-introduction) —  это управляемая служебная реализация Apache Kafka — распределенной платформы потоковой передачи с открытым кодом, которую можно использовать для создания конвейеров и приложений потоковой передачи данных в режиме реального времени. Kafka также предоставляет функцию брокера сообщений, подобную очереди сообщений для публикации и подписки на именованные потоки данных. Этот сценарий используется Kafka для обработки входящих и подчиненных событий в конвейере обработки заказов.

## <a name="considerations"></a>Рекомендации

Различные варианты технологий доступны в режиме реального времени для приема сообщений, хранения данных, обработки потоков данных, хранения аналитических данных, а также аналитики и отчетности. Обзор этих параметров, их возможностей и ключевых критериев выбора см. в разделе [Выбор технологии приема сообщений в реальном времени в Azure ](/azure/architecture/data-guide/technology-choices/real-time-ingestion) в [Руководстве по архитектуре данных Azure](/azure/architecture/data-guide).

Архитектура микрослужб широко используется для создания устойчивых, высокомасштабируемых, независимо развертываемых и быстро развивающихся облачных приложений. Применение микрослужб требует другого подхода к разработке и созданию приложений. Такие инструменты, как Docker, Kubernetes, Azure Service Fabric и Nomad, позволяют разрабатывать архитектуры на основе микрослужб. Рекомендации о создании и запуске архитектуры на основе микрослужб см. в статье [Проектирование, создание и использование микрослужб в Azure](/azure/architecture/microservices) в Центре архитектуры Azure.

### <a name="availability"></a>Доступность

Подход к источнику событий этого сценария позволяет использовать слабо связанные системные компоненты, развертываемые независимо друг от друга. Cosmos DB предлагает [высокий уровень доступности][docs-cosmos-db-regional-failover] и помогает организации управлять компромиссами, связанными с целостностью, доступностью и производительностью с [соответствующими гарантиями ][docs-cosmos-db-guarantees]. Apache Kafka в HDInsight также предназначен для обеспечения [высокого уровня доступности][docs-kafka-high-availability].

Azure Monitor предоставляет унифицированный пользовательский интерфейс для мониторинга различных служб Azure. Для получения дополнительных сведений см. раздел [Мониторинг приложений и ресурсов в Azure](/azure/monitoring-and-diagnostics/monitoring-overview). Центры событий и Stream Analytics интегрированы с Azure Monitor.

Сведения о других вопросах доступности см. в статье [Контрольном списке для обеспечения доступности][availability].

### <a name="scalability"></a>Масштабируемость

Kafka в HDInsight позволяет [настраивать хранилища и масштабируемость](/azure/hdinsight/kafka/apache-kafka-scalability) для кластеров Kafka. Cosmos DB обеспечивает быструю, предсказуемую производительность и [легкую масштабируемость](/azure/cosmos-db/partition-data) по мере увеличения объема данных приложения.
Архитектура этого сценария, основанная на использовании микрослужб источников событий, также облегчает масштабирование системы и расширение ее функциональности.

Сведения по другим вопросам масштабируемости см. в статье [Контрольный список для обеспечения масштабируемости][scalability] в Центре архитектуры Azure.

### <a name="security"></a>Безопасность

[Модель безопасности Cosmos DB](/azure/cosmos-db/secure-access-to-data) проверяет подлинность пользователей и предоставляет доступ к своим данным и ресурсам. Дополнительные сведения см. в статье [Безопасность базы данных в Azure Cosmos DB](/azure/cosmos-db/database-security).

Общие рекомендации по разработке безопасных решений см. в разделе [Azure Security Documentation][security].

### <a name="resiliency"></a>Устойчивость

Архитектура источников событий и связанные с ней технологии обеспечивают высокую устойчивость при сбоях для этого сценария. Общее руководство по проектированию устойчивых решений см. в разделе [Проектирование устойчивых приложений для Azure][resiliency].

## <a name="pricing"></a>Цены

Чтобы изучить стоимость выполнения этого сценария, все услуги были предварительно сконфигурированы в калькуляторе стоимости. Чтобы узнать, как изменится цена для конкретного сценария, измените соответствующие переменные согласно с ожидаемым объемом данных. Для этого сценария примерная цена включает только Cosmos DB и кластер Kafka для обработки событий, вызванных с помощью канала изменения Cosmos DB. Обработчики событий и микрослужбы для исходных систем и других подчиненных систем не включены, их стоимость зависит от количества и объема этих служб, а также от технологий, выбранных для их реализации.

Плата за использование Azure Cosmos DB выражается в единицах запроса (ЕЗ). При использовании единиц запроса вам не нужно резервировать пропускную способность для чтения и записи или подготавливать ресурсы ЦП, памяти и ввода-вывода. Azure Cosmos DB поддерживает разные интерфейсы API с разным набором операций — от простых операций чтения и записи до сложных запросов графа. Так как не все запросы одинаковы, им назначается нормализованное количество единиц запроса на основе объема вычислений, необходимых для обслуживания каждого запроса. Количество единиц запроса, необходимое для вашего решения, зависит от размера элемента данных и количества операций чтения и записи базы данных в секунду. Дополнительные сведения см. в статье [Единицы запроса в базе данных Azure Cosmos DB](/azure/cosmos-db/request-units). Эти ориентировочные цены основаны на Cosmos DB, работающей в двух регионах Azure.

Здесь предоставлено три примера профиля затрат в зависимости от ожидаемого объема активности.

- [Небольшой][small-pricing]. Этот пример тарификации предполагает наличие 5 ЕЗ, зарезервированных для использования с хранилищем данных объемом 1 ТБ в Cosmos DB и небольшим (D3 v2) кластером Kafka.
- [Средний][medium-pricing]. Этот пример тарификации предполагает наличие 50 ЕЗ, зарезервированных для использования с хранилищем данных объемом 10 ТБ в Cosmos DB и средним (D4 v2) кластером Kafka.
- [Большой][large-pricing]. Этот пример тарификации предполагает наличие 500 ЕЗ, зарезервированных для использования с хранилищем данных объемом 30 ТБ в Cosmos DB и большим (D5 v2) кластером Kafka.

## <a name="related-resources"></a>Связанные ресурсы

Этот пример сценария основан на более обширной версии этой архитектуры, созданной [Jet.com](https://jet.com) для сквозного конвейера обработки заказов. Дополнительные сведения см. в [пользовательском техническом профиле jet.com][source-document] и [презентации jet.com на Build 2018][source-presentation].

Другие связанные ресурсы:

- *[Designing Data-Intensive Applications](https://dataintensive.net)* (Разработка ресурсоемких приложений), Мартин Клеппманн (Martin Kleppmann) (O'Reilly Media, 2017).
- *[ Tackle Software Complexity with Domain-Driven Design and F#](https://pragprog.com/book/swdddf/domain-modeling-made-functional)* (Функциональное моделирование доменов: упрощение программного обеспечения с поддержкой домена и F#), Скотт Влашин (Scott Wlaschin) (Pragmatic Programmers LLC, 2018).
- Другие [примеры использования Cosmos DB][docs-cosmos-db-use-cases]
- [Архитектура обработки в режиме реального времени](/azure/architecture/data-guide/big-data/real-time-processing) в [руководстве по архитектуре данных Azure](/azure/architecture/data-guide)

<!-- links -->

[architecture]: ./media/architecture-ecommerce-order-processing.png
[product-category]: https://azure.microsoft.com/product-categories/databases/
[source-document]: https://customers.microsoft.com/story/jet-com-powers-innovative-e-commerce-engine-on-azure-in-less-than-12-months
[source-presentation]: https://channel9.msdn.com/events/Build/2018/BRK3602
[small-pricing]: https://azure.com/e/3d43949ffbb945a88cc0a126dc3a0e6e
[medium-pricing]: https://azure.com/e/1f1e7bf2a6ad4f7799581211f4369b9b
[large-pricing]: https://azure.com/e/75207172ece94cf6b5fb354a2252b333
[docs-cosmos-db-change-feed]: /azure/cosmos-db/change-feed
[docs-cosmos-db-regional-failover]: /azure/cosmos-db/regional-failover
[docs-cosmos-db-guarantees]: /azure/cosmos-db/distribute-data-globally#AvailabilityGuarantees
[docs-cosmos-db-use-cases]: /azure/cosmos-db/use-cases
[docs-kafka-high-availability]: /azure/hdinsight/kafka/apache-kafka-high-availability
[docs-event-hubs]: /azure/event-hubs/event-hubs-what-is-event-hubs
[docs-stream-analytics]: /azure/stream-analytics/stream-analytics-introduction
[availability]: /azure/architecture/checklist/availability
[scalability]: /azure/architecture/checklist/scalability
[resiliency]: /azure/architecture/patterns/category/resiliency/
[security]: /azure/security/
