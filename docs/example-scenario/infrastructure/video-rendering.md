---
title: Отрисовка трехмерного видео на портале Azure
description: Выполнение собственных рабочих нагрузок HPC в Azure с использованием пакетной службы Azure
author: adamboeglin
ms.date: 07/13/2018
ms.openlocfilehash: e629e2ba0b9490e534057fee33f7bededa9656af
ms.sourcegitcommit: c704d5d51c8f9bbab26465941ddcf267040a8459
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2018
ms.locfileid: "39229190"
---
# <a name="3d-video-rendering-on-azure"></a>Отрисовка трехмерного видео на портале Azure

Трехмерная отрисовка — это длительный процесс, для его завершения требуется значительное количество времени ЦП.  На одном компьютере процесс создания видеофайла из статических ресурсов может занять часы или даже дни в зависимости от длины и сложности видео.  Многие компании будут покупать либо ресурсоемкие высокопроизводительные настольные компьютеры для выполнения этих задач, либо инвестировать в крупные фермы рендеринга, в которые они могут отправлять задания.  Однако при использовании пакетной службы Azure ресурсы доступны по требованию и они завершают работу, если в них нет надобности. И все это без каких-либо капиталовложений.

Пакетная служба предоставляет согласованные средства планирования заданий и управления ими для вычислительных узлов как с Windows Server, так и с Linux. С помощью пакетной службы вы можете использовать имеющиеся приложения Windows или Linux, включая AutoDesk Maya и Blender, чтобы выполнить крупномасштабную отрисовку заданий в Azure.

## <a name="related-use-cases"></a>Связанные варианты использования

Рассмотрите этот сценарий для похожих вариантов использования:

* 3D-моделирование.
* Отрисовка Visual FX (VFX).
* Перекодирование видео.
* Обработка изображений, цветокоррекция и изменение размера.

## <a name="architecture"></a>Архитектура

![Общие сведения об архитектуре компонентов, используемых в собственном облачном решении HPC с применением пакетной службы Azure][architecture]

В этом примере сценария описывается рабочий процесс при использовании пакетной службы Azure. Поток данных выглядит следующим образом:

1. Передача входных файлов и приложений для обработки этих файлов в учетную запись службы хранилища Azure.
2. Создание пула вычислительных узлов пакетной службы в своей учетной записи пакетной службы, задание для выполнения рабочей нагрузки в пуле и задачи в задании.
3. Скачивание входных файлов и приложений для пакетной службы.
4. Мониторинг выполнения задач.
5. Отправка выходных данных задачи.
6. Скачивание выходных файлов.

Чтобы упростить этот процесс, можно также использовать [подключаемые модули пакетной службы для Maya и 3DS Max][batch-plugins]

### <a name="components"></a>Компоненты

Пакетная служба Azure построена на основе следующих технологий Azure.

* [Группа ресурсов][resource-groups] — это логический контейнер для ресурсов Azure.
* [Виртуальные сети][vnet] используются для головного узла и вычислительных ресурсов.
* Учетные записи [хранения][storage] используются для хранения данных и синхронизации.
* [Масштабируемые наборы виртуальных машин][vmss] используются CycleCloud для вычислительных ресурсов.

## <a name="considerations"></a>Рекомендации

### <a name="machine-sizes-available-for-azure-batch"></a>Доступный размер компьютеров для пакетной службы Azure
Хотя большинство клиентов, которые заказывают услуги рендеринга, выбирают ресурсы с высокой мощностью ЦП, для других рабочих нагрузок, использующих Масштабируемые наборы виртуальных машин, можно выбрать разные виртуальные машины. Их выбор зависит от ряда факторов:
  - Связано ли приложение с выполняющейся памятью?
  - Требуется ли использование графического процессора в приложении? 
  - Требуют ли типы заданий высокого уровня параллелизма или подключения Infiniband для тесно связанных заданий?
  - Требуется ли быстрый ввод-вывод в службе хранилища на вычислительных узлах?

Azure имеет широкий диапазон размеров виртуальных машин, которые могут удовлетворить каждое из перечисленных выше требований к приложениям. Некоторые из них относятся к HPC, но даже виртуальные машины самых маленьких размеров могут использоваться для обеспечения эффективной реализации сетки:

  - [Размеры виртуальных машин с высокопроизводительными вычислительными системами (HPC)][compute-hpc]. Из-за особенностей рендеринга, связанных с центральным процессором, корпорация Майкрософт обычно рекомендует использовать виртуальные машины Azure серии H.  Они специально созданы для высокопроизводительных вычислений, предоставляют виртуальные ЦП с 8 или 16 ядрами, а также имеют оперативную память DDR4, временное хранилище SSD и технологию Haswell E5 Intel.
  - [Размеры виртуальных машин с GPU][compute-gpu]. Размеры виртуальных машин с оптимизацией GPU — это специализированные виртуальные машины с одним или несколькими GPU NVIDIA. Эти размеры предназначены для рабочих нагрузок с большим объемом вычислений, графической обработки и визуализаций.
    - Размеры NC, NCv2, NCv3 и ND оптимизированы для приложений и алгоритмов, требующих ресурсоемких вычислений и высокой пропускной способности сети, включая приложения и моделирование на базе CUDA и OpenCL, а также ИИ и глубокое обучение. Размеры NV оптимизированы и предназначены для удаленной визуализации, потоковой передачи, игр, кодирования и сценариев VDI, которые используют такие платформы, как OpenGL и DirectX.
  - [Размеры виртуальных машин, оптимизированных для операций в памяти][compute-memory]. Когда требуется больше памяти, в размерах виртуальных машин, оптимизированных для операций в памяти, предоставляется высокое соотношение ресурсов памяти и ядра.
  - [Размеры виртуальных машин общего назначения][compute-general]. Размеры виртуальных машин общего назначения также доступны и предоставляют сбалансированное соотношение ресурсов ЦП и памяти.

### <a name="alternatives"></a>Альтернативные варианты

Если вам требуется больше контроля над средой отрисовки в Azure или нужна гибридная реализация, тогда вычисления CycleCloud могут помочь оркестрировать сетку IaaS в облаке. Используя те же базовые технологии Azure, что и пакетная служба Azure, они позволяют эффективно создавать и поддерживать сетку IaaS. Чтобы узнать об этом побольше и изучить принципы проектирования, используйте следующую ссылку.

Полный обзор всех решений HPC, доступных в Azure, см. в статье [Использование HPC, пакетной службы и больших вычислений][hpc-alt-solutions]

### <a name="availability"></a>Доступность

Мониторинг компонентов пакетной службы Azure доступен в целом ряде служб, средств и API. Это описано далее в статье [Мониторинг решений пакетной службы][batch-monitor].

### <a name="scalability"></a>Масштабируемость

Пулы учетной записи можно масштабировать автоматически по формуле на основе метрик пакетной службы Azure, или же вручную. Дополнительные сведения см. в статье [Создание формулы автоматического масштабирования для масштабирования вычислительных узлов в пуле пакетной службы][batch-scaling].

### <a name="security"></a>Безопасность

Общие рекомендации по разработке безопасных решений см. в разделе [Azure Security Documentation][security].

### <a name="resiliency"></a>Устойчивость

В настоящее время в пакетной службе Azure отсутствует возможность отработки отказа, поэтому рекомендуется выполнить следующие действия для обеспечения доступности в случае незапланированного сбоя:

* Создайте учетную запись пакетной службы Azure в альтернативном расположение Azure с помощью альтернативной учетной записи хранения.
* Создайте одни и те же узлы пулов с тем же именем без выделенных узлов.
* Убедитесь, что приложения создаются и обновляются в альтернативной учетной записи хранения.
* Отправьте входные файлы и задания в альтернативную учетную запись пакетной службы Azure.

## <a name="deploy-this-scenario"></a>Развертывание этого сценария

### <a name="creating-an-azure-batch-account-and-pools-manually"></a>Создание учетной записи и пулов пакетной службы Azure вручную

В этом примере сценария предоставлена справка о работе пакетной службы Azure при демонстрации Azure Batch Labs. В качестве примера выступает решение SaaS, которое может быть разработано для ваших клиентов:

[Демонстрация с пакетной службой Azure][batch-labs-masterclass]

### <a name="deploying-the-sample-scenario-using-an-azure-resource-manager-arm-template"></a>Развертывание сценария с помощью шаблона Azure Resource Manager (ARM)

Шаблон развертывает:
  - Новую учетную запись пакетной службы Azure.
  - Учетная запись хранения.
  - Пул узла, связанный с учетной записью пакетной службы.
  - Пул узла, который будет настроен для использования виртуальных машин A2 v2 с образами Canonical Ubuntu.
  - Пул узла, который изначально не будет содержать виртуальных машин и потребует масштабирование вручную для их добавления.

<a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Fsolution-architectures%2Fmaster%2Fhpc%2Fbatchcreatewithpools.json" target="_blank">
    <img src="http://azuredeploy.net/deploybutton.png"/>
</a>

[Дополнительные сведения о шаблонах ARM][azure-arm-templates]

## <a name="pricing"></a>Цены

Затраты на использование пакетной службы Azure будут зависеть от размеров виртуальных машин, которые используются для пулов, и от того, как долго они выделяются и выполняются. Плата за создание учетной записи пакетной службы Azure отсутствует. Исходящий трафик хранилища и данных также следует учитывать, так как за них взимается дополнительная плата.

Ниже приведены примеры взимаемых затрат для задания, выполняющегося за 8 часов с разным количеством серверов:


- 100 виртуальных машин с высокопроизводительным ЦП: [оценка затрат][hpc-est-high]

  100 x H16m (16 ядер, 225 ГБ ОЗУ, хранилище класса Premium 512 ГБ), хранилище BLOB-объектов — 2 ТБ, 1 ТБ исходящего трафика

- 50 виртуальных машин с высокопроизводительным ЦП: [оценка затрат][hpc-est-med]

  50 x H16m (16 ядер, 225 ГБ ОЗУ, хранилище класса Premium 512 ГБ), хранилище BLOB-объектов — 2 ТБ, 1 ТБ исходящего трафика

- 10 виртуальных машин с высокопроизводительным ЦП: [оценка затрат][hpc-est-low]
  
  10 x H16m (16 ядер, 225 ГБ ОЗУ, хранилище класса Premium 512 ГБ), хранилище BLOB-объектов — 2 ТБ, 1 ТБ исходящего трафика

### <a name="low-priority-vm-pricing"></a>Виртуальные машины с низким приоритетом (цены)

Пакетная служба Azure также поддерживает использование в пулах узлов виртуальных машин с низким приоритетом*, которые фундаментально уменьшают затраты. Сравнение цен стандартных виртуальных машин и виртуальных машин с низким приоритетом, а также дополнительные сведения о виртуальных машинах с низким приоритетом см. в статье [Цены на пакетную службу][batch-pricing].

\* Обратите внимание, что только некоторые приложения и рабочие нагрузки подходят для запуска на виртуальных машинах с низким приоритетом.

## <a name="related-resources"></a>Связанные ресурсы

[Пакетная служба][batch-overview]

[Документация по пакетной службе][batch-doc]

[Использование контейнеров в пакетной службе Azure][batch-containers]

<!-- links -->
[architecture]: ./media/native-hpc-ref-arch.png
[resource-groups]: /azure/azure-resource-manager/resource-group-overview
[security]: /azure/security/
[resiliency]: /azure/architecture/resiliency/
[scalability]: /azure/architecture/checklist/scalability
[vmss]: /azure/virtual-machine-scale-sets/overview
[vnet]: /azure/virtual-network/virtual-networks-overview
[storage]: https://azure.microsoft.com/services/storage/
[batch]: https://azure.microsoft.com/services/batch/
[batch-arch]: https://azure.microsoft.com/solutions/architecture/big-compute-with-azure-batch/
[compute-hpc]: /azure/virtual-machines/windows/sizes-hpc
[compute-gpu]: /azure/virtual-machines/windows/sizes-gpu
[compute-compute]: /azure/virtual-machines/windows/sizes-compute
[compute-memory]: /azure/virtual-machines/windows/sizes-memory
[compute-general]: /azure/virtual-machines/windows/sizes-general
[compute-storage]: /azure/virtual-machines/windows/sizes-storage
[compute-acu]: /azure/virtual-machines/windows/acu
[compute=benchmark]: /azure/virtual-machines/windows/compute-benchmark-scores
[hpc-est-high]: https://azure.com/e/9ac25baf44ef49c3a6b156935ee9544c
[hpc-est-med]: https://azure.com/e/0286f1d6f6784310af4dcda5aec8c893
[hpc-est-low]: https://azure.com/e/e39afab4e71949f9bbabed99b428ba4a
[batch-labs-masterclass]: https://github.com/azurebigcompute/BigComputeLabs/tree/master/Azure%20Batch%20Masterclass%20Labs
[batch-scaling]: /azure/batch/batch-automatic-scaling
[hpc-alt-solutions]: /azure/virtual-machines/linux/high-performance-computing?toc=%2fazure%2fbatch%2ftoc.json
[batch-monitor]: /azure/batch/monitoring-overview
[batch-pricing]: https://azure.microsoft.com/en-gb/pricing/details/batch/
[batch-doc]: /azure/batch/
[batch-overview]: https://azure.microsoft.com/services/batch/
[batch-containers]: https://github.com/Azure/batch-shipyard
[azure-arm-templates]: /azure/azure-resource-manager/resource-group-overview#template-deployment
[batch-plugins]: /azure/batch/batch-rendering-service#options-for-submitting-a-render-job
