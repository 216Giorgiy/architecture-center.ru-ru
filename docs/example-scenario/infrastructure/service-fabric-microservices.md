---
title: Использование Service Fabric для декомпозиции приложений
titleSuffix: Azure Example Scenarios
description: Декомпозиция больших монолитных приложений на микрослужбы.
author: timomta
ms.date: 09/20/2018
ms.custom: fasttrack
ms.openlocfilehash: 90159b0cbfd3e7af542a79d050d153b4a3435a0d
ms.sourcegitcommit: bb7fcffbb41e2c26a26f8781df32825eb60df70c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/20/2018
ms.locfileid: "53643821"
---
# <a name="using-service-fabric-to-decompose-monolithic-applications"></a>Использование Service Fabric для декомпозиции монолитных приложений

В этом примере будет рассмотрен сценарий декомпозиции большого цельного приложения с помощью платформы [Service Fabric](/azure/service-fabric/service-fabric-overview). Предполагается применение итеративного подхода к расчленению веб-сайта IIS/ASP.NET на множество управляемых микрослужб, формирующих одно приложение.

Переход от монолитной архитектуры к архитектуре микрослужб обеспечивает ряд преимуществ:

- возможность изменять и разворачивать один небольшой и понятный блок кода;
- время развертывания каждого блока кода составляет всего несколько минут;
- если в блоке кода присутствует ошибка, прекращается работа только этого блока, а не всего приложения;
- небольшие блоки кода удобно и распределять среди нескольких команд разработчиков;
- новым разработчикам легче понять функциональность каждого из блоков кода.

В этом примере рассматривается большое приложение IIS, работающее на ферме серверов, при этом концепция итеративной декомпозиции и размещения может применяться для крупного приложения любого типа. Хотя это решение использует Windows, Service Fabric может выполняться и на платформе Linux. Решение может размещаться локально, в Azure или на узлах виртуальных машин любого провайдера облачных услуг.

## <a name="relevant-use-cases"></a>Варианты соответствующего использования

Этот сценарий актуален для организаций, обладающих крупными целостными веб-приложениями и сталкивающихся с такими проблемами:

- Ошибки при незначительных изменениях кода приводят к сбою в работе всего веб-сайта.
- Выпуск обновления занимает многие дни, так как веб-сайт выпускается целиком.
- Продолжительность и сложность подключения к работе новых разработчиков и команд из-за сложного базового кода, а это значит, что одному человеку нужно слишком много знать.

## <a name="architecture"></a>Архитектура

Используя Service Fabric в качестве платформы размещения, крупный веб-сайт IIS можно преобразовать в комбинацию микрослужб, как показано на рисунке.

![Схема архитектуры](./media/architecture-service-fabric-complete.png)

На иллюстрации выше все структурные части крупного приложения IIS были разделены на такие компоненты:

- служба маршрутизации или шлюза, принимающая входящие запросы браузера и анализирующая их на предмет того, какие службы должны их обрабатывать, и перенаправляющая запросы к соответствующим службам;
- четыре приложения ASP.NET Core, которые формально являлись виртуальными каталогами единого веб-сайта IIS и выполнялись как приложения ASP.NET. Теперь приложения разделены на независимые микрослужбы. Это позволяет изменять и обновлять их по отдельности. В этом примере мы переписали каждое приложение с помощью .Net Core и ASP.NET Core. Эти микрослужбы изначально создавались как [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction), поэтому им доступны все возможности и преимущества платформы Service Fabric (взаимодействия, отчеты о работоспособности, уведомления и т. д.).
- *Служба индексирования* Windows теперь содержится в контейнере Windows, поэтому теперь не нужно непосредственно вносить изменения в реестр базового сервера. Приложение может запускаться автономно и развертываться со всеми своими зависимостями как единое целое.
- Служба архивирования является просто исполняемым файлом, который запускается по расписанию и выполняет некоторые задачи для веб-сайтов. Она размещается непосредственно в виде отдельного исполняемого файла, так как мы определили, что она отлично справляется со своими задачами и не требует никаких изменений.

## <a name="considerations"></a>Рекомендации

Первая задача заключается в определении небольших фрагментов кода, которые можно вынести за рамки монолитного приложения в виде микрослужб, чтобы это приложение могло их вызывать. Со временем с каждой новой итерацией монолитное приложение раздробляется на коллекцию таких микрослужб, которые понятны разработчикам, легкого модифицируются и быстро разворачиваются с минимальным риском.

Выбор пал на Service Fabric, так как эта платформа способна поддерживать различные виды микрослужб. Например, у вас может быть несколько автономных исполняемых файлов, небольшие новые веб-сайты, небольшие новые интерфейсы API, контейнерные службы и т. д. С помощью Service Fabric службы всех этих типов можно объединить в единый кластер.

Чтобы получить такое итоговое разложенное приложение, будем использовать итеративный подход. Мы выбрали большой веб-сайт IIS/ASP.NET, работающий на ферме серверов. Целостный узел фермы серверов показан на картинке. Он содержит веб-сайт с несколькими виртуальными каталогами, дополнительные службы Windows, которые вызывает веб-сайт, и исполняемый файл, который периодически выполняет обслуживание архива веб-сайта.

![Схема архитектуры монолитного решения](./media/architecture-service-fabric-monolith.png)

В ходе первой итерации веб-сайт IIS и его виртуальные каталоги были помещены в [контейнер Windows](/azure/service-fabric/service-fabric-containers-overview). Это позволяет сохранить работоспособность веб-сайта, ослабив при этом его зависимость от ОС узла сервера. Контейнер выполняется и оркестрируется с помощью базового узла Service Fabric, но работоспособность веб-сайта не зависит от каких-либо состояний узла (записей реестра, файлов и т. д.). Все эти элементы находятся в контейнере. По той же причине мы поместили службу индексирования в контейнер Windows. Контейнеры можно разворачивать, обновлять и масштабировать независимо друг от друга. Наконец, мы разместили службу архивирования — простой [автономный исполняемый файл](/azure/service-fabric/service-fabric-guest-executables-introduction), так как к нему не предъявляются особые требования.

На картинке ниже показано частичное разделение изначального веб-сайта на независимые составляющие и направления для его дальнейшего дробления.

![На схеме архитектуры отображается частичное разложение](./media/architecture-service-fabric-midway.png)

Дальнейшие действия направлены на разделение контейнера веб-сайта, показанного в нижней части картинки. Каждое приложение виртуального каталога ASP.NET по очереди удаляется из контейнера и переносится в среду ASP.NET Core в виде [Reliable Service](/azure/service-fabric/service-fabric-reliable-services-introduction).

После переноса всех виртуальных каталогов веб-сайт переписывается с помощью ASP.NET Core в виде Reliable Service — "надежной службы", принимающей входящие запросы браузера и перенаправляющей их к соответствующему приложению ASP.NET.

### <a name="availability-scalability-and-security"></a>Доступность, масштабируемость и безопасность

Платформа Service Fabric [поддерживает различные виды микрослужб](/azure/service-fabric/service-fabric-choose-framework), обеспечивая быстрый и простой обмен вызовами между ними в рамках одного кластера. Service Fabric — это [отказоустойчивый](/azure/service-fabric/service-fabric-availability-services), самовосстанавливающийся кластер, который позволяет выполнять контейнеры и исполняемые файлы, а также обладает собственным API для написания микрослужб, интегрированных непосредственно в кластер (упомянутые Reliable Services). Платформа упрощает последовательное обновление микрослужб и управление их версиями. Можно произвольно менять масштаб любой выполняемой на платформе микрослужбы в рамках кластера Service Fabric, осуществляя таким образом горизонтальное или вертикальное [масштабирование](/azure/service-fabric/service-fabric-concepts-scalability) требуемой микрослужбы.

Service Fabric — это кластер на базе инфраструктуры виртуальных (или физических) узлов с сетевыми ресурсами, хранилищами и операционными системами. Таким образом, Service Fabric может выполнять задачи администрирования, обслуживания и мониторинга.

Рассмотрим также функции управления кластером и контроля над ним. Точно так же, как вы возражали бы против бесконтрольного развертывания каких-либо баз данных на рабочем сервере баз данных, так и в кластере Service Fabric необходим контроль над размещением приложений пользователями.

Ознакомьтесь с тем, какие [сценарии работы с приложениями](/azure/service-fabric/service-fabric-application-scenarios) позволяет реализовать Service Fabric.

## <a name="pricing"></a>Цены

Если кластер Service Fabric размещается в Azure, основная часть затрат приходится на плату за количество и размер узлов в кластере. Azure позволяет быстро и просто создать кластер, состоящий из базового узла указанного вами размера. Плата за вычислительные ресурсы определяется в результате умножения количества узлов на их размер.

К другим менее заметным статьям расходов относится плата за хранение виртуальных дисков каждого узла и плата за исходящий трафик из Azure (например, сетевой трафик из Azure в браузер пользователя).

Чтобы получить представление о стоимости услуг, воспользуйтесь калькулятором цен. [Он](https://azure.com/e/52dea096e5844d5495a7b22a9b2ccdde) рассчитывает стоимость услуг на основе стандартных значений размера кластера, сетевых ресурсов и объема хранилища. В калькуляторе вы можете указать значения, которые наиболее точно соответствуют вашей ситуации.

## <a name="next-steps"></a>Дальнейшие действия

Уделите некоторое время знакомству с платформой, изучив [документацию](/azure/service-fabric/service-fabric-overview) и различные [сценарии применения](/azure/service-fabric/service-fabric-application-scenarios) Service Fabric. В документации объясняется, из чего состоит кластер, какие приложения в нем можно выполнять, какова его программная архитектура и какое обслуживание ему необходимо.

Демонстрация развертывания существующего приложения .NET в Service Fabric представлена в этом [кратком руководстве](/azure/service-fabric/service-fabric-quickstart-dotnet).

Рассмотрите различные функции приложения, которое вы используете прямо сейчас. Выберите одну из них и продумайте, как ее можно обособить от остальных. Проделайте то же самое с другими функциями, поочередно обдумывая каждую отдельную функцию.

## <a name="related-resources"></a>Связанные ресурсы

- [Проектирование, создание и использование микрослужб в Azure](/azure/architecture/microservices)
- [Общие сведения о Service Fabric](/azure/service-fabric/service-fabric-overview)
- [Общие сведения о модели программирования Service Fabric](/azure/service-fabric/service-fabric-choose-framework)
- [Доступность служб структуры служб](/azure/service-fabric/service-fabric-availability-services)
- [Масштабирование в Service Fabric](/azure/service-fabric/service-fabric-concepts-scalability)
- [Service Fabric и контейнеры](/azure/service-fabric/service-fabric-containers-overview)
- [Развертывание существующего исполняемого файла вручную](/azure/service-fabric/service-fabric-guest-executables-introduction)
- [Обзор надежных служб](/azure/service-fabric/service-fabric-reliable-services-introduction)
- [Сценарии приложений Service Fabric](/azure/service-fabric/service-fabric-application-scenarios)