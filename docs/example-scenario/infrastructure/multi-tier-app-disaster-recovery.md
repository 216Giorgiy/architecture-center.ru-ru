---
title: Многоуровневое веб-приложение для обеспечения высокой доступности и аварийного восстановления
titleSuffix: Azure Example Scenarios
description: Создание многоуровневых веб-приложений для обеспечения высокой доступности и аварийного восстановления в Azure с использованием виртуальных машин Azure, групп доступности, зон доступности, диспетчера трафика Azure и Azure Site Recovery.
author: sujayt
ms.date: 11/16/2018
ms.topic: example-scenario
ms.service: architecture-center
ms.subservice: example-scenario
ms.custom: product-team
ms.openlocfilehash: 377c1663b8cd81f7788a1f2ce82b562a9695f3b0
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54483995"
---
# <a name="multitier-web-application-built-for-high-availability-and-disaster-recovery-on-azure"></a>Создание многоуровневых веб-приложений для обеспечения высокой доступности и аварийного восстановления в Azure

Этот пример сценария можно использовать в любой отрасли, где требуется развертывать устойчивые многоуровневые приложения для обеспечения высокой доступности и аварийного восстановления. В этом сценарии приложение состоит из трех уровней:

- Веб-уровень. Верхний уровень, который включает пользовательский интерфейс. На этом уровне анализируются действия пользователя, которые затем передаются на следующий уровень для обработки.
- Бизнес-уровень. Здесь действия пользователя обрабатываются, после чего принимаются логические решения о дальнейших шагах. Этот уровень соединяет веб-уровень и уровень данных.
- Уровень данных. На этом уровне хранятся данные приложения. Для этого обычно используется база данных, хранилище объектов или хранилище файлов.

В распространенных сценариях все критически важные приложения выполняются в системах под управлением Windows или Linux. К таким приложениям могут относится готовые решения, например SAP и SharePoint, или пользовательские бизнес-приложения.

## <a name="relevant-use-cases"></a>Варианты соответствующего использования

Другие варианты использования:

- развертывание высокоустойчивых приложений, например SAP и SharePoint;
- обеспечение непрерывности бизнес-процессов и аварийного восстановления для бизнес приложений;
- настройка и отработка аварийного восстановления с соответствии с нормативными требованиями.

## <a name="architecture"></a>Архитектура

В этом сценарии рассматривается многоуровневое приложение, использующее ASP.NET и Microsoft SQL Server. Вы можете выбирать между регионами Azure с [поддержкой](/azure/availability-zones/az-overview#regions-that-support-availability-zones) и без поддержки зон доступности. В первом случае можно развернуть виртуальные машины в исходном регионе в пределах зон доступности, а затем реплицировать их в целевой регион, предназначенный для аварийного восстановления. В втором случае можно развернуть виртуальные машины в группе доступности и затем реплицировать их в целевой регион.

![Общие сведения об архитектуре высокоустойчивого многоуровневого веб-приложения][architecture]

- Распределяйте виртуальные машины каждого уровня в пределах двух зон доступности в соответствующих регионах. В регионах, не поддерживающих зоны доступности, развертывайте виртуальные машины на каждом уровне в пределах одной группы доступности.
- Уровень базы данных можно настроить для использования групп доступности Always On. Если в такой конфигурации SQL Server настроен с одной базой данных-источником в кластере, то он может иметь до восьми баз данных-получателей. В случае сбоя базы данных-источника кластер выполнит отработку отказа в одну из баз данных-получателей, обеспечивая доступность приложения. Дополнительные сведения см. в статье [Обзор групп доступности AlwaysOn (SQL Server)][docs-sql-always-on].
- Для сценариев аварийного восстановления можно настроить собственный механизм асинхронной репликации SQL Always On в целевой регион, используемый для аварийного восстановления. Можно также настроить Azure Site Recovery для репликации в целевой регион, если частота изменения данных находится в пределах, заданных Azure Site Recovery.
- Доступ пользователей к внешнему интерфейсу ASP.NET на веб-уровне осуществляется через конечную точку диспетчера трафика.
- Диспетчер трафика перенаправляет трафик в основную общедоступную конечную точку (IP-адрес) в основном исходном регионе.
- С общедоступного IP-адреса вызов перенаправляется в один из экземпляров виртуальной машины веб-уровня через общедоступную подсистему балансировки нагрузки. Все экземпляры виртуальной машины веб-уровня находятся в одной подсети.
- От виртуальной машины веб-уровня вызов направляется на обработку в один из экземпляров виртуальной машины бизнес-уровня через внутреннюю подсистему балансировки нагрузки. Все виртуальные машины бизнес-уровня находятся в отдельной подсети.
- На бизнес-уровне операция обрабатывается, и приложение ASP.NET подключается к кластеру Microsoft SQL Server на уровне сервера через внутреннюю подсистему балансировки нагрузки Azure. Эти экземпляры SQL Server уровня сервера находятся в отдельной подсети.
- Дополнительная конечная точка диспетчера трафика настроена как общедоступный IP-адрес в целевом регионе, используемом для аварийного восстановления.
- В случае сбоя в основном регионе Azure Site Recovery выполняет отработку отказа, обеспечивая доступность приложения в целевом регионе.
- Конечная точка диспетчера трафика автоматически перенаправляет пользовательский трафик на общедоступный IP-адрес в целевом регионе.

### <a name="components"></a>Компоненты

- [Группы доступности][docs-availability-sets] распределяют развернутые в Azure виртуальные машины между несколькими изолированными аппаратными узлами в кластере. В случае сбоя оборудования или программного обеспечения в Azure будет затронута только часть виртуальных машин, а само приложение останется доступным и работоспособным.
- [Зоны доступности][docs-availability-zones] защищают приложения и данные от сбоев на уровне центра обработки данных. Зоны доступности — это отдельные физические расположения в пределах одного региона Azure. Каждая зона состоит из одного или нескольких центров обработки данных, оснащенных независимыми системами электроснабжения, охлаждения и сетевого взаимодействия.
- [Azure Site Recovery (ASR)][docs-azure-site-recovery] позволяет реплицировать виртуальные машины в другой регион Azure, обеспечивая непрерывность бизнес-процессов и аварийное восстановление. Можно периодически проводить тестирование аварийного восстановления, чтобы обеспечить соответствие требованиям. Виртуальная машина будет реплицирована с указанными параметрами в выбранный регион, чтобы вы могли восстановить приложения в случае сбоев в исходном регионе.
- [Диспетчер трафика Azure][docs-traffic-manager] — это подсистема балансировки нагрузки трафика на основе DNS, которая оптимально распределяет трафик между службами в глобальных регионах Azure, обеспечивая высокий уровень доступности и оперативности.
- [Azure Load Balancer][docs-load-balancer] распределяет входящий трафик в соответствии с определенными правилами и пробами работоспособности. Подсистема балансировки нагрузки обеспечивает низкую задержку и высокую пропускную способность, а также позволяет выполнять масштабирование до миллионов потоков для всех приложений, которые используют протоколы TCP и UDP. Общедоступная подсистема балансировки нагрузки используется в этом сценарии, чтобы перенаправлять входящий трафик клиента на веб-уровень. Внутренняя подсистема балансировки нагрузки используется в этом сценарии, чтобы перенаправлять трафик, поступающий с бизнес-уровня, в кластер SQL Server.

### <a name="alternatives"></a>Альтернативные варианты

- Windows это не единственная операционная система, поддерживаемая этой инфраструктурой.
- [SQL Server для Linux][docs-sql-server-linux] можно заменить серверным хранилищем данных.
- Базу данных можно заменить любым стандартным приложением базы данных.

## <a name="other-considerations"></a>Дополнительные рекомендации

### <a name="scalability"></a>Масштабируемость

Вы можете добавлять или удалять виртуальные машины на каждом уровне в соответствии с потребностями в масштабировании. Так как в этом сценарии используется подсистемы балансировки нагрузки, увеличение количества виртуальных машин на каком-либо уровне не влияет на время доступности приложения.

Для других вопросов масштабируемости, см. раздел [Контрольный список для обеспечения масштабируемости][scalability] в центре архитектуры Azure.

### <a name="security"></a>Безопасность

Весь трафик в виртуальной сети на веб-уровне защищен группами безопасности сети. Правила ограничивают поток трафика, так что экземпляры виртуальных машин уровня внешнего приложения могут получить доступ к уровню серверной базы данных. Исходящий интернет-трафик с бизнес-уровня или уровня базы данных блокируется. Чтобы сократить площади атаки, прямые порты удаленного управления остаются закрытыми. Дополнительные сведения см. в статье [Группы безопасности приложений и сети][docs-nsg].

Общие рекомендации по разработке безопасных сценариев см. в статье [Документация по системе безопасности Azure][security].

## <a name="pricing"></a>Цены

За выполнение аварийного восстановления виртуальных машин Azure с помощью Azure Site Recovery предусмотрены такие регулярные платежи:

- Плата за лицензию на Azure Site Recovery для каждой виртуальной машины.
- Плата за исходящий сетевой трафик, связанный с репликацией изменений в данных с дисков исходной виртуальной машины в другой регион Azure. В Azure Site Recovery реализована функция сжатия данных, чтобы снизить использование ресурсов при передаче данных примерно на 50 %.
- Плата за хранение данных в расположении восстановления. Размер этой платы обычно соответствует стоимости хранения данных в исходном регионе плюс плата за дополнительный объем, необходимый для хранения точек восстановления в качестве моментальных снимков для восстановления.

С помощью [калькулятора цен][calculator] можно рассчитать стоимость аварийного восстановления для трехуровневого приложения с использованием шести виртуальных машин. В калькуляторе цен стоимость использования всех служб рассчитывается на основе предварительно выбранных параметров. Чтобы узнать, как изменится плата за определенный вариант использования, измените соответствующие параметры.

<!-- links -->
[architecture]: ./media/arhitecture-disaster-recovery-multi-tier-app.png
[autoscaling]: /azure/architecture/best-practices/auto-scaling
[availability]: ../../checklist/availability.md
[resiliency]: /azure/architecture/resiliency/
[security]: /azure/security/
[scalability]: /azure/architecture/checklist/scalability
[docs-availability-zones]: /azure/availability-zones/az-overview
[docs-load-balancer]: /azure/load-balancer/load-balancer-overview
[docs-nsg]: /azure/virtual-network/security-overview
[docs-vmss]: /azure/virtual-machine-scale-sets/overview
[docs-sql-always-on]: /sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server
[docs-vmss-autoscale]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview
[docs-vnet]: /azure/virtual-network/virtual-networks-overview
[docs-sql-server-linux]: /sql/linux/sql-server-linux-overview?view=sql-server-linux-2017
[docs-traffic-manager]: /azure/traffic-manager/
[docs-azure-site-recovery]: /azure/site-recovery/azure-to-azure-quickstart/
[docs-availability-sets]: /azure/virtual-machines/windows/manage-availability/
[calculator]: https://azure.com/e/6835332265044d6d931d68c917979e6d/
