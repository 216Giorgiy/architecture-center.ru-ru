---
title: Безопасное веб-приложение Windows для отраслей с высокой степенью регулируемости
description: Проверенный сценарий для создания безопасного многоуровневого веб-приложения с использованием Windows Server в Azure, который использует масштабируемые наборы, Шлюз приложений и подсистемы балансировки нагрузки.
author: iainfoulds
ms.date: 07/11/2018
ms.openlocfilehash: aba714fc1955341645d0faa400768bc09fb8e50b
ms.sourcegitcommit: 71cbef121c40ef36e2d6e3a088cb85c4260599b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/14/2018
ms.locfileid: "39060995"
---
# <a name="secure-windows-web-application-for-regulated-industries"></a>Безопасное веб-приложение Windows для отраслей с высокой степенью регулируемости

Этот пример сценария применяется для отраслей с высокой степенью регулируемости, в которых требуется обеспечить защиту многоуровневых приложений. В этом случае интерфейсное приложение ASP.NET безопасно подключается к защищенному серверному кластеру Microsoft SQL Server.

Примеры сценариев приложений включают запуск приложений для операционной, назначение пациентов и ведения записей, а также для назначения рецептов и оформления заказов. В большинстве случаев организациям приходилось поддерживать устаревшие локальные приложения и службы для этих сценариев. Благодаря безопасному и масштабируемому способу развертывания этих приложений Windows Server в Azure организации могут модернизировать свои развертывания, снижая расходы на эксплуатацию и управление.

## <a name="related-use-cases"></a>Связанные варианты использования

Рассмотрите этот сценарий для следующих вариантов использования:

* Модернизация развертываний приложений в безопасной облачной среде.
* Уменьшение количества устаревших локальных средств управления приложениями и службами.
* Улучшение медицинского обслуживания и работы с пациентами с помощью новых платформ приложений.

## <a name="architecture"></a>Архитектура

![Обзор архитектуры компонентов Azure в многоуровневом приложении Windows Server для отраслей с высокой степенью регулируемости][architecture]

В этом сценарии рассматривается многоуровневое приложение для отраслей с высокой степенью регулируемости, использующее ASP.NET и Microsoft SQL Server. Данные передаются в сценарии следующим образом:

1. Пользователи получают доступ к встроенному приложению ASP.NET для отраслей с высокой степенью регулируемости через Шлюз приложений Azure.
2. Шлюз приложений распределяет трафик к экземплярам виртуальных машин в масштабируемом наборе виртуальных машин Azure.
3. Приложение ASP.NET подключается к кластеру Microsoft SQL Server на уровне сервера через подсистему балансировки нагрузки Azure. Эти внутренние экземпляры SQL Server находятся в отдельной виртуальной сети Azure, защищенной с помощью правил группы безопасности сети, которые ограничивают трафик.
4. Подсистема балансировки нагрузки распределяет трафик SQL Server к экземплярам виртуальных машин в другом масштабируемом наборе виртуальных машин.
5. Хранилище BLOB-объектов Azure выступает в роли облака-свидетеля для кластера SQL Server на внутреннем уровне.  Подключение из виртуальной сети осуществляется с помощью конечной точки службы виртуальной сети для службы хранилища Azure.

### <a name="components"></a>Компоненты

* [Шлюз приложений Azure][appgateway-docs] — это балансировщик нагрузки веб-трафика уровня 7, который поддерживает приложения и может распространять трафик на основе определенных правил маршрутизации. Шлюз приложений также может обрабатывать разгрузку SSL для улучшения производительности веб-сервера.
* [Виртуальная сеть Azure][vnet-docs] позволяет ресурсам (например, виртуальным машинам) обмениваться данными друг с другом через локальные сети и Интернет. Виртуальные сети обеспечивают изоляцию и сегментирование, фильтрацию и маршрутизацию трафика и позволяют устанавливать связь между расположениями. Две виртуальные сети в сочетании с соответствующими группами безопасности сети используются в этом сценарии для предоставления [сети периметра][dmz] и изоляции компонентов приложения. Пиринговая связь между виртуальными сетями соединяет вместе две сети.
* [Масштабируемые наборы виртуальных машин Azure][scaleset-docs] позволяют создавать и администрировать группы идентичных виртуальных машин с балансировкой нагрузки. Число экземпляров виртуальных машин может автоматически увеличиваться или уменьшаться в зависимости от спроса или по определенному расписанию. В этом сценарии используются два отдельных масштабируемых набора виртуальных машин — один для интерфейсных экземпляров приложений ASP.NET и один для внешних экземпляров виртуальных машин кластера SQL Server. Настройка требуемого состояния PowerShell (DSC) или расширение пользовательских скриптов Azure может использоваться для подготовки экземпляров виртуальных машин с необходимым программным обеспечением и параметрами конфигурации.
* [Группы безопасности сети Azure][nsg-docs] содержит список правил безопасности, которые разрешают или запрещают входящий и исходящий трафик в зависимости от IP-адреса источника или назначения, порта и протокола. Виртуальные сети в этом сценарии защищены с помощью правил группы безопасности сети, которые ограничивают поток трафика между компонентами приложения.
* [Azure Load Balancer][loadbalancer-docs] распределяет входящий трафик в соответствии с правилами и проверками работоспособности. Подсистема балансировки нагрузки обеспечивает низкую задержку и высокую пропускную способность, а также увеличение масштаба до миллионов потоков для всех приложений, которые используют протоколы TCP и UDP. В этом сценарии используется внутренний балансировщик нагрузки для распределения трафика на уровне интерфейсного приложения на сервер кластера SQL Server.
* [Хранилище BLOB-объектов Azure][cloudwitness-docs] действует как расположение облака-свидетеля для кластера SQL Server. Этот свидетель используется для кластерных операций и решений, требующих дополнительного голосования для определения кворума. Использование облака-свидетеля устраняет необходимость использования дополнительной виртуальной машины в качестве традиционного файлового ресурса-свидетеля.

### <a name="alternatives"></a>Альтернативные варианты

* *nix, windows можно легко заменить множеством других ОС, так как ничто в инфраструктуре не зависит от ОС.

* [SQL Server для Linux][sql-linux] можно заменить серверным хранилищем данных.

* [Cosmos DB][cosmos] является другой альтернативой хранилищу данных.

## <a name="considerations"></a>Рекомендации

### <a name="availability"></a>Доступность

Экземпляры виртуальных машин в этом сценарии развертываются в Зоны доступности. Каждая зона состоит из одного или нескольких центров обработки данных, оснащенных независимыми системами электроснабжения, охлаждения и сетевого взаимодействия. Как минимум три зоны доступны во всех включенных регионах. Такое распределение экземпляров виртуальной машины в разных зонах обеспечивает высокую степень доступности для уровней приложений. Дополнительные сведения о том, что такое Зоны доступности, см. в [этой статье][azureaz-docs].

Уровень базы данных можно настроить для использования групп доступности Always On. Если в такой конфигурации SQL Server настроен с одной базой данных-источником в кластере, то он может иметь до восьми баз данных-получателей. Если в базе данных-источнике возникла проблема, кластер выполнит отработку отказа в одну из баз данных-получателей, что позволяет приложению оставаться доступным. Дополнительные сведения см. в статье [Обзор групп доступности AlwaysOn (SQL Server)][sqlalwayson-docs].

Дополнительные сведения по другим вопросам масштабируемости см. в разделе [с контрольным списком для обеспечения доступности][availability] в Центре архитектуры Azure.

### <a name="scalability"></a>Масштабируемость

В этом сценарии используются масштабируемые наборы виртуальных машин для внешнего и внутреннего компонентов. При использовании масштабируемых наборов количество экземпляров виртуальных машин, работающих на уровне интерфейсных приложений, можно автоматически масштабировать в ответ на потребности клиента или на основе определенного расписания. Дополнительные сведения см. в статье [Обзор автомасштабирования с помощью масштабируемых наборов виртуальных машин Azure][vmssautoscale-docs].

Другие вопросы по масштабируемости см. в [контрольном списке для обеспечения масштабируемости][scalability] в Центре архитектуры Azure.

### <a name="security"></a>Безопасность

Весь трафик виртуальных сетей на уровне интерфейсного приложения защищен группами безопасности сети. Правила ограничивают поток трафика, так что экземпляры виртуальных машин уровня интерфейсного приложения могут получить доступ к уровню серверной базы данных. С уровня базы данных запрещено передавать исходящий интернет-трафик. Чтобы сократить площади атаки, прямые порты удаленного управления остаются закрытыми. Дополнительные сведения см. в статье [Группы безопасности приложений и сети][nsg-docs].

Просмотрите рекомендации по развертыванию инфраструктуры в соответствии со [стандартами безопасности данных в индустрии платежных карт (PCI DSS 3.2)][pci-dss]. Общие рекомендации по разработке безопасных сценариев см. в статье [Документация по системе безопасности Azure][security].

### <a name="resiliency"></a>Устойчивость

В сочетании с использованием Зон доступности и масштабируемых наборов виртуальных машин в этом сценарии используется Шлюз приложений Azure и балансировка нагрузки. Эти два сетевых компонента распространяют трафик на подключенные экземпляры виртуальной машины и включают проверки работоспособности, которые гарантируют, что трафик распространяется только на работоспособные виртуальные машины. Два экземпляра Шлюза приложений настроены в конфигурации "активный — пассивный", а также используется подсистема балансировки нагрузки, избыточная в пределах зоны. Эта конфигурация делает сетевые ресурсы и приложение устойчивыми к проблемам, которые в противном случае нарушали бы трафик и влияли бы на доступ пользователя.

Общие рекомендации по разработке устойчивых решений см. в [этой статье][resiliency].

## <a name="deploy-the-scenario"></a>Развертывание сценария

**Предварительные требования**

* Необходимо иметь учетную запись Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.
* Чтобы развернуть кластер SQL Server в серверном масштабируемом наборе, требуется домен Active Directory Services.

Чтобы развернуть базовую инфраструктуру для этого сценария с помощью шаблона Azure Resource Manager, выполните следующие действия.

1. Выберите **Развертывание в Azure**:<br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Fsolution-architectures%2Fmaster%2Finfrastructure%2Fregulated-multitier-app%2Fazuredeploy.json" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>
2. Подождите, пока откроется развертывание шаблона на портале Azure, а затем выполните следующие шаги.
   * Выберите **Создать** группу ресурсов, а затем укажите в текстовом поле имя, например *myWindowsscenario*.
   * В раскрывающемся списке **Расположение** выберите регион.
   * Укажите имя пользователя и надежный пароль для экземпляров масштабируемых наборов виртуальных машин.
   * Прочтите условия использования и установите флажок **Я принимаю указанные выше условия**.
   * Нажмите кнопку **Приобрести**.

Развертывание может занять 15-20 мин.

## <a name="pricing"></a>Цены

Чтобы изучить стоимость выполнения этого сценария, все услуги были предварительно сконфигурированы в калькуляторе стоимости.  Чтобы узнать, как изменится цена для вашего конкретного варианта использования, измените соответствующие переменные в соответствии с ожидаемым трафиком.

Мы предоставили три примера профилей затрат, основанных на количестве экземпляров масштабируемых наборов виртуальных машин для запуска приложений.

* [Небольшой][small-pricing]. Коррелирует с двумя внешними и двумя внутренними экземплярами виртуальной машины.
* [Средний.][medium-pricing]. Коррелирует с 20 внешними и 5 внутренними экземплярами виртуальной машины.
* [Большой.][large-pricing]. Коррелирует со 100 внешними и 10 внутренними экземплярами виртуальной машины.

## <a name="related-resources"></a>Связанные ресурсы

В этом сценарий использовался серверный масштабируемый набор виртуальных машин, в котором выполнялся кластер Microsoft SQL Server. Azure Cosmos DB также может использоваться в качестве масштабируемого безопасного уровня базы данных для данных приложения. [Конечные точки виртуальной сети Azure][vnetendpoint-docs] позволяют защищать критически важные ресурсы служб Azure в пределах отдельных виртуальных сетей. В этом сценарии конечные точки виртуальной сети позволят обеспечить безопасность трафика между уровнем интерфейсного приложения и Cosmos DB. Дополнительные сведения о Cosmos DB см. в статье [Добро пожаловать в базу данных Azure Cosmos DB][azurecosmosdb-docs].

Кроме того, вы можете просмотреть [эталонную архитектуру для N-уровневого приложения с SQL Server][ntiersql-ra].

<!-- links -->
[appgateway-docs]: /azure/application-gateway/overview
[architecture]: ./media/regulated-multitier-app/architecture-regulated-multitier-app.png
[autoscaling]: /azure/architecture/best-practices/auto-scaling
[availability]: /architecture/checklist/availability
[azureaz-docs]: /azure/availability-zones/az-overview
[azurecosmosdb-docs]: /azure/cosmos-db/introduction
[cloudwitness-docs]: /windows-server/failover-clustering/deploy-cloud-witness
[loadbalancer-docs]: /azure/load-balancer/load-balancer-overview
[nsg-docs]: /azure/virtual-network/security-overview
[ntiersql-ra]: /azure/architecture/reference-architectures/n-tier/n-tier-sql-server
[resiliency]: /azure/architecture/resiliency/ 
[security]: /azure/security/
[scalability]: /azure/architecture/checklist/scalability 
[scaleset-docs]: /azure/virtual-machine-scale-sets/overview
[sqlalwayson-docs]: /sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server
[vmssautoscale-docs]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview
[vnet-docs]: /azure/virtual-network/virtual-networks-overview
[vnetendpoint-docs]: /azure/virtual-network/virtual-network-service-endpoints-overview
[pci-dss]: /azure/security/blueprints/pcidss-iaaswa-overview
[dmz]: /azure/virtual-network/virtual-networks-dmz-nsg
[cosmos]: /azure/cosmos-db/
[sql-linux]: /sql/linux/sql-server-linux-overview?view=sql-server-linux-2017

[small-pricing]: https://azure.com/e/711bbfcbbc884ef8aa91cdf0f2caff72
[medium-pricing]: https://azure.com/e/b622d82d79b34b8398c4bce35477856f
[large-pricing]: https://azure.com/e/1d99d8b92f90496787abecffa1473a93