---
title: Конвейер CI/CD для рабочих нагрузок на основе контейнера
titleSuffix: Azure Example Scenarios
description: Создание конвейера DevOps для веб-приложения Node.js, который использует Jenkins, Реестр контейнеров Azure, Службу Azure Kubernetes, Cosmos DB и Grafana.
author: iainfoulds
ms.date: 07/05/2018
ms.topic: example-scenario
ms.service: architecture-center
ms.subservice: example-scenario
social_image_url: /azure/architecture/example-scenario/apps/media/architecture-devops-with-aks.png
ms.openlocfilehash: 89e50e67b2c933637442f0f01bf83ecc95743691
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2019
ms.locfileid: "58244035"
---
# <a name="cicd-pipeline-for-container-based-workloads"></a><span data-ttu-id="f0b47-103">Конвейер CI/CD для рабочих нагрузок на основе контейнера</span><span class="sxs-lookup"><span data-stu-id="f0b47-103">CI/CD pipeline for container-based workloads</span></span>

<span data-ttu-id="f0b47-104">Пример этого сценария применим к компаниям, которые хотят модернизировать разработку приложений, используя контейнеры и рабочие процессы DevOps.</span><span class="sxs-lookup"><span data-stu-id="f0b47-104">This example scenario is applicable to businesses that want to modernize application development by using containers and DevOps workflows.</span></span> <span data-ttu-id="f0b47-105">В этом сценарии веб-приложение Node.js создано и развернуто с помощью Jenkins в Реестре контейнеров Azure и Службе Azure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="f0b47-105">In this scenario, a Node.js web app is built and deployed by Jenkins into an Azure Container Registry and Azure Kubernetes Service.</span></span> <span data-ttu-id="f0b47-106">Azure Cosmos DB используется для уровня глобально распределенной базы данных.</span><span class="sxs-lookup"><span data-stu-id="f0b47-106">For a globally distributed database tier, Azure Cosmos DB is used.</span></span> <span data-ttu-id="f0b47-107">Для отслеживания и устранения неполадок с производительностью приложения, Azure Monitor интегрируется с экземпляром Grafana и панелью мониторинга.</span><span class="sxs-lookup"><span data-stu-id="f0b47-107">To monitor and troubleshoot application performance, Azure Monitor integrates with a Grafana instance and dashboard.</span></span>

<span data-ttu-id="f0b47-108">Примеры сценариев приложений включают предоставление автоматизированной среды разработки, проверку новых фиксаций кода и отправку новых развертываний в промежуточную или производственную среду.</span><span class="sxs-lookup"><span data-stu-id="f0b47-108">Example application scenarios include providing an automated development environment, validating new code commits, and pushing new deployments into staging or production environments.</span></span> <span data-ttu-id="f0b47-109">Обычно компаниям приходилось вручную создавать и компилировать приложения и обновления, а также поддерживать большую монолитную базу кода.</span><span class="sxs-lookup"><span data-stu-id="f0b47-109">Traditionally, businesses had to manually build and compile applications and updates, and maintain a large, monolithic code base.</span></span> <span data-ttu-id="f0b47-110">Благодаря современному подходу к разработке приложений, который использует непрерывную интеграцию (CI) и непрерывное развертывание (CD), вы можете быстрее создавать, тестировать и развертывать службы.</span><span class="sxs-lookup"><span data-stu-id="f0b47-110">With a modern approach to application development that uses continuous integration (CI) and continuous deployment (CD), you can more quickly build, test, and deploy services.</span></span> <span data-ttu-id="f0b47-111">Этот современный подход позволяет быстрее выпускать приложения и обновления для ваших клиентов и более гибко реагировать на меняющиеся требования компаний.</span><span class="sxs-lookup"><span data-stu-id="f0b47-111">This modern approach lets you release applications and updates to your customers faster, and respond to changing business demands in a more agile manner.</span></span>

<span data-ttu-id="f0b47-112">Используя такие службы Azure, как служба контейнеров Azure, реестр контейнеров Azure и Cosmos DB, компании могут использовать новейшие технологии разработки приложений и инструменты для упрощения процесса реализации высокого уровня доступности.</span><span class="sxs-lookup"><span data-stu-id="f0b47-112">By using Azure services such as Azure Kubernetes Service, Container Registry, and Cosmos DB, companies can use the latest in application development techniques and tools to simplify the process of implementing high availability.</span></span>

## <a name="relevant-use-cases"></a><span data-ttu-id="f0b47-113">Варианты соответствующего использования</span><span class="sxs-lookup"><span data-stu-id="f0b47-113">Relevant use cases</span></span>

<span data-ttu-id="f0b47-114">Другие варианты использования:</span><span class="sxs-lookup"><span data-stu-id="f0b47-114">Other relevant use cases include:</span></span>

- <span data-ttu-id="f0b47-115">Модернизация разработки приложений с помощью микрослужб на основе контейнерного подхода.</span><span class="sxs-lookup"><span data-stu-id="f0b47-115">Modernizing application development practices to a microservice, container-based approach.</span></span>
- <span data-ttu-id="f0b47-116">Ускорение разработки приложений и развертывание жизненных циклов.</span><span class="sxs-lookup"><span data-stu-id="f0b47-116">Speeding up application development and deployment lifecycles.</span></span>
- <span data-ttu-id="f0b47-117">Автоматизация развертываний для тестирования или принятие среды для проверки.</span><span class="sxs-lookup"><span data-stu-id="f0b47-117">Automating deployments to test or acceptance environments for validation.</span></span>

## <a name="architecture"></a><span data-ttu-id="f0b47-118">Архитектура</span><span class="sxs-lookup"><span data-stu-id="f0b47-118">Architecture</span></span>

![Общие сведения об архитектуре компонентов Azure, которые используются для сценария DevOps с применением Jenkins, Реестра контейнеров Azure и Службы Azure Kubernetes][architecture]

<span data-ttu-id="f0b47-120">Этот сценарий охватывает конвейер DevOps для веб-приложения Node.js и серверную часть базы данных.</span><span class="sxs-lookup"><span data-stu-id="f0b47-120">This scenario covers a DevOps pipeline for a Node.js web application and database back end.</span></span> <span data-ttu-id="f0b47-121">Данные передаются в сценарии следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f0b47-121">The data flows through the scenario as follows:</span></span>

1. <span data-ttu-id="f0b47-122">Разработчик вносит изменения в исходный код веб-приложения Node.js.</span><span class="sxs-lookup"><span data-stu-id="f0b47-122">A developer makes changes to the Node.js web application source code.</span></span>
2. <span data-ttu-id="f0b47-123">Изменение кода фиксируется в репозитории управления исходным кодом, например, GitHub.</span><span class="sxs-lookup"><span data-stu-id="f0b47-123">The code change is committed to a source control repository, such as GitHub.</span></span>
3. <span data-ttu-id="f0b47-124">Чтобы начать процесс непрерывной интеграции (CI), веб-перехватчик GitHub активирует сборку проекта Jenkins.</span><span class="sxs-lookup"><span data-stu-id="f0b47-124">To start the continuous integration (CI) process, a GitHub webhook triggers a Jenkins project build.</span></span>
4. <span data-ttu-id="f0b47-125">Задача сборки Jenkins использует агента динамической сборки в службе контейнеров Azure для выполнения процесса сборки контейнера.</span><span class="sxs-lookup"><span data-stu-id="f0b47-125">The Jenkins build job uses a dynamic build agent in Azure Kubernetes Service to perform a container build process.</span></span>
5. <span data-ttu-id="f0b47-126">Образ контейнера создается из кода в системе управления версиями, а потом отправляется в реестр контейнеров Azure.</span><span class="sxs-lookup"><span data-stu-id="f0b47-126">A container image is created from the code in source control, and is then pushed to an Azure Container Registry.</span></span>
6. <span data-ttu-id="f0b47-127">С помощью непрерывного развертывания (CD) Jenkins развертывает этот обновленный образ контейнера в кластер Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="f0b47-127">Through continuous deployment (CD), Jenkins deploys this updated container image to the Kubernetes cluster.</span></span>
7. <span data-ttu-id="f0b47-128">Веб-приложение Node.js использует Cosmos DB в качестве серверной части.</span><span class="sxs-lookup"><span data-stu-id="f0b47-128">The Node.js web application uses Cosmos DB as its back end.</span></span> <span data-ttu-id="f0b47-129">И Cosmos DB, и служба контейнеров Azure посылают отчеты метрик в Azure Monitor.</span><span class="sxs-lookup"><span data-stu-id="f0b47-129">Both Cosmos DB and Azure Kubernetes Service report metrics to Azure Monitor.</span></span>
8. <span data-ttu-id="f0b47-130">Экземпляр Grafana предоставляет визуальные панели мониторинга производительности приложения на основе данных Azure Monitor.</span><span class="sxs-lookup"><span data-stu-id="f0b47-130">A Grafana instance provides visual dashboards of the application performance based on the data from Azure Monitor.</span></span>

### <a name="components"></a><span data-ttu-id="f0b47-131">Компоненты</span><span class="sxs-lookup"><span data-stu-id="f0b47-131">Components</span></span>

- <span data-ttu-id="f0b47-132">[Jenkins][jenkins] — это сервер автоматизации с открытым исходным кодом, который легко интегрируется со службами Azure для обеспечения непрерывной интеграции (CI) и непрерывного развертывания (CD).</span><span class="sxs-lookup"><span data-stu-id="f0b47-132">[Jenkins][jenkins] is an open-source automation server that can integrate with Azure services to enable continuous integration (CI) and continuous deployment (CD).</span></span> <span data-ttu-id="f0b47-133">В этом сценарии Jenkins оркестрирует создание образов контейнеров на основе фиксаций для управления исходным кодом, отправляет эти образы в Реестр контейнеров Azure, а затем обновляет экземпляры приложений в Службе Azure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="f0b47-133">In this scenario, Jenkins orchestrates the creation of new container images based on commits to source control, pushes those images to Azure Container Registry, then updates application instances in Azure Kubernetes Service.</span></span>
- <span data-ttu-id="f0b47-134">[Виртуальные машины Linux Azure][docs-virtual-machines] — это платформа IaaS для запуска экземпляров Jenkins и Grafana.</span><span class="sxs-lookup"><span data-stu-id="f0b47-134">[Azure Linux Virtual Machines][docs-virtual-machines] is the IaaS platform used to run the Jenkins and Grafana instances.</span></span>
- <span data-ttu-id="f0b47-135">[Реестр контейнеров Azure][docs-acr] хранит данные и управляет образами контейнеров, которые использует кластер службы контейнеров Azure.</span><span class="sxs-lookup"><span data-stu-id="f0b47-135">[Azure Container Registry][docs-acr] stores and manages container images that are used by the Azure Kubernetes Service cluster.</span></span> <span data-ttu-id="f0b47-136">Изображения надежно сохранены и могут быть реплицированы платформой Azure в другие регионы для ускорения развертывания.</span><span class="sxs-lookup"><span data-stu-id="f0b47-136">Images are securely stored, and can be replicated to other regions by the Azure platform to speed up deployment times.</span></span>
- <span data-ttu-id="f0b47-137">[Служба контейнеров Azure][docs-aks] управляет платформой Kubernetes, которая позволяет быстро и легко развертывать контейнерные приложения и управлять ими, даже если вы никогда не оркестрировали контейнеры.</span><span class="sxs-lookup"><span data-stu-id="f0b47-137">[Azure Kubernetes Service][docs-aks] is a managed Kubernetes platform that lets you deploy and manage containerized applications without container orchestration expertise.</span></span> <span data-ttu-id="f0b47-138">Размещенная в Azure служба Kubernetes отвечает за критические задачи, в частности за мониторинг работоспособности и техническое обслуживание.</span><span class="sxs-lookup"><span data-stu-id="f0b47-138">As a hosted Kubernetes service, Azure handles critical tasks like health monitoring and maintenance for you.</span></span>
- <span data-ttu-id="f0b47-139">[Azure Cosmos DB][docs-cosmos-db] — это глобально распределенная, многомодельная база данных, в которой можно выбрать различные модели баз данных и согласованности в соответствии с потребностями.</span><span class="sxs-lookup"><span data-stu-id="f0b47-139">[Azure Cosmos DB][docs-cosmos-db] is a globally distributed, multi-model database that allows you to choose from various database and consistency models to suit your needs.</span></span> <span data-ttu-id="f0b47-140">С помощью базы данных Cosmos DB можно глобально реплицировать данные при отсутствии компонентов управления кластерами или репликации для развертывания и настройки.</span><span class="sxs-lookup"><span data-stu-id="f0b47-140">With Cosmos DB, your data can be globally replicated, and there is no cluster management or replication components to deploy and configure.</span></span>
- <span data-ttu-id="f0b47-141">[Azure Monitor][docs-azure-monitor] помогает отслеживать производительность, обеспечивать безопасность и определять тенденции.</span><span class="sxs-lookup"><span data-stu-id="f0b47-141">[Azure Monitor][docs-azure-monitor] helps you track performance, maintain security, and identify trends.</span></span> <span data-ttu-id="f0b47-142">Метрики, полученные с помощью Monitor, могут использоваться другими ресурсами и инструментами, например Grafana.</span><span class="sxs-lookup"><span data-stu-id="f0b47-142">Metrics obtained by Monitor can be used by other resources and tools, such as Grafana.</span></span>
- <span data-ttu-id="f0b47-143">[Grafana][grafana] — это решение с открытым исходным кодом для запросов, визуализации, оповещения и понимания метрики.</span><span class="sxs-lookup"><span data-stu-id="f0b47-143">[Grafana][grafana] is an open-source solution to query, visualize, alert, and understand metrics.</span></span> <span data-ttu-id="f0b47-144">Подключаемый модуль источника данных для Azure Monitor позволяет Grafana создавать визуальные панели мониторинга для наблюдения за производительностью приложений в службе контейнеров Azure и с помощью Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="f0b47-144">A data source plugin for Azure Monitor allows Grafana to create visual dashboards to monitor the performance of your applications running in Azure Kubernetes Service and using Cosmos DB.</span></span>

### <a name="alternatives"></a><span data-ttu-id="f0b47-145">Альтернативные варианты</span><span class="sxs-lookup"><span data-stu-id="f0b47-145">Alternatives</span></span>

- <span data-ttu-id="f0b47-146">[Azure Pipelines][azure-pipelines] помогают внедрять конвейер непрерывной интеграции (CI), тестирования и развертывания (CD) для любого приложения.</span><span class="sxs-lookup"><span data-stu-id="f0b47-146">[Azure Pipelines][azure-pipelines] help you implement a continuous integration (CI), test, and deployment (CD) pipeline for any app.</span></span>
- <span data-ttu-id="f0b47-147">Если необходимо больше контроля над кластером, [Kubernetes][kubernetes] можно запускать непосредственно на виртуальных машинах Azure, а не через управляемую службу.</span><span class="sxs-lookup"><span data-stu-id="f0b47-147">[Kubernetes][kubernetes] can be run directly on Azure VMs instead of via a managed service if you would like more control over the cluster.</span></span>
- <span data-ttu-id="f0b47-148">[Service Fabric][service-fabric] — другой альтернативный оркестратор контейнеров, который может заменить AKS.</span><span class="sxs-lookup"><span data-stu-id="f0b47-148">[Service Fabric][service-fabric] is another alternate container orchestrator that can replace AKS.</span></span>

## <a name="considerations"></a><span data-ttu-id="f0b47-149">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="f0b47-149">Considerations</span></span>

### <a name="availability"></a><span data-ttu-id="f0b47-150">Доступность</span><span class="sxs-lookup"><span data-stu-id="f0b47-150">Availability</span></span>

<span data-ttu-id="f0b47-151">Этот сценарий сочетает в себе Azure Monitor и Grafana, чтобы контролировать производительность вашего приложения и сообщать о проблемах.</span><span class="sxs-lookup"><span data-stu-id="f0b47-151">To monitor your application performance and report on issues, this scenario combines Azure Monitor with Grafana for visual dashboards.</span></span> <span data-ttu-id="f0b47-152">Эти инструменты позволяют отслеживать и устранять проблемы с производительностью, которые могут потребовать обновления кода, которые можно затем развернуть в конвейер CI/CD.</span><span class="sxs-lookup"><span data-stu-id="f0b47-152">These tools let you monitor and troubleshoot performance issues that may require code updates, which can all then be deployed with the CI/CD pipeline.</span></span>

<span data-ttu-id="f0b47-153">Как часть кластера службы контейнеров Azure, подсистема балансировки нагрузки распределяет трафик приложения в один или несколько контейнеров (pods), которые запускают приложение.</span><span class="sxs-lookup"><span data-stu-id="f0b47-153">As part of the Azure Kubernetes Service cluster, a load balancer distributes application traffic to one or more containers (pods) that run your application.</span></span> <span data-ttu-id="f0b47-154">Такой подход к запуску контейнерных приложений в Kubernetes обеспечивает клиентам высокодоступную инфраструктуру.</span><span class="sxs-lookup"><span data-stu-id="f0b47-154">This approach to running containerized applications in Kubernetes provides a highly available infrastructure for your customers.</span></span>

<span data-ttu-id="f0b47-155">Сведения о доступности см. в статье [Контрольный список для обеспечения доступности][availability] в Центре архитектуры Azure.</span><span class="sxs-lookup"><span data-stu-id="f0b47-155">For other availability topics, see the [availability checklist][availability] available in the Azure Architecture Center.</span></span>

### <a name="scalability"></a><span data-ttu-id="f0b47-156">Масштабируемость</span><span class="sxs-lookup"><span data-stu-id="f0b47-156">Scalability</span></span>

<span data-ttu-id="f0b47-157">Служба контейнеров Azure позволяет масштабировать число узлов кластера в соответствии с требованиями приложений.</span><span class="sxs-lookup"><span data-stu-id="f0b47-157">Azure Kubernetes Service lets you scale the number of cluster nodes to meet the demands of your applications.</span></span> <span data-ttu-id="f0b47-158">По мере увеличения приложения можно развернуть количество узлов Kubernetes, которые запускают службу.</span><span class="sxs-lookup"><span data-stu-id="f0b47-158">As your application increases, you can scale out the number of Kubernetes nodes that run your service.</span></span>

<span data-ttu-id="f0b47-159">Данные приложения хранятся в базе данных Azure Cosmos DB — глобально распределенной, многомодельной базе данных, которая может глобально масштабироваться.</span><span class="sxs-lookup"><span data-stu-id="f0b47-159">Application data is stored in Azure Cosmos DB, a globally distributed, multi-model database that can scale globally.</span></span> <span data-ttu-id="f0b47-160">Cosmos DB абстрагирует необходимость масштабирования инфраструктуры, как с обычными компонентами базы данных, и можно глобально реплицировать Cosmos DB для удовлетворения потребностей клиентов.</span><span class="sxs-lookup"><span data-stu-id="f0b47-160">Cosmos DB abstracts the need to scale your infrastructure as with traditional database components, and you can choose to replicate your Cosmos DB globally to meet the demands of your customers.</span></span>

<span data-ttu-id="f0b47-161">Сведения о масштабируемости см. в статье [Контрольный список для обеспечения масштабируемости][scalability] в Центре архитектуры Azure.</span><span class="sxs-lookup"><span data-stu-id="f0b47-161">For other scalability topics, see the [scalability checklist][scalability] available in the Azure Architecture Center.</span></span>

### <a name="security"></a><span data-ttu-id="f0b47-162">Безопасность</span><span class="sxs-lookup"><span data-stu-id="f0b47-162">Security</span></span>

<span data-ttu-id="f0b47-163">Чтобы минимизировать площадь атаки, эти сценарии не предоставляют экземпляр виртуальной машины Jenkins по HTTP.</span><span class="sxs-lookup"><span data-stu-id="f0b47-163">To minimize the attack footprint, this scenario does not expose the Jenkins VM instance over HTTP.</span></span> <span data-ttu-id="f0b47-164">Для любых задач управления, требующих взаимодействия с Jenkins, необходимо создать безопасное удаленное соединение с использованием туннеля SSH на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="f0b47-164">For any management tasks that require you to interact with Jenkins, you create a secure remote connection using an SSH tunnel from your local machine.</span></span> <span data-ttu-id="f0b47-165">Для экземпляров виртуальных машин Jenkins и Grafana аутентификацию можно провести только с помощью открытого ключа SSH.</span><span class="sxs-lookup"><span data-stu-id="f0b47-165">Only SSH public key authentication is allowed for the Jenkins and Grafana VM instances.</span></span> <span data-ttu-id="f0b47-166">Вход по паролю отключенный.</span><span class="sxs-lookup"><span data-stu-id="f0b47-166">Password-based logins are disabled.</span></span> <span data-ttu-id="f0b47-167">Для получения дополнительных сведений см. [Запуск сервера Jenkins в Azure](../../reference-architectures/jenkins/index.md).</span><span class="sxs-lookup"><span data-stu-id="f0b47-167">For more information, see [Run a Jenkins server on Azure](../../reference-architectures/jenkins/index.md).</span></span>

<span data-ttu-id="f0b47-168">Этот сценарий использует специальный субъект-службу Azure Active Directory (AD) для разделения учетных данных и разрешений.</span><span class="sxs-lookup"><span data-stu-id="f0b47-168">For separation of credentials and permissions, this scenario uses a dedicated Azure Active Directory (AD) service principal.</span></span> <span data-ttu-id="f0b47-169">Учетные данные этого субъекта-службы хранятся в Jenkins в качестве защищенного объекта учетных данных, так что они не отображаются напрямую и не видны внутри сценариев или конвейера сборки.</span><span class="sxs-lookup"><span data-stu-id="f0b47-169">The credentials for this service principal are stored as a secure credential object in Jenkins so that they are not directly exposed and visible within scripts or the build pipeline.</span></span>

<span data-ttu-id="f0b47-170">Общие рекомендации по разработке безопасных решений см. в разделе [Azure Security Documentation][security].</span><span class="sxs-lookup"><span data-stu-id="f0b47-170">For general guidance on designing secure solutions, see the [Azure Security Documentation][security].</span></span>

### <a name="resiliency"></a><span data-ttu-id="f0b47-171">Устойчивость</span><span class="sxs-lookup"><span data-stu-id="f0b47-171">Resiliency</span></span>

<span data-ttu-id="f0b47-172">Этот сценарий использует Службу Azure Kubernetes для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="f0b47-172">This scenario uses Azure Kubernetes Service for your application.</span></span> <span data-ttu-id="f0b47-173">В Kubernetes встроены компоненты отказоустойчивости, которые отслеживаются и, в случае проблемы, перезапускают контейнеры (pods).</span><span class="sxs-lookup"><span data-stu-id="f0b47-173">Built into Kubernetes are resiliency components that monitor and restart the containers (pods) if there is an issue.</span></span> <span data-ttu-id="f0b47-174">В сочетании с процедурой запуска нескольких узлов Kubernetes, приложение может допускать отключенный модуль или узел.</span><span class="sxs-lookup"><span data-stu-id="f0b47-174">Combined with running multiple Kubernetes nodes, your application can tolerate a pod or node being unavailable.</span></span>

<span data-ttu-id="f0b47-175">Общее руководство по проектированию устойчивых решений см. в разделе [Проектирование устойчивых приложений для Azure][resiliency].</span><span class="sxs-lookup"><span data-stu-id="f0b47-175">For general guidance on designing resilient solutions, see [Designing resilient applications for Azure][resiliency].</span></span>

## <a name="deploy-the-scenario"></a><span data-ttu-id="f0b47-176">Развертывание сценария</span><span class="sxs-lookup"><span data-stu-id="f0b47-176">Deploy the scenario</span></span>

### <a name="prerequisites"></a><span data-ttu-id="f0b47-177">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="f0b47-177">Prerequisites</span></span>

- <span data-ttu-id="f0b47-178">Необходимо иметь учетную запись Azure.</span><span class="sxs-lookup"><span data-stu-id="f0b47-178">You must have an existing Azure account.</span></span> <span data-ttu-id="f0b47-179">Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.</span><span class="sxs-lookup"><span data-stu-id="f0b47-179">If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) before you begin.</span></span>

- <span data-ttu-id="f0b47-180">Вам потребуется открытая пара ключей SSH.</span><span class="sxs-lookup"><span data-stu-id="f0b47-180">You need an SSH public key pair.</span></span> <span data-ttu-id="f0b47-181">Дополнительные сведения относительно пошагового создания открытой пары ключей см. в статье [Краткая инструкция: создание и использование пары из открытого и закрытого ключей SSH для виртуальных машин Linux в Azure][sshkeydocs].</span><span class="sxs-lookup"><span data-stu-id="f0b47-181">For steps on how to create a public key pair, see [Create and use an SSH key pair for Linux VMs][sshkeydocs].</span></span>

- <span data-ttu-id="f0b47-182">Для проверки подлинности службы и ресурсов требуется субъект-служба Azure Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="f0b47-182">You need an Azure Active Directory (AD) service principal for the authentication of service and resources.</span></span> <span data-ttu-id="f0b47-183">Если необходимо, создайте субъект-службу с помощью команды [az ad sp create-for-rbac][createsp]</span><span class="sxs-lookup"><span data-stu-id="f0b47-183">If needed, you can create a service principal with [az ad sp create-for-rbac][createsp]</span></span>

    ```azurecli-interactive
    az ad sp create-for-rbac --name myDevOpsScenario
    ```

    <span data-ttu-id="f0b47-184">Запишите значения параметров *appId* и *password* на выходе этой команды.</span><span class="sxs-lookup"><span data-stu-id="f0b47-184">Make a note of the *appId* and *password* in the output from this command.</span></span> <span data-ttu-id="f0b47-185">При развертывании сценария необходимо ввести эти значения в шаблон.</span><span class="sxs-lookup"><span data-stu-id="f0b47-185">You provide these values to the template when you deploy the scenario.</span></span>

### <a name="walk-through"></a><span data-ttu-id="f0b47-186">Пошаговое руководство</span><span class="sxs-lookup"><span data-stu-id="f0b47-186">Walk-through</span></span>

<span data-ttu-id="f0b47-187">Чтобы развернуть сценарий с помощью шаблона Azure Resource Manager, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="f0b47-187">To deploy this scenario with an Azure Resource Manager template, perform the following steps.</span></span>

<!-- markdownlint-disable MD033 -->

1. <span data-ttu-id="f0b47-188">Нажмите кнопку **Развертывание в Azure**.</span><span class="sxs-lookup"><span data-stu-id="f0b47-188">Click the **Deploy to Azure** button:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Fsolution-architectures%2Fmaster%2Fapps%2Fdevops-with-aks%2Fazuredeploy.json" target="_blank"><img src="https://azuredeploy.net/deploybutton.png"/></a>
2. <span data-ttu-id="f0b47-189">Подождите, пока откроется развертывание шаблона на портале Azure, а затем выполните следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="f0b47-189">Wait for the template deployment to open in the Azure portal, then complete the following steps:</span></span>
   - <span data-ttu-id="f0b47-190">Выберите **Создать** группу ресурсов, а затем укажите в текстовом поле имя, например *myAKSDevOpsScenario*.</span><span class="sxs-lookup"><span data-stu-id="f0b47-190">Choose to **Create new** resource group, then provide a name such as *myAKSDevOpsScenario* in the text box.</span></span>
   - <span data-ttu-id="f0b47-191">В раскрывающемся списке **Расположение** выберите регион.</span><span class="sxs-lookup"><span data-stu-id="f0b47-191">Select a region from the **Location** drop-down box.</span></span>
   - <span data-ttu-id="f0b47-192">Введите идентификатор приложения субъекта-службы и пароль из команды `az ad sp create-for-rbac`.</span><span class="sxs-lookup"><span data-stu-id="f0b47-192">Enter your service principal app ID and password from the `az ad sp create-for-rbac` command.</span></span>
   - <span data-ttu-id="f0b47-193">Укажите имя пользователя и надежный пароль для экземпляра Jenkins и консоли Grafana.</span><span class="sxs-lookup"><span data-stu-id="f0b47-193">Provide a username and secure password for the Jenkins instance and Grafana console.</span></span>
   - <span data-ttu-id="f0b47-194">Укажите ключ SSH для защиты имен при входе в виртуальные машины Linux.</span><span class="sxs-lookup"><span data-stu-id="f0b47-194">Provide an SSH key to secure logins to the Linux VMs.</span></span>
   - <span data-ttu-id="f0b47-195">Прочтите условия использования и установите флажок **Я принимаю указанные выше условия**.</span><span class="sxs-lookup"><span data-stu-id="f0b47-195">Review the terms and conditions, then check **I agree to the terms and conditions stated above**.</span></span>
   - <span data-ttu-id="f0b47-196">Нажмите кнопку **Приобрести**.</span><span class="sxs-lookup"><span data-stu-id="f0b47-196">Select the **Purchase** button.</span></span>

<!-- markdownlint-enable MD033 -->

<span data-ttu-id="f0b47-197">Развертывание может занять 15-20 мин.</span><span class="sxs-lookup"><span data-stu-id="f0b47-197">It can take 15-20 minutes for the deployment to complete.</span></span>

## <a name="pricing"></a><span data-ttu-id="f0b47-198">Цены</span><span class="sxs-lookup"><span data-stu-id="f0b47-198">Pricing</span></span>

<span data-ttu-id="f0b47-199">Чтобы изучить стоимость выполнения этого сценария, все услуги были предварительно сконфигурированы в калькуляторе стоимости.</span><span class="sxs-lookup"><span data-stu-id="f0b47-199">To explore the cost of running this scenario, all of the services are pre-configured in the cost calculator.</span></span> <span data-ttu-id="f0b47-200">Чтобы узнать, как изменится цена для вашего конкретного варианта использования, измените соответствующие переменные в соответствии с ожидаемым трафиком.</span><span class="sxs-lookup"><span data-stu-id="f0b47-200">To see how the pricing would change for your particular use case, change the appropriate variables to match your expected traffic.</span></span>

<span data-ttu-id="f0b47-201">Мы предоставили три примера профилей затрат, основанных на количестве образов контейнеров для хранения и узлов Kubernetes для запуска приложений.</span><span class="sxs-lookup"><span data-stu-id="f0b47-201">We have provided three sample cost profiles based on the number of container images to store and Kubernetes nodes to run your applications.</span></span>

- <span data-ttu-id="f0b47-202">[Небольшой][small-pricing]. Этот пример тарификации предполагает наличие 1000 сборок контейнеров в месяц.</span><span class="sxs-lookup"><span data-stu-id="f0b47-202">[Small][small-pricing]: this pricing example correlates to 1000 container builds per month.</span></span>
- <span data-ttu-id="f0b47-203">[Средний][medium-pricing]. Этот пример тарификации предполагает наличие 100 000 сборок контейнеров в месяц.</span><span class="sxs-lookup"><span data-stu-id="f0b47-203">[Medium][medium-pricing]: this pricing example correlates to 100,000 container builds per month.</span></span>
- <span data-ttu-id="f0b47-204">[Большой][large-pricing]. Этот пример тарификации предполагает наличие 1 000 000 сборок контейнеров в месяц.</span><span class="sxs-lookup"><span data-stu-id="f0b47-204">[Large][large-pricing]: this pricing example correlates to 1,000,000 container builds per month.</span></span>

## <a name="related-resources"></a><span data-ttu-id="f0b47-205">Связанные ресурсы</span><span class="sxs-lookup"><span data-stu-id="f0b47-205">Related resources</span></span>

<span data-ttu-id="f0b47-206">Этот сценарий использует Реестр контейнеров Azure и Службу Azure Kubernetes для хранения и запуска приложений на основе контейнеров.</span><span class="sxs-lookup"><span data-stu-id="f0b47-206">This scenario used Azure Container Registry and Azure Kubernetes Service to store and run a container-based application.</span></span> <span data-ttu-id="f0b47-207">Экземпляры контейнеров Azure могут также использоваться для запуска приложений на основе контейнеров без необходимости создавать какие-либо компоненты оркестровки.</span><span class="sxs-lookup"><span data-stu-id="f0b47-207">Azure Container Instances can also be used to run container-based applications, without having to provision any orchestration components.</span></span> <span data-ttu-id="f0b47-208">Дополнительные сведения см. на странице [Экземпляры контейнеров Azure][docs-aci].</span><span class="sxs-lookup"><span data-stu-id="f0b47-208">For more information, see [Azure Container Instances overview][docs-aci].</span></span>

<!-- links -->
[architecture]: ./media/architecture-devops-with-aks.png
[autoscaling]: ../../best-practices/auto-scaling.md
[availability]: ../../checklist/availability.md
[docs-aci]: /azure/container-instances/container-instances-overview
[docs-acr]: /azure/container-registry/container-registry-intro
[docs-aks]: /azure/aks/intro-kubernetes
[docs-azure-monitor]: /azure/monitoring-and-diagnostics/monitoring-overview
[docs-cosmos-db]: /azure/cosmos-db/introduction
[docs-virtual-machines]: /azure/virtual-machines/linux/overview
[createsp]: /cli/azure/ad/sp#az-ad-sp-create
[grafana]: https://grafana.com/
[jenkins]: https://jenkins.io/
[resiliency]: ../../resiliency/index.md
[resource-groups]: /azure/azure-resource-manager/resource-group-overview
[security]: /azure/security/
[scalability]: ../../checklist/scalability.md
[sshkeydocs]: /azure/virtual-machines/linux/mac-create-ssh-keys
[azure-pipelines]: /azure/devops/pipelines
[kubernetes]: https://kubernetes.io/
[service-fabric]: /azure/service-fabric/

[small-pricing]: https://azure.com/e/841f0a75b1ea4802ba1ac8f7918a71e7
[medium-pricing]: https://azure.com/e/eea0e6d79b4e45618a96d33383ec77ba
[large-pricing]: https://azure.com/e/3faab662c54c473da55a1e93a27e0e64