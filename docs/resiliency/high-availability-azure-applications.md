---
title: "Обеспечение высокой доступности для приложений Azure"
description: "Технический обзор и подробные сведения о проектировании и разработке приложений c высоким уровнем доступности на платформе Microsoft Azure."
author: adamglick
ms.date: 05/31/2017
ms.openlocfilehash: 46b7b802326a8de03546528aaeb1a1c6419d41db
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
[!INCLUDE [header](../_includes/header.md)]
# <a name="high-availability-for-applications-built-on-microsoft-azure"></a><span data-ttu-id="3b47b-103">Обеспечение высокой доступности для приложений на платформе Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="3b47b-103">High availability for applications built on Microsoft Azure</span></span>
<span data-ttu-id="3b47b-104">Приложения с высоким уровнем доступности выдерживают колебания доступности, нагрузки и временных сбоев в зависимых службах и оборудовании.</span><span class="sxs-lookup"><span data-stu-id="3b47b-104">A highly available application absorbs fluctuations in availability, load, and temporary failures in dependent services and hardware.</span></span> <span data-ttu-id="3b47b-105">Приложение продолжает работать в правильном режиме, соответствующем бизнес-требованиям или положениям соглашений об уровне обслуживания.</span><span class="sxs-lookup"><span data-stu-id="3b47b-105">The application continues to perform acceptably, as defined by business requirements or application service-level agreements (SLAs).</span></span>

## <a name="azure-high-availability-features"></a><span data-ttu-id="3b47b-106">Возможности обеспечения высокой доступности Azure</span><span class="sxs-lookup"><span data-stu-id="3b47b-106">Azure high-availability features</span></span>
<span data-ttu-id="3b47b-107">Платформа Azure предусматривает множество встроенных возможностей для поддержки приложений с высоким уровнем доступности.</span><span class="sxs-lookup"><span data-stu-id="3b47b-107">Azure has many built-in platform features that support highly available applications.</span></span> <span data-ttu-id="3b47b-108">В этом разделе описаны некоторые из этих основных возможностей.</span><span class="sxs-lookup"><span data-stu-id="3b47b-108">This section describes some of those key features.</span></span>

### <a name="fabric-controller"></a><span data-ttu-id="3b47b-109">Контроллер структуры</span><span class="sxs-lookup"><span data-stu-id="3b47b-109">Fabric controller</span></span>
<span data-ttu-id="3b47b-110">Контроллер структуры Azure подготавливает ресурсы и осуществляет мониторинг состояния вычислительных операций Azure.</span><span class="sxs-lookup"><span data-stu-id="3b47b-110">The Azure fabric controller provisions and monitors the condition of Azure compute instances.</span></span> <span data-ttu-id="3b47b-111">Он отслеживает состояние оборудования и программного обеспечения экземпляров гостевого и хост-компьютера.</span><span class="sxs-lookup"><span data-stu-id="3b47b-111">The fabric controller monitors the status of the hardware and software of the host and guest machine instances.</span></span> <span data-ttu-id="3b47b-112">При обнаружении сбоя контроллер структуры применяет соглашения об уровне обслуживания, автоматически перемещая экземпляры виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="3b47b-112">When it detects a failure, it maintains SLAs by automatically relocating the VM instances.</span></span> <span data-ttu-id="3b47b-113">Домены обновления и сбоя обеспечивают дальнейшую поддержку соглашения об уровне обслуживания в отношении вычислений.</span><span class="sxs-lookup"><span data-stu-id="3b47b-113">The concept of fault and upgrade domains further supports the compute SLA.</span></span>

<span data-ttu-id="3b47b-114">При развертывании нескольких экземпляров роли облачной службы Azure развертывает их в разных доменах сбоя.</span><span class="sxs-lookup"><span data-stu-id="3b47b-114">When multiple Cloud Service role instances are deployed, Azure deploys these instances to different fault domains.</span></span> <span data-ttu-id="3b47b-115">По факту граница домена сбоя расположена в аппаратной стойке в том же регионе.</span><span class="sxs-lookup"><span data-stu-id="3b47b-115">A fault domain boundary is essentially a different hardware rack in the same region.</span></span> <span data-ttu-id="3b47b-116">Домены сбоя снижают вероятность прерывания работы приложения после локализованного сбоя оборудования.</span><span class="sxs-lookup"><span data-stu-id="3b47b-116">Fault domains reduce the probability that a localized hardware failure interrupts the service of an application.</span></span> <span data-ttu-id="3b47b-117">Вы не можете управлять количеством доменов сбоя рабочих или веб-ролей.</span><span class="sxs-lookup"><span data-stu-id="3b47b-117">You cannot manage the number of fault domains of your worker roles or web roles.</span></span> <span data-ttu-id="3b47b-118">Контроллер структуры использует выделенные ресурсы, независимые от размещенных в Azure приложений.</span><span class="sxs-lookup"><span data-stu-id="3b47b-118">The fabric controller uses dedicated resources that are separate from Azure-hosted applications.</span></span> <span data-ttu-id="3b47b-119">Он всегда должен находиться в работоспособном состоянии, так как от него зависит работа системы Azure.</span><span class="sxs-lookup"><span data-stu-id="3b47b-119">It requires 100 percent uptime because it serves as the nucleus of the Azure system.</span></span> <span data-ttu-id="3b47b-120">Контроллер структуры отслеживает и управляет экземплярами ролей в доменах сбоя.</span><span class="sxs-lookup"><span data-stu-id="3b47b-120">It monitors and manages role instances across fault domains.</span></span>

<span data-ttu-id="3b47b-121">На схеме ниже показаны общие ресурсы Azure, развернутые контроллером структуры на разных доменах сбоя и управляемые им.</span><span class="sxs-lookup"><span data-stu-id="3b47b-121">The following diagram shows Azure shared resources that the fabric controller deploys and manages across different fault domains.</span></span>

![Упрощенное представление изоляции доменов сбоя](./images/high-availability-azure-applications/fault-domain-isolation.png)

<span data-ttu-id="3b47b-123">В то время как домены сбоя являются физическими единицами разделения для устранения неполадки, домены обновления — это логические единицы разделения экземпляров, которые определяют, какие экземпляры службы будут обновлены в определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="3b47b-123">While fault domains are physical separations to mitigate failure, upgrade domains are logical units of instance separation that determine which instances of a service will be upgraded at a specific time.</span></span> <span data-ttu-id="3b47b-124">По умолчанию для развертывания размещенной службы определено пять доменов обновления.</span><span class="sxs-lookup"><span data-stu-id="3b47b-124">By default, five upgrade domains are defined for your hosted service deployment.</span></span> <span data-ttu-id="3b47b-125">Но это количество можно изменить в файле определения службы.</span><span class="sxs-lookup"><span data-stu-id="3b47b-125">However, you can change that value in the service definition file.</span></span> <span data-ttu-id="3b47b-126">Например, если у вас есть восемь экземпляров веб-роли, два экземпляра будут находиться в трех доменах обновления и два экземпляра — в одном домене обновления.</span><span class="sxs-lookup"><span data-stu-id="3b47b-126">For example, if you have eight instances of your web role, there are two instances in three upgrade domains and two instances in one upgrade domain.</span></span> <span data-ttu-id="3b47b-127">Azure определяет последовательность обновления на основе количества доменов обновления.</span><span class="sxs-lookup"><span data-stu-id="3b47b-127">Azure defines the update sequence based on the number of upgrade domains.</span></span> <span data-ttu-id="3b47b-128">Дополнительные сведения см. в статье [Обновление облачной службы](/azure/cloud-services/cloud-services-update-azure-service/).</span><span class="sxs-lookup"><span data-stu-id="3b47b-128">For more information, see [Update a cloud service](/azure/cloud-services/cloud-services-update-azure-service/).</span></span>

### <a name="features-in-other-services"></a><span data-ttu-id="3b47b-129">Возможности в других службах</span><span class="sxs-lookup"><span data-stu-id="3b47b-129">Features in other services</span></span>
<span data-ttu-id="3b47b-130">Помимо этих возможностей платформы, обеспечивающих поддержку высокого уровня доступности вычислительных ресурсов, Azure внедряет возможности обеспечения доступности в другие службы.</span><span class="sxs-lookup"><span data-stu-id="3b47b-130">In addition to the platform features that support high availability of compute resources, Azure embeds high-availability features in its other services.</span></span> <span data-ttu-id="3b47b-131">Например, служба хранилища Azure поддерживает по крайне мере три реплики для всех данных в учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="3b47b-131">For example, Azure Storage maintains at least three replicas of all data in your Azure storage account.</span></span> <span data-ttu-id="3b47b-132">Она также предоставляет возможность георепликации для хранения копий данных в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="3b47b-132">It also enables geo-replication to store copies of your data in a secondary region.</span></span> <span data-ttu-id="3b47b-133">Сеть доставки содержимого (CDN) Azure позволяет кэшировать большие двоичные объекты в регионах по всему миру для обеспечения избыточности, масштабируемости и низкой задержки.</span><span class="sxs-lookup"><span data-stu-id="3b47b-133">The Azure Content Delivery Network allows blobs to be cached around the world for redundancy, scalability, and lower latency.</span></span> <span data-ttu-id="3b47b-134">База данных SQL Azure также поддерживает несколько реплик.</span><span class="sxs-lookup"><span data-stu-id="3b47b-134">Azure SQL Database maintains multiple replicas as well.</span></span>

<span data-ttu-id="3b47b-135">Более подробные сведения о возможностях обеспечения доступности платформы Azure см. в статье [Проектирование устойчивых приложений для Azure](index.md).</span><span class="sxs-lookup"><span data-stu-id="3b47b-135">For a deeper discussion of Azure platform availability features, see [Resiliency technical guidance](index.md).</span></span> <span data-ttu-id="3b47b-136">Ознакомьтесь также со статьей [Best Practices for Designing Large-Scale Services on Windows Azure](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/) (Рекомендации по разработке крупномасштабных служб в Windows Azure).</span><span class="sxs-lookup"><span data-stu-id="3b47b-136">Also see [Best practices for designing large-scale services on Windows Azure](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/).</span></span>

<span data-ttu-id="3b47b-137">Хотя Azure и предоставляет много возможностей, обеспечивающих поддержку высокой доступности, важно знать их ограничения.</span><span class="sxs-lookup"><span data-stu-id="3b47b-137">Although Azure provides multiple features that support high availability, it's important to understand their limitations:</span></span>

* <span data-ttu-id="3b47b-138">Azure гарантирует постоянную доступность и работу ролей для вычислительных операций, но не отслеживает работу приложений или наличие перегрузки.</span><span class="sxs-lookup"><span data-stu-id="3b47b-138">For compute, Azure guarantees that your roles are available and running, but it cannot detect whether your application is running or overloaded.</span></span>
* <span data-ttu-id="3b47b-139">Данные Базы данных SQL Azure синхронно реплицируются в регионе.</span><span class="sxs-lookup"><span data-stu-id="3b47b-139">For Azure SQL Database, data is replicated synchronously within the region.</span></span> <span data-ttu-id="3b47b-140">Можно выбрать активную георепликацию, при которой в одном или в разных регионах может храниться четыре дополнительных копии базы данных.</span><span class="sxs-lookup"><span data-stu-id="3b47b-140">You can choose active geo-replication, which allows up to four additional database copies in the same region (or different regions).</span></span> <span data-ttu-id="3b47b-141">Хотя эти реплики базы данных не являются резервными копиями на определенный момент времени, база данных SQL обеспечивает возможность резервного копирования на определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="3b47b-141">While these database replicas are not point-in-time backups, SQL Database does provide point-in-time backup capabilities.</span></span> <span data-ttu-id="3b47b-142">Дополнительные сведения см. в разделе [Восстановление до точки во времени](/azure/sql-database/sql-database-recovery-using-backups#point-in-time-restore).</span><span class="sxs-lookup"><span data-stu-id="3b47b-142">For more information, see [Recover an Azure SQL Database using automated data backups: Point-in-time restore](/azure/sql-database/sql-database-recovery-using-backups#point-in-time-restore).</span></span>
* <span data-ttu-id="3b47b-143">Данные таблиц и больших двоичных объектов службы хранилища Azure по умолчанию реплицируются в другой регион.</span><span class="sxs-lookup"><span data-stu-id="3b47b-143">For Azure Storage, table data and blob data are replicated by default to an alternate region.</span></span> <span data-ttu-id="3b47b-144">Несмотря на это доступ к репликам можно получить только после того, как Майкрософт выполнит обработку отказа на другом сайте.</span><span class="sxs-lookup"><span data-stu-id="3b47b-144">However, you cannot access the replicas until Microsoft chooses to fail over to the alternate site.</span></span> <span data-ttu-id="3b47b-145">Отработка отказа региона выполняется во время длительных нарушений в работе служб на уровне региона и отсутствия соглашения об уровне обслуживания на время географической отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="3b47b-145">A region failover occurs only during a prolonged region-wide service disruption, and there is no SLA for geo-failover time.</span></span> <span data-ttu-id="3b47b-146">Кроме того, важно помнить, что любое повреждение данных быстро распространяется на реплики.</span><span class="sxs-lookup"><span data-stu-id="3b47b-146">It's also important to note that any data corruption quickly spreads to the replicas.</span></span> <span data-ttu-id="3b47b-147">Поэтому рекомендуется тщательно изучить возможности обеспечения доступности платформ, в том числе зависящие от приложений, включая возможности создания моментальных снимков больших двоичных объектов, что позволяет создавать резервные копии данных соответствующих объектов на определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="3b47b-147">For these reasons, you must supplement platform availability features with application-specific availability features, including the blob snapshot feature to create point-in-time backups of blob data.</span></span>

### <a name="availability-sets-for-azure-virtual-machines"></a><span data-ttu-id="3b47b-148">Группы доступности для виртуальных машин Azure</span><span class="sxs-lookup"><span data-stu-id="3b47b-148">Availability sets for Azure Virtual Machines</span></span>
<span data-ttu-id="3b47b-149">В этом документе основное внимание уделяется облачным службам, которые используют модель PaaS (платформа как услуга).</span><span class="sxs-lookup"><span data-stu-id="3b47b-149">This document primarily focuses on cloud services, which use a platform-as-a-service (PaaS) model.</span></span> <span data-ttu-id="3b47b-150">Есть также определенные возможности обеспечения доступности для виртуальных машин Azure, которые используют модель IaaS (инфраструктура как услуга).</span><span class="sxs-lookup"><span data-stu-id="3b47b-150">There are also specific availability features for Azure Virtual Machines, which use an infrastructure-as-a-service (IaaS) model.</span></span> <span data-ttu-id="3b47b-151">Чтобы обеспечить высокий уровень доступности для виртуальных машин, необходимо использовать группы доступности, которые выполняют ту же функцию, что и домены сбоя и обновления.</span><span class="sxs-lookup"><span data-stu-id="3b47b-151">To achieve high availability with Virtual Machines, you must use availability sets, which serve a similar function to fault and upgrade domains.</span></span> <span data-ttu-id="3b47b-152">Azure помещает виртуальные машины в группы доступности, предотвращая нарушение работы всех машин в группе и ограничивая влияние локализованных сбоев оборудования, а также действий по обслуживанию.</span><span class="sxs-lookup"><span data-stu-id="3b47b-152">Within an availability set, Azure positions the virtual machines in a way that prevents localized hardware faults and maintenance activities from bringing down all the machines in that group.</span></span> <span data-ttu-id="3b47b-153">Группы доступности требуются в рамках соглашения об уровне обслуживания Azure для обеспечения доступности виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="3b47b-153">Availability sets are required to achieve the Azure SLA for the availability of Virtual Machines.</span></span>

<span data-ttu-id="3b47b-154">На схеме ниже показаны две группы доступности для виртуальных машины в сети и SQL Server соответственно.</span><span class="sxs-lookup"><span data-stu-id="3b47b-154">The following diagram shows two availability sets for web and SQL Server virtual machines, respectively.</span></span>

![Группы доступности для виртуальных машин Azure](./images/high-availability-azure-applications/availability-set-for-azure-virtual-machines.png)

> [!NOTE]
> <span data-ttu-id="3b47b-156">На схеме выше предполагается, что на виртуальных машинах установлен и запущен SQL Server.</span><span class="sxs-lookup"><span data-stu-id="3b47b-156">In the preceding diagram, SQL Server is installed and running on virtual machines.</span></span> <span data-ttu-id="3b47b-157">В этом состоит отличие от базы данных SQL Azure, которая предоставляет возможность управления базой данных.</span><span class="sxs-lookup"><span data-stu-id="3b47b-157">This is different from Azure SQL Database, which provides a database as a managed service.</span></span>
> 
> 

## <a name="application-strategies-for-high-availability"></a><span data-ttu-id="3b47b-158">Стратегии по обеспечению высокой доступности приложений</span><span class="sxs-lookup"><span data-stu-id="3b47b-158">Application strategies for high availability</span></span>
<span data-ttu-id="3b47b-159">Большинство стратегий по обеспечению высокой доступности приложений основаны либо на избыточности, либо на удалении строгих зависимостей между компонентами приложений.</span><span class="sxs-lookup"><span data-stu-id="3b47b-159">Most application strategies for high availability involve either redundancy or the removal of hard dependencies between application components.</span></span> <span data-ttu-id="3b47b-160">Архитектура приложения должна предусматривать отказоустойчивость на случай разового простоя Azure или поддержку сторонних служб.</span><span class="sxs-lookup"><span data-stu-id="3b47b-160">Application design should support fault tolerance during sporadic downtime of Azure or third-party services.</span></span> <span data-ttu-id="3b47b-161">В следующих разделах рассматриваются шаблоны приложений, которые позволяют повысить уровень доступности облачных служб.</span><span class="sxs-lookup"><span data-stu-id="3b47b-161">The following sections describe application patterns for improving the availability of your cloud services.</span></span>

### <a name="asynchronous-communication-and-durable-queues"></a><span data-ttu-id="3b47b-162">Асинхронная передача данных и долгосрочные очереди</span><span class="sxs-lookup"><span data-stu-id="3b47b-162">Asynchronous communication and durable queues</span></span>
<span data-ttu-id="3b47b-163">Для увеличения доступности приложений Azure рекомендуется использовать асинхронную передачу данных между слабосвязанными службами.</span><span class="sxs-lookup"><span data-stu-id="3b47b-163">To increase availability in Azure applications, consider asynchronous communication between loosely coupled services.</span></span> <span data-ttu-id="3b47b-164">В этом шаблоне сообщения записываются для последующей обработки либо в очереди хранилища, либо в очереди служебной шины Azure.</span><span class="sxs-lookup"><span data-stu-id="3b47b-164">In this pattern, messages are written to either storage queues or Azure Service Bus queues for later processing.</span></span> <span data-ttu-id="3b47b-165">После записи сообщения в очередь управление получает его отправитель.</span><span class="sxs-lookup"><span data-stu-id="3b47b-165">When a message is written to the queue, control immediately returns to the sender.</span></span> <span data-ttu-id="3b47b-166">За обработку сообщения отвечает другая служба приложения (как правило, реализуется в виде рабочей роли).</span><span class="sxs-lookup"><span data-stu-id="3b47b-166">Another service of the application (typically implemented as a worker role) processes the message.</span></span> <span data-ttu-id="3b47b-167">Если служба обработки перестает работать, сообщения накапливаются в очередь до ее восстановления.</span><span class="sxs-lookup"><span data-stu-id="3b47b-167">If the processing service stops working, the messages accumulate in the queue until the processing service is restored.</span></span> <span data-ttu-id="3b47b-168">Между внешним отправителем и обработчиком сообщений нет прямой зависимости.</span><span class="sxs-lookup"><span data-stu-id="3b47b-168">There is no direct dependency between the front-end sender and the message processor.</span></span> <span data-ttu-id="3b47b-169">Эта позволяет избежать выполнения синхронных вызовов службы, которые могут стать причиной возникновения узких мест в распределенных приложениях.</span><span class="sxs-lookup"><span data-stu-id="3b47b-169">This eliminates synchronous service calls that can cause bottlenecks in distributed applications.</span></span>

<span data-ttu-id="3b47b-170">Как вариант, шаблон может хранить сведения о неудачных вызовах базы данных в очереди службы хранилища Azure (большие двоичные объекты, таблицы, очереди) или служебной шины.</span><span class="sxs-lookup"><span data-stu-id="3b47b-170">A variation of this pattern stores information about failed database calls in Azure Storage (blobs, tables, or queues) or Service Bus queues.</span></span> <span data-ttu-id="3b47b-171">Например, синхронные вызовы другой службы (такой как База данных SQL Azure) из приложения постоянно завершаются сбоем.</span><span class="sxs-lookup"><span data-stu-id="3b47b-171">For example, a synchronous call within an application to another service (such as Azure SQL Database) fails repeatedly.</span></span> <span data-ttu-id="3b47b-172">Вы можете сериализовать этот запрос в долговременном хранилище.</span><span class="sxs-lookup"><span data-stu-id="3b47b-172">You might be able to serialize that request into durable storage.</span></span> <span data-ttu-id="3b47b-173">На более позднем этапе после восстановления работоспособности службы или базы данных приложение может повторно отправить запрос из хранилища.</span><span class="sxs-lookup"><span data-stu-id="3b47b-173">At some later point when the service or database is back online, the application can resubmit the request from storage.</span></span> <span data-ttu-id="3b47b-174">Эта модель отличается тем, что промежуточное расположение не используется постоянно в рабочем процессе приложения, а только во время сбоев.</span><span class="sxs-lookup"><span data-stu-id="3b47b-174">The difference in this model is that the intermediate location is used only during failures, not as a regular part of the application workflow.</span></span>

<span data-ttu-id="3b47b-175">В обоих сценариях асинхронная передача данных и использование промежуточного хранилища предотвращают прерывание работы всего приложения после сбоя серверной службы.</span><span class="sxs-lookup"><span data-stu-id="3b47b-175">In both scenarios, asynchronous communication and intermediate storage prevent a downed back-end service from bringing down the entire application.</span></span> <span data-ttu-id="3b47b-176">Очереди используются в качестве логического посредника.</span><span class="sxs-lookup"><span data-stu-id="3b47b-176">Queues serve as a logical intermediary.</span></span> <span data-ttu-id="3b47b-177">Дополнительные сведения о выборе служб очередей см. в статье [Очереди службы хранилища и очереди служебной шины: сходства и различия](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/).</span><span class="sxs-lookup"><span data-stu-id="3b47b-177">For more information on choosing between queuing services, see [Azure queues and Azure Service Bus queues &mdash; compared and contrasted](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/).</span></span>

### <a name="fault-detection-and-retry-logic"></a><span data-ttu-id="3b47b-178">Логика обнаружения сбоев и логический алгоритм повтора</span><span class="sxs-lookup"><span data-stu-id="3b47b-178">Fault detection and retry logic</span></span>
<span data-ttu-id="3b47b-179">Важным фактором в создании высокодоступных приложений является использование в коде логики повтора, которая позволяет соответствующим образом управлять временно недоступной службой.</span><span class="sxs-lookup"><span data-stu-id="3b47b-179">A key aspect of the design of highly available applications is the use of retry logic within code to gracefully handle a service that is temporarily unavailable.</span></span> <span data-ttu-id="3b47b-180">Последние версии пакетов SDK для службы хранилища Azure и служебной шины Azure имеют встроенный механизм повторных попыток.</span><span class="sxs-lookup"><span data-stu-id="3b47b-180">Recent versions of SDKs for both Azure Storage and Azure Service Bus natively support retries.</span></span> <span data-ttu-id="3b47b-181">Дополнительные сведения о предоставлении пользовательской логики повторных попыток для приложения см. в статье о [шаблоне повторов](../patterns/retry.md).</span><span class="sxs-lookup"><span data-stu-id="3b47b-181">For more information on providing custom retry logic for your application, see the [Retry pattern](../patterns/retry.md).</span></span>

### <a name="reference-data-pattern-for-high-availability"></a><span data-ttu-id="3b47b-182">Шаблон ссылочных данных для обеспечения высокого уровня доступности</span><span class="sxs-lookup"><span data-stu-id="3b47b-182">Reference data pattern for high availability</span></span>
<span data-ttu-id="3b47b-183">Ссылочные данные — это данные приложения только для чтения.</span><span class="sxs-lookup"><span data-stu-id="3b47b-183">Reference data is the read-only data of an application.</span></span> <span data-ttu-id="3b47b-184">Они содержат бизнес-контекст, на основе которого приложение создает данные о транзакциях во время бизнес-операции.</span><span class="sxs-lookup"><span data-stu-id="3b47b-184">This data provides the business context within which the application generates transactional data during a business operation.</span></span> <span data-ttu-id="3b47b-185">Целостность данных о транзакциях зависит от моментального снимка эталонных данных в момент выполнения транзакции.</span><span class="sxs-lookup"><span data-stu-id="3b47b-185">The integrity of transactional data depends on a snapshot of the reference data at the time the transaction was completed.</span></span>

<span data-ttu-id="3b47b-186">Эталонные данные необходимы для корректной работы приложения.</span><span class="sxs-lookup"><span data-stu-id="3b47b-186">Reference data is necessary for the proper operation of the application.</span></span> <span data-ttu-id="3b47b-187">В разных приложениях создание и обслуживание ссылочных данных зачастую выполняют системы управления основными данными.</span><span class="sxs-lookup"><span data-stu-id="3b47b-187">Various applications create and maintain reference data; master data management (MDM) systems often perform this function.</span></span> <span data-ttu-id="3b47b-188">Эти системы отвечают за жизненный цикл ссылочных данных.</span><span class="sxs-lookup"><span data-stu-id="3b47b-188">These systems are responsible for the life cycle of the reference data.</span></span> <span data-ttu-id="3b47b-189">К ссылочным данным относятся каталоги продукции, данные о сотрудниках, деталях и оборудовании.</span><span class="sxs-lookup"><span data-stu-id="3b47b-189">Examples of reference data include product catalog, employee master, parts master, and equipment master.</span></span> <span data-ttu-id="3b47b-190">Эти данные (например, почтовые индексы или налоговые ставки) также могут поступать из внешних источников.</span><span class="sxs-lookup"><span data-stu-id="3b47b-190">Reference data can also originate from outside the organization, for example, postal codes or tax rates.</span></span> <span data-ttu-id="3b47b-191">Обычно стратегии по увеличению доступности ссылочных данных не такие сложные, как стратегии данных о транзакциях.</span><span class="sxs-lookup"><span data-stu-id="3b47b-191">Strategies for increasing the availability of reference data are typically less difficult than those for transactional data.</span></span> <span data-ttu-id="3b47b-192">Преимущество ссылочных данных состоит в том, что в основном они неизменяемые.</span><span class="sxs-lookup"><span data-stu-id="3b47b-192">Reference data has the advantage of being mostly immutable.</span></span>

<span data-ttu-id="3b47b-193">Веб-роли и рабочие роли Azure, которые используют эталонные данные, можно создать в автономном режиме во время выполнения, развернув эти данные вместе с приложением.</span><span class="sxs-lookup"><span data-stu-id="3b47b-193">Azure web and worker roles that consume reference data can be made autonomous at runtime by deploying the reference data along with the application.</span></span> <span data-ttu-id="3b47b-194">Этот подход идеально подходит, если размера локального хранилища достаточно для выполнения этого развертывания.</span><span class="sxs-lookup"><span data-stu-id="3b47b-194">This approach is ideal if the size of the local storage allows such a deployment.</span></span> <span data-ttu-id="3b47b-195">Встроенные базы данных SQL и NoSQL, а также XML-файлы, развернутые локально, позволяют обеспечить автономию единиц масштабирования вычислительных ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="3b47b-195">Embedded SQL databases, NoSQL databases, or XML files deployed locally help with the autonomy of Azure compute scale units.</span></span> <span data-ttu-id="3b47b-196">Но для каждой роли вам понадобится механизм обновления данных, для которого не нужно будет повторное развертывание.</span><span class="sxs-lookup"><span data-stu-id="3b47b-196">However, you should have a mechanism to update the data in each role without requiring redeployment.</span></span> <span data-ttu-id="3b47b-197">Для этого разместите обновления ссылочных данных в конечной точке облачного хранилища (например, в хранилище BLOB-объектов Azure или базе данных SQL).</span><span class="sxs-lookup"><span data-stu-id="3b47b-197">To do this, place any updates to the reference data at a cloud storage endpoint (for example, Azure Blob storage or SQL Database).</span></span> <span data-ttu-id="3b47b-198">Добавьте код для каждой роли, которая при запуске загружает обновления данных в вычислительные узлы.</span><span class="sxs-lookup"><span data-stu-id="3b47b-198">Add code to each role that downloads the data updates into the compute nodes at role startup.</span></span> <span data-ttu-id="3b47b-199">Кроме того, можно добавить код, который позволит администратору выполнять принудительную загрузку в экземпляры ролей.</span><span class="sxs-lookup"><span data-stu-id="3b47b-199">Alternatively, add code that allows an administrator to perform a forced download into the role instances.</span></span>

<span data-ttu-id="3b47b-200">Чтобы увеличить доступность, в роли следует включить набор ссылочных данных на случай прерывания работы хранилища.</span><span class="sxs-lookup"><span data-stu-id="3b47b-200">To increase availability, the roles should also contain a set of reference data in case storage is down.</span></span> <span data-ttu-id="3b47b-201">Роли можно запускать с основным набором ссылочных данных, пока ресурсы хранилища не станут доступными для обновления.</span><span class="sxs-lookup"><span data-stu-id="3b47b-201">Roles can start with a basic set of reference data until the storage resource becomes available for the updates.</span></span>

![Обеспечение высокого уровня доступности приложения за счет автономных вычислительных узлов](./images/high-availability-azure-applications/application-high-availability-through-autonomous-compute-nodes.png)

<span data-ttu-id="3b47b-203">С использованием этого шаблона время запуска новых развертываний или экземпляров ролей может увеличиться, если вы развертываете или скачиваете большой объем эталонных данных.</span><span class="sxs-lookup"><span data-stu-id="3b47b-203">With this pattern, new deployments or role instances may take longer to start if you are deploying or downloading large amounts of reference data.</span></span> <span data-ttu-id="3b47b-204">Это может быть приемлемо, если необходимо автономно использовать ссылочные данные для каждой роли и не зависеть от внешних служб хранилищ.</span><span class="sxs-lookup"><span data-stu-id="3b47b-204">This tradeoff might be acceptable for the autonomy of having the reference data immediately available on each role, rather than depending on external storage services.</span></span>

### <a name="transactional-data-pattern-for-high-availability"></a><span data-ttu-id="3b47b-205">Шаблон данных о транзакциях для обеспечения высокого уровня доступности</span><span class="sxs-lookup"><span data-stu-id="3b47b-205">Transactional data pattern for high availability</span></span>
<span data-ttu-id="3b47b-206">Данные о транзакциях — это данные, созданные приложением в бизнес-контексте.</span><span class="sxs-lookup"><span data-stu-id="3b47b-206">Transactional data is the data that the application generates in a business context.</span></span> <span data-ttu-id="3b47b-207">Они представляют собой сочетание реализованных приложением бизнес-процессов и ссылочных данных, необходимых для выполнения этих процессов.</span><span class="sxs-lookup"><span data-stu-id="3b47b-207">Transactional data is a combination of the set of business processes that the application implements and the reference data that supports these processes.</span></span> <span data-ttu-id="3b47b-208">К ним могут относиться заказы, предварительные уведомления о доставке, счета-фактуры и возможности по управлению отношениями с клиентами.</span><span class="sxs-lookup"><span data-stu-id="3b47b-208">Examples of transactional data can include orders, advanced shipping notices, invoices, and customer relationship management (CRM) opportunities.</span></span> <span data-ttu-id="3b47b-209">Данные о транзакциях передаются во внешние системы для ведения учета или последующей обработки.</span><span class="sxs-lookup"><span data-stu-id="3b47b-209">Transactional data is supplied to external systems for record keeping or for further processing.</span></span>

<span data-ttu-id="3b47b-210">Эталонные данные могут изменяться в системах, которые отвечают за них.</span><span class="sxs-lookup"><span data-stu-id="3b47b-210">Reference data can change within the systems that are responsible for that data.</span></span> <span data-ttu-id="3b47b-211">Поэтому в данных о транзакциях должен быть контекст эталонных данных в определенный момент времени, чтобы свести к минимуму внешние зависимости и обеспечить семантическую согласованность.</span><span class="sxs-lookup"><span data-stu-id="3b47b-211">Therefore, transactional data must save the point-in-time reference data context to minimize external dependencies for its semantic consistency.</span></span> <span data-ttu-id="3b47b-212">Например, продукт может быть удален из каталога через несколько месяцев после выполнения заказа.</span><span class="sxs-lookup"><span data-stu-id="3b47b-212">For example, a product may be removed from the catalog several months after an order is fulfilled.</span></span> <span data-ttu-id="3b47b-213">Рекомендуется хранить как можно больше контекста эталонных данных в транзакциях.</span><span class="sxs-lookup"><span data-stu-id="3b47b-213">Storing as much reference data context as possible with the transaction is recommended.</span></span> <span data-ttu-id="3b47b-214">Это позволит сохранить связанную с транзакцией семантику даже при изменении эталонных данных после записи транзакции.</span><span class="sxs-lookup"><span data-stu-id="3b47b-214">This approach preserves the semantics associated with the transaction, even if the reference data changes after the transaction is captured.</span></span>

<span data-ttu-id="3b47b-215">Как упоминалось ранее, архитектуры, использующие слабые связи и асинхронную передачу данных, предоставляют более высокий уровень доступности.</span><span class="sxs-lookup"><span data-stu-id="3b47b-215">As mentioned previously, architectures that use loose coupling and asynchronous communication can provide higher levels of availability.</span></span> <span data-ttu-id="3b47b-216">Это касается также данных о транзакциях, но их реализация носит более сложный характер.</span><span class="sxs-lookup"><span data-stu-id="3b47b-216">This is true for transactional data as well, but the implementation is more complex.</span></span> <span data-ttu-id="3b47b-217">Обычно для традиционных шаблонов транзакций используется база данных. Это позволяет обеспечить выполнение транзакции.</span><span class="sxs-lookup"><span data-stu-id="3b47b-217">Traditional transactional patterns usually rely on the database for guaranteeing the transaction.</span></span> <span data-ttu-id="3b47b-218">Чтобы обеспечить достаточный уровень согласованности и устойчивости, при внедрении промежуточных уровней код приложения должен соответствующим образом обрабатывать данные разных уровней.</span><span class="sxs-lookup"><span data-stu-id="3b47b-218">When you introduce intermediate layers, the application code must correctly handle the data at various layers to ensure sufficient consistency and durability.</span></span>

<span data-ttu-id="3b47b-219">Следующий список — это описание рабочего процесса, который разделяет сбор данных о транзакциях и их обработку.</span><span class="sxs-lookup"><span data-stu-id="3b47b-219">The following sequence describes a workflow that separates the capture of transactional data from its processing:</span></span>

1. <span data-ttu-id="3b47b-220">Вычислительный веб-узел предоставляет ссылочные данные.</span><span class="sxs-lookup"><span data-stu-id="3b47b-220">Web compute node: Present reference data.</span></span>
2. <span data-ttu-id="3b47b-221">Внешнее хранилище сохраняет промежуточные данные о транзакциях.</span><span class="sxs-lookup"><span data-stu-id="3b47b-221">External storage: Save intermediate transactional data.</span></span>
3. <span data-ttu-id="3b47b-222">Вычислительный веб-узел завершает пользовательскую транзакцию.</span><span class="sxs-lookup"><span data-stu-id="3b47b-222">Web compute node: Complete the end-user transaction.</span></span>
4. <span data-ttu-id="3b47b-223">Вычислительный веб-узел отправляет полные данные о транзакциях и контекст эталонных данных во временное надежное хранилище с гарантией отправки прогнозируемого ответа.</span><span class="sxs-lookup"><span data-stu-id="3b47b-223">Web compute node: Send the completed transactional data with its reference data context to temporary durable storage that is guaranteed to give a predictable response.</span></span>
5. <span data-ttu-id="3b47b-224">Вычислительный веб-узел сигнализирует о завершении транзакции.</span><span class="sxs-lookup"><span data-stu-id="3b47b-224">Web compute node: Signal the end-user completion of the transaction.</span></span>
6. <span data-ttu-id="3b47b-225">Фоновый вычислительный узел извлекает данные о транзакциях, при необходимости выполняет последующую обработку, а затем отправляет данные в окончательное место хранения в текущей системе.</span><span class="sxs-lookup"><span data-stu-id="3b47b-225">Background compute node: Extract the transactional data, process it further if necessary, and send it to its final storage location in the current system.</span></span>

<span data-ttu-id="3b47b-226">На следующей схеме показан один из возможных вариантов реализации этой архитектуры в размещенной облачной службе Azure.</span><span class="sxs-lookup"><span data-stu-id="3b47b-226">The following diagram shows one possible implementation of this design in an Azure-hosted cloud service.</span></span>

![Обеспечение высокой доступности за счет слабых связей](./images/disaster-recovery-high-availability-azure-applications/application-high-availability-through-loose-coupling.png)

<span data-ttu-id="3b47b-228">Пунктирными линиями на схеме выше обозначена асинхронная обработка.</span><span class="sxs-lookup"><span data-stu-id="3b47b-228">The dashed arrows in the preceding diagram indicate asynchronous processing.</span></span> <span data-ttu-id="3b47b-229">Внутренняя веб-роль не учитывает асинхронную обработку.</span><span class="sxs-lookup"><span data-stu-id="3b47b-229">The front-end web role is not aware of this asynchronous processing.</span></span> <span data-ttu-id="3b47b-230">Эти пунктирные линии указывают на окончательное место хранения транзакции со ссылкой на текущую систему.</span><span class="sxs-lookup"><span data-stu-id="3b47b-230">This leads to the storage of the transaction at its final destination with reference to the current system.</span></span> <span data-ttu-id="3b47b-231">Из-за задержки, созданной асинхронной моделью, данные о транзакциях не сразу становятся доступными для запроса.</span><span class="sxs-lookup"><span data-stu-id="3b47b-231">Due to the latency that this asynchronous model introduces, the transactional data is not immediately available for query.</span></span> <span data-ttu-id="3b47b-232">Поэтому каждую единицу данных о транзакциях необходимо сохранить в кэше или пользовательском сеансе, чтобы сразу же обеспечивать соответствие требованиям пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="3b47b-232">Therefore, each unit of the transactional data needs to be saved in a cache or a user session to meet the immediate UI needs.</span></span>

<span data-ttu-id="3b47b-233">Веб-роль становится автономной и не зависит от остальной инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="3b47b-233">The web role is autonomous from the rest of the infrastructure.</span></span> <span data-ttu-id="3b47b-234">Ее доступность зависит от веб-роли и очереди Azure, а не от всей инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="3b47b-234">Its availability profile is a combination of the web role and the Azure queue and not the entire infrastructure.</span></span> <span data-ttu-id="3b47b-235">Помимо высокого уровня доступности такой подход позволяет веб-роли выполнять горизонтальное масштабирование независимо от серверного хранилища.</span><span class="sxs-lookup"><span data-stu-id="3b47b-235">In addition to high availability, this approach allows the web role to scale horizontally, independent of the back-end storage.</span></span> <span data-ttu-id="3b47b-236">Эта модель обеспечения высокого уровня доступности может влиять на затраты, связанные с операциями.</span><span class="sxs-lookup"><span data-stu-id="3b47b-236">This high-availability model can have an impact on the economics of operations.</span></span> <span data-ttu-id="3b47b-237">Использование дополнительных компонентов, таких как очереди и рабочие роли Azure, может повлиять на ежемесячные затраты.</span><span class="sxs-lookup"><span data-stu-id="3b47b-237">Additional components like Azure queues and worker roles can affect monthly usage costs.</span></span>

<span data-ttu-id="3b47b-238">На предыдущей схеме показан метод обеспечения высокой доступности за счет слабых связей.</span><span class="sxs-lookup"><span data-stu-id="3b47b-238">The previous diagram shows one implementation of this decoupled approach to transactional data.</span></span> <span data-ttu-id="3b47b-239">Но существуют и другие способы реализации.</span><span class="sxs-lookup"><span data-stu-id="3b47b-239">There are many other possible implementations.</span></span> <span data-ttu-id="3b47b-240">Ниже приведены некоторые альтернативы:</span><span class="sxs-lookup"><span data-stu-id="3b47b-240">The following list provides some alternatives:</span></span>

* <span data-ttu-id="3b47b-241">Рабочую роль можно разместить между веб-ролью и очередью хранилища.</span><span class="sxs-lookup"><span data-stu-id="3b47b-241">A worker role might be placed between the web role and the storage queue.</span></span>
* <span data-ttu-id="3b47b-242">Вместо очереди службы хранилища Azure можно использовать очередь служебной шины.</span><span class="sxs-lookup"><span data-stu-id="3b47b-242">A Service Bus queue can be used instead of an Azure Storage queue.</span></span>
* <span data-ttu-id="3b47b-243">В качестве окончательного места хранения можно использовать службу хранилища Azure или другой поставщик базы данных.</span><span class="sxs-lookup"><span data-stu-id="3b47b-243">The final destination might be Azure Storage or a different database provider.</span></span>
* <span data-ttu-id="3b47b-244">Кэш Azure можно использовать на веб-уровне, чтобы указать безотлагательные требования к кэшированию после выполнения транзакции.</span><span class="sxs-lookup"><span data-stu-id="3b47b-244">Azure Cache can be used at the web layer to provide the immediate caching requirements after the transaction.</span></span>

### <a name="scalability-patterns"></a><span data-ttu-id="3b47b-245">Шаблоны масштабируемости</span><span class="sxs-lookup"><span data-stu-id="3b47b-245">Scalability patterns</span></span>
<span data-ttu-id="3b47b-246">Важно отметить, что масштабируемость облачной службы напрямую влияет на доступность.</span><span class="sxs-lookup"><span data-stu-id="3b47b-246">It's important to note that the scalability of a cloud service directly affects availability.</span></span> <span data-ttu-id="3b47b-247">Если из-за увеличения нагрузки служба перестанет отвечать, может сложиться впечатление, что приложение не работает.</span><span class="sxs-lookup"><span data-stu-id="3b47b-247">If increased load causes your service to be unresponsive, the user perception is that the application is down.</span></span> <span data-ttu-id="3b47b-248">Следуйте проверенным рекомендациям по масштабированию в зависимости от необходимой нагрузки и ожидаемых возможностей приложения.</span><span class="sxs-lookup"><span data-stu-id="3b47b-248">Follow proven practices for scalability based on your expected application load and future expectations.</span></span> <span data-ttu-id="3b47b-249">При максимальном масштабировании необходимо учесть множество факторов, таких как количество используемых учетных записей хранения, общий доступ между несколькими базами данных и стратегии кэширования.</span><span class="sxs-lookup"><span data-stu-id="3b47b-249">Maximizing scale involves many considerations, such as single versus multiple storage accounts, sharing across multiple databases, and caching strategies.</span></span> <span data-ttu-id="3b47b-250">Подробные сведения об этих шаблонах см. в статье [Best Practices for Designing Large-Scale Services on Windows Azure](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/) (Рекомендации по разработке крупномасштабных служб в Windows Azure).</span><span class="sxs-lookup"><span data-stu-id="3b47b-250">For in-depth information about these patterns, see [Best practices for designing large-scale services on Microsoft Azure](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/).</span></span>

## <a name="next-steps"></a><span data-ttu-id="3b47b-251">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="3b47b-251">Next steps</span></span>
<span data-ttu-id="3b47b-252">В этой серии статей рассматривается аварийное восстановление и высокая доступность для приложений на платформе Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="3b47b-252">This series of documents covers disaster recovery and high availability for applications built on Microsoft Azure.</span></span> <span data-ttu-id="3b47b-253">Следующая статья в этой серии — [Disaster recovery for Azure applications](disaster-recovery-azure-applications.md) (Аварийное восстановление для приложений на платформе Azure).</span><span class="sxs-lookup"><span data-stu-id="3b47b-253">The next article in the series is [Disaster recovery for applications built on Microsoft Azure](disaster-recovery-azure-applications.md).</span></span>

