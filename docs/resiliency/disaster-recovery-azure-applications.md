---
title: "Аварийное восстановление для приложений Azure"
description: "Технический обзор и подробные сведения о разработке приложений c аварийным восстановлением на платформе Microsoft Azure."
author: adamglick
ms.date: 05/26/2017
ms.openlocfilehash: d415b27dd7928996e2a6dc7fd8fcf6a77c835768
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
[!INCLUDE [header](../_includes/header.md)]
# <a name="disaster-recovery-for-azure-applications"></a><span data-ttu-id="bd813-103">Аварийное восстановление для приложений Azure</span><span class="sxs-lookup"><span data-stu-id="bd813-103">Disaster recovery for Azure applications</span></span>
<span data-ttu-id="bd813-104">Стратегии повышения устойчивости и доступности направлены на обработку временных сбоев.</span><span class="sxs-lookup"><span data-stu-id="bd813-104">Resiliency and high availability strategies are intended to handling temporary failure conditions.</span></span> <span data-ttu-id="bd813-105">Аварийное восстановление подразумевает восстановление работоспособности после существенной потери функциональности приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-105">Disaster recovery (DR) is focused on recovering from a catastrophic loss of application functionality.</span></span> <span data-ttu-id="bd813-106">Например, вы можете подготовить план для запуска приложения или получения доступа к данным в другом регионе на случай сбоя в том регионе, где размещается это приложение.</span><span class="sxs-lookup"><span data-stu-id="bd813-106">For example, if an Azure region hosting your application becomes unavailable, you need a plan for running your application or accessing your data in another region.</span></span> <span data-ttu-id="bd813-107">Для реализации такого плана требуются определенные ресурсы для поддержания функциональности системы: специалисты, процессы и вспомогательные приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-107">Executing this plan involves people, processes, and supporting applications that allow the system to continue functioning.</span></span> <span data-ttu-id="bd813-108">Для проверки надежности этого плана следует выполнять моделирование сбоев и восстановление баз данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-108">Your plan should include rehearsing failures and testing the recovery of databases to ensure the plan is sound.</span></span> <span data-ttu-id="bd813-109">Руководители предприятий и ответственные за технические системы лица должны определить, какой режим работы и уровень функциональности служб нужно поддерживать во время сбоя.</span><span class="sxs-lookup"><span data-stu-id="bd813-109">The business and technology owners who define the system's operational mode for a disaster also determine the level of service functionality required during a disaster.</span></span> <span data-ttu-id="bd813-110">В общем случае различают следующие уровни функциональности: полная недоступность, частичная доступность (с ограниченной функциональностью или отложенной обработкой), полная доступность.</span><span class="sxs-lookup"><span data-stu-id="bd813-110">This level of functionality can take a few forms: completely unavailable, partially available via reduced functionality or delayed processing, or fully available.</span></span>

## <a name="azure-disaster-recovery-features"></a><span data-ttu-id="bd813-111">Функции аварийного восстановления Azure</span><span class="sxs-lookup"><span data-stu-id="bd813-111">Azure disaster recovery features</span></span>
<span data-ttu-id="bd813-112">Наряду с рекомендациями по обеспечению доступности Azure предоставляет [техническое руководство по обеспечению устойчивости](./index.md), которое поможет вам организовать аварийное восстановление.</span><span class="sxs-lookup"><span data-stu-id="bd813-112">As with availability considerations, Azure provides [resiliency technical guidance](./index.md) designed to support disaster recovery.</span></span> <span data-ttu-id="bd813-113">Функции доступности и аварийного восстановления Azure тесно связаны.</span><span class="sxs-lookup"><span data-stu-id="bd813-113">There is also a relationship between availability features of Azure and disaster recovery.</span></span> <span data-ttu-id="bd813-114">Например, управление ролями в доменах сбоя повышает доступность приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-114">For example, the management of roles across fault domains increases the availability of an application.</span></span> <span data-ttu-id="bd813-115">Без такого вида управления необработанный сбой оборудования стал бы аварийным сценарием.</span><span class="sxs-lookup"><span data-stu-id="bd813-115">Without that management, an unhandled hardware failure would become a “disaster” scenario.</span></span> <span data-ttu-id="bd813-116">Использование функций и стратегий обеспечения доступности является важным элементом стратегии защиты приложения от аварий.</span><span class="sxs-lookup"><span data-stu-id="bd813-116">Leveraging these availability features and strategies is an important part of disaster-proofing your application.</span></span> <span data-ttu-id="bd813-117">Однако в этой статье описываются не общие проблемы с доступностью, а более серьезные (и редкие) ситуации.</span><span class="sxs-lookup"><span data-stu-id="bd813-117">However, this article goes beyond general availability issues to more serious (and rarer) disaster events.</span></span>

## <a name="multiple-datacenter-regions"></a><span data-ttu-id="bd813-118">Несколько регионов центра обработки данных</span><span class="sxs-lookup"><span data-stu-id="bd813-118">Multiple datacenter regions</span></span>
<span data-ttu-id="bd813-119">Azure обслуживает центры обработки данных во множестве регионов по всему миру.</span><span class="sxs-lookup"><span data-stu-id="bd813-119">Azure maintains datacenters in many regions around the world.</span></span> <span data-ttu-id="bd813-120">В этой инфраструктуре поддерживается несколько сценариев аварийного восстановления, например системная георепликация службы хранилища Azure в дополнительные регионы.</span><span class="sxs-lookup"><span data-stu-id="bd813-120">This infrastructure supports several disaster recovery scenarios, such as system-provided geo-replication of Azure Storage to secondary regions.</span></span> <span data-ttu-id="bd813-121">Также вы можете легко и без лишних расходов развернуть облачную службу в нескольких расположениях по всему миру.</span><span class="sxs-lookup"><span data-stu-id="bd813-121">You can also easily and inexpensively deploy a cloud service to multiple locations around the world.</span></span> <span data-ttu-id="bd813-122">Это намного проще и дешевле, чем развертывать и поддерживать собственные центры обработки данных в нескольких регионах.</span><span class="sxs-lookup"><span data-stu-id="bd813-122">Compare this with the cost and difficulty of building and maintaining your own datacenters in multiple regions.</span></span> <span data-ttu-id="bd813-123">Развертывая данные и службы в нескольких регионах, вы защитите свое приложение от последствий серьезных сбоев в одном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-123">Deploying data and services to multiple regions helps protect your application from a major outage in a single region.</span></span> <span data-ttu-id="bd813-124">Создавая план аварийного восстановления, учитывайте концепцию пар регионов.</span><span class="sxs-lookup"><span data-stu-id="bd813-124">As you design your disaster recovery plan, it’s important to understand the concept of paired regions.</span></span> <span data-ttu-id="bd813-125">Дополнительные сведения см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="bd813-125">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>

## <a name="azure-traffic-manager"></a><span data-ttu-id="bd813-126">Azure Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="bd813-126">Azure Traffic Manager</span></span>
<span data-ttu-id="bd813-127">При сбое в одном регионе следует перенаправить трафик в службы или развертывания в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-127">When a region-specific failure occurs, you must redirect traffic to services or deployments in another region.</span></span> <span data-ttu-id="bd813-128">Для этого лучше всего использовать специальные службы, например диспетчер трафика Azure, который автоматически выполняет отработку отказа, переключая трафик пользователя на другой регион при сбое в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-128">It is most effective to handle this via services such as Azure Traffic Manager, which automates the failover of user traffic to another region if the primary region fails.</span></span> <span data-ttu-id="bd813-129">Чтобы создать эффективную стратегию аварийного восстановления, важно понимать принципы работы диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="bd813-129">Understanding the fundamentals of Traffic Manager is important when designing an effective DR strategy.</span></span>

<span data-ttu-id="bd813-130">Диспетчер трафика использует службу доменных имен (DNS) для направления клиентских запросов к наиболее подходящей конечной точке в зависимости от метода маршрутизации трафика и работоспособности конечных точек.</span><span class="sxs-lookup"><span data-stu-id="bd813-130">Traffic Manager uses the Domain Name System (DNS) to direct client requests to the most appropriate endpoint based on a traffic-routing method and the health of the endpoints.</span></span> <span data-ttu-id="bd813-131">На следующей схеме показано, как пользователи подключаются к URL-адресу диспетчера трафика (`http://myATMURL.trafficmanager.net`), за которым спрятаны фактические URL-адреса сайта (`http://app1URL.cloudapp.net` и `http://app2URL.cloudapp.net`).</span><span class="sxs-lookup"><span data-stu-id="bd813-131">In the following diagram, users connect to a Traffic Manager URL (`http://myATMURL.trafficmanager.net`) which abstracts the actual site URLs (`http://app1URL.cloudapp.net` and `http://app2URL.cloudapp.net`).</span></span> <span data-ttu-id="bd813-132">Запросы пользователей направляются на нужный базовый URL-адрес в соответствии с выбранным [методом маршрутизации диспетчера трафика](/azure/traffic-manager/traffic-manager-routing-methods).</span><span class="sxs-lookup"><span data-stu-id="bd813-132">User requests are routed to the proper underlying URL based on your configured [Traffic Manager routing method](/azure/traffic-manager/traffic-manager-routing-methods).</span></span> <span data-ttu-id="bd813-133">Согласно целям этой статьи мы уделим основное внимание отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="bd813-133">For the sake of this article, we will be concerned with only the failover option.</span></span>

![Маршрутизация с помощью диспетчера трафика Azure](./images/disaster-recovery-azure-applications/routing-using-azure-traffic-manager.png)

<span data-ttu-id="bd813-135">Настраивая диспетчер трафика, вы указываете для него новый префикс DNS, через который пользователи будут обращаться к службе.</span><span class="sxs-lookup"><span data-stu-id="bd813-135">When configuring Traffic Manager, you provide a new Traffic Manager DNS prefix, which users will use to access your service.</span></span> <span data-ttu-id="bd813-136">Теперь диспетчер трафика абстрагирует балансировку нагрузки не на уровне региона, а на один уровень выше.</span><span class="sxs-lookup"><span data-stu-id="bd813-136">Traffic Manager now abstracts load balancing one level higher that the regional level.</span></span> <span data-ttu-id="bd813-137">Служба DNS диспетчера трафика выполняет сопоставление с записью CNAME для всех развертываний, которыми она управляет.</span><span class="sxs-lookup"><span data-stu-id="bd813-137">The Traffic Manager DNS maps to a CNAME for all the deployments that it manages.</span></span>

<span data-ttu-id="bd813-138">Вы можете указать в диспетчере трафика список с приоритетными развертываниями, на которые будут направляться пользователи при сбое.</span><span class="sxs-lookup"><span data-stu-id="bd813-138">Within Traffic Manager, you specify a prioritized list of deployments that users will be routed to when failure occurs.</span></span> <span data-ttu-id="bd813-139">Диспетчер трафика отслеживает конечные точки развертывания.</span><span class="sxs-lookup"><span data-stu-id="bd813-139">Traffic Manager monitors the deployment endpoints.</span></span> <span data-ttu-id="bd813-140">Если основное развертывание становится недоступным, диспетчер трафика направляет пользователей к следующему в списке приоритетных.</span><span class="sxs-lookup"><span data-stu-id="bd813-140">If the primary deployment becomes unavailable, Traffic Manager routes users to the next deployment on the priority list.</span></span>

<span data-ttu-id="bd813-141">При отработке отказа диспетчер трафика самостоятельно выбирает расположение для перехода. Но вы можете самостоятельно и независимо от диспетчера трафика определять, будет ли домен, назначенный для отработки отказа, использоваться в обычном режиме работы.</span><span class="sxs-lookup"><span data-stu-id="bd813-141">Although Traffic Manager decides where to go during a failover, you can decide whether your failover domain is dormant or active while you're not in failover mode (which is unrelated to Traffic Manager).</span></span> <span data-ttu-id="bd813-142">Когда диспетчер трафика обнаруживает сбой на основном сайте, он переключается на сайт для отработки отказа, независимо от наличия подключенных к нему пользователей.</span><span class="sxs-lookup"><span data-stu-id="bd813-142">Traffic Manager detects a failure in the primary site and rolls over to the failover site, regardless of whether that site is currently serving users.</span></span>

<span data-ttu-id="bd813-143">Дополнительные сведения о том, как работает диспетчер трафика Azure, можно найти в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="bd813-143">For more information on how Azure Traffic Manager works, refer to:</span></span>

* [<span data-ttu-id="bd813-144">Обзор диспетчера трафика</span><span class="sxs-lookup"><span data-stu-id="bd813-144">Traffic Manager overview</span></span>](/azure/traffic-manager/traffic-manager-overview/)
* [<span data-ttu-id="bd813-145">Методы маршрутизации диспетчера трафика</span><span class="sxs-lookup"><span data-stu-id="bd813-145">Traffic Manager routing methods</span></span>](/azure/traffic-manager/traffic-manager-routing-methods)
* [<span data-ttu-id="bd813-146">Настройка метода маршрутизации с отработкой отказа</span><span class="sxs-lookup"><span data-stu-id="bd813-146">Configure failover routing method</span></span>](/azure/traffic-manager/traffic-manager-configure-failover-routing-method/)

## <a name="azure-disaster-scenarios"></a><span data-ttu-id="bd813-147">Сценарии сбоев в Azure</span><span class="sxs-lookup"><span data-stu-id="bd813-147">Azure disaster scenarios</span></span>
<span data-ttu-id="bd813-148">В следующих разделах описаны различные типы аварийных сценариев.</span><span class="sxs-lookup"><span data-stu-id="bd813-148">The following sections cover several different types of disaster scenarios.</span></span> <span data-ttu-id="bd813-149">Нарушения работы служб на уровне региона — не единственная причина сбоев на уровне приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-149">Region-wide service disruptions are not the only cause of application-wide failures.</span></span> <span data-ttu-id="bd813-150">Сбои могут происходить из-за неудачной архитектуры или ошибок в администрировании.</span><span class="sxs-lookup"><span data-stu-id="bd813-150">Poor design and administrative errors can also lead to outages.</span></span> <span data-ttu-id="bd813-151">Важно учитывать возможные причины сбоя во время разработки и тестирования плана восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-151">It's important to consider the possible causes of a failure during both the design and testing phases of your recovery plan.</span></span> <span data-ttu-id="bd813-152">План можно считать хорошим, если в нем задействуются возможности Azure, которые дополняются стратегиями для конкретных приложений.</span><span class="sxs-lookup"><span data-stu-id="bd813-152">A good plan takes advantage of Azure features and augments them with application-specific strategies.</span></span> <span data-ttu-id="bd813-153">Ответные действия определяются с учетом важности приложения, целевой точки восстановления (RPO) и целевого времени восстановления (RTO).</span><span class="sxs-lookup"><span data-stu-id="bd813-153">The chosen response is determined by the importance of the application, the recovery point objective (RPO), and the recovery time objective (RTO).</span></span>

### <a name="application-failure"></a><span data-ttu-id="bd813-154">Сбой приложения</span><span class="sxs-lookup"><span data-stu-id="bd813-154">Application failure</span></span>
<span data-ttu-id="bd813-155">Диспетчер трафика Azure автоматически обрабатывает сбои, возникающие в базовом оборудовании или программном обеспечении операционной системы на виртуальной машине узла.</span><span class="sxs-lookup"><span data-stu-id="bd813-155">Azure Traffic Manager automatically handles failures that result from the underlying hardware or operating system software in the host virtual machine.</span></span> <span data-ttu-id="bd813-156">Azure создает новый экземпляр роли и добавляет его в пул.</span><span class="sxs-lookup"><span data-stu-id="bd813-156">Azure creates a new role instance and adds it to the available pool.</span></span> <span data-ttu-id="bd813-157">Если уже выполняется несколько экземпляров этой роли, Azure перераспределяет обработку между другими работающими экземплярами роли и заменяет узел, на котором произошел сбой.</span><span class="sxs-lookup"><span data-stu-id="bd813-157">If  more than one role instance was already running, Azure shifts processing to the other running role instances while replacing the failed node.</span></span>

<span data-ttu-id="bd813-158">Серьезные ошибки в приложении могут происходить даже без отказа базового оборудования или операционной системы.</span><span class="sxs-lookup"><span data-stu-id="bd813-158">Serious application errors can occur without any underlying failure of the hardware or operating system.</span></span> <span data-ttu-id="bd813-159">Например, критические исключения в приложении могут быть вызваны ошибками в логике или нарушением целостности данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-159">The application might fail due to catastrophic exceptions caused by bad logic or data integrity issues.</span></span> <span data-ttu-id="bd813-160">Следует добавить в код приложения поддержку телеметрии, чтобы система мониторинга отслеживала ошибки и уведомляла о них администратора.</span><span class="sxs-lookup"><span data-stu-id="bd813-160">You must include sufficient telemetry in the application code so that a monitoring system can detect failure conditions and notify an application administrator.</span></span> <span data-ttu-id="bd813-161">Имея полные сведения о процессах аварийного восстановления, администратор сможет решить, следует ли запускать процесс отработки отказа или допустить некоторое нарушение доступности на период устранения критических ошибок.</span><span class="sxs-lookup"><span data-stu-id="bd813-161">An administrator who has full knowledge of the disaster recovery processes can decide whether to trigger a failover process or accept an availability outage while resolving the critical errors.</span></span>

### <a name="data-corruption"></a><span data-ttu-id="bd813-162">Повреждение данных</span><span class="sxs-lookup"><span data-stu-id="bd813-162">Data corruption</span></span>
<span data-ttu-id="bd813-163">Для обеспечения избыточности Azure автоматически создает три копии данных из базы данных SQL Azure и службы хранилища Azure в разных доменах сбоя в том же регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-163">Azure automatically stores Azure SQL Database and Azure Storage data three times redundantly within different fault domains in the same region.</span></span> <span data-ttu-id="bd813-164">При использовании георепликации создаются еще три экземпляра данных в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-164">If you use geo-replication, the data is stored three additional times in a different region.</span></span> <span data-ttu-id="bd813-165">Но если пользователи или приложение повреждают данные в основной копии, происходит быстрая репликация с использованием других копий.</span><span class="sxs-lookup"><span data-stu-id="bd813-165">However, if your users or your application corrupts that data in the primary copy, the data quickly replicates to the other copies.</span></span> <span data-ttu-id="bd813-166">К сожалению, в этом случае вы получите три копии поврежденных данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-166">Unfortunately, this results in multiple copies of corrupt data.</span></span>

<span data-ttu-id="bd813-167">Существует два варианта управления возможным повреждением данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-167">To manage potential corruption of your data, you have two options.</span></span> <span data-ttu-id="bd813-168">Во-первых, можно использовать управление пользовательской стратегией архивации.</span><span class="sxs-lookup"><span data-stu-id="bd813-168">First, you can manage a custom backup strategy.</span></span> <span data-ttu-id="bd813-169">В зависимости от бизнес-требований или нормативных требований резервные копии можно хранить в Azure или локально.</span><span class="sxs-lookup"><span data-stu-id="bd813-169">You can store your backups in Azure or on-premises, depending on your business requirements or governance regulations.</span></span> <span data-ttu-id="bd813-170">Также можно использовать альтернативную возможность восстановления базы данных SQL до точки во времени.</span><span class="sxs-lookup"><span data-stu-id="bd813-170">Another option is to use the point-in-time restore option to recover a SQL database.</span></span> <span data-ttu-id="bd813-171">Дополнительные сведения см. в разделе о [стратегиях аварийного восстановления данных](#data-strategies-for-disaster-recovery) ниже.</span><span class="sxs-lookup"><span data-stu-id="bd813-171">For more information, see the [data strategies for disaster recovery](#data-strategies-for-disaster-recovery) section below.</span></span>

### <a name="network-outage"></a><span data-ttu-id="bd813-172">Сбой сети</span><span class="sxs-lookup"><span data-stu-id="bd813-172">Network outage</span></span>
<span data-ttu-id="bd813-173">Если сеть Azure частично недоступна, вы можете потерять доступ к данным или приложениям.</span><span class="sxs-lookup"><span data-stu-id="bd813-173">When parts of the Azure network are inaccessible, you may be unable to access your application or data.</span></span> <span data-ttu-id="bd813-174">Если один или несколько экземпляров роли недоступны из-за проблем с сетью, Azure использует остальные доступные экземпляры приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-174">If one or more role instances are unavailable due to network issues, Azure uses the remaining available instances of your application.</span></span> <span data-ttu-id="bd813-175">Если приложение не может получить доступ к своим данным из-за сбоя сети Azure, можно работать локально с ограниченной функциональностью, используя кэшированные данные.</span><span class="sxs-lookup"><span data-stu-id="bd813-175">If your application cannot access its data because of an Azure network outage, you can potentially run with reduced application functionality locally by using cached data.</span></span> <span data-ttu-id="bd813-176">Чтобы использовать режим ограниченной функциональности приложения, нужно заранее разработать стратегию аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-176">You need to design the disaster recovery strategy to run with reduced functionality in your application.</span></span> <span data-ttu-id="bd813-177">Для некоторых приложений это может оказаться непрактично.</span><span class="sxs-lookup"><span data-stu-id="bd813-177">For some applications, this might not be practical.</span></span>

<span data-ttu-id="bd813-178">Кроме того, можно хранить данные в другом расположении до восстановления подключения.</span><span class="sxs-lookup"><span data-stu-id="bd813-178">Another option is to store data in an alternate location until connectivity is restored.</span></span> <span data-ttu-id="bd813-179">Если работа с ограниченной функциональностью невозможна, остаются два варианта: допустить простой приложения или переключиться на резервный регион.</span><span class="sxs-lookup"><span data-stu-id="bd813-179">If reducing functionality is not an option, the remaining options are application downtime or failover to an alternate region.</span></span> <span data-ttu-id="bd813-180">Разработка режима ограниченной функциональности предусматривает принятие не только технических, но и коммерческих решений.</span><span class="sxs-lookup"><span data-stu-id="bd813-180">The design of an application running with reduced functionality is as much a business decision as a technical one.</span></span> <span data-ttu-id="bd813-181">Этот вопрос обсуждается далее в разделе о [работе приложения с ограниченной функциональностью](#reduced-application-functionality).</span><span class="sxs-lookup"><span data-stu-id="bd813-181">This is discussed further in the section on [reduced application functionality](#reduced-application-functionality).</span></span>

### <a name="failure-of-a-dependent-service"></a><span data-ttu-id="bd813-182">Сбой зависимой службы</span><span class="sxs-lookup"><span data-stu-id="bd813-182">Failure of a dependent service</span></span>
<span data-ttu-id="bd813-183">В Azure доступно множество служб, каждая из которых периодически может становиться недоступной.</span><span class="sxs-lookup"><span data-stu-id="bd813-183">Azure provides many services that can experience periodic downtime.</span></span> <span data-ttu-id="bd813-184">Например [кэш Redis для Azure](https://azure.microsoft.com/services/cache/) — это мультитенантная служба, которая предоставляет приложению возможности кэширования.</span><span class="sxs-lookup"><span data-stu-id="bd813-184">For example, [Azure Redis Cache](https://azure.microsoft.com/services/cache/) is a multi-tenant service which provides caching capabilities to your application.</span></span> <span data-ttu-id="bd813-185">Важно учитывать, что происходит в приложении, если зависимая служба недоступна.</span><span class="sxs-lookup"><span data-stu-id="bd813-185">It's important to consider what happens in your application if the dependent service is unavailable.</span></span> <span data-ttu-id="bd813-186">Во многом этот сценарий похож на сценарий сбоя сети.</span><span class="sxs-lookup"><span data-stu-id="bd813-186">In many ways, this scenario is similar to the network outage scenario.</span></span> <span data-ttu-id="bd813-187">Тем не менее, оценивая каждую службу по отдельности, можно добиться улучшений в общем.</span><span class="sxs-lookup"><span data-stu-id="bd813-187">However, considering each service independently results in potential improvements to your overall plan.</span></span>

<span data-ttu-id="bd813-188">Кэш Redis для Azure обеспечивает кэширование для приложения в развертывании облачной службы, предоставляя преимущества аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-188">Azure Redis Cache provides caching to your application from within your cloud service deployment, which provides disaster recovery benefits.</span></span> <span data-ttu-id="bd813-189">Во-первых, теперь служба использует локальные роли развертывания.</span><span class="sxs-lookup"><span data-stu-id="bd813-189">First, the service now runs on roles that are local to your deployment.</span></span> <span data-ttu-id="bd813-190">Это позволяет более эффективно контролировать состояние кэша и проводить его мониторинг в рамках общего управления облачной службой.</span><span class="sxs-lookup"><span data-stu-id="bd813-190">Therefore, you're better able to monitor and manage the status of the cache as part of your overall management processes for the cloud service.</span></span> <span data-ttu-id="bd813-191">Этот тип кэширования включает новые функции, такие как высокая доступность кэшированных данных. Копии данных хранятся на нескольких узлах и сохраняются даже в случае сбоя на одном из них.</span><span class="sxs-lookup"><span data-stu-id="bd813-191">This type of caching also exposes new features such as high availability for cached data, which preserves cached data if a single node fails by maintaining duplicate copies on other nodes.</span></span>

<span data-ttu-id="bd813-192">Обратите внимание, что повышение доступности приводит к снижению пропускной способности и увеличению задержки, так как при любых операциях записи нужно обновлять все дополнительные копии.</span><span class="sxs-lookup"><span data-stu-id="bd813-192">Note that high availability decreases throughput and increases latency because write operations must also upedate any secondary copies.</span></span> <span data-ttu-id="bd813-193">Требования к объему хранилища для кэшированных данных фактически удваиваются, и это нужно принимать во внимание при планировании емкости.</span><span class="sxs-lookup"><span data-stu-id="bd813-193">The amount of memory required to store the cached data is effectively doubled, which must be taken into account during capacity planning.</span></span>  <span data-ttu-id="bd813-194">В этом примере показано, что каждая зависимая служба может предоставлять возможности, которые позволяют повысить общий уровень доступности и устойчивости к критическим сбоям.</span><span class="sxs-lookup"><span data-stu-id="bd813-194">This example demonstrates that each dependent service might have capabilities that improve your overall availability and resistance to catastrophic failures.</span></span>

<span data-ttu-id="bd813-195">Необходимо осознавать последствия сбоя каждой зависимой службы.</span><span class="sxs-lookup"><span data-stu-id="bd813-195">With each dependent service, you should understand the implications of a service disruption.</span></span> <span data-ttu-id="bd813-196">В этом примере кэширования доступ к данным можно получить прямо из базы данных до восстановления кэша.</span><span class="sxs-lookup"><span data-stu-id="bd813-196">In the caching example, it might be possible to access the data directly from a database until you restore your cache.</span></span> <span data-ttu-id="bd813-197">Это несколько снизит производительность, но зато сохранит полный доступ к данным приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-197">This would result in reduced performance while providing full access to application data.</span></span>

### <a name="region-wide-service-disruption"></a><span data-ttu-id="bd813-198">Нарушение работы служб на уровне региона</span><span class="sxs-lookup"><span data-stu-id="bd813-198">Region-wide service disruption</span></span>
<span data-ttu-id="bd813-199">С предыдущими сбоями можно справиться в одном регионе Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-199">The previous failures have primarily been failures that can be managed within the same Azure region.</span></span> <span data-ttu-id="bd813-200">Тем не менее следует также подготовиться к прерыванию работы службы во всем регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-200">However, you must also prepare for the possibility that there is a service disruption of the entire region.</span></span> <span data-ttu-id="bd813-201">В таком случае локальные избыточные копии данных недоступны.</span><span class="sxs-lookup"><span data-stu-id="bd813-201">If a region-wide service disruption occurs, the locally redundant copies of your data are not available.</span></span> <span data-ttu-id="bd813-202">Если георепликация включена, в другом регионе есть три дополнительные копии больших двоичных объектов и таблиц.</span><span class="sxs-lookup"><span data-stu-id="bd813-202">If you have enabled geo-replication, there are three additional copies of your blobs and tables in a different region.</span></span> <span data-ttu-id="bd813-203">Если Майкрософт объявит, что связь с регионом утеряна, Azure повторно сопоставит все записи DNS в регионе с георепликацией.</span><span class="sxs-lookup"><span data-stu-id="bd813-203">If Microsoft declares the region lost, Azure remaps all of the DNS entries to the geo-replicated region.</span></span>

> [!NOTE]
> <span data-ttu-id="bd813-204">Учтите, что этот процесс нельзя контролировать и он выполняется только при нарушении работы службы на уровне региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-204">Be aware that you don't have any control over this process, and it will occur only for region-wide service disruption.</span></span> <span data-ttu-id="bd813-205">Поэтому для обеспечения самого высокого уровня доступности необходимо использовать и другие стратегии архивации приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-205">Because of this, you must rely on other application-specific backup strategies to achieve the highest level of availability.</span></span> <span data-ttu-id="bd813-206">Дополнительные сведения см. в разделе о [стратегиях аварийного восстановления данных](#data-strategies-for-disaster-recovery).</span><span class="sxs-lookup"><span data-stu-id="bd813-206">For more information, see the section on [data strategies for disaster recovery](#data-strategies-for-disaster-recovery).</span></span>
> 
> 

### <a name="azure-wide-service-disruption"></a><span data-ttu-id="bd813-207">Нарушение работы служб на уровне среды Azure</span><span class="sxs-lookup"><span data-stu-id="bd813-207">Azure-wide service disruption</span></span>
<span data-ttu-id="bd813-208">При планировании аварийного восстановления необходимо учитывать весь диапазон возможных аварий.</span><span class="sxs-lookup"><span data-stu-id="bd813-208">In disaster planning, you must consider the entire range of possible disasters.</span></span> <span data-ttu-id="bd813-209">Самым серьезным нарушением работы служб считается ситуация, когда это произошло во всех регионах Azure одновременно.</span><span class="sxs-lookup"><span data-stu-id="bd813-209">One of the most severe service disruptions would involve all Azure regions simultaneously.</span></span> <span data-ttu-id="bd813-210">Как и в других сценариях с нарушениями работы служб, вы можете допустить риск временного простоя.</span><span class="sxs-lookup"><span data-stu-id="bd813-210">As with other service disruptions, you might decide to accept the risk of temporary downtime in that event.</span></span> <span data-ttu-id="bd813-211">Крупномасштабные нарушения работы служб, затрагивающие несколько регионов, случаются гораздо реже, чем локальные нарушения отдельных служб или регионов.</span><span class="sxs-lookup"><span data-stu-id="bd813-211">Widespread service disruptions that span regions are much rarer than isolated service disruptions involving dependent services or single regions.</span></span>

<span data-ttu-id="bd813-212">Но может сложиться и такая ситуация, когда для определенных важных приложений вам потребуется резервный план даже на случай прерывания работы служб в нескольких регионах.</span><span class="sxs-lookup"><span data-stu-id="bd813-212">However, you may decide that certain mission-critical applications require a backup plan for a multi-region service disruption.</span></span> <span data-ttu-id="bd813-213">Такой план может предусматривать переключение на службы, размещенные на [других облачных платформах](#alternative-cloud) или в [гибридных решениях](#hybrid-on-premises-and-cloud-solution).</span><span class="sxs-lookup"><span data-stu-id="bd813-213">This plan might include failing over to services in an [alternative cloud](#alternative-cloud) or a [hybrid on-premises and cloud solution](#hybrid-on-premises-and-cloud-solution).</span></span>

### <a name="reduced-application-functionality"></a><span data-ttu-id="bd813-214">Снижение функциональных возможностей приложения</span><span class="sxs-lookup"><span data-stu-id="bd813-214">Reduced application functionality</span></span>
<span data-ttu-id="bd813-215">В хорошо спроектированных приложениях обычно используется несколько служб, для взаимодействия между которыми используются модели обмена информацией со слабой связанностью.</span><span class="sxs-lookup"><span data-stu-id="bd813-215">A well-designed application typically uses services that communicate with each other though the implementation of loosely coupled information-interchange patterns.</span></span> <span data-ttu-id="bd813-216">Чтобы приложение поддерживало аварийное восстановление, необходимо разделить задачи на уровне служб.</span><span class="sxs-lookup"><span data-stu-id="bd813-216">A DR-friendly application requires separation of responsibilities at the service level.</span></span> <span data-ttu-id="bd813-217">Это предотвратит нарушение работы всего приложения при отказе одной зависимой службы.</span><span class="sxs-lookup"><span data-stu-id="bd813-217">This prevents the disruption of a dependent service from bringing down the entire application.</span></span> <span data-ttu-id="bd813-218">Например, рассмотрим приложение электронной торговли для компании Y. Оно может состоять из следующих модулей:</span><span class="sxs-lookup"><span data-stu-id="bd813-218">For example, consider a web commerce application for Company Y. The following modules might constitute the application:</span></span>

* <span data-ttu-id="bd813-219">**Каталог продуктов**. Здесь пользователи могут просматривать продукты.</span><span class="sxs-lookup"><span data-stu-id="bd813-219">**Product Catalog** allows users to browse products.</span></span>
* <span data-ttu-id="bd813-220">**Корзина**. Пользователи могут добавлять в корзину продукты и удалять их из нее.</span><span class="sxs-lookup"><span data-stu-id="bd813-220">**Shopping Cart** allows users to add/remove products in their shopping cart.</span></span>
* <span data-ttu-id="bd813-221">**Состояние заказа**. Состояние доставки заказов пользователей.</span><span class="sxs-lookup"><span data-stu-id="bd813-221">**Order Status** shows the shipping status of user orders.</span></span>
* <span data-ttu-id="bd813-222">**Отправка заказа**. Завершение сеанса покупок путем отправки заказа с оплатой.</span><span class="sxs-lookup"><span data-stu-id="bd813-222">**Order Submission** finalizes the shopping session by submitting the order with payment.</span></span>
* <span data-ttu-id="bd813-223">**Обработка заказа**. На этом этапе проверяется целостность данных заказа и выполняется проверка наличия товаров.</span><span class="sxs-lookup"><span data-stu-id="bd813-223">**Order Processing** validates the order for data integrity and performs a quantity availability check.</span></span>

<span data-ttu-id="bd813-224">Когда в приложении зависимость службы нарушена, как будет функционировать служба, пока эта зависимость не будет исправлена?</span><span class="sxs-lookup"><span data-stu-id="bd813-224">When a service dependency in this application becomes unavailable, how does the service function until the dependency recovers?</span></span> <span data-ttu-id="bd813-225">В хорошо спланированной системе существуют границы изоляции, созданные за счет разделения задач при ее проектировании и эксплуатации.</span><span class="sxs-lookup"><span data-stu-id="bd813-225">A well-designed system implements isolation boundaries through separation of responsibilities, both at design time and at runtime.</span></span> <span data-ttu-id="bd813-226">Каждую ошибку можно классифицировать как устранимую или неустранимую.</span><span class="sxs-lookup"><span data-stu-id="bd813-226">You can categorize every failure as recoverable and non-recoverable.</span></span> <span data-ttu-id="bd813-227">Неустранимые ошибки всегда приводят к сбою службы, а устранимые позволяют сохранить работоспособность, применяя альтернативные варианты.</span><span class="sxs-lookup"><span data-stu-id="bd813-227">Non-recoverable errors will bring down the service, but you can mitigate a recoverable error through alternatives.</span></span> <span data-ttu-id="bd813-228">Некоторые проблемы будут даже незаметны для пользователя, если для них автоматически выполняется обработка ошибок и использование альтернативных действий.</span><span class="sxs-lookup"><span data-stu-id="bd813-228">Certain problems addressed by automatically handling faults and taking alternate actions are transparent to the user.</span></span> <span data-ttu-id="bd813-229">При серьезных нарушениях в работе службы приложение может быть полностью недоступно.</span><span class="sxs-lookup"><span data-stu-id="bd813-229">During a more serious service disruption, the application might be completely unavailable.</span></span> <span data-ttu-id="bd813-230">Третий вариант — продолжить обработку запросов в режиме ограниченной функциональности.</span><span class="sxs-lookup"><span data-stu-id="bd813-230">A third option is to continue handling user requests with reduced functionality.</span></span>

<span data-ttu-id="bd813-231">Например, служба обработки заказов не может выполнять операции по продажам, когда недоступна соответствующая база данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-231">For instance, if the database for hosting orders goes down, the Order Processing service loses its ability to process sales transactions.</span></span> <span data-ttu-id="bd813-232">В зависимости от архитектуры работа служб приема и обработки заказов в такой ситуации существенно затруднится или станет невозможной.</span><span class="sxs-lookup"><span data-stu-id="bd813-232">Depending on the architecture, it might be difficult or impossible for the Order Submission and Order Processing services of the application to continue.</span></span> <span data-ttu-id="bd813-233">Если в приложении не предусмотрен такой сценарий, оно может перейти в автономный режим работы.</span><span class="sxs-lookup"><span data-stu-id="bd813-233">If the application is not designed to handle this scenario, the entire application might go offline.</span></span> <span data-ttu-id="bd813-234">Но если хранить данные о товарах в дополнительном расположении, модуль каталога можно будет и дальше использовать для просмотра списков и характеристик товаров.</span><span class="sxs-lookup"><span data-stu-id="bd813-234">However, if the product data is stored in a different location, then the Product Catalog module can still be used for viewing products.</span></span> <span data-ttu-id="bd813-235">При этом другие операции в приложении, например прием заказов и проверка наличия товара, будут недоступны.</span><span class="sxs-lookup"><span data-stu-id="bd813-235">However, other parts of the application are unavailable, such as ordering or inventory queries.</span></span>

<span data-ttu-id="bd813-236">Решения о том, какая часть функциональности будет поддерживаться, принимаются с учетом бизнес-целей и технических возможностей.</span><span class="sxs-lookup"><span data-stu-id="bd813-236">Deciding what reduced application functionality is available is both a business decision and a technical decision.</span></span> <span data-ttu-id="bd813-237">Важно определить, как приложение будет информировать пользователей о временных проблемах.</span><span class="sxs-lookup"><span data-stu-id="bd813-237">You must decide how the application will inform the users of any temporary problems.</span></span> <span data-ttu-id="bd813-238">Приложение из примера выше может сохранить функции просмотра и добавления товаров в корзину.</span><span class="sxs-lookup"><span data-stu-id="bd813-238">In the example above, the application might allow viewing products and adding them to a shopping cart.</span></span> <span data-ttu-id="bd813-239">Но если пользователь попытается совершить покупку, приложение сообщит ему, что обработка заказов временно недоступна.</span><span class="sxs-lookup"><span data-stu-id="bd813-239">However, when the user attempts to make a purchase, the application notifies the user that the ordering functionality is temporarily unavailable.</span></span> <span data-ttu-id="bd813-240">Это не лучший вариант для клиентов, но он позволяет избежать перерывов в работе службы на уровне приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-240">This isn't ideal for the customer, but it does prevent an application-wide service disruption.</span></span>

## <a name="data-strategies-for-disaster-recovery"></a><span data-ttu-id="bd813-241">Стратегии аварийного восстановления для данных</span><span class="sxs-lookup"><span data-stu-id="bd813-241">Data strategies for disaster recovery</span></span>
<span data-ttu-id="bd813-242">Правильная обработка данных — это очень сложный элемент плана аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-242">Proper data handling is a challenging aspect of a disaster recovery plan.</span></span> <span data-ttu-id="bd813-243">Обычно именно восстановление данных занимает больше всего времени при восстановлении после аварии.</span><span class="sxs-lookup"><span data-stu-id="bd813-243">During the recovery process, data restoration typically takes the most time.</span></span> <span data-ttu-id="bd813-244">Использование разных режимов поддержки ограниченной функциональности сопряжено с разными трудностями при восстановлении данных и поддержке согласованности.</span><span class="sxs-lookup"><span data-stu-id="bd813-244">Different choices for reducing functionality result in difficult challenges for data recovery from failure and consistency after failure.</span></span>

<span data-ttu-id="bd813-245">Например, важно обеспечить восстановление или сохранение копии всех данных приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-245">One consideration is the need to restore or maintain a copy of the application’s data.</span></span> <span data-ttu-id="bd813-246">Эти данные будут использоваться для ссылок и транзакций на дополнительном сайте.</span><span class="sxs-lookup"><span data-stu-id="bd813-246">You will use this data for reference and transactional purposes at a secondary site.</span></span> <span data-ttu-id="bd813-247">Чтобы применить для локального развертывания стратегию защиты от сбоя, затрагивающего несколько регионов, потребуется долгий и сложный процесс планирования.</span><span class="sxs-lookup"><span data-stu-id="bd813-247">An on-premises deployment requires an expensive and lengthy planning process to implement a multiple-region disaster recovery strategy.</span></span> <span data-ttu-id="bd813-248">К счастью, большинство поставщиков облачных услуг, в том числе Azure, позволяют развертывать приложения в различных регионах.</span><span class="sxs-lookup"><span data-stu-id="bd813-248">Conveniently, most cloud providers, including Azure, readily allow the deployment of applications to multiple regions.</span></span> <span data-ttu-id="bd813-249">Эти регионы так географически распределены, чтобы нарушение работы службы в нескольких регионах случалось крайне редко.</span><span class="sxs-lookup"><span data-stu-id="bd813-249">These regions are geographically distributed in such a way that multiple-region service disruption should be extremely rare.</span></span> <span data-ttu-id="bd813-250">Стратегия обработки данных в разных регионах является одним из ключевых факторов успешного выполнения любого плана аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-250">The strategy for handling data across regions is one of the contributing factors for the success of any disaster recovery plan.</span></span>

<span data-ttu-id="bd813-251">В следующих разделах рассматриваются методы аварийного восстановления, связанные с архивированием данных, а также ссылочными данными и данными о транзакциях.</span><span class="sxs-lookup"><span data-stu-id="bd813-251">The following sections discuss disaster recovery techniques related to data backups, reference data, and transactional data.</span></span>

### <a name="backup-and-restore"></a><span data-ttu-id="bd813-252">Архивация и восстановление</span><span class="sxs-lookup"><span data-stu-id="bd813-252">Backup and restore</span></span>
<span data-ttu-id="bd813-253">При регулярной архивации данных приложения могут поддерживаться некоторые сценарии аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-253">Regular backups of application data can support some disaster recovery scenarios.</span></span> <span data-ttu-id="bd813-254">Для различных ресурсов хранения требуются разные методы.</span><span class="sxs-lookup"><span data-stu-id="bd813-254">Different storage resources require different techniques.</span></span>

#### <a name="sql-database"></a><span data-ttu-id="bd813-255">База данных SQL</span><span class="sxs-lookup"><span data-stu-id="bd813-255">SQL Database</span></span>
<span data-ttu-id="bd813-256">Для восстановления уровней базы данных SQL (цен. категория "Базовый", "Стандартный" и "Премиум") преимущества предоставляет восстановление до точки во времени.</span><span class="sxs-lookup"><span data-stu-id="bd813-256">For the Basic, Standard, and Premium SQL Database tiers, you can take advantage of point-in-time restore to recover your database.</span></span> <span data-ttu-id="bd813-257">Дополнительные сведения см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](/azure/sql-database/sql-database-business-continuity/).</span><span class="sxs-lookup"><span data-stu-id="bd813-257">For more information, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span> <span data-ttu-id="bd813-258">Кроме того, можно использовать активную георепликацию для базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="bd813-258">Another option is to use Active Geo-Replication for SQL Database.</span></span> <span data-ttu-id="bd813-259">При этом изменения базы данных автоматически реплицируются в базы данных-получатели в том же или даже в другом регионе Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-259">This automatically replicates database changes to secondary databases in the same Azure region or even in a different Azure region.</span></span> <span data-ttu-id="bd813-260">Такой вариант представляет собой потенциальную альтернативу некоторым методам синхронизации данных вручную, представленных в этой статье.</span><span class="sxs-lookup"><span data-stu-id="bd813-260">This provides a potential alternative to some of the more manual data synchronization techniques presented in this article.</span></span> <span data-ttu-id="bd813-261">Дополнительные сведения см. в статье [Обзор: активная георепликация для базы данных SQL](/azure/sql-database/sql-database-geo-replication-overview/).</span><span class="sxs-lookup"><span data-stu-id="bd813-261">For more information, see [Overview: SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/).</span></span>

<span data-ttu-id="bd813-262">При архивации и восстановлении также можно использовать подход, предусматривающий больше ручных действий.</span><span class="sxs-lookup"><span data-stu-id="bd813-262">You can also use a more manual approach for backup and restore.</span></span> <span data-ttu-id="bd813-263">Используйте команду копирования базы данных, чтобы создать резервную копию базы данных с согласованностью на уровне транзакций.</span><span class="sxs-lookup"><span data-stu-id="bd813-263">Use the DATABASE COPY command to create a backup copy of the database with transactional consistency.</span></span> <span data-ttu-id="bd813-264">Также вы можете использовать службу импорта и экспорта базы данных SQL Azure, которая поддерживает экспорт базы данных в BACPAC-файлы (содержат схему базы данных и соответствующие данные в сжатом виде), которые расположены в хранилище больших двоичных объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-264">You can also use the import/export service of Azure SQL Database, which supports exporting databases to BACPAC files (compressed files containing your database schema and associated data) that are stored in Azure Blob storage.</span></span>

<span data-ttu-id="bd813-265">Благодаря встроенной избыточности службы хранилища Azure в одном регионе создается две реплики файла резервной копии.</span><span class="sxs-lookup"><span data-stu-id="bd813-265">The built-in redundancy of Azure Storage creates two replicas of the backup file in the same region.</span></span> <span data-ttu-id="bd813-266">Тем не менее от частоты архивации зависит RPO, т. е. объем данных, которые можно потерять при сбое.</span><span class="sxs-lookup"><span data-stu-id="bd813-266">However, the frequency of running the backup process determines your RPO, which is the amount of data you might lose in disaster scenarios.</span></span> <span data-ttu-id="bd813-267">Предположим, что вы выполняете резервное копирование в начале каждого часа, а сбой происходит за две минуты до конца очередного часа.</span><span class="sxs-lookup"><span data-stu-id="bd813-267">For example, imagine that you perform a backup at the top of each hour, and a disaster occurs two minutes before the top of the hour.</span></span> <span data-ttu-id="bd813-268">В этом случае вы теряете все данные, созданные за 58 минут с момента последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="bd813-268">You lose 58 minutes of data recorded after the last backup was performed.</span></span> <span data-ttu-id="bd813-269">Кроме того, чтобы обеспечить защиту на случай нарушения работы службы на уровне региона, необходимо скопировать файлы BACPAC в другой регион.</span><span class="sxs-lookup"><span data-stu-id="bd813-269">Also, to protect against a region-wide service disruption, you should copy the BACPAC files to an alternate region.</span></span> <span data-ttu-id="bd813-270">Затем вы сможете восстановить эти резервные копии в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-270">You then have the option of restoring those backups in the alternate region.</span></span> <span data-ttu-id="bd813-271">Дополнительные сведения см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](/azure/sql-database/sql-database-business-continuity/).</span><span class="sxs-lookup"><span data-stu-id="bd813-271">For more details, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span>

#### <a name="azure-storage"></a><span data-ttu-id="bd813-272">Хранилище Azure</span><span class="sxs-lookup"><span data-stu-id="bd813-272">Azure Storage</span></span>
<span data-ttu-id="bd813-273">Для службы хранилища Azure можно разработать пользовательский процесс резервного копирования или применить одно из множества средств резервного копирования, созданных сторонними поставщиками.</span><span class="sxs-lookup"><span data-stu-id="bd813-273">For Azure Storage, you can develop a custom backup process or use one of many third-party backup tools.</span></span> <span data-ttu-id="bd813-274">Обратите внимание, что в большинстве приложений возникают дополнительные сложности, если ресурсы хранения ссылаются друг на друга.</span><span class="sxs-lookup"><span data-stu-id="bd813-274">Note that most application designs have additional complexities where storage resources reference each other.</span></span> <span data-ttu-id="bd813-275">Например, рассмотрим базу данных SQL, в которой есть столбец, ссылающийся на большой двоичный объект в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-275">For example, consider a SQL database that has a column that links to a blob in Azure Storage.</span></span> <span data-ttu-id="bd813-276">Если резервное копирование не выполняется для всех элементов одновременно, в базе данных может сохраниться указатель на большой двоичный объект, для которого не существует резервной копии.</span><span class="sxs-lookup"><span data-stu-id="bd813-276">If the backups do not happen simultaneously, the database might have a pointer to a blob that was not backed up before the failure.</span></span> <span data-ttu-id="bd813-277">Приложение или план аварийного восстановления должны реализовать процессы для обработки этой несогласованности после восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-277">The application or disaster recovery plan must implement processes to handle this inconsistency after a recovery.</span></span>

#### <a name="other-data-platforms"></a><span data-ttu-id="bd813-278">Другие платформы данных</span><span class="sxs-lookup"><span data-stu-id="bd813-278">Other data platforms</span></span>
<span data-ttu-id="bd813-279">Для других платформ размещения IaaS (инфраструктура как услуга), например Elasticsearch или MongoDB, доступны другие возможности и особенности, которые нужно учитывать при разработке интегрированного процесса резервного копирования и восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-279">Other infrastructure-as-a-service (IaaS) hosted data platforms, such as Elasticsearch or MongoDB, have their own capabilities and considerations when creating an integrated backup and restore process.</span></span> <span data-ttu-id="bd813-280">Обычно мы рекомендуем использовать для этих платформ встроенные или специально разработанные средства репликации и создания моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="bd813-280">For these data platforms, the general recommendation is to use any native or available integration-based replication or snapshotting capabilities.</span></span> <span data-ttu-id="bd813-281">Если такие возможности не существуют или не подходят для ваших задач, попробуйте применить службу архивации Azure или моментальные снимки для управляемых и неуправляемых дисков, чтобы создавать копии данных приложения на определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="bd813-281">If those capabilities do not exist or are not suitable, then consider using Azure Backup Service or managed/unmanaged disk snapshots to create a point-in-time copy of application data.</span></span> <span data-ttu-id="bd813-282">Во всех случаях важно определить, как обеспечить согласованность резервных копий, особенно если данные приложения распределены между несколькими файловыми системами или одна файловая система размещена на нескольких дисках, объединенных с помощью диспетчеров томов или программных RAID-массивов.</span><span class="sxs-lookup"><span data-stu-id="bd813-282">In all cases, it’s important to determine how to achieve consistent backups, especially when application data spans multiple files systems, or when multiple drives are combined into a single file system using volume managers or software-based RAID.</span></span>

### <a name="reference-data-pattern-for-disaster-recovery"></a><span data-ttu-id="bd813-283">Шаблон ссылочных данных для аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="bd813-283">Reference data pattern for disaster recovery</span></span>
<span data-ttu-id="bd813-284">Ссылочные данные — это данные только для чтения, которые поддерживают функциональные возможности приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-284">Reference data is read-only data that supports application functionality.</span></span> <span data-ttu-id="bd813-285">Обычно они редко изменяются.</span><span class="sxs-lookup"><span data-stu-id="bd813-285">It typically does not change frequently.</span></span> <span data-ttu-id="bd813-286">Хотя архивация и восстановление представляют один из методов устранения нарушений в работе служб на уровне региона, целевое время восстановления при этом относительно велико.</span><span class="sxs-lookup"><span data-stu-id="bd813-286">Although backup and restore is one method to handle region-wide service disruptions, the RTO is relatively long.</span></span> <span data-ttu-id="bd813-287">При развертывании приложения в дополнительном регионе можно применить несколько стратегий, которые позволяют добиться малого целевого времени восстановления для ссылочных данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-287">When you deploy the application to a secondary region, some strategies can improve the RTO for reference data.</span></span>

<span data-ttu-id="bd813-288">Так как ссылочные данные изменяются редко, целевое время восстановления можно уменьшить, создав постоянную копию ссылочных данных в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-288">Because reference data changes infrequently, you can improve the RTO by maintaining a permanent copy of the reference data in the secondary region.</span></span> <span data-ttu-id="bd813-289">Это уменьшает количество времени, необходимое на восстановление из резервных копий в случае сбоя.</span><span class="sxs-lookup"><span data-stu-id="bd813-289">This eliminates the time required to restore backups in the event of a disaster.</span></span> <span data-ttu-id="bd813-290">В соответствии с требованиями к аварийному восстановлению после сбоев в нескольких регионах необходимо развернуть приложение и ссылочные данные одновременно во всех них.</span><span class="sxs-lookup"><span data-stu-id="bd813-290">To meet the multiple-region disaster recovery requirements, you must deploy the application and the reference data together in multiple regions.</span></span> <span data-ttu-id="bd813-291">Как указано в разделе [Шаблон ссылочных данных для обеспечения высокой доступности](high-availability-azure-applications.md#reference-data-pattern-for-high-availability), ссылочные данные можно развернуть в роли, во внешнем хранилище или и там, и там.</span><span class="sxs-lookup"><span data-stu-id="bd813-291">As mentioned in [Reference data pattern for high availability](high-availability-azure-applications.md#reference-data-pattern-for-high-availability), you can deploy reference data to the role itself, to external storage, or to a combination of both.</span></span>

<span data-ttu-id="bd813-292">Модель развертывания ссылочных данных на вычислительных узлах неявно удовлетворяет требованиям аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-292">The reference data deployment model within compute nodes implicitly satisfies the disaster recovery requirements.</span></span> <span data-ttu-id="bd813-293">При развертывании ссылочных данных в базе данных SQL необходимо развернуть их копию в каждом регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-293">Reference data deployment to SQL Database requires that you deploy a copy of the reference data to each region.</span></span> <span data-ttu-id="bd813-294">Та же стратегия применяется к службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-294">The same strategy applies to Azure Storage.</span></span> <span data-ttu-id="bd813-295">Необходимо развернуть копию всех ссылочных данных в службе хранилища Azure в основном и дополнительном регионах.</span><span class="sxs-lookup"><span data-stu-id="bd813-295">You must deploy a copy of any reference data that's stored in Azure Storage to the primary and secondary regions.</span></span>

![Публикация ссылочных данных в основном и дополнительном регионах](./images/disaster-recovery-azure-applications/reference-data-publication-to-both-primary-and-secondary-regions.png)

<span data-ttu-id="bd813-297">Для всех данных, в том числе ссылочных, необходимо реализовать свои процессы архивации в зависимости от приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-297">You must implement your own application-specific backup routines for all data, including reference data.</span></span> <span data-ttu-id="bd813-298">Геореплицированные копии в регионах используются только при нарушении работы служб на уровне региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-298">Geo-replicated copies across regions are used only in a region-wide service disruption.</span></span> <span data-ttu-id="bd813-299">Чтобы предотвратить длительные простои, разверните критически важные компоненты данных приложения в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-299">To prevent extended downtime, deploy the mission-critical parts of the application’s data to the secondary region.</span></span> <span data-ttu-id="bd813-300">Пример этой топологии см. в разделе о [модели "активный — пассивный"](#active-passive).</span><span class="sxs-lookup"><span data-stu-id="bd813-300">For an example of this topology, see the [active-passive model](#active-passive).</span></span>

### <a name="transactional-data-pattern-for-disaster-recovery"></a><span data-ttu-id="bd813-301">Шаблон данных о транзакциях для аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="bd813-301">Transactional data pattern for disaster recovery</span></span>
<span data-ttu-id="bd813-302">Реализация полнофункциональной стратегии режима аварийного восстановления требует асинхронной репликации данных о транзакциях в дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="bd813-302">Implementation of a fully functional disaster mode strategy requires asynchronous replication of the transactional data to the secondary region.</span></span> <span data-ttu-id="bd813-303">Фактический период репликации будет служить для определения характеристик RPO приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-303">The practical time windows within which the replication can occur will determine the RPO characteristics of the application.</span></span> <span data-ttu-id="bd813-304">В течение этого периода все еще можно восстановить данные, утерянные из основного региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-304">You might still recover the data that was lost from the primary region during the replication window.</span></span> <span data-ttu-id="bd813-305">Кроме того, позже можно будет объединить эти данные с данными дополнительного региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-305">You might also be able to merge with the secondary region later.</span></span>

<span data-ttu-id="bd813-306">В следующих примерах архитектуры представлены идеи в отношении различных способов обработки данных о транзакциях при отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="bd813-306">The following architecture examples provide some ideas on different ways of handling transactional data in a failover scenario.</span></span> <span data-ttu-id="bd813-307">Важно отметить, что они не являются исчерпывающими.</span><span class="sxs-lookup"><span data-stu-id="bd813-307">It's important to note that these examples are not exhaustive.</span></span> <span data-ttu-id="bd813-308">Например, промежуточные места хранения, такие как очереди, можно заменить Базой данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-308">For example, intermediate storage locations such as queues might be replaced with Azure SQL Database.</span></span> <span data-ttu-id="bd813-309">Это могут быть очереди службы хранилища Azure или служебной шины Azure (см. статью [Очереди Azure и очереди служебной шины: сходства и различия](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/)).</span><span class="sxs-lookup"><span data-stu-id="bd813-309">The queues themselves might be either Azure Storage or Azure Service Bus queues (see [Azure queues and Service Bus queues - compared and contrasted](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/)).</span></span> <span data-ttu-id="bd813-310">Кроме того, можно использовать разные хранилища серверов, например таблицы Azure вместо базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="bd813-310">Server storage destinations might also vary, such as Azure tables instead of SQL Database.</span></span> <span data-ttu-id="bd813-311">Помимо этого на различных этапах в качестве посредников могут добавляться рабочие роли.</span><span class="sxs-lookup"><span data-stu-id="bd813-311">In addition, worker roles might be inserted as intermediaries in various steps.</span></span> <span data-ttu-id="bd813-312">Не нужно слепо копировать эти архитектуры. Важно оценить разные варианты действий по восстановлению данных о транзакциях и связанных модулей.</span><span class="sxs-lookup"><span data-stu-id="bd813-312">The intent is not to emulate these architectures exactly, but to consider various alternatives in the recovery of transactional data and related modules.</span></span>

#### <a name="replication-of-transactional-data-in-preparation-for-disaster-recovery"></a><span data-ttu-id="bd813-313">Репликация данных о транзакциях при подготовке к аварийному восстановлению</span><span class="sxs-lookup"><span data-stu-id="bd813-313">Replication of transactional data in preparation for disaster recovery</span></span>
<span data-ttu-id="bd813-314">Рассмотрим приложение, в котором данные о транзакциях хранятся в очередях службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-314">Consider an application that uses Azure Storage queues to hold transactional data.</span></span> <span data-ttu-id="bd813-315">В этом сценарии рабочие роли могут обрабатывать данные о транзакциях в базе данных сервера в несвязанной архитектуре.</span><span class="sxs-lookup"><span data-stu-id="bd813-315">This allows worker roles to process the transactional data to the server database in a decoupled architecture.</span></span> <span data-ttu-id="bd813-316">Если внутренним ролям необходимо немедленно запрашивать эти данные, транзакции должны использовать временное кэширование.</span><span class="sxs-lookup"><span data-stu-id="bd813-316">This requires the transactions to use some form of temporary caching if the front-end roles require the immediate query of that data.</span></span> <span data-ttu-id="bd813-317">В зависимости от допустимого уровня потери данных можно реплицировать очереди, базу данных или все ресурсы хранения.</span><span class="sxs-lookup"><span data-stu-id="bd813-317">Depending on the level of data-loss tolerance, you might choose to replicate the queues, the database, or all of the storage resources.</span></span> <span data-ttu-id="bd813-318">Если реплицируется только база данных, при сбое основного региона данные в очередях можно по-прежнему восстановить после восстановлении работы основного региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-318">With only database replication, if the primary region goes down, you can still recover the data in the queues when the primary region comes back.</span></span>

<span data-ttu-id="bd813-319">На следующей схеме показана архитектура, где базы данных сервера синхронизируются в разных регионах.</span><span class="sxs-lookup"><span data-stu-id="bd813-319">The following diagram shows an architecture where the server database is synchronized across regions.</span></span>

![Репликация данных о транзакциях при подготовке к аварийному восстановлению](./images/disaster-recovery-azure-applications/replicate-transactional-data-in-preparation-for-disaster-recovery.png)

<span data-ttu-id="bd813-321">Самой большой сложностью при реализации этой архитектуры является разработка стратегии репликации между регионами.</span><span class="sxs-lookup"><span data-stu-id="bd813-321">The biggest challenge to implementing this architecture is the replication strategy between regions.</span></span> <span data-ttu-id="bd813-322">[Служба синхронизации данных SQL Azure](/azure/sql-database/sql-database-get-started-sql-data-sync/) позволяет выполнить такую репликацию.</span><span class="sxs-lookup"><span data-stu-id="bd813-322">The [Azure SQL Data Sync](/azure/sql-database/sql-database-get-started-sql-data-sync/) service enables this type of replication.</span></span> <span data-ttu-id="bd813-323">На момент написания статьи эта служба доступна в режиме предварительной версии. Мы не рекомендуем использовать ее в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="bd813-323">As of this writing, the service is in preview and is not yet recommended for production environments.</span></span> <span data-ttu-id="bd813-324">Дополнительные сведения см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](/azure/sql-database/sql-database-business-continuity/).</span><span class="sxs-lookup"><span data-stu-id="bd813-324">For more information, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span> <span data-ttu-id="bd813-325">Для рабочих приложений необходимо приобрести решение стороннего поставщика или создать собственную логику репликации в коде.</span><span class="sxs-lookup"><span data-stu-id="bd813-325">For production applications, you must invest in a third-party solution or create your own replication logic in code.</span></span> <span data-ttu-id="bd813-326">В зависимости от архитектуры может потребоваться более сложная двусторонняя репликация.</span><span class="sxs-lookup"><span data-stu-id="bd813-326">Depending on the architecture, the replication might be bidirectional, which is more complex.</span></span>

<span data-ttu-id="bd813-327">В одном из возможных способов реализации можно использовать промежуточную очередь из предыдущего примера.</span><span class="sxs-lookup"><span data-stu-id="bd813-327">One potential implementation might make use of the intermediate queue in the previous example.</span></span> <span data-ttu-id="bd813-328">Рабочая роль, обрабатывающая данные в конечном хранилище, может вносить изменения в основном и дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-328">The worker role that processes the data to the final storage destination might make the change in both the primary region and the secondary region.</span></span> <span data-ttu-id="bd813-329">Это непростые задачи. Полное руководство по написанию кода репликации выходит за рамки этой статьи.</span><span class="sxs-lookup"><span data-stu-id="bd813-329">These are not trivial tasks, and complete guidance for replication code is beyond the scope of this article.</span></span> <span data-ttu-id="bd813-330">Уделяйте достаточно времени и проводите тестирование, чтобы разработать правильный подход к репликации данных в дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="bd813-330">Invest significant time and testing into the approach for replicating data to the secondary region.</span></span> <span data-ttu-id="bd813-331">Чтобы убедиться, что при отработке отказа и восстановлении все возможные несоответствия данных или повторяющиеся транзакции обрабатываются правильно, можно провести дополнительную обработку и тестирование.</span><span class="sxs-lookup"><span data-stu-id="bd813-331">Additional processing and testing can help ensure that the failover and recovery processes correctly handle any possible data inconsistencies or duplicate transactions.</span></span>

> [!NOTE]
> <span data-ttu-id="bd813-332">Основная часть этого документа посвящена модели "платформа как услуга" (PaaS).</span><span class="sxs-lookup"><span data-stu-id="bd813-332">Most of this paper focuses on platform as a service (PaaS).</span></span> <span data-ttu-id="bd813-333">Однако существуют дополнительные варианты репликации и обеспечения доступности для гибридных приложений, использующих виртуальные машины Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-333">However, additional replication and availability options for hybrid applications use Azure Virtual Machines.</span></span> <span data-ttu-id="bd813-334">В этих гибридных приложениях для размещения SQL Server на виртуальных машинах в Azure используется модель "инфраструктура как услуга" (IaaS).</span><span class="sxs-lookup"><span data-stu-id="bd813-334">These hybrid applications use infrastructure as a service (IaaS) to host SQL Server on virtual machines in Azure.</span></span> <span data-ttu-id="bd813-335">Это позволяет использовать традиционные подходы к обеспечению доступности в SQL Server, например группы доступности AlwaysOn и доставку журналов.</span><span class="sxs-lookup"><span data-stu-id="bd813-335">This allows traditional availability approaches in SQL Server, such as AlwaysOn Availability Groups or Log Shipping.</span></span> <span data-ttu-id="bd813-336">Некоторые методы, например AlwaysOn, работают только между локальными экземплярами SQL Server и виртуальными машинами Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-336">Some techniques, such as AlwaysOn, work only between on-premises SQL Server instances and Azure virtual machines.</span></span> <span data-ttu-id="bd813-337">Дополнительные сведения см. в статье [Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span><span class="sxs-lookup"><span data-stu-id="bd813-337">For more information, see [High availability and disaster recovery for SQL Server in Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>
> 
> 

#### <a name="reduced-application-functionality-for-transaction-capture"></a><span data-ttu-id="bd813-338">Снижение функциональных возможностей приложения для записи транзакций</span><span class="sxs-lookup"><span data-stu-id="bd813-338">Reduced application functionality for transaction capture</span></span>
<span data-ttu-id="bd813-339">Рассмотрим вторую архитектуру, которая работает в режиме снижения функциональности.</span><span class="sxs-lookup"><span data-stu-id="bd813-339">Consider a second architecture that operates with reduced functionality.</span></span> <span data-ttu-id="bd813-340">Когда приложение выполняется в дополнительном регионе, отключаются все дополнительные возможности, такие как отчетность, бизнес-аналитика и обработка очередей.</span><span class="sxs-lookup"><span data-stu-id="bd813-340">The application in the secondary region deactivates all the functionality, such as reporting, business intelligence (BI), or draining queues.</span></span> <span data-ttu-id="bd813-341">Оно принимает только самые важные типы транзакционных рабочих процессов в соответствии с бизнес-требованиями.</span><span class="sxs-lookup"><span data-stu-id="bd813-341">It accepts only the most important types of transactional workflows, as defined by business requirements.</span></span> <span data-ttu-id="bd813-342">Система фиксирует транзакции и записывает их в очереди.</span><span class="sxs-lookup"><span data-stu-id="bd813-342">The system captures the transactions and writes them to queues.</span></span> <span data-ttu-id="bd813-343">На начальной стадии нарушения работы службы система может отложить обработку данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-343">The system might postpone processing the data during the initial stage of the service disruption.</span></span> <span data-ttu-id="bd813-344">Если система в основном регионе восстанавливается в течение ожидаемого времени, рабочие роли в этом регионе могут освободить очереди.</span><span class="sxs-lookup"><span data-stu-id="bd813-344">If the system on the primary region is reactivated within the expected time window, the worker roles in the primary region can drain the queues.</span></span> <span data-ttu-id="bd813-345">В результате не нужно объединять базы данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-345">This process eliminates the need for database merging.</span></span> <span data-ttu-id="bd813-346">Если нарушение работы службы основного региона выходит за рамки допустимого периода, приложение может начать обработку очередей.</span><span class="sxs-lookup"><span data-stu-id="bd813-346">If the primary region service disruption goes beyond the tolerable window, the application can start processing the queues.</span></span>

<span data-ttu-id="bd813-347">В этом сценарии база данных в дополнительном регионе содержит дополнительные данные о транзакциях, которые необходимо объединить после восстановления основного региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-347">In this scenario, the database in the secondary region contains incremental transactional data that must be merged after the primary is reactivated.</span></span> <span data-ttu-id="bd813-348">На следующей схеме показана эта стратегия для временного хранения данных о транзакциях до восстановления основного региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-348">The following diagram shows this strategy for temporarily storing transactional data until the primary region is restored.</span></span>

![Снижение функциональных возможностей приложения для записи транзакций](./images/disaster-recovery-azure-applications/reduced-application-functionality-for-transaction-capture.png)

<span data-ttu-id="bd813-350">Дополнительные сведения о методах управления данными для устойчивых приложений Azure см. на странице [FailSafe: Building Scalable, Resilient Cloud Services](https://channel9.msdn.com/Series/FailSafe) (Отказоустойчивость. Создание устойчивых облачных служб).</span><span class="sxs-lookup"><span data-stu-id="bd813-350">For more discussion of data management techniques for resilient Azure applications, see [Failsafe: Guidance for Resilient Cloud Architectures](https://channel9.msdn.com/Series/FailSafe).</span></span>

## <a name="deployment-topologies-for-disaster-recovery"></a><span data-ttu-id="bd813-351">Топологии развертывания для аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="bd813-351">Deployment topologies for disaster recovery</span></span>
<span data-ttu-id="bd813-352">Критически важные приложения нужно подготовить к обработке сбоев служб на уровне региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-352">You must prepare mission-critical applications to handle region-wide service disruptions.</span></span> <span data-ttu-id="bd813-353">Включите в план действий стратегию развертывания в нескольких регионах.</span><span class="sxs-lookup"><span data-stu-id="bd813-353">Incorporate a multiple-region deployment strategy into the operational planning.</span></span>

<span data-ttu-id="bd813-354">При развертывании в нескольких регионах могут потребоваться отдельные ИТ-процессы, которые позволяют в случае сбоя опубликовать приложения и ссылочные данные, размещенные в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-354">Multiple-region deployments might involve IT processes to publish the application and reference data to the secondary region after a disaster.</span></span> <span data-ttu-id="bd813-355">Если приложение требует мгновенной отработки отказа, развертывание может включать настройку "активный — пассивный" или "активный — активный".</span><span class="sxs-lookup"><span data-stu-id="bd813-355">If the application requires instant failover, the deployment process might involve an active/passive setup or an active/active setup.</span></span> <span data-ttu-id="bd813-356">Этот тип развертывания предусматривает существующие экземпляры приложения, работающие в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-356">This type of deployment has existing instances of the application running in the alternate region.</span></span> <span data-ttu-id="bd813-357">Служба маршрутизации, например диспетчер трафика Azure, предоставляет службы балансировки нагрузки на уровне DNS.</span><span class="sxs-lookup"><span data-stu-id="bd813-357">A routing service such as Azure Traffic Manager provides load-balancing services at the DNS level.</span></span> <span data-ttu-id="bd813-358">Оно может определить нарушения в работе службы и при необходимости перенаправить пользователей в другие регионы.</span><span class="sxs-lookup"><span data-stu-id="bd813-358">It can detect service disruptions and route the users to different regions when needed.</span></span>

<span data-ttu-id="bd813-359">Чтобы успешно выполнять аварийное восстановление в Azure, эта возможность должна учитываться в архитектуре решения с самого начала.</span><span class="sxs-lookup"><span data-stu-id="bd813-359">A successful Azure disaster recovery includes building that recovery into the solution from the start.</span></span> <span data-ttu-id="bd813-360">В облаке предусмотрены дополнительные варианты аварийного восстановления после сбоев, недоступные у традиционных поставщиков услуг размещения.</span><span class="sxs-lookup"><span data-stu-id="bd813-360">The cloud provides additional options for recovering from failures during a disaster that are not available in a traditional hosting provider.</span></span> <span data-ttu-id="bd813-361">В частности, вы можете динамически и быстро выделять ресурсы в другом регионе, чтобы платить за них в период простоя, то есть до сбоя.</span><span class="sxs-lookup"><span data-stu-id="bd813-361">Specifically, you can dynamically and quickly allocate resources in a different region, avoiding the cost of idle resources prior to a failure.</span></span>

<span data-ttu-id="bd813-362">В следующих разделах рассматриваются различные топологии развертывания для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-362">The following sections cover different deployment topologies for disaster recovery.</span></span> <span data-ttu-id="bd813-363">Как правило, при повышении уровня доступности необходимо идти на компромисс между увеличением затрат или сложности.</span><span class="sxs-lookup"><span data-stu-id="bd813-363">Typically, there's a tradeoff in increased cost or complexity for additional availability.</span></span>

### <a name="single-region-deployment"></a><span data-ttu-id="bd813-364">Развертывание в одном регионе</span><span class="sxs-lookup"><span data-stu-id="bd813-364">Single-region deployment</span></span>
<span data-ttu-id="bd813-365">На самом деле развертывание в одном регионе не является топологией аварийного восстановления. Оно рассматривается в качестве противопоставления другим архитектурам.</span><span class="sxs-lookup"><span data-stu-id="bd813-365">A single-region deployment is not really a disaster recovery topology, but is meant to contrast with the other architectures.</span></span> <span data-ttu-id="bd813-366">Развертывание в одном регионе — распространенная практика для приложений в Azure, но она не соответствует требованиям к топологии для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-366">Single-region deployments are common for applications in Azure; however, they do not meet the requirements of a disaster recovery topology.</span></span>

<span data-ttu-id="bd813-367">На следующей схеме показано приложение, работающее в одном регионе Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-367">The following diagram depicts an application running in a single Azure region.</span></span> <span data-ttu-id="bd813-368">Диспетчер трафика Azure, а также использование доменов сбоя и обновления повышают уровень доступности приложения в пределах региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-368">Azure Traffic Manager and the use of fault and upgrade domains increase availability of the application within the region.</span></span>

![Развертывание в одном регионе](./images/disaster-recovery-azure-applications/single-region-deployment.png)

<span data-ttu-id="bd813-370">В этом сценарии база данных является единой точкой отказа.</span><span class="sxs-lookup"><span data-stu-id="bd813-370">In this scenario, the database is a single point of failure.</span></span> <span data-ttu-id="bd813-371">Хотя Azure реплицирует данные нескольких доменов сбоя во внутренние реплики, все это происходит в одном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-371">Though Azure replicates the data across different fault domains to internal replicas, this replication occurs only within the same region.</span></span> <span data-ttu-id="bd813-372">Приложение не может выдержать разрушительный сбой.</span><span class="sxs-lookup"><span data-stu-id="bd813-372">The application cannot withstand a catastrophic failure.</span></span> <span data-ttu-id="bd813-373">Недоступность всего региона затронет все домены сбоя, в том числе все экземпляры служб и ресурсы хранилищ.</span><span class="sxs-lookup"><span data-stu-id="bd813-373">If the region becomes unavailable, then so do the fault domains, including all service instances and storage resources.</span></span>

<span data-ttu-id="bd813-374">Для всех приложений, кроме наименее важных, необходимо создать план развертывания в нескольких регионах.</span><span class="sxs-lookup"><span data-stu-id="bd813-374">For all but the least critical applications, you must devise a plan to deploy your applications across multiple regions.</span></span> <span data-ttu-id="bd813-375">При выборе используемой топологии необходимо также учитывать целевое время восстановления и ограничения бюджета.</span><span class="sxs-lookup"><span data-stu-id="bd813-375">You should also consider RTO and cost constraints in considering which deployment topology to use.</span></span>

<span data-ttu-id="bd813-376">Теперь давайте рассмотрим некоторые подходы к отработке отказа между регионами.</span><span class="sxs-lookup"><span data-stu-id="bd813-376">Let’s take a look now at specific approaches to supporting failover across different regions.</span></span> <span data-ttu-id="bd813-377">В этих примерах для описания процесса используются два региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-377">These examples all use two regions to describe the process.</span></span>

### <a name="redeployment-to-a-secondary-azure-region"></a><span data-ttu-id="bd813-378">Повторное развертывание в дополнительном регионе Azure</span><span class="sxs-lookup"><span data-stu-id="bd813-378">Redeployment to a secondary Azure region</span></span>
<span data-ttu-id="bd813-379">Если используется метод повторного развертывания в дополнительном регионе, все приложения и базы данных будут выполняться только в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-379">For the approach of redeployment to a secondary region, only the primary region has applications and databases running.</span></span> <span data-ttu-id="bd813-380">Дополнительный регион не настроен для автоматической отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="bd813-380">The secondary region is not set up for an automatic failover.</span></span> <span data-ttu-id="bd813-381">Поэтому при сбое все компоненты службы необходимо развернуть в новом регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-381">So when a disaster occurs, you must spin up all the parts of the service in the new region.</span></span> <span data-ttu-id="bd813-382">При этом нужно добавить облачную службу в Azure, развернуть облачную службу, восстановить данные и изменить DNS для перенаправления трафика.</span><span class="sxs-lookup"><span data-stu-id="bd813-382">This includes uploading a cloud service to Azure, deploying the cloud service, restoring the data, and changing DNS to reroute the traffic.</span></span>

<span data-ttu-id="bd813-383">Хотя это и самый доступный вариант для нескольких регионов, он предполагает максимальное целевое время восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-383">Although this is the most affordable of the multiple-region options, it has the worst RTO characteristics.</span></span> <span data-ttu-id="bd813-384">В этой модели резервные копии пакета службы и базы данных сохраняются локально или в экземпляре хранилища BLOB-объектов Azure в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-384">In this model, the service package and database backups are stored either on-premises or in the Azure Blob storage instance of the secondary region.</span></span> <span data-ttu-id="bd813-385">Тем не менее до возобновления работы нужно развернуть новую службу и восстановить данные.</span><span class="sxs-lookup"><span data-stu-id="bd813-385">However, you must deploy a new service and restore the data before it resumes operation.</span></span> <span data-ttu-id="bd813-386">Даже если передача данных из хранилища резервных копий полностью автоматизирована, развертывание новой среды для базы данных занимает много времени.</span><span class="sxs-lookup"><span data-stu-id="bd813-386">Even with full automation of the data transfer from backup storage, provisioning a new database environment consumes a lot of time.</span></span> <span data-ttu-id="bd813-387">Перенос данных из дискового хранилища резервных копий в пустую базу данных в дополнительном регионе — самый дорогостоящий этап восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-387">Moving data from the backup disk storage to the empty database on the secondary region is the most expensive part of the restore process.</span></span> <span data-ttu-id="bd813-388">Тем не менее его нужно выполнить, чтобы запустить новую базу данных, так как она не реплицируется.</span><span class="sxs-lookup"><span data-stu-id="bd813-388">You must do this, however, to bring the new database to an operational state because it isn't replicated.</span></span>

<span data-ttu-id="bd813-389">Лучше всего хранить пакеты службы в хранилище BLOB-объектов в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-389">The best approach is to store the service packages in Blob storage in the secondary region.</span></span> <span data-ttu-id="bd813-390">Это устраняет необходимость передавать пакет в Azure, что происходит при развертывании из локального компьютера разработки.</span><span class="sxs-lookup"><span data-stu-id="bd813-390">This eliminates the need to upload the package to Azure, which is what happens when you deploy from an on-premises development machine.</span></span> <span data-ttu-id="bd813-391">Вы можете быстро развернуть пакеты службы в новой облачной службе из хранилища BLOB-объектов, используя сценарии PowerShell.</span><span class="sxs-lookup"><span data-stu-id="bd813-391">You can quickly deploy the service packages to a new cloud service from Blob storage by using PowerShell scripts.</span></span>

<span data-ttu-id="bd813-392">Этот вариант применим только для некритических приложений, которые допускают высокое значение целевого времени восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-392">This option is practical only for non-critical applications that can tolerate a high RTO.</span></span> <span data-ttu-id="bd813-393">Например, если для приложения допускается простой длительностью в несколько часов, но не более суток.</span><span class="sxs-lookup"><span data-stu-id="bd813-393">For instance, this might work for an application that can be down for several hours but is required to be available within 24 hours.</span></span>

![Повторное развертывание в дополнительном регионе Azure](./images/disaster-recovery-azure-applications/redeploy-to-a-secondary-azure-region.png)

### <a name="active-passive"></a><span data-ttu-id="bd813-395">Шаблон "активный — пассивный"</span><span class="sxs-lookup"><span data-stu-id="bd813-395">Active-passive</span></span>
<span data-ttu-id="bd813-396">Многие компании предпочитают топологию "активный — пассивный".</span><span class="sxs-lookup"><span data-stu-id="bd813-396">An active-passive topology is the choice that many companies favor.</span></span> <span data-ttu-id="bd813-397">Такая топология позволяет улучшить показатели целевого времени восстановления, незначительно увеличивая затраты по сравнению с повторным развертыванием.</span><span class="sxs-lookup"><span data-stu-id="bd813-397">This topology provides improvements to the RTO with a relatively small increase in cost over the redeployment approach.</span></span> <span data-ttu-id="bd813-398">В этом сценарии также используются основной и дополнительный регион Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-398">In this scenario, there is again a primary and a secondary Azure region.</span></span> <span data-ttu-id="bd813-399">Весь трафик передается в активное развертывание в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-399">All of the traffic goes to the active deployment on the primary region.</span></span> <span data-ttu-id="bd813-400">Дополнительный регион лучше подготовлен к аварийному восстановлению, так как база данных работает в обоих регионах.</span><span class="sxs-lookup"><span data-stu-id="bd813-400">The secondary region is better prepared for disaster recovery because the database is running on both regions.</span></span> <span data-ttu-id="bd813-401">Кроме того, между ними настроен механизм синхронизации.</span><span class="sxs-lookup"><span data-stu-id="bd813-401">Additionally, a synchronization mechanism is in place between them.</span></span> <span data-ttu-id="bd813-402">Существует два варианта такого резервного подхода: только с использованием базы данных или полное развертывание в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-402">This standby approach can involve two variations: a database-only approach or a complete deployment in the secondary region.</span></span>

#### <a name="database-only"></a><span data-ttu-id="bd813-403">Только база данных</span><span class="sxs-lookup"><span data-stu-id="bd813-403">Database only</span></span>
<span data-ttu-id="bd813-404">В первом варианте топологии "активный — пассивный" облачная служба приложения развернута только в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-404">In the first variation of the active-passive topology, only the primary region has a deployed cloud service application.</span></span> <span data-ttu-id="bd813-405">Но в отличие от метода повторного развертывания, здесь содержимое базы данных синхронизируется между регионами.</span><span class="sxs-lookup"><span data-stu-id="bd813-405">However, unlike the redeployment approach, both regions are synchronized with the contents of the database.</span></span> <span data-ttu-id="bd813-406">Дополнительные сведения см. в разделе о [шаблоне данных о транзакциях для аварийного восстановления](#transactional-data-pattern-for-disaster-recovery). При сбое требований к активации меньше.</span><span class="sxs-lookup"><span data-stu-id="bd813-406">(For more information, see the section on [transactional data pattern for disaster recovery](#transactional-data-pattern-for-disaster-recovery).) When a disaster occurs, there are fewer activation requirements.</span></span> <span data-ttu-id="bd813-407">Необходимо запустить приложение в дополнительном регионе, изменить строки подключения к новой базе данных, а также записи DNS, чтобы перенаправить трафик.</span><span class="sxs-lookup"><span data-stu-id="bd813-407">You start the application in the secondary region, change connection strings to the new database, and change the DNS entries to reroute traffic.</span></span>

<span data-ttu-id="bd813-408">Как и в методе повторного развертывания, пакеты служб нужно заранее разместить в хранилище BLOB-объектов Azure в дополнительном регионе, чтобы ускорить развертывание.</span><span class="sxs-lookup"><span data-stu-id="bd813-408">Like the redeployment approach, you should have already stored the service packages in Azure Blob storage in the secondary region for faster deployment.</span></span> <span data-ttu-id="bd813-409">Но так вы заметно сократите расходы на восстановление базы данных, так как база данных уже подготовлена и запущена.</span><span class="sxs-lookup"><span data-stu-id="bd813-409">However, you don’t incur the majority of the overhead that database restore operation requires, because the database is ready and running.</span></span> <span data-ttu-id="bd813-410">Это существенно ускоряет процесс аварийного восстановления, поэтому такой подход очень доступен и широко распространен.</span><span class="sxs-lookup"><span data-stu-id="bd813-410">This saves a significant amount of time, making this an affordable DR pattern (and the one most frequently used).</span></span>

![Шаблон "активный — пассивный" (только база данных)](./images/disaster-recovery-azure-applications/active-passive-database-only.png)

#### <a name="full-replica"></a><span data-ttu-id="bd813-412">Полная реплика</span><span class="sxs-lookup"><span data-stu-id="bd813-412">Full replica</span></span>
<span data-ttu-id="bd813-413">Во втором варианте топологии "активный — пассивный" полное развертывание содержится и в основном, и в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-413">In the second variation of the active-passive topology, both the primary region and the secondary region have a full deployment.</span></span> <span data-ttu-id="bd813-414">Это развертывание включает в себя облачные службы и синхронизированную базу данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-414">This deployment includes the cloud services and a synchronized database.</span></span> <span data-ttu-id="bd813-415">Однако только основной регион активно обрабатывает сетевые запросы от пользователей.</span><span class="sxs-lookup"><span data-stu-id="bd813-415">However, only the primary region is actively handling network requests from the users.</span></span> <span data-ttu-id="bd813-416">Дополнительный регион становится активным, только если в основном регионе происходит нарушение работы службы.</span><span class="sxs-lookup"><span data-stu-id="bd813-416">The secondary region becomes active only when the primary region experiences a service disruption.</span></span> <span data-ttu-id="bd813-417">В этом случае все новые сетевые запросы перенаправляются в дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="bd813-417">In that case, all new network requests route to the secondary region.</span></span> <span data-ttu-id="bd813-418">Диспетчер трафика Azure может автоматически управлять такой отработкой отказа.</span><span class="sxs-lookup"><span data-stu-id="bd813-418">Azure Traffic Manager can manage this failover automatically.</span></span>

<span data-ttu-id="bd813-419">Отработка отказа выполняется быстрее, чем в варианте, когда используется только база данных, так как службы уже развернуты.</span><span class="sxs-lookup"><span data-stu-id="bd813-419">Failover occurs faster than the database-only variation because the services are already deployed.</span></span> <span data-ttu-id="bd813-420">Эта топология гарантирует очень низкое значение RTO.</span><span class="sxs-lookup"><span data-stu-id="bd813-420">This topology provides a very low RTO.</span></span> <span data-ttu-id="bd813-421">Дополнительный регион для отработки отказа должен быть готов к работе сразу после сбоя основного региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-421">The secondary failover region must be ready to go immediately after failure of the primary region.</span></span>

<span data-ttu-id="bd813-422">Помимо ускорения отклика, эта топология избавляет и от риска нехватки пространства для размещения экземпляров и служб, копируемых в случае сбоя, выделяя и размещая все ресурсы заранее.</span><span class="sxs-lookup"><span data-stu-id="bd813-422">Along with a quicker response time, this topology pre-allocates and deploys backup services, avoiding the possibility of a lack of space to allocate new instances during a disaster.</span></span> <span data-ttu-id="bd813-423">Это следует учитывать, если дополнительный регион Azure близок к заполнению.</span><span class="sxs-lookup"><span data-stu-id="bd813-423">This is important if your secondary Azure region is nearing capacity.</span></span> <span data-ttu-id="bd813-424">Соглашения об уровне обслуживания не гарантируют мгновенное развертывание одной или нескольких облачных служб в любом регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-424">No service-level agreement (SLA) guarantees that you can instantly deploy one or more new cloud services in any region.</span></span>

<span data-ttu-id="bd813-425">Чтобы добиться минимального времени отклика в этой модели, необходимо использовать один и тот же масштаб (количество экземпляров ролей) в основном и дополнительном регионах.</span><span class="sxs-lookup"><span data-stu-id="bd813-425">For the fastest response time with this model, you must have similar scale (number of role instances) in the primary and secondary regions.</span></span> <span data-ttu-id="bd813-426">Несмотря на преимущества, есть неиспользуемые вычислительные операции, которые дорого обходятся, поэтому это не самый выгодный вариант с финансовой точки зрения.</span><span class="sxs-lookup"><span data-stu-id="bd813-426">Despite the advantages, paying for unused compute instances is costly, and this might not be the most prudent financial choice.</span></span> <span data-ttu-id="bd813-427">По этой причине чаще всего используется версия облачных служб меньшего масштаба в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-427">Because of this, it's more common to use a slightly scaled-down version of cloud services on the secondary region.</span></span> <span data-ttu-id="bd813-428">Затем при необходимости можно быстро выполнить отработку отказа и дополнительное развертывание.</span><span class="sxs-lookup"><span data-stu-id="bd813-428">Then you can quickly fail over and scale out the secondary deployment if necessary.</span></span> <span data-ttu-id="bd813-429">Следует автоматизировать отработку отказа, чтобы в случае недоступности основного региона можно было активировать дополнительные экземпляры в зависимости от нагрузки.</span><span class="sxs-lookup"><span data-stu-id="bd813-429">You should automate the failover process so that after the primary region is inaccessible, you activate additional instances, depending on the load.</span></span> <span data-ttu-id="bd813-430">При этом может использоваться механизм автоматического масштабирования, например [наборы для масштабирования виртуальных машин](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span><span class="sxs-lookup"><span data-stu-id="bd813-430">This might involve the use of an autoscaling mechanism like [virtual machine scale sets](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span></span>

<span data-ttu-id="bd813-431">На следующей схеме показана модель топологии "активный — пассивный", в которой основной и дополнительный регионы содержат полностью развернутую облачную службу.</span><span class="sxs-lookup"><span data-stu-id="bd813-431">The following diagram shows the model where the primary and secondary regions contain a fully deployed cloud service in an active-passive topology.</span></span>

![Шаблон "активный — пассивный" (полная реплика)](./images/disaster-recovery-azure-applications/active-passive-full-replica.png)

### <a name="active-active"></a><span data-ttu-id="bd813-433">Шаблон "активный — активный"</span><span class="sxs-lookup"><span data-stu-id="bd813-433">Active-active</span></span>
<span data-ttu-id="bd813-434">В топологии "активный — активный" облачные службы и база данных полностью развернуты в обоих регионах.</span><span class="sxs-lookup"><span data-stu-id="bd813-434">In an active-active topology, the cloud services and database are fully deployed in both regions.</span></span> <span data-ttu-id="bd813-435">В отличие от трафика в модели "активный-пассивный" трафик от пользователей передается в оба региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-435">Unlike the active-passive model, both regions receive user traffic.</span></span> <span data-ttu-id="bd813-436">Этот вариант обеспечивает минимальное время восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-436">This option yields the quickest recovery time.</span></span> <span data-ttu-id="bd813-437">Службы уже масштабированы для обработки части нагрузки в каждом регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-437">The services are already scaled to handle a portion of the load at each region.</span></span> <span data-ttu-id="bd813-438">DNS уже настроена для использования в дополнительном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-438">DNS is already enabled to use the secondary region.</span></span> <span data-ttu-id="bd813-439">Но при определении способа маршрутизации пользователей в соответствующий регион возникают дополнительные сложности.</span><span class="sxs-lookup"><span data-stu-id="bd813-439">There's additional complexity in determining how to route users to the appropriate region.</span></span> <span data-ttu-id="bd813-440">В этом случае возможно планирование циклического перебора.</span><span class="sxs-lookup"><span data-stu-id="bd813-440">Round-robin scheduling might be possible.</span></span> <span data-ttu-id="bd813-441">Скорее всего, некоторые пользователи будут использовать определенный регион, где хранится основная копия их данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-441">It's more likely that certain users would use a specific region where the primary copy of their data resides.</span></span>

<span data-ttu-id="bd813-442">В случае отработки отказа просто отключите DNS в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-442">In case of failover, simply disable DNS to the primary region.</span></span> <span data-ttu-id="bd813-443">Таким образом весь трафик будет направлен в дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="bd813-443">This routes all traffic to the secondary region.</span></span>

<span data-ttu-id="bd813-444">Даже для этой модели доступны некоторые варианты.</span><span class="sxs-lookup"><span data-stu-id="bd813-444">Even in this model, there are some variations.</span></span> <span data-ttu-id="bd813-445">Например, на следующей схеме представлен основной регион, который содержит мастер-копию базы данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-445">For example, the following diagram depicts a primary region which owns the master copy of the database.</span></span> <span data-ttu-id="bd813-446">Облачные службы в обоих регионах записывают данные в эту базу данных-источник.</span><span class="sxs-lookup"><span data-stu-id="bd813-446">The cloud services in both regions write to that primary database.</span></span> <span data-ttu-id="bd813-447">Дополнительное развертывание может считывать данные из базы данных-источника или реплицированной базы данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-447">The secondary deployment can read from the primary or replicated database.</span></span> <span data-ttu-id="bd813-448">В этом примере репликация происходит в одном направлении.</span><span class="sxs-lookup"><span data-stu-id="bd813-448">Replication in this example is one-way.</span></span>

![Шаблон "активный — активный"](./images/disaster-recovery-azure-applications/active-active.png)

<span data-ttu-id="bd813-450">В архитектуре на основе шаблона "активный — активный" на предыдущей схеме есть недостаток.</span><span class="sxs-lookup"><span data-stu-id="bd813-450">There is a downside to the active-active architecture in the preceding diagram.</span></span> <span data-ttu-id="bd813-451">Во втором регионе должен быть доступ к базе данных первого региона, так как там содержится мастер-копия.</span><span class="sxs-lookup"><span data-stu-id="bd813-451">The second region must access the database in the first region because the master copy resides there.</span></span> <span data-ttu-id="bd813-452">Производительность значительно уменьшается при доступе к данным за пределами региона.</span><span class="sxs-lookup"><span data-stu-id="bd813-452">Performance significantly drops off when you access data from outside a region.</span></span> <span data-ttu-id="bd813-453">Чтобы повысить производительность вызовов базы данных в различных регионах, следует разработать определенную стратегию пакетной обработки.</span><span class="sxs-lookup"><span data-stu-id="bd813-453">In cross-region database calls, you should consider some type of batching strategy to improve the performance of these calls.</span></span> <span data-ttu-id="bd813-454">Дополнительные сведения см. в статье [Как повысить производительность приложений базы данных SQL с помощью пакетной обработки](/azure/sql-database/sql-database-use-batching-to-improve-performance/).</span><span class="sxs-lookup"><span data-stu-id="bd813-454">For more information, see [How to use batching to improve SQL Database application performance](/azure/sql-database/sql-database-use-batching-to-improve-performance/).</span></span>

<span data-ttu-id="bd813-455">В альтернативной архитектуре каждый регион может получать прямой доступ к своей базе данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-455">An alternative architecture might involve each region accessing its own database directly.</span></span> <span data-ttu-id="bd813-456">В этой модели для синхронизации баз данных в каждом регионе требуется двунаправленная репликация.</span><span class="sxs-lookup"><span data-stu-id="bd813-456">In that model, some type of bidirectional replication is required to synchronize the databases in each region.</span></span>

<span data-ttu-id="bd813-457">Описанные выше топологии позволяют снизить RTO за счет увеличения стоимости и сложности развертывания.</span><span class="sxs-lookup"><span data-stu-id="bd813-457">With the previous topologies, decreasing RTO generally increases costs and complexity.</span></span> <span data-ttu-id="bd813-458">Но топология "активный — активный" имеет другие характеристики.</span><span class="sxs-lookup"><span data-stu-id="bd813-458">The active-active topology deviates from this cost pattern.</span></span> <span data-ttu-id="bd813-459">В рамках этой топологии можно использовать в основном регионе меньше экземпляров по сравнению с топологией "активный — пассивный".</span><span class="sxs-lookup"><span data-stu-id="bd813-459">In the active-active topology, you might not need as many instances on the primary region as you would in the active-passive topology.</span></span> <span data-ttu-id="bd813-460">Если в архитектуре на основе шаблона "активный — пассивный" в основном регионе есть 10 экземпляров, в архитектуре на основе шаблона "активный — активный" в каждом регионе может потребоваться всего 5 экземпляров.</span><span class="sxs-lookup"><span data-stu-id="bd813-460">If you have 10 instances on the primary region in an active-passive architecture, you might need only 5 in each region in an active-active architecture.</span></span> <span data-ttu-id="bd813-461">Теперь нагрузка распределяется между обоими регионами.</span><span class="sxs-lookup"><span data-stu-id="bd813-461">Both regions now share the load.</span></span> <span data-ttu-id="bd813-462">Если вы разместите в пассивном регионе "горячий резерв" из 10 экземпляров, постоянно готовых к отработке отказа, вы можете даже снизить затраты по сравнению с топологией "активный — пассивный".</span><span class="sxs-lookup"><span data-stu-id="bd813-462">This might be a cost savings over the active-passive topology if you keep a warm standby on the passive region with 10 instances waiting for failover.</span></span>

<span data-ttu-id="bd813-463">Учтите, что до восстановления основного региона в дополнительном регионе может случиться неожиданный наплыв новых пользователей.</span><span class="sxs-lookup"><span data-stu-id="bd813-463">Realize that until you restore the primary region, the secondary region might receive a sudden surge of new users.</span></span> <span data-ttu-id="bd813-464">Если при нарушении работы службы в основном регионе на каждом сервере было 10 000 пользователей, дополнительному региону внезапно потребуется обрабатывать 20 000 пользователей.</span><span class="sxs-lookup"><span data-stu-id="bd813-464">If there are 10,000 users on each server when the primary region experiences a service disruption, the secondary region suddenly has to handle 20,000 users.</span></span> <span data-ttu-id="bd813-465">Правила мониторинга в дополнительном регионе должны обнаружить такое увеличение и удвоить число экземпляров в этом регионе.</span><span class="sxs-lookup"><span data-stu-id="bd813-465">Monitoring rules on the secondary region must detect this increase and double the instances in the secondary region.</span></span> <span data-ttu-id="bd813-466">Дополнительные сведения см. в разделе об [обнаружении сбоев](#failure-detection).</span><span class="sxs-lookup"><span data-stu-id="bd813-466">For more information on this, see the section on [failure detection](#failure-detection).</span></span>

## <a name="hybrid-on-premises-and-cloud-solution"></a><span data-ttu-id="bd813-467">гибридных локальных и облачных решениях</span><span class="sxs-lookup"><span data-stu-id="bd813-467">Hybrid on-premises and cloud solution</span></span>
<span data-ttu-id="bd813-468">Дополнительная стратегия аварийного восстановления предусматривает создание гибридного приложения, которое работает локально и в облаке.</span><span class="sxs-lookup"><span data-stu-id="bd813-468">One additional strategy for disaster recovery is to architect a hybrid application that runs on-premises and in the cloud.</span></span> <span data-ttu-id="bd813-469">В зависимости от приложения основной регион может находиться как в локальной среде, так и в облаке.</span><span class="sxs-lookup"><span data-stu-id="bd813-469">Depending on the application, the primary region might be either location.</span></span> <span data-ttu-id="bd813-470">Рассмотрим предыдущие архитектуры и представим, что основной или дополнительный регион располагается в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="bd813-470">Consider the previous architectures and imagine the primary or secondary region as an on-premises location.</span></span>

<span data-ttu-id="bd813-471">В таких гибридных архитектурах возникают некоторые сложности.</span><span class="sxs-lookup"><span data-stu-id="bd813-471">There are some challenges in these hybrid architectures.</span></span> <span data-ttu-id="bd813-472">В большей части этой статьи основное внимание уделяется шаблонам архитектуры PaaS.</span><span class="sxs-lookup"><span data-stu-id="bd813-472">First, most of this article has addressed PaaS architecture patterns.</span></span> <span data-ttu-id="bd813-473">Типичные приложения PaaS в Azure используют конструкции Azure, например роли, облачные службы и диспетчер трафика.</span><span class="sxs-lookup"><span data-stu-id="bd813-473">Typical PaaS applications in Azure rely on Azure-specific constructs such as roles, cloud services, and Traffic Manager.</span></span> <span data-ttu-id="bd813-474">Чтобы создать локальное решение для приложения PaaS такого типа, нужна совсем другая архитектура.</span><span class="sxs-lookup"><span data-stu-id="bd813-474">Creating an on-premises solution for this type of PaaS application would require a significantly different architecture.</span></span> <span data-ttu-id="bd813-475">Это может не подойти с точки зрения управления или затрат.</span><span class="sxs-lookup"><span data-stu-id="bd813-475">This might not be feasible from a management or cost perspective.</span></span>

<span data-ttu-id="bd813-476">Но гибридное решение для аварийного восстановления создает меньше трудностей при использовании традиционных архитектур, перенесенных в облачную среду, например на платформы IaaS (инфраструктура как услуга).</span><span class="sxs-lookup"><span data-stu-id="bd813-476">However, a hybrid solution for disaster recovery has fewer challenges for traditional architectures that have been migrated to the cloud, such as IaaS-based architectures.</span></span> <span data-ttu-id="bd813-477">Приложения IaaS используют виртуальные машины в облаке, для которых могут существовать прямые эквиваленты в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="bd813-477">IaaS applications use virtual machines in the cloud that can have direct on-premises equivalents.</span></span> <span data-ttu-id="bd813-478">Кроме того, подключать компьютеры в облаке к локальным сетевым ресурсам можно с помощью виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="bd813-478">You can also use virtual networks to connect machines in the cloud with on-premises network resources.</span></span> <span data-ttu-id="bd813-479">Это открывает целый ряд возможностей, недоступных для "чистых" приложений PaaS.</span><span class="sxs-lookup"><span data-stu-id="bd813-479">This allows several possibilities that are not possible with PaaS-only applications.</span></span> <span data-ttu-id="bd813-480">Например, SQL Server может использовать решения аварийного восстановления, например группы доступности AlwaysOn и зеркальное отображение базы данных.</span><span class="sxs-lookup"><span data-stu-id="bd813-480">For example, SQL Server can take advantage of disaster recovery solutions such as AlwaysOn Availability Groups and database mirroring.</span></span> <span data-ttu-id="bd813-481">Дополнительные сведения см. в статье [Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span><span class="sxs-lookup"><span data-stu-id="bd813-481">For details, see [High availability and disaster recovery for SQL Server in Azure virtual machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

<span data-ttu-id="bd813-482">Решения IaaS также предоставляют простой способ использования Azure в качестве варианта для отработки отказа для локальных приложений.</span><span class="sxs-lookup"><span data-stu-id="bd813-482">IaaS solutions also provide an easier path for on-premises applications to use Azure as the failover option.</span></span> <span data-ttu-id="bd813-483">В существующем локальном регионе может быть развернуто полнофункциональное приложение.</span><span class="sxs-lookup"><span data-stu-id="bd813-483">You might have a fully functioning application in an existing on-premises region.</span></span> <span data-ttu-id="bd813-484">Но что делать, если не хватает ресурсов для поддержки географически отделенного региона для отработки отказа?</span><span class="sxs-lookup"><span data-stu-id="bd813-484">However, what if you lack the resources to maintain a geographically separate region for failover?</span></span> <span data-ttu-id="bd813-485">Чтобы запустить приложение в Azure, можно использовать виртуальные машины и виртуальные сети.</span><span class="sxs-lookup"><span data-stu-id="bd813-485">You might decide to use virtual machines and virtual networks to get your application running in Azure.</span></span> <span data-ttu-id="bd813-486">В этом случае определите процессы синхронизации данных в облаке.</span><span class="sxs-lookup"><span data-stu-id="bd813-486">In that case, define processes that synchronize data to the cloud.</span></span> <span data-ttu-id="bd813-487">После этого развертывание Azure станет дополнительным регионом для отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="bd813-487">The Azure deployment then becomes the secondary region to use for failover.</span></span> <span data-ttu-id="bd813-488">Основным регионом останется локальное приложение.</span><span class="sxs-lookup"><span data-stu-id="bd813-488">The primary region remains the on-premises application.</span></span> <span data-ttu-id="bd813-489">Дополнительные сведения об архитектурах и возможностях IaaS см. в [документации по виртуальным машинам](https://azure.microsoft.com/documentation/services/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="bd813-489">For more information about IaaS architectures and capabilities, see the [Virtual Machines documentation](https://azure.microsoft.com/documentation/services/virtual-machines/).</span></span>

## <a name="alternative-cloud"></a><span data-ttu-id="bd813-490">Альтернативное облако</span><span class="sxs-lookup"><span data-stu-id="bd813-490">Alternative cloud</span></span>
<span data-ttu-id="bd813-491">В некоторых ситуациях даже богатые возможности Microsoft Azure не гарантируют соблюдение всех корпоративных правил или политик соответствия.</span><span class="sxs-lookup"><span data-stu-id="bd813-491">There are situations where the broad capabilities of Microsoft Azure still may not meet internal compliance rules or policies required by your organization.</span></span> <span data-ttu-id="bd813-492">Самые лучшие стратегия обработки сбоев и архитектура резервных систем не гарантируют работоспособность при глобальном нарушении работы служб поставщика облачных служб.</span><span class="sxs-lookup"><span data-stu-id="bd813-492">Even the best preparation and design to implement backup systems during a disaster are inadequate during a global service disruption of a cloud service provider.</span></span>

<span data-ttu-id="bd813-493">Необходимо сопоставить требования к доступности с затратами и сложностью ее достижения.</span><span class="sxs-lookup"><span data-stu-id="bd813-493">You should compare availability requirements with the cost and complexity of increased availability.</span></span> <span data-ttu-id="bd813-494">Проанализируйте риски и определите целевое время восстановления и RPO для своего решения.</span><span class="sxs-lookup"><span data-stu-id="bd813-494">Perform a risk analysis, and define the RTO and RPO for your solution.</span></span> <span data-ttu-id="bd813-495">Если простои в работе приложения недопустимы, попробуйте добавить еще одно облачное решение.</span><span class="sxs-lookup"><span data-stu-id="bd813-495">If your application cannot tolerate any downtime, you might consider using an additional cloud solution.</span></span> <span data-ttu-id="bd813-496">Если вся среда Azure станет недоступной, другое облачное решение все еще может быть доступно (если не утерян доступ к Интернету).</span><span class="sxs-lookup"><span data-stu-id="bd813-496">Unless the entire Internet goes down, another cloud solution might still be available if Azure becomes globally inaccessible.</span></span>

<span data-ttu-id="bd813-497">Как и в гибридном сценарии, развертывания для отработки отказа в предыдущих архитектурах аварийного восстановления могут также содержаться в другом облачном решении.</span><span class="sxs-lookup"><span data-stu-id="bd813-497">As with the hybrid scenario, the failover deployments in the previous disaster recovery architectures can also exist within another cloud solution.</span></span> <span data-ttu-id="bd813-498">Альтернативные облачные сайты аварийного восстановления следует использовать только для решений с целевым временем восстановления, которое допускает очень малый простой или не допускает его вовсе.</span><span class="sxs-lookup"><span data-stu-id="bd813-498">Alternative cloud DR sites should be used only for solutions whose RTO allows very little, if any, downtime.</span></span> <span data-ttu-id="bd813-499">Обратите внимание, что для настройки, разработки, развертывания и обслуживания решения, использующего сайт аварийного восстановления вне Azure, требуется намного больше усилий.</span><span class="sxs-lookup"><span data-stu-id="bd813-499">Note that a solution that uses a DR site outside Azure will require more work to configure, develop, deploy, and maintain.</span></span> <span data-ttu-id="bd813-500">Кроме того, в архитектуре с несколькими облаками будет сложнее применить традиционные подходы.</span><span class="sxs-lookup"><span data-stu-id="bd813-500">It's also more difficult to implement proven practices in a cross-cloud architecture.</span></span> <span data-ttu-id="bd813-501">Хотя к облачным платформам применяются схожие общие принципы, API и архитектуры у них разные.</span><span class="sxs-lookup"><span data-stu-id="bd813-501">Although cloud platforms have similar high-level concepts, the APIs and architectures are different.</span></span>

<span data-ttu-id="bd813-502">Если ваша стратегия аварийного восстановления включает несколько облачных платформ, будет полезным добавить в решение дополнительные уровни абстракции.</span><span class="sxs-lookup"><span data-stu-id="bd813-502">If your DR strategy relies upon multiple cloud platforms, it's valuable to include abstraction layers in the design of the solution.</span></span> <span data-ttu-id="bd813-503">Так вам не понадобится разрабатывать и обслуживать две версии одного приложения для разных облачных платформ в случае сбоя.</span><span class="sxs-lookup"><span data-stu-id="bd813-503">This eliminates the need to develop and maintain two different versions of the same application for different cloud platforms in case of disaster.</span></span> <span data-ttu-id="bd813-504">Как и в гибридном сценарии, в этих случаях может оказаться удобнее использовать виртуальные машины Azure или службу контейнеров Azure, чем решения PaaS в зависимости от облачных платформ.</span><span class="sxs-lookup"><span data-stu-id="bd813-504">As with the hybrid scenario, the use of Azure Virtual Machines or Azure Container Service might be easier in these cases than the use of cloud-specific PaaS designs.</span></span>

## <a name="automation"></a><span data-ttu-id="bd813-505">Автоматизация</span><span class="sxs-lookup"><span data-stu-id="bd813-505">Automation</span></span>
<span data-ttu-id="bd813-506">Некоторые рассмотренные шаблоны требуют быстрой активации автономных развертываний, а также восстановления определенных компонентов системы.</span><span class="sxs-lookup"><span data-stu-id="bd813-506">Some of the patterns that we just discussed require quick activation of offline deployments as well as restoration of specific parts of a system.</span></span> <span data-ttu-id="bd813-507">Скрипты автоматизации позволят добавлять ресурсы при увеличении нагрузки и быстро развертывать решения.</span><span class="sxs-lookup"><span data-stu-id="bd813-507">Automation scripts can activate resources on demand and deploy solutions rapidly.</span></span> <span data-ttu-id="bd813-508">Ниже приводятся примеры автоматизации аварийного восстановления на основе [Azure PowerShell](https://msdn.microsoft.com/library/azure/jj156055.aspx), но аналогичный результат можно получить и с помощью [Azure CLI](https://docs.microsoft.com/en-us/cli/azure/get-started-with-azure-cli) или [REST API управления службами](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span><span class="sxs-lookup"><span data-stu-id="bd813-508">The DR-related automation examples below use [Azure PowerShell](https://msdn.microsoft.com/library/azure/jj156055.aspx), but using the [Azure CLI](https://docs.microsoft.com/en-us/cli/azure/get-started-with-azure-cli) or the [Service Management REST API](https://msdn.microsoft.com/library/azure/ee460799.aspx) are also good options.</span></span>

<span data-ttu-id="bd813-509">Скрипты автоматизации берут на себя задачи аварийного восстановления, которые Azure не может выполнять прозрачным образом.</span><span class="sxs-lookup"><span data-stu-id="bd813-509">Automation scripts manage aspects of DR not transparently handled by Azure.</span></span> <span data-ttu-id="bd813-510">Они позволяют получить согласованный и воспроизводимой результат, сводя пользовательские ошибки к минимуму.</span><span class="sxs-lookup"><span data-stu-id="bd813-510">This produces consistent and repeatable results, minimizing human error.</span></span> <span data-ttu-id="bd813-511">Заранее создавая скрипты аварийного восстановления, вы ускорите восстановление системы и ее составных частей во время сбоя.</span><span class="sxs-lookup"><span data-stu-id="bd813-511">Predefined DR scripts also reduce the time to rebuild a system and its constituent parts during a disaster.</span></span> <span data-ttu-id="bd813-512">Нецелесообразно пытаться вручную определить, как восстановить сайт при сбое, когда с каждой минутой убытки становятся все больше.</span><span class="sxs-lookup"><span data-stu-id="bd813-512">You don’t want to try to manually figure out how to restore your site while it's down and losing money every minute.</span></span>

<span data-ttu-id="bd813-513">Несколько раз протестируйте скрипты от начала до конца.</span><span class="sxs-lookup"><span data-stu-id="bd813-513">Test your scripts repeatedly from start to finish.</span></span> <span data-ttu-id="bd813-514">Проверив основные возможности, протестируйте их в режиме [моделирования сбоя](#disaster-simulation).</span><span class="sxs-lookup"><span data-stu-id="bd813-514">After verifying their basic functionality, make sure to test them in [disaster simulation](#disaster-simulation).</span></span> <span data-ttu-id="bd813-515">Это позволит обнаружить недостатки в скриптах или процессах.</span><span class="sxs-lookup"><span data-stu-id="bd813-515">This helps uncover defects in the scripts or processes.</span></span>

<span data-ttu-id="bd813-516">Чтобы автоматизировать эту задачу, рекомендуется создать репозиторий сценариев PowerShell или сценариев интерфейса командной строки по аварийному восстановлению Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-516">A best practice with automation is to create a repository of PowerShell scripts or command-line interface (CLI) scripts for Azure disaster recovery.</span></span> <span data-ttu-id="bd813-517">Четко обозначьте и классифицируйте их, чтобы ускорить использование.</span><span class="sxs-lookup"><span data-stu-id="bd813-517">Clearly mark and categorize them for quick access.</span></span> <span data-ttu-id="bd813-518">Назначьте ответственного за управление репозиторием и версиями скриптов.</span><span class="sxs-lookup"><span data-stu-id="bd813-518">Designate a primary person to manage the repository and versioning of the scripts.</span></span> <span data-ttu-id="bd813-519">Задокументируйте их, предоставив четкое описание параметров и примеры использования сценариев.</span><span class="sxs-lookup"><span data-stu-id="bd813-519">Document them well with explanations of parameters and examples of script use.</span></span> <span data-ttu-id="bd813-520">Кроме того, обеспечьте синхронизацию этой документации с развертываниями Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-520">Also ensure that you keep this documentation in sync with your Azure deployments.</span></span> <span data-ttu-id="bd813-521">Чтобы правильно выполнять эту задачу, за все компоненты репозитория должен отвечать один специалист.</span><span class="sxs-lookup"><span data-stu-id="bd813-521">This underscores the purpose of having a primary person in charge of all parts of the repository.</span></span>

## <a name="failure-detection"></a><span data-ttu-id="bd813-522">Обнаружение сбоев</span><span class="sxs-lookup"><span data-stu-id="bd813-522">Failure detection</span></span>
<span data-ttu-id="bd813-523">Чтобы устранять проблемы доступности и выполнять аварийное восстановление должным образом, необходимо иметь возможность выявления и диагностики сбоев.</span><span class="sxs-lookup"><span data-stu-id="bd813-523">To correctly handle problems with availability and disaster recovery, you must be able to detect and diagnose failures.</span></span> <span data-ttu-id="bd813-524">Ведите расширенный мониторинг сервера и развертывания, чтобы быстро распознавать недоступность системы или ее отдельных компонентов.</span><span class="sxs-lookup"><span data-stu-id="bd813-524">Perform advanced server and deployment monitoring to quickly recognize when a system or its components suddenly become unavailable.</span></span> <span data-ttu-id="bd813-525">Часть этой работы можно поручить средствам мониторинга, которые отслеживают общую работоспособность облачной службы и ее зависимостей.</span><span class="sxs-lookup"><span data-stu-id="bd813-525">Monitoring tools that assess the overall health of the cloud service and its dependencies can perform part of this work.</span></span> <span data-ttu-id="bd813-526">Компания Майкрософт предоставляет такое средство: [System Center 2016](https://www.microsoft.com/en-us/server-cloud/products/system-center-2016/).</span><span class="sxs-lookup"><span data-stu-id="bd813-526">One suitable Microsoft tool is [System Center 2016](https://www.microsoft.com/en-us/server-cloud/products/system-center-2016/).</span></span> <span data-ttu-id="bd813-527">Возможности мониторинга могут также предоставлять сторонние средства.</span><span class="sxs-lookup"><span data-stu-id="bd813-527">Third-party tools can also provide monitoring capabilities.</span></span> <span data-ttu-id="bd813-528">Большинство решений мониторинга отслеживают основные счетчики производительности, а также доступность службы.</span><span class="sxs-lookup"><span data-stu-id="bd813-528">Most monitoring solutions track key performance counters and service availability.</span></span>

<span data-ttu-id="bd813-529">Хотя эти средства очень важны, вы сами несете ответственность за обнаружение сбоев и ведение отчетности в облачной службе.</span><span class="sxs-lookup"><span data-stu-id="bd813-529">Although these tools are vital, you must plan for fault detection and reporting within a cloud service.</span></span> <span data-ttu-id="bd813-530">Кроме того, необходимо подготовиться к надлежащему использованию системы диагностики Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-530">You must also plan to properly use Azure Diagnostics.</span></span> <span data-ttu-id="bd813-531">Настраиваемые счетчики производительности или записи журнала событий также могут быть частью общей стратегии.</span><span class="sxs-lookup"><span data-stu-id="bd813-531">Custom performance counters or event-log entries can also be part of the overall strategy.</span></span> <span data-ttu-id="bd813-532">С их помощью во время сбоев вы будете получать дополнительные данные, которые позволяют быстро определить проблему и восстановить все возможности.</span><span class="sxs-lookup"><span data-stu-id="bd813-532">This provides more data during failures to quickly diagnose the problem and restore full capabilities.</span></span> <span data-ttu-id="bd813-533">Вы также получаете дополнительные метрики, по которым средства мониторинга могут определить работоспособность приложения.</span><span class="sxs-lookup"><span data-stu-id="bd813-533">It also provides additional metrics that the monitoring tools can use to determine application health.</span></span> <span data-ttu-id="bd813-534">Дополнительные сведения см. в статье [Включение системы диагностики Azure в облачных службах Azure](/azure/cloud-services/cloud-services-dotnet-diagnostics/).</span><span class="sxs-lookup"><span data-stu-id="bd813-534">For more information, see [Enabling Azure Diagnostics in Azure Cloud Services](/azure/cloud-services/cloud-services-dotnet-diagnostics/).</span></span> <span data-ttu-id="bd813-535">Обсуждение планирования общей модели работоспособности см. на странице [FailSafe: Building Scalable, Resilient Cloud Services](https://channel9.msdn.com/Series/FailSafe) (Отказоустойчивость. Создание устойчивых облачных служб).</span><span class="sxs-lookup"><span data-stu-id="bd813-535">For a discussion of how to plan for an overall “health model,” see [Failsafe: Guidance for Resilient Cloud Architectures](https://channel9.msdn.com/Series/FailSafe).</span></span>

## <a name="disaster-simulation"></a><span data-ttu-id="bd813-536">моделирование сбоя</span><span class="sxs-lookup"><span data-stu-id="bd813-536">Disaster simulation</span></span>
<span data-ttu-id="bd813-537">Проверка методом моделирования подразумевает создание небольших реалистичных ситуаций в рабочей среде, чтобы проверить, какие действия предпримут участники группы.</span><span class="sxs-lookup"><span data-stu-id="bd813-537">Simulation testing involves creating small real-life situations on the work floor to observe how the team members react.</span></span> <span data-ttu-id="bd813-538">Моделирование также позволяет оценить эффективность решений в плане восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-538">Simulations also show how effective the solutions are in the recovery plan.</span></span> <span data-ttu-id="bd813-539">Моделируйте проблемные ситуации так, чтобы они были близки к реальным событиям, но при этом не нарушали основную деятельность компании.</span><span class="sxs-lookup"><span data-stu-id="bd813-539">Execute simulations so that the created scenarios don't disrupt actual business, while still feeling like real situations.</span></span>

<span data-ttu-id="bd813-540">Рассмотрим создание коммутационной панели в приложении, чтобы смоделировать проблемы с доступностью вручную.</span><span class="sxs-lookup"><span data-stu-id="bd813-540">Consider architecting a type of “switchboard” in the application to manually simulate availability issues.</span></span> <span data-ttu-id="bd813-541">Например, с помощью программного коммутатора инициируйте исключения доступа к базе данных для модуля заказов, вызвав сбой в его работе.</span><span class="sxs-lookup"><span data-stu-id="bd813-541">For instance, through a soft switch, trigger database access exceptions for an ordering module by causing it to malfunction.</span></span> <span data-ttu-id="bd813-542">Подобные упрощенные подходы можно использовать для других модулей на уровне сетевого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="bd813-542">You can take similar lightweight approaches for other modules at the network interface level.</span></span>

<span data-ttu-id="bd813-543">Во время моделирования выделяются все проблемы, не решенные должным образом.</span><span class="sxs-lookup"><span data-stu-id="bd813-543">The simulation highlights any issues that were inadequately addressed.</span></span> <span data-ttu-id="bd813-544">Моделируемые сценарии должны быть полностью управляемыми.</span><span class="sxs-lookup"><span data-stu-id="bd813-544">The simulated scenarios must be completely controllable.</span></span> <span data-ttu-id="bd813-545">Это значит, что даже если кажется, что план восстановления не срабатывает, можно восстановить нормальный режим работы без значительного ущерба.</span><span class="sxs-lookup"><span data-stu-id="bd813-545">This means that, even if the recovery plan seems to be failing, you can restore the situation back to normal without causing any significant damage.</span></span> <span data-ttu-id="bd813-546">Кроме того, важно сообщить руководителям более высокого уровня о времени и способе проведения моделирования.</span><span class="sxs-lookup"><span data-stu-id="bd813-546">It’s also important that you inform higher-level management about when and how the simulation exercises will be executed.</span></span> <span data-ttu-id="bd813-547">В плане нужно указать время проверки и затрагиваемые ресурсы.</span><span class="sxs-lookup"><span data-stu-id="bd813-547">This plan should detail the time or resources affected during the simulation.</span></span> <span data-ttu-id="bd813-548">Обязательно определите критерии, по которым определяется успешность плана аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-548">Also define the measures of success when testing your disaster recovery plan.</span></span>

<span data-ttu-id="bd813-549">Для проверки планов аварийного восстановления можно применить еще несколько методик.</span><span class="sxs-lookup"><span data-stu-id="bd813-549">Several other techniques can test disaster recovery plans.</span></span> <span data-ttu-id="bd813-550">Большинство из них основаны на этих базовых методах с незначительными вариациями.</span><span class="sxs-lookup"><span data-stu-id="bd813-550">However, most of them are simply variations of these basic techniques.</span></span> <span data-ttu-id="bd813-551">Цель тестирования — оценка выполнимости созданного плана восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-551">The intent of this testing is to evaluate the feasibility of the recovery plan.</span></span> <span data-ttu-id="bd813-552">При проверке аварийного восстановления внимание уделяется поиску недостатков в базовом плане восстановления.</span><span class="sxs-lookup"><span data-stu-id="bd813-552">Disaster recovery testing focuses on the details to discover gaps in the basic recovery plan.</span></span>

## <a name="service-specific-guidance"></a><span data-ttu-id="bd813-553">Рекомендации по отдельным службам</span><span class="sxs-lookup"><span data-stu-id="bd813-553">Service-specific guidance</span></span>

<span data-ttu-id="bd813-554">В следующих разделах описывается аварийное восстановление для некоторых служб Azure.</span><span class="sxs-lookup"><span data-stu-id="bd813-554">The following topics describe disaster recovery specific Azure services:</span></span>

| <span data-ttu-id="bd813-555">служба</span><span class="sxs-lookup"><span data-stu-id="bd813-555">Service</span></span> | <span data-ttu-id="bd813-556">Раздел</span><span class="sxs-lookup"><span data-stu-id="bd813-556">Topic</span></span> |
|---------|-------|
| <span data-ttu-id="bd813-557">Облачные службы</span><span class="sxs-lookup"><span data-stu-id="bd813-557">Cloud Services</span></span> | [<span data-ttu-id="bd813-558">Что делать, если прерывание работы службы Azure влияет на облачные службы Azure</span><span class="sxs-lookup"><span data-stu-id="bd813-558">What to do in the event of an Azure service disruption that impacts Azure Cloud Services</span></span>](/azure/cloud-services/cloud-services-disaster-recovery-guidance) |
| <span data-ttu-id="bd813-559">Хранилище ключей</span><span class="sxs-lookup"><span data-stu-id="bd813-559">Key Vault</span></span> | [<span data-ttu-id="bd813-560">Доступность и избыточность хранилища ключей Azure</span><span class="sxs-lookup"><span data-stu-id="bd813-560">Azure Key Vault availability and redundancy</span></span>](/azure/key-vault/key-vault-disaster-recovery-guidance) |
|<span data-ttu-id="bd813-561">Хранилище</span><span class="sxs-lookup"><span data-stu-id="bd813-561">Storage</span></span> | [<span data-ttu-id="bd813-562">Что делать в случае простоя службы хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="bd813-562">What to do if an Azure Storage outage occurs</span></span>](/azure/storage/storage-disaster-recovery-guidance) |
| <span data-ttu-id="bd813-563">База данных SQL</span><span class="sxs-lookup"><span data-stu-id="bd813-563">SQL Database</span></span> | [<span data-ttu-id="bd813-564">Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе</span><span class="sxs-lookup"><span data-stu-id="bd813-564">Restore an Azure SQL Database or failover to a secondary</span></span>](/azure/sql-database/sql-database-disaster-recovery) |
| <span data-ttu-id="bd813-565">Виртуальные машины</span><span class="sxs-lookup"><span data-stu-id="bd813-565">Virtual machines</span></span> | [<span data-ttu-id="bd813-566">Что делать, если прерывание работы службы Azure влияет на виртуальные машины Azure</span><span class="sxs-lookup"><span data-stu-id="bd813-566">What to do in the event that an Azure service disruption impacts Azure virtual machines</span></span>](/azure/virtual-machines/virtual-machines-disaster-recovery-guidance) |
| <span data-ttu-id="bd813-567">виртуальные сети;</span><span class="sxs-lookup"><span data-stu-id="bd813-567">Virtual networks</span></span> | [<span data-ttu-id="bd813-568">Виртуальная сеть: непрерывность бизнес-процессов</span><span class="sxs-lookup"><span data-stu-id="bd813-568">Virtual Network – Business Continuity</span></span>](/azure/virtual-network/virtual-network-disaster-recovery-guidance) |


