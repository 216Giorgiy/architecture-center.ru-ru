---
title: "Восстановление данных после повреждения или случайного удаления"
description: "В этой статье объясняется, как восстанавливать данные после повреждения или случайного удаления, как создавать надежные, высокодоступные и отказоустойчивые приложения и как правильно планировать аварийное восстановление."
author: adamglick
ms.date: 08/18/2016
ms.openlocfilehash: b75c774f85c42f64472167897f08a7302ab50a3f
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
[!INCLUDE [header](../_includes/header.md)]
# <a name="azure-resiliency-technical-guidance-recovery-from-data-corruption-or-accidental-deletion"></a><span data-ttu-id="5e70f-103">Техническое руководство по обеспечению устойчивости в Azure. Восстановление данных после повреждения или случайного удаления</span><span class="sxs-lookup"><span data-stu-id="5e70f-103">Azure resiliency technical guidance: recovery from data corruption or accidental deletion</span></span>
<span data-ttu-id="5e70f-104">Надежный план обеспечения непрерывности бизнес-процессов должен включать в себя меры на случай повреждения или случайного удаления данных.</span><span class="sxs-lookup"><span data-stu-id="5e70f-104">Part of a robust business continuity plan is having a plan if your data gets corrupted or accidentally deleted.</span></span> <span data-ttu-id="5e70f-105">Ниже приводятся сведения о восстановлении после повреждения или случайного удаления данных в результате ошибки приложения или оператора.</span><span class="sxs-lookup"><span data-stu-id="5e70f-105">The following is information about recovery after data has been corrupted or accidentally deleted, due to application errors or operator error.</span></span>

## <a name="virtual-machines"></a><span data-ttu-id="5e70f-106">Виртуальные машины</span><span class="sxs-lookup"><span data-stu-id="5e70f-106">Virtual Machines</span></span>
<span data-ttu-id="5e70f-107">Чтобы защитить виртуальные машины Azure, предоставляемые в формате "инфраструктура как услуга" (IaaS), от ошибок приложений и случайного удаления данных, используйте [службу архивации Azure](https://azure.microsoft.com/services/backup/).</span><span class="sxs-lookup"><span data-stu-id="5e70f-107">To protect your Azure Virtual Machines (sometimes called infrastructure-as-a-service VMs) from application errors or accidental deletion, use [Azure Backup](https://azure.microsoft.com/services/backup/).</span></span> <span data-ttu-id="5e70f-108">Служба архивации Azure позволяет создавать согласованные резервные копии нескольких дисков виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="5e70f-108">Azure Backup enables the creation of backups that are consistent across multiple VM disks.</span></span> <span data-ttu-id="5e70f-109">Кроме того, в хранилище резервных копий предусмотрена репликация между регионами, которая обеспечивает восстановление в случае потери данных в одном из регионов.</span><span class="sxs-lookup"><span data-stu-id="5e70f-109">In addition, the Backup Vault can be replicated across regions to provide recovery from region loss.</span></span>

## <a name="storage"></a><span data-ttu-id="5e70f-110">Хранилище</span><span class="sxs-lookup"><span data-stu-id="5e70f-110">Storage</span></span>
<span data-ttu-id="5e70f-111">Обратите внимание, что автоматические реплики, которые служба хранилища Azure использует для обеспечения устойчивости данных, не могут помешать коду приложения (а также разработчикам или пользователям) повредить данные путем случайного или непреднамеренного удаления, обновления и т. п.</span><span class="sxs-lookup"><span data-stu-id="5e70f-111">Note that while Azure Storage provides data resiliency through automated replicas, this does not prevent your application code (or developers/users) from corrupting data through accidental or unintended deletion, update, and so on.</span></span> <span data-ttu-id="5e70f-112">Чтобы сохранить точность данных в случае ошибок приложения или пользователя, требуются более сложные приемы, например копирование данных в дополнительное хранилище и ведение журнала аудита.</span><span class="sxs-lookup"><span data-stu-id="5e70f-112">Maintaining data fidelity in the face of application or user error requires more advanced techniques, such as copying the data to a secondary storage location with an audit log.</span></span> <span data-ttu-id="5e70f-113">Разработчики могут использовать [моментальные снимки](https://msdn.microsoft.com/library/azure/ee691971.aspx) больших двоичных объектов для создания их копий только для чтения по состоянию на конкретный момент времени.</span><span class="sxs-lookup"><span data-stu-id="5e70f-113">Developers can take advantage of the blob [snapshot capability](https://msdn.microsoft.com/library/azure/ee691971.aspx), which can create read-only point-in-time snapshots of blob contents.</span></span> <span data-ttu-id="5e70f-114">Эта функция может стать основой решения по поддержанию точности данных для больших двоичных объектов службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="5e70f-114">This can be used as the basis of a data-fidelity solution for Azure Storage blobs.</span></span>

### <a name="blob-and-table-storage-backup"></a><span data-ttu-id="5e70f-115">Резервное копирование хранилищ BLOB-объектов и таблиц</span><span class="sxs-lookup"><span data-stu-id="5e70f-115">Blob and Table Storage Backup</span></span>
<span data-ttu-id="5e70f-116">Большие двоичные объекты и таблицы вполне надежны, но они представляют только текущее состояние данных.</span><span class="sxs-lookup"><span data-stu-id="5e70f-116">While blobs and tables are highly durable, they always represent the current state of the data.</span></span> <span data-ttu-id="5e70f-117">Иногда после нежелательного изменения или удаления требуется восстановить данные в предыдущем состоянии.</span><span class="sxs-lookup"><span data-stu-id="5e70f-117">Recovery from unwanted modification or deletion of data may require restoring data to a previous state.</span></span> <span data-ttu-id="5e70f-118">Это можно сделать с помощью функций Azure, позволяющих создавать и сохранять копии на определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="5e70f-118">This can be achieved by taking advantage of the capabilities provided by Azure to store and retain point-in-time copies.</span></span>

<span data-ttu-id="5e70f-119">Для больших двоичных объектов Azure вы можете создавать резервные копии на момент времени, используя [функцию создания моментальных снимков](https://msdn.microsoft.com/library/ee691971.aspx).</span><span class="sxs-lookup"><span data-stu-id="5e70f-119">For Azure Blobs, you can perform point-in-time backups using the [blob snapshot feature](https://msdn.microsoft.com/library/ee691971.aspx).</span></span> <span data-ttu-id="5e70f-120">По каждому моментальному снимку взимается оплата только за хранение данных, которые отражают отличия состояния большого двоичного объекта по сравнению с предыдущим моментальным снимком.</span><span class="sxs-lookup"><span data-stu-id="5e70f-120">For each snapshot, you are only charged for the storage required to store the differences within the blob since the last snapshot state.</span></span> <span data-ttu-id="5e70f-121">Моментальные снимки применимы, только если существует исходный большой двоичный объект, на котором они основаны. Поэтому мы рекомендуем создавать копии в другом большом двоичном объекте или даже в другой учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="5e70f-121">The snapshots are dependent on the existence of the original blob they are based on, so a copy operation to another blob or even another storage account is advisable.</span></span> <span data-ttu-id="5e70f-122">Это гарантирует надежную защиту данных резервных копий от случайного удаления.</span><span class="sxs-lookup"><span data-stu-id="5e70f-122">This ensures that backup data is properly protected against accidental deletion.</span></span> <span data-ttu-id="5e70f-123">Для таблиц Azure копию на определенный момент времени можно создать путем копирования в другую таблицу или BLOB-объект Azure.</span><span class="sxs-lookup"><span data-stu-id="5e70f-123">For Azure Tables, you can make point-in-time copies to a different table or to Azure Blobs.</span></span> <span data-ttu-id="5e70f-124">Подробные рекомендации и примеры резервного копирования таблиц и больших двоичных объектов на уровне приложения вы найдете в следующих статьях.</span><span class="sxs-lookup"><span data-stu-id="5e70f-124">More detailed guidance and examples of performing application-level backups of tables and blobs can be found here:</span></span>

* [<span data-ttu-id="5e70f-125">Protecting Your Tables Against Application Errors</span><span class="sxs-lookup"><span data-stu-id="5e70f-125">Protecting Your Tables Against Application Errors</span></span>](https://blogs.msdn.microsoft.com/windowsazurestorage/2010/05/03/protecting-your-tables-against-application-errors/)
* [<span data-ttu-id="5e70f-126">Protecting Your Blobs Against Application Errors</span><span class="sxs-lookup"><span data-stu-id="5e70f-126">Protecting Your Blobs Against Application Errors</span></span>](https://blogs.msdn.microsoft.com/windowsazurestorage/2010/04/29/protecting-your-blobs-against-application-errors/)

## <a name="database"></a><span data-ttu-id="5e70f-127">База данных</span><span class="sxs-lookup"><span data-stu-id="5e70f-127">Database</span></span>
<span data-ttu-id="5e70f-128">Для базы данных SQL Azure существует несколько методов обеспечения [непрерывности бизнес-процессов](/azure/sql-database/sql-database-business-continuity/) (резервного копирования и восстановления).</span><span class="sxs-lookup"><span data-stu-id="5e70f-128">There are several [business continuity](/azure/sql-database/sql-database-business-continuity/) (backup, restore) options available for Azure SQL Database.</span></span> <span data-ttu-id="5e70f-129">Базы данных можно копировать с использованием функции [копирования базы данных](/azure/sql-database/sql-database-copy/) или [экспорта](/azure/sql-database/sql-database-export/) с последующим [импортом](https://msdn.microsoft.com/library/hh710052.aspx) BACPAC-файла SQL Server.</span><span class="sxs-lookup"><span data-stu-id="5e70f-129">Databases can be copied by using the [Database Copy](/azure/sql-database/sql-database-copy/) functionality, or by  [exporting](/azure/sql-database/sql-database-export/) and [importing](https://msdn.microsoft.com/library/hh710052.aspx) a SQL Server bacpac file.</span></span> <span data-ttu-id="5e70f-130">Копирование базы данных обеспечит согласованность на уровне транзакций, в отличие от использования BACPAC-файла (через службу импорта и экспорта).</span><span class="sxs-lookup"><span data-stu-id="5e70f-130">Database Copy provides transactionally consistent results, while a bacpac (through the import/export service) does not.</span></span> <span data-ttu-id="5e70f-131">Оба эти действия выполняются службами в центре обработки данных с соблюдением очередности операций, и в настоящее время не существует гарантий относительно времени их выполнения в рамках соглашения об уровне обслуживания.</span><span class="sxs-lookup"><span data-stu-id="5e70f-131">Both of these options run as queue-based services within the data center, and they do not currently provide a time-to-completion SLA.</span></span>

> [!NOTE]
> <span data-ttu-id="5e70f-132">Действия копирования или импорта и экспорта базы данных создают значительную нагрузку на базу данных-источник.</span><span class="sxs-lookup"><span data-stu-id="5e70f-132">The database copy and import/export options place a significant degree of load on the source database.</span></span> <span data-ttu-id="5e70f-133">Они могут стать причиной конфликта ресурсов или событий регулирования.</span><span class="sxs-lookup"><span data-stu-id="5e70f-133">They can trigger resource contention or throttling events.</span></span>
> 
> 

### <a name="sql-database-backup"></a><span data-ttu-id="5e70f-134">Резервное копирование базы данных SQL</span><span class="sxs-lookup"><span data-stu-id="5e70f-134">SQL Database Backup</span></span>
<span data-ttu-id="5e70f-135">Резервную копию Базы данных SQL Microsoft Azure на определенный момент времени можно создать путем [копирования этой базы](/azure/sql-database/sql-database-copy/).</span><span class="sxs-lookup"><span data-stu-id="5e70f-135">Point-in-time backups for Microsoft Azure SQL Database are achieved by [copying your Azure SQL database](/azure/sql-database/sql-database-copy/).</span></span> <span data-ttu-id="5e70f-136">Эта команда позволяет создать транзакционно согласованную копию базы данных на том же логическом сервере базы данных или на другом сервере.</span><span class="sxs-lookup"><span data-stu-id="5e70f-136">You can use this command to create a transactionally consistent copy of a database on the same logical database server or to a different server.</span></span> <span data-ttu-id="5e70f-137">В любом случае копия базы данных будет полностью работоспособной и полностью независимой от базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="5e70f-137">In either case, the database copy is fully functional and completely independent of the source database.</span></span> <span data-ttu-id="5e70f-138">Каждая создаваемая копия дает возможность восстановить данные на определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="5e70f-138">Each copy you create represents a point-in-time recovery option.</span></span> <span data-ttu-id="5e70f-139">Вы сможете полностью восстановить состояние базы данных, присвоив новой базе данных имя, которое использовалось для базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="5e70f-139">You can recover the database state completely by renaming the new database with the source database name.</span></span> <span data-ttu-id="5e70f-140">Также вы можете восстановить из новой базы данных определенное подмножество данных с помощью запросов Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="5e70f-140">Alternatively, you can recover a specific subset of data from the new database by using Transact-SQL queries.</span></span> <span data-ttu-id="5e70f-141">Дополнительные сведения о Базе данных SQL см. в разделе [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](/azure/sql-database/sql-database-business-continuity/).</span><span class="sxs-lookup"><span data-stu-id="5e70f-141">For additional details about SQL Database, see [Overview of business continuity with Azure SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span>

### <a name="sql-server-on-virtual-machines-backup"></a><span data-ttu-id="5e70f-142">Резервное копирование SQL Server на виртуальных машинах</span><span class="sxs-lookup"><span data-stu-id="5e70f-142">SQL Server on Virtual Machines Backup</span></span>
<span data-ttu-id="5e70f-143">Для SQL Server, который используется на виртуальных машинах Azure в формате IaaS, существует два варианта резервного копирования: традиционные резервные копии и доставка журналов.</span><span class="sxs-lookup"><span data-stu-id="5e70f-143">For SQL Server used with Azure infrastructure as a service virtual machines (often called IaaS or IaaS VMs), there are two options: traditional backups and log shipping.</span></span> <span data-ttu-id="5e70f-144">Традиционные резервные копии позволяют восстановить данные на определенный момент времени, но процесс восстановления в таком случае будет длительным.</span><span class="sxs-lookup"><span data-stu-id="5e70f-144">Using traditional backups enables you to restore to a specific point in time, but the recovery process is slow.</span></span> <span data-ttu-id="5e70f-145">Восстановление традиционных резервных копий начинается с первоначальной полной резервной копии, на которую последовательно накладываются все последующие резервные копии.</span><span class="sxs-lookup"><span data-stu-id="5e70f-145">Restoring traditional backups requires starting with an initial full backup, and then applying any backups taken after that.</span></span> <span data-ttu-id="5e70f-146">Второй вариант подразумевает, что вы можете настроить сеанс доставки журналов с определенной задержкой до восстановления резервных копий журналов (например, на два часа).</span><span class="sxs-lookup"><span data-stu-id="5e70f-146">The second option is to configure a log shipping session to delay the restore of log backups (for example, by two hours).</span></span> <span data-ttu-id="5e70f-147">Так вы получите временной зазор для восстановления после ошибок, возникших в базе данных-источнике.</span><span class="sxs-lookup"><span data-stu-id="5e70f-147">This provides a window to recover from errors made on the primary.</span></span>

## <a name="other-azure-platform-services"></a><span data-ttu-id="5e70f-148">Другие службы платформы Azure</span><span class="sxs-lookup"><span data-stu-id="5e70f-148">Other Azure platform services</span></span>
<span data-ttu-id="5e70f-149">Некоторые службы платформы Azure хранят информацию в настраиваемой пользователем учетной записи хранения или в базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="5e70f-149">Some Azure platform services store information in a user-controlled storage account or Azure SQL Database.</span></span> <span data-ttu-id="5e70f-150">Если учетная запись или ресурс хранилища будут удалены или повреждены, это может вызвать серьезные ошибки в службе.</span><span class="sxs-lookup"><span data-stu-id="5e70f-150">If the account or storage resource is deleted or corrupted, this could cause serious errors with the service.</span></span> <span data-ttu-id="5e70f-151">Поэтому важно сохранять резервные копии, которые позволят заново создать эти ресурсы в случае удаления или повреждения.</span><span class="sxs-lookup"><span data-stu-id="5e70f-151">In these cases, it is important to maintain backups that would enable you to re-create these resources if they were deleted or corrupted.</span></span>

<span data-ttu-id="5e70f-152">Для веб-сайтов Azure и мобильных служб Azure следует обеспечить резервное копирование и поддержку связанных баз данных.</span><span class="sxs-lookup"><span data-stu-id="5e70f-152">For Azure Web Sites and Azure Mobile Services, you must backup and maintain the associated databases.</span></span> <span data-ttu-id="5e70f-153">Для службы мультимедиа и виртуальных машин Azure следует поддерживать связанную учетную запись хранения Azure и все ресурсы в этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="5e70f-153">For Azure Media Service and Virtual Machines, you must maintain the associated Azure Storage account and all resources in that account.</span></span> <span data-ttu-id="5e70f-154">Например, для виртуальных машин требуется резервное копирование дисков виртуальной машины, размещенных в хранилище BLOB-объектов Azure, и управление ими.</span><span class="sxs-lookup"><span data-stu-id="5e70f-154">For example, for Virtual Machines, you must back up and manage the VM disks in Azure blob storage.</span></span>

## <a name="checklists-for-data-corruption-or-accidental-deletion"></a><span data-ttu-id="5e70f-155">Контрольные списки на случай повреждения или случайного удаления данных</span><span class="sxs-lookup"><span data-stu-id="5e70f-155">Checklists for data corruption or accidental deletion</span></span>
## <a name="virtual-machines-checklist"></a><span data-ttu-id="5e70f-156">Контрольный список для виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="5e70f-156">Virtual Machines checklist</span></span>
1. <span data-ttu-id="5e70f-157">Просмотрите раздел "Виртуальные машины" этого документа.</span><span class="sxs-lookup"><span data-stu-id="5e70f-157">Review the Virtual Machines section of this document.</span></span>
2. <span data-ttu-id="5e70f-158">Для резервного копирования и поддержки дисков виртуальной машины используйте службу архивации Azure (или собственную систему резервного копирования на основе хранилища BLOB-объектов Azure и моментальных снимков виртуальных жестких дисков).</span><span class="sxs-lookup"><span data-stu-id="5e70f-158">Back up and maintain the VM disks with Azure Backup (or your own backup system by using Azure blob storage and VHD snapshots).</span></span>

## <a name="storage-checklist"></a><span data-ttu-id="5e70f-159">Контрольный список для хранилища</span><span class="sxs-lookup"><span data-stu-id="5e70f-159">Storage checklist</span></span>
1. <span data-ttu-id="5e70f-160">Просмотрите раздел "Хранилище" этого документа.</span><span class="sxs-lookup"><span data-stu-id="5e70f-160">Review the Storage section of this document.</span></span>
2. <span data-ttu-id="5e70f-161">Регулярно создавайте резервные копии критически важных ресурсов хранилища.</span><span class="sxs-lookup"><span data-stu-id="5e70f-161">Regularly back up critical storage resources.</span></span>
3. <span data-ttu-id="5e70f-162">По возможности применяйте функцию моментальных снимков больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="5e70f-162">Consider using the snapshot feature for blobs.</span></span>

## <a name="database-checklist"></a><span data-ttu-id="5e70f-163">Контрольный список для базы данных</span><span class="sxs-lookup"><span data-stu-id="5e70f-163">Database checklist</span></span>
1. <span data-ttu-id="5e70f-164">Просмотрите раздел "База данных" этого документа.</span><span class="sxs-lookup"><span data-stu-id="5e70f-164">Review the Database section of this document.</span></span>
2. <span data-ttu-id="5e70f-165">Создавайте резервные копии на определенный момент времени с помощью команды копирования базы данных.</span><span class="sxs-lookup"><span data-stu-id="5e70f-165">Create point-in-time backups by using the Database Copy command.</span></span>

## <a name="sql-server-on-virtual-machines-backup-checklist"></a><span data-ttu-id="5e70f-166">Контрольный список для резервного копирования SQL Server на виртуальных машинах</span><span class="sxs-lookup"><span data-stu-id="5e70f-166">SQL Server on Virtual Machines Backup checklist</span></span>
1. <span data-ttu-id="5e70f-167">Просмотрите раздел "Резервное копирование SQL Server на виртуальных машинах" этого документа.</span><span class="sxs-lookup"><span data-stu-id="5e70f-167">Review the SQL Server on Virtual Machines Backup section of this document.</span></span>
2. <span data-ttu-id="5e70f-168">Используйте традиционные способы архивации и восстановления.</span><span class="sxs-lookup"><span data-stu-id="5e70f-168">Use traditional backup and restore techniques.</span></span>
3. <span data-ttu-id="5e70f-169">Создайте сеанс отложенной доставки журналов.</span><span class="sxs-lookup"><span data-stu-id="5e70f-169">Create a delayed log shipping session.</span></span>

## <a name="web-apps-checklist"></a><span data-ttu-id="5e70f-170">Контрольный список для веб-приложений</span><span class="sxs-lookup"><span data-stu-id="5e70f-170">Web Apps checklist</span></span>
1. <span data-ttu-id="5e70f-171">Используйте резервное копирование и поддержку связанной базы данных, если таковая существует.</span><span class="sxs-lookup"><span data-stu-id="5e70f-171">Back up and maintain the associated database, if any.</span></span>

## <a name="media-services-checklist"></a><span data-ttu-id="5e70f-172">Контрольный список для служб мультимедиа</span><span class="sxs-lookup"><span data-stu-id="5e70f-172">Media Services checklist</span></span>
1. <span data-ttu-id="5e70f-173">Используйте резервное копирование и поддержку связанных ресурсов хранения.</span><span class="sxs-lookup"><span data-stu-id="5e70f-173">Back up and maintain the associated storage resources.</span></span>

## <a name="more-information"></a><span data-ttu-id="5e70f-174">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="5e70f-174">More information</span></span>
<span data-ttu-id="5e70f-175">В статье [Сценарии хранения, резервного копирования и восстановления](https://azure.microsoft.com/documentation/scenarios/storage-backup-recovery/)содержатся сведения о возможностях архивации и восстановления в Azure.</span><span class="sxs-lookup"><span data-stu-id="5e70f-175">For more information about backup and restore features in Azure, see [Storage, backup and recovery scenarios](https://azure.microsoft.com/documentation/scenarios/storage-backup-recovery/).</span></span>


