---
title: Проектирование устойчивых приложений для Azure
description: Сведения о том, как создать отказоустойчивые приложения в Azure для обеспечения высокой доступности и аварийного восстановления.
author: MikeWasson
ms.date: 12/18/2018
ms.custom: resiliency
ms.openlocfilehash: 1638bc84b436d3d826f8ad9497ddb5a1310c14da
ms.sourcegitcommit: bb7fcffbb41e2c26a26f8781df32825eb60df70c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/20/2018
ms.locfileid: "53644263"
---
# <a name="designing-resilient-applications-for-azure"></a><span data-ttu-id="6ca64-103">Проектирование устойчивых приложений для Azure</span><span class="sxs-lookup"><span data-stu-id="6ca64-103">Designing resilient applications for Azure</span></span>

<span data-ttu-id="6ca64-104">В распределенной системе иногда происходят сбои.</span><span class="sxs-lookup"><span data-stu-id="6ca64-104">In a distributed system, failures will happen.</span></span> <span data-ttu-id="6ca64-105">Может произойти сбой оборудования.</span><span class="sxs-lookup"><span data-stu-id="6ca64-105">Hardware can fail.</span></span> <span data-ttu-id="6ca64-106">В сети могут возникнуть временные сбои.</span><span class="sxs-lookup"><span data-stu-id="6ca64-106">The network can have transient failures.</span></span> <span data-ttu-id="6ca64-107">В редких случаях вся служба или регион могут работать со сбоями, но даже такие случаи следует учесть.</span><span class="sxs-lookup"><span data-stu-id="6ca64-107">Rarely, an entire service or region may experience a disruption, but even those must be planned for.</span></span>

<span data-ttu-id="6ca64-108">Создание надежного приложения в облаке отличается от создания надежного приложения в локальной среде компании.</span><span class="sxs-lookup"><span data-stu-id="6ca64-108">Building a reliable application in the cloud is different than building a reliable application in an enterprise setting.</span></span> <span data-ttu-id="6ca64-109">Хотя ранее вы, возможно, приобрели оборудование более высокого уровня для масштабирования, в облачной среде вы должны выполнять горизонтальное масштабирование, а не вертикальное.</span><span class="sxs-lookup"><span data-stu-id="6ca64-109">While historically you may have purchased higher-end hardware to scale up, in a cloud environment you must scale out instead of scaling up.</span></span> <span data-ttu-id="6ca64-110">Затраты на облачные среды поддерживаются на низком уровне за счет использования стандартного оборудования.</span><span class="sxs-lookup"><span data-stu-id="6ca64-110">Costs for cloud environments are kept low through the use of commodity hardware.</span></span> <span data-ttu-id="6ca64-111">Вместо того, чтобы пытаться предотвратить все возможны сбои, нужно свести к минимуму воздействие этих сбоев на систему.</span><span class="sxs-lookup"><span data-stu-id="6ca64-111">Instead of trying to prevent failures altogether, the goal is to minimize the effects of a failure within the system.</span></span>

<span data-ttu-id="6ca64-112">В этой статье представлен обзор создания отказоустойчивых приложений в Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="6ca64-112">This article provides an overview of how to build resilient applications in Microsoft Azure.</span></span> <span data-ttu-id="6ca64-113">Она начинается с определения термина *отказоустойчивость* и связанных с ним понятий.</span><span class="sxs-lookup"><span data-stu-id="6ca64-113">It starts with a definition of the term *resiliency* and related concepts.</span></span> <span data-ttu-id="6ca64-114">Далее описывается процесс достижения отказоустойчивости, используя структурированный подход в течение жизненного цикла приложения, от проектирования и реализации до развертывания и эксплуатации.</span><span class="sxs-lookup"><span data-stu-id="6ca64-114">Then it describes a process for achieving resiliency, using a structured approach over the lifetime of an application, from design and implementation to deployment and operations.</span></span>

## <a name="what-is-resiliency"></a><span data-ttu-id="6ca64-115">Что такое отказоустойчивость?</span><span class="sxs-lookup"><span data-stu-id="6ca64-115">What is resiliency?</span></span>

<span data-ttu-id="6ca64-116">**Устойчивость** представляет собой возможность восстановления системы после сбоев и продолжения работы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-116">**Resiliency** is the ability of a system to recover from failures and continue to function.</span></span> <span data-ttu-id="6ca64-117">Устойчивость означает, что нужно не стараться *избежать* сбоев, а *реагировать* на них без простоя оборудования и потери данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-117">It's not about *avoiding* failures, but *responding* to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="6ca64-118">Назначение устойчивости состоит в том, чтобы вернуть приложение в рабочее состояние после сбоя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-118">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span>

<span data-ttu-id="6ca64-119">Два важных аспекта отказоустойчивости — это высокая доступность и аварийное восстановление.</span><span class="sxs-lookup"><span data-stu-id="6ca64-119">Two important aspects of resiliency are high availability and disaster recovery.</span></span>

* <span data-ttu-id="6ca64-120">**Высокий уровень доступности** — это способность приложения продолжать работу и находиться в работоспособном состоянии без значительного увеличения времени простоя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-120">**High availability** (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="6ca64-121">Под "работоспособным состоянием" мы понимаем то, что приложение в состоянии отвечать на запросы и пользователи могут подключиться к приложению и взаимодействовать с ним.</span><span class="sxs-lookup"><span data-stu-id="6ca64-121">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span>  
* <span data-ttu-id="6ca64-122">**Аварийное восстановление** — возможность восстановления после редких, но крупных инцидентов: не исчезающих самостоятельно широкомасштабных сбоев, таких как прерывание обслуживания, которое влияет на весь регион.</span><span class="sxs-lookup"><span data-stu-id="6ca64-122">**Disaster recovery** (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="6ca64-123">Аварийное восстановление включает резервное копирование данных и архивацию и может включать ручное вмешательство, например восстановление базы данных из резервной копии.</span><span class="sxs-lookup"><span data-stu-id="6ca64-123">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="6ca64-124">Один из способов понять отличие высокой доступности от аварийного восстановления заключается в том, что последнее начинается, когда влияние ошибки превышает способность структуры высокой доступности ее обработать.</span><span class="sxs-lookup"><span data-stu-id="6ca64-124">One way to think about HA versus DR is that DR starts when the impact of a fault exceeds the ability of the HA design to handle it.</span></span>  

<span data-ttu-id="6ca64-125">При разработке отказоустойчивых приложений необходимо учитывать требования к доступности.</span><span class="sxs-lookup"><span data-stu-id="6ca64-125">When you design resiliency, you must understand your availability requirements.</span></span> <span data-ttu-id="6ca64-126">Какое время простоя приемлемо?</span><span class="sxs-lookup"><span data-stu-id="6ca64-126">How much downtime is acceptable?</span></span> <span data-ttu-id="6ca64-127">Это отчасти зависит от затрат.</span><span class="sxs-lookup"><span data-stu-id="6ca64-127">This is partly a function of cost.</span></span> <span data-ttu-id="6ca64-128">Во сколько возможный простой обойдется вашему бизнесу?</span><span class="sxs-lookup"><span data-stu-id="6ca64-128">How much will potential downtime cost your business?</span></span> <span data-ttu-id="6ca64-129">Сколько вы должны инвестировать в высокую доступность приложения?</span><span class="sxs-lookup"><span data-stu-id="6ca64-129">How much should you invest in making the application highly available?</span></span> <span data-ttu-id="6ca64-130">Вам также необходимо определить, что означает доступность для приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-130">You also have to define what it means for the application to be available.</span></span> <span data-ttu-id="6ca64-131">Например, "простаивает" ли приложение, если клиент может разместить заказ, но система не может обработать его в течение обычного периода времени?</span><span class="sxs-lookup"><span data-stu-id="6ca64-131">For example, is the application "down" if a customer can submit an order but the system cannot process it within the normal timeframe?</span></span> <span data-ttu-id="6ca64-132">Кроме того, рассмотрите вероятность возникновения определенного типа сбоев и то, является ли стратегия снижения рисков рентабельной.</span><span class="sxs-lookup"><span data-stu-id="6ca64-132">Also consider the probability of a particular type of outage occurring, and whether a mitigation strategy is cost-effective.</span></span>

<span data-ttu-id="6ca64-133">Другим распространенным термином является **непрерывность бизнес-процессов**, которая является способностью выполнять важные бизнес-функции во время и после неблагоприятных условий, таких как стихийное бедствие или недоступность службы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-133">Another common term is **business continuity** (BC), which is the ability to perform essential business functions during and after adverse conditions, such as a natural disaster or a downed service.</span></span> <span data-ttu-id="6ca64-134">Непрерывность бизнес-процессов охватывает всю деятельность бизнеса, включая физические объекты, людей, связь, транспорт и ИТ.</span><span class="sxs-lookup"><span data-stu-id="6ca64-134">BC covers the entire operation of the business, including physical facilities, people, communications, transportation, and IT.</span></span> <span data-ttu-id="6ca64-135">В этой статье основное внимание уделяется облачным приложениям, но планирование отказоустойчивости должно выполняться в контексте общих требований непрерывности бизнес-процессов.</span><span class="sxs-lookup"><span data-stu-id="6ca64-135">This article focuses on cloud applications, but resilience planning must be done in the context of overall BC requirements.</span></span>

<span data-ttu-id="6ca64-136">**Резервное копирование данных** — важная часть процесса аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="6ca64-136">**Data backup** is a critical part of DR.</span></span> <span data-ttu-id="6ca64-137">При сбое компонентов приложения без отслеживания состояния их всегда можно развернуть повторно.</span><span class="sxs-lookup"><span data-stu-id="6ca64-137">If the stateless components of an application fail, you can always redeploy them.</span></span> <span data-ttu-id="6ca64-138">Но в случае потери данных система не сможет вернуться в стабильное состояние.</span><span class="sxs-lookup"><span data-stu-id="6ca64-138">But if data is lost, the system can't return to a stable state.</span></span> <span data-ttu-id="6ca64-139">Следует создать резервную копию данных, в идеале — в другом регионе на случай аварии на уровне всего региона.</span><span class="sxs-lookup"><span data-stu-id="6ca64-139">Data must be backed up, ideally in a different region in case of a region-wide disaster.</span></span>

<span data-ttu-id="6ca64-140">Резервное копирование отличается от **репликации данных**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-140">Backup is distinct from **data replication**.</span></span> <span data-ttu-id="6ca64-141">Репликация данных предполагает копирование данных практически в реальном времени, чтобы для системы можно было выполнить отработку отказа с переключением на реплику.</span><span class="sxs-lookup"><span data-stu-id="6ca64-141">Data replication involves copying data in near-real-time, so that the system can fail over quickly to a replica.</span></span> <span data-ttu-id="6ca64-142">Многие системы баз данных поддерживают репликацию. Например, SQL Server поддерживает группы доступности AlwaysOn SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6ca64-142">Many databases systems support replication; for example, SQL Server supports SQL Server Always On Availability Groups.</span></span> <span data-ttu-id="6ca64-143">Репликация данных может сократить время, необходимое для восстановления после сбоя, обеспечивая доступность таких данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-143">Data replication can reduce how long it takes to recover from an outage, by ensuring that a replica of the data is always standing by.</span></span> <span data-ttu-id="6ca64-144">Но репликация данных не защищает от ошибок оператора.</span><span class="sxs-lookup"><span data-stu-id="6ca64-144">However, data replication won't protect against human error.</span></span> <span data-ttu-id="6ca64-145">Если данные повреждены из-за ошибки оператора, в реплики будут скопированы поврежденные данные.</span><span class="sxs-lookup"><span data-stu-id="6ca64-145">If data gets corrupted because of human error, the corrupted data just gets copied to the replicas.</span></span> <span data-ttu-id="6ca64-146">Следовательно, вам по-прежнему необходимо включить в свою стратегию аварийного восстановления долгосрочное резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="6ca64-146">Therefore, you still need to include long-term backup in your DR strategy.</span></span>

## <a name="process-to-achieve-resiliency"></a><span data-ttu-id="6ca64-147">Процесс для обеспечения отказоустойчивости</span><span class="sxs-lookup"><span data-stu-id="6ca64-147">Process to achieve resiliency</span></span>

<span data-ttu-id="6ca64-148">Отказоустойчивость не является дополнительным компонентом.</span><span class="sxs-lookup"><span data-stu-id="6ca64-148">Resiliency is not an add-on.</span></span> <span data-ttu-id="6ca64-149">Ее следует спроектировать и реализовать в практической плоскости.</span><span class="sxs-lookup"><span data-stu-id="6ca64-149">It must be designed into the system and put into operational practice.</span></span> <span data-ttu-id="6ca64-150">Ниже приведена модель выполнения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-150">Here is a general model to follow:</span></span>

1. <span data-ttu-id="6ca64-151">**Определите** требования к доступности, исходя из потребностей бизнеса.</span><span class="sxs-lookup"><span data-stu-id="6ca64-151">**Define** your availability requirements, based on business needs.</span></span>
2. <span data-ttu-id="6ca64-152">**Разработайте** приложение для обеспечения отказоустойчивости.</span><span class="sxs-lookup"><span data-stu-id="6ca64-152">**Design** the application for resiliency.</span></span> <span data-ttu-id="6ca64-153">Начните с архитектуры, которая следует проверенным методам, а затем определите возможные точки сбоя в ней.</span><span class="sxs-lookup"><span data-stu-id="6ca64-153">Start with an architecture that follows proven practices, and then identify the possible failure points in that architecture.</span></span>
3. <span data-ttu-id="6ca64-154">**Реализуйте** стратегии для обнаружения и восстановления после сбоев.</span><span class="sxs-lookup"><span data-stu-id="6ca64-154">**Implement** strategies to detect and recover from failures.</span></span>
4. <span data-ttu-id="6ca64-155">**Протестируйте** реализацию путем имитации сбоев и активации принудительной отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="6ca64-155">**Test** the implementation by simulating faults and triggering forced failovers.</span></span>
5. <span data-ttu-id="6ca64-156">**Разверните** приложение в среде разработки, используя надежный, повторяемый процесс.</span><span class="sxs-lookup"><span data-stu-id="6ca64-156">**Deploy** the application into production using a reliable, repeatable process.</span></span>
6. <span data-ttu-id="6ca64-157">**Отслеживайте** приложение для обнаружения сбоев.</span><span class="sxs-lookup"><span data-stu-id="6ca64-157">**Monitor** the application to detect failures.</span></span> <span data-ttu-id="6ca64-158">Контролируя систему, вы можете оценить работоспособность приложения и при необходимости отреагировать на инциденты.</span><span class="sxs-lookup"><span data-stu-id="6ca64-158">By monitoring the system, you can gauge the health of the application and respond to incidents if necessary.</span></span>
7. <span data-ttu-id="6ca64-159">**Реагируйте** на сбои, требующие ручного вмешательства.</span><span class="sxs-lookup"><span data-stu-id="6ca64-159">**Respond** if there are failure that require manual interventions.</span></span>

<span data-ttu-id="6ca64-160">В оставшейся части этой статьи мы обсудим каждый из этих шагов более подробно.</span><span class="sxs-lookup"><span data-stu-id="6ca64-160">In the remainder of this article, we discuss each of these steps in more detail.</span></span>

## <a name="define-your-availability-requirements"></a><span data-ttu-id="6ca64-161">Определение требований к доступности</span><span class="sxs-lookup"><span data-stu-id="6ca64-161">Define your availability requirements</span></span>

<span data-ttu-id="6ca64-162">Планирование отказоустойчивости начинается с бизнес-требований.</span><span class="sxs-lookup"><span data-stu-id="6ca64-162">Resiliency planning starts with business requirements.</span></span> <span data-ttu-id="6ca64-163">Ниже приведены несколько подходов к реализации отказоустойчивости в зависимости от требований.</span><span class="sxs-lookup"><span data-stu-id="6ca64-163">Here are some approaches for thinking about resiliency in those terms.</span></span>

### <a name="decompose-by-workload"></a><span data-ttu-id="6ca64-164">Распределение рабочей нагрузки</span><span class="sxs-lookup"><span data-stu-id="6ca64-164">Decompose by workload</span></span>

<span data-ttu-id="6ca64-165">Многие облачные решения состоят из множества рабочих нагрузок приложений.</span><span class="sxs-lookup"><span data-stu-id="6ca64-165">Many cloud solutions consist of multiple application workloads.</span></span> <span data-ttu-id="6ca64-166">Термин "рабочая нагрузка" в этом контексте означает дискретную возможность или вычислительную задачу, которая может быть логически отделена от других задач с точки зрения требований к бизнес-логике и хранению данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-166">The term "workload" in this context means a discrete capability or computing task, which can be logically separated from other tasks, in terms of business logic and data storage requirements.</span></span> <span data-ttu-id="6ca64-167">Например, приложение для электронной коммерции может содержать следующие рабочие нагрузки:</span><span class="sxs-lookup"><span data-stu-id="6ca64-167">For example, an e-commerce app might include the following workloads:</span></span>

* <span data-ttu-id="6ca64-168">просмотр и поиск в каталоге продукции;</span><span class="sxs-lookup"><span data-stu-id="6ca64-168">Browse and search a product catalog.</span></span>
* <span data-ttu-id="6ca64-169">создание и отслеживание заказов;</span><span class="sxs-lookup"><span data-stu-id="6ca64-169">Create and track orders.</span></span>
* <span data-ttu-id="6ca64-170">просмотр рекомендаций.</span><span class="sxs-lookup"><span data-stu-id="6ca64-170">View recommendations.</span></span>

<span data-ttu-id="6ca64-171">Эти рабочие нагрузки могут иметь различные требования к доступности, масштабируемости, согласованности данных и аварийному восстановлению.</span><span class="sxs-lookup"><span data-stu-id="6ca64-171">These workloads might have different requirements for availability, scalability, data consistency, and disaster recovery.</span></span> <span data-ttu-id="6ca64-172">Для регулирования расходов и рисков необходимо принять соответствующие бизнес-решения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-172">There are business decisions to be made in terms of balancing cost versus risk.</span></span>

<span data-ttu-id="6ca64-173">Также рассмотрите варианты использования.</span><span class="sxs-lookup"><span data-stu-id="6ca64-173">Also consider usage patterns.</span></span> <span data-ttu-id="6ca64-174">Существуют ли определенные критические периоды, когда система должна быть доступной?</span><span class="sxs-lookup"><span data-stu-id="6ca64-174">Are there certain critical periods when the system must be available?</span></span> <span data-ttu-id="6ca64-175">Например, служба заполнения налоговых деклараций не должна стать недоступной прямо перед крайним сроком их подачи, служба потоковой передачи видео должна оставаться доступной во время большого спортивного мероприятия и так далее.</span><span class="sxs-lookup"><span data-stu-id="6ca64-175">For example, a tax-filing service can't go down right before the filing deadline, a video streaming service must stay up during a big sports event, and so on.</span></span> <span data-ttu-id="6ca64-176">В критические периоды у вас могут быть избыточные развертывания в нескольких регионах, чтобы приложение могло выполнить отработку отказа, если в одном регионе произошел сбой.</span><span class="sxs-lookup"><span data-stu-id="6ca64-176">During the critical periods, you might have redundant deployments across several regions, so the application could fail over if one region failed.</span></span> <span data-ttu-id="6ca64-177">Тем не менее, развертывание в нескольких регионах теоретически является более дорогостоящим, поэтому в менее критических ситуациях вы можете запустить приложение в одном регионе.</span><span class="sxs-lookup"><span data-stu-id="6ca64-177">However, a multi-region deployment is potentially more expensive, so during less critical times, you might run the application in a single region.</span></span> <span data-ttu-id="6ca64-178">В некоторых случаях можно избежать дополнительных затрат, используя современные бессерверные средства с оплатой по мере потребления. Таким образом, плата не будет взиматься за неиспользуемые вычислительные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-178">In some cases, the additional expense can be mitigated by using modern serverless techniques, which use consumption-based billing, so you are not charged for under-utilitzed compute resources.</span></span>

### <a name="rto-and-rpo"></a><span data-ttu-id="6ca64-179">RTO и RPO</span><span class="sxs-lookup"><span data-stu-id="6ca64-179">RTO and RPO</span></span>

<span data-ttu-id="6ca64-180">Двумя важными метриками, которые следует рассмотреть, являются целевое время восстановления и целевая точка восстановления, так как они связаны с аварийным восстановлением.</span><span class="sxs-lookup"><span data-stu-id="6ca64-180">Two important metrics to consider are the recovery time objective and recovery point objective, as they pertain to disaster recovery.</span></span>

* <span data-ttu-id="6ca64-181">**Целевое время восстановления** (RTO) — это максимально допустимое время, в течение которого приложение может быть недоступно после инцидента.</span><span class="sxs-lookup"><span data-stu-id="6ca64-181">**Recovery time objective** (RTO) is the maximum acceptable time that an application can be unavailable after an incident.</span></span> <span data-ttu-id="6ca64-182">Если ваше RTO составляет 90 минут, вы должны иметь возможность восстановить приложение в рабочем состоянии в течение 90 минут с момента начала сбоя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-182">If your RTO is 90 minutes, you must be able to restore the application to a running state within 90 minutes from the start of a disaster.</span></span> <span data-ttu-id="6ca64-183">Если у вас очень низкий показатель RTO, вы можете оставить развертывание в дополнительном регионе постоянно работающим в режиме ожидания с конфигурацией "активный-пассивный" для защиты от регионального сбоя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-183">If you have a very low RTO, you might keep a second regional deployment continually running an active/passive configuration on standby, to protect against a regional outage.</span></span> <span data-ttu-id="6ca64-184">В некоторых случаях вы можете развернуть конфигурацию "активный-активный", чтобы достичь еще более низкого показателя RTO.</span><span class="sxs-lookup"><span data-stu-id="6ca64-184">In some cases you might deploy an active/active configuration to achieve even lower RTO.</span></span>

* <span data-ttu-id="6ca64-185">**Целевая точка восстановления** (RPO) — это максимальная продолжительность потери данных, которая является приемлемой во время аварии.</span><span class="sxs-lookup"><span data-stu-id="6ca64-185">**Recovery point objective** (RPO) is the maximum duration of data loss that is acceptable during a disaster.</span></span> <span data-ttu-id="6ca64-186">Например, если вы храните данные в одной базе данных без репликации в другие базы данных и ежечасно выполняете резервное копирование, вы можете потерять до часа данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-186">For example, if you store data in a single database, with no replication to other databases, and perform hourly backups, you could lose up to an hour of data.</span></span>

<span data-ttu-id="6ca64-187">RTO и RPO не являются функциональными требованиями системы и зависят от бизнес-требований.</span><span class="sxs-lookup"><span data-stu-id="6ca64-187">RTO and RPO are non-functional requirements of a system, and should be dictated by business requirements.</span></span> <span data-ttu-id="6ca64-188">Для получения этих значений рекомендуется провести оценку рисков и четко определить стоимость простоев или потери данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-188">To derive these values, it's a good idea to conduct a risk assessment, and clearly understanding the cost of downtime or data loss.</span></span>

### <a name="mttr-and-mtbf"></a><span data-ttu-id="6ca64-189">MTTR и MTBF</span><span class="sxs-lookup"><span data-stu-id="6ca64-189">MTTR and MTBF</span></span>

<span data-ttu-id="6ca64-190">Существует еще две меры, в которых измеряется доступность: среднее время восстановления (MTTR) и среднее время безотказной работы (MTBF).</span><span class="sxs-lookup"><span data-stu-id="6ca64-190">Two other common measures of availability are mean time to recover (MTTR) and mean time between failures (MTBF).</span></span> <span data-ttu-id="6ca64-191">Эти меры поставщики услуг обычно используют для внутренних целей, чтобы определить, в каких случаях добавлять избыточность на уровне облачных служб и какие соглашения об уровне обслуживания предоставлять клиентам.</span><span class="sxs-lookup"><span data-stu-id="6ca64-191">These measures are usually used internally by service providers to determine where to add redundancy to cloud services, and which SLAs to provide to customers.</span></span>

<span data-ttu-id="6ca64-192">**Среднее время восстановления**  (MTTR) — это среднее время, которое требуется для восстановления компонента после сбоя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-192">**Mean time to recover** (MTTR) is the average time that it takes to restore a component after a failure.</span></span> <span data-ttu-id="6ca64-193">MTTR является эмпирическим фактом о компоненте.</span><span class="sxs-lookup"><span data-stu-id="6ca64-193">MTTR is an empirical fact about a component.</span></span> <span data-ttu-id="6ca64-194">Исходя из MTTR каждого компонента, можно оценить MTTR всего приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-194">Based on the MTTR of each component, you can estimate the MTTR of an entire application.</span></span> <span data-ttu-id="6ca64-195">Если приложение создается из нескольких компонентов с низким значением MTTR, то значение MTTR всего приложения будет также низким, то есть приложение будет быстро восстанавливаться после сбоев.</span><span class="sxs-lookup"><span data-stu-id="6ca64-195">Building applications from multiple components with low MTTR values results in an application with a low overall MTTR &mdash; one that recovers quickly from failures.</span></span>

<span data-ttu-id="6ca64-196">**Среднее время безотказной работы** (MTBF) — это время выполнения между простоями, которое гарантируется для компонента.</span><span class="sxs-lookup"><span data-stu-id="6ca64-196">**Mean time between failures** (MTBF) is the runtime that a component can reasonably expect to last between outages.</span></span> <span data-ttu-id="6ca64-197">Эта метрика позволяет рассчитать, как часто служба будет недоступна.</span><span class="sxs-lookup"><span data-stu-id="6ca64-197">This metric can help you to calculate how frequently a service will become unavailable.</span></span> <span data-ttu-id="6ca64-198">Ненадежный компонент имеет низкий показатель MTBF, что отражается в низком уровне SLA для этого компонента.</span><span class="sxs-lookup"><span data-stu-id="6ca64-198">An unreliable component has a low MTBF, resulting in a low SLA number for that component.</span></span> <span data-ttu-id="6ca64-199">Но вы можете избежать низкого показателя MTBF, развернув несколько экземпляров компонента и реализовав отработку отказа между ними.</span><span class="sxs-lookup"><span data-stu-id="6ca64-199">However, a low MTBF can be mitigated by deploying multiple instances of the component and implementing failover between them.</span></span>

> [!NOTE]
> <span data-ttu-id="6ca64-200">Если какие-либо значения MTTR компонентов при настройке высокого уровня доступности превышают RTO системы, то сбой в системе приведет к недопустимому сбою бизнес-процессов.</span><span class="sxs-lookup"><span data-stu-id="6ca64-200">If ANY of the MTTR values of components in a high-availability setup exceed the RTO of the system, then a failure in the system will cause an unacceptable business disruption.</span></span> <span data-ttu-id="6ca64-201">Восстановить систему в пределах определенного RTO невозможно.</span><span class="sxs-lookup"><span data-stu-id="6ca64-201">It won't be possible to restore the system within the defined RTO.</span></span>

### <a name="slas"></a><span data-ttu-id="6ca64-202">Соглашения об уровне обслуживания</span><span class="sxs-lookup"><span data-stu-id="6ca64-202">SLAs</span></span>
<span data-ttu-id="6ca64-203">В [соглашении Azure об уровне обслуживания][sla] (SLA) приводится описание обязательств корпорации Майкрософт в отношении доступности и подключения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-203">In Azure, the [Service Level Agreement][sla] (SLA) describes Microsoft’s commitments for uptime and connectivity.</span></span> <span data-ttu-id="6ca64-204">Если SLA для конкретной службы составляет 99,9 %, это означает, что вы должны ожидать, что служба будет доступна 99,9 % времени.</span><span class="sxs-lookup"><span data-stu-id="6ca64-204">If the SLA for a particular service is 99.9%, it means you should expect the service to be available 99.9% of the time.</span></span>

> [!NOTE]
> <span data-ttu-id="6ca64-205">В SLA Azure также включены положения о получении кредита на службу, если SLA не выполняется, а также конкретные определения "доступности" для каждой службы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-205">The Azure SLA also includes provisions for obtaining a service credit if the SLA is not met, along with specific definitions of "availability" for each service.</span></span> <span data-ttu-id="6ca64-206">Этот аспект SLA действует как политика принудительного применения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-206">That aspect of the SLA acts as an enforcement policy.</span></span>
>

<span data-ttu-id="6ca64-207">Вы должны определить свои собственные целевые соглашения SLA для каждой рабочей нагрузки в своем решении.</span><span class="sxs-lookup"><span data-stu-id="6ca64-207">You should define your own target SLAs for each workload in your solution.</span></span> <span data-ttu-id="6ca64-208">SLA позволяет оценить, соответствует ли архитектура бизнес-требованиям.</span><span class="sxs-lookup"><span data-stu-id="6ca64-208">An SLA makes it possible to evaluate whether the architecture meets the business requirements.</span></span> <span data-ttu-id="6ca64-209">Например, если для рабочей нагрузки требуется 99,99 % времени безотказной работы, но она зависит от службы с SLA на уровне 99,9 %, эта служба не может быть единой точкой отказа в системе.</span><span class="sxs-lookup"><span data-stu-id="6ca64-209">For example, if a workload requires 99.99% uptime, but depends on a service with a 99.9% SLA, that service cannot be a single-point of failure in the system.</span></span> <span data-ttu-id="6ca64-210">Одним из средств защиты является наличие резервного пути в случае сбоя службы или принятие других мер для восстановления после сбоя в этой службе.</span><span class="sxs-lookup"><span data-stu-id="6ca64-210">One remedy is to have a fallback path in case the service fails, or take other measures to recover from a failure in that service.</span></span>

<span data-ttu-id="6ca64-211">В следующей таблице показано потенциальное суммарное время простоя для различных уровней SLA.</span><span class="sxs-lookup"><span data-stu-id="6ca64-211">The following table shows the potential cumulative downtime for various SLA levels.</span></span>

| <span data-ttu-id="6ca64-212">Соглашение об уровне обслуживания</span><span class="sxs-lookup"><span data-stu-id="6ca64-212">SLA</span></span> | <span data-ttu-id="6ca64-213">Время простоя в неделю</span><span class="sxs-lookup"><span data-stu-id="6ca64-213">Downtime per week</span></span> | <span data-ttu-id="6ca64-214">Время простоя в месяц</span><span class="sxs-lookup"><span data-stu-id="6ca64-214">Downtime per month</span></span> | <span data-ttu-id="6ca64-215">Время простоя в год</span><span class="sxs-lookup"><span data-stu-id="6ca64-215">Downtime per year</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="6ca64-216">99 %</span><span class="sxs-lookup"><span data-stu-id="6ca64-216">99%</span></span> |<span data-ttu-id="6ca64-217">1,68 часа</span><span class="sxs-lookup"><span data-stu-id="6ca64-217">1.68 hours</span></span> |<span data-ttu-id="6ca64-218">7,2 часа</span><span class="sxs-lookup"><span data-stu-id="6ca64-218">7.2 hours</span></span> |<span data-ttu-id="6ca64-219">3,65 дня</span><span class="sxs-lookup"><span data-stu-id="6ca64-219">3.65 days</span></span> |
| <span data-ttu-id="6ca64-220">99,9 %</span><span class="sxs-lookup"><span data-stu-id="6ca64-220">99.9%</span></span> |<span data-ttu-id="6ca64-221">10,1 минуты</span><span class="sxs-lookup"><span data-stu-id="6ca64-221">10.1 minutes</span></span> |<span data-ttu-id="6ca64-222">43,2 мин</span><span class="sxs-lookup"><span data-stu-id="6ca64-222">43.2 minutes</span></span> |<span data-ttu-id="6ca64-223">8,76 часа</span><span class="sxs-lookup"><span data-stu-id="6ca64-223">8.76 hours</span></span> |
| <span data-ttu-id="6ca64-224">99,95 %</span><span class="sxs-lookup"><span data-stu-id="6ca64-224">99.95%</span></span> |<span data-ttu-id="6ca64-225">5 мин</span><span class="sxs-lookup"><span data-stu-id="6ca64-225">5 minutes</span></span> |<span data-ttu-id="6ca64-226">21,6 мин</span><span class="sxs-lookup"><span data-stu-id="6ca64-226">21.6 minutes</span></span> |<span data-ttu-id="6ca64-227">4,38 часа</span><span class="sxs-lookup"><span data-stu-id="6ca64-227">4.38 hours</span></span> |
| <span data-ttu-id="6ca64-228">99,99 %</span><span class="sxs-lookup"><span data-stu-id="6ca64-228">99.99%</span></span> |<span data-ttu-id="6ca64-229">1,01 минуты</span><span class="sxs-lookup"><span data-stu-id="6ca64-229">1.01 minutes</span></span> |<span data-ttu-id="6ca64-230">4,32 минуты</span><span class="sxs-lookup"><span data-stu-id="6ca64-230">4.32 minutes</span></span> |<span data-ttu-id="6ca64-231">52,56 минуты</span><span class="sxs-lookup"><span data-stu-id="6ca64-231">52.56 minutes</span></span> |
| <span data-ttu-id="6ca64-232">99,999 %</span><span class="sxs-lookup"><span data-stu-id="6ca64-232">99.999%</span></span> |<span data-ttu-id="6ca64-233">6 секунд</span><span class="sxs-lookup"><span data-stu-id="6ca64-233">6 seconds</span></span> |<span data-ttu-id="6ca64-234">25,9 секунды</span><span class="sxs-lookup"><span data-stu-id="6ca64-234">25.9 seconds</span></span> |<span data-ttu-id="6ca64-235">5,26 минуты</span><span class="sxs-lookup"><span data-stu-id="6ca64-235">5.26 minutes</span></span> |

<span data-ttu-id="6ca64-236">Конечно, более высокая доступность лучше при прочих равных условиях.</span><span class="sxs-lookup"><span data-stu-id="6ca64-236">Of course, higher availability is better, everything else being equal.</span></span> <span data-ttu-id="6ca64-237">Но по мере того, как вы стремитесь к большему показателю времени безотказной работы, стоимость и сложность достижения такого уровня доступности возрастают.</span><span class="sxs-lookup"><span data-stu-id="6ca64-237">But as you strive for more 9s, the cost and complexity to achieve that level of availability grows.</span></span> <span data-ttu-id="6ca64-238">Время безотказной работы на уровне 99,99 % составляет около 5 минут общего времени простоя в месяц.</span><span class="sxs-lookup"><span data-stu-id="6ca64-238">An uptime of 99.99% translates to about 5 minutes of total downtime per month.</span></span> <span data-ttu-id="6ca64-239">Стоит ли достижение уровня доступности 99,99999 % дополнительной сложности и затрат?</span><span class="sxs-lookup"><span data-stu-id="6ca64-239">Is it worth the additional complexity and cost to reach five 9s?</span></span> <span data-ttu-id="6ca64-240">Ответ зависит от бизнес-требований.</span><span class="sxs-lookup"><span data-stu-id="6ca64-240">The answer depends on the business requirements.</span></span>

<span data-ttu-id="6ca64-241">Ниже приведены некоторые рекомендации по выбору SLA:</span><span class="sxs-lookup"><span data-stu-id="6ca64-241">Here are some other considerations when defining an SLA:</span></span>

* <span data-ttu-id="6ca64-242">Чтобы достичь уровня 99,99 %, вы, вероятно, не сможете полагаться на ручное вмешательство для восстановления после сбоев.</span><span class="sxs-lookup"><span data-stu-id="6ca64-242">To achieve four 9's (99.99%), you probably can't rely on manual intervention to recover from failures.</span></span> <span data-ttu-id="6ca64-243">Приложение должно иметь возможности самостоятельной диагностики и самовосстановления.</span><span class="sxs-lookup"><span data-stu-id="6ca64-243">The application must be self-diagnosing and self-healing.</span></span>
* <span data-ttu-id="6ca64-244">При более высоком уровне, чем 99,99 %, сложность состоит в обнаружении сбоев достаточно быстро, чтобы соответствовать SLA.</span><span class="sxs-lookup"><span data-stu-id="6ca64-244">Beyond four 9's, it is challenging to detect outages quickly enough to meet the SLA.</span></span>
* <span data-ttu-id="6ca64-245">Подумайте о временном окне, для которого измеряется SLA.</span><span class="sxs-lookup"><span data-stu-id="6ca64-245">Think about the time window that your SLA is measured against.</span></span> <span data-ttu-id="6ca64-246">Чем меньше окно, тем строже допуски.</span><span class="sxs-lookup"><span data-stu-id="6ca64-246">The smaller the window, the tighter the tolerances.</span></span> <span data-ttu-id="6ca64-247">Вероятно, нет смысла определять SLA с точки зрения ежечасного или ежедневного времени непрерывной работы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-247">It probably doesn't make sense to define your SLA in terms of hourly or daily uptime.</span></span>
* <span data-ttu-id="6ca64-248">Проанализируйте результаты измерений MTBF и MTTR.</span><span class="sxs-lookup"><span data-stu-id="6ca64-248">Consider the MTBF and MTTR measurements.</span></span> <span data-ttu-id="6ca64-249">Чем выше уровень SLA, тем реже служба будет недоступна и тем быстрее она должна восстанавливаться.</span><span class="sxs-lookup"><span data-stu-id="6ca64-249">The lower your SLA, the less frequently the service can go down, and the quicker the service must recover.</span></span>

### <a name="composite-slas"></a><span data-ttu-id="6ca64-250">Составные соглашения об уровне обслуживания</span><span class="sxs-lookup"><span data-stu-id="6ca64-250">Composite SLAs</span></span>
<span data-ttu-id="6ca64-251">Рассмотрим веб-приложение службы приложений, которое выполняет запись в базу данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="6ca64-251">Consider an App Service web app that writes to Azure SQL Database.</span></span> <span data-ttu-id="6ca64-252">На момент написания статьи эти службы Azure имеют следующие соглашения об уровне обслуживания:</span><span class="sxs-lookup"><span data-stu-id="6ca64-252">At the time of this writing, these Azure services have the following SLAs:</span></span>

* <span data-ttu-id="6ca64-253">Веб-приложения службы приложений — 99,95 %.</span><span class="sxs-lookup"><span data-stu-id="6ca64-253">App Service Web Apps = 99.95%</span></span>
* <span data-ttu-id="6ca64-254">База данных SQL — 99,99 %.</span><span class="sxs-lookup"><span data-stu-id="6ca64-254">SQL Database = 99.99%</span></span>

![Составное соглашение об уровне обслуживания](./images/sla1.png)

<span data-ttu-id="6ca64-256">Каково максимальное время простоя, ожидаемое для этого приложения?</span><span class="sxs-lookup"><span data-stu-id="6ca64-256">What is the maximum downtime you would expect for this application?</span></span> <span data-ttu-id="6ca64-257">Если какая-либо из служб завершается ошибкой, приложение также прекращает работу.</span><span class="sxs-lookup"><span data-stu-id="6ca64-257">If either service fails, the whole application fails.</span></span> <span data-ttu-id="6ca64-258">Как правило, вероятность сбоя каждой службы независима, поэтому составное SLA для этого приложения составляет 99,95 % &times; 99,99 % = 99,94 %.</span><span class="sxs-lookup"><span data-stu-id="6ca64-258">In general, the probability of each service failing is independent, so the composite SLA for this application is 99.95% &times; 99.99% = 99.94%.</span></span> <span data-ttu-id="6ca64-259">Это ниже, чем отдельные SLA, потому что приложение, которое основывается на нескольких службах, имеет больше потенциальных точек отказа.</span><span class="sxs-lookup"><span data-stu-id="6ca64-259">That's lower than the individual SLAs, which isn't surprising, because an application that relies on multiple services has more potential failure points.</span></span>

<span data-ttu-id="6ca64-260">С другой стороны составное SLA можно усовершенствовать, создав независимые резервные пути.</span><span class="sxs-lookup"><span data-stu-id="6ca64-260">On the other hand, you can improve the composite SLA by creating independent fallback paths.</span></span> <span data-ttu-id="6ca64-261">Например, если база данных SQL недоступна, поместите транзакции в очередь, которая будет обработана позже.</span><span class="sxs-lookup"><span data-stu-id="6ca64-261">For example, if SQL Database is unavailable, put transactions into a queue, to be processed later.</span></span> 

![Составное соглашение об уровне обслуживания](./images/sla2.png)

<span data-ttu-id="6ca64-263">При такой структуре приложение по-прежнему доступно, даже если оно не может подключиться к базе данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-263">With this design, the application is still available even if it can't connect to the database.</span></span> <span data-ttu-id="6ca64-264">Тем не менее, оно завершится сбоем, если одновременно произойдет сбой базы данных и очереди.</span><span class="sxs-lookup"><span data-stu-id="6ca64-264">However, it fails if the database and the queue both fail at the same time.</span></span> <span data-ttu-id="6ca64-265">Ожидаемый процент времени для одновременного сбоя составляет 0,0001 &times; 0,001, поэтому составное SLA для этого комбинированного пути будет:</span><span class="sxs-lookup"><span data-stu-id="6ca64-265">The expected percentage of time for a simultaneous failure is 0.0001 &times; 0.001, so the composite SLA for this combined path is:</span></span>  

* <span data-ttu-id="6ca64-266">База данных или очередь = 1,0 &minus; (0,0001 &times; 0,001) = 99,99999 %</span><span class="sxs-lookup"><span data-stu-id="6ca64-266">Database OR queue = 1.0 &minus; (0.0001 &times; 0.001) = 99.99999%</span></span>

<span data-ttu-id="6ca64-267">Общий уровень SLA:</span><span class="sxs-lookup"><span data-stu-id="6ca64-267">The total composite SLA is:</span></span>

* <span data-ttu-id="6ca64-268">Веб-приложение и (очередь или база данных) = 99,95 % &times; 99,99999 % = ~99,95 %</span><span class="sxs-lookup"><span data-stu-id="6ca64-268">Web app AND (database OR queue) = 99.95% &times; 99.99999% = ~99.95%</span></span>

<span data-ttu-id="6ca64-269">Но есть и недостатки этого подхода.</span><span class="sxs-lookup"><span data-stu-id="6ca64-269">But there are tradeoffs to this approach.</span></span> <span data-ttu-id="6ca64-270">Логика приложения сложнее, вы платите за очередь, и могут возникнуть проблемы согласованности данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-270">The application logic is more complex, you are paying for the queue, and there may be data consistency issues to consider.</span></span>

<span data-ttu-id="6ca64-271">**SLA для развертываний в нескольких регионах**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-271">**SLA for multi-region deployments**.</span></span> <span data-ttu-id="6ca64-272">Другой способ обеспечения высокой доступности заключается в развертывании приложения в нескольких регионах и использовании диспетчера трафика Azure для отработки отказа, если приложение не работает в одном регионе.</span><span class="sxs-lookup"><span data-stu-id="6ca64-272">Another HA technique is to deploy the application in more than one region, and use Azure Traffic Manager to fail over if the application fails in one region.</span></span> <span data-ttu-id="6ca64-273">Для развертывания в нескольких регионах составное SLA рассчитывается следующим образом.</span><span class="sxs-lookup"><span data-stu-id="6ca64-273">For a multi-region deployment, the composite SLA is calculated as follows.</span></span>

<span data-ttu-id="6ca64-274">Например, *N* — это составное SLA для приложения, развернутого в одном регионе, а *R* — это количество регионов, в которых развернуто приложение.</span><span class="sxs-lookup"><span data-stu-id="6ca64-274">Let *N* be the composite SLA for the application deployed in one region, and *R* be the number of regions where the application is deployed.</span></span> <span data-ttu-id="6ca64-275">Ожидаемая вероятность того, что приложение будет работать во всех регионах одновременно, будет ((1 &minus N) ^ R).</span><span class="sxs-lookup"><span data-stu-id="6ca64-275">The expected chance that the application will fail in all regions at the same time is ((1 &minus N) ^ R).</span></span>

<span data-ttu-id="6ca64-276">Например, если в одном регионе согласно SLA обеспечивается доступность 99,95 %:</span><span class="sxs-lookup"><span data-stu-id="6ca64-276">For example, if the single-region SLA is 99.95%,</span></span>

* <span data-ttu-id="6ca64-277">комбинированное SLA для двух регионов = (1 &minus; (0,9995 ^ 2)) = 99,999975 %;</span><span class="sxs-lookup"><span data-stu-id="6ca64-277">The combined SLA for two regions = (1 &minus; (0.9995 ^ 2)) = 99.999975%</span></span>
* <span data-ttu-id="6ca64-278">комбинированное SLA для четырех регионов = (1 &minus; (0,9995 ^ 4)) = 99,999999 %.</span><span class="sxs-lookup"><span data-stu-id="6ca64-278">The combined SLA for four regions = (1 &minus; (0.9995 ^ 4)) = 99.999999%</span></span>

<span data-ttu-id="6ca64-279">Также необходимо учитывать [SLA для диспетчера трафика][tm-sla].</span><span class="sxs-lookup"><span data-stu-id="6ca64-279">You must also factor in the [SLA for Traffic Manager][tm-sla].</span></span> <span data-ttu-id="6ca64-280">На момент написания этой статьи SLA для SLA диспетчера трафика составляет 99,99 %.</span><span class="sxs-lookup"><span data-stu-id="6ca64-280">At the time of this writing, the SLA for Traffic Manager SLA is 99.99%.</span></span>

<span data-ttu-id="6ca64-281">Кроме того, отработка отказа не происходит мгновенно при конфигурации "активный-пассивный", что может привести к простоям во время отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="6ca64-281">Also, failing over is not instantaneous in active-passive configurations, which can result in some downtime during a failover.</span></span> <span data-ttu-id="6ca64-282">См. сведения в статье [Мониторинг конечных точек в диспетчере трафика][tm-failover].</span><span class="sxs-lookup"><span data-stu-id="6ca64-282">See [Traffic Manager endpoint monitoring and failover][tm-failover].</span></span>

<span data-ttu-id="6ca64-283">Вычисленный номер SLA является полезным базовым показателем, но не достаточно репрезентативным в контексте доступности.</span><span class="sxs-lookup"><span data-stu-id="6ca64-283">The calculated SLA number is a useful baseline, but it doesn't tell the whole story about availability.</span></span> <span data-ttu-id="6ca64-284">Часто приложение может хуже работать постепенно, когда происходит сбой некритического пути.</span><span class="sxs-lookup"><span data-stu-id="6ca64-284">Often, an application can degrade gracefully when a non-critical path fails.</span></span> <span data-ttu-id="6ca64-285">Рассмотрим приложение, которое отображает каталог книг.</span><span class="sxs-lookup"><span data-stu-id="6ca64-285">Consider an application that shows a catalog of books.</span></span> <span data-ttu-id="6ca64-286">Если приложение не может получить уменьшенное изображение для обложки, оно может отображать изображение-заполнитель.</span><span class="sxs-lookup"><span data-stu-id="6ca64-286">If the application can't retrieve the thumbnail image for the cover, it might show a placeholder image.</span></span> <span data-ttu-id="6ca64-287">В этом случае неспособность получить изображение не уменьшает время работы приложения, хотя оно влияет на работу пользователя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-287">In that case, failing to get the image does not reduce the application's uptime, although it affects the user experience.</span></span>  

## <a name="design-for-resiliency"></a><span data-ttu-id="6ca64-288">Проектирование для обеспечения устойчивости</span><span class="sxs-lookup"><span data-stu-id="6ca64-288">Design for resiliency</span></span>

<span data-ttu-id="6ca64-289">На этапе разработки следует провести анализ режимов сбоя (FMA).</span><span class="sxs-lookup"><span data-stu-id="6ca64-289">During the design phase, you should perform a failure mode analysis (FMA).</span></span> <span data-ttu-id="6ca64-290">FMA предназначен для выявления потенциальных точек сбоя и определения того, как приложение реагирует на эти сбои.</span><span class="sxs-lookup"><span data-stu-id="6ca64-290">The goal of an FMA is to identify possible points of failure, and define how the application will respond to those failures.</span></span>

* <span data-ttu-id="6ca64-291">Как приложение обнаружит этот тип сбоя?</span><span class="sxs-lookup"><span data-stu-id="6ca64-291">How will the application detect this type of failure?</span></span>
* <span data-ttu-id="6ca64-292">Как приложение отреагирует на этот тип сбоя?</span><span class="sxs-lookup"><span data-stu-id="6ca64-292">How will the application respond to this type of failure?</span></span>
* <span data-ttu-id="6ca64-293">Как регистрируется и отслеживается сбой данного типа?</span><span class="sxs-lookup"><span data-stu-id="6ca64-293">How will you log and monitor this type of failure?</span></span>

<span data-ttu-id="6ca64-294">Дополнительные сведения о процессе FMA с рекомендациями для Azure см. в статье [Анализ режима сбоя][fma].</span><span class="sxs-lookup"><span data-stu-id="6ca64-294">For more information about the FMA process, with specific recommendations for Azure, see [Azure resiliency guidance: Failure mode analysis][fma].</span></span>

### <a name="example-of-identifying-failure-modes-and-detection-strategy"></a><span data-ttu-id="6ca64-295">Пример определения режимов отказа и стратегии обнаружения</span><span class="sxs-lookup"><span data-stu-id="6ca64-295">Example of identifying failure modes and detection strategy</span></span>
<span data-ttu-id="6ca64-296">**Точка сбоя:** вызов внешней веб-службы или API.</span><span class="sxs-lookup"><span data-stu-id="6ca64-296">**Failure point:** Call to an external web service / API.</span></span>

| <span data-ttu-id="6ca64-297">Режим сбоя</span><span class="sxs-lookup"><span data-stu-id="6ca64-297">Failure mode</span></span> | <span data-ttu-id="6ca64-298">Стратегия обнаружения</span><span class="sxs-lookup"><span data-stu-id="6ca64-298">Detection strategy</span></span> |
| --- | --- |
| <span data-ttu-id="6ca64-299">Ресурс недоступен</span><span class="sxs-lookup"><span data-stu-id="6ca64-299">Service is unavailable</span></span> |<span data-ttu-id="6ca64-300">HTTP 5xx</span><span class="sxs-lookup"><span data-stu-id="6ca64-300">HTTP 5xx</span></span> |
| <span data-ttu-id="6ca64-301">Регулирование</span><span class="sxs-lookup"><span data-stu-id="6ca64-301">Throttling</span></span> |<span data-ttu-id="6ca64-302">HTTP 429 (слишком много запросов)</span><span class="sxs-lookup"><span data-stu-id="6ca64-302">HTTP 429 (Too Many Requests)</span></span> |
| <span data-ttu-id="6ca64-303">Authentication</span><span class="sxs-lookup"><span data-stu-id="6ca64-303">Authentication</span></span> |<span data-ttu-id="6ca64-304">HTTP 401 (недостаточно прав)</span><span class="sxs-lookup"><span data-stu-id="6ca64-304">HTTP 401 (Unauthorized)</span></span> |
| <span data-ttu-id="6ca64-305">Низкое время отклика</span><span class="sxs-lookup"><span data-stu-id="6ca64-305">Slow response</span></span> |<span data-ttu-id="6ca64-306">Истекло время ожидания для запроса</span><span class="sxs-lookup"><span data-stu-id="6ca64-306">Request times out</span></span> |

### <a name="redundancy-and-designing-for-failure"></a><span data-ttu-id="6ca64-307">Избыточность и проектирование с учетом сбоев</span><span class="sxs-lookup"><span data-stu-id="6ca64-307">Redundancy and designing for failure</span></span>

<span data-ttu-id="6ca64-308">Сбои могут иметь разную степень воздействия.</span><span class="sxs-lookup"><span data-stu-id="6ca64-308">Failures can vary in the scope of their impact.</span></span> <span data-ttu-id="6ca64-309">Некоторые аппаратные сбои, например отказ диска, могут сказаться на работе одного хост-компьютера.</span><span class="sxs-lookup"><span data-stu-id="6ca64-309">Some hardware failures, such as a failed disk, may affect a single host machine.</span></span> <span data-ttu-id="6ca64-310">Сбой сетевого коммутатора может повлиять на всю серверную стойку.</span><span class="sxs-lookup"><span data-stu-id="6ca64-310">A failed network switch could affect a whole server rack.</span></span> <span data-ttu-id="6ca64-311">Реже случаются сбои, нарушающие работу всего центра обработки данных, например отключения питания в центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-311">Less common are failures that disrupt a whole data center, such as loss of power in a data center.</span></span> <span data-ttu-id="6ca64-312">В редких случаях весь регион может стать недоступным.</span><span class="sxs-lookup"><span data-stu-id="6ca64-312">Rarely, an entire region could become unavailable.</span></span>

<span data-ttu-id="6ca64-313">Один из основных способов обеспечить устойчивость приложения — настроить избыточность.</span><span class="sxs-lookup"><span data-stu-id="6ca64-313">One of the main ways to make an application resilient is through redundancy.</span></span> <span data-ttu-id="6ca64-314">Но вам нужно запланировать эту избыточность при разработке приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-314">But you need to plan for this redundancy when you design the application.</span></span> <span data-ttu-id="6ca64-315">Кроме того, требуемый уровень избыточности зависит от бизнес-требований — не каждому приложению требуется избыточность по регионам для защиты от регионального сбоя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-315">Also, the level of redundancy that you need depends on your business requirements &mdash; not every application needs redundancy across regions to guard against a regional outage.</span></span> <span data-ttu-id="6ca64-316">Как правило, используются компромиссные решения, обеспечивающие избыточность и надежность при сопоставимых затратах и уровне сложности.</span><span class="sxs-lookup"><span data-stu-id="6ca64-316">In general, there is a tradeoff between greater redundancy and reliability versus higher cost and complexity.</span></span>  

<span data-ttu-id="6ca64-317">В Azure доступен ряд возможностей, которые обеспечивают избыточность приложения на каждом уровне сбоя — от отдельных виртуальных машин до целых регионов.</span><span class="sxs-lookup"><span data-stu-id="6ca64-317">Azure has a number of features to make an application redundant at every level of failure, from an individual VM to an entire region.</span></span>

![Функции устойчивости в Azure](./images/redundancy.svg)

<span data-ttu-id="6ca64-319">**Отдельная виртуальная машина**</span><span class="sxs-lookup"><span data-stu-id="6ca64-319">**Single VM**.</span></span> <span data-ttu-id="6ca64-320">В рамках [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines) Azure гарантирует определенное время доступности отдельной виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="6ca64-320">Azure provides an [uptime SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines) for single VMs.</span></span> <span data-ttu-id="6ca64-321">(В виртуальных машинах должно использоваться хранилище класса Premium для всех дисков операционной системы и дисков данных.) Вы можете использовать дополнительные возможности в рамках этого соглашения, запуская несколько виртуальных машин. Но отдельная виртуальная машина также может быть достаточно надежна для некоторых рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="6ca64-321">(The VM must use premium storage for all Operating System Disks and Data Disks.) Although you can get a higher SLA by running two or more VMs, a single VM may be reliable enough for some workloads.</span></span> <span data-ttu-id="6ca64-322">Для рабочих нагрузок в рабочей среде рекомендуем использовать две или более виртуальных машин, чтобы обеспечить избыточность.</span><span class="sxs-lookup"><span data-stu-id="6ca64-322">For production workloads, however, we recommend using two or more VMs for redundancy.</span></span>

<span data-ttu-id="6ca64-323">**Группы доступности**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-323">**Availability sets**.</span></span> <span data-ttu-id="6ca64-324">Для защиты от локальных аппаратных сбоев, например сбоя диска или сетевого коммутатора, разверните две или более виртуальных машин в группе доступности.</span><span class="sxs-lookup"><span data-stu-id="6ca64-324">To protect against localized hardware failures, such as a disk or network switch failing, deploy two or more VMs in an availability set.</span></span> <span data-ttu-id="6ca64-325">Группа доступности состоит из двух или более *доменов сбоя*, которые совместно используют общие источники питания и сетевые коммутаторы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-325">An availability set consists of two or more *fault domains* that share a common power source and network switch.</span></span> <span data-ttu-id="6ca64-326">Виртуальные машины в наборе доступности распределены между доменами сбоя. Поэтому если аппаратный сбой влияет на один домен сбоя, сетевой трафик по-прежнему будет перенаправлять виртуальные машины в другие домены сбоя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-326">VMs in an availability set are distributed across the fault domains, so if a hardware failure affects one fault domain, network traffic can still be routed the VMs in the other fault domains.</span></span> <span data-ttu-id="6ca64-327">Дополнительные сведения о группах доступности см. в статье [Управление доступностью виртуальных машин Windows в Azure](/azure/virtual-machines/windows/manage-availability).</span><span class="sxs-lookup"><span data-stu-id="6ca64-327">For more information about Availability Sets, see [Manage the availability of Windows virtual machines in Azure](/azure/virtual-machines/windows/manage-availability).</span></span>

<span data-ttu-id="6ca64-328">**Зоны доступности**</span><span class="sxs-lookup"><span data-stu-id="6ca64-328">**Availability zones**.</span></span>  <span data-ttu-id="6ca64-329">Зона доступности — это физически изолированная зона в регионе Azure.</span><span class="sxs-lookup"><span data-stu-id="6ca64-329">An Availability Zone is a physically separate zone within an Azure region.</span></span> <span data-ttu-id="6ca64-330">У каждой зоны доступности есть отдельный источник питания, сеть и система охлаждения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-330">Each Availability Zone has a distinct power source, network, and cooling.</span></span> <span data-ttu-id="6ca64-331">Развертывание виртуальных машин между зонами доступности помогает защитить приложения от сбоев в центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-331">Deploying VMs across availability zones helps to protect an application against datacenter-wide failures.</span></span> <span data-ttu-id="6ca64-332">Не все регионы поддерживают Зоны доступности.</span><span class="sxs-lookup"><span data-stu-id="6ca64-332">Not all regions support Availability Zones.</span></span> <span data-ttu-id="6ca64-333">Список поддерживаемых регионов и служб см. в статье [Что такое Зоны доступности в Azure](/azure/availability-zones/az-overview).</span><span class="sxs-lookup"><span data-stu-id="6ca64-333">For a list of supported regions and services, see [What are Availability Zones in Azure?](/azure/availability-zones/az-overview).</span></span>

<span data-ttu-id="6ca64-334">Если вы планируете использовать Зоны доступности в развернутой службе, сначала убедитесь, что архитектура приложения и база кода поддерживают такую конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="6ca64-334">If you are planning to use Availability Zones in your deployment, first validate that your application architecture and code base can support this configuration.</span></span> <span data-ttu-id="6ca64-335">Прежде чем развернуть готовые коммерческие программы в рабочей среде, обратитесь к поставщику программного обеспечения и правильно проведите тестирование.</span><span class="sxs-lookup"><span data-stu-id="6ca64-335">If you are deploying commercial off-the-shelf software, consult with the software vendor and test adequately before deploying into production.</span></span> <span data-ttu-id="6ca64-336">Приложения должно сохранять состояние и предотвращать потерю данных в случае сбоя в пределах настроенной зоны.</span><span class="sxs-lookup"><span data-stu-id="6ca64-336">An application must be able to maintain state and prevent loss of data during an outage within the configured zone.</span></span> <span data-ttu-id="6ca64-337">Оно также должно поддерживать выполнение в эластичной и распределенной инфраструктуре без жестко заданных компонентов инфраструктуры, указанных в базе кода.</span><span class="sxs-lookup"><span data-stu-id="6ca64-337">The application must support running in an elastic and distributed infrastructure with no hard-coded infrastructure components specified in the code base.</span></span> 

<span data-ttu-id="6ca64-338">**Azure Site Recovery**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-338">**Azure Site Recovery**.</span></span>  <span data-ttu-id="6ca64-339">Реплицируйте виртуальные машины Azure в другой регион Azure для обеспечения непрерывности бизнес-процессов и аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="6ca64-339">Replicate Azure virtual machines to another Azure region for business continuity and disaster recovery needs.</span></span> <span data-ttu-id="6ca64-340">Вы можете проводить периодическое тестирование аварийного восстановления, чтобы обеспечить соответствие требованиям.</span><span class="sxs-lookup"><span data-stu-id="6ca64-340">You can conduct periodic DR drills to ensure you meet the compliance needs.</span></span> <span data-ttu-id="6ca64-341">Виртуальная машина будет реплицирована с указанными параметрами в выбранный регион, чтобы вы могли восстановить приложения в случае сбоев в исходном регионе.</span><span class="sxs-lookup"><span data-stu-id="6ca64-341">The VM will be replicated with the specified settings to the selected region so that you can recover your applications in the event of outages in the source region.</span></span> <span data-ttu-id="6ca64-342">См. дополнительные сведения о [репликации виртуальных машин Azure с помощью Azure Site Recovery][site-recovery].</span><span class="sxs-lookup"><span data-stu-id="6ca64-342">For more information, see [Replicate Azure VMs using ASR][site-recovery].</span></span> <span data-ttu-id="6ca64-343">При принятии решения обратите внимание на описанные здесь показатели RTO и RPO и убедитесь, что при тестировании время восстановления и точка восстановления соответствуют вашим требованиям.</span><span class="sxs-lookup"><span data-stu-id="6ca64-343">Consider the RTO and RPO numbers for your solution here and ensure that when testing, the recovery time and recovery point is appropriate for your needs.</span></span>

<span data-ttu-id="6ca64-344">**Парные регионы**</span><span class="sxs-lookup"><span data-stu-id="6ca64-344">**Paired regions**.</span></span> <span data-ttu-id="6ca64-345">Чтобы защитить приложение от регионального сбоя, можно развернуть его между несколькими регионами с помощью диспетчера трафика Azure для распределения интернет-трафика по разным регионам.</span><span class="sxs-lookup"><span data-stu-id="6ca64-345">To protect an application against a regional outage, you can deploy the application across multiple regions, using Azure Traffic Manager to distribute internet traffic to the different regions.</span></span> <span data-ttu-id="6ca64-346">Каждый регион Azure сопряжен с другим регионом.</span><span class="sxs-lookup"><span data-stu-id="6ca64-346">Each Azure region is paired with another region.</span></span> <span data-ttu-id="6ca64-347">Вместе они образуют [региональные пары](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="6ca64-347">Together, these form a [regional pair](/azure/best-practices-availability-paired-regions).</span></span> <span data-ttu-id="6ca64-348">За исключением южной Бразилии, региональные пары находятся в одной и той же географической области. Так соблюдаются требования к размещению данных, связанные с налогообложением и применением законодательства в пределах юрисдикции.</span><span class="sxs-lookup"><span data-stu-id="6ca64-348">With the exception of Brazil South, regional pairs are located within the same geography in order to meet data residency requirements for tax and law enforcement jurisdiction purposes.</span></span>

<span data-ttu-id="6ca64-349">При разработке приложения с поддержкой нескольких регионов следует учитывать, что задержка в сети для них превышает задержку в пределах одного региона.</span><span class="sxs-lookup"><span data-stu-id="6ca64-349">When you design a multi-region application, take into account that network latency across regions is higher than within a region.</span></span> <span data-ttu-id="6ca64-350">Например, если вы реплицируете базу данных для отработки отказа, используйте синхронную репликацию данных в пределах одного региона и асинхронную — в пределах нескольких.</span><span class="sxs-lookup"><span data-stu-id="6ca64-350">For example, if you are replicating a database to enable failover, use synchronous data replication within a region, but asynchronous data replication across regions.</span></span> 

| &nbsp; | <span data-ttu-id="6ca64-351">Группа доступности</span><span class="sxs-lookup"><span data-stu-id="6ca64-351">Availability Set</span></span> | <span data-ttu-id="6ca64-352">Зона доступности</span><span class="sxs-lookup"><span data-stu-id="6ca64-352">Availability Zone</span></span> | <span data-ttu-id="6ca64-353">Azure Site Recovery / Парный регион</span><span class="sxs-lookup"><span data-stu-id="6ca64-353">Azure Site Recovery/Paired region</span></span> |
|--------|------------------|-------------------|---------------|
| <span data-ttu-id="6ca64-354">Область сбоя</span><span class="sxs-lookup"><span data-stu-id="6ca64-354">Scope of failure</span></span> | <span data-ttu-id="6ca64-355">Стойка</span><span class="sxs-lookup"><span data-stu-id="6ca64-355">Rack</span></span> | <span data-ttu-id="6ca64-356">Центр обработки данных</span><span class="sxs-lookup"><span data-stu-id="6ca64-356">Datacenter</span></span> | <span data-ttu-id="6ca64-357">Регион</span><span class="sxs-lookup"><span data-stu-id="6ca64-357">Region</span></span> |
| <span data-ttu-id="6ca64-358">Маршрутизация запросов</span><span class="sxs-lookup"><span data-stu-id="6ca64-358">Request routing</span></span> | <span data-ttu-id="6ca64-359">Load Balancer</span><span class="sxs-lookup"><span data-stu-id="6ca64-359">Load Balancer</span></span> | <span data-ttu-id="6ca64-360">Распределение нагрузки между зонами</span><span class="sxs-lookup"><span data-stu-id="6ca64-360">Cross-zone Load Balancer</span></span> | <span data-ttu-id="6ca64-361">Диспетчер трафика</span><span class="sxs-lookup"><span data-stu-id="6ca64-361">Traffic Manager</span></span> |
| <span data-ttu-id="6ca64-362">Задержки сети</span><span class="sxs-lookup"><span data-stu-id="6ca64-362">Network latency</span></span> | <span data-ttu-id="6ca64-363">Очень низкий</span><span class="sxs-lookup"><span data-stu-id="6ca64-363">Very low</span></span> | <span data-ttu-id="6ca64-364">Низкий</span><span class="sxs-lookup"><span data-stu-id="6ca64-364">Low</span></span> | <span data-ttu-id="6ca64-365">От среднего до высокого</span><span class="sxs-lookup"><span data-stu-id="6ca64-365">Mid to high</span></span> |
| <span data-ttu-id="6ca64-366">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="6ca64-366">Virtual network</span></span>  | <span data-ttu-id="6ca64-367">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="6ca64-367">VNet</span></span> | <span data-ttu-id="6ca64-368">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="6ca64-368">VNet</span></span> | <span data-ttu-id="6ca64-369">Пиринговая связь между виртуальными сетями, размещенными в разных регионах</span><span class="sxs-lookup"><span data-stu-id="6ca64-369">Cross-region VNet peering</span></span> |

## <a name="implement-resiliency-strategies"></a><span data-ttu-id="6ca64-370">Реализация стратегий обеспечения отказоустойчивости</span><span class="sxs-lookup"><span data-stu-id="6ca64-370">Implement resiliency strategies</span></span>
<span data-ttu-id="6ca64-371">В этом разделе представлен обзор некоторых общих стратегий обеспечения отказоустойчивости.</span><span class="sxs-lookup"><span data-stu-id="6ca64-371">This section provides a survey of some common resiliency strategies.</span></span> <span data-ttu-id="6ca64-372">Большинство из них не ограничены определенной технологией.</span><span class="sxs-lookup"><span data-stu-id="6ca64-372">Most of these are not limited to a particular technology.</span></span> <span data-ttu-id="6ca64-373">Описания в этом разделе содержат общую идею каждой технологии и ссылки для дальнейшего чтения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-373">The descriptions in this section summarize the general idea behind each technique, with links to further reading.</span></span>

<span data-ttu-id="6ca64-374">**Повтор в случае временного сбоя**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-374">**Retry transient failures**.</span></span> <span data-ttu-id="6ca64-375">Временные сбои могут быть вызваны кратковременной потерей сетевого соединения, отсутствием подключения к базе данных или истечением времени ожидания, когда служба занята.</span><span class="sxs-lookup"><span data-stu-id="6ca64-375">Transient failures can be caused by momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="6ca64-376">Часто эту временную ошибку можно разрешить путем повторения запроса.</span><span class="sxs-lookup"><span data-stu-id="6ca64-376">Often, a transient failure can be resolved simply by retrying the request.</span></span> <span data-ttu-id="6ca64-377">Для многих служб Azure клиентский пакет SDK реализует автоматические повторы таким образом, который будет прозрачным для вызывающего объекта. Дополнительные сведения см. в статье [Конкретные рекомендации по использованию механизма повторов][retry-service-specific guidance].</span><span class="sxs-lookup"><span data-stu-id="6ca64-377">For many Azure services, the client SDK implements automatic retries, in a way that is transparent to the caller; see [Retry service specific guidance][retry-service-specific guidance].</span></span>

<span data-ttu-id="6ca64-378">Каждая попытка повторения увеличивает общую задержку.</span><span class="sxs-lookup"><span data-stu-id="6ca64-378">Each retry attempt adds to the total latency.</span></span> <span data-ttu-id="6ca64-379">Кроме того, слишком много неудавшихся запросов могут вызвать узкое место, так как ожидающие запросы накапливаются в очереди.</span><span class="sxs-lookup"><span data-stu-id="6ca64-379">Also, too many failed requests can cause a bottleneck, as pending requests accumulate in the queue.</span></span> <span data-ttu-id="6ca64-380">Эти заблокированные запросы могут содержать критические системные ресурсы, такие как память, потоки, подключения к базе данных и т. д., что может привести к каскадным сбоям.</span><span class="sxs-lookup"><span data-stu-id="6ca64-380">These blocked requests might hold critical system resources such as memory, threads, database connections, and so on, which can cause cascading failures.</span></span> <span data-ttu-id="6ca64-381">Чтобы избежать этого, увеличьте задержку между повторными попытками и ограничьте общее количество неудачных запросов.</span><span class="sxs-lookup"><span data-stu-id="6ca64-381">To avoid this, increase the delay between each retry attempt, and limit the total number of failed requests.</span></span>

![](./images/retry.png)

<span data-ttu-id="6ca64-382">**Балансировка нагрузки между несколькими экземплярами**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-382">**Load balance across instances**.</span></span> <span data-ttu-id="6ca64-383">Для масштабируемости облачное приложение должно иметь возможность горизонтального масштабирования путем добавления экземпляров.</span><span class="sxs-lookup"><span data-stu-id="6ca64-383">For scalability, a cloud application should be able to scale out by adding more instances.</span></span> <span data-ttu-id="6ca64-384">Такой подход также повышает отказоустойчивость, так как неработоспособные экземпляры могут быть удалены из ротации.</span><span class="sxs-lookup"><span data-stu-id="6ca64-384">This approach also improves resiliency, because unhealthy instances can be removed from rotation.</span></span> <span data-ttu-id="6ca64-385">Например: </span><span class="sxs-lookup"><span data-stu-id="6ca64-385">For example:</span></span>

* <span data-ttu-id="6ca64-386">Поместите две или несколько виртуальных машин в подсистему балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="6ca64-386">Put two or more VMs behind a load balancer.</span></span> <span data-ttu-id="6ca64-387">Подсистема балансировки нагрузки распределяет трафик между всеми виртуальными машинами.</span><span class="sxs-lookup"><span data-stu-id="6ca64-387">The load balancer distributes traffic to all the VMs.</span></span> <span data-ttu-id="6ca64-388">Дополнительные сведения см. в статье [Run load-balanced VMs for scalability and availability][ra-multi-vm] (Запуск виртуальных машин с распределенной нагрузкой для масштабируемости и доступности).</span><span class="sxs-lookup"><span data-stu-id="6ca64-388">See [Run load-balanced VMs for scalability and availability][ra-multi-vm].</span></span>
* <span data-ttu-id="6ca64-389">Выполните горизонтальное масштабирование приложения службы приложений Azure до нескольких экземпляров.</span><span class="sxs-lookup"><span data-stu-id="6ca64-389">Scale out an Azure App Service app to multiple instances.</span></span> <span data-ttu-id="6ca64-390">Служба приложений автоматически распределяет нагрузку между экземплярами.</span><span class="sxs-lookup"><span data-stu-id="6ca64-390">App Service automatically balances load across instances.</span></span> <span data-ttu-id="6ca64-391">См. статью [Basic web application][ra-basic-web] (Базовое веб-приложение).</span><span class="sxs-lookup"><span data-stu-id="6ca64-391">See [Basic web application][ra-basic-web].</span></span>
* <span data-ttu-id="6ca64-392">Используйте [диспетчер трафика Azure][tm] для распределения трафика между несколькими конечными точками.</span><span class="sxs-lookup"><span data-stu-id="6ca64-392">Use [Azure Traffic Manager][tm] to distribute traffic across a set of endpoints.</span></span>

<span data-ttu-id="6ca64-393">**Репликация данных**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-393">**Replicate data**.</span></span> <span data-ttu-id="6ca64-394">Репликация данных является общей стратегией для обработки постоянных ошибок в хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-394">Replicating data is a general strategy for handling non-transient failures in a data store.</span></span> <span data-ttu-id="6ca64-395">Многие технологии хранения, в том числе служба хранилища Azure, База данных SQL Azure, Cosmos DB и Apache Cassandra, предусматривают встроенную репликацию.</span><span class="sxs-lookup"><span data-stu-id="6ca64-395">Many storage technologies provide built-in replication, including Azure Storage, Azure SQL Database, Cosmos DB, and Apache Cassandra.</span></span> <span data-ttu-id="6ca64-396">Важно учитывать как пути чтения, так и пути записи.</span><span class="sxs-lookup"><span data-stu-id="6ca64-396">It's important to consider both the read and write paths.</span></span> <span data-ttu-id="6ca64-397">В зависимости от технологии хранения у вас может быть несколько записываемых реплик или одна копия, доступная для записи, и несколько копий только для чтения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-397">Depending on the storage technology, you might have multiple writable replicas, or a single writable replica and multiple read-only replicas.</span></span>

<span data-ttu-id="6ca64-398">Чтобы добиться максимальной доступности, реплики можно разместить в разных регионах.</span><span class="sxs-lookup"><span data-stu-id="6ca64-398">To maximize availability, replicas can be placed in multiple regions.</span></span> <span data-ttu-id="6ca64-399">Тем не менее это приводит к увеличению задержки при репликации данных.</span><span class="sxs-lookup"><span data-stu-id="6ca64-399">However, this increases the latency when replicating the data.</span></span> <span data-ttu-id="6ca64-400">Как правило, репликация между регионами выполняется асинхронно, что подразумевает модель итоговой согласованности и возможную потерю данных в случае сбоя реплики.</span><span class="sxs-lookup"><span data-stu-id="6ca64-400">Typically, replicating across regions is done asynchronously, which implies an eventual consistency model and potential data loss if a replica fails.</span></span>

<span data-ttu-id="6ca64-401">Вы можете использовать службу [Azure Site Recovery][site-recovery] для репликации виртуальных машин Azure из одного региона в другой.</span><span class="sxs-lookup"><span data-stu-id="6ca64-401">You can use [Azure Site Recovery][site-recovery] to replicate Azure virtual machines from one region to another region.</span></span> <span data-ttu-id="6ca64-402">Site Recovery непрерывно реплицирует данные в целевой регион.</span><span class="sxs-lookup"><span data-stu-id="6ca64-402">Site Recovery replicates data continuously to the target region.</span></span> <span data-ttu-id="6ca64-403">Если на вашем основном сайте произошел сбой, вы можете выполнить отработку отказа в дополнительное расположение.</span><span class="sxs-lookup"><span data-stu-id="6ca64-403">When an outage occurs at your primary site, you fail over to secondary location</span></span>

<span data-ttu-id="6ca64-404">**Корректно снижайте производительность**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-404">**Degrade gracefully**.</span></span> <span data-ttu-id="6ca64-405">Если служба терпит сбой и нет пути отработки отказа, приложение может корректно снижать производительность, сохраняя при этом приемлемое взаимодействие с пользователем.</span><span class="sxs-lookup"><span data-stu-id="6ca64-405">If a service fails and there is no failover path, the application may be able to degrade gracefully while still providing an acceptable user experience.</span></span> <span data-ttu-id="6ca64-406">Например: </span><span class="sxs-lookup"><span data-stu-id="6ca64-406">For example:</span></span>

* <span data-ttu-id="6ca64-407">Рабочий элемент помещается в очередь для обработки позже.</span><span class="sxs-lookup"><span data-stu-id="6ca64-407">Put a work item on a queue, to be handled later.</span></span>
* <span data-ttu-id="6ca64-408">Возвращается оцениваемое значение.</span><span class="sxs-lookup"><span data-stu-id="6ca64-408">Return an estimated value.</span></span>
* <span data-ttu-id="6ca64-409">Используются данные из локального кэша.</span><span class="sxs-lookup"><span data-stu-id="6ca64-409">Use locally cached data.</span></span>
* <span data-ttu-id="6ca64-410">Пользователю отображается сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="6ca64-410">Show the user an error message.</span></span> <span data-ttu-id="6ca64-411">(Этот вариант лучше, чем если приложение перестает отвечать на запросы.)</span><span class="sxs-lookup"><span data-stu-id="6ca64-411">(This option is better than having the application stop responding to requests.)</span></span>

<span data-ttu-id="6ca64-412">**Регулирование пользователей, создающих большую нагрузку**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-412">**Throttle high-volume users**.</span></span> <span data-ttu-id="6ca64-413">Иногда небольшое количество пользователей создает чрезмерную нагрузку.</span><span class="sxs-lookup"><span data-stu-id="6ca64-413">Sometimes a small number of users create excessive load.</span></span> <span data-ttu-id="6ca64-414">Это может повлиять на других пользователей, что снижает общую доступность вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-414">That can have an impact on other users, reducing the overall availability of your application.</span></span>

<span data-ttu-id="6ca64-415">Когда один клиент делает чрезмерное количество запросов, приложение может регулировать клиент в течение определенного периода времени.</span><span class="sxs-lookup"><span data-stu-id="6ca64-415">When a single client makes an excessive number of requests, the application might throttle the client for a certain period of time.</span></span> <span data-ttu-id="6ca64-416">В период регулирования приложение отклоняет некоторые или все запросы от клиента (в зависимости от конкретной стратегии регулирования).</span><span class="sxs-lookup"><span data-stu-id="6ca64-416">During the throttling period, the application refuses some or all of the requests from that client (depending on the exact throttling strategy).</span></span> <span data-ttu-id="6ca64-417">Пороговое значение регулирования может зависеть от уровня обслуживания клиента.</span><span class="sxs-lookup"><span data-stu-id="6ca64-417">The threshold for throttling might depend on the customer's service tier.</span></span>

<span data-ttu-id="6ca64-418">Регулирование не означает, что клиент действовал злонамеренно, а только то, что он превысил свою квоту службы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-418">Throttling does not imply the client was necessarily acting maliciously, only that it exceeded its service quota.</span></span> <span data-ttu-id="6ca64-419">В некоторых случаях потребитель может последовательно превышать свою квоту. В противном случае его поведение ухудшается.</span><span class="sxs-lookup"><span data-stu-id="6ca64-419">In some cases, a consumer might consistently exceed their quota or otherwise behave badly.</span></span> <span data-ttu-id="6ca64-420">В этом случае вы можете пойти дальше и заблокировать пользователя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-420">In that case, you might go further and block the user.</span></span> <span data-ttu-id="6ca64-421">Как правило, для этого блокируется API-ключ или диапазон IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="6ca64-421">Typically, this is done by blocking an API key or an IP address range.</span></span> <span data-ttu-id="6ca64-422">Дополнительные сведения см. в статье [Throttling Pattern][throttling-pattern] (Шаблон регулирования).</span><span class="sxs-lookup"><span data-stu-id="6ca64-422">For more information, see [Throttling Pattern][throttling-pattern].</span></span>

<span data-ttu-id="6ca64-423">**Использование прерывателя**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-423">**Use a circuit breaker**.</span></span> <span data-ttu-id="6ca64-424">С помощью шаблона [прерывателя][circuit-breaker-pattern] в приложении можно предотвратить повторное выполнение операции, которая, вероятнее всего, завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="6ca64-424">The [Circuit Breaker][circuit-breaker-pattern] pattern can prevent an application from repeatedly trying an operation that is likely to fail.</span></span> <span data-ttu-id="6ca64-425">Прерыватель завершает вызовы службы и отслеживает количество последних сбоев.</span><span class="sxs-lookup"><span data-stu-id="6ca64-425">The circuit breaker wraps calls to a service and tracks the number of recent failures.</span></span> <span data-ttu-id="6ca64-426">Если число сбоев превышает пороговое значение, прерыватель начинает возвращать код ошибки, не вызывая службу.</span><span class="sxs-lookup"><span data-stu-id="6ca64-426">If the failure count exceeds a threshold, the circuit breaker starts returning an error code without calling the service.</span></span> <span data-ttu-id="6ca64-427">Это дает службе время на восстановление.</span><span class="sxs-lookup"><span data-stu-id="6ca64-427">This gives the service time to recover.</span></span>

<span data-ttu-id="6ca64-428">**Использование выравнивания нагрузки для сглаживания пиков трафика**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-428">**Use load leveling to smooth out spikes in traffic**.</span></span>
<span data-ttu-id="6ca64-429">Приложения могут испытывать внезапные всплески трафика, что может привести к чрезмерной нагрузке служб на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="6ca64-429">Applications may experience sudden spikes in traffic, which can overwhelm services on the backend.</span></span> <span data-ttu-id="6ca64-430">Если серверная служба не может достаточно быстро реагировать на запросы, это может привести к постановке запросов в очередь (архивация) или к регулированию приложения службой.</span><span class="sxs-lookup"><span data-stu-id="6ca64-430">If a backend service cannot respond to requests quickly enough, it may cause requests to queue (back up), or cause the service to throttle the application.</span></span> <span data-ttu-id="6ca64-431">Чтобы избежать этого, можно использовать очередь как буфер.</span><span class="sxs-lookup"><span data-stu-id="6ca64-431">To avoid this, you can use a queue as a buffer.</span></span> <span data-ttu-id="6ca64-432">Когда есть новый рабочий элемент, вместо того, чтобы немедленно вызывать серверную службу, приложение ставит в очередь рабочий элемент для асинхронного запуска.</span><span class="sxs-lookup"><span data-stu-id="6ca64-432">When there is a new work item, instead of calling the backend service immediately, the application queues a work item to run asynchronously.</span></span> <span data-ttu-id="6ca64-433">Очередь работает как буфер, который сглаживает высокие пики нагрузки.</span><span class="sxs-lookup"><span data-stu-id="6ca64-433">The queue acts as a buffer that smooths out peaks in the load.</span></span> <span data-ttu-id="6ca64-434">Дополнительные сведения см. в статье [Шаблон балансировки нагрузки на основе очередей][load-leveling-pattern].</span><span class="sxs-lookup"><span data-stu-id="6ca64-434">For more information, see [Queue-Based Load Leveling Pattern][load-leveling-pattern].</span></span>

<span data-ttu-id="6ca64-435">**Изоляция критических ресурсов**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-435">**Isolate critical resources**.</span></span> <span data-ttu-id="6ca64-436">Сбои в одной подсистеме могут иногда иметь каскадный эффект, вызывая сбои в других частях приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-436">Failures in one subsystem can sometimes cascade, causing failures in other parts of the application.</span></span> <span data-ttu-id="6ca64-437">Это может произойти, если отказ приводит к тому, что некоторые ресурсы, такие как потоки или сокеты, не освобождаются своевременно, что приводит к исчерпанию ресурсов.</span><span class="sxs-lookup"><span data-stu-id="6ca64-437">This can happen if a failure causes some resources, such as threads or sockets, not to get freed in a timely manner, leading to resource exhaustion.</span></span>

<span data-ttu-id="6ca64-438">Чтобы избежать этого, вы можете разделить систему на изолированные группы, чтобы сбой в одном разделе не разрушал всю систему.</span><span class="sxs-lookup"><span data-stu-id="6ca64-438">To avoid this, you can partition a system into isolated groups, so that a failure in one partition does not bring down the entire system.</span></span> <span data-ttu-id="6ca64-439">Такой подход иногда называют шаблоном распределительного блока.</span><span class="sxs-lookup"><span data-stu-id="6ca64-439">This technique is sometimes called the Bulkhead pattern.</span></span>

<span data-ttu-id="6ca64-440">Примеры:</span><span class="sxs-lookup"><span data-stu-id="6ca64-440">Examples:</span></span>

* <span data-ttu-id="6ca64-441">Разделите базу данных (например, по клиентам) и назначьте отдельный пул экземпляров веб-сервера для каждого раздела.</span><span class="sxs-lookup"><span data-stu-id="6ca64-441">Partition a database (for example, by tenant) and assign a separate pool of web server instances for each partition.</span></span>  
* <span data-ttu-id="6ca64-442">Используйте отдельные пулы потоков для изоляции вызовов для разных служб.</span><span class="sxs-lookup"><span data-stu-id="6ca64-442">Use separate thread pools to isolate calls to different services.</span></span> <span data-ttu-id="6ca64-443">Это помогает предотвратить каскадные сбои, если одна из служб завершила работу с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="6ca64-443">This helps to prevent cascading failures if one of the services fails.</span></span> <span data-ttu-id="6ca64-444">Пример см. в статье Netflix о [библиотеке Hystrix][hystrix].</span><span class="sxs-lookup"><span data-stu-id="6ca64-444">For an example, see the Netflix [Hystrix library][hystrix].</span></span>
* <span data-ttu-id="6ca64-445">Используйте [контейнеры][containers] для ограничения ресурсов, доступных для конкретной подсистемы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-445">Use [containers][containers] to limit the resources available to a particular subsystem.</span></span>

![](./images/bulkhead.png)

<span data-ttu-id="6ca64-446">**Применение компенсирующих транзакций**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-446">**Apply compensating transactions**.</span></span> <span data-ttu-id="6ca64-447">[Компенсирующая транзакция][compensating-transaction-pattern] — это транзакция, которая отменяет эффект другой завершенной транзакции.</span><span class="sxs-lookup"><span data-stu-id="6ca64-447">A [compensating transaction][compensating-transaction-pattern] is a transaction that undoes the effects of another completed transaction.</span></span> <span data-ttu-id="6ca64-448">В распределенной системе может быть сложно добиться сильной согласованности транзакций.</span><span class="sxs-lookup"><span data-stu-id="6ca64-448">In a distributed system, it can be very difficult to achieve strong transactional consistency.</span></span> <span data-ttu-id="6ca64-449">Компенсирующие транзакции — это способ достижения согласованности, используя ряд небольших отдельных транзакций, которые можно отменить на каждом шаге.</span><span class="sxs-lookup"><span data-stu-id="6ca64-449">Compensating transactions are a way to achieve consistency by using a series of smaller, individual transactions that can be undone at each step.</span></span>

<span data-ttu-id="6ca64-450">Например, чтобы забронировать поездку, клиент может зарезервировать автомобиль, гостиничный номер и билет на самолет.</span><span class="sxs-lookup"><span data-stu-id="6ca64-450">For example, to book a trip, a customer might reserve a car, a hotel room, and a flight.</span></span> <span data-ttu-id="6ca64-451">В случае сбоя любого из этих шагов происходит сбой всей операции.</span><span class="sxs-lookup"><span data-stu-id="6ca64-451">If any of these steps fails, the entire operation fails.</span></span> <span data-ttu-id="6ca64-452">Вместо того чтобы использовать одну распределенную транзакцию для всей операции, вы можете определить компенсирующую транзакцию для каждого шага.</span><span class="sxs-lookup"><span data-stu-id="6ca64-452">Instead of trying to use a single distributed transaction for the entire operation, you can define a compensating transaction for each step.</span></span> <span data-ttu-id="6ca64-453">Например, чтобы отменить резервирование автомобиля, отмените резервирование.</span><span class="sxs-lookup"><span data-stu-id="6ca64-453">For example, to undo a car reservation, you cancel the reservation.</span></span> <span data-ttu-id="6ca64-454">Чтобы завершить выполнение всей операции, координатор выполняет каждый шаг.</span><span class="sxs-lookup"><span data-stu-id="6ca64-454">In order to complete the whole operation, a coordinator executes each step.</span></span> <span data-ttu-id="6ca64-455">Если какой-либо шаг завершается ошибкой, координатор применяет компенсирующие транзакции, чтобы отменить все действия, которые были выполнены.</span><span class="sxs-lookup"><span data-stu-id="6ca64-455">If any step fails, the coordinator applies compensating transactions to undo any steps that were completed.</span></span>

## <a name="test-for-resiliency"></a><span data-ttu-id="6ca64-456">Тестирование отказоустойчивости</span><span class="sxs-lookup"><span data-stu-id="6ca64-456">Test for resiliency</span></span>
<span data-ttu-id="6ca64-457">Как правило, вы не можете тестировать отказоустойчивость так же, как вы тестируете функциональность приложения (путем запуска модульных тестов и т. д.).</span><span class="sxs-lookup"><span data-stu-id="6ca64-457">Generally, you can't test resiliency in the same way that you test application functionality (by running unit tests and so on).</span></span> <span data-ttu-id="6ca64-458">Вместо этого вы должны проверить, как сквозная рабочая нагрузка выполняется в условиях сбоя, которые происходят только периодически.</span><span class="sxs-lookup"><span data-stu-id="6ca64-458">Instead, you must test how the end-to-end workload performs under failure conditions which only occur intermittently.</span></span>

<span data-ttu-id="6ca64-459">Тестирование — это итеративный процесс.</span><span class="sxs-lookup"><span data-stu-id="6ca64-459">Testing is an iterative process.</span></span> <span data-ttu-id="6ca64-460">Протестируйте приложение, измерьте результат, проанализируйте и устраните все возникающие сбои и повторите процесс.</span><span class="sxs-lookup"><span data-stu-id="6ca64-460">Test the application, measure the outcome, analyze and address any failures that result, and repeat the process.</span></span>

<span data-ttu-id="6ca64-461">**Тестирование путем внедрения ошибки**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-461">**Fault injection testing**.</span></span> <span data-ttu-id="6ca64-462">Проверьте отказоустойчивость системы во время сбоев либо путем инициирования фактических сбоев, либо путем их имитации.</span><span class="sxs-lookup"><span data-stu-id="6ca64-462">Test the resiliency of the system during failures, either by triggering actual failures or by simulating them.</span></span> <span data-ttu-id="6ca64-463">Ниже приведены некоторые распространенные сценарии сбоев для тестирования.</span><span class="sxs-lookup"><span data-stu-id="6ca64-463">Here are some common failure scenarios to test:</span></span>

* <span data-ttu-id="6ca64-464">Завершите работу экземпляров виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="6ca64-464">Shut down VM instances.</span></span>
* <span data-ttu-id="6ca64-465">Прекратите работу процессов.</span><span class="sxs-lookup"><span data-stu-id="6ca64-465">Crash processes.</span></span>
* <span data-ttu-id="6ca64-466">Завершите срок действия сертификатов.</span><span class="sxs-lookup"><span data-stu-id="6ca64-466">Expire certificates.</span></span>
* <span data-ttu-id="6ca64-467">Измените ключи доступа.</span><span class="sxs-lookup"><span data-stu-id="6ca64-467">Change access keys.</span></span>
* <span data-ttu-id="6ca64-468">Завершите работу службы DNS на контроллерах домена.</span><span class="sxs-lookup"><span data-stu-id="6ca64-468">Shut down the DNS service on domain controllers.</span></span>
* <span data-ttu-id="6ca64-469">Ограничьте доступные системные ресурсы, такие как ОЗУ или количество потоков.</span><span class="sxs-lookup"><span data-stu-id="6ca64-469">Limit available system resources, such as RAM or number of threads.</span></span>
* <span data-ttu-id="6ca64-470">Отключите диски.</span><span class="sxs-lookup"><span data-stu-id="6ca64-470">Unmount disks.</span></span>
* <span data-ttu-id="6ca64-471">Повторно разверните виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="6ca64-471">Redeploy a VM.</span></span>

<span data-ttu-id="6ca64-472">Измерьте время восстановления и убедитесь, что ваши бизнес-требования выполнены.</span><span class="sxs-lookup"><span data-stu-id="6ca64-472">Measure the recovery times and verify that your business requirements are met.</span></span> <span data-ttu-id="6ca64-473">Следует также протестировать комбинации режимов отказа.</span><span class="sxs-lookup"><span data-stu-id="6ca64-473">Test combinations of failure modes as well.</span></span> <span data-ttu-id="6ca64-474">Убедитесь, что отказы не каскадируются и обрабатываются изолированно.</span><span class="sxs-lookup"><span data-stu-id="6ca64-474">Make sure that failures don't cascade, and are handled in an isolated way.</span></span>

<span data-ttu-id="6ca64-475">Это еще одна причина, по которой важно проанализировать возможные точки отказа на этапе разработки.</span><span class="sxs-lookup"><span data-stu-id="6ca64-475">This is another reason why it's important to analyze possible failure points during the design phase.</span></span> <span data-ttu-id="6ca64-476">Результаты этого анализа должны быть входными данными для плана тестирования.</span><span class="sxs-lookup"><span data-stu-id="6ca64-476">The results of that analysis should be inputs into your test plan.</span></span>

<span data-ttu-id="6ca64-477">**Нагрузочное тестирование**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-477">**Load testing**.</span></span> <span data-ttu-id="6ca64-478">Нагрузочное тестирование имеет решающее значение для обнаружения сбоев, которые происходят только под нагрузкой, таких как перегрузка серверной базы данных или регулирование службы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-478">Load testing is crucial for identifying failures that only happen under load, such as the backend database being overwhelmed or service throttling.</span></span> <span data-ttu-id="6ca64-479">Протестируйте на максимальную нагрузку, используя рабочие данные или искусственные данные, максимально приближенные к рабочим данным.</span><span class="sxs-lookup"><span data-stu-id="6ca64-479">Test for peak load, using production data or synthetic data that is as close to production data as possible.</span></span> <span data-ttu-id="6ca64-480">Цель — увидеть, как ведет себя приложение в реальных условиях.</span><span class="sxs-lookup"><span data-stu-id="6ca64-480">The goal is to see how the application behaves under real-world conditions.</span></span>   

<span data-ttu-id="6ca64-481">**Отработка аварийного восстановления**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-481">**Disaster recovery drills**.</span></span> <span data-ttu-id="6ca64-482">Наличия хорошего плана аварийного восстановления недостаточно.</span><span class="sxs-lookup"><span data-stu-id="6ca64-482">It is not enough if you have a good disaster recovery plan in place.</span></span> <span data-ttu-id="6ca64-483">Необходимо время от времени проводить тестирования, чтобы быть уверенным в том, что этот план восстановления сработает, когда будет нужно.</span><span class="sxs-lookup"><span data-stu-id="6ca64-483">You need to test it periodically to ensure your recovery plan works fine when it matters.</span></span> <span data-ttu-id="6ca64-484">Для репликации виртуальных машин Azure и [отработки их аварийного восстановления][site-recovery-test-failover] можно использовать [Azure Site Recovery][site-recovery]: эта служба не оказывает влияния на рабочие приложения или текущую репликацию.</span><span class="sxs-lookup"><span data-stu-id="6ca64-484">For Azure virtual machines, you can use [Azure Site Recovery][site-recovery] to replicate and [perform DR drills][site-recovery-test-failover] without impacting production applications or ongoing replication.</span></span>

## <a name="deploy-using-reliable-processes"></a><span data-ttu-id="6ca64-485">Развертывание с помощью надежных процессов</span><span class="sxs-lookup"><span data-stu-id="6ca64-485">Deploy using reliable processes</span></span>
<span data-ttu-id="6ca64-486">После развертывания приложения в рабочей среде обновления выступают возможными источниками ошибок.</span><span class="sxs-lookup"><span data-stu-id="6ca64-486">Once an application is deployed to production, updates are a possible source of errors.</span></span> <span data-ttu-id="6ca64-487">В худшем случае неправильное обновление может привести к простою.</span><span class="sxs-lookup"><span data-stu-id="6ca64-487">In the worst case, a bad update can cause downtime.</span></span> <span data-ttu-id="6ca64-488">Чтобы избежать этого, процесс развертывания должен быть предсказуемым и повторяемым.</span><span class="sxs-lookup"><span data-stu-id="6ca64-488">To avoid this, the deployment process must be predictable and repeatable.</span></span> <span data-ttu-id="6ca64-489">Развертывание включает в себя подготовку ресурсов Azure, развертывание кода приложения и применение параметров конфигурации.</span><span class="sxs-lookup"><span data-stu-id="6ca64-489">Deployment includes provisioning Azure resources, deploying application code, and applying configuration settings.</span></span> <span data-ttu-id="6ca64-490">Обновление может включать все три этапа или подмножество.</span><span class="sxs-lookup"><span data-stu-id="6ca64-490">An update may involve all three, or a subset.</span></span>

<span data-ttu-id="6ca64-491">Ключевым моментом является то, что развертывания вручную подвержены ошибкам.</span><span class="sxs-lookup"><span data-stu-id="6ca64-491">The crucial point is that manual deployments are prone to error.</span></span> <span data-ttu-id="6ca64-492">Поэтому рекомендуется иметь автоматический, идемпотентный процесс, который вы можете выполнять по требованию и повторно запускать в случае сбоя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-492">Therefore, it's recommended to have an automated, idempotent process that you can run on demand, and re-run if something fails.</span></span>

* <span data-ttu-id="6ca64-493">Используйте шаблоны Azure Resource Manager для автоматизации подготовки ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="6ca64-493">Use Azure Resource Manager templates to automate provisioning of Azure resources.</span></span>
* <span data-ttu-id="6ca64-494">Используйте [настройку требуемого состояния службы автоматизации Azure][dsc] (DSC) для настройки виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="6ca64-494">Use [Azure Automation Desired State Configuration][dsc] (DSC) to configure VMs.</span></span>
* <span data-ttu-id="6ca64-495">Используйте автоматизированный процесс развертывания для кода приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-495">Use an automated deployment process for application code.</span></span>

<span data-ttu-id="6ca64-496">Две концепции, связанные с отказоустойчивым развертыванием, — это *инфраструктура как код* и *неизменяемая инфраструктура*.</span><span class="sxs-lookup"><span data-stu-id="6ca64-496">Two concepts related to resilient deployment are *infrastructure as code* and *immutable infrastructure*.</span></span>

* <span data-ttu-id="6ca64-497">**Инфраструктура как код** — это способ использования кода для подготовки и настройки инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="6ca64-497">**Infrastructure as code** is the practice of using code to provision and configure infrastructure.</span></span> <span data-ttu-id="6ca64-498">Инфраструктура как код может использовать декларативный или императивный подход (или их сочетание).</span><span class="sxs-lookup"><span data-stu-id="6ca64-498">Infrastructure as code may use a declarative approach or an imperative approach (or a combination of both).</span></span> <span data-ttu-id="6ca64-499">Шаблоны Resource Manager являются примером декларативного подхода.</span><span class="sxs-lookup"><span data-stu-id="6ca64-499">Resource Manager templates are an example of a declarative approach.</span></span> <span data-ttu-id="6ca64-500">Скрипты PowerShell являются примером императивного подхода.</span><span class="sxs-lookup"><span data-stu-id="6ca64-500">PowerShell scripts are an example of an imperative approach.</span></span>
* <span data-ttu-id="6ca64-501">**Неизменяемая инфраструктура** — это принцип, согласно которому вы не должны изменять инфраструктуру после ее развертывания в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="6ca64-501">**Immutable infrastructure** is the principle that you shouldn’t modify infrastructure after it’s deployed to production.</span></span> <span data-ttu-id="6ca64-502">В противном случае в системе можно достичь состояния, когда были применены специальные изменения, поэтому трудно точно узнать, что изменилось, и сложно рассуждать о системе.</span><span class="sxs-lookup"><span data-stu-id="6ca64-502">Otherwise, you can get into a state where ad hoc changes have been applied, so it's hard to know exactly what changed, and hard to reason about the system.</span></span>

<span data-ttu-id="6ca64-503">Другой вопрос заключается в том, как развернуть обновление приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-503">Another question is how to roll out an application update.</span></span> <span data-ttu-id="6ca64-504">Мы рекомендуем такие методики, как "сине-зеленое" развертывание или ранние выпуски, которые отправляют обновления контролируемым образом, чтобы минимизировать возможные последствия некорректного развертывания.</span><span class="sxs-lookup"><span data-stu-id="6ca64-504">We recommend techniques such as blue-green deployment or canary releases, which push updates in highly controlled way to minimize possible impacts from a bad deployment.</span></span>

* <span data-ttu-id="6ca64-505">["Сине-зеленое"развертывание][blue-green] — это способ развертывания обновления в рабочей среде отдельно от работающего приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-505">[Blue-green deployment][blue-green] is a technique where an update is deployed into a production environment separate from the live application.</span></span> <span data-ttu-id="6ca64-506">После проверки развертывания переключите маршрутизацию трафика на обновленную версию.</span><span class="sxs-lookup"><span data-stu-id="6ca64-506">After you validate the deployment, switch the traffic routing to the updated version.</span></span> <span data-ttu-id="6ca64-507">Например, веб-приложения службы приложения Azure позволяют сделать это с помощью промежуточных слотов.</span><span class="sxs-lookup"><span data-stu-id="6ca64-507">For example, Azure App Service Web Apps enables this with staging slots.</span></span>
* <span data-ttu-id="6ca64-508">[Ранние выпуски][canary-release] аналогичны "сине-зеленым" развертываниям.</span><span class="sxs-lookup"><span data-stu-id="6ca64-508">[Canary releases][canary-release] are similar to blue-green deployments.</span></span> <span data-ttu-id="6ca64-509">Вместо того, чтобы переключать весь трафик на обновленную версию, вы развертываете обновление для небольшого процента пользователей, направляя часть трафика в новое развертывание.</span><span class="sxs-lookup"><span data-stu-id="6ca64-509">Instead of switching all traffic to the updated version, you roll out the update to a small percentage of users, by routing a portion of the traffic to the new deployment.</span></span> <span data-ttu-id="6ca64-510">Если есть проблема, отмените обновления и вернитесь к старому развертыванию.</span><span class="sxs-lookup"><span data-stu-id="6ca64-510">If there is a problem, back off and revert to the old deployment.</span></span> <span data-ttu-id="6ca64-511">В противном случае перенаправляйте большую часть трафика на новую версию, пока она не получит 100 % трафика.</span><span class="sxs-lookup"><span data-stu-id="6ca64-511">Otherwise, route more of the traffic to the new version, until it gets 100% of the traffic.</span></span>

<span data-ttu-id="6ca64-512">Независимо от того, какой подход вы выберете, убедитесь, что можете вернуться к последнему известному корректному развертыванию на случай, если новая версия не работает.</span><span class="sxs-lookup"><span data-stu-id="6ca64-512">Whatever approach you take, make sure that you can roll back to the last-known-good deployment, in case the new version is not functioning.</span></span> <span data-ttu-id="6ca64-513">Кроме того, если возникают ошибки, журналы приложений должны указывать, какая версия вызвала ошибку.</span><span class="sxs-lookup"><span data-stu-id="6ca64-513">Also, if errors occur, the application logs must indicate which version caused the error.</span></span>

## <a name="monitor-to-detect-failures"></a><span data-ttu-id="6ca64-514">Мониторинг сбоев</span><span class="sxs-lookup"><span data-stu-id="6ca64-514">Monitor to detect failures</span></span>
<span data-ttu-id="6ca64-515">Мониторинг и диагностика важны для обеспечения устойчивости.</span><span class="sxs-lookup"><span data-stu-id="6ca64-515">Monitoring and diagnostics are crucial for resiliency.</span></span> <span data-ttu-id="6ca64-516">Если происходит какой-либо сбой, вам нужно об этом знать и понять его причину.</span><span class="sxs-lookup"><span data-stu-id="6ca64-516">If something fails, you need to know that it failed, and you need insights into the cause of the failure.</span></span>

<span data-ttu-id="6ca64-517">Мониторинг крупномасштабной распределенной системы представляет собой нетривиальную задачу,</span><span class="sxs-lookup"><span data-stu-id="6ca64-517">Monitoring a large-scale distributed system poses a significant challenge.</span></span> <span data-ttu-id="6ca64-518">Представим приложение, которое работает на нескольких десятках виртуальных машин. Невозможно войти в каждую виртуальную машину по одной за раз, и просмотреть файлы журналов, пытаясь устранить проблему.</span><span class="sxs-lookup"><span data-stu-id="6ca64-518">Think about an application that runs on a few dozen VMs &mdash; it's not practical to log into each VM, one at a time, and look through log files, trying to troubleshoot a problem.</span></span> <span data-ttu-id="6ca64-519">Кроме того, количество экземпляров виртуальных машин, скорее всего, не является статическим.</span><span class="sxs-lookup"><span data-stu-id="6ca64-519">Moreover, the number of VM instances is probably not static.</span></span> <span data-ttu-id="6ca64-520">Виртуальные машины добавляются и удаляются по мере того, как приложение масштабируется горизонтально и вертикально, и иногда может произойти сбой экземпляра, который необходимо повторно подготовить.</span><span class="sxs-lookup"><span data-stu-id="6ca64-520">VMs get added and removed as the application scales in and out, and occasionally an instance may fail and need to be reprovisioned.</span></span> <span data-ttu-id="6ca64-521">Кроме того, типичное облачное приложение может использовать несколько хранилищ данных (хранилище Azure, база данных SQL, Cosmos DB, кэш Redis), а одно действие пользователя может охватывать несколько подсистем.</span><span class="sxs-lookup"><span data-stu-id="6ca64-521">In addition, a typical cloud application might use multiple data stores (Azure storage, SQL Database, Cosmos DB, Redis cache), and a single user action may span multiple subsystems.</span></span>

<span data-ttu-id="6ca64-522">Процесс наблюдения и диагностики можно считать конвейером с несколькими отдельными этапами:</span><span class="sxs-lookup"><span data-stu-id="6ca64-522">You can think of the monitoring and diagnostics process as a pipeline with several distinct stages:</span></span>

![Составное соглашение об уровне обслуживания](./images/monitoring.png)

* <span data-ttu-id="6ca64-524">**Инструментирование**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-524">**Instrumentation**.</span></span> <span data-ttu-id="6ca64-525">Необработанные данные для мониторинга и диагностики поступают из различных источников, включая журналы приложений, журналы веб-сервера, счетчики производительности ОС, журналы базы данных и диагностику, встроенную в платформу Azure.</span><span class="sxs-lookup"><span data-stu-id="6ca64-525">The raw data for monitoring and diagnostics comes from a variety of sources, including application logs, web server logs, OS performance counters, database logs, and diagnostics built into the Azure platform.</span></span> <span data-ttu-id="6ca64-526">Большинство служб Azure имеют функцию диагностики, которую вы можете использовать для определения причины проблем.</span><span class="sxs-lookup"><span data-stu-id="6ca64-526">Most Azure services have a diagnostics feature that you can use to determine the cause of problems.</span></span>
* <span data-ttu-id="6ca64-527">**Сбор и хранение**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-527">**Collection and storage**.</span></span> <span data-ttu-id="6ca64-528">Необработанные данные иснтрументирования могут храниться в разных местах и ​​в различных форматах (например, журналы трассировки приложений, журналы IIS, счетчики производительности).</span><span class="sxs-lookup"><span data-stu-id="6ca64-528">Raw instrumentation data can be held in various locations and with various formats (e.g., application trace logs, IIS logs, performance counters).</span></span> <span data-ttu-id="6ca64-529">Эти разрозненные источники собираются, консолидируются и помещаются в надежное хранилище.</span><span class="sxs-lookup"><span data-stu-id="6ca64-529">These disparate sources are collected, consolidated, and put into reliable storage.</span></span>
* <span data-ttu-id="6ca64-530">**Анализ и диагностика**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-530">**Analysis and diagnosis**.</span></span> <span data-ttu-id="6ca64-531">После консолидирования данных они могут быть проанализированы для устранения неполадок и обеспечения общего представления работоспособности приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-531">After the data is consolidated, it can be analyzed to troubleshoot issues and provide an overall view of application health.</span></span>
* <span data-ttu-id="6ca64-532">**Визуализация и оповещения**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-532">**Visualization and alerts**.</span></span> <span data-ttu-id="6ca64-533">На этом этапе данные телеметрии представлены таким образом, что оператор может быстро заметить проблемы или тенденции.</span><span class="sxs-lookup"><span data-stu-id="6ca64-533">In this stage, telemetry data is presented in such a way that an operator can quickly notice problems or trends.</span></span> <span data-ttu-id="6ca64-534">Например, панели мониторинга или оповещения по электронной почте.</span><span class="sxs-lookup"><span data-stu-id="6ca64-534">Example include dashboards or email alerts.</span></span>  

<span data-ttu-id="6ca64-535">Мониторинг — это не то же самое, что обнаружение сбоя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-535">Monitoring is not the same as failure detection.</span></span> <span data-ttu-id="6ca64-536">Например, приложение может обнаружить временную ошибку и повторить попытку, что позволит избежать простоя.</span><span class="sxs-lookup"><span data-stu-id="6ca64-536">For example, your application might detect a transient error and retry, resulting in no downtime.</span></span> <span data-ttu-id="6ca64-537">Но оно также должно регистрировать операцию повтора, чтобы вы могли контролировать частоту ошибок и получать общую картину работоспособности приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-537">But it should also log the retry operation, so that you can monitor the error rate, in order to get an overall picture of application health.</span></span>

<span data-ttu-id="6ca64-538">Журналы приложений являются важным источником данных диагностики.</span><span class="sxs-lookup"><span data-stu-id="6ca64-538">Application logs are an important source of diagnostics data.</span></span> <span data-ttu-id="6ca64-539">Ниже приведены рекомендации по ведению журнала приложения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-539">Best practices for application logging include:</span></span>

* <span data-ttu-id="6ca64-540">Войдите в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="6ca64-540">Log in production.</span></span> <span data-ttu-id="6ca64-541">В противном случае у вас не будет важных данных аналитики.</span><span class="sxs-lookup"><span data-stu-id="6ca64-541">Otherwise, you lose insight where you need it most.</span></span>
* <span data-ttu-id="6ca64-542">Регистрируйте события в границах служб.</span><span class="sxs-lookup"><span data-stu-id="6ca64-542">Log events at service boundaries.</span></span> <span data-ttu-id="6ca64-543">Включите идентификатор корреляции в границах служб.</span><span class="sxs-lookup"><span data-stu-id="6ca64-543">Include a correlation ID that flows across service boundaries.</span></span> <span data-ttu-id="6ca64-544">Если транзакции проходят через несколько служб и одна из них не работает, идентификатор корреляции поможет вам определить, почему транзакция завершилась сбоем.</span><span class="sxs-lookup"><span data-stu-id="6ca64-544">If a transaction flows through multiple services and one of them fails, the correlation ID will help you pinpoint why the transaction failed.</span></span>
* <span data-ttu-id="6ca64-545">Используйте семантическое ведение журнала, также известное как структурированное ведение журнала.</span><span class="sxs-lookup"><span data-stu-id="6ca64-545">Use semantic logging, also known as structured logging.</span></span> <span data-ttu-id="6ca64-546">Неструктурированные журналы затрудняют автоматизацию потребления и анализа данных журнала, которые необходимы в масштабе облака.</span><span class="sxs-lookup"><span data-stu-id="6ca64-546">Unstructured logs make it hard to automate the consumption and analysis of the log data, which is needed at cloud scale.</span></span>
* <span data-ttu-id="6ca64-547">Используйте асинхронное ведение журнала.</span><span class="sxs-lookup"><span data-stu-id="6ca64-547">Use asynchronous logging.</span></span> <span data-ttu-id="6ca64-548">В противном случае сама система ведения журнала может привести к сбою приложения, вызвав резервное копирование запросов, поскольку они блокируются при ожидании записи события ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="6ca64-548">Otherwise, the logging system itself can cause the application to fail by causing requests to back up, as they block while waiting to write a logging event.</span></span>
* <span data-ttu-id="6ca64-549">Ведение журнала приложения — это не то же, что и аудит.</span><span class="sxs-lookup"><span data-stu-id="6ca64-549">Application logging is not the same as auditing.</span></span> <span data-ttu-id="6ca64-550">Аудит может выполняться для соответствия требованиям или нормам.</span><span class="sxs-lookup"><span data-stu-id="6ca64-550">Auditing may be done for compliance or regulatory reasons.</span></span> <span data-ttu-id="6ca64-551">Таким образом, следует выполнять записи аудита, не прерывая запись при обработке транзакций.</span><span class="sxs-lookup"><span data-stu-id="6ca64-551">As such, audit records must be complete, and it's not acceptable to drop any while processing transactions.</span></span> <span data-ttu-id="6ca64-552">Если приложению требуется аудит, он должен выполняться отдельно от ведения журнала диагностики.</span><span class="sxs-lookup"><span data-stu-id="6ca64-552">If an application requires auditing, this should be kept separate from diagnostics logging.</span></span>

<span data-ttu-id="6ca64-553">Дополнительные сведения о мониторинге и диагностике см. в [этой статье][monitoring-guidance].</span><span class="sxs-lookup"><span data-stu-id="6ca64-553">For more information about monitoring and diagnostics, see [Monitoring and diagnostics guidance][monitoring-guidance].</span></span>

## <a name="respond-to-failures"></a><span data-ttu-id="6ca64-554">Реагирование на сбои</span><span class="sxs-lookup"><span data-stu-id="6ca64-554">Respond to failures</span></span>
<span data-ttu-id="6ca64-555">Предыдущие разделы посвящены автоматическим стратегиям восстановления, которые имеют решающее значение для обеспечения высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="6ca64-555">Previous sections have focused on automated recovery strategies, which are critical for high availability.</span></span> <span data-ttu-id="6ca64-556">Однако иногда требуется ручное вмешательство.</span><span class="sxs-lookup"><span data-stu-id="6ca64-556">However, sometimes manual intervention is needed.</span></span>

* <span data-ttu-id="6ca64-557">**Оповещения.**</span><span class="sxs-lookup"><span data-stu-id="6ca64-557">**Alerts**.</span></span> <span data-ttu-id="6ca64-558">Отслеживайте приложение на предмет предупреждающих знаков, которые могут потребовать активного вмешательства.</span><span class="sxs-lookup"><span data-stu-id="6ca64-558">Monitor your application for warning signs that may require proactive intervention.</span></span> <span data-ttu-id="6ca64-559">Например, если вы видите, что база данных SQL или база данных Cosmos DB постоянно регулирует ваше приложение, вам может потребоваться увеличить емкость базы данных или оптимизировать ваши запросы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-559">For example, if you see that SQL Database or Cosmos DB consistently throttles your application, you might need to increase your database capacity or optimize your queries.</span></span> <span data-ttu-id="6ca64-560">В этом примере, несмотря на то что приложение может обрабатывать ошибки регулирования прозрачно, ваша телеметрия должна все равно вызывать оповещение, чтобы вы могли предпринять ответные меры.</span><span class="sxs-lookup"><span data-stu-id="6ca64-560">In this example, even though the application might handle the throttling errors transparently, your telemetry should still raise an alert so that you can follow up.</span></span>  
* <span data-ttu-id="6ca64-561">**Отработка отказа вручную**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-561">**Manual failover**.</span></span> <span data-ttu-id="6ca64-562">Некоторые системы не могут автоматически выполнять отработку отказа и требуют выполнения перехода на другой ресурс вручную.</span><span class="sxs-lookup"><span data-stu-id="6ca64-562">Some systems cannot fail over automatically and require a manual failover.</span></span> <span data-ttu-id="6ca64-563">Настройте аварийное восстановление виртуальных машин Azure с помощью [Azure Site Recovery][site-recovery] — и вы сможете [выполнить отработку отказа][site-recovery-failover] и восстановить свои виртуальные машины в другом регионе за считаные минуты.</span><span class="sxs-lookup"><span data-stu-id="6ca64-563">For Azure virtual machines configured with [Azure Site Recovery][site-recovery], you can [perform failover][site-recovery-failover] and recover your virtual machines in another region within minutes.</span></span>
* <span data-ttu-id="6ca64-564">**Проверка готовности к работе**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-564">**Operational readiness testing**.</span></span> <span data-ttu-id="6ca64-565">Если ваше приложение выполняет отработку отказа в дополнительный регион, следует запустить тест готовности к работе, прежде чем вы восстановите размещение в основной регион.</span><span class="sxs-lookup"><span data-stu-id="6ca64-565">If your application fails over to a secondary region, you should perform an operational readiness test before you fail back to the primary region.</span></span> <span data-ttu-id="6ca64-566">Тестирование должно проверить, что основной регион работоспособен и готов снова получать трафик.</span><span class="sxs-lookup"><span data-stu-id="6ca64-566">The test should verify that the primary region is healthy and ready to receive traffic again.</span></span>
* <span data-ttu-id="6ca64-567">**Проверка согласованности данных**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-567">**Data consistency check**.</span></span> <span data-ttu-id="6ca64-568">Если сбой происходит в хранилище данных, может возникнуть несогласованность данных, когда хранилище снова станет доступным, особенно если данные были реплицированы.</span><span class="sxs-lookup"><span data-stu-id="6ca64-568">If a failure happens in a data store, there may be data inconsistencies when the store becomes available again, especially if the data was replicated.</span></span>
* <span data-ttu-id="6ca64-569">**Восстановление из резервной копии**.</span><span class="sxs-lookup"><span data-stu-id="6ca64-569">**Restoring from backup**.</span></span> <span data-ttu-id="6ca64-570">Например, если в базе данных SQL происходит региональный сбой, вы можете выполнить геовосстановление базы данных из последней резервной копии.</span><span class="sxs-lookup"><span data-stu-id="6ca64-570">For example, if SQL Database experiences a regional outage, you can geo-restore the database from the latest backup.</span></span>

<span data-ttu-id="6ca64-571">Документируйте и протестируйте план аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="6ca64-571">Document and test your disaster recovery plan.</span></span> <span data-ttu-id="6ca64-572">Оцените влияние сбоев приложения на бизнес.</span><span class="sxs-lookup"><span data-stu-id="6ca64-572">Evaluate the business impact of application failures.</span></span> <span data-ttu-id="6ca64-573">Максимально автоматизируйте процесс и документируйте любые шаги, выполняемые вручную, такие как переход на другой ресурс вручную или восстановление данных из резервных копий.</span><span class="sxs-lookup"><span data-stu-id="6ca64-573">Automate the process as much as possible, and document any manual steps, such as manual failover or data restoration from backups.</span></span> <span data-ttu-id="6ca64-574">Регулярно тестируйте процесс аварийного восстановления для проверки и улучшения плана.</span><span class="sxs-lookup"><span data-stu-id="6ca64-574">Regularly test your disaster recovery process to validate and improve the plan.</span></span>

## <a name="summary"></a><span data-ttu-id="6ca64-575">Сводка</span><span class="sxs-lookup"><span data-stu-id="6ca64-575">Summary</span></span>
<span data-ttu-id="6ca64-576">В этой статье комплексно рассматривается отказоустойчивость с учетом возможных сложностей облачной среды.</span><span class="sxs-lookup"><span data-stu-id="6ca64-576">This article discussed resiliency from a holistic perspective, emphasizing some of the unique challenges of the cloud.</span></span> <span data-ttu-id="6ca64-577">К ним относятся распределенный характер облачных вычислений, использование стандартного оборудования и наличие временных сетевых сбоев.</span><span class="sxs-lookup"><span data-stu-id="6ca64-577">These include the distributed nature of cloud computing, the use of commodity hardware, and the presence of transient network faults.</span></span>

<span data-ttu-id="6ca64-578">Ниже приведены основные заключения.</span><span class="sxs-lookup"><span data-stu-id="6ca64-578">Here are the major points to take away from this article:</span></span>

* <span data-ttu-id="6ca64-579">Отказоустойчивость приводит к более высокой доступности и более низкому среднему времени восстановления после сбоев.</span><span class="sxs-lookup"><span data-stu-id="6ca64-579">Resiliency leads to higher availability, and lower mean time to recover from failures.</span></span>
* <span data-ttu-id="6ca64-580">Для достижения отказоустойчивости в облаке требуется набор методов, отличный от традиционных локальных решений.</span><span class="sxs-lookup"><span data-stu-id="6ca64-580">Achieving resiliency in the cloud requires a different set of techniques from traditional on-premises solutions.</span></span>
* <span data-ttu-id="6ca64-581">Отказоустойчивость не достигается случайным образом.</span><span class="sxs-lookup"><span data-stu-id="6ca64-581">Resiliency does not happen by accident.</span></span> <span data-ttu-id="6ca64-582">Она должна быть разработана и встроена изначально.</span><span class="sxs-lookup"><span data-stu-id="6ca64-582">It must be designed and built in from the start.</span></span>
* <span data-ttu-id="6ca64-583">Отказоустойчивость затрагивает каждую часть жизненного цикла приложения, от планирования и кодирования до операций.</span><span class="sxs-lookup"><span data-stu-id="6ca64-583">Resiliency touches every part of the application lifecycle, from planning and coding to operations.</span></span>
* <span data-ttu-id="6ca64-584">Выполняйте мониторинг и тестирование.</span><span class="sxs-lookup"><span data-stu-id="6ca64-584">Test and monitor!</span></span>


<!-- links -->

[blue-green]: https://martinfowler.com/bliki/BlueGreenDeployment.html
[canary-release]: https://martinfowler.com/bliki/CanaryRelease.html
[circuit-breaker-pattern]: https://msdn.microsoft.com/library/dn589784.aspx
[compensating-transaction-pattern]: https://msdn.microsoft.com/library/dn589804.aspx
[containers]: https://en.wikipedia.org/wiki/Operating-system-level_virtualization
[dsc]: /azure/automation/automation-dsc-overview
[contingency-planning-guide]: https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-34r1.pdf
[fma]: failure-mode-analysis.md
[hystrix]: https://medium.com/netflix-techblog/introducing-hystrix-for-resilience-engineering-13531c1ab362
[jmeter]: https://jmeter.apache.org/
[load-leveling-pattern]: ../patterns/queue-based-load-leveling.md
[monitoring-guidance]: ../best-practices/monitoring.md
[ra-basic-web]: ../reference-architectures/app-service-web-app/basic-web-app.md
[ra-multi-vm]: ../reference-architectures/virtual-machines-windows/multi-vm.md
[checklist]: ../checklist/resiliency.md
[retry-pattern]: ../patterns/retry.md
[retry-service-specific guidance]: ../best-practices/retry-service-specific.md
[sla]: https://azure.microsoft.com/support/legal/sla/
[throttling-pattern]: ../patterns/throttling.md
[tm]: https://azure.microsoft.com/services/traffic-manager/
[tm-failover]: /azure/traffic-manager/traffic-manager-monitoring
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager
[site-recovery]:/azure/site-recovery/azure-to-azure-quickstart/
[site-recovery-test-failover]:/azure/site-recovery/azure-to-azure-tutorial-dr-drill/
[site-recovery-failover]:/azure/site-recovery/azure-to-azure-tutorial-failover-failback/
