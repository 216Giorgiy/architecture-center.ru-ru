---
title: Разработка надежных приложений Azure
description: Общие сведения об обеспечении надежности и высокого уровня доступности приложений Azure
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.custom: ''
ms.openlocfilehash: 16c1daeed9b1d79f33051eb69571f1574bf9be4d
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59644020"
---
# <a name="designing-reliable-azure-applications"></a>Разработка надежных приложений Azure

Процесс создания надежного приложения в облаке отличается от традиционной разработки приложений. Хотя ранее вы, возможно, приобретали оборудование более высокого уровня для вертикального масштабирования, в облачной среде вы должны выполнять горизонтальное масштабирование. Вместо того чтобы пытаться предотвратить все возможные сбои, нужно свести к минимуму воздействие сбоя каждого отдельного компонента.

Надежные приложения отличаются такими характеристиками:

- **Устойчивость** и восстановление после ошибок для работы с минимальными простоями и потерями данных до необходимости выполнять полное восстановление.
- **Высокий уровень доступности** и надлежащая работа с максимальной работоспособностью без значительных простоев.

Понимание того, как такие характеристики связаны друг с другом &mdash; и как они влияют на затраты &mdash; критически важно при создании надежного приложения. Благодаря этому вы сможете оценить, какое время простоев для вас допустимо, рассчитать потенциальные затраты для бизнеса, а также определить необходимые функции для выполнения восстановления.

В этой статье вкратце рассматривается, как повысить надежность приложения Azure на каждом шаге его разработки. В каждом разделе приведена ссылка на подробную статью об интеграции функций для повышения надежности на конкретном шаге процесса. Рекомендации по повышению надежности отдельных служб Azure см. в статье [Resiliency checklist for specific Azure services](../checklist/resiliency-per-service.md) (Контрольный список по обеспечению устойчивости для отдельных служб Azure).

## <a name="build-for-reliability"></a>Разработка для максимальной надежности

В этом разделе описываются шесть шагов по созданию надежного приложения Azure. В каждом шаге приведена ссылка на раздел с подробным описанием процесса и терминов.

1. [**Определите требования.**](#define-requirements) Сформируйте требования к доступности и восстановлению с учетом отдельных потребностей рабочих нагрузок и бизнеса.
1. [**Следуйте рекомендациям по созданию архитектуры.**](#use-architectural-best-practices) Следуйте проверенным практикам, определите возможные точки отказа в архитектуре, а также то, как приложение будет реагировать на ошибки.
1. [**Выполните тестирование с моделированием и принудительными переходами на другой ресурс.**](#test-with-simulations-and-forced-failovers) Выполните моделирование сбоев, инициируйте принудительный переход на другой ресурс и протестируйте обнаружение таких сбоев и восстановление после них.
1. [**Обеспечьте согласованность при развертывании приложения.**](#deploy-the-application-consistently) Разверните выпуск приложения в рабочей среде с использованием надежных и проверенных процессов.
1. [**Отслеживайте работоспособность приложения.**](#monitor-application-health) Обнаруживайте сбои, отслеживайте признаки потенциальных сбоев и оценивайте работоспособность приложений.
1. [**Реагируйте на сбои и аварии.**](#respond-to-failures-and-disasters) Идентифицируйте сбои при их возникновении и определяйте способы реагирования на них на основе утвержденных стратегий.

## <a name="define-requirements"></a>Определение требований

Определите потребности бизнеса и создайте план по повышению надежности, чтобы удовлетворить их. Рассмотрим следующее:

- **Определите рабочие нагрузки и уровень потребления ресурсов.** *Рабочая нагрузка* — это отдельная возможность или задача, которая логически отделена от других задач с точки зрения требований к бизнес-логике и хранению данных. Каждая рабочая нагрузка имеет свои требования к доступности, масштабируемости, согласованности данных и аварийному восстановлению.
- **Составьте план с учетом особенностей потребления.** *Особенности потребления* также очень важны при определении требований. Определите различия в требованиях в критические и некритические периоды. Например, приложение для работы с налоговой документацией не должно стать недоступным прямо перед крайним сроком ее подачи. Для бесперебойной работы обеспечьте избыточность в нескольких регионах на случай сбоя одного из них. И наоборот, чтобы уменьшить затраты в некритические периоды, вы можете выполнять приложение только в одном регионе.
- **Утвердите метрики доступности &mdash; *среднее время восстановления* (MTTR) и *среднее время безотказной работы* (MTBF).** MTTR — это среднее время, необходимое для восстановления компонента после сбоя. MTBF — это продолжительность работы, которую можно ожидать от компонента между отключениями. Используйте эти показатели для определения того, где обеспечить избыточность, а также для назначения соглашений об уровне обслуживания (SLA) для клиентов.  
- **Утвердите метрики восстановления &mdash; целевое время восстановления (RTO) и целевая точка восстановления (RPO).** *RTO* — это максимально допустимое время, в течение которого приложение может быть недоступно после инцидента. *RPO* — это максимальная продолжительность потери данных, которая является приемлемой во время аварии. Чтобы определить их значения, проведите оценку рисков и убедитесь, что вы хорошо понимаете затраты и риски, связанные с простоями или потерей данных в вашей организации.
    > [!NOTE]
    > Если показатель MTTR *любого* критически важного компонента в высокодоступной конфигурации превышает значение RTO системы, сбой в системе может привести к недопустимому прерыванию бизнес-процессов. А это значит, что вы не сможете восстановить систему в рамках определенного значения RTO.
- **Определите целевые показатели доступности рабочих нагрузок.** Чтобы обеспечить соответствие архитектуры приложения вашим бизнес-требованиям, определите целевые соглашения SLA для каждой рабочей нагрузки. Помимо зависимостей приложений, также учитывайте затраты и сложности, связанные с удовлетворением требований к доступности.
- **Изучите соглашения об уровне обслуживания.** В Azure соглашение об уровне обслуживания описывает обязательства корпорации Майкрософт в отношении времени доступности и подключения. Если в SLA для конкретной службы указано 99,9 %, это означает, что вы должны ожидать, что служба будет доступна 99,9 % времени.  

    Определите собственные целевые соглашения SLA для каждой рабочей нагрузки решения, чтобы вы могли оценить, в какой мере архитектура удовлетворяет требованиям бизнеса. Например, если для рабочей нагрузки требуется 99,99 % времени безотказной работы, но она зависит от службы с SLA на уровне 99,9 %, эта служба не может быть единой точкой отказа в системе.

Дополнительные сведения о формулировке требований для надежных приложений см. в статье [Developing requirements for resilient Azure applications](./requirements.md) (Формулирование требований для устойчивых приложений Azure).

## <a name="use-architectural-best-practices"></a>Следование рекомендациям по созданию архитектуры

На этапе разработки архитектуры уделите основное внимание внедрению практик, которые обеспечат удовлетворение бизнес-требований, помогут определять точки сбоя и минимизировать степень их влияния.

- **Выполните анализ режима сбоя (FMA).** FMA позволяет повысить устойчивость приложения на ранней стадии проектирования. Этот анализ помогает определить типы сбоев, которые могут возникнуть для приложения, потенциальные последствия каждого сбоя и возможные стратегии восстановления.
- **Создайте план обеспечения избыточности.** Уровень избыточности каждой рабочей нагрузки зависит от потребностей вашего бизнеса и влияет на общую стоимость приложения. 
- **Проектируйте для масштабируемости.** Облачные приложения должны поддерживать масштабирование для адаптации к изменениям в потреблении ресурсов. Начните разработку с отдельных компонентов и предусмотрите в приложении автоматическое реагирование на изменения нагрузки (при возможности). Учитывайте ограничения масштабирования в ходе разработки, чтобы вы могли с легкостью расширить их в будущем.
- **Учтите требования подписки и служб.** Вам могут потребоваться дополнительные подписки для подготовки достаточного объема ресурсов, чтобы вы могли удовлетворить требования бизнеса к хранению, подключениям, пропускной способности и т. д. 
- **Используйте балансировку нагрузки для распределения запросов.** Балансировка нагрузки распределяет запросы вашего приложения между работоспособными экземплярами службы, удаляя неработоспособные экземпляры из ротации.
- **Внедрите стратегии обеспечения устойчивости.** *Устойчивость* представляет собой возможность восстановления системы после сбоев и продолжения работы. Внедрите [конструктивные шаблоны обеспечения устойчивости](../patterns/category/resiliency.md), например для изолирования критически важных ресурсов, использования компенсирующих транзакций и выполнения асинхронных операций (при возможности).
- **Внедрите требования к доступности в свой проект.** *Доступность* — это доля времени, на протяжении которого система работает надлежащим образом. Примите меры, чтобы обеспечить соответствие уровня доступности приложения вашему соглашению об уровне обслуживания. Например, избегайте единых точек отказа, разделите рабочие нагрузки в зависимости от целевого уровня обслуживания и регулируйте потребление ресурсов пользователей, создающих большую нагрузку.
- **Обеспечьте управление данными.** Подходы к хранению, резервному копированию и репликации данных имеют большое значение.

  - **Выберите методы репликации для данных приложения.** Данные приложения хранятся в разных хранилищах данных и могут иметь разные требования к доступности. Оцените методы репликации и расположения для каждого типа хранилища данных, чтобы убедиться в том, что они отвечают вашим требованиям.
  - **Задокументируйте и протестируйте процессы отработки отказа и восстановления размещения.** Четко задокументируйте инструкции по отработке отказа в новое хранилище данных и регулярно тестируйте их на точность и простоту выполнения.
  - **Обеспечьте защиту данных.** Регулярно создавайте резервные копии данных и проверяйте их, а также убедитесь в том, что ни один пользователь не имеет доступа одновременно к рабочим данным и данным резервных копий.
  - **Обеспечьте возможность восстановления данных.** Убедитесь, что ваша стратегия резервного копирования и репликации позволяет восстановить данные за то время, которое удовлетворяет требованиям уровня обслуживания. Учитывайте все типы данных, которые использует ваше приложение, в том числе ссылочные данные и базы данных.

Дополнительные сведения о создании архитектуры надежных приложений см. в статье [Architecting Azure applications for resiliency and availability](./architect.md) (Разработка архитектуры приложений Azure для максимальной устойчивости и доступности).

## <a name="test-with-simulations-and-forced-failovers"></a>Тестирование с моделированием и принудительными переходами на другой ресурс

Тестирование надежности требует оценки того, как сквозная рабочая нагрузка выполняется в условиях сбоя, которые возникают только периодически.

- **Выполните тестирование для распространенных сценариев сбоя, создавая реальные условия сбоя или моделируя их.** Используйте проверки с внесением ошибок для тестирования распространенных сценариев (в том числе с несколькими сбоями одновременно) и времени восстановления.
- **Определите сбои, которые возникают только под нагрузкой.** Протестируйте на максимальную нагрузку, используя данные из рабочей среды или искусственные данные, максимально приближенные к данным из рабочей среды. Это поможет понять, как приложение работает в реальных условиях.
- **Выполняйте отработку аварийного восстановления.** Внедрите план аварийного восстановления и периодически тестируйте его.
- **Выполните тестирование отработки отказа и восстановления размещения.** Убедитесь в том, что зависимые службы приложения выполняют отработку отказа и восстановление размещения в правильном порядке.
- **Выполните тестирование с моделированием ситуаций.** Тестирование реальных сценариев поможет определить проблемы, требующие решения. Такие сценарии должны быть управляемыми и не прерывать операции бизнеса. Проинформируйте руководство о наличии планов тестирования с моделированием ситуаций.
- **Протестируйте проверки работоспособности.** Настройте проверки работоспособности для подсистем балансировки нагрузки и диспетчеров трафика, чтобы убедиться в надлежащей работе критически важных компонентов системы. Также протестируйте их на надлежащее реагирование.
- **Протестируйте системы мониторинга.** Убедитесь, что системы мониторинга надлежащим образом предоставляют критически важную информацию и точные данные для определения потенциальных сбоев.
- **Включите в сценарии тестирования сторонние службы.** Протестируйте возможные точки отказа, возникающие из-за прерывания работы сторонних служб, а также возможность восстановления.

Тестирование — это итеративный процесс. Протестируйте приложение, оцените результат, проанализируйте и устраните все возникающие сбои и повторите процесс.

Дополнительные сведения о тестировании надежности приложений см. в статье [Testing Azure applications for resiliency and availability](./testing.md) (Тестирование устойчивости и доступности приложений Azure).

## <a name="deploy-the-application-consistently"></a>Согласованное развертывание приложения

*Развертывание* включает подготовку ресурсов Azure, развертывание кода приложения и применение параметров конфигурации. Обновление может включать все три задачи или только некоторые из них.

После развертывания приложения в рабочей среде обновления могут стать возможными источниками ошибок. Сведите к минимуму число ошибок, используя предсказуемые и повторяющиеся процессы развертывания.

- **Автоматизируйте процесс развертывания приложения.** При возможности автоматизируйте процессы.
- **Разработайте процесс выпуска, максимально повышающий уровень доступности.** Если процесс выпуска требует, чтобы службы отключались во время развертывания, ваше приложение будет недоступно, пока службы не вернутся в сеть. Используйте возможности промежуточной и рабочей среды для платформы. Применяйте "сине-зеленые" или ранние выпуски для развертывания обновлений, чтобы в случае сбоя вы могли быстро откатить обновление.
- **Составьте план отката развертывания.** Создайте процесс отката, позволяющий вернуться к последней известной рабочей версии и минимизировать время простоя в случае сбоя развертывания.
- **Ведите журнал развертываний и выполняйте их аудит.** Если вы используете промежуточные методы развертывания, в рабочей среде будет существовать несколько версий вашего приложения. Реализуйте надежную стратегию ведения журнала, чтобы получить как можно больше сведений о версии.
- **Задокументируйте процесс выпуска приложения.** Четко определите и задокументируйте процесс выпуска и убедитесь, что он доступен для всей группы разработки.

Дополнительные сведения о надежности и развертывании приложений см. в статье [Deploying Azure applications for resiliency and availability](./deploy.md) (Развертывание приложений Azure для максимальной устойчивости и доступности).

## <a name="monitor-application-health"></a>Мониторинг работоспособности приложений

Внедрите рекомендации по мониторингу и созданию оповещений для приложения, чтобы вы могли обнаруживать сбои и уведомлять оператора о необходимости устранения проблемы.

- **Внедрите проверки работоспособности и функции проверки.** Регулярно выполняйте их извне приложения, чтобы обнаруживать ситуации с ухудшением работоспособности и производительности приложения.
- **Проверяйте длительные рабочие процессы.** Раннее обнаружение проблем позволяет устранить потребность в откате всего рабочего процесса или выполнении множества компенсирующих транзакций.
- **Обеспечьте ведение журналов приложений.**

  - Используйте возможности ведения журналов приложений в рабочей среде и на границе служб.
  - Применяйте семантическое и асинхронное ведение журналов.
  - Журналы приложений ведите отдельно от журналов аудита.

- **Ведите статистику удаленных вызовов и передавайте такие данные команде приложения.** Чтобы предоставить рабочей группе мгновенный доступ к данным о работоспособности приложения, создавайте сводку метрик удаленных вызовов, например задержки, пропускной способности и ошибок на уровне 99-го и 95-го процентилей. Выполните статистический анализ показателей, чтобы выявить ошибки, возникающие на каждом процентиле.
- **Отслеживайте временные исключения и повторения за соответствующий интервал времени.** Тенденция увеличения исключений с течением времени указывает на то, что в службе возникла проблема и она может выйти из строя.
- **Настройте систему раннего предупреждения.** Определите ключевые показатели эффективности (КПЭ) вашего приложения, такие как временные исключения и задержка удаленных вызовов, и установите соответствующие пороговые значения для каждого из них. Отправьте оповещение операциям при достижении порогового значения.
- **Выполняйте операции с учетом ограничений подписки Azure.** В подписках Azure предусмотрены ограничения на определенные типы ресурсов, такие как количество групп ресурсов, ядер и учетных записей хранения. Обеспечьте отслеживание потребления ресурсов по типам.
- **Отслеживайте сторонние службы.** Ведите журнал вызовов и выполняйте его корреляцию с журналом работоспособности приложения и журналом диагностики с помощью уникального идентификатора.
- **Обучите нескольких операторов мониторингу приложения и выполнению шагов восстановления вручную.** Обеспечьте постоянную доступность по меньшей мере одного обученного оператора.

Дополнительные сведения о мониторинге надежности приложения см. в статье [Monitoring Azure application health](./monitoring.md) (Мониторинг работоспособности приложения Azure).

## <a name="respond-to-failures-and-disasters"></a>Реагирование на сбои и аварии

Разработайте план восстановления и убедитесь, что он охватывает такие ситуации, как восстановление данных, сбои сети, сбои зависимых служб и прерывание работы служб во всем регионе. Учитывайте потребности виртуальных машин, хранилища, баз данных и других служб платформы Azure в своей стратегии восстановления.

- **Подготовьтесь к взаимодействию со службой поддержки Azure.** До того как в этом возникнет необходимость, разработайте процедуру обращения в службу поддержки Azure.
- **Задокументируйте план аварийного восстановления и тестируйте его.** Разработайте план аварийного восстановления, в котором описывается влияние сбоев приложения на бизнес. В максимальной степени автоматизируйте процессы восстановления и задокументируйте все шаги, которые требуется выполнять вручную. Регулярно тестируйте процесс аварийного восстановления для проверки и улучшения плана.
- **При необходимости выполняйте отработку отказа вручную.** Некоторые системы не могут автоматически выполнять отработку отказа и требуют выполнения перехода на другой ресурс вручную. Если приложение переходит на другой ресурс в дополнительном регионе, выполните тест готовности к работе. Убедитесь, что основной регион работоспособен и готов снова получать трафик, прежде чем восстанавливать размещение. Определите, какие функции приложения работают ненадлежащим образом и как приложение оповещает пользователей о временных проблемах.
- **Подготовьтесь к сбоям приложения.** Подготовьтесь к самым различным сбоям, в том числе к сбоям, которые обрабатываются автоматически, приводят к ограничению функциональности и становятся причиной недоступности приложения. Приложение должно оповещать пользователей о временных проблемах.
- **Выполняйте восстановление после повреждения данных.** Если сбой произошел в хранилище данных, выполните проверку на отсутствие несогласованности данных, когда хранилище снова станет доступным, особенно если данные были реплицированы. Восстановите поврежденные данные из резервной копии.
- **Выполняйте восстановление после сбоя сети.** В некоторых ситуациях вы сможете использовать кэшированные данные для локальной работы с ограниченной функциональностью приложения. В противном случае рассматривайте их как простой приложения или выполните отработку отказа на другой регион. Сохраняйте данные в другом расположении до восстановления подключения.
- **Выполняйте восстановление после сбоя зависимой службы.** Определите, какие функции доступны и как приложение должно реагировать.
- **Выполняйте восстановления после прерывания работы служб во всем регионе.** Прерывания работы служб во всем регионе — это редкость, но вы должны иметь стратегию и для них, особенно в случае с критически важными приложениями. В некоторых ситуациях вы сможете повторно развернуть приложение в другом регионе или перераспределить трафик.

Дополнительные сведения о реагировании на сбои и об аварийном восстановлении см. в статье [Failure and disaster recovery for Azure applications](./disaster-recovery.md) (Восстановление после сбоев и аварийное восстановление для приложений Azure).

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Формулирование требований для устойчивых приложений](./requirements.md)
