---
title: Развертывание приложения Azure для обеспечения устойчивости и доступности
description: Обзор методов создания надежного развертывания в Azure
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: d8df3fe1c3353c60462959a625ba13ae47b96cf8
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59646647"
---
# <a name="deploying-azure-applications-for-resiliency-and-availability"></a><span data-ttu-id="e0676-103">Развертывание приложения Azure для обеспечения устойчивости и доступности</span><span class="sxs-lookup"><span data-stu-id="e0676-103">Deploying Azure applications for resiliency and availability</span></span>

<span data-ttu-id="e0676-104">Как подготовить и обновления ресурсов Azure, код приложения и параметры конфигурации, повторяемым и предсказуемым процесса поможет избежать ошибок и простоев.</span><span class="sxs-lookup"><span data-stu-id="e0676-104">As you provision and update Azure resources, application code, and configuration settings, a repeatable and predictable process will help you avoid errors and downtime.</span></span> <span data-ttu-id="e0676-105">Мы рекомендуем использовать автоматизированные процессы для развертывания, которые можно выполнять по требованию и повторить запуск, если что-то происходит сбой.</span><span class="sxs-lookup"><span data-stu-id="e0676-105">We recommend automated processes for deployment that you can run on demand and rerun if something fails.</span></span> <span data-ttu-id="e0676-106">После развертывания процессы работают исправно, документация по процессу можно синхронизировать их таким образом.</span><span class="sxs-lookup"><span data-stu-id="e0676-106">After your deployment processes are running smoothly, process documentation can keep them that way.</span></span>

## <a name="automate-processes"></a><span data-ttu-id="e0676-107">Автоматизация процессов</span><span class="sxs-lookup"><span data-stu-id="e0676-107">Automate processes</span></span>

<span data-ttu-id="e0676-108">Для активации ресурсов по требованию, быстрого развертывания решений, свести к минимуму человеческой ошибки и создавать согласованный и воспроизводимой результат, не забудьте автоматизации развертывания и обновления.</span><span class="sxs-lookup"><span data-stu-id="e0676-108">To activate resources on demand, deploy solutions rapidly, minimize human error, and produce consistent and repeatable results, be sure to automate deployments and updates.</span></span>

### <a name="automate-as-many-processes-as-possible"></a><span data-ttu-id="e0676-109">Автоматизация процессов столько максимально</span><span class="sxs-lookup"><span data-stu-id="e0676-109">Automate as many processes as possible</span></span>

<span data-ttu-id="e0676-110">Самый надежный процессы развертывания автоматизированы и *идемпотентными* &mdash; т.е repeatable для дают одинаковые результаты.</span><span class="sxs-lookup"><span data-stu-id="e0676-110">The most reliable deployment processes are automated and *idempotent* &mdash; that is, repeatable to produce the same results.</span></span>

- <span data-ttu-id="e0676-111">Для автоматизации подготовки ресурсов Azure, можно использовать [Terraform](/azure/virtual-machines/windows/infrastructure-automation#terraform), [Ansible](/azure/virtual-machines/windows/infrastructure-automation#ansible), [Chef](/azure/virtual-machines/windows/infrastructure-automation#chef), [Puppet](/azure/virtual-machines/windows/infrastructure-automation#puppet), [Azure PowerShell](/powershell/azure/overview), [интерфейса командной строки Azure (CLI)](/cli/azure), или [шаблонов Azure Resource Manager](/azure/azure-resource-manager/resource-group-overview#template-deployment).</span><span class="sxs-lookup"><span data-stu-id="e0676-111">To automate provisioning of Azure resources, you can use [Terraform](/azure/virtual-machines/windows/infrastructure-automation#terraform),   [Ansible](/azure/virtual-machines/windows/infrastructure-automation#ansible), [Chef](/azure/virtual-machines/windows/infrastructure-automation#chef), [Puppet](/azure/virtual-machines/windows/infrastructure-automation#puppet),   [Azure PowerShell](/powershell/azure/overview), [Azure command-line interface (CLI)](/cli/azure), or [Azure Resource Manager templates](/azure/azure-resource-manager/resource-group-overview#template-deployment).</span></span>
- <span data-ttu-id="e0676-112">Чтобы настроить виртуальные машины, можно использовать [cloud-init](/azure/virtual-machines/windows/infrastructure-automation#cloud-init) (для виртуальных машин Linux) или [настройки состояния службы автоматизации Azure](/azure/automation/automation-dsc-overview) (DSC).</span><span class="sxs-lookup"><span data-stu-id="e0676-112">To configure VMs, you can use [cloud-init](/azure/virtual-machines/windows/infrastructure-automation#cloud-init) (for Linux VMs) or [Azure Automation State Configuration](/azure/automation/automation-dsc-overview) (DSC).</span></span>
- <span data-ttu-id="e0676-113">Чтобы автоматизировать развертывание приложений, можно использовать [служб Azure DevOps](/azure/virtual-machines/windows/infrastructure-automation#azure-devops-services), [Jenkins](/azure/virtual-machines/windows/infrastructure-automation#jenkins), или другие решения CI/CD.</span><span class="sxs-lookup"><span data-stu-id="e0676-113">To automate application deployment, you can use [Azure DevOps Services](/azure/virtual-machines/windows/infrastructure-automation#azure-devops-services), [Jenkins](/azure/virtual-machines/windows/infrastructure-automation#jenkins), or other CI/CD solutions.</span></span>

<span data-ttu-id="e0676-114">Как рекомендуется создайте репозиторий сценариев автоматизации по категориям для быстрого доступа, вместе с четким описанием параметров и примеры использования сценариев.</span><span class="sxs-lookup"><span data-stu-id="e0676-114">As a best practice, create a repository of categorized automation scripts for quick access, documented with explanations of parameters and examples of script use.</span></span> <span data-ttu-id="e0676-115">Синхронизировать этой документации с развертываниями Azure и назначьте ответственного за управление в репозитории.</span><span class="sxs-lookup"><span data-stu-id="e0676-115">Keep this documentation in sync with your Azure deployments, and designate a primary person to manage the repository.</span></span>

<span data-ttu-id="e0676-116">Сценарии автоматизации могут также активировать ресурсы по требованию для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="e0676-116">Automation scripts can also activate resources on demand for disaster recovery.</span></span>

### <a name="use-code-to-provision-and-configure-infrastructure"></a><span data-ttu-id="e0676-117">Используйте код, чтобы подготовить и настроить инфраструктуру</span><span class="sxs-lookup"><span data-stu-id="e0676-117">Use code to provision and configure infrastructure</span></span>

<span data-ttu-id="e0676-118">В этом практическом занятии вызывается *инфраструктура как код,* может использовать декларативный подход или императивный подход (или их сочетание).</span><span class="sxs-lookup"><span data-stu-id="e0676-118">This practice, called *infrastructure as code,* may use a declarative approach or an imperative approach (or a combination of both).</span></span>

- <span data-ttu-id="e0676-119">[Шаблоны Resource Manager](/azure/azure-resource-manager/resource-group-overview#template-deployment) являются примером декларативного подхода.</span><span class="sxs-lookup"><span data-stu-id="e0676-119">[Resource Manager templates](/azure/azure-resource-manager/resource-group-overview#template-deployment) are an example of a declarative approach.</span></span>
- <span data-ttu-id="e0676-120">[PowerShell](/powershell/azure/overview) сценарии являются примером императивного подхода.</span><span class="sxs-lookup"><span data-stu-id="e0676-120">[PowerShell](/powershell/azure/overview) scripts are an example of an imperative approach.</span></span>

### <a name="practice-immutable-infrastructure"></a><span data-ttu-id="e0676-121">Неизменяемая инфраструктура практике</span><span class="sxs-lookup"><span data-stu-id="e0676-121">Practice immutable infrastructure</span></span>

<span data-ttu-id="e0676-122">Другими словами не следует изменять инфраструктуру после ее развертывания в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="e0676-122">In other words, don't modify infrastructure after it's deployed to production.</span></span> <span data-ttu-id="e0676-123">После применения ситуативные изменения, вы можете не знать точно что изменилось, поэтому он может быть затруднено Устранение неполадок в системе.</span><span class="sxs-lookup"><span data-stu-id="e0676-123">After ad hoc changes have been applied, you might not know exactly what has changed, so it can be difficult to troubleshoot the system.</span></span>

### <a name="automate-and-test-deployment-and-maintenance-tasks"></a><span data-ttu-id="e0676-124">Автоматизируйте и тестируйте задачи развертывания и обслуживания</span><span class="sxs-lookup"><span data-stu-id="e0676-124">Automate and test deployment and maintenance tasks</span></span>

<span data-ttu-id="e0676-125">Распределенные приложения состоят из нескольких частей, которые должны работать вместе.</span><span class="sxs-lookup"><span data-stu-id="e0676-125">Distributed applications consist of multiple parts that must work together.</span></span> <span data-ttu-id="e0676-126">Развертывания следует воспользоваться преимуществами проверенных механизмов, таких как скрипты, которые можно обновить и проверить конфигурацию и автоматизировать процесс развертывания.</span><span class="sxs-lookup"><span data-stu-id="e0676-126">Deployment should take advantage of proven mechanisms, such as scripts, that can update and validate configuration and automate the deployment process.</span></span> <span data-ttu-id="e0676-127">Протестируйте все процессы полностью, чтобы удостовериться, что ошибки не приводят к дополнительным простоям.</span><span class="sxs-lookup"><span data-stu-id="e0676-127">Test all processes fully to ensure that errors don't cause additional downtime.</span></span>

### <a name="implement-deployment-security-measures"></a><span data-ttu-id="e0676-128">Реализации мер безопасности развертывания</span><span class="sxs-lookup"><span data-stu-id="e0676-128">Implement deployment security measures</span></span>

<span data-ttu-id="e0676-129">Все средства развертывания необходимо включить ограничения безопасности для защиты развернутого приложения.</span><span class="sxs-lookup"><span data-stu-id="e0676-129">All deployment tools must incorporate security restrictions to protect the deployed application.</span></span> <span data-ttu-id="e0676-130">Определить и применяйте политики развертывания, тщательно и свести к минимуму необходимость вмешательства человека.</span><span class="sxs-lookup"><span data-stu-id="e0676-130">Define and enforce deployment policies carefully, and minimize the need for human intervention.</span></span>

## <a name="deploy-to-multiple-regions-and-instances"></a><span data-ttu-id="e0676-131">Развертывание в нескольких регионах и экземпляров</span><span class="sxs-lookup"><span data-stu-id="e0676-131">Deploy to multiple regions and instances</span></span>

<span data-ttu-id="e0676-132">Приложения, зависящего на один экземпляр службы создается единая точка отказа.</span><span class="sxs-lookup"><span data-stu-id="e0676-132">An application that depends on a single instance of a service creates a single point of failure.</span></span> <span data-ttu-id="e0676-133">Чтобы повысить устойчивость и масштабируемость, подготовьте несколько экземпляров.</span><span class="sxs-lookup"><span data-stu-id="e0676-133">To improve resiliency and scalability, provision multiple instances.</span></span>

- <span data-ttu-id="e0676-134">Для [службы приложений Azure](/azure/app-service/app-service-value-prop-what-is/) выберите [план служб приложений](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/), где есть несколько экземпляров.</span><span class="sxs-lookup"><span data-stu-id="e0676-134">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span>
- <span data-ttu-id="e0676-135">Для [облачных служб Azure](/azure/cloud-services/cloud-services-choose-me), настройте каждый из роли для применения [несколько экземпляров](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management).</span><span class="sxs-lookup"><span data-stu-id="e0676-135">For [Azure Cloud Services](/azure/cloud-services/cloud-services-choose-me), configure each of your roles to use [multiple instances](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management).</span></span>
- <span data-ttu-id="e0676-136">Для [виртуальных машинах](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), убедитесь, что архитектура виртуальных содержит несколько виртуальных Машин и что каждая виртуальная машина входит в [доступности](/azure/virtual-machines/virtual-machines-windows-manage-availability/).</span><span class="sxs-lookup"><span data-stu-id="e0676-136">For [Azure Virtual Machines](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your architecture includes more than one VM and that each VM is included in an [availability set](/azure/virtual-machines/virtual-machines-windows-manage-availability/).</span></span>

### <a name="consider-deploying-across-multiple-regions"></a><span data-ttu-id="e0676-137">Рассмотрите возможность развертывания в нескольких регионах</span><span class="sxs-lookup"><span data-stu-id="e0676-137">Consider deploying across multiple regions</span></span>

<span data-ttu-id="e0676-138">Мы рекомендуем развертывать все, но наименее важных приложений, так и для службы приложений в нескольких регионах.</span><span class="sxs-lookup"><span data-stu-id="e0676-138">We recommend deploying all but the least critical applications and application services across multiple regions.</span></span> <span data-ttu-id="e0676-139">Если приложение развертывается в одном регионе, в редких случаях, когда весь регион становится недоступным, приложение также будет недоступна.</span><span class="sxs-lookup"><span data-stu-id="e0676-139">If your application is deployed to a single region, in the rare event that the entire region becomes unavailable, the application will also be unavailable.</span></span>

<span data-ttu-id="e0676-140">Если требуется выполнить развертывание в одном регионе, рассмотрите возможность подготовки для повторного развертывания в дополнительный регион в ответ на непредвиденный сбой.</span><span class="sxs-lookup"><span data-stu-id="e0676-140">If you choose to deploy to a single region, consider preparing to redeploy to a secondary region as a response to an unexpected failure.</span></span>

### <a name="redeploy-to-a-secondary-region"></a><span data-ttu-id="e0676-141">Повторное развертывание в дополнительном регионе</span><span class="sxs-lookup"><span data-stu-id="e0676-141">Redeploy to a secondary region</span></span>

<span data-ttu-id="e0676-142">При запуске приложения и базы данных в единый, основной регион без репликации стратегии восстановления можно выполнить повторное развертывание в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="e0676-142">If you run applications and databases in a single, primary region with no replication, your recovery strategy might be to redeploy to another region.</span></span> <span data-ttu-id="e0676-143">Это решение является доступной, но наиболее подходящий для некритических приложений, которые допускают более длительное время восстановления.</span><span class="sxs-lookup"><span data-stu-id="e0676-143">This solution is affordable but most appropriate for non-critical applications that can tolerate longer recovery times.</span></span>

<span data-ttu-id="e0676-144">Если эта стратегия, автоматизировать процесс повторного развертывания максимально и включают в себя сценарии повторного развертывания в тестирование аварийного ответа.</span><span class="sxs-lookup"><span data-stu-id="e0676-144">If you choose this strategy, automate the redeployment process as much as possible and include redeployment scenarios in your disaster response testing.</span></span>

<span data-ttu-id="e0676-145">Чтобы автоматизировать процесс повторного развертывания, рассмотрите возможность использования [Azure Site Recovery](/azure/site-recovery/).</span><span class="sxs-lookup"><span data-stu-id="e0676-145">To automate your redeployment process, consider using [Azure Site Recovery](/azure/site-recovery/).</span></span>

## <a name="use-staging-and-production-environments"></a><span data-ttu-id="e0676-146">Использование промежуточной и рабочей сред</span><span class="sxs-lookup"><span data-stu-id="e0676-146">Use staging and production environments</span></span>

<span data-ttu-id="e0676-147">Используйте промежуточной и рабочей сред позволяет передавать обновления в рабочей среде настоятельно контролируемым способом в и свести к минимуму простои из развертывания непредвиденных проблем.</span><span class="sxs-lookup"><span data-stu-id="e0676-147">With good use of staging and production environments, you can push updates to the production environment in a highly controlled way and minimize disruption from unanticipated deployment issues.</span></span>

- <span data-ttu-id="e0676-148">[*Сине зеленое развертывание*](https://martinfowler.com/bliki/BlueGreenDeployment.html) включает в себя развертывание обновления в рабочей среде отдельно от работающего приложения.</span><span class="sxs-lookup"><span data-stu-id="e0676-148">[*Blue-green deployment*](https://martinfowler.com/bliki/BlueGreenDeployment.html) involves deploying an update into a production environment that's separate from the live application.</span></span> <span data-ttu-id="e0676-149">После проверки развертывания переключите маршрутизацию трафика на обновленную версию.</span><span class="sxs-lookup"><span data-stu-id="e0676-149">After you validate the deployment, switch the traffic routing to the updated version.</span></span> <span data-ttu-id="e0676-150">Один из способов сделать это позволяет использовать [промежуточные слоты](/azure/app-service/web-sites-staged-publishing) доступны в службе приложений Azure для размещения развертывания перед ее перемещением в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="e0676-150">One way to do this is to use the [staging slots](/azure/app-service/web-sites-staged-publishing) available in Azure App Service to stage a deployment before moving it to production.</span></span>
- <span data-ttu-id="e0676-151">[*Ранние выпуски*](https://martinfowler.com/bliki/CanaryRelease.html) аналогичны развертывания blue-green.</span><span class="sxs-lookup"><span data-stu-id="e0676-151">[*Canary releases*](https://martinfowler.com/bliki/CanaryRelease.html) are similar to blue-green deployments.</span></span> <span data-ttu-id="e0676-152">Вместо перенаправить весь трафик обновленного приложения, полученные только небольшую часть трафика к новому развертыванию.</span><span class="sxs-lookup"><span data-stu-id="e0676-152">Instead of switching all traffic to the updated application, you route only a small portion of the traffic to the new deployment.</span></span> <span data-ttu-id="e0676-153">Если имеется проблема, вернуться к старому развертыванию.</span><span class="sxs-lookup"><span data-stu-id="e0676-153">If there's a problem, revert to the old deployment.</span></span> <span data-ttu-id="e0676-154">В противном случае постепенно маршрутизации большего объема трафика на новую версию.</span><span class="sxs-lookup"><span data-stu-id="e0676-154">If not, gradually route more traffic to the new version.</span></span> <span data-ttu-id="e0676-155">При использовании службы приложений Azure, можно использовать в рабочей среде функции тестирования для управления раннего выпуска.</span><span class="sxs-lookup"><span data-stu-id="e0676-155">If you're using Azure App Service, you can use the Testing in production feature to manage a canary release.</span></span>

## <a name="create-a-rollback-plan-for-deployment-and-updates"></a><span data-ttu-id="e0676-156">Создать план отката развертывания и обновления</span><span class="sxs-lookup"><span data-stu-id="e0676-156">Create a rollback plan for deployment and updates</span></span>

<span data-ttu-id="e0676-157">Если происходит сбой развертывания, приложение может стать недоступным.</span><span class="sxs-lookup"><span data-stu-id="e0676-157">If a deployment fails, your application could become unavailable.</span></span> <span data-ttu-id="e0676-158">Чтобы свести к минимуму время простоя, создайте процесс отката, чтобы вернуться к рабочей версии последний известный.</span><span class="sxs-lookup"><span data-stu-id="e0676-158">To minimize downtime, design a rollback process to go back to a last-known good version.</span></span> <span data-ttu-id="e0676-159">Включить стратегию для отката изменений к базам данных и другие службы, от которых зависит приложение.</span><span class="sxs-lookup"><span data-stu-id="e0676-159">Include a strategy to roll back changes to databases and any other services your app depends on.</span></span>

<span data-ttu-id="e0676-160">При использовании службы приложений Azure, можно настроить слот последний известный удачному сайту и использовать его для отката из веб-роли или развертывания приложения API.</span><span class="sxs-lookup"><span data-stu-id="e0676-160">If you're using Azure App Service, you can set up a last-known good site slot and use it to roll back from a web or API app deployment.</span></span>

## <a name="log-and-audit-deployments"></a><span data-ttu-id="e0676-161">Развертываний журнала и аудит</span><span class="sxs-lookup"><span data-stu-id="e0676-161">Log and audit deployments</span></span>

<span data-ttu-id="e0676-162">Для захвата как гораздо сведений о версии как можно реализуйте надежную стратегию ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="e0676-162">To capture as much version-specific information as possible, implement a robust logging strategy.</span></span> <span data-ttu-id="e0676-163">При использовании методов промежуточное развертывание, более одной версии приложения будут выполняться в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="e0676-163">If you use staged deployment techniques, more than one version of your application will be running in production.</span></span> <span data-ttu-id="e0676-164">Если возникает проблема, определите, какая версия вызывает его.</span><span class="sxs-lookup"><span data-stu-id="e0676-164">If a problem occurs, determine which version is causing it.</span></span>

## <a name="document-release-processes"></a><span data-ttu-id="e0676-165">Процессы выпуска документа</span><span class="sxs-lookup"><span data-stu-id="e0676-165">Document release processes</span></span>

<span data-ttu-id="e0676-166">Без подробного документирования процесса выпуска оператор может развернуть неправильное обновление или неправильно настроить параметры для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="e0676-166">Without detailed release process documentation, an operator might deploy a bad update or might improperly configure settings for your application.</span></span> <span data-ttu-id="e0676-167">Четко определите и задокументируйте процесс выпуска и убедитесь, что он доступен для всей группы разработки.</span><span class="sxs-lookup"><span data-stu-id="e0676-167">Clearly define and document your release process, and ensure that it's available to the entire operations team.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e0676-168">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="e0676-168">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="e0676-169">Мониторинга работоспособности для обеспечения надежности</span><span class="sxs-lookup"><span data-stu-id="e0676-169">Monitor application health for reliability</span></span>](./monitoring.md)
