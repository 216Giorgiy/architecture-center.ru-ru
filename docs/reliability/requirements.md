---
title: Определение требований для устойчивых приложений Azure
description: Обзор сбора требований доступности и устойчивости для приложений Azure
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: 2af2ce4200c285abfda1395862d21efc3c17e577
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59646633"
---
# <a name="developing-requirements-for-resilient-azure-applications"></a>Разработка требований для устойчивых приложений Azure

Построение *устойчивости* (восстановление после сбоев) и *доступности* (запущенного в работоспособном состоянии без значительного увеличения времени простоя) в приложения начинается с сбора требований. Например какое время простоя приемлемо? Сколько стоит потенциального простоя вашего бизнеса? Каковы требования к доступности ваших клиентов? Сколько вы инвестировать в создание приложения высокой доступности? Что такое риск и затраты?

## <a name="identify-distinct-workloads"></a>Определение различных рабочих нагрузок

Облачные решения обычно состоят из нескольких приложений *рабочих нагрузок*. Рабочая нагрузка представляет уникальных возможностей или задачу, которая логически отделена от других задач с точки зрения бизнес-логику и данные хранилища требований. Например приложение электронной коммерции может иметь следующие рабочие нагрузки:

- просмотр и поиск в каталоге продукции;
- создание и отслеживание заказов;
- просмотр рекомендаций.

Каждая рабочая нагрузка имеет различные требования к доступности, масштабируемости, согласованности данных и аварийного восстановления. Сделать бизнес-решений, балансировки затраты и риски для каждой рабочей нагрузки.

Кроме того, разделяйте рабочие нагрузки, цель уровня обслуживания. Если служба состоит из важных и менее важных рабочих нагрузок, управления ими по-разному и укажите функции службы и число экземпляров, необходимый для соблюдения требований к доступности.

## <a name="plan-for-usage-patterns"></a>План для шаблонов использования

Выявление различий в требованиях критических и некритических периоды. Существуют ли определенные критические периоды, когда система должна быть доступной? Например приложение заполнения налоговых деклараций не может завершиться ошибкой во время крайним сроком их подачи и служба потоковой передачи видео не следует запаздывания во время события прямой трансляции. В таких ситуациях взвесить издержки с риском.

- Для обеспечения бесперебойной работы и удовлетворения соглашение об уровне обслуживания (SLA) в критические периоды, планировать избыточность в нескольких регионах в случае сбоя одного, даже если он стоит дороже.
- И наоборот некритические периоды, запустите приложение в одном регионе, чтобы свести к минимуму затраты.
- В некоторых случаях можно избежать дополнительных расходов, с помощью современных бессерверных методов, имеющих выставления счетов на основе потребления.

## <a name="establish-availability-and-recovery-metrics"></a>Установить показатели доступности и восстановления

Создание исходных значений для двух наборов метрик как часть процесса требования. Первый набор поможет вам определить место добавления избыточность для облачных служб и какие соглашения об уровне обслуживания для обеспечения для клиентов. Второй набор поможет при планировании аварийного восстановления.

### <a name="availability-metrics"></a>Метрики доступности

Эти меры можно используйте для планирования для обеспечения избыточности и определить соглашения об уровне обслуживания клиентов.

- **Среднее время восстановления (MTTR)** среднее время, необходимое для восстановления после сбоя компонента.
- **Среднее время между сбоев (MTBF)** , как долго компонент может рассчитывать на длительный период между простоев.

### <a name="recovery-metrics"></a>Метрики восстановления

Получение этих значений с Проведение оценки риска и убедитесь, что вы понимаете, стоимость и риск простоя и потерю данных. Это нефункциональные требования системы и зависит от бизнес-требований.

- **Время восстановления (RTO)** — это максимальное время допустимо, приложение недоступно после инцидента.
- **Точки восстановления (RPO)** — это максимальная продолжительность потери данных, которая является приемлемой во время аварии.

Если значение MTTR *любой* наиболее важным компонентом в настройки с высокой доступностью превышает RTO система, сбой в системе может привести к неприемлемой бизнес-процессов. То есть нельзя восстановить систему в пределах определенного RTO.

## <a name="determine-workload-availability-targets"></a>Определение целевых показателей доступности рабочей нагрузки

Определите свои собственные целевые соглашения об уровне обслуживания для каждой рабочей нагрузки в решении, чтобы можно было определить, соответствует ли архитектура бизнес-требования.

### <a name="consider-cost-and-complexity"></a>Учитывать стоимость и сложность

Равных, более высокая доступность лучше. Однако как вы стремитесь к дополнительные девятки, стоимость и сложность увеличиваться. Время непрерывной работы 99,99% преобразуется около пяти минут общее время простоя в месяц. Стоит ли дополнительную сложность и стоимость для достижения 99,999%? Ответ зависит от бизнес-требований.

Ниже приведены некоторые рекомендации по выбору SLA:

- Чтобы добиться четыре девятки (99,99%), нельзя полагаться на ручное вмешательство для восстановления после сбоев. Приложение должно иметь возможности самостоятельной диагностики и самовосстановления.
- За четыре девятки сложно обнаружении сбоев достаточно быстро, в соответствии с соглашением об уровне ОБСЛУЖИВАНИЯ.
- Подумайте о временном окне, для которого измеряется SLA. Чем меньше окно, тем строже допуски. Нет смысла определять SLA с точки зрения ежечасного или ежедневного времени работы.
- Проанализируйте результаты измерений MTBF и MTTR. Чем выше уровень ОБСЛУЖИВАНИЯ, тем реже службы можно перейти и более быстрые необходимо восстановить службу.
- Получить соглашение о заказчиках для целевых показателей доступности каждой части приложения и ее следует задокументировать. В противном случае ваш проект может не соответствовать ожиданиям клиентов.

### <a name="identify-dependencies"></a>Определить зависимости

Выполните упражнения сопоставление зависимостей для определения внутренних и внешних зависимостях. Примеры включают зависимости, относящиеся к безопасности или удостоверение, например Active Directory или сторонних служб, таких как поставщика платежных услуг или электронной почты службы обмена сообщениями.

Обратите особое внимание на внешние зависимости, которые могут представлять собой единую точку отказа или узких мест. Если рабочей нагрузки требуется 99,99%, но зависит от службы с 99,9% времени, эта служба не может быть единой точкой отказа в системе. Одним из средств защиты является наличие резервного пути в случае сбоя службы. Кроме того можно принять другие меры для восстановления после сбоя в этой службе.

В следующей таблице показано потенциальное суммарное время простоя для различных уровней SLA.

| **Соглашение об уровне обслуживания** | **Время простоя в неделю** | **Время простоя в месяц** | **Время простоя в год** |
|---------|-----------------------|------------------------|-----------------------|
| 99 %     | 1,68 часа            | 7,2 часа              | 3,65 дня             |
| 99,9 %   | 10,1 минуты          | 43,2 мин           | 8,76 часа            |
| 99,95 %  | 5 мин             | 21,6 мин           | 4,38 часа            |
| 99,99 %  | 1,01 минуты          | 4,32 минуты           | 52,56 минуты         |
| 99,999 % | 6 секунд             | 25,9 секунды           | 5,26 минуты          |

## <a name="understand-service-level-agreements"></a>Понять, соглашение об уровне обслуживания

В Azure [соглашение об уровне обслуживания](https://azure.microsoft.com/en-us/support/legal/sla/) описываются обязательства корпорации Майкрософт в отношении доступности и подключения. Если соглашение об уровне ОБСЛУЖИВАНИЯ для конкретной службы составляет 99,9%, следует ожидать, служба будет доступна 99,9% времени. Разные службы используют разные соглашения об уровне обслуживания.

Соглашение об уровне ОБСЛУЖИВАНИЯ Azure также включены положения о получении кредита на службу, если соглашение об уровне ОБСЛУЖИВАНИЯ не выполняются, а также конкретные определения *доступности* для каждой службы. Этот аспект SLA действует как политика принудительного применения.

### <a name="composite-slas"></a>Составные соглашения об уровне обслуживания

*Составные соглашения об уровне обслуживания* задействовать несколько служб, которые поддерживает приложение, каждый с разным уровнем доступности. Например рассмотрим веб-приложение службы приложений, который записывает в базу данных SQL Azure. На момент написания статьи эти службы Azure имеют следующие соглашения об уровне обслуживания:

- Веб-приложениях службы приложений — 99,95%
- База данных SQL — 99,99 %.

Каково максимальное время простоя, ожидаемое для этого приложения? Если какая-либо из служб завершается ошибкой, приложение также прекращает работу. Вероятность сбоя каждой службы независима, поэтому составное SLA для этого приложения составляет 99,95% × 99,99% = 99,94%. Это ниже, чем отдельные SLA, что не удивительно, так как приложение, которое зависит от нескольких служб имеет больше потенциальных точек отказа.

Составное SLA можно усовершенствовать, создав независимые резервные пути. Например, если база данных SQL недоступна, поместите транзакции в очереди для последующей обработки.

![Составное соглашение об уровне обслуживания](_images/composite-sla.png)

При такой структуре приложение по-прежнему доступно, даже если оно не может подключиться к базе данных. Тем не менее, оно завершится сбоем, если одновременно произойдет сбой базы данных и очереди. Ожидаемый процент времени для одновременного сбоя является 0,0001 × 0,001, поэтому составное SLA для этого комбинированного пути:

- База данных *или* очередь = 1,0 − (0,0001 × 0,001) = 99,99999%

Общий уровень SLA:

- Веб-приложения *и* (база данных *или* очереди) = 99,95% x 99,99999% = \~99,95%

Не лишен недостатков этого подхода. Логика приложения сложнее, вы платите за очереди и необходимо учитывать проблемы согласованности данных.

### <a name="slas-for-multiregion-deployments"></a>Соглашения об уровне обслуживания для развертываний в нескольких регионах

*Соглашения об уровне обслуживания для развертываний в нескольких регионах* включают в себя методика высокого уровня доступности развернуть приложение в нескольких регионах и использовать диспетчер трафика Azure для отработки отказа при сбое приложения в одном регионе.

Для развертывания нескольких регионах составное SLA рассчитывается следующим образом:

- *N* является составное SLA для приложения, развернутого в одном регионе.
- *R* является количество регионов, где развернуто приложение.

Ожидаемая вероятность того, происходит сбой приложения во всех регионах, в то же время является ((1 − N) \^ R). Например, если в одном регионе соглашение об уровне ОБСЛУЖИВАНИЯ — 99,95%:

- Объединенный соглашение об уровне ОБСЛУЖИВАНИЯ для двух регионов = (− 1 (1 − 0.9995) \^ 2) = 99.999975%
- Объединенный соглашение об уровне ОБСЛУЖИВАНИЯ для четырех регионах = (− 1 (1 − 0.9995) \^ 4) = 99.999999%

[Соглашение об уровне ОБСЛУЖИВАНИЯ для диспетчера трафика](https://azure.microsoft.com/en-us/support/legal/sla/traffic-manager/v1_0/) также является фактором. Отработка отказа не происходит мгновенно в активно пассивной конфигурации, которые могут привести к простою во время отработки отказа. См. в разделе [мониторинг конечных точек диспетчера трафика](/azure/traffic-manager/traffic-manager-monitoring).

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Архитектор для обеспечения устойчивости и доступности](./architect.md)
