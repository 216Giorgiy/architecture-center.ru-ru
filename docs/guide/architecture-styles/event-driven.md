---
title: Стиль архитектуры, управляемой событиями
titleSuffix: Azure Application Architecture Guide
description: В этой статье описаны преимущества и проблемы, связанные с управляемой событиями архитектурой и архитектурой Интернета вещей в Azure, а также приведены рекомендации по работе с ними
author: MikeWasson
ms.date: 08/30/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seojan19
ms.openlocfilehash: b83a919e4ccd41d20b508b10604365a0b4ca90af
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54485480"
---
# <a name="event-driven-architecture-style"></a><span data-ttu-id="b35a2-103">Стиль архитектуры, управляемой событиями</span><span class="sxs-lookup"><span data-stu-id="b35a2-103">Event-driven architecture style</span></span>

<span data-ttu-id="b35a2-104">Управляемая событиями архитектура включает **поставщики событий**, которые создают потоки событий, и **потребители событий**, которые прослушивают эти события.</span><span class="sxs-lookup"><span data-stu-id="b35a2-104">An event-driven architecture consists of **event producers** that generate a stream of events, and **event consumers** that listen for the events.</span></span>

![Схема архитектуры, управляемой событиями](./images/event-driven.svg)

<span data-ttu-id="b35a2-106">События доставляются практически мгновенно, что позволяет потребителям немедленно реагировать на происходящие события.</span><span class="sxs-lookup"><span data-stu-id="b35a2-106">Events are delivered in near real time, so consumers can respond immediately to events as they occur.</span></span> <span data-ttu-id="b35a2-107">Поставщики не связаны с потребителями — ни один поставщик не знает, кто прослушивает его события.</span><span class="sxs-lookup"><span data-stu-id="b35a2-107">Producers are decoupled from consumers &mdash; a producer doesn't know which consumers are listening.</span></span> <span data-ttu-id="b35a2-108">Потребители также не зависят друг от друга, и каждый из них получает все события.</span><span class="sxs-lookup"><span data-stu-id="b35a2-108">Consumers are also decoupled from each other, and every consumer sees all of the events.</span></span> <span data-ttu-id="b35a2-109">Это важное отличие от шаблона [конкурирующих клиентов][competing-consumers], в котором пользователи извлекают сообщения из очереди, и каждое сообщение обрабатывается только один раз (если не возникает ошибок).</span><span class="sxs-lookup"><span data-stu-id="b35a2-109">This differs from a [Competing Consumers][competing-consumers] pattern, where consumers pull messages from a queue and a message is processed just once (assuming no errors).</span></span> <span data-ttu-id="b35a2-110">В некоторых системах, таких как Интернет вещей, события обрабатываются в огромных объемах.</span><span class="sxs-lookup"><span data-stu-id="b35a2-110">In some systems, such as IoT, events must be ingested at very high volumes.</span></span>

<span data-ttu-id="b35a2-111">В основе управляемой событиями архитектуры может лежать модель публикации и подписки или модель потока событий.</span><span class="sxs-lookup"><span data-stu-id="b35a2-111">An event driven architecture can use a pub/sub model or an event stream model.</span></span>

- <span data-ttu-id="b35a2-112">**Публикация и подписка**. Инфраструктура обмена сообщениями поддерживает список подписок.</span><span class="sxs-lookup"><span data-stu-id="b35a2-112">**Pub/sub**: The messaging infrastructure keeps track of subscriptions.</span></span> <span data-ttu-id="b35a2-113">Каждое публикуемое событие отправляется каждому подписчику.</span><span class="sxs-lookup"><span data-stu-id="b35a2-113">When an event is published, it sends the event to each subscriber.</span></span> <span data-ttu-id="b35a2-114">Полученное сообщение нельзя воспроизвести повторно. Также оно не доставляется тем подписчикам, которые добавляются позднее.</span><span class="sxs-lookup"><span data-stu-id="b35a2-114">After an event is received, it cannot be replayed, and new subscribers do not see the event.</span></span>

- <span data-ttu-id="b35a2-115">**Потоковая передача событий**. Все события записываются в журнал.</span><span class="sxs-lookup"><span data-stu-id="b35a2-115">**Event streaming**: Events are written to a log.</span></span> <span data-ttu-id="b35a2-116">События в пределах каждой секции строго упорядочены и сохраняются в течение долгого времени.</span><span class="sxs-lookup"><span data-stu-id="b35a2-116">Events are strictly ordered (within a partition) and durable.</span></span> <span data-ttu-id="b35a2-117">Клиенты не подписываются на поток, а просто считывают события из любой его части.</span><span class="sxs-lookup"><span data-stu-id="b35a2-117">Clients don't subscribe to the stream, instead a client can read from any part of the stream.</span></span> <span data-ttu-id="b35a2-118">Каждый клиент самостоятельно управляет своим положением в потоке.</span><span class="sxs-lookup"><span data-stu-id="b35a2-118">The client is responsible for advancing its position in the stream.</span></span> <span data-ttu-id="b35a2-119">Это означает, что клиент может подключиться в любое время и (или) прослушать события повторно.</span><span class="sxs-lookup"><span data-stu-id="b35a2-119">That means a client can join at any time, and can replay events.</span></span>

<span data-ttu-id="b35a2-120">На стороне получателя есть несколько распространенных вариантов реализации.</span><span class="sxs-lookup"><span data-stu-id="b35a2-120">On the consumer side, there are some common variations:</span></span>

- <span data-ttu-id="b35a2-121">**Обработка простых событий**.</span><span class="sxs-lookup"><span data-stu-id="b35a2-121">**Simple event processing**.</span></span> <span data-ttu-id="b35a2-122">Каждое событие немедленно запускает действие в объекте-получателе.</span><span class="sxs-lookup"><span data-stu-id="b35a2-122">An event immediately triggers an action in the consumer.</span></span> <span data-ttu-id="b35a2-123">Например, в Функциях Azure можно создать триггер служебной шины, который будет выполнять некоторую функцию при каждой публикации сообщения в определенном разделе служебной шины.</span><span class="sxs-lookup"><span data-stu-id="b35a2-123">For example, you could use Azure Functions with a Service Bus trigger, so that a function executes whenever a message is published to a Service Bus topic.</span></span>

- <span data-ttu-id="b35a2-124">**Обработка сложных событий**.</span><span class="sxs-lookup"><span data-stu-id="b35a2-124">**Complex event processing**.</span></span> <span data-ttu-id="b35a2-125">Объект-получатель обрабатывает последовательность событий и отслеживает в них определенные закономерности с помощью некоторого технологического решения, например Azure Stream Analytics или Apache Storm.</span><span class="sxs-lookup"><span data-stu-id="b35a2-125">A consumer processes a series of events, looking for patterns in the event data, using a technology such as Azure Stream Analytics or Apache Storm.</span></span> <span data-ttu-id="b35a2-126">Например, можно выполнять статистическую обработку показаний встроенного устройства за некоторый период времени, чтобы создавать уведомления, когда скользящее среднее значение выходит за определенные пороговые значения.</span><span class="sxs-lookup"><span data-stu-id="b35a2-126">For example, you could aggregate readings from an embedded device over a time window, and generate a notification if the moving average crosses a certain threshold.</span></span>

- <span data-ttu-id="b35a2-127">**Обработка потока событий**.</span><span class="sxs-lookup"><span data-stu-id="b35a2-127">**Event stream processing**.</span></span> <span data-ttu-id="b35a2-128">Платформу потоковой передачи данных, например Центр Интернета вещей Azure или Apache Kafka, можно использовать как конвейер для приема событий и передачи их в обработчики потоков.</span><span class="sxs-lookup"><span data-stu-id="b35a2-128">Use a data streaming platform, such as Azure IoT Hub or Apache Kafka, as a pipeline to ingest events and feed them to stream processors.</span></span> <span data-ttu-id="b35a2-129">Обработчики потоков определенным образом реагируют на эти процессы или преобразовывают поток.</span><span class="sxs-lookup"><span data-stu-id="b35a2-129">The stream processors act to process or transform the stream.</span></span> <span data-ttu-id="b35a2-130">Может существовать несколько обработчиков потока для разных подсистем приложения.</span><span class="sxs-lookup"><span data-stu-id="b35a2-130">There may be multiple stream processors for different subsystems of the application.</span></span> <span data-ttu-id="b35a2-131">Такой подход хорошо подходит для рабочих нагрузок Интернета вещей.</span><span class="sxs-lookup"><span data-stu-id="b35a2-131">This approach is a good fit for IoT workloads.</span></span>

<span data-ttu-id="b35a2-132">Источник событий может находиться за пределами системы, например это могут быть физические устройства в решении Интернета вещей.</span><span class="sxs-lookup"><span data-stu-id="b35a2-132">The source of the events may be external to the system, such as physical devices in an IoT solution.</span></span> <span data-ttu-id="b35a2-133">В такой ситуации система должна поддерживать прием данных в таких объемах и на такой скорости, которые соответствуют характеристикам источника данных.</span><span class="sxs-lookup"><span data-stu-id="b35a2-133">In that case, the system must be able to ingest the data at the volume and throughput that is required by the data source.</span></span>

<span data-ttu-id="b35a2-134">На представленной выше логической схеме каждый тип потребителя обозначен отдельным блоком.</span><span class="sxs-lookup"><span data-stu-id="b35a2-134">In the logical diagram above, each type of consumer is shown as a single box.</span></span> <span data-ttu-id="b35a2-135">На практике обычно используется несколько экземпляров каждого поставщика, чтобы они не становились единой точкой отказа.</span><span class="sxs-lookup"><span data-stu-id="b35a2-135">In practice, it's common to have multiple instances of a consumer, to avoid having the consumer become a single point of failure in system.</span></span> <span data-ttu-id="b35a2-136">Наличие нескольких экземпляров также может требоваться для обработки событий в нужных объемах и (или) с нужной скоростью.</span><span class="sxs-lookup"><span data-stu-id="b35a2-136">Multiple instances might also be necessary to handle the volume and frequency of events.</span></span> <span data-ttu-id="b35a2-137">Кроме того, каждый объект-получатель может обрабатывать события в нескольких потоках.</span><span class="sxs-lookup"><span data-stu-id="b35a2-137">Also, a single consumer might process events on multiple threads.</span></span> <span data-ttu-id="b35a2-138">Это вызывает определенные сложности, если события должны обрабатываться в строгом порядке или строго один раз.</span><span class="sxs-lookup"><span data-stu-id="b35a2-138">This can create challenges if events must be processed in order, or require exactly-once semantics.</span></span> <span data-ttu-id="b35a2-139">См. руководство по [минимизации координации][minimize-coordination].</span><span class="sxs-lookup"><span data-stu-id="b35a2-139">See [Minimize Coordination][minimize-coordination].</span></span>

## <a name="when-to-use-this-architecture"></a><span data-ttu-id="b35a2-140">Когда следует использовать эту архитектуру</span><span class="sxs-lookup"><span data-stu-id="b35a2-140">When to use this architecture</span></span>

- <span data-ttu-id="b35a2-141">Для обработки одних и тех же событий несколькими подсистемами.</span><span class="sxs-lookup"><span data-stu-id="b35a2-141">Multiple subsystems must process the same events.</span></span>
- <span data-ttu-id="b35a2-142">Для обработки в режиме реального времени, с минимальными задержками.</span><span class="sxs-lookup"><span data-stu-id="b35a2-142">Real-time processing with minimum time lag.</span></span>
- <span data-ttu-id="b35a2-143">Для обработки сложных событий, например сопоставления шаблонов или статистической обработки за некоторый период.</span><span class="sxs-lookup"><span data-stu-id="b35a2-143">Complex event processing, such as pattern matching or aggregation over time windows.</span></span>
- <span data-ttu-id="b35a2-144">При больших объемах и скоростях поступления данных, например в Интернете вещей.</span><span class="sxs-lookup"><span data-stu-id="b35a2-144">High volume and high velocity of data, such as IoT.</span></span>

## <a name="benefits"></a><span data-ttu-id="b35a2-145">Преимущества</span><span class="sxs-lookup"><span data-stu-id="b35a2-145">Benefits</span></span>

- <span data-ttu-id="b35a2-146">Отправители и получатели независимы друг от друга.</span><span class="sxs-lookup"><span data-stu-id="b35a2-146">Producers and consumers are decoupled.</span></span>
- <span data-ttu-id="b35a2-147">Нет требуется интеграция "от точки к точке".</span><span class="sxs-lookup"><span data-stu-id="b35a2-147">No point-to point-integrations.</span></span> <span data-ttu-id="b35a2-148">Очень легко добавлять в систему новые объекты-получатели.</span><span class="sxs-lookup"><span data-stu-id="b35a2-148">It's easy to add new consumers to the system.</span></span>
- <span data-ttu-id="b35a2-149">Объекты-получатели могут реагировать на события сразу при их поступлении.</span><span class="sxs-lookup"><span data-stu-id="b35a2-149">Consumers can respond to events immediately as they arrive.</span></span>
- <span data-ttu-id="b35a2-150">Высокая масштабируемость и распределение.</span><span class="sxs-lookup"><span data-stu-id="b35a2-150">Highly scalable and distributed.</span></span>
- <span data-ttu-id="b35a2-151">Подсистемы получают независимые представления потока событий.</span><span class="sxs-lookup"><span data-stu-id="b35a2-151">Subsystems have independent views of the event stream.</span></span>

## <a name="challenges"></a><span data-ttu-id="b35a2-152">Сложности</span><span class="sxs-lookup"><span data-stu-id="b35a2-152">Challenges</span></span>

- <span data-ttu-id="b35a2-153">Гарантированная доставка.</span><span class="sxs-lookup"><span data-stu-id="b35a2-153">Guaranteed delivery.</span></span> <span data-ttu-id="b35a2-154">В некоторых системах, особенно в среде Интернета вещей, важно гарантировать доставку событий.</span><span class="sxs-lookup"><span data-stu-id="b35a2-154">In some systems, especially in IoT scenarios, it's crucial to guarantee that events are delivered.</span></span>
- <span data-ttu-id="b35a2-155">Обработка событий в строгом порядке и (или) строго один раз.</span><span class="sxs-lookup"><span data-stu-id="b35a2-155">Processing events in order or exactly once.</span></span> <span data-ttu-id="b35a2-156">Каждый тип потребителя обычно выполняется на нескольких экземплярах, чтобы обеспечить надежность и масштабируемость.</span><span class="sxs-lookup"><span data-stu-id="b35a2-156">Each consumer type typically runs in multiple instances, for resiliency and scalability.</span></span> <span data-ttu-id="b35a2-157">Это создает некоторые трудности, если события должны обрабатываться в строгом порядке (для каждого типа потребителя) или логика их обработки не является идемпотентной.</span><span class="sxs-lookup"><span data-stu-id="b35a2-157">This can create a challenge if the events must be processed in order (within a consumer type), or if the processing logic is not idempotent.</span></span>

 <!-- links -->

[competing-consumers]: ../../patterns/competing-consumers.md
[minimize-coordination]: ../design-principles/minimize-coordination.md
