---
title: Стиль архитектуры микрослужб
description: В этой статье описываются преимущества и недостатки архитектур микрослужб в Azure, а также рекомендации по работе с ними.
author: MikeWasson
ms.date: 08/30/2018
ms.openlocfilehash: fb23ac3e408f3a202d925a1bf684bc30d423f218
ms.sourcegitcommit: ae8a1de6f4af7a89a66a8339879843d945201f85
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/31/2018
ms.locfileid: "43325449"
---
# <a name="microservices-architecture-style"></a><span data-ttu-id="e751c-103">Стиль архитектуры микрослужб</span><span class="sxs-lookup"><span data-stu-id="e751c-103">Microservices architecture style</span></span>

<span data-ttu-id="e751c-104">Архитектура микрослужб представляет собой набор небольших автономных служб.</span><span class="sxs-lookup"><span data-stu-id="e751c-104">A microservices architecture consists of a collection of small, autonomous services.</span></span> <span data-ttu-id="e751c-105">Каждая служба является самодостаточной и должна реализовывать возможности одной компании.</span><span class="sxs-lookup"><span data-stu-id="e751c-105">Each service is self-contained and should implement a single business capability.</span></span> <span data-ttu-id="e751c-106">Подробное руководство по разработке архитектуры микрослужб в Azure см. в статье [Проектирование, создание и использование микрослужб в Azure](../../microservices/index.md).</span><span class="sxs-lookup"><span data-stu-id="e751c-106">For detailed guidance about building a microservices architecture on Azure, see [Designing, building, and operating microservices on Azure](../../microservices/index.md).</span></span>

![](./images/microservices-logical.svg)
 
<span data-ttu-id="e751c-107">В каком-то смысле микрослужбы являются естественным результатом развития сервисноориентированных архитектур (SOA). Но микрослужбы и SOA отличаются.</span><span class="sxs-lookup"><span data-stu-id="e751c-107">In some ways, microservices are the natural evolution of service oriented architectures (SOA), but there are differences between microservices and SOA.</span></span> <span data-ttu-id="e751c-108">Ниже приведены определяющие характеристики микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="e751c-108">Here are some defining characteristics of a microservice:</span></span>

- <span data-ttu-id="e751c-109">Архитектура микрослужб состоит из небольших, независимых и слабо связанных между собой служб.</span><span class="sxs-lookup"><span data-stu-id="e751c-109">In a microservices architecture, services are small, independent, and loosely coupled.</span></span>

- <span data-ttu-id="e751c-110">Каждая служба является отдельной базой кода, которой может управлять небольшая команда разработчиков.</span><span class="sxs-lookup"><span data-stu-id="e751c-110">Each service is a separate codebase, which can be managed by a small development team.</span></span>

- <span data-ttu-id="e751c-111">Службы можно развертывать независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="e751c-111">Services can be deployed independently.</span></span> <span data-ttu-id="e751c-112">Разработчики могут обновлять существующую службу без повторной сборки и повторного развертывания всего приложения.</span><span class="sxs-lookup"><span data-stu-id="e751c-112">A team can update an existing service without rebuilding and redeploying the entire application.</span></span>

- <span data-ttu-id="e751c-113">Службы отвечают за сохранение собственных данных или внешнего состояния.</span><span class="sxs-lookup"><span data-stu-id="e751c-113">Services are responsible for persisting their own data or external state.</span></span> <span data-ttu-id="e751c-114">В этом состоит отличие от традиционной модели, в которой сохранение данных обрабатывается на отдельном уровне.</span><span class="sxs-lookup"><span data-stu-id="e751c-114">This differs from the traditional model, where a separate data layer handles data persistence.</span></span>

- <span data-ttu-id="e751c-115">Службы взаимодействуют между собой с помощью четко определенных API-интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="e751c-115">Services communicate with each other by using well-defined APIs.</span></span> <span data-ttu-id="e751c-116">Сведения о внутренней реализации каждой службы скрыты от других служб.</span><span class="sxs-lookup"><span data-stu-id="e751c-116">Internal implementation details of each service are hidden from other services.</span></span>

- <span data-ttu-id="e751c-117">Службы не должны совместно использовать один и тот же стек технологий, библиотеки или платформы.</span><span class="sxs-lookup"><span data-stu-id="e751c-117">Services don't need to share the same technology stack, libraries, or frameworks.</span></span>

<span data-ttu-id="e751c-118">Помимо самих служб, некоторые компоненты обладают типичной архитектурой микрослужб:</span><span class="sxs-lookup"><span data-stu-id="e751c-118">Besides for the services themselves, some other components appear in a typical microservices architecture:</span></span>

<span data-ttu-id="e751c-119">**Управление.**</span><span class="sxs-lookup"><span data-stu-id="e751c-119">**Management**.</span></span> <span data-ttu-id="e751c-120">Компонент управления отвечает за размещение служб на узлах, определение сбоев, перераспределение служб между узлами и другие операции.</span><span class="sxs-lookup"><span data-stu-id="e751c-120">The management component is responsible for placing services on nodes, identifying failures, rebalancing services across nodes, and so forth.</span></span>  

<span data-ttu-id="e751c-121">**Обнаружение служб.**</span><span class="sxs-lookup"><span data-stu-id="e751c-121">**Service Discovery**.</span></span>  <span data-ttu-id="e751c-122">Этот компонент ведет список служб и узлов, на которых находятся службы.</span><span class="sxs-lookup"><span data-stu-id="e751c-122">Maintains a list of services and which nodes they are located on.</span></span> <span data-ttu-id="e751c-123">Он поддерживает поиск в службах, позволяя найти конечную точку службы.</span><span class="sxs-lookup"><span data-stu-id="e751c-123">Enables service lookup to find the endpoint for a service.</span></span> 

<span data-ttu-id="e751c-124">**Шлюз API.**</span><span class="sxs-lookup"><span data-stu-id="e751c-124">**API Gateway**.</span></span> <span data-ttu-id="e751c-125">Шлюз API является точкой входа для клиентов.</span><span class="sxs-lookup"><span data-stu-id="e751c-125">The API gateway is the entry point for clients.</span></span> <span data-ttu-id="e751c-126">Клиенты не вызывают службы напрямую.</span><span class="sxs-lookup"><span data-stu-id="e751c-126">Clients don't call services directly.</span></span> <span data-ttu-id="e751c-127">Вместо этого они вызывают шлюз API, который пересылает вызов соответствующим службам в серверной части.</span><span class="sxs-lookup"><span data-stu-id="e751c-127">Instead, they call the API gateway, which forwards the call to the appropriate services on the back end.</span></span> <span data-ttu-id="e751c-128">Шлюз API может собирать ответы от нескольких служб и возвращать совокупный ответ.</span><span class="sxs-lookup"><span data-stu-id="e751c-128">The API gateway might aggregate the responses from several services and return the aggregated response.</span></span> 

<span data-ttu-id="e751c-129">Преимущества использования API шлюза:</span><span class="sxs-lookup"><span data-stu-id="e751c-129">The advantages of using an API gateway include:</span></span>

- <span data-ttu-id="e751c-130">Он разделяет клиенты и службы.</span><span class="sxs-lookup"><span data-stu-id="e751c-130">It decouples clients from services.</span></span> <span data-ttu-id="e751c-131">Можно управлять версиями служб и выполнять их рефакторинг без обновления всех клиентов.</span><span class="sxs-lookup"><span data-stu-id="e751c-131">Services can be versioned or refactored without needing to update all of the clients.</span></span>

-  <span data-ttu-id="e751c-132">Службы могут использовать протоколы обмена сообщениями, которые не работают в Интернете, например AMQP.</span><span class="sxs-lookup"><span data-stu-id="e751c-132">Services can use messaging protocols that are not web friendly, such as AMQP.</span></span>

- <span data-ttu-id="e751c-133">Шлюз API может выполнять другие сквозные функции, например аутентификацию, ведение журнала, завершение запросов SSL и балансировку нагрузки.</span><span class="sxs-lookup"><span data-stu-id="e751c-133">The API Gateway can perform other cross-cutting functions such as authentication, logging, SSL termination, and load balancing.</span></span>

## <a name="when-to-use-this-architecture"></a><span data-ttu-id="e751c-134">Когда следует использовать эту архитектуру</span><span class="sxs-lookup"><span data-stu-id="e751c-134">When to use this architecture</span></span>

<span data-ttu-id="e751c-135">Используйте эту архитектуру для следующих сценариев:</span><span class="sxs-lookup"><span data-stu-id="e751c-135">Consider this architecture style for:</span></span>

- <span data-ttu-id="e751c-136">крупные приложения, для которых требуется выпуск на высокой скорости;</span><span class="sxs-lookup"><span data-stu-id="e751c-136">Large applications that require a high release velocity.</span></span>

- <span data-ttu-id="e751c-137">сложные приложения, которым нужна высокая степень масштабируемости;</span><span class="sxs-lookup"><span data-stu-id="e751c-137">Complex applications that need to be highly scalable.</span></span>

- <span data-ttu-id="e751c-138">приложения с так называемыми "толстыми" доменами или большим количеством поддоменов;</span><span class="sxs-lookup"><span data-stu-id="e751c-138">Applications with rich domains or many subdomains.</span></span>

- <span data-ttu-id="e751c-139">организация, состоящая из небольших команд разработчиков.</span><span class="sxs-lookup"><span data-stu-id="e751c-139">An organization that consists of small development teams.</span></span>


## <a name="benefits"></a><span data-ttu-id="e751c-140">Преимущества</span><span class="sxs-lookup"><span data-stu-id="e751c-140">Benefits</span></span> 

- <span data-ttu-id="e751c-141">**Независимые развертывания.**</span><span class="sxs-lookup"><span data-stu-id="e751c-141">**Independent deployments**.</span></span> <span data-ttu-id="e751c-142">Вы можете обновить службу без повторного развертывания всего приложения, а также выполнить откат или накат обновления, если что-то работает неправильно.</span><span class="sxs-lookup"><span data-stu-id="e751c-142">You can update a service without redeploying the entire application, and roll back or roll forward an update if something goes wrong.</span></span> <span data-ttu-id="e751c-143">Исправления ошибок и выпуски компонентов лучше поддаются управлению и в меньшей степени сопряжены с рисками.</span><span class="sxs-lookup"><span data-stu-id="e751c-143">Bug fixes and feature releases are more manageable and less risky.</span></span>

- <span data-ttu-id="e751c-144">**Независимая разработка.**</span><span class="sxs-lookup"><span data-stu-id="e751c-144">**Independent development**.</span></span> <span data-ttu-id="e751c-145">Одна команда разработчиков может выполнить сборку, тестирование и развертывание службы.</span><span class="sxs-lookup"><span data-stu-id="e751c-145">A single development team can build, test, and deploy a service.</span></span> <span data-ttu-id="e751c-146">Это позволяет непрерывно внедрять инновации и быстрее выпускать службы.</span><span class="sxs-lookup"><span data-stu-id="e751c-146">The result is continuous innovation and a faster release cadence.</span></span> 

- <span data-ttu-id="e751c-147">**Небольшие специализированные команды.**</span><span class="sxs-lookup"><span data-stu-id="e751c-147">**Small, focused teams**.</span></span> <span data-ttu-id="e751c-148">Команда может сосредоточиться на одной службе.</span><span class="sxs-lookup"><span data-stu-id="e751c-148">Teams can focus on one service.</span></span> <span data-ttu-id="e751c-149">Чем меньше объем каждой службы, тем проще понять ее базу кода и тем легче будет его освоить новым членам команды.</span><span class="sxs-lookup"><span data-stu-id="e751c-149">The smaller scope of each service makes the code base easier to understand, and it's easier for new team members to ramp up.</span></span>

- <span data-ttu-id="e751c-150">**Изоляция ошибок.**</span><span class="sxs-lookup"><span data-stu-id="e751c-150">**Fault isolation**.</span></span> <span data-ttu-id="e751c-151">Если одна служба выходит из строя, приложение продолжает работать.</span><span class="sxs-lookup"><span data-stu-id="e751c-151">If a service goes down, it won't take out the entire application.</span></span> <span data-ttu-id="e751c-152">Но это не означает, что такая устойчивость доступна по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="e751c-152">However, that doesn't mean you get resiliency for free.</span></span> <span data-ttu-id="e751c-153">Вам необходимо соблюдать рекомендации по обеспечению устойчивости и следовать конструктивным шаблонам.</span><span class="sxs-lookup"><span data-stu-id="e751c-153">You still need to follow resiliency best practices and design patterns.</span></span> <span data-ttu-id="e751c-154">См. статью о [проектировании устойчивых приложений для Azure][resiliency-overview].</span><span class="sxs-lookup"><span data-stu-id="e751c-154">See [Designing resilient applications for Azure][resiliency-overview].</span></span>

- <span data-ttu-id="e751c-155">**Стеки смешанных технологий.**</span><span class="sxs-lookup"><span data-stu-id="e751c-155">**Mixed technology stacks**.</span></span> <span data-ttu-id="e751c-156">Команды могут выбрать технологию, которая лучше всего подходит их службе.</span><span class="sxs-lookup"><span data-stu-id="e751c-156">Teams can pick the technology that best fits their service.</span></span> 

- <span data-ttu-id="e751c-157">**Детальное масштабирование.**</span><span class="sxs-lookup"><span data-stu-id="e751c-157">**Granular scaling**.</span></span> <span data-ttu-id="e751c-158">Службы можно масштабировать независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="e751c-158">Services can be scaled independently.</span></span> <span data-ttu-id="e751c-159">В то же время из-за более высокой плотности служб на одной виртуальной машине ее ресурсы будут полностью использованы.</span><span class="sxs-lookup"><span data-stu-id="e751c-159">At the same time, the higher density of services per VM means that VM resources are fully utilized.</span></span> <span data-ttu-id="e751c-160">Благодаря ограничениям размещения службы можно привести в соответствие с профилем виртуальной машины (высокая загрузка ЦП, большой объем памяти и т. д.).</span><span class="sxs-lookup"><span data-stu-id="e751c-160">Using placement constraints, a services can be matched to a VM profile (high CPU, high memory, and so on).</span></span>

## <a name="challenges"></a><span data-ttu-id="e751c-161">Сложности</span><span class="sxs-lookup"><span data-stu-id="e751c-161">Challenges</span></span>

- <span data-ttu-id="e751c-162">**Сложность.**</span><span class="sxs-lookup"><span data-stu-id="e751c-162">**Complexity**.</span></span> <span data-ttu-id="e751c-163">Приложение для микрослужб содержит больше перемещаемых частей, чем эквивалентное монолитное приложение.</span><span class="sxs-lookup"><span data-stu-id="e751c-163">A microservices application has more moving parts than the equivalent monolithic application.</span></span> <span data-ttu-id="e751c-164">Каждая служба является простой структурой, но вся система в целом гораздо сложнее.</span><span class="sxs-lookup"><span data-stu-id="e751c-164">Each service is simpler, but the entire system as a whole is more complex.</span></span>

- <span data-ttu-id="e751c-165">**Разработка и тестирование.**</span><span class="sxs-lookup"><span data-stu-id="e751c-165">**Development and test**.</span></span> <span data-ttu-id="e751c-166">Разработка с учетом зависимостей между службами требует другого подхода.</span><span class="sxs-lookup"><span data-stu-id="e751c-166">Developing against service dependencies requires a different approach.</span></span> <span data-ttu-id="e751c-167">Существующие средства не всегда предназначены для работы с зависимостями служб.</span><span class="sxs-lookup"><span data-stu-id="e751c-167">Existing tools are not necessarily designed to work with service dependencies.</span></span> <span data-ttu-id="e751c-168">Рефакторинг между службами может быть сложной задачей.</span><span class="sxs-lookup"><span data-stu-id="e751c-168">Refactoring across service boundaries can be difficult.</span></span> <span data-ttu-id="e751c-169">Также непросто тестировать зависимости служб, особенно если приложение быстро изменяется.</span><span class="sxs-lookup"><span data-stu-id="e751c-169">It is also challenging to test service dependencies, especially when the application is evolving quickly.</span></span>

- <span data-ttu-id="e751c-170">**Недостаток управления.**</span><span class="sxs-lookup"><span data-stu-id="e751c-170">**Lack of governance**.</span></span> <span data-ttu-id="e751c-171">Децентрализованный подход к созданию микрослужб имеет свои преимущества, но он также может привести к проблемам.</span><span class="sxs-lookup"><span data-stu-id="e751c-171">The decentralized approach to building microservices has advantages, but it can also lead to problems.</span></span> <span data-ttu-id="e751c-172">В приложении может появиться так много разных языков и платформ, что его будет трудно обслуживать.</span><span class="sxs-lookup"><span data-stu-id="e751c-172">You may end up with so many different languages and frameworks that the application becomes hard to maintain.</span></span> <span data-ttu-id="e751c-173">Можно попробовать установить некоторые стандарты для всего проекта, не ограничивая чрезмерно гибкость разработчиков.</span><span class="sxs-lookup"><span data-stu-id="e751c-173">It may be useful to put some project-wide standards in place, without overly restricting teams' flexibility.</span></span> <span data-ttu-id="e751c-174">В частности, это касается сквозных функций, таких как ведение журнала.</span><span class="sxs-lookup"><span data-stu-id="e751c-174">This especially applies to cross-cutting functionality such as logging.</span></span>

- <span data-ttu-id="e751c-175">**Перегрузки и задержки сети.**</span><span class="sxs-lookup"><span data-stu-id="e751c-175">**Network congestion and latency**.</span></span> <span data-ttu-id="e751c-176">Использование большого количества мелких детальных служб может привести к интенсивному взаимодействию между ними.</span><span class="sxs-lookup"><span data-stu-id="e751c-176">The use of many small, granular services can result in more interservice communication.</span></span> <span data-ttu-id="e751c-177">Кроме того, если цепочка зависимостей службы становится слишком длинной (служба A вызывает службу B, которая вызывает службу C и так далее), дополнительная задержка может стать проблемой.</span><span class="sxs-lookup"><span data-stu-id="e751c-177">Also, if the chain of service dependencies gets too long (service A calls B, which calls C...), the additional latency can become a problem.</span></span> <span data-ttu-id="e751c-178">Необходимо тщательно разрабатывать API-интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="e751c-178">You will need to design APIs carefully.</span></span> <span data-ttu-id="e751c-179">Не создавайте API-интерфейсы, которые отправляют слишком много сообщений, и найдите места, в которых можно использовать асинхронные модели связи.</span><span class="sxs-lookup"><span data-stu-id="e751c-179">Avoid overly chatty APIs, think about serialization formats, and look for places to use asynchronous communication patterns.</span></span>

- <span data-ttu-id="e751c-180">**Целостность данных.**</span><span class="sxs-lookup"><span data-stu-id="e751c-180">**Data integrity**.</span></span> <span data-ttu-id="e751c-181">Каждая микрослужба отвечает за сохранение своих данных.</span><span class="sxs-lookup"><span data-stu-id="e751c-181">With each microservice responsible for its own data persistence.</span></span> <span data-ttu-id="e751c-182">Поэтому может быть сложно поддерживать согласованность данных.</span><span class="sxs-lookup"><span data-stu-id="e751c-182">As a result, data consistency can be a challenge.</span></span> <span data-ttu-id="e751c-183">Применяйте итоговую согласованность, где это возможно.</span><span class="sxs-lookup"><span data-stu-id="e751c-183">Embrace eventual consistency where possible.</span></span>

- <span data-ttu-id="e751c-184">**Управление.**</span><span class="sxs-lookup"><span data-stu-id="e751c-184">**Management**.</span></span> <span data-ttu-id="e751c-185">Для успешной работы с микрослужбами требуется современная культура DevOps.</span><span class="sxs-lookup"><span data-stu-id="e751c-185">To be successful with microservices requires a mature DevOps culture.</span></span> <span data-ttu-id="e751c-186">Коррелированное ведение журнала для разных служб может оказаться сложной задачей.</span><span class="sxs-lookup"><span data-stu-id="e751c-186">Correlated logging across services can be challenging.</span></span> <span data-ttu-id="e751c-187">Как правило, ведение журнала необходимо коррелировать с несколькими вызовами службы для одной операции пользователя.</span><span class="sxs-lookup"><span data-stu-id="e751c-187">Typically, logging must correlate multiple service calls for a single user operation.</span></span>

- <span data-ttu-id="e751c-188">**Управление версиями.**</span><span class="sxs-lookup"><span data-stu-id="e751c-188">**Versioning**.</span></span> <span data-ttu-id="e751c-189">Обновления службы не должны нарушать работу служб, зависящих от нее.</span><span class="sxs-lookup"><span data-stu-id="e751c-189">Updates to a service must not break services that depend on it.</span></span> <span data-ttu-id="e751c-190">Несколько служб могут обновляться в любой момент времени, поэтому без тщательного планирования могут возникнуть проблемы с обратной или прямой совместимостью.</span><span class="sxs-lookup"><span data-stu-id="e751c-190">Multiple services could be updated at any given time, so without careful design, you might have problems with backward or forward compatibility.</span></span>

- <span data-ttu-id="e751c-191">**Набор навыков.**</span><span class="sxs-lookup"><span data-stu-id="e751c-191">**Skillset**.</span></span> <span data-ttu-id="e751c-192">Микрослужбы являются распределенными системами.</span><span class="sxs-lookup"><span data-stu-id="e751c-192">Microservices are highly distributed systems.</span></span> <span data-ttu-id="e751c-193">Тщательно оцените знания и опыт своей команды для работы с этими службами.</span><span class="sxs-lookup"><span data-stu-id="e751c-193">Carefully evaluate whether the team has the skills and experience to be successful.</span></span>

## <a name="best-practices"></a><span data-ttu-id="e751c-194">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="e751c-194">Best practices</span></span>

- <span data-ttu-id="e751c-195">Моделируйте службы для определенной сферы деятельности.</span><span class="sxs-lookup"><span data-stu-id="e751c-195">Model services around the business domain.</span></span> 

- <span data-ttu-id="e751c-196">Децентрализуйте все данные.</span><span class="sxs-lookup"><span data-stu-id="e751c-196">Decentralize everything.</span></span> <span data-ttu-id="e751c-197">Отдельные команды разработчиков отвечают за проектирование и создание служб.</span><span class="sxs-lookup"><span data-stu-id="e751c-197">Individual teams are responsible for designing and building services.</span></span> <span data-ttu-id="e751c-198">Избегайте совместного использования кода или схем данных.</span><span class="sxs-lookup"><span data-stu-id="e751c-198">Avoid sharing code or data schemas.</span></span> 

- <span data-ttu-id="e751c-199">Данные должны храниться в службе, к которой они относятся.</span><span class="sxs-lookup"><span data-stu-id="e751c-199">Data storage should be private to the service that owns the data.</span></span> <span data-ttu-id="e751c-200">Используйте наиболее подходящее хранилище для каждой службы и каждого типа данных.</span><span class="sxs-lookup"><span data-stu-id="e751c-200">Use the best storage for each service and data type.</span></span> 

- <span data-ttu-id="e751c-201">Службы взаимодействуют через хорошо спроектированные API-интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="e751c-201">Services communicate through well-designed APIs.</span></span> <span data-ttu-id="e751c-202">Избегайте утечки сведений о реализации.</span><span class="sxs-lookup"><span data-stu-id="e751c-202">Avoid leaking implementation details.</span></span> <span data-ttu-id="e751c-203">API-интерфейсы должны моделировать домен, а не внутреннюю реализацию службы.</span><span class="sxs-lookup"><span data-stu-id="e751c-203">APIs should model the domain, not the internal implementation of the service.</span></span>

- <span data-ttu-id="e751c-204">Избегайте взаимозависимостей между службами.</span><span class="sxs-lookup"><span data-stu-id="e751c-204">Avoid coupling between services.</span></span> <span data-ttu-id="e751c-205">Взаимозависимости могут возникать при использовании общих схем баз данных и жестких протоколов связи.</span><span class="sxs-lookup"><span data-stu-id="e751c-205">Causes of coupling include shared database schemas and rigid communication protocols.</span></span>

- <span data-ttu-id="e751c-206">Перенесите нагрузку сквозных функций, таких как аутентификация и завершение SSL-запросов, в шлюз.</span><span class="sxs-lookup"><span data-stu-id="e751c-206">Offload cross-cutting concerns, such as authentication and SSL termination, to the gateway.</span></span>

- <span data-ttu-id="e751c-207">Храните набор знаний домена за пределами шлюза.</span><span class="sxs-lookup"><span data-stu-id="e751c-207">Keep domain knowledge out of the gateway.</span></span> <span data-ttu-id="e751c-208">Шлюз должен обрабатывать и перенаправлять клиентские запросы без знания бизнес-правил или логики домена.</span><span class="sxs-lookup"><span data-stu-id="e751c-208">The gateway should handle and route client requests without any knowledge of the business rules or domain logic.</span></span> <span data-ttu-id="e751c-209">Иначе шлюз становится зависимостью и может привести к взаимозависимости между службами.</span><span class="sxs-lookup"><span data-stu-id="e751c-209">Otherwise, the gateway becomes a dependency and can cause coupling between services.</span></span>

- <span data-ttu-id="e751c-210">Службы должны иметь слабую взаимозависимость и высокую функциональную слаженность.</span><span class="sxs-lookup"><span data-stu-id="e751c-210">Services should have loose coupling and high functional cohesion.</span></span> <span data-ttu-id="e751c-211">Функции, которые, вероятно, будут изменяться одновременно, должны упаковываться и развертываться одновременно.</span><span class="sxs-lookup"><span data-stu-id="e751c-211">Functions that are likely to change together should be packaged and deployed together.</span></span> <span data-ttu-id="e751c-212">Если они находятся в отдельных службах, эти службы в конечном итоге становятся тесно связанными, потому что изменения в одной службе требуют обновления другой службы.</span><span class="sxs-lookup"><span data-stu-id="e751c-212">If they reside in separate services, those services end up being tightly coupled, because a change in one service will require updating the other service.</span></span> <span data-ttu-id="e751c-213">Слишком частый обмен данными между двумя службами может быть признаком тесной взаимозависимости и низкой слаженности.</span><span class="sxs-lookup"><span data-stu-id="e751c-213">Overly chatty communication between two services may be a symptom of tight coupling and low cohesion.</span></span> 

- <span data-ttu-id="e751c-214">Изолируйте сбои.</span><span class="sxs-lookup"><span data-stu-id="e751c-214">Isolate failures.</span></span> <span data-ttu-id="e751c-215">Используйте стратегии обеспечения устойчивости для предотвращения каскадных сбоев в службе.</span><span class="sxs-lookup"><span data-stu-id="e751c-215">Use resiliency strategies to prevent failures within a service from cascading.</span></span> <span data-ttu-id="e751c-216">См. статьи о [шаблонах устойчивости][resiliency-patterns] и [проектировании устойчивых приложений][resiliency-overview].</span><span class="sxs-lookup"><span data-stu-id="e751c-216">See [Resiliency patterns][resiliency-patterns] and [Designing resilient applications][resiliency-overview].</span></span>

## <a name="microservices-using-azure-container-service"></a><span data-ttu-id="e751c-217">Микрослужбы, использующие службу контейнеров Azure</span><span class="sxs-lookup"><span data-stu-id="e751c-217">Microservices using Azure Container Service</span></span> 

<span data-ttu-id="e751c-218">[Службу контейнеров Azure](/azure/container-service/) можно использовать для настройки и подготовки кластера Docker.</span><span class="sxs-lookup"><span data-stu-id="e751c-218">You can use [Azure Container Service](/azure/container-service/) to configure and provision a Docker cluster.</span></span> <span data-ttu-id="e751c-219">Служба контейнеров Azure поддерживает несколько популярных оркестраторов контейнеров, среди которых Kubernetes, DC/OS и Docker Swarm.</span><span class="sxs-lookup"><span data-stu-id="e751c-219">Azure Container Services supports several popular container orchestrators, including Kubernetes, DC/OS, and Docker Swarm.</span></span>

![](./images/microservices-acs.png)
 
<span data-ttu-id="e751c-220">**Общедоступные узлы.**</span><span class="sxs-lookup"><span data-stu-id="e751c-220">**Public nodes**.</span></span> <span data-ttu-id="e751c-221">Эти узлы доступны через общедоступную подсистему балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="e751c-221">These nodes are reachable through a public-facing load balancer.</span></span> <span data-ttu-id="e751c-222">Шлюз API размещается на этих узлах.</span><span class="sxs-lookup"><span data-stu-id="e751c-222">The API gateway is hosted on these nodes.</span></span>

<span data-ttu-id="e751c-223">**Узлы серверной части.**</span><span class="sxs-lookup"><span data-stu-id="e751c-223">**Backend nodes**.</span></span> <span data-ttu-id="e751c-224">На этих узлах работают службы, к которым клиенты получают доступ через шлюз API.</span><span class="sxs-lookup"><span data-stu-id="e751c-224">These nodes run services that clients reach via the API gateway.</span></span> <span data-ttu-id="e751c-225">Эти узлы не получают интернет-трафик напрямую.</span><span class="sxs-lookup"><span data-stu-id="e751c-225">These nodes don't receive Internet traffic directly.</span></span> <span data-ttu-id="e751c-226">Узлы серверной части могут включать несколько пулов виртуальных машин с различными профилями оборудования.</span><span class="sxs-lookup"><span data-stu-id="e751c-226">The backend nodes might include more than one pool of VMs, each with a different hardware profile.</span></span> <span data-ttu-id="e751c-227">Например, можно создать отдельные пулы для общих вычислительных рабочих нагрузок, рабочих нагрузок с высокой загрузкой ЦП и рабочих нагрузок с использованием большого объема памяти.</span><span class="sxs-lookup"><span data-stu-id="e751c-227">For example, you could create separate pools for general compute workloads, high CPU workloads, and high memory workloads.</span></span> 

<span data-ttu-id="e751c-228">**Виртуальные машины управления.**</span><span class="sxs-lookup"><span data-stu-id="e751c-228">**Management VMs**.</span></span> <span data-ttu-id="e751c-229">На этих виртуальных машинах работают главные узлы оркестратора контейнеров.</span><span class="sxs-lookup"><span data-stu-id="e751c-229">These VMs run the master nodes for the container orchestrator.</span></span> 

<span data-ttu-id="e751c-230">**Сеть.**</span><span class="sxs-lookup"><span data-stu-id="e751c-230">**Networking**.</span></span> <span data-ttu-id="e751c-231">Общедоступные узлы, узлы серверной части и виртуальные машины управления помещаются в отдельные подсети в пределах одной виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="e751c-231">The public nodes, backend nodes, and management VMs are placed in separate subnets within the same virtual network (VNet).</span></span> 

<span data-ttu-id="e751c-232">**Подсистемы балансировки нагрузки.**</span><span class="sxs-lookup"><span data-stu-id="e751c-232">**Load balancers**.</span></span>  <span data-ttu-id="e751c-233">Внешняя подсистема балансировки нагрузки размещается перед общедоступными узлами.</span><span class="sxs-lookup"><span data-stu-id="e751c-233">An externally facing load balancer sits in front of the public nodes.</span></span> <span data-ttu-id="e751c-234">Она распределяет запросы из Интернета к общедоступным узлам.</span><span class="sxs-lookup"><span data-stu-id="e751c-234">It distributes internet requests to the public nodes.</span></span> <span data-ttu-id="e751c-235">Другая подсистема балансировки нагрузки находится перед виртуальными машинами управления. Она пропускает безопасный трафик по протоколу Secure Shell (SSH) к этим виртуальным машинам, используя правила преобразования сетевых адресов.</span><span class="sxs-lookup"><span data-stu-id="e751c-235">Another load balancer is placed in front of the management VMs, to allow secure shell (ssh) traffic to the management VMs, using NAT rules.</span></span>

<span data-ttu-id="e751c-236">Для обеспечения надежности и масштабируемости каждая служба реплицируется на несколько виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="e751c-236">For reliability and scalability, each service is replicated across multiple VMs.</span></span> <span data-ttu-id="e751c-237">Но так как службы занимают относительно мало места (по сравнению с монолитными приложениями), несколько служб обычно размещаются на одной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="e751c-237">However, because services are also relatively lightweight (compared with a monolithic application), multiple services are usually packed into a single VM.</span></span> <span data-ttu-id="e751c-238">Высокая плотность обеспечивает эффективное использование ресурсов.</span><span class="sxs-lookup"><span data-stu-id="e751c-238">Higher density allows better resource utilization.</span></span> <span data-ttu-id="e751c-239">Если определенная служба не использует много ресурсов, не нужно выделять всю виртуальную машину для выполнения этой службы.</span><span class="sxs-lookup"><span data-stu-id="e751c-239">If a particular service doesn't use a lot of resources, you don't need to dedicate an entire VM to running that service.</span></span>

<span data-ttu-id="e751c-240">На следующей схеме показаны три узла, на которых работают четыре разные службы (они обозначены разными фигурами).</span><span class="sxs-lookup"><span data-stu-id="e751c-240">The following diagram shows three nodes running four different services (indicated by different shapes).</span></span> <span data-ttu-id="e751c-241">Обратите внимание, что каждая служба имеет по крайней мере два экземпляра.</span><span class="sxs-lookup"><span data-stu-id="e751c-241">Notice that each service has at least two instances.</span></span> 
 
![](./images/microservices-node-density.png)

## <a name="microservices-using-azure-service-fabric"></a><span data-ttu-id="e751c-242">Микрослужбы, использующие Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="e751c-242">Microservices using Azure Service Fabric</span></span>

<span data-ttu-id="e751c-243">На приведенной ниже схеме показана архитектура микрослужб с использованием [Azure Service Fabric](/azure/service-fabric/).</span><span class="sxs-lookup"><span data-stu-id="e751c-243">The following diagram shows a microservices architecture using [Azure Service Fabric](/azure/service-fabric/).</span></span>

![](./images/service-fabric.png)

<span data-ttu-id="e751c-244">Кластер Service Fabric развертывается в одном или нескольких масштабируемых наборах виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="e751c-244">The Service Fabric cluster is deployed to one or more VM scale sets.</span></span> <span data-ttu-id="e751c-245">Если вам нужны виртуальные машины разных типов, в кластере может быть несколько масштабируемых наборов виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="e751c-245">You might have more than one VM scale set in the cluster, in order to have a mix of VM types.</span></span> <span data-ttu-id="e751c-246">Шлюз API с внешней подсистемой балансировки нагрузки, которая получает запросы клиентов, помещается перед кластером Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e751c-246">An API Gateway is placed in front of the Service Fabric cluster, with an external load balancer to receive client requests.</span></span>

<span data-ttu-id="e751c-247">Среда выполнения Service Fabric управляет кластером, в том числе выполняет размещение службы, отработку отказа узла и мониторинг работоспособности.</span><span class="sxs-lookup"><span data-stu-id="e751c-247">The Service Fabric runtime performs cluster management, including service placement, node failover, and health monitoring.</span></span> <span data-ttu-id="e751c-248">Среда выполнения развертывается непосредственно на узлах кластера.</span><span class="sxs-lookup"><span data-stu-id="e751c-248">The runtime is deployed on the cluster nodes themselves.</span></span> <span data-ttu-id="e751c-249">Отдельного набора виртуальных машин для управления кластером нет.</span><span class="sxs-lookup"><span data-stu-id="e751c-249">There isn't a separate set of cluster management VMs.</span></span>

<span data-ttu-id="e751c-250">Службы взаимодействуют между собой с помощью обратного прокси-сервера, встроенного в Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e751c-250">Services communicate with each other using the reverse proxy that is built into Service Fabric.</span></span> <span data-ttu-id="e751c-251">Service Fabric предоставляет службу обнаружения, которая может разрешать конечную точку для конкретной службы.</span><span class="sxs-lookup"><span data-stu-id="e751c-251">Service Fabric provides a discovery service that can resolve the endpoint for a named service.</span></span>


<!-- links -->

[resiliency-overview]: ../../resiliency/index.md
[resiliency-patterns]: ../../patterns/category/resiliency.md



