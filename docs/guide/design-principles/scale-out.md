---
title: Разработка с учетом горизонтального масштабирования
titleSuffix: Azure Application Architecture Guide
description: Архитектура облачных приложений должна обеспечивать возможность горизонтального масштабирования.
author: MikeWasson
ms.date: 08/30/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seojan19
ms.openlocfilehash: 32ea1e7dc732c819783ad2fc06dbcffd75685d23
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54483740"
---
# <a name="design-to-scale-out"></a><span data-ttu-id="e45e0-103">Разработка с учетом горизонтального масштабирования</span><span class="sxs-lookup"><span data-stu-id="e45e0-103">Design to scale out</span></span>

## <a name="design-your-application-so-that-it-can-scale-horizontally"></a><span data-ttu-id="e45e0-104">Разработка приложения с учетом горизонтального масштабирования</span><span class="sxs-lookup"><span data-stu-id="e45e0-104">Design your application so that it can scale horizontally</span></span>

<span data-ttu-id="e45e0-105">Основное преимущество облака &mdash; это возможность эластичного масштабирования. Оно позволяет использовать строго необходимый объем ресурсов. При увеличении нагрузки приложение развертывается, а когда дополнительная мощность не требуется, возвращается к исходному масштабу.</span><span class="sxs-lookup"><span data-stu-id="e45e0-105">A primary advantage of the cloud is elastic scaling &mdash; the ability to use as much capacity as you need, scaling out as load increases, and scaling in when the extra capacity is not needed.</span></span> <span data-ttu-id="e45e0-106">Учитывайте горизонтальное масштабирование при разработке приложения, чтобы можно было добавлять и удалять его экземпляры в зависимости от нагрузки.</span><span class="sxs-lookup"><span data-stu-id="e45e0-106">Design your application so that it can scale horizontally, adding or removing new instances as demand requires.</span></span>

## <a name="recommendations"></a><span data-ttu-id="e45e0-107">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="e45e0-107">Recommendations</span></span>

<span data-ttu-id="e45e0-108">**Избегайте закрепления экземпляров.**</span><span class="sxs-lookup"><span data-stu-id="e45e0-108">**Avoid instance stickiness**.</span></span> <span data-ttu-id="e45e0-109">Закрепление экземпляров, или *сходство сеансов*, означает ситуацию, в которой запросы от конкретного клиента всегда направляются к одному и тому же серверу.</span><span class="sxs-lookup"><span data-stu-id="e45e0-109">Stickiness, or *session affinity*, is when requests from the same client are always routed to the same server.</span></span> <span data-ttu-id="e45e0-110">Закрепление ограничивает возможность горизонтального масштабирования приложения. Например, трафик от наиболее активных пользователей не удастся распределить между несколькими экземплярами.</span><span class="sxs-lookup"><span data-stu-id="e45e0-110">Stickiness limits the application's ability to scale out. For example, traffic from a high-volume user will not be distributed across instances.</span></span> <span data-ttu-id="e45e0-111">Закрепление возникает по разным причинам, например при сохранении в памяти сведений о состоянии сеанса или при шифровании с использованием ключей конкретного компьютера.</span><span class="sxs-lookup"><span data-stu-id="e45e0-111">Causes of stickiness include storing session state in memory, and using machine-specific keys for encryption.</span></span> <span data-ttu-id="e45e0-112">Следите за тем, чтобы любой экземпляр приложения всегда мог обработать любой запрос.</span><span class="sxs-lookup"><span data-stu-id="e45e0-112">Make sure that any instance can handle any request.</span></span>

<span data-ttu-id="e45e0-113">**Выявляйте узкие места.**</span><span class="sxs-lookup"><span data-stu-id="e45e0-113">**Identify bottlenecks**.</span></span> <span data-ttu-id="e45e0-114">Горизонтальное масштабирование не станет панацеей от любых проблем с производительностью.</span><span class="sxs-lookup"><span data-stu-id="e45e0-114">Scaling out isn't a magic fix for every performance issue.</span></span> <span data-ttu-id="e45e0-115">Например, если узким местом является серверная база данных, дополнительные веб-серверы никак не улучшат ситуацию.</span><span class="sxs-lookup"><span data-stu-id="e45e0-115">For example, if your backend database is the bottleneck, it won't help to add more web servers.</span></span> <span data-ttu-id="e45e0-116">Сначала найдите и устраните все узкие места в системе, и лишь затем пытайтесь решить проблему, добавляя новые экземпляры.</span><span class="sxs-lookup"><span data-stu-id="e45e0-116">Identify and resolve the bottlenecks in the system first, before throwing more instances at the problem.</span></span> <span data-ttu-id="e45e0-117">Возникновение узких мест наиболее вероятно в компонентах, которые работают с отслеживанием состояния.</span><span class="sxs-lookup"><span data-stu-id="e45e0-117">Stateful parts of the system are the most likely cause of bottlenecks.</span></span>

<span data-ttu-id="e45e0-118">**Разделите рабочие нагрузки на части в соответствии с требованиями к масштабируемости.**</span><span class="sxs-lookup"><span data-stu-id="e45e0-118">**Decompose workloads by scalability requirements.**</span></span>  <span data-ttu-id="e45e0-119">В приложениях часто выполняется несколько рабочих нагрузок с разными требованиями к масштабированию.</span><span class="sxs-lookup"><span data-stu-id="e45e0-119">Applications often consist of multiple workloads, with different requirements for scaling.</span></span> <span data-ttu-id="e45e0-120">Например, в приложении может использоваться общедоступный веб-сайт и отдельный веб-интерфейс администрирования.</span><span class="sxs-lookup"><span data-stu-id="e45e0-120">For example, an application might have a public-facing site and a separate administration site.</span></span> <span data-ttu-id="e45e0-121">На общедоступном сайте часто возникают непредвиденные всплески трафика, а нагрузка на сайт администрирования намного ниже и более предсказуема.</span><span class="sxs-lookup"><span data-stu-id="e45e0-121">The public site may experience sudden surges in traffic, while the administration site has a smaller, more predictable load.</span></span>

<span data-ttu-id="e45e0-122">**Разгружайте ресурсоемкие задачи.**</span><span class="sxs-lookup"><span data-stu-id="e45e0-122">**Offload resource-intensive tasks.**</span></span> <span data-ttu-id="e45e0-123">Задачи, которые требуют значительных ресурсов процессора или ввода-вывода, при возможности следует перемещать в [фоновые задания][background-jobs], чтобы снизить нагрузку на внешний интерфейс, в котором обрабатываются запросы пользователей.</span><span class="sxs-lookup"><span data-stu-id="e45e0-123">Tasks that require a lot of CPU or I/O resources should be moved to [background jobs][background-jobs] when possible, to minimize the load on the front end that is handling user requests.</span></span>

<span data-ttu-id="e45e0-124">**Используйте встроенные возможности автомасштабирования.**</span><span class="sxs-lookup"><span data-stu-id="e45e0-124">**Use built-in autoscaling features**.</span></span> <span data-ttu-id="e45e0-125">В многие вычислительные службы Azure встроена поддержка автомасштабирования.</span><span class="sxs-lookup"><span data-stu-id="e45e0-125">Many Azure compute services have built-in support for autoscaling.</span></span> <span data-ttu-id="e45e0-126">Если рабочая нагрузка приложения хорошо прогнозируется и регулярно изменяется, используйте масштабирование по расписанию.</span><span class="sxs-lookup"><span data-stu-id="e45e0-126">If the application has a predictable, regular workload, scale out on a schedule.</span></span> <span data-ttu-id="e45e0-127">Например, развертывайте приложение в рабочее время.</span><span class="sxs-lookup"><span data-stu-id="e45e0-127">For example, scale out during business hours.</span></span> <span data-ttu-id="e45e0-128">Если же рабочая нагрузка плохо прогнозируется, используйте для автомасштабирования триггеры по метрикам производительности, таким как загрузка процессора и длина очереди.</span><span class="sxs-lookup"><span data-stu-id="e45e0-128">Otherwise, if the workload is not predictable, use performance metrics such as CPU or request queue length to trigger autoscaling.</span></span> <span data-ttu-id="e45e0-129">Также изучите наши [рекомендации по автомасштабированию][autoscaling].</span><span class="sxs-lookup"><span data-stu-id="e45e0-129">For autoscaling best practices, see [Autoscaling][autoscaling].</span></span>

<span data-ttu-id="e45e0-130">**Используйте агрессивное автомасштабирование для критически важных рабочих нагрузок.**</span><span class="sxs-lookup"><span data-stu-id="e45e0-130">**Consider aggressive autoscaling for critical workloads**.</span></span> <span data-ttu-id="e45e0-131">Для критически важных рабочих нагрузок следует предвосхищать повышение интенсивности.</span><span class="sxs-lookup"><span data-stu-id="e45e0-131">For critical workloads, you want to keep ahead of demand.</span></span> <span data-ttu-id="e45e0-132">Например, в условиях значительной нагрузки можно быстро добавить сразу несколько экземпляров для ускоренной обработки трафика, а затем постепенно уменьшать их количество.</span><span class="sxs-lookup"><span data-stu-id="e45e0-132">It's better to add new instances quickly under heavy load to handle the additional traffic, and then gradually scale back.</span></span>

<span data-ttu-id="e45e0-133">**Учитывайте возможность свертывания при разработке приложения.**</span><span class="sxs-lookup"><span data-stu-id="e45e0-133">**Design for scale in**.</span></span>  <span data-ttu-id="e45e0-134">Не забывайте, что при гибком масштабировании нужно предусмотреть и периоды свертывания, когда удаляются некоторые экземпляры приложения.</span><span class="sxs-lookup"><span data-stu-id="e45e0-134">Remember that with elastic scale, the application will have periods of scale in, when instances get removed.</span></span> <span data-ttu-id="e45e0-135">Приложение должно корректно обрабатывать удаление экземпляров.</span><span class="sxs-lookup"><span data-stu-id="e45e0-135">The application must gracefully handle instances being removed.</span></span> <span data-ttu-id="e45e0-136">Вот несколько возможных способов для обработки свертывания:</span><span class="sxs-lookup"><span data-stu-id="e45e0-136">Here are some ways to handle scalein:</span></span>

- <span data-ttu-id="e45e0-137">Прослушивайте сообщения о событиях завершения работы (если они доступны) и завершайте работу надлежащим образом.</span><span class="sxs-lookup"><span data-stu-id="e45e0-137">Listen for shutdown events (when available) and shut down cleanly.</span></span>
- <span data-ttu-id="e45e0-138">Клиенты (потребители) службы должны поддерживать обработку временных сбоев и выполнять повторные попытки.</span><span class="sxs-lookup"><span data-stu-id="e45e0-138">Clients/consumers of a service should support transient fault handling and retry.</span></span>
- <span data-ttu-id="e45e0-139">Длительно выполняемые задачи можно разделять на части, использовать для них контрольные точки или реализовать шаблон [каналов и фильтров][pipes-filters-pattern].</span><span class="sxs-lookup"><span data-stu-id="e45e0-139">For long-running tasks, consider breaking up the work, using checkpoints or the [Pipes and Filters][pipes-filters-pattern] pattern.</span></span>
- <span data-ttu-id="e45e0-140">Передавайте рабочие элементы в очередь, из которой они смогут перейти в другой экземпляр, если текущий будет удален в процессе обработки.</span><span class="sxs-lookup"><span data-stu-id="e45e0-140">Put work items on a queue so that another instance can pick up the work, if an instance is removed in the middle of processing.</span></span>

<!-- links -->

[autoscaling]: ../../best-practices/auto-scaling.md
[background-jobs]: ../../best-practices/background-jobs.md
[pipes-filters-pattern]: ../../patterns/pipes-and-filters.md
