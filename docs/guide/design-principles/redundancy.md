---
title: Обеспечение избыточности всех компонентов
description: Обеспечьте избыточность приложения, чтобы устранить все единые точки отказа.
author: MikeWasson
ms.date: 08/30/2018
ms.openlocfilehash: 18f48ea37f90846e4d337819e6c897d56e472d49
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/28/2018
ms.locfileid: "47428046"
---
# <a name="make-all-things-redundant"></a><span data-ttu-id="c93b8-103">Обеспечение избыточности всех компонентов</span><span class="sxs-lookup"><span data-stu-id="c93b8-103">Make all things redundant</span></span>

## <a name="build-redundancy-into-your-application-to-avoid-having-single-points-of-failure"></a><span data-ttu-id="c93b8-104">Обеспечьте избыточность приложения, чтобы устранить все единые точки отказа.</span><span class="sxs-lookup"><span data-stu-id="c93b8-104">Build redundancy into your application, to avoid having single points of failure</span></span>

<span data-ttu-id="c93b8-105">Надежное приложение спокойно обходит любые сбои.</span><span class="sxs-lookup"><span data-stu-id="c93b8-105">A resilient application routes around failure.</span></span> <span data-ttu-id="c93b8-106">Определите критические пути в приложении.</span><span class="sxs-lookup"><span data-stu-id="c93b8-106">Identify the critical paths in your application.</span></span> <span data-ttu-id="c93b8-107">Обеспечена ли избыточность для каждой точки этого пути?</span><span class="sxs-lookup"><span data-stu-id="c93b8-107">Is there redundancy at each point in the path?</span></span> <span data-ttu-id="c93b8-108">Если произойдет сбой подсистемы, сможет ли приложение применить другое средство для отработки отказа?</span><span class="sxs-lookup"><span data-stu-id="c93b8-108">If a subsystem fails, will the application fail over to something else?</span></span>

## <a name="recommendations"></a><span data-ttu-id="c93b8-109">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="c93b8-109">Recommendations</span></span> 

<span data-ttu-id="c93b8-110">**Оцените бизнес-требования.**</span><span class="sxs-lookup"><span data-stu-id="c93b8-110">**Consider business requirements**.</span></span> <span data-ttu-id="c93b8-111">Степень избыточности системы влияет на ее стоимость и сложность.</span><span class="sxs-lookup"><span data-stu-id="c93b8-111">The amount of redundancy built into a system can affect both cost and complexity.</span></span> <span data-ttu-id="c93b8-112">Архитектура должна строиться на основе бизнес-требований, таких как целевое время восстановления.</span><span class="sxs-lookup"><span data-stu-id="c93b8-112">Your architecture should be informed by your business requirements, such as recovery time objective (RTO).</span></span> <span data-ttu-id="c93b8-113">Например, развертывание в нескольких регионах обойдется дороже и будет сложнее в управлении, чем развертывание в одном регионе.</span><span class="sxs-lookup"><span data-stu-id="c93b8-113">For example, a multi-region deployment is more expensive than a single-region deployment, and is more complicated to manage.</span></span> <span data-ttu-id="c93b8-114">Для обработки отказа и восстановления размещения потребуются дополнительные операционные процедуры.</span><span class="sxs-lookup"><span data-stu-id="c93b8-114">You will need operational procedures to handle failover and failback.</span></span> <span data-ttu-id="c93b8-115">Дополнительные расходы и усложнение системы могут быть целесообразны для одних бизнес-сценариев, но недопустимы для других.</span><span class="sxs-lookup"><span data-stu-id="c93b8-115">The additional cost and complexity might be justified for some business scenarios and not others.</span></span>

<span data-ttu-id="c93b8-116">**Разместите виртуальные машины за подсистемой балансировки нагрузки.**</span><span class="sxs-lookup"><span data-stu-id="c93b8-116">**Place VMs behind a load balancer**.</span></span> <span data-ttu-id="c93b8-117">Не допускайте, чтобы критически важные рабочие нагрузки выполнялись только на одной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="c93b8-117">Don't use a single VM for mission-critical workloads.</span></span> <span data-ttu-id="c93b8-118">Используйте сразу несколько виртуальных машин, подключенных к подсистеме балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="c93b8-118">Instead, place multiple VMs behind a load balancer.</span></span> <span data-ttu-id="c93b8-119">Если какая-либо виртуальная машина станет недоступной, подсистема балансировки нагрузки переместит трафик на работоспособные виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="c93b8-119">If any VM becomes unavailable, the load balancer distributes traffic to the remaining healthy VMs.</span></span> <span data-ttu-id="c93b8-120">Дополнительные сведения о развертывании этой конфигурации см. в статье об [использовании нескольких виртуальных машин для повышения масштабируемости и доступности][multi-vm-blueprint].</span><span class="sxs-lookup"><span data-stu-id="c93b8-120">To learn how to deploy this configuration, see [Multiple VMs for scalability and availability][multi-vm-blueprint].</span></span>

![](./images/load-balancing.svg)

<span data-ttu-id="c93b8-121">**Реплицируйте базы данных.**</span><span class="sxs-lookup"><span data-stu-id="c93b8-121">**Replicate databases**.</span></span> <span data-ttu-id="c93b8-122">Служба "База данных SQL" и Cosmos DB Azure автоматически реплицируют данные в пределах региона. Вы можете дополнительно включить георепликацию между регионами.</span><span class="sxs-lookup"><span data-stu-id="c93b8-122">Azure SQL Database and Cosmos DB automatically replicate the data within a region, and you can enable geo-replication across regions.</span></span> <span data-ttu-id="c93b8-123">Если вы используете для базы данных модель IaaS, выберите службу, которая поддерживает репликацию и отработку отказа, например [Группы доступности Always On SQL Server][sql-always-on].</span><span class="sxs-lookup"><span data-stu-id="c93b8-123">If you are using an IaaS database solution, choose one that supports replication and failover, such as [SQL Server Always On Availability Groups][sql-always-on].</span></span> 

<span data-ttu-id="c93b8-124">**Включите георепликацию.**</span><span class="sxs-lookup"><span data-stu-id="c93b8-124">**Enable geo-replication**.</span></span> <span data-ttu-id="c93b8-125">При георепликации для службы [База данных SQL Azure][sql-geo-replication] и [Cosmos DB][cosmosdb-geo-replication] создаются вторичные реплики данных с доступом только для чтения в одном или нескольких дополнительных регионах.</span><span class="sxs-lookup"><span data-stu-id="c93b8-125">Geo-replication for [Azure SQL Database][sql-geo-replication] and [Cosmos DB][cosmosdb-geo-replication] creates secondary readable replicas of your data in one or more secondary regions.</span></span> <span data-ttu-id="c93b8-126">В случае сбоя для базы данных выполняется отработка отказа и запись осуществляется в одном из дополнительных регионов.</span><span class="sxs-lookup"><span data-stu-id="c93b8-126">In the event of an outage, the database can fail over to the secondary region for writes.</span></span>

<span data-ttu-id="c93b8-127">**Используйте секционирование для повышения доступности.**</span><span class="sxs-lookup"><span data-stu-id="c93b8-127">**Partition for availability**.</span></span> <span data-ttu-id="c93b8-128">Секционирование базы данных чаще применяется для масштабируемости, но оно позволяет повысить и доступность.</span><span class="sxs-lookup"><span data-stu-id="c93b8-128">Database partitioning is often used to improve scalability, but it can also improve availability.</span></span> <span data-ttu-id="c93b8-129">Если один сегмент выходит из строя, остальные остаются доступными.</span><span class="sxs-lookup"><span data-stu-id="c93b8-129">If one shard goes down, the other shards can still be reached.</span></span> <span data-ttu-id="c93b8-130">Сбой одного сегмента повлияет только на некоторую часть транзакций.</span><span class="sxs-lookup"><span data-stu-id="c93b8-130">A failure in one shard will only disrupt a subset of the total transactions.</span></span> 

<span data-ttu-id="c93b8-131">**Разверните приложение в нескольких регионах**.</span><span class="sxs-lookup"><span data-stu-id="c93b8-131">**Deploy to more than one region**.</span></span> <span data-ttu-id="c93b8-132">Чтобы обеспечить максимальную доступность, разверните приложение в нескольких регионах.</span><span class="sxs-lookup"><span data-stu-id="c93b8-132">For the highest availability, deploy the application to more than one region.</span></span> <span data-ttu-id="c93b8-133">Тогда приложение сможет выполнить отработку отказа даже в тех редких случаях, когда проблема затрагивает целый регион.</span><span class="sxs-lookup"><span data-stu-id="c93b8-133">That way, in the rare case when a problem affects an entire region, the application can fail over to another region.</span></span> <span data-ttu-id="c93b8-134">На схеме ниже представлено приложение в нескольких регионах, для которого диспетчер трафика Azure управляет отработкой отказа.</span><span class="sxs-lookup"><span data-stu-id="c93b8-134">The following diagram shows a multi-region application that uses Azure Traffic Manager to handle failover.</span></span>

![](images/failover.svg)

<span data-ttu-id="c93b8-135">**Синхронизируйте отработку отказа для интерфейсной и серверной частей приложения.**</span><span class="sxs-lookup"><span data-stu-id="c93b8-135">**Synchronize front and backend failover**.</span></span> <span data-ttu-id="c93b8-136">Используйте диспетчер трафика Azure для управления отработкой отказа интерфейсной части.</span><span class="sxs-lookup"><span data-stu-id="c93b8-136">Use Azure Traffic Manager to fail over the front end.</span></span> <span data-ttu-id="c93b8-137">Если в одном из регионов интерфейсная часть станет недоступна, диспетчер трафика перенаправит все новые запросы в дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="c93b8-137">If the front end becomes unreachable in one region, Traffic Manager will route new requests to the secondary region.</span></span> <span data-ttu-id="c93b8-138">В зависимости от используемого решения базы данных для нее может потребоваться синхронная отработка отказа.</span><span class="sxs-lookup"><span data-stu-id="c93b8-138">Depending on your database solution, you may need to coordinate failing over the database.</span></span> 

<span data-ttu-id="c93b8-139">**Используйте автоматическую отработку отказа, но восстановление размещения выполняйте вручную.**</span><span class="sxs-lookup"><span data-stu-id="c93b8-139">**Use automatic failover but manual failback**.</span></span> <span data-ttu-id="c93b8-140">Используйте диспетчер трафика для автоматической отработки отказа, но не применяйте его для автоматического восстановления размещения.</span><span class="sxs-lookup"><span data-stu-id="c93b8-140">Use Traffic Manager for automatic failover, but not for automatic failback.</span></span> <span data-ttu-id="c93b8-141">Автоматическое восстановление размещения может привести к тому, что приложение вернется в основной регион раньше, чем он полностью восстановит работоспособность.</span><span class="sxs-lookup"><span data-stu-id="c93b8-141">Automatic failback carries a risk that you might switch to the primary region before the region is completely healthy.</span></span> <span data-ttu-id="c93b8-142">Сначала следует убедиться, что все подсистемы приложения полностью работоспособны, и после этого вручную выполнить восстановление размещения.</span><span class="sxs-lookup"><span data-stu-id="c93b8-142">Instead, verify that all application subsystems are healthy before manually failing back.</span></span> <span data-ttu-id="c93b8-143">Кроме того (в зависимости от используемой базы данных), перед восстановлением нужно проверить согласованность данных.</span><span class="sxs-lookup"><span data-stu-id="c93b8-143">Also, depending on the database, you might need to check data consistency before failing back.</span></span>

<span data-ttu-id="c93b8-144">**Добавьте избыточность для диспетчера трафика.**</span><span class="sxs-lookup"><span data-stu-id="c93b8-144">**Include redundancy for Traffic Manager**.</span></span> <span data-ttu-id="c93b8-145">Диспетчер трафика также является точкой возможного сбоя.</span><span class="sxs-lookup"><span data-stu-id="c93b8-145">Traffic Manager is a possible failure point.</span></span> <span data-ttu-id="c93b8-146">Просмотрите соглашение об уровне доступности для диспетчера трафика и определите, достаточно ли таких гарантий для выполнения требований к высокой доступности в вашей организации.</span><span class="sxs-lookup"><span data-stu-id="c93b8-146">Review the Traffic Manager SLA, and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="c93b8-147">Если это не так, рекомендуем добавить резервное решение для управления трафиком.</span><span class="sxs-lookup"><span data-stu-id="c93b8-147">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="c93b8-148">Если в службе диспетчера трафика Azure произошел сбой, измените записи CNAME в службе доменных имен, чтобы они указывали на резервную службу управления трафиком.</span><span class="sxs-lookup"><span data-stu-id="c93b8-148">If the Azure Traffic Manager service fails, change your CNAME records in DNS to point to the other traffic management service.</span></span>



<!-- links -->

[multi-vm-blueprint]: ../../reference-architectures/virtual-machines-windows/multi-vm.md

[cassandra]: https://cassandra.apache.org/
[cosmosdb-geo-replication]: /azure/cosmos-db/distribute-data-globally
[sql-always-on]: https://msdn.microsoft.com/library/hh510230.aspx
[sql-geo-replication]: /azure/sql-database/sql-database-geo-replication-overview
