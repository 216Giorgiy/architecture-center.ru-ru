---
title: "Руководство по секционированию данных"
description: "Руководство по способам разделения секций для реализации отдельного управления и доступа."
author: dragon119
ms.date: 07/13/2016
pnp.series.title: Best Practices
ms.openlocfilehash: c139fd1ef59ea94235cd9519dd064d0722cee3c9
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
# <a name="data-partitioning"></a><span data-ttu-id="03596-103">Секционирование данных</span><span class="sxs-lookup"><span data-stu-id="03596-103">Data partitioning</span></span>
[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="03596-104">Во многих крупномасштабных решениях данные разделяются на особые секции, которыми можно управлять и пользоваться отдельно.</span><span class="sxs-lookup"><span data-stu-id="03596-104">In many large-scale solutions, data is divided into separate partitions that can be managed and accessed separately.</span></span> <span data-ttu-id="03596-105">Следует тщательно выбирать стратегию секционирования, чтобы максимально увеличить преимущества от ее использования и свести к минимуму отрицательные эффекты.</span><span class="sxs-lookup"><span data-stu-id="03596-105">The partitioning strategy must be chosen carefully to maximize the benefits while minimizing adverse effects.</span></span> <span data-ttu-id="03596-106">Секционирование поможет улучшить масштабируемость, уменьшить количество конфликтов и оптимизировать производительность.</span><span class="sxs-lookup"><span data-stu-id="03596-106">Partitioning can help improve scalability, reduce contention, and optimize performance.</span></span> <span data-ttu-id="03596-107">Дополнительное преимущество секционирования состоит в том, что оно также может предоставить механизм для разделения данных по шаблону использования.</span><span class="sxs-lookup"><span data-stu-id="03596-107">Another benefit of partitioning is that it can provide a mechanism for dividing data by the pattern of use.</span></span> <span data-ttu-id="03596-108">Например, можно архивировать старые менее активные (холодные) данные, чтобы снизить стоимость хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="03596-108">For example, you can archive older, less active (cold) data in cheaper data storage.</span></span>

## <a name="why-partition-data"></a><span data-ttu-id="03596-109">Зачем секционировать данные?</span><span class="sxs-lookup"><span data-stu-id="03596-109">Why partition data?</span></span>
<span data-ttu-id="03596-110">Большинство облачных приложений и служб хранят и извлекают данные в рамках своих операций.</span><span class="sxs-lookup"><span data-stu-id="03596-110">Most cloud applications and services store and retrieve data as part of their operations.</span></span> <span data-ttu-id="03596-111">Структура хранилищ данных, которыми пользуется приложение, может значительно влиять на производительность, пропускную способность и масштабируемость системы.</span><span class="sxs-lookup"><span data-stu-id="03596-111">The design of the data stores that an application uses can have a significant bearing on the performance, throughput, and scalability of a system.</span></span> <span data-ttu-id="03596-112">Одним из способов, которые обычно применяются в крупномасштабных системах, является разделение данных на отдельные секции.</span><span class="sxs-lookup"><span data-stu-id="03596-112">One technique that is commonly applied in large-scale systems is to divide the data into separate partitions.</span></span>

> <span data-ttu-id="03596-113">Термин *секционирование* в этом руководстве обозначает процесс физического разделения данных на отдельные хранилища.</span><span class="sxs-lookup"><span data-stu-id="03596-113">In this article, the term *partitioning* means the process of physically dividing data into separate data stores.</span></span> <span data-ttu-id="03596-114">Не следует путать его с секционированием таблиц в SQL Server.</span><span class="sxs-lookup"><span data-stu-id="03596-114">It is not the same as SQL Server table partitioning.</span></span>

<span data-ttu-id="03596-115">Секционирование данных обеспечивает множество преимуществ.</span><span class="sxs-lookup"><span data-stu-id="03596-115">Partitioning data can offer a number of benefits.</span></span> <span data-ttu-id="03596-116">Например, его можно применять в следующих целях.</span><span class="sxs-lookup"><span data-stu-id="03596-116">For example, it can be applied in order to:</span></span>

* <span data-ttu-id="03596-117">**Повышение масштабируемости**.</span><span class="sxs-lookup"><span data-stu-id="03596-117">**Improve scalability**.</span></span> <span data-ttu-id="03596-118">Вертикальное масштабирование отдельной базы данных рано или поздно столкнется с физическими ограничениями оборудования.</span><span class="sxs-lookup"><span data-stu-id="03596-118">When you scale up a single database system, it will eventually reach a physical hardware limit.</span></span> <span data-ttu-id="03596-119">При разделении данных на несколько секций, каждая из которых размещается на отдельном сервере, можно практически неограниченно масштабировать систему.</span><span class="sxs-lookup"><span data-stu-id="03596-119">If you divide data across multiple partitions, each of which is hosted on a separate server, you can scale out the system almost indefinitely.</span></span>
* <span data-ttu-id="03596-120">**Повышение производительности**.</span><span class="sxs-lookup"><span data-stu-id="03596-120">**Improve performance**.</span></span> <span data-ttu-id="03596-121">В каждой секции осуществляется доступ к данным меньшего объема.</span><span class="sxs-lookup"><span data-stu-id="03596-121">Data access operations on each partition take place over a smaller volume of data.</span></span> <span data-ttu-id="03596-122">При условии, что данные секционированы подходящим образом, секционирование может повысить эффективность системы.</span><span class="sxs-lookup"><span data-stu-id="03596-122">Provided that the data is partitioned in a suitable way, partitioning can make your system more efficient.</span></span> <span data-ttu-id="03596-123">Операции, которые задействуют несколько секций, могут выполняться параллельно.</span><span class="sxs-lookup"><span data-stu-id="03596-123">Operations that affect more than one partition can run in parallel.</span></span> <span data-ttu-id="03596-124">Каждая секция может находиться рядом с приложением, которое ее использует, для минимизации задержки в сети.</span><span class="sxs-lookup"><span data-stu-id="03596-124">Each partition can be located near the application that uses it to minimize network latency.</span></span>
* <span data-ttu-id="03596-125">**Повышение доступности**.</span><span class="sxs-lookup"><span data-stu-id="03596-125">**Improve availability**.</span></span> <span data-ttu-id="03596-126">Распределение данных по нескольким серверам позволяет избежать наличия единственной точки отказа.</span><span class="sxs-lookup"><span data-stu-id="03596-126">Separating data across multiple servers avoids a single point of failure.</span></span> <span data-ttu-id="03596-127">В случае сбоя или запланированного обслуживания сервера недоступны только данные в этой секции.</span><span class="sxs-lookup"><span data-stu-id="03596-127">If a server fails, or is undergoing planned maintenance, only the data in that partition is unavailable.</span></span> <span data-ttu-id="03596-128">Операции в других секциях можно продолжать.</span><span class="sxs-lookup"><span data-stu-id="03596-128">Operations on other partitions can continue.</span></span> <span data-ttu-id="03596-129">Увеличение числа секций уменьшает относительное влияние сбоя на одном сервере за счет снижения доли данных, которые будут недоступны.</span><span class="sxs-lookup"><span data-stu-id="03596-129">Increasing the number of partitions reduces the relative impact of a single server failure by reducing the percentage of data that will be unavailable.</span></span> <span data-ttu-id="03596-130">Репликация каждой секции может дополнительно уменьшить вероятность влияния сбоя одной секции на операции.</span><span class="sxs-lookup"><span data-stu-id="03596-130">Replicating each partition can further reduce the chance of a single partition failure affecting operations.</span></span> <span data-ttu-id="03596-131">Такой подход также позволяет отделить критически важные данные, для которых необходима постоянная и высокая доступность, от данных низкой значимости (например файлов журнала).</span><span class="sxs-lookup"><span data-stu-id="03596-131">It also makes it possible to separate critical data that must be continually and highly available from low-value data that has lower availability requirements (log files, for example).</span></span>
* <span data-ttu-id="03596-132">**Усиление безопасности**.</span><span class="sxs-lookup"><span data-stu-id="03596-132">**Improve security**.</span></span> <span data-ttu-id="03596-133">В зависимости от характера данных и метода их секционирования может существовать возможность размещения конфиденциальных и неконфиденциальных данных в разных секциях и, следовательно, на разных серверах или в разных хранилищах.</span><span class="sxs-lookup"><span data-stu-id="03596-133">Depending on the nature of the data and how it is partitioned, it might be possible to separate sensitive and non-sensitive data into different partitions, and therefore into different servers or data stores.</span></span> <span data-ttu-id="03596-134">При этом для конфиденциальных данных можно специально оптимизировать безопасность.</span><span class="sxs-lookup"><span data-stu-id="03596-134">Security can then be specifically optimized for the sensitive data.</span></span>
* <span data-ttu-id="03596-135">**Обеспечение операционной гибкости**.</span><span class="sxs-lookup"><span data-stu-id="03596-135">**Provide operational flexibility**.</span></span> <span data-ttu-id="03596-136">Секционирование предлагает множество возможностей для операций тонкой настройки, максимально повышая эффективность администрирования и сводя затраты к минимуму.</span><span class="sxs-lookup"><span data-stu-id="03596-136">Partitioning offers many opportunities for fine tuning operations, maximizing administrative efficiency, and minimizing cost.</span></span> <span data-ttu-id="03596-137">Некоторые примеры определяют разные стратегии управления, мониторинга, резервного копирования и восстановления, а также других административных задач в зависимости от степени важности данных в каждой секции.</span><span class="sxs-lookup"><span data-stu-id="03596-137">For example, you can define different strategies for management, monitoring, backup and restore, and other administrative tasks based on the importance of the data in each partition.</span></span>
* <span data-ttu-id="03596-138">**Сопоставление хранилища данных с шаблоном использования.**</span><span class="sxs-lookup"><span data-stu-id="03596-138">**Match the data store to the pattern of use**.</span></span> <span data-ttu-id="03596-139">Секционирование позволяет развернуть любую секцию в хранилище данных любого типа в зависимости от стоимости и встроенных функций, которые предоставляет хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="03596-139">Partitioning allows each partition to be deployed on a different type of data store, based on cost and the built-in features that data store offers.</span></span> <span data-ttu-id="03596-140">Например, двоичные данные больших объемов могут храниться в хранилище больших двоичных объектов, а более структурированные данные можно хранить в базе данных документов.</span><span class="sxs-lookup"><span data-stu-id="03596-140">For example, large binary data can be stored in a blob data store, while more structured data can be held in a document database.</span></span> <span data-ttu-id="03596-141">Дополнительные сведения см. в разделе [Building a polyglot solution] (Создание решения Polyglot) руководства по шаблонам и в статье [Data access for highly-scalable solutions: Using SQL, NoSQL, and polyglot persistence] (Доступ к данным для масштабируемых решений: с помощью SQL, NoSQL и Polyglot Persistence) на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-141">For more information, see [Building a polyglot solution] in the patterns & practices guide and [Data access for highly-scalable solutions: Using SQL, NoSQL, and polyglot persistence] on the Microsoft website.</span></span>

<span data-ttu-id="03596-142">В некоторых системах не реализованы секции, так как считается, что они связаны с затратами, а не дополнительными преимуществами.</span><span class="sxs-lookup"><span data-stu-id="03596-142">Some systems do not implement partitioning because it is considered a cost rather than an advantage.</span></span> <span data-ttu-id="03596-143">Вот наиболее распространенные причины такого мнения.</span><span class="sxs-lookup"><span data-stu-id="03596-143">Common reasons for this rationale include:</span></span>

* <span data-ttu-id="03596-144">Многие системы хранения данных не поддерживают соединения по секциям, поэтому поддержка целостности данных в секционированных системах может быть затруднена.</span><span class="sxs-lookup"><span data-stu-id="03596-144">Many data storage systems do not support joins across partitions, and it can be difficult to maintain referential integrity in a partitioned system.</span></span> <span data-ttu-id="03596-145">Часто возникает необходимость реализовать соединения и проверки целостности в коде приложения (на уровне секционирования), что может привести к увеличению числа вводов-выводов и сложности приложения.</span><span class="sxs-lookup"><span data-stu-id="03596-145">It is frequently necessary to implement joins and integrity checks in application code (in the partitioning layer), which can result in additional I/O and application complexity.</span></span>
* <span data-ttu-id="03596-146">Обслуживание секций не всегда является простой задачей.</span><span class="sxs-lookup"><span data-stu-id="03596-146">Maintaining partitions is not always a trivial task.</span></span> <span data-ttu-id="03596-147">В системе, где данные энергозависимы, может потребоваться периодически балансировать секции, чтобы снизить число конфликтов и горячих зон.</span><span class="sxs-lookup"><span data-stu-id="03596-147">In a system where the data is volatile, you might need to rebalance partitions periodically to reduce contention and hot spots.</span></span>
* <span data-ttu-id="03596-148">Некоторые стандартные средства не работают автоматически с секционированными данными.</span><span class="sxs-lookup"><span data-stu-id="03596-148">Some common tools do not work naturally with partitioned data.</span></span>

## <a name="designing-partitions"></a><span data-ttu-id="03596-149">Проектирование секций</span><span class="sxs-lookup"><span data-stu-id="03596-149">Designing partitions</span></span>
<span data-ttu-id="03596-150">Данные могут быть секционированы по-разному: вертикально, горизонтально или функционально.</span><span class="sxs-lookup"><span data-stu-id="03596-150">Data can be partitioned in different ways: horizontally, vertically, or functionally.</span></span> <span data-ttu-id="03596-151">Выбор стратегии зависит от причины секционирования данных, а также требований приложений и служб, которые будут использовать эти данные.</span><span class="sxs-lookup"><span data-stu-id="03596-151">The strategy you choose depends on the reason for partitioning the data, and the requirements of the applications and services that will use the data.</span></span>

> [!NOTE]
> <span data-ttu-id="03596-152">Схемы секционирования, о которых идет речь в этом руководстве, описаны способом, который не зависит от используемой технологии хранения данных.</span><span class="sxs-lookup"><span data-stu-id="03596-152">The partitioning schemes described in this guidance are explained in a way that is independent of the underlying data storage technology.</span></span> <span data-ttu-id="03596-153">Они применимы для различных типов хранилищ данных, включая реляционные и базы данных NoSQL.</span><span class="sxs-lookup"><span data-stu-id="03596-153">They can be applied to many types of data stores, including relational and NoSQL databases.</span></span>
>
>

### <a name="partitioning-strategies"></a><span data-ttu-id="03596-154">Стратегии секционирования</span><span class="sxs-lookup"><span data-stu-id="03596-154">Partitioning strategies</span></span>
<span data-ttu-id="03596-155">Ниже представлены три типичные стратегии для секционирования данных.</span><span class="sxs-lookup"><span data-stu-id="03596-155">The three typical strategies for partitioning data are:</span></span>

* <span data-ttu-id="03596-156">**Горизонтальное секционирование** (часто называемое *сегментированием*).</span><span class="sxs-lookup"><span data-stu-id="03596-156">**Horizontal partitioning** (often called *sharding*).</span></span> <span data-ttu-id="03596-157">В этой стратегии каждая секция представляет собой хранилище данных сама по себе, но все секции имеют одинаковые схемы.</span><span class="sxs-lookup"><span data-stu-id="03596-157">In this strategy, each partition is a data store in its own right, but all partitions have the same schema.</span></span> <span data-ttu-id="03596-158">Каждая секция называется *сегментом* и содержит конкретное подмножество данных, например все заказы для определенной группы клиентов в приложении электронной коммерции.</span><span class="sxs-lookup"><span data-stu-id="03596-158">Each partition is known as a *shard* and holds a specific subset of the data, such as all the orders for a specific set of customers in an e-commerce application.</span></span>
* <span data-ttu-id="03596-159">**Вертикальное секционирование**.</span><span class="sxs-lookup"><span data-stu-id="03596-159">**Vertical partitioning**.</span></span> <span data-ttu-id="03596-160">В этой стратегии каждая секция содержит подмножество полей для элементов в хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="03596-160">In this strategy, each partition holds a subset of the fields for items in the data store.</span></span> <span data-ttu-id="03596-161">Поля разделяются по шаблону их использования.</span><span class="sxs-lookup"><span data-stu-id="03596-161">The fields are divided according to their pattern of use.</span></span> <span data-ttu-id="03596-162">Например, часто используемые поля размещаются в одной вертикальной секции, а более редко используемые поля — в другой.</span><span class="sxs-lookup"><span data-stu-id="03596-162">For example, frequently accessed fields might be placed in one vertical partition and less frequently accessed fields in another.</span></span>
* <span data-ttu-id="03596-163">**Функциональное секционирование**.</span><span class="sxs-lookup"><span data-stu-id="03596-163">**Functional partitioning**.</span></span> <span data-ttu-id="03596-164">В этой стратегии данные группируются в соответствии с их использованием в каждом связанном контексте в системе.</span><span class="sxs-lookup"><span data-stu-id="03596-164">In this strategy, data is aggregated according to how it is used by each bounded context in the system.</span></span> <span data-ttu-id="03596-165">Например, система электронной коммерции, которая реализует отдельные бизнес-функции для выставления счетов и управления описью продуктов, может хранить данные счетов в одной секции, а данные инвентаризации продуктов — в другой.</span><span class="sxs-lookup"><span data-stu-id="03596-165">For example, an e-commerce system that implements separate business functions for invoicing and managing product inventory might store invoice data in one partition and product inventory data in another.</span></span>

<span data-ttu-id="03596-166">Обратите внимание, что три стратегии, описанные здесь, можно сочетать.</span><span class="sxs-lookup"><span data-stu-id="03596-166">It’s important to note that the three strategies described here can be combined.</span></span> <span data-ttu-id="03596-167">Они не являются взаимоисключающими, и все три стратегии рекомендуется учитывать при разработке схемы секционирования.</span><span class="sxs-lookup"><span data-stu-id="03596-167">They are not mutually exclusive, and we recommend that you consider them all when you design a partitioning scheme.</span></span> <span data-ttu-id="03596-168">Например, можно разделить данные на сегменты и затем использовать вертикальное секционирование для дальнейшего разделения данных в каждом сегменте.</span><span class="sxs-lookup"><span data-stu-id="03596-168">For example, you might divide data into shards and then use vertical partitioning to further subdivide the data in each shard.</span></span> <span data-ttu-id="03596-169">Аналогичным образом данные в функциональной секции могут быть разделены на сегменты (которые могут быть также вертикально секционированы).</span><span class="sxs-lookup"><span data-stu-id="03596-169">Similarly, the data in a functional partition can be split into shards (which can also be vertically partitioned).</span></span>

<span data-ttu-id="03596-170">Однако разные требования каждой стратегии могут увеличить число конфликтов.</span><span class="sxs-lookup"><span data-stu-id="03596-170">However, the differing requirements of each strategy can raise a number of conflicting issues.</span></span> <span data-ttu-id="03596-171">Их все необходимо оценить и сбалансировать при разработке схемы секционирования, обеспечивающей целевую производительность обработки данных для вашей системы.</span><span class="sxs-lookup"><span data-stu-id="03596-171">You must evaluate and balance all of these when designing a partitioning scheme that meets the overall data processing performance targets for your system.</span></span> <span data-ttu-id="03596-172">Следующие разделы посвящены более подробному описанию каждой стратегии.</span><span class="sxs-lookup"><span data-stu-id="03596-172">The following sections explore each of the strategies in more detail.</span></span>

### <a name="horizontal-partitioning-sharding"></a><span data-ttu-id="03596-173">Горизонтальное секционирование (сегментирование)</span><span class="sxs-lookup"><span data-stu-id="03596-173">Horizontal partitioning (sharding)</span></span>
<span data-ttu-id="03596-174">На рисунке 1 представлен обзор горизонтального секционирования, или сегментирования.</span><span class="sxs-lookup"><span data-stu-id="03596-174">Figure 1 shows an overview of horizontal partitioning or sharding.</span></span> <span data-ttu-id="03596-175">В этом примере данные инвентаризации продуктов разделены на сегменты на основании ключа продукта.</span><span class="sxs-lookup"><span data-stu-id="03596-175">In this example, product inventory data is divided into shards based on the product key.</span></span> <span data-ttu-id="03596-176">Каждый сегмент содержит данные для непрерывного диапазона ключей сегментов (A-G и H-Z) в алфавитном порядке.</span><span class="sxs-lookup"><span data-stu-id="03596-176">Each shard holds the data for a contiguous range of shard keys (A-G and H-Z), organized alphabetically.</span></span>

![Горизонтальное секционирование данных (сегментирование) на основании ключа секции](./images/data-partitioning/DataPartitioning01.png)

<span data-ttu-id="03596-178">*Рис. 1. Горизонтальное секционирование данных (сегментирование) на основании ключа секции*</span><span class="sxs-lookup"><span data-stu-id="03596-178">*Figure 1. Horizontally partitioning (sharding) data based on a partition key*</span></span>

<span data-ttu-id="03596-179">Сегментирование помогает распределить нагрузку между несколькими компьютерами, уменьшая вероятность конфликтов и повышая производительность.</span><span class="sxs-lookup"><span data-stu-id="03596-179">Sharding helps you spread the load over more computers, which reduces contention and improves performance.</span></span> <span data-ttu-id="03596-180">Можно масштабировать систему, добавляя дополнительные сегменты, работающие на дополнительных серверах.</span><span class="sxs-lookup"><span data-stu-id="03596-180">You can scale the system out by adding further shards that run on additional servers.</span></span>

<span data-ttu-id="03596-181">Наиболее важным фактором при реализации этой стратегии секционирования является выбор ключа сегментирования.</span><span class="sxs-lookup"><span data-stu-id="03596-181">The most important factor when implementing this partitioning strategy is the choice of sharding key.</span></span> <span data-ttu-id="03596-182">Может быть трудно изменить ключ после начала работы системы.</span><span class="sxs-lookup"><span data-stu-id="03596-182">It can be difficult to change the key after the system is in operation.</span></span> <span data-ttu-id="03596-183">Ключ должен гарантировать, что данные секционированы таким образом, чтобы рабочая нагрузка была распределена по сегментам максимально равномерно.</span><span class="sxs-lookup"><span data-stu-id="03596-183">The key must ensure that data is partitioned so that the workload is as even as possible across the shards.</span></span>

<span data-ttu-id="03596-184">Обратите внимание, что разные сегменты необязательно должны содержать сходные объемы данных.</span><span class="sxs-lookup"><span data-stu-id="03596-184">Note that different shards do not have to contain similar volumes of data.</span></span> <span data-ttu-id="03596-185">Гораздо важнее сбалансировать количество запросов.</span><span class="sxs-lookup"><span data-stu-id="03596-185">Rather, the more important consideration is to balance the number of requests.</span></span> <span data-ttu-id="03596-186">Некоторые сегменты, возможно, будут очень большими, но элементы в них могут редко использоваться.</span><span class="sxs-lookup"><span data-stu-id="03596-186">Some shards might be very large, but each item is the subject of a low number of access operations.</span></span> <span data-ttu-id="03596-187">Другие сегменты будут меньше, но данные в них могут использоваться чаще.</span><span class="sxs-lookup"><span data-stu-id="03596-187">Other shards might be smaller, but each item is accessed much more frequently.</span></span> <span data-ttu-id="03596-188">Также важно убедиться, что один сегмент не превышает предел масштабирования (с точки зрения емкости и ресурсов обработки) хранилища данных, используемого для размещения этого сегмента.</span><span class="sxs-lookup"><span data-stu-id="03596-188">It is also important to ensure that a single shard does not exceed the scale limits (in terms of capacity and processing resources) of the data store that's being used to host that shard.</span></span>

<span data-ttu-id="03596-189">При использовании схемы сегментирования следует избегать возникновения горячих точек (или горячих секций), которые могут повлиять на производительность и доступность.</span><span class="sxs-lookup"><span data-stu-id="03596-189">If you use a sharding scheme, avoid creating hotspots (or hot partitions) that can affect performance and availability.</span></span> <span data-ttu-id="03596-190">Например, если использовать хэш идентификатора клиента вместо первой буквы имени клиента, можно предотвратить несбалансированное распределение, которое возникнет из-за неоднородной частоты использования начальных букв.</span><span class="sxs-lookup"><span data-stu-id="03596-190">For example, if you use a hash of a customer identifier instead of the first letter of a customer’s name, you prevent the unbalanced distribution that results from common and less common initial letters.</span></span> <span data-ttu-id="03596-191">Это типичный способ, позволяющий более равномерно распределить данные по секциям.</span><span class="sxs-lookup"><span data-stu-id="03596-191">This is a typical technique that helps distribute data more evenly across partitions.</span></span>

<span data-ttu-id="03596-192">Выберите ключ сегментирования, который сводит к минимуму любые будущие требования разбить большие сегменты на более мелкие части, объединить небольшие сегменты в секции большего размера или изменить схему, которая описывает данные, хранящиеся в наборе секций.</span><span class="sxs-lookup"><span data-stu-id="03596-192">Choose a sharding key that minimizes any future requirements to split large shards into smaller pieces, coalesce small shards into larger partitions, or change the schema that describes the data stored in a set of partitions.</span></span> <span data-ttu-id="03596-193">Эти операции могут занять очень много времени и потребовать отключения одного или нескольких сегментов во время их выполнения.</span><span class="sxs-lookup"><span data-stu-id="03596-193">These operations can be very time consuming, and might require taking one or more shards offline while they are performed.</span></span>

<span data-ttu-id="03596-194">Если сегменты реплицируются, можно оставить некоторые реплики в рабочем режиме во время разделения, слияния или перенастройки других реплик.</span><span class="sxs-lookup"><span data-stu-id="03596-194">If shards are replicated, it might be possible to keep some of the replicas online while others are split, merged, or reconfigured.</span></span> <span data-ttu-id="03596-195">Но система может ограничить операции, выполняемые с данными в этих сегментах во время перенастройки.</span><span class="sxs-lookup"><span data-stu-id="03596-195">However, the system might need to limit the operations that can be performed on the data in these shards while the reconfiguration is taking place.</span></span> <span data-ttu-id="03596-196">Например, данные в репликах могут быть помечены как данные только для чтения, чтобы ограничить объем несоответствий, которые возникают во время реструктуризации сегментов.</span><span class="sxs-lookup"><span data-stu-id="03596-196">For example, the data in the replicas can be marked as read-only to limit the scope of inconsistences that might occur while shards are being restructured.</span></span>

> <span data-ttu-id="03596-197">Дополнительные сведения и рекомендации по этим вопросам, как и по рекомендуемым методам проектирования хранилищ данных, которые реализуют горизонтальное секционирование, см. в статье [Sharding pattern] (Шаблон сегментирования).</span><span class="sxs-lookup"><span data-stu-id="03596-197">For more detailed information and guidance about many of these considerations, and good practice techniques for designing data stores that implement horizontal partitioning, see [Sharding pattern].</span></span>
>
>

### <a name="vertical-partitioning"></a><span data-ttu-id="03596-198">Вертикальное секционирование</span><span class="sxs-lookup"><span data-stu-id="03596-198">Vertical partitioning</span></span>
<span data-ttu-id="03596-199">Вертикальное секционирование наиболее часто используется для сокращения операций ввода-вывода и расходов на производительность, связанных с выборкой наиболее часто используемых элементов.</span><span class="sxs-lookup"><span data-stu-id="03596-199">The most common use for vertical partitioning is to reduce the I/O and performance costs associated with fetching the items that are accessed most frequently.</span></span> <span data-ttu-id="03596-200">На рисунке 2 показан пример вертикального секционирования.</span><span class="sxs-lookup"><span data-stu-id="03596-200">Figure 2 shows an example of vertical partitioning.</span></span> <span data-ttu-id="03596-201">В этом примере разные свойства для каждого элемента данных хранятся в разных секциях.</span><span class="sxs-lookup"><span data-stu-id="03596-201">In this example, different properties for each data item are held in different partitions.</span></span> <span data-ttu-id="03596-202">В одной секции хранятся данные, используемые чаще всего, например имя, описание и сведения о ценах на продукты.</span><span class="sxs-lookup"><span data-stu-id="03596-202">One partition holds data that is accessed more frequently, including the name, description, and price information for products.</span></span> <span data-ttu-id="03596-203">В другой содержатся данные о количестве на складе и дате последнего заказа.</span><span class="sxs-lookup"><span data-stu-id="03596-203">Another holds the volume in stock and the last ordered date.</span></span>

![Вертикальное секционирование данных по шаблону использования](./images/data-partitioning/DataPartitioning02.png)

<span data-ttu-id="03596-205">*Рис. 2. Вертикальное секционирование данных по шаблону использования*</span><span class="sxs-lookup"><span data-stu-id="03596-205">*Figure 2. Vertically partitioning data by its pattern of use*</span></span>

<span data-ttu-id="03596-206">В этом примере приложение регулярно запрашивает имя, описание и цену продукта при отображении подробных сведений о продукте для клиента.</span><span class="sxs-lookup"><span data-stu-id="03596-206">In this example, the application regularly queries the product name, description, and price when displaying the product details to customers.</span></span> <span data-ttu-id="03596-207">Такие данные, как количество продукта на складе и дата последнего заказа у производителя, хранятся в отдельной секции, так как эти два элемента часто используются совместно.</span><span class="sxs-lookup"><span data-stu-id="03596-207">The stock level and date when the product was last ordered from the manufacturer are held in a separate partition because these two items are commonly used together.</span></span>

<span data-ttu-id="03596-208">Эта схема секционирования имеет то дополнительное преимущество, что относительно медленно изменяющиеся данные (название, описание и цена продукта) отделены от более динамически меняющихся данных (количество продукта на складе и дата последнего заказа).</span><span class="sxs-lookup"><span data-stu-id="03596-208">This partitioning scheme has the added advantage that the relatively slow-moving data (product name, description, and price) is separated from the more dynamic data (stock level and last ordered date).</span></span> <span data-ttu-id="03596-209">Приложение может выиграть, когда изменяющиеся данные медленно кэшируются в памяти, если они часто используются.</span><span class="sxs-lookup"><span data-stu-id="03596-209">An application might find it beneficial to cache the slow-moving data in memory if it is frequently accessed.</span></span>

<span data-ttu-id="03596-210">Другой типичный сценарий для этой стратегии секционирования — максимальное повышение безопасности конфиденциальных данных.</span><span class="sxs-lookup"><span data-stu-id="03596-210">Another typical scenario for this partitioning strategy is to maximize the security of sensitive data.</span></span> <span data-ttu-id="03596-211">Этого можно добиться, например, храня номера кредитных карт и соответствующие номера проверки безопасности карты в отдельной секции.</span><span class="sxs-lookup"><span data-stu-id="03596-211">For example, you can do this by storing credit card numbers and the corresponding card security verification numbers in separate partitions.</span></span>

<span data-ttu-id="03596-212">Вертикальное секционирование может также снизить объем требуемого параллельного доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="03596-212">Vertical partitioning can also reduce the amount of concurrent access that's needed to the data.</span></span>

> <span data-ttu-id="03596-213">Вертикальное секционирование выполняется на уровне сущности в хранилище данных, частично нормализуя сущность и преобразуя ее из *широкого* элемента в набор *узких* элементов.</span><span class="sxs-lookup"><span data-stu-id="03596-213">Vertical partitioning operates at the entity level within a data store, partially normalizing an entity to break it down from a *wide* item to a set of *narrow* items.</span></span> <span data-ttu-id="03596-214">Это идеально подходит для хранилищ данных со столбцами, таких как HBase и Cassandra.</span><span class="sxs-lookup"><span data-stu-id="03596-214">It is ideally suited for column-oriented data stores such as HBase and Cassandra.</span></span> <span data-ttu-id="03596-215">Если данные в коллекции столбцов меняются редко, также можно использовать хранилища со столбцами в SQL Server.</span><span class="sxs-lookup"><span data-stu-id="03596-215">If the data in a collection of columns is unlikely to change, you can also consider using column stores in SQL Server.</span></span>
>
>

### <a name="functional-partitioning"></a><span data-ttu-id="03596-216">Функциональное секционирование</span><span class="sxs-lookup"><span data-stu-id="03596-216">Functional partitioning</span></span>
<span data-ttu-id="03596-217">Для систем, где можно идентифицировать связанный контекст для каждой области бизнеса или службы в приложении, функциональное секционирование предоставляет способ повышения изоляции и скорости доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="03596-217">For systems where it is possible to identify a bounded context for each distinct business area or service in the application, functional partitioning provides a technique for improving isolation and data access performance.</span></span> <span data-ttu-id="03596-218">Кроме этого, функциональное секционирование обычно используется для разделения данных для чтения и записи от данных только для чтения, используемых для составления отчетов.</span><span class="sxs-lookup"><span data-stu-id="03596-218">Another common use of functional partitioning is to separate read-write data from read-only data that's used for reporting purposes.</span></span> <span data-ttu-id="03596-219">На рисунке 3 представлен обзор функционального секционирования, где инвентаризации отделены от данных клиентов.</span><span class="sxs-lookup"><span data-stu-id="03596-219">Figure 3 shows an overview of functional partitioning where inventory data is separated from customer data.</span></span>

![Функциональное секционирование данных по связанному контексту или дочернему домену](./images/data-partitioning/DataPartitioning03.png)

<span data-ttu-id="03596-221">*Рис. 3. Функциональное секционирование данных по связанному контексту или дочернему домену*</span><span class="sxs-lookup"><span data-stu-id="03596-221">*Figure 3. Functionally partitioning data by bounded context or subdomain*</span></span>

<span data-ttu-id="03596-222">Эта стратегия секционирования может помочь уменьшить количество конфликтов доступа к данным в различных частях системы.</span><span class="sxs-lookup"><span data-stu-id="03596-222">This partitioning strategy can help reduce data access contention across different parts of a system.</span></span>

## <a name="designing-partitions-for-scalability"></a><span data-ttu-id="03596-223">Проектирование секций для масштабируемости</span><span class="sxs-lookup"><span data-stu-id="03596-223">Designing partitions for scalability</span></span>
<span data-ttu-id="03596-224">Важно учитывать размер и рабочую нагрузку каждой секции и равномерно распределять данные для достижения максимальной масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="03596-224">It's vital to consider size and workload for each partition and balance them so that data is distributed to achieve maximum scalability.</span></span> <span data-ttu-id="03596-225">Тем не менее необходимо все же секционировать данные так, чтобы не превысить ограничения масштабирования одной секции хранилища.</span><span class="sxs-lookup"><span data-stu-id="03596-225">However, you must also partition the data so that it does not exceed the scaling limits of a single partition store.</span></span>

<span data-ttu-id="03596-226">При создании секций для масштабируемости выполните приведенные далее действия.</span><span class="sxs-lookup"><span data-stu-id="03596-226">Follow these steps when designing partitions for scalability:</span></span>

1. <span data-ttu-id="03596-227">Проанализируйте приложение, чтобы понять шаблоны доступа к данным, такие как размер результирующего набора, возвращаемого каждым запросом, частота доступа, встречающиеся задержки и требования к вычислительной обработке на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="03596-227">Analyze the application to understand the data access patterns, such as the size of the result set returned by each query, the frequency of access, the inherent latency, and the server-side compute processing requirements.</span></span> <span data-ttu-id="03596-228">Во многих случаях несколько основных сущностей потребуют большую часть вычислительных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="03596-228">In many cases, a few major entities will demand most of the processing resources.</span></span>
2. <span data-ttu-id="03596-229">На основе анализа определите текущие и будущие целевые показатели масштабируемости, такие как размер данных и рабочая нагрузка.</span><span class="sxs-lookup"><span data-stu-id="03596-229">Use this analysis to determine the current and future scalability targets, such as data size and workload.</span></span> <span data-ttu-id="03596-230">Затем распределите данные по секциям в соответствии с целевыми показателями масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="03596-230">Then distribute the data across the partitions to meet the scalability target.</span></span> <span data-ttu-id="03596-231">В горизонтальной стратегии секционирования выбор соответствующего ключа сегмента важен для обеспечения равномерного распределения.</span><span class="sxs-lookup"><span data-stu-id="03596-231">In the horizontal partitioning strategy, choosing the appropriate shard key is important to make sure distribution is even.</span></span> <span data-ttu-id="03596-232">Дополнительные сведения см. в статье [Sharding pattern] (Шаблон сегментирования).</span><span class="sxs-lookup"><span data-stu-id="03596-232">For more information, see the [Sharding pattern].</span></span>
3. <span data-ttu-id="03596-233">Убедитесь в том, что каждой секции предоставлено достаточно ресурсов для достижения требований масштабируемости с точки зрения размера данных и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="03596-233">Make sure that the resources available to each partition are sufficient to handle the scalability requirements in terms of data size and throughput.</span></span> <span data-ttu-id="03596-234">Например, узел, где размещается секция, может накладывать жесткое ограничение на объем для хранения, объем обработки или пропускную способность сети, которые он предоставляет.</span><span class="sxs-lookup"><span data-stu-id="03596-234">For example, the node that's hosting a partition might impose a hard limit on the amount of storage space, processing power, or network bandwidth that it provides.</span></span> <span data-ttu-id="03596-235">Если требования к хранению и обработке данных, скорее всего, превысят эти пределы, возможно, вам придется пересмотреть стратегию секционирования или дополнительно разделить данные.</span><span class="sxs-lookup"><span data-stu-id="03596-235">If the data storage and processing requirements are likely to exceed these limits, it might be necessary to refine your partitioning strategy or split data out further.</span></span> <span data-ttu-id="03596-236">Например, можно использовать такой подход к масштабированию: отделить данные журналов от основных функций приложения.</span><span class="sxs-lookup"><span data-stu-id="03596-236">For example, one scalability approach might be to separate logging data from the core application features.</span></span> <span data-ttu-id="03596-237">Для этого следует использовать отдельные хранилища, чтобы общие требования хранилища данных не превышали предел масштабирования узла.</span><span class="sxs-lookup"><span data-stu-id="03596-237">You do this by using separate data stores to prevent the total data storage requirements from exceeding the scaling limit of the node.</span></span> <span data-ttu-id="03596-238">Если общее число хранилищ данных превышает ограничение узла, может потребоваться использование отдельных узлов хранилища.</span><span class="sxs-lookup"><span data-stu-id="03596-238">If the total number of data stores exceeds the node limit, it might be necessary to use separate storage nodes.</span></span>
4. <span data-ttu-id="03596-239">Понаблюдайте за используемой системой, чтобы убедиться, что данные распределяются ожидаемым образом и секции справляются со своей нагрузкой.</span><span class="sxs-lookup"><span data-stu-id="03596-239">Monitor the system under use to verify that the data is distributed as expected and that the partitions can handle the load that is imposed on them.</span></span> <span data-ttu-id="03596-240">Есть вероятность, что фактические результаты использования не будут совпадать с данными анализа.</span><span class="sxs-lookup"><span data-stu-id="03596-240">It's possible that the usage does not match the usage that's anticipated by the analysis.</span></span> <span data-ttu-id="03596-241">В этом случае можно повторно сбалансировать секции.</span><span class="sxs-lookup"><span data-stu-id="03596-241">In that case, it might be possible to rebalance the partitions.</span></span> <span data-ttu-id="03596-242">Если это не дало результата, может потребоваться изменить некоторые компоненты системы, чтобы получить необходимый баланс.</span><span class="sxs-lookup"><span data-stu-id="03596-242">Failing that, it might be necessary to redesign some parts of the system to gain the required balance.</span></span>

<span data-ttu-id="03596-243">Обратите внимание, что некоторые облачные среды распределяют ресурсы по границам инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="03596-243">Note that some cloud environments allocate resources in terms of infrastructure boundaries.</span></span> <span data-ttu-id="03596-244">Следует убедиться, что ограничения выбранной границы предоставляют достаточно места для любого ожидаемого роста объема данных с точки зрения хранилища данных, вычислительной мощности и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="03596-244">Ensure that the limits of your selected boundary provide enough room for any anticipated growth in the volume of data, in terms of data storage, processing power, and bandwidth.</span></span>

<span data-ttu-id="03596-245">Например, при использовании хранилища таблиц Azure занятый сегмент может потребовать больше ресурсов, чем доступно отдельным секциям для обработки запросов.</span><span class="sxs-lookup"><span data-stu-id="03596-245">For example, if you use Azure table storage, a busy shard might require more resources than are available to a single partition to handle requests.</span></span> <span data-ttu-id="03596-246">(Существует ограничение на объем запросов, которые могут обрабатываться одним разделом в определенный период времени.</span><span class="sxs-lookup"><span data-stu-id="03596-246">(There is a limit to the volume of requests that can be handled by a single partition in a particular period of time.</span></span> <span data-ttu-id="03596-247">Дополнительные сведения см. на странице [Целевые показатели масштабируемости и производительности службы хранилища Azure] на веб-сайте Майкрософт.)</span><span class="sxs-lookup"><span data-stu-id="03596-247">See the page [Azure storage scalability and performance targets] on the Microsoft website for more details.)</span></span>

 <span data-ttu-id="03596-248">В этом случае можно повторно секционировать сегмент, чтобы распределить нагрузку.</span><span class="sxs-lookup"><span data-stu-id="03596-248">If this is the case, the shard might need to be repartitioned to spread the load.</span></span> <span data-ttu-id="03596-249">Если общий размер или пропускная способность этих таблиц превышают емкость учетной записи хранения, возможно, потребуется создать дополнительные учетные записи хранения и распределить таблицы по этим учетным записям.</span><span class="sxs-lookup"><span data-stu-id="03596-249">If the total size or throughput of these tables exceeds the capacity of a storage account, it might be necessary to create additional storage accounts and spread the tables across these accounts.</span></span> <span data-ttu-id="03596-250">Если число учетных записей хранения превышает количество доступных для подписки, возможно, потребуется использовать несколько подписок.</span><span class="sxs-lookup"><span data-stu-id="03596-250">If the number of storage accounts exceeds the number of accounts that are available to a subscription, then it might be necessary to use multiple subscriptions.</span></span>

## <a name="designing-partitions-for-query-performance"></a><span data-ttu-id="03596-251">Проектирование секций для повышения производительности запросов</span><span class="sxs-lookup"><span data-stu-id="03596-251">Designing partitions for query performance</span></span>
<span data-ttu-id="03596-252">Производительность запросов часто можно увеличить путем использования небольших наборов данных и параллельного выполнения запросов.</span><span class="sxs-lookup"><span data-stu-id="03596-252">Query performance can often be boosted by using smaller data sets and by running parallel queries.</span></span> <span data-ttu-id="03596-253">Каждая секция должна содержать небольшую часть всего набора данных.</span><span class="sxs-lookup"><span data-stu-id="03596-253">Each partition should contain a small proportion of the entire data set.</span></span> <span data-ttu-id="03596-254">Такое уменьшение объема может повысить производительность запросов.</span><span class="sxs-lookup"><span data-stu-id="03596-254">This reduction in volume can improve the performance of queries.</span></span> <span data-ttu-id="03596-255">Тем не менее секционирование не является альтернативой правильной разработке и настройке базы данных.</span><span class="sxs-lookup"><span data-stu-id="03596-255">However, partitioning is not an alternative for designing and configuring a database appropriately.</span></span> <span data-ttu-id="03596-256">Например, необходимо убедиться в том, что присутствуют все необходимые индексы, если вы используете реляционную базу данных.</span><span class="sxs-lookup"><span data-stu-id="03596-256">For example, make sure that you have the necessary indexes in place if you are using a relational database.</span></span>

<span data-ttu-id="03596-257">При создании секций для производительности запросов выполните приведенные далее действия.</span><span class="sxs-lookup"><span data-stu-id="03596-257">Follow these steps when designing partitions for query performance:</span></span>

1. <span data-ttu-id="03596-258">Изучите требования и производительность приложения.</span><span class="sxs-lookup"><span data-stu-id="03596-258">Examine the application requirements and performance:</span></span>
   * <span data-ttu-id="03596-259">Используйте бизнес-требования, чтобы определить важные запросы, которые всегда должны выполняться быстро.</span><span class="sxs-lookup"><span data-stu-id="03596-259">Use the business requirements to determine the critical queries that must always perform quickly.</span></span>
   * <span data-ttu-id="03596-260">Отслеживайте состояния системы, чтобы выявить любые медленно выполняемые запросы.</span><span class="sxs-lookup"><span data-stu-id="03596-260">Monitor the system to identify any queries that perform slowly.</span></span>
   * <span data-ttu-id="03596-261">Установите, какие запросы выполняются наиболее часто.</span><span class="sxs-lookup"><span data-stu-id="03596-261">Establish which queries are performed most frequently.</span></span> <span data-ttu-id="03596-262">Один экземпляр каждого запроса может иметь минимальный вес, но совокупное потребление ресурсов может быть значительным.</span><span class="sxs-lookup"><span data-stu-id="03596-262">A single instance of each query might have minimal cost, but the cumulative consumption of resources could be significant.</span></span> <span data-ttu-id="03596-263">Возможно, полезно будет выделить данные, полученные этими запросами, в отдельную секцию или даже в кэш.</span><span class="sxs-lookup"><span data-stu-id="03596-263">It might be beneficial to separate the data that's retrieved by these queries into a distinct partition, or even a cache.</span></span>
2. <span data-ttu-id="03596-264">Разделите данные, которые вызывают снижение производительности.</span><span class="sxs-lookup"><span data-stu-id="03596-264">Partition the data that is causing slow performance:</span></span>
   * <span data-ttu-id="03596-265">Ограничьте размер каждой секции, чтобы время отклика запроса оставалось в пределах целевого значения.</span><span class="sxs-lookup"><span data-stu-id="03596-265">Limit the size of each partition so that the query response time is within target.</span></span>
   * <span data-ttu-id="03596-266">Создайте ключ сегментирования таким образом, чтобы приложение могло легко находить секцию, если вы реализуете горизонтальное секционирование.</span><span class="sxs-lookup"><span data-stu-id="03596-266">Design the shard key so that the application can easily find the partition if you are implementing horizontal partitioning.</span></span> <span data-ttu-id="03596-267">Так запросу не потребуется проверять каждую секцию.</span><span class="sxs-lookup"><span data-stu-id="03596-267">This prevents the query from having to scan through every partition.</span></span>
   * <span data-ttu-id="03596-268">Учитывайте влияние расположения секции.</span><span class="sxs-lookup"><span data-stu-id="03596-268">Consider the location of a partition.</span></span> <span data-ttu-id="03596-269">Если это возможно, старайтесь хранить данные в секциях, географически близких к использующим их приложениям и пользователям.</span><span class="sxs-lookup"><span data-stu-id="03596-269">If possible, try to keep data in partitions that are geographically close to the applications and users that access it.</span></span>
3. <span data-ttu-id="03596-270">Если у сущности есть требования к пропускной способности и запросам, используйте функциональное секционирование на основе этой сущности.</span><span class="sxs-lookup"><span data-stu-id="03596-270">If an entity has throughput and query performance requirements, use functional partitioning based on that entity.</span></span> <span data-ttu-id="03596-271">Если по-прежнему не удается удовлетворить требования, примените также горизонтальное секционирование.</span><span class="sxs-lookup"><span data-stu-id="03596-271">If this still doesn't satisfy the requirements, apply horizontal partitioning as well.</span></span> <span data-ttu-id="03596-272">В большинстве случаев будет достаточно одной стратегии секционирования, но в некоторых случаях более эффективно будет объединить обе стратегии.</span><span class="sxs-lookup"><span data-stu-id="03596-272">In most cases a single partitioning strategy will suffice, but in some cases it is more efficient to combine both strategies.</span></span>
4. <span data-ttu-id="03596-273">Для повышения производительности рекомендуется использовать асинхронные запросы, которые выполняются параллельно по секциям.</span><span class="sxs-lookup"><span data-stu-id="03596-273">Consider using asynchronous queries that run in parallel across partitions to improve performance.</span></span>

## <a name="designing-partitions-for-availability"></a><span data-ttu-id="03596-274">Проектирование секций для увеличения доступности</span><span class="sxs-lookup"><span data-stu-id="03596-274">Designing partitions for availability</span></span>
<span data-ttu-id="03596-275">Секционирование данных может повысить доступность приложений за счет того, что весь набор данных не составляет единственную точку отказа и что отдельными подмножествами набора данных можно управлять независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="03596-275">Partitioning data can improve the availability of applications by ensuring that the entire dataset does not constitute a single point of failure and that individual subsets of the dataset can be managed independently.</span></span> <span data-ttu-id="03596-276">Доступность можно также повысить за счет репликации секций, содержащих важные данные.</span><span class="sxs-lookup"><span data-stu-id="03596-276">Replicating partitions that contain critical data can also improve availability.</span></span>

<span data-ttu-id="03596-277">При разработке и реализации секций учитывайте следующие факторы, влияющие на доступность.</span><span class="sxs-lookup"><span data-stu-id="03596-277">When designing and implementing partitions, consider the following factors that affect availability:</span></span>

* <span data-ttu-id="03596-278">**Степень важности данных для бизнес-операций.**</span><span class="sxs-lookup"><span data-stu-id="03596-278">**How critical the data is to business operations**.</span></span> <span data-ttu-id="03596-279">Некоторые данные могут представлять собой важные для бизнеса сведения, например сведения о счетах или о банковских переводах.</span><span class="sxs-lookup"><span data-stu-id="03596-279">Some data might include critical business information such as invoice details or bank transactions.</span></span> <span data-ttu-id="03596-280">Другие данные могут быть менее важными рабочими данными, такими как файлы журнала, трассировка производительности и т. д.</span><span class="sxs-lookup"><span data-stu-id="03596-280">Other data might include less critical operational data, such as log files, performance traces, and so on.</span></span> <span data-ttu-id="03596-281">После определения каждого типа данных подумайте о следующем.</span><span class="sxs-lookup"><span data-stu-id="03596-281">After identifying each type of data, consider:</span></span>
  * <span data-ttu-id="03596-282">Можно хранить критически важные данные в секциях высокой доступности с соответствующим планом архивации.</span><span class="sxs-lookup"><span data-stu-id="03596-282">Storing critical data in highly-available partitions with an appropriate backup plan.</span></span>
  * <span data-ttu-id="03596-283">Можно установить отдельные механизмы или процедуры управления и мониторинга для различных степеней важности каждого набора данных.</span><span class="sxs-lookup"><span data-stu-id="03596-283">Establishing separate management and monitoring mechanisms or procedures for the different criticalities of each dataset.</span></span> <span data-ttu-id="03596-284">Можно разместить данные с одинаковым уровнем важности в одной секции, чтобы их можно было архивировать с соответствующей частотой.</span><span class="sxs-lookup"><span data-stu-id="03596-284">Place data that has the same level of criticality in the same partition so that it can be backed up together at an appropriate frequency.</span></span> <span data-ttu-id="03596-285">Например, для секций, содержащих данные о банковских переводах, архивация может требоваться чаще, чем для секций, содержащих данные журналов или трассировки.</span><span class="sxs-lookup"><span data-stu-id="03596-285">For example, partitions that hold data for bank transactions might need to be backed up more frequently than partitions that hold logging or trace information.</span></span>
* <span data-ttu-id="03596-286">**Как можно управлять отдельными секциями**.</span><span class="sxs-lookup"><span data-stu-id="03596-286">**How individual partitions can be managed**.</span></span> <span data-ttu-id="03596-287">Проектирование секций с поддержкой независимых управления и обслуживания обеспечивает ряд преимуществ.</span><span class="sxs-lookup"><span data-stu-id="03596-287">Designing partitions to support independent management and maintenance provides several advantages.</span></span> <span data-ttu-id="03596-288">Например:</span><span class="sxs-lookup"><span data-stu-id="03596-288">For example:</span></span>
  * <span data-ttu-id="03596-289">Если в секции происходит сбой, ее можно восстановить независимо, не затрагивая экземпляры приложений, работающих с данными в других секциях.</span><span class="sxs-lookup"><span data-stu-id="03596-289">If a partition fails, it can be recovered independently without affecting instances of applications that access data in other partitions.</span></span>
  * <span data-ttu-id="03596-290">Секционирование данных по географическому региону позволит запускать запланированные задачи по обслуживанию в непиковые часы для каждого расположения.</span><span class="sxs-lookup"><span data-stu-id="03596-290">Partitioning data by geographical area allows scheduled maintenance tasks to occur at off-peak hours for each location.</span></span> <span data-ttu-id="03596-291">Убедитесь, что секции не слишком велики и их размер не помешает завершить запланированное обслуживание в течение этого периода.</span><span class="sxs-lookup"><span data-stu-id="03596-291">Ensure that partitions are not too big to prevent any planned maintenance from being completed during this period.</span></span>
* <span data-ttu-id="03596-292">**Подумайте, следует ли реплицировать критически важные данные по секциям**.</span><span class="sxs-lookup"><span data-stu-id="03596-292">**Whether to replicate critical data across partitions**.</span></span> <span data-ttu-id="03596-293">Эта стратегия может повысить доступность и производительность, хотя она также может вызвать проблемы согласованности.</span><span class="sxs-lookup"><span data-stu-id="03596-293">This strategy can improve availability and performance, although it can also introduce consistency issues.</span></span> <span data-ttu-id="03596-294">Для синхронизации изменения данных в секции с каждой репликой требуется время.</span><span class="sxs-lookup"><span data-stu-id="03596-294">It takes time for changes made to data in a partition to be synchronized with every replica.</span></span> <span data-ttu-id="03596-295">В течение этого времени различные секции будут содержать разные значения данных.</span><span class="sxs-lookup"><span data-stu-id="03596-295">During this period, different partitions will contain different data values.</span></span>

## <a name="understanding-how-partitioning-affects-design-and-development"></a><span data-ttu-id="03596-296">Сведения о влиянии секционирования на проектирование и разработку</span><span class="sxs-lookup"><span data-stu-id="03596-296">Understanding how partitioning affects design and development</span></span>
<span data-ttu-id="03596-297">Использование секционирования усложняет проектирование и разработку системы.</span><span class="sxs-lookup"><span data-stu-id="03596-297">Using partitioning adds complexity to the design and development of your system.</span></span> <span data-ttu-id="03596-298">Секционирование следует рассматривать как основную часть разработки системы, даже если система изначально содержит только одну секцию.</span><span class="sxs-lookup"><span data-stu-id="03596-298">Consider partitioning as a fundamental part of system design even if the system initially only contains a single partition.</span></span> <span data-ttu-id="03596-299">Обращение к секционированию как к методу решения проблем с производительностью и масштабируемостью системы, возникших после ее запуска, приведет к повышению сложности, так как у вас уже есть действующая система, которую нужно поддерживать.</span><span class="sxs-lookup"><span data-stu-id="03596-299">If you address partitioning as an afterthought, when the system starts to suffer performance and scalability issues, the complexity increases because you already have a live system to maintain.</span></span>

<span data-ttu-id="03596-300">Обновление системы для включения секционирования в этой среде требует не только изменения логики доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="03596-300">If you update the system to incorporate partitioning in this environment, it necessitates modifying the data access logic.</span></span> <span data-ttu-id="03596-301">Оно также может привести к миграции большого количества существующих данных, которые необходимо распределить по секциям. При этом пользователи хотят иметь возможность по-прежнему использовать систему.</span><span class="sxs-lookup"><span data-stu-id="03596-301">It can also involve migrating large quantities of existing data to distribute it across partitions, often while users expect to be able to continue using the system.</span></span>

<span data-ttu-id="03596-302">В некоторых случаях секционирование не считается важным, так как исходный набор данных небольшой и легко обрабатывается на одном сервере.</span><span class="sxs-lookup"><span data-stu-id="03596-302">In some cases, partitioning is not considered important because the initial dataset is small and can be easily handled by a single server.</span></span> <span data-ttu-id="03596-303">Это может быть справедливо, если в системе не планируется масштабирование свыше начального размера, но многим коммерческим системам требуется возможность расширения по мере увеличения числа пользователей.</span><span class="sxs-lookup"><span data-stu-id="03596-303">This might be true in a system that is not expected to scale beyond its initial size, but many commercial systems need to expand as the number of users increases.</span></span> <span data-ttu-id="03596-304">Это расширение обычно сопровождается увеличением объема данных.</span><span class="sxs-lookup"><span data-stu-id="03596-304">This expansion is typically accompanied by a growth in the volume of data.</span></span>

<span data-ttu-id="03596-305">Следует также понимать, что секционирование не всегда связано с хранилищами больших объемов данных.</span><span class="sxs-lookup"><span data-stu-id="03596-305">It's also important to understand that partitioning is not always a function of large data stores.</span></span> <span data-ttu-id="03596-306">Например, небольшое хранилище данных могут использовать сотни параллельных клиентов.</span><span class="sxs-lookup"><span data-stu-id="03596-306">For example, a small data store might be heavily accessed by hundreds of concurrent clients.</span></span> <span data-ttu-id="03596-307">Секционирование данных в этой ситуации может помочь уменьшить количество конфликтов и повысить пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="03596-307">Partitioning the data in this situation can help to reduce contention and improve throughput.</span></span>

<span data-ttu-id="03596-308">При разработке схемы секционирования данных учитывайте следующие моменты.</span><span class="sxs-lookup"><span data-stu-id="03596-308">Consider the following points when you design a data partitioning scheme:</span></span>

* <span data-ttu-id="03596-309">**По возможности храните данные для наиболее распространенных операций базы данных вместе в каждой секции, чтобы свести к минимуму операции доступа к данным из разных секций**.</span><span class="sxs-lookup"><span data-stu-id="03596-309">**Where possible, keep data for the most common database operations together in each partition to minimize cross-partition data access operations**.</span></span> <span data-ttu-id="03596-310">Запросы к разным секциям могут занимать больше времени, чем отправка запросов в рамках одной секции, но оптимизация секций для одного набора запросов может неблагоприятно повлиять на другие наборы запросов.</span><span class="sxs-lookup"><span data-stu-id="03596-310">Querying across partitions can be more time-consuming than querying only within a single partition, but optimizing partitions for one set of queries might adversely affect other sets of queries.</span></span> <span data-ttu-id="03596-311">Чтобы свести к минимуму время запроса к разным секциям там, где этого не избежать, реализуйте параллельные запросы к секциям и статистическую обработку результатов в приложении.</span><span class="sxs-lookup"><span data-stu-id="03596-311">When you can't avoid querying across partitions, minimize query time by running parallel queries and aggregating the results within the application.</span></span> <span data-ttu-id="03596-312">Однако такой подход может оказаться невозможным в некоторых случаях, например, когда это необходимо, чтобы получить результат из одного запроса и использовать его в следующем запросе.</span><span class="sxs-lookup"><span data-stu-id="03596-312">This approach might not be possible in some cases, such as when it's necessary to obtain a result from one query and use it in the next query.</span></span>
* <span data-ttu-id="03596-313">**Если запросы используют относительно статические справочные данные, например таблицы почтовых индексов или списки продуктов, подумайте о репликации этих данных во всех секциях, чтобы снизить потребность в отдельных операциях уточняющих запросов в другие секции**.</span><span class="sxs-lookup"><span data-stu-id="03596-313">**If queries make use of relatively static reference data, such as postal code tables or product lists, consider replicating this data in all of the partitions to reduce the requirement for separate lookup operations in different partitions**.</span></span> <span data-ttu-id="03596-314">Этот подход также может уменьшить вероятность того, что справочные данные станут "горячим" набором данных, который подвергается значительному трафику из всех точек системы.</span><span class="sxs-lookup"><span data-stu-id="03596-314">This approach can also reduce the likelihood of the reference data becoming a "hot" dataset that is subject to heavy traffic from across the entire system.</span></span> <span data-ttu-id="03596-315">Однако существуют дополнительные затраты, связанные с синхронизацией любых изменений этих справочных данных.</span><span class="sxs-lookup"><span data-stu-id="03596-315">However,   there is an additional cost associated with synchronizing any changes that might occur to this reference data.</span></span>
* <span data-ttu-id="03596-316">**По возможности сведите к минимуму требования для обеспечения целостности данных для вертикальных и функциональных секций**.</span><span class="sxs-lookup"><span data-stu-id="03596-316">**Where possible, minimize requirements for referential integrity across vertical and functional partitions**.</span></span> <span data-ttu-id="03596-317">В этих схемах само приложение отвечает за обеспечение целостности данных в секциях, когда данные обновляются и потребляются.</span><span class="sxs-lookup"><span data-stu-id="03596-317">In these schemes, the application itself is responsible for maintaining referential integrity across partitions when data is updated and consumed.</span></span> <span data-ttu-id="03596-318">Запросы, которые должны объединить данные из нескольких секций, выполняются медленнее, чем запросы, которые объединяют данные только из одной секции, поскольку приложению обычно требуется выполнить последовательные запросы на основе ключа, а затем на основе внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="03596-318">Queries that must join data across multiple partitions run more slowly than queries that join data only within the same partition because the application typically needs to perform consecutive queries based on a key and then on a foreign key.</span></span> <span data-ttu-id="03596-319">Вместо этого рассмотрите возможность репликации или денормализации соответствующих данных.</span><span class="sxs-lookup"><span data-stu-id="03596-319">Instead, consider replicating or de-normalizing the relevant data.</span></span> <span data-ttu-id="03596-320">Чтобы свести к минимуму время запроса там, где необходимы соединения между секциями, реализуйте параллельные запросы из разных секций и объединение данных внутри приложения.</span><span class="sxs-lookup"><span data-stu-id="03596-320">To minimize the query time where cross-partition joins are necessary, run parallel queries over the partitions and join the data within the application.</span></span>
* <span data-ttu-id="03596-321">**Учитывайте влияние схемы секционирования на согласованность данных в секциях.**</span><span class="sxs-lookup"><span data-stu-id="03596-321">**Consider the effect that the partitioning scheme might have on the data consistency across partitions.**</span></span> <span data-ttu-id="03596-322">Следует оценить, является ли строгое согласование обязательным.</span><span class="sxs-lookup"><span data-stu-id="03596-322">Evaluate whether strong consistency is actually a requirement.</span></span> <span data-ttu-id="03596-323">Обычно стандартный подход в облаке заключается в реализации окончательной согласованности.</span><span class="sxs-lookup"><span data-stu-id="03596-323">Instead, a common approach in the cloud is to implement eventual consistency.</span></span> <span data-ttu-id="03596-324">Данные в каждой секции обновляются отдельно, а логика приложения может нести ответственность за обеспечение успешного завершения обновлений.</span><span class="sxs-lookup"><span data-stu-id="03596-324">The data in each partition is updated separately, and the application logic ensures that the updates are all completed successfully.</span></span> <span data-ttu-id="03596-325">Она также обрабатывает несоответствия, которые могут возникнуть после запроса данных во время выполнения операции согласования.</span><span class="sxs-lookup"><span data-stu-id="03596-325">It also handles the inconsistencies that can arise from querying data while an eventually consistent operation is running.</span></span> <span data-ttu-id="03596-326">Дополнительные сведения о реализации окончательной согласованности см. в [руководстве по согласованности данных].</span><span class="sxs-lookup"><span data-stu-id="03596-326">For more information about implementing eventual consistency, see the [Data consistency primer].</span></span>
* <span data-ttu-id="03596-327">**Подумайте, как запросы будут находить правильную секцию**.</span><span class="sxs-lookup"><span data-stu-id="03596-327">**Consider how queries locate the correct partition**.</span></span> <span data-ttu-id="03596-328">Если запрос должен сканировать все секции, чтобы найти требуемые данные, это сильно повлияет на производительность даже при выполнении нескольких параллельных запросов.</span><span class="sxs-lookup"><span data-stu-id="03596-328">If a query must scan all partitions to locate the required data, there is a significant impact on performance, even when multiple parallel queries are running.</span></span> <span data-ttu-id="03596-329">Запросы, используемые с вертикальной и функциональной стратегиями секционирования, могут естественным образом указывать секции.</span><span class="sxs-lookup"><span data-stu-id="03596-329">Queries that are used with vertical and functional partitioning strategies can naturally specify the partitions.</span></span> <span data-ttu-id="03596-330">Однако при использовании горизонтального секционирования (сегментирования) поиск элемента может быть затруднен, так как каждый сегмент имеет ту же схему.</span><span class="sxs-lookup"><span data-stu-id="03596-330">However, horizontal partitioning (sharding) can make locating an item difficult because every shard has the same schema.</span></span> <span data-ttu-id="03596-331">Стандартное решение для сегментирования — поддерживать карту, которую можно использовать для поиска определенных элементов данных в сегменте.</span><span class="sxs-lookup"><span data-stu-id="03596-331">A typical solution for sharding is to maintain a map that can be used to look up the shard location for specific items of data.</span></span> <span data-ttu-id="03596-332">Эту карту можно реализовать в логике сегментирования приложения или поддерживать в хранилище данных, если оно поддерживает прозрачное сегментирование.</span><span class="sxs-lookup"><span data-stu-id="03596-332">This map can be implemented in the sharding logic of the application, or maintained by the data store if it supports transparent sharding.</span></span>
* <span data-ttu-id="03596-333">**При использовании стратегии горизонтального секционирования рекомендуется периодически балансировать нагрузку сегментов**.</span><span class="sxs-lookup"><span data-stu-id="03596-333">**When using a horizontal partitioning strategy, consider periodically rebalancing the shards**.</span></span> <span data-ttu-id="03596-334">Это позволит равномерно распределять данные по размеру и рабочей нагрузке и свести к минимуму горячие точки, повысить производительность выполнения запросов и обойти ограничения физического хранилища.</span><span class="sxs-lookup"><span data-stu-id="03596-334">This helps distribute the data evenly by size and by workload to minimize hotspots, maximize query performance, and work around physical storage limitations.</span></span> <span data-ttu-id="03596-335">Однако это сложная задача, которая часто требует использования пользовательских средств или процессов.</span><span class="sxs-lookup"><span data-stu-id="03596-335">However, this is a complex task that often requires the use of a custom tool or process.</span></span>
* <span data-ttu-id="03596-336">**Репликация каждой из секций обеспечивает дополнительную защиту от сбоев**.</span><span class="sxs-lookup"><span data-stu-id="03596-336">**If you replicate each partition, it provides additional protection against failure**.</span></span> <span data-ttu-id="03596-337">В случае сбоя одной реплики запросы могут направляться на рабочую копию.</span><span class="sxs-lookup"><span data-stu-id="03596-337">If a single replica fails, queries can be directed towards a working copy.</span></span>
* <span data-ttu-id="03596-338">**При достижении физических ограничений стратегии секционирования может потребоваться расширить масштабируемость до другого уровня**.</span><span class="sxs-lookup"><span data-stu-id="03596-338">**If you reach the physical limits of a partitioning strategy, you might need to extend the scalability to a different level**.</span></span> <span data-ttu-id="03596-339">Например, если секционирование находится на уровне базы данных, может потребоваться разместить или реплицировать секции в нескольких базах данных.</span><span class="sxs-lookup"><span data-stu-id="03596-339">For example, if partitioning is at the database level, you might need to locate or replicate partitions in multiple databases.</span></span> <span data-ttu-id="03596-340">Если секционирование уже находится на уровне базы данных и физические ограничения стали проблемой, это может означать необходимость размещения или репликации секций в нескольких учетных записях.</span><span class="sxs-lookup"><span data-stu-id="03596-340">If partitioning is already at the database level, and physical limitations are an issue, it might mean that you need to locate or replicate partitions in multiple hosting accounts.</span></span>
* <span data-ttu-id="03596-341">**Избегайте транзакций, осуществляющих доступ к данным в нескольких секциях**.</span><span class="sxs-lookup"><span data-stu-id="03596-341">**Avoid transactions that access data in multiple partitions**.</span></span> <span data-ttu-id="03596-342">Некоторые хранилища данных реализуют согласованность и целостность транзакций для операций, которые изменяют данные, но только в том случае, когда они находятся в одной секции.</span><span class="sxs-lookup"><span data-stu-id="03596-342">Some data stores implement transactional consistency and integrity for operations that modify data, but only when the data is located in a single partition.</span></span> <span data-ttu-id="03596-343">Если требуется поддержка транзакций с использованием нескольких секций, возможно, потребуется реализовать это как часть логики приложения, поскольку большая часть систем секционирования не обеспечивает встроенную поддержку.</span><span class="sxs-lookup"><span data-stu-id="03596-343">If you need transactional support across multiple partitions, you will probably need to implement this as part of your application logic because most partitioning systems do not provide native support.</span></span>

<span data-ttu-id="03596-344">Все хранилища данных требуют некоторого оперативного управления и наблюдения за активностью.</span><span class="sxs-lookup"><span data-stu-id="03596-344">All data stores require some operational management and monitoring activity.</span></span> <span data-ttu-id="03596-345">Задачи могут варьироваться от загрузки данных, резервного копирования и восстановления данных до реорганизации данных и обеспечения правильной и эффективной работы системы.</span><span class="sxs-lookup"><span data-stu-id="03596-345">The tasks can range from loading data, backing up and restoring data, reorganizing data, and ensuring that the system is performing correctly and efficiently.</span></span>

<span data-ttu-id="03596-346">Учитывайте следующие факторы, влияющие на оперативное управление.</span><span class="sxs-lookup"><span data-stu-id="03596-346">Consider the following factors that affect operational management:</span></span>

* <span data-ttu-id="03596-347">**Как при секционировании данных реализовать соответствующее управление и рабочие задачи**.</span><span class="sxs-lookup"><span data-stu-id="03596-347">**How to implement appropriate management and operational tasks when the data is partitioned**.</span></span> <span data-ttu-id="03596-348">В число этих задач могут входить архивация и восстановление, архивация данных, мониторинг системы и других задач администрирования.</span><span class="sxs-lookup"><span data-stu-id="03596-348">These tasks might include backup and restore, archiving data, monitoring the system, and other administrative tasks.</span></span> <span data-ttu-id="03596-349">Например, сохранение логического соответствия во время операций резервного копирования и восстановления может оказаться непростой задачей.</span><span class="sxs-lookup"><span data-stu-id="03596-349">For example, maintaining logical consistency during backup and restore operations can be a challenge.</span></span>
* <span data-ttu-id="03596-350">**Как можно загружать данные в несколько секций и как добавлять новые данные, поступающие из других источников**.</span><span class="sxs-lookup"><span data-stu-id="03596-350">**How to load the data into multiple partitions and add new data that's arriving from other sources**.</span></span> <span data-ttu-id="03596-351">Некоторые средства и служебные программы могут не поддерживать операции с сегментированными данными, например загрузку в нужную секцию.</span><span class="sxs-lookup"><span data-stu-id="03596-351">Some tools and utilities might not support sharded data operations such as loading data into the correct partition.</span></span> <span data-ttu-id="03596-352">Поэтому такие операции могут потребовать создания или приобретения новых средств и служебных программ.</span><span class="sxs-lookup"><span data-stu-id="03596-352">This means that you might have to create or obtain new tools and utilities.</span></span>
* <span data-ttu-id="03596-353">**Как будут архивироваться и удаляться данные на регулярной основе**.</span><span class="sxs-lookup"><span data-stu-id="03596-353">**How to archive and delete the data on a regular basis**.</span></span> <span data-ttu-id="03596-354">Для предотвращения чрезмерного увеличения размера секций необходимо регулярно архивировать и обновлять данные (возможно, раз в месяц).</span><span class="sxs-lookup"><span data-stu-id="03596-354">To prevent the excessive growth of partitions, you need to archive and delete data on a regular basis (perhaps monthly).</span></span> <span data-ttu-id="03596-355">Очевидно, потребуется преобразовать данные, чтобы обеспечить соответствие другой схеме архивирования.</span><span class="sxs-lookup"><span data-stu-id="03596-355">It might be necessary to transform the data to match a different archive schema.</span></span>
* <span data-ttu-id="03596-356">**Как обнаруживать проблемы целостности данных**.</span><span class="sxs-lookup"><span data-stu-id="03596-356">**How to locate data integrity issues**.</span></span> <span data-ttu-id="03596-357">Рассмотрите возможность выполнения периодического процесса для обнаружения любых проблем целостности данных, например, когда данные в одной секции ссылаются на данные в другой, но эти данные отсутствуют.</span><span class="sxs-lookup"><span data-stu-id="03596-357">Consider running a periodic process to locate any data integrity issues such as data in one partition that references missing information in another.</span></span> <span data-ttu-id="03596-358">Процесс может либо попытаться устранить эти проблемы автоматически, либо создать оповещение оператора для устранения неполадок вручную.</span><span class="sxs-lookup"><span data-stu-id="03596-358">The process can either attempt to fix these issues automatically or raise an alert to an operator to correct the problems manually.</span></span> <span data-ttu-id="03596-359">Например, в приложении электронной коммерции сведения о заказах могут храниться в одной секции, а элементы строк, которые составляют каждый заказ, — в другой.</span><span class="sxs-lookup"><span data-stu-id="03596-359">For example, in an e-commerce application, order information might be held in one partition but the line items that constitute each order might be held in another.</span></span> <span data-ttu-id="03596-360">В процессе размещения заказа необходимо добавить данные к обеим секциям.</span><span class="sxs-lookup"><span data-stu-id="03596-360">The process of placing an order needs to add data to other partitions.</span></span> <span data-ttu-id="03596-361">Если этот процесс завершается ошибкой, могут быть сохранены элементы строк, для которых отсутствует соответствующий заказ.</span><span class="sxs-lookup"><span data-stu-id="03596-361">If this process fails, there might be line items stored for which there is no corresponding order.</span></span>

<span data-ttu-id="03596-362">Разные технологии хранения данных обычно предоставляют свои собственные функции для поддержки секционирования.</span><span class="sxs-lookup"><span data-stu-id="03596-362">Different data storage technologies typically provide their own features to support partitioning.</span></span> <span data-ttu-id="03596-363">В следующих разделах рассматриваются возможности, реализуемые хранилищами данных и часто используемые приложениями Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-363">The following sections summarize the options that are implemented by data stores commonly used by Azure applications.</span></span> <span data-ttu-id="03596-364">В них также содержатся рекомендации по разработке приложений с использованием преимуществ этих функций.</span><span class="sxs-lookup"><span data-stu-id="03596-364">They also describe considerations for designing applications that can best take advantage of these features.</span></span>

## <a name="partitioning-strategies-for-azure-sql-database"></a><span data-ttu-id="03596-365">Стратегии секционирования для базы данных SQL Azure</span><span class="sxs-lookup"><span data-stu-id="03596-365">Partitioning strategies for Azure SQL Database</span></span>
<span data-ttu-id="03596-366">База данных SQL Azure является реляционной базой данных, которая предоставляется как служба, работающая в облаке.</span><span class="sxs-lookup"><span data-stu-id="03596-366">Azure SQL Database is a relational database-as-a-service that runs in the cloud.</span></span> <span data-ttu-id="03596-367">Она основана на Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="03596-367">It is based on Microsoft SQL Server.</span></span> <span data-ttu-id="03596-368">Реляционная база данных делит данные на таблицы, и каждая таблица содержит сведения о сущностях в виде набора строк.</span><span class="sxs-lookup"><span data-stu-id="03596-368">A relational database divides information into tables, and each table holds information about entities as a series of rows.</span></span> <span data-ttu-id="03596-369">Каждая строка содержит столбцы, которые предоставляют данные для отдельных полей сущности.</span><span class="sxs-lookup"><span data-stu-id="03596-369">Each row contains columns that hold the data for the individual fields of an entity.</span></span> <span data-ttu-id="03596-370">Подробную документацию по созданию и использованию базы данных SQL см. на странице [Что такое база данных SQL? Введение в базы данных SQL] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-370">The page [What is Azure SQL Database?] on the Microsoft website provides detailed documentation about creating and using SQL databases.</span></span>

## <a name="horizontal-partitioning-with-elastic-database"></a><span data-ttu-id="03596-371">Горизонтальное секционирование с использованием эластичной базы данных</span><span class="sxs-lookup"><span data-stu-id="03596-371">Horizontal partitioning with Elastic Database</span></span>
<span data-ttu-id="03596-372">Одна база данных SQL имеет ограничение на объем содержащихся в ней данных.</span><span class="sxs-lookup"><span data-stu-id="03596-372">A single SQL database has a limit to the volume of data that it can contain.</span></span> <span data-ttu-id="03596-373">Пропускная способность ограничена архитектурными факторами и числом поддерживаемых одновременных подключений.</span><span class="sxs-lookup"><span data-stu-id="03596-373">Throughput is constrained by architectural factors and the number of concurrent connections that it supports.</span></span> <span data-ttu-id="03596-374">База данных SQL Azure предоставляет эластичную базу данных для поддержки горизонтального масштабирования базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="03596-374">The Elastic Database feature of SQL Database supports horizontal scaling for a SQL database.</span></span> <span data-ttu-id="03596-375">С помощью эластичной базы данных вы можете секционировать данные в сегменты, которые распределены между несколькими базами данных SQL.</span><span class="sxs-lookup"><span data-stu-id="03596-375">Using Elastic Database, you can partition your data into shards that are spread across multiple SQL databases.</span></span> <span data-ttu-id="03596-376">Можно также добавлять или удалять сегменты по мере роста или уменьшения объема обрабатываемых данных.</span><span class="sxs-lookup"><span data-stu-id="03596-376">You can also add or remove shards as the volume of data that you need to handle grows and shrinks.</span></span> <span data-ttu-id="03596-377">Кроме того, использование эластичной базы данных помогает уменьшить количество конфликтов за счет распределения нагрузки между базами данных.</span><span class="sxs-lookup"><span data-stu-id="03596-377">Using Elastic Database can also help reduce contention by distributing the load across databases.</span></span>

> [!NOTE]
> <span data-ttu-id="03596-378">Эластичная база данных заменяет федерации базы данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-378">Elastic Database is a replacement for the Federations feature of Azure SQL Database.</span></span> <span data-ttu-id="03596-379">Установленную федерацию базы данных SQL можно перенести в эластичную базу данных с помощью программы миграции федераций.</span><span class="sxs-lookup"><span data-stu-id="03596-379">Existing SQL Database Federation installations can be migrated to Elastic Database by using the Federations migration utility.</span></span> <span data-ttu-id="03596-380">Кроме того, вы можете реализовать собственный механизм сегментирования, если ваш сценарий не использует естественным образом функции, предоставляемые эластичной базой данных.</span><span class="sxs-lookup"><span data-stu-id="03596-380">Alternatively, you can implement your own sharding mechanism if your scenario does not lend itself naturally to the features that are provided by Elastic Database.</span></span>
>
>

<span data-ttu-id="03596-381">Каждый сегмент реализуется как база данных SQL.</span><span class="sxs-lookup"><span data-stu-id="03596-381">Each shard is implemented as a SQL database.</span></span> <span data-ttu-id="03596-382">Сегмент может содержать более одного набора данных (называемого *шардлетом*).</span><span class="sxs-lookup"><span data-stu-id="03596-382">A shard can hold more than one dataset (referred to as a *shardlet*).</span></span> <span data-ttu-id="03596-383">Каждая база данных хранит метаданные, которые описывают содержащиеся в ней шардлеты.</span><span class="sxs-lookup"><span data-stu-id="03596-383">Each database maintains metadata that describes the shardlets that it contains.</span></span> <span data-ttu-id="03596-384">Шардлет может быть отдельным элементом данных или группой элементов, которые совместно используют один и тот же ключ шардлета.</span><span class="sxs-lookup"><span data-stu-id="03596-384">A shardlet can be a single data item, or it can be a group of items that share the same shardlet key.</span></span> <span data-ttu-id="03596-385">Например, если вы сегментируете данные в приложении с несколькими клиентами, ключом шардлета может быть идентификатор клиента, и все данные для данного клиента будут храниться в рамках одного шардлета.</span><span class="sxs-lookup"><span data-stu-id="03596-385">For example, if you are sharding data in a multitenant application, the shardlet key can be the tenant ID, and all data for a given tenant can be held as part of the same shardlet.</span></span> <span data-ttu-id="03596-386">Данные для других клиентов будут храниться в других шардлетах.</span><span class="sxs-lookup"><span data-stu-id="03596-386">Data for other tenants would be held in different shardlets.</span></span>

<span data-ttu-id="03596-387">Программист должен связать набор данных с ключом шардлета.</span><span class="sxs-lookup"><span data-stu-id="03596-387">It is the programmer's responsibility to associate a dataset with a shardlet key.</span></span> <span data-ttu-id="03596-388">Отдельная база данных SQL выступает в роли глобального диспетчера сопоставления сегментов.</span><span class="sxs-lookup"><span data-stu-id="03596-388">A separate SQL database acts as a global shard map manager.</span></span> <span data-ttu-id="03596-389">Эта база данных содержит список всех сегментов и шардлетов в системе.</span><span class="sxs-lookup"><span data-stu-id="03596-389">This database contains a list of all the shards and shardlets in the system.</span></span> <span data-ttu-id="03596-390">Клиентское приложение, которое обращается к данным, сначала подключается к базе данных глобального диспетчера сопоставления сегментов для получения копии карты сегментов (списка сегментов и шардлетов), которую оно кэширует локально.</span><span class="sxs-lookup"><span data-stu-id="03596-390">A client application that accesses data connects first to the global shard map manager database to obtain a copy of the shard map (listing shards and shardlets), which it then caches locally.</span></span>

<span data-ttu-id="03596-391">Затем приложение использует эти сведения для направления запросов данных к соответствующему сегменту.</span><span class="sxs-lookup"><span data-stu-id="03596-391">The application then uses this information to route data requests to the appropriate shard.</span></span> <span data-ttu-id="03596-392">Эта функциональность скрыта за рядом API-интерфейсов, содержащихся в клиентской библиотеке эластичной базы данных базы данных SQL Azure, доступной в виде пакета NuGet.</span><span class="sxs-lookup"><span data-stu-id="03596-392">This functionality is hidden behind a series of APIs that are contained in the Azure SQL Database Elastic Database Client Library, which is available as a NuGet package.</span></span> <span data-ttu-id="03596-393">Дополнительные сведения об эластичной базе данных см. на странице [Развертывание с помощью Базы данных SQL Azure] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-393">The page [Elastic Database features overview] on the Microsoft website provides a more comprehensive introduction to Elastic Database.</span></span>

> [!NOTE]
> <span data-ttu-id="03596-394">Можно реплицировать базу данных глобального диспетчера сопоставления сегментов для сокращения задержки и повышения доступности.</span><span class="sxs-lookup"><span data-stu-id="03596-394">You can replicate the global shard map manager database to reduce latency and improve availability.</span></span> <span data-ttu-id="03596-395">При реализации базы данных с помощью одной из ценовых категорий "Премиум" можно настроить активную георепликацию для непрерывного копирования данных в базы данных в разных регионах.</span><span class="sxs-lookup"><span data-stu-id="03596-395">If you implement the database by using one of the Premium pricing tiers, you can configure active geo-replication to continuously copy data to databases in different regions.</span></span> <span data-ttu-id="03596-396">Создайте копию базы данных в каждом регионе, где есть пользователи.</span><span class="sxs-lookup"><span data-stu-id="03596-396">Create a copy of the database in each region in which users are based.</span></span> <span data-ttu-id="03596-397">Затем настройте приложение на подключение к этой копии для получения карты сегментов.</span><span class="sxs-lookup"><span data-stu-id="03596-397">Then configure your application to connect to this copy to obtain the shard map.</span></span>
>
> <span data-ttu-id="03596-398">В качестве альтернативы можно использовать синхронизацию данных SQL Azure или конвейер фабрики данных Azure для репликации базы данных диспетчера сопоставления сегментов по регионам.</span><span class="sxs-lookup"><span data-stu-id="03596-398">An alternative approach is to use Azure SQL Data Sync or an Azure Data Factory pipeline to replicate the shard map manager database across regions.</span></span> <span data-ttu-id="03596-399">Эта форма репликации запускается периодически и лучше подходит, если карта сегментов изменяется редко.</span><span class="sxs-lookup"><span data-stu-id="03596-399">This form of replication runs periodically and is more suitable if the shard map changes infrequently.</span></span> <span data-ttu-id="03596-400">Кроме того, базу данных диспетчера сопоставления сегментов не обязательно создавать с помощью ценовой категории "Премиум".</span><span class="sxs-lookup"><span data-stu-id="03596-400">Additionally, the shard map manager database does not have to be created by using a Premium pricing tier.</span></span>
>
>

<span data-ttu-id="03596-401">Эластичная база данных предоставляет две схемы для сопоставления данных и шардлетов и их хранения в сегментах.</span><span class="sxs-lookup"><span data-stu-id="03596-401">Elastic Database provides two schemes for mapping data to shardlets and storing them in shards:</span></span>

* <span data-ttu-id="03596-402">**Карта сегментов в виде списка** описывает связь между одним ключом и шардлетом.</span><span class="sxs-lookup"><span data-stu-id="03596-402">A **list shard map** describes an association between a single key and a shardlet.</span></span> <span data-ttu-id="03596-403">Например, в мультитенантной системе данные для каждого клиента могут быть связаны с уникальным ключом и храниться в собственном шардлете.</span><span class="sxs-lookup"><span data-stu-id="03596-403">For example, in a multitenant system, the data for each tenant can be associated with a unique key and stored in its own shardlet.</span></span> <span data-ttu-id="03596-404">Для обеспечения конфиденциальности и изоляции (чтобы предотвратить истощение одним клиентом ресурсов хранилища данных, доступных другим пользователям) каждый шардлет может храниться в собственном сегменте.</span><span class="sxs-lookup"><span data-stu-id="03596-404">To guarantee privacy and isolation (that is, to prevent one tenant from exhausting the data storage resources available to others), each shardlet can be held within its own shard.</span></span>

![Использование карты сегментов в виде списка для хранения данных клиента в отдельных сегментах](./images/data-partitioning/PointShardlet.png)

<span data-ttu-id="03596-406">*Рис. 4. Использование карты сегментов в виде списка для хранения данных клиента в отдельных сегментах*</span><span class="sxs-lookup"><span data-stu-id="03596-406">*Figure 4. Using a list shard map to store tenant data in separate shards*</span></span>

* <span data-ttu-id="03596-407">**Карта сегментов в виде диапазона** описывает связь между набором непрерывных значений ключа и шардлетом.</span><span class="sxs-lookup"><span data-stu-id="03596-407">A **range shard map** describes an association between a set of contiguous key values and a shardlet.</span></span> <span data-ttu-id="03596-408">В описанном ранее примере многопользовательской системы в качестве альтернативы реализации выделенных шардлетов можно группировать данные для набора клиентов (каждый из которых имеет собственный ключ) в пределах одного шардлета.</span><span class="sxs-lookup"><span data-stu-id="03596-408">In the multitenant example described previously, as an alternative to implementing dedicated shardlets, you can group the data for a set of tenants (each with their own key) within the same shardlet.</span></span> <span data-ttu-id="03596-409">Эта схема дешевле первой (клиенты совместно используют ресурсы хранилища данных), но есть риск снижения конфиденциальности и изоляции данных.</span><span class="sxs-lookup"><span data-stu-id="03596-409">This scheme is less expensive than the first (because tenants share data storage resources), but it also creates a risk of reduced data privacy and isolation.</span></span>

![Использование карты сегментов в виде диапазона для хранения данных диапазона клиентов в сегменте](./images/data-partitioning/RangeShardlet.png)

<span data-ttu-id="03596-411">*Рис. 5. Использование карты сегментов в виде диапазона для хранения данных диапазона клиентов в сегменте*</span><span class="sxs-lookup"><span data-stu-id="03596-411">*Figure 5. Using a range shard map to store data for a range of tenants in a shard*</span></span>

<span data-ttu-id="03596-412">Обратите внимание, что один сегмент может содержать данные для нескольких шардлетов.</span><span class="sxs-lookup"><span data-stu-id="03596-412">Note that a single shard can contain the data for several shardlets.</span></span> <span data-ttu-id="03596-413">Например, можно использовать шардлеты в виде списка для хранения данных разных несмежных клиентов в одном сегменте.</span><span class="sxs-lookup"><span data-stu-id="03596-413">For example, you can use list shardlets to store data for different non-contiguous tenants in the same shard.</span></span> <span data-ttu-id="03596-414">Можно также смешивать шардлеты в виде диапазона и шардлеты в виде списка в одном сегменте несмотря на то, что они будут использоваться через разные карты в базе данных глобального диспетчера карт сегментов.</span><span class="sxs-lookup"><span data-stu-id="03596-414">You can also mix range shardlets and list shardlets in the same shard, although they will be addressed through different maps in the global shard map manager database.</span></span> <span data-ttu-id="03596-415">(База данных глобального диспетчера карт сегментов может содержать несколько карт сегментов.) Рис. 6 демонстрирует этот подход.</span><span class="sxs-lookup"><span data-stu-id="03596-415">(The global shard map manager database can contain multiple shard maps.) Figure 6 depicts this approach.</span></span>

![Реализация нескольких карт сегментов](./images/data-partitioning/MultipleShardMaps.png)

<span data-ttu-id="03596-417">*Рис. 6. Реализация нескольких карт сегментов*</span><span class="sxs-lookup"><span data-stu-id="03596-417">*Figure 6. Implementing multiple shard maps*</span></span>

<span data-ttu-id="03596-418">Реализованная вами схема секционирования может значительно повлиять на производительность системы.</span><span class="sxs-lookup"><span data-stu-id="03596-418">The partitioning scheme that you implement can have a significant bearing on the performance of your system.</span></span> <span data-ttu-id="03596-419">Она также влияет на скорость добавления или удаления сегментов и повторного секционирования данных по сегментам.</span><span class="sxs-lookup"><span data-stu-id="03596-419">It can also affect the rate at which shards have to be added or removed, or the rate at which data must be repartitioned across shards.</span></span> <span data-ttu-id="03596-420">При использовании эластичной базы данных для секционирования данных учитывайте приведенные далее моменты.</span><span class="sxs-lookup"><span data-stu-id="03596-420">Consider the following points when you use Elastic Database to partition data:</span></span>

* <span data-ttu-id="03596-421">Группируйте данные, используемые вместе, в одном сегменте и избегайте операций, которым требуется доступ к данным, хранящимся в нескольких сегментах.</span><span class="sxs-lookup"><span data-stu-id="03596-421">Group data that is used together in the same shard, and avoid operations that need to access data that's held in multiple shards.</span></span> <span data-ttu-id="03596-422">Имейте в виду, что при использовании эластичной базы данных сегмент сам по себе является базой данных SQL, а база данных SQL Azure не поддерживает межбазовые соединения. Эти операции должны выполняться на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="03596-422">Keep in mind that with Elastic Database, a shard is a SQL database in its own right, and Azure SQL Database does not support cross-database joins (which have to be performed on the client side).</span></span> <span data-ttu-id="03596-423">Также следует помнить, что в базе данных SQL Azure ограничения целостности данных, триггеры и хранимые процедуры в одной базе данных не могут ссылаться на объекты в другой.</span><span class="sxs-lookup"><span data-stu-id="03596-423">Remember also that in Azure SQL Database, referential integrity constraints, triggers, and stored procedures in one database cannot reference objects in another.</span></span> <span data-ttu-id="03596-424">Поэтому не разрабатывайте систему, в которой есть зависимости между сегментами.</span><span class="sxs-lookup"><span data-stu-id="03596-424">Therefore, don't design a system that has dependencies between shards.</span></span> <span data-ttu-id="03596-425">Однако база данных SQL может включать таблицы, содержащие копии справочных данных, часто используемых в запросах и других операциях.</span><span class="sxs-lookup"><span data-stu-id="03596-425">A SQL database can, however, contain tables that hold copies of reference data frequently used by queries and other operations.</span></span> <span data-ttu-id="03596-426">Эти таблицы не всегда принадлежат какому-либо конкретному шардлету.</span><span class="sxs-lookup"><span data-stu-id="03596-426">These tables do not have to belong to any specific shardlet.</span></span> <span data-ttu-id="03596-427">Репликация данных по сегментам поможет устранить необходимость объединения данных, охватывающих базы данных.</span><span class="sxs-lookup"><span data-stu-id="03596-427">Replicating this data across shards can help remove the need to join data that spans databases.</span></span> <span data-ttu-id="03596-428">В идеальном случае такие данные должны быть статическими или медленно изменяющимися, чтобы максимально упростить репликацию и снизить вероятность устаревания изменений.</span><span class="sxs-lookup"><span data-stu-id="03596-428">Ideally, such data should be static or slow-moving to minimize the replication effort and reduce the chances of it becoming stale.</span></span>

  > [!NOTE]
  > <span data-ttu-id="03596-429">Несмотря на то, что база данных SQL Azure не поддерживает межбазовые соединения, API эластичной базы данных позволяет выполнять запросы к нескольким сегментам.</span><span class="sxs-lookup"><span data-stu-id="03596-429">Although SQL Database does not support cross-database joins, you can perform cross-shard queries with the Elastic Database API.</span></span> <span data-ttu-id="03596-430">Эти запросы обеспечивают прозрачную итерацию данных, содержащихся во всех шардлетах, на которые ссылается карта сегментов.</span><span class="sxs-lookup"><span data-stu-id="03596-430">These queries can transparently iterate through the data held in all the shardlets that are referenced by a shard map.</span></span> <span data-ttu-id="03596-431">API эластичной базы данных разбивает запросы к нескольким сегментам на ряд отдельных запросов (по одному для каждой базы данных) и объединяет результаты.</span><span class="sxs-lookup"><span data-stu-id="03596-431">The Elastic Database API breaks cross-shard queries down into a series of individual queries (one for each database) and then merges the results.</span></span> <span data-ttu-id="03596-432">Дополнительные сведения см. на странице [Многосегментное формирование запросов] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-432">For more information, see the page [Multi-shard querying] on the Microsoft website.</span></span>
  >
  >
* <span data-ttu-id="03596-433">Данные, хранящиеся в шардлетах, принадлежащих к одной карте сегментов, должны иметь одинаковую схему.</span><span class="sxs-lookup"><span data-stu-id="03596-433">The data stored in shardlets that belong to the same shard map should have the same schema.</span></span> <span data-ttu-id="03596-434">Например, не стоит создавать карту сегментов в виде списка, которая указывает на некоторые шардлеты, содержащие данные клиента, и на другие шардлеты, содержащие сведения о продукте.</span><span class="sxs-lookup"><span data-stu-id="03596-434">For example, don't create a list shard map that points to some shardlets containing tenant data and other shardlets containing product information.</span></span> <span data-ttu-id="03596-435">Эластичная база данных не навязывает это правило, но управление данными и запросами становится очень сложным, если у всех шардлетов разные схемы.</span><span class="sxs-lookup"><span data-stu-id="03596-435">This rule is not enforced by Elastic Database, but data management and querying becomes very complex if each shardlet has a different schema.</span></span> <span data-ttu-id="03596-436">В примере выше хорошим решением будет создать две карты сегментов в виде списка: одну со ссылками на сведения о клиенте, а другую — на сведения о продукте.</span><span class="sxs-lookup"><span data-stu-id="03596-436">In the example just cited, a good solution is to create two list shard maps: one that references tenant data and another that points to product information.</span></span> <span data-ttu-id="03596-437">Помните, что данные, принадлежащие к разным шардлетам, можно хранить в одном сегменте.</span><span class="sxs-lookup"><span data-stu-id="03596-437">Remember that the data belonging to different shardlets can be stored in the same shard.</span></span>

  > [!NOTE]
  > <span data-ttu-id="03596-438">Функциональность межсегментных запросов в API эластичной базы данных зависит от каждого шардлета в схеме сегментирования, содержащей одну и ту же схему.</span><span class="sxs-lookup"><span data-stu-id="03596-438">The cross-shard query functionality of the Elastic Database API depends on each shardlet in the shard map containing the same schema.</span></span>
  >
  >
* <span data-ttu-id="03596-439">Транзакционные операции поддерживаются только для данных, хранящихся в пределах одного сегмента, но не между сегментами.</span><span class="sxs-lookup"><span data-stu-id="03596-439">Transactional operations are only supported for data that's held within the same shard, and not across shards.</span></span> <span data-ttu-id="03596-440">Транзакции могут охватывать шардлеты при условии, что они являются частью одного сегмента.</span><span class="sxs-lookup"><span data-stu-id="03596-440">Transactions can span shardlets as long as they are part of the same shard.</span></span> <span data-ttu-id="03596-441">Таким образом, если вашей бизнес-логике требуется выполнять транзакции, соответствующие данные либо должны храниться в одном сегменте, либо нужно реализовать окончательную согласованность.</span><span class="sxs-lookup"><span data-stu-id="03596-441">Therefore, if your business logic needs to perform transactions, either store the affected data in the same shard or implement eventual consistency.</span></span> <span data-ttu-id="03596-442">Дополнительные сведения см. в [руководстве по согласованности данных].</span><span class="sxs-lookup"><span data-stu-id="03596-442">For more information, see the [Data consistency primer].</span></span>
* <span data-ttu-id="03596-443">Размещайте сегменты рядом с пользователями, которые обращаются к данным в этих сегментах (другими словами, выполняйте географическое распределение сегментов).</span><span class="sxs-lookup"><span data-stu-id="03596-443">Place shards close to the users that access the data in those shards (in other words, geo-locate the shards).</span></span> <span data-ttu-id="03596-444">Эта стратегия помогает сократить задержку.</span><span class="sxs-lookup"><span data-stu-id="03596-444">This strategy helps reduce latency.</span></span>
* <span data-ttu-id="03596-445">Избегайте смешения высокоактивных (горячих) и относительно неактивных сегментов.</span><span class="sxs-lookup"><span data-stu-id="03596-445">Avoid having a mixture of highly active (hotspots) and relatively inactive shards.</span></span> <span data-ttu-id="03596-446">Попробуйте равномерно распределить нагрузку по сегментам.</span><span class="sxs-lookup"><span data-stu-id="03596-446">Try to spread the load evenly across shards.</span></span> <span data-ttu-id="03596-447">Это может потребовать хэширования ключей шардлетов.</span><span class="sxs-lookup"><span data-stu-id="03596-447">This might require hashing the shardlet keys.</span></span>
* <span data-ttu-id="03596-448">При географическом распределении сегментов убедитесь, что хэшированные ключи соответствуют шардлетам, хранящимся в сегментах, которые находятся рядом с использующими эти данные пользователями.</span><span class="sxs-lookup"><span data-stu-id="03596-448">If you are geo-locating shards, make sure that the hashed keys map to shardlets held in shards stored close to the users that access that data.</span></span>
* <span data-ttu-id="03596-449">В настоящее время в качестве ключей шардлетов поддерживается только ограниченный набор типов данных SQL: *int, bigint, varbinary* и *uniqueidentifier*.</span><span class="sxs-lookup"><span data-stu-id="03596-449">Currently, only a limited set of SQL data types are supported as shardlet keys; *int, bigint, varbinary,* and *uniqueidentifier*.</span></span> <span data-ttu-id="03596-450">Типы SQL *int* и *bigint* соответствуют типам данных *int* и *long* в C# и имеют такие же диапазоны.</span><span class="sxs-lookup"><span data-stu-id="03596-450">The SQL *int* and *bigint* types correspond to the *int* and *long* data types in C#, and have the same ranges.</span></span> <span data-ttu-id="03596-451">Тип SQL *varbinary* может обрабатываться с помощью массива *Byte* в C#, а тип SQL *uniqueidentier* соответствует классу *Guid* в .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="03596-451">The SQL *varbinary* type can be handled by using a *Byte* array in C#, and the SQL *uniqueidentier* type corresponds to the *Guid* class in the .NET Framework.</span></span>

<span data-ttu-id="03596-452">Как предполагает имя, эластичная база данных позволяет добавлять и удалять сегменты в системе по мере увеличения или уменьшения объема данных.</span><span class="sxs-lookup"><span data-stu-id="03596-452">As the name implies, Elastic Database makes it possible for a system to add and remove shards as the volume of data shrinks and grows.</span></span> <span data-ttu-id="03596-453">API в клиентской библиотеке эластичной базы данных базы данных SQL Azure позволяют приложению создавать и удалять сегменты динамически (и прозрачно обновлять диспетчер карты сегментов).</span><span class="sxs-lookup"><span data-stu-id="03596-453">The APIs in the Azure SQL Database Elastic Database client library enable an application to create and delete shards dynamically (and transparently update the shard map manager).</span></span> <span data-ttu-id="03596-454">Однако удаление сегмента является необратимой операцией, в ходе которой также необходимо удалить все данные этого сегмента.</span><span class="sxs-lookup"><span data-stu-id="03596-454">However, removing a shard is a destructive operation that also requires deleting all the data in that shard.</span></span>

<span data-ttu-id="03596-455">Если приложению требуется разбить сегмент на два отдельных сегмента или объединить их, эластичная база данных предоставляет отдельную службу разделения и объединения.</span><span class="sxs-lookup"><span data-stu-id="03596-455">If an application needs to split a shard into two separate shards or combine shards, Elastic Database provides a separate split-merge service.</span></span> <span data-ttu-id="03596-456">Эта служба работает в облачной службе (разработчик должен ее создать) и обеспечивает безопасный перенос данных между сегментами.</span><span class="sxs-lookup"><span data-stu-id="03596-456">This service runs in a cloud-hosted service (which must be created by the developer) and migrates data safely between shards.</span></span> <span data-ttu-id="03596-457">Дополнительные сведения см. в статье [Перемещение данных между масштабируемыми облачными базами данных] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-457">For more information, see the topic [Scaling using the Elastic Database split-merge tool] on the Microsoft website.</span></span>

## <a name="partitioning-strategies-for-azure-storage"></a><span data-ttu-id="03596-458">Стратегии секционирования для хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="03596-458">Partitioning strategies for Azure Storage</span></span>
<span data-ttu-id="03596-459">Хранилище Azure предоставляет следующие четыре абстракции для управления данными.</span><span class="sxs-lookup"><span data-stu-id="03596-459">Azure storage provides four abstractions for managing data:</span></span>

* <span data-ttu-id="03596-460">Хранилище BLOB-объектов хранит объекты с неструктурированными данными.</span><span class="sxs-lookup"><span data-stu-id="03596-460">Blob Storage stores unstructured object data.</span></span> <span data-ttu-id="03596-461">BLOB-объект может представлять собой текстовые или двоичные данные любого типа, такие как документ, файл мультимедиа или установщик приложения.</span><span class="sxs-lookup"><span data-stu-id="03596-461">A blob can be any type of text or binary data, such as a document, media file, or application installer.</span></span> <span data-ttu-id="03596-462">Хранилище BLOB-объектов иногда также называют хранилищем объектов.</span><span class="sxs-lookup"><span data-stu-id="03596-462">Blob storage is also referred to as Object storage.</span></span>
* <span data-ttu-id="03596-463">Хранилище таблиц хранит структурированные наборы данных.</span><span class="sxs-lookup"><span data-stu-id="03596-463">Table Storage stores structured datasets.</span></span> <span data-ttu-id="03596-464">Табличное хранилище представляет собой хранилище данных NoSQL типа "ключ-атрибут", которое позволяет ускорить разработку и доступ к большим объемам данных.</span><span class="sxs-lookup"><span data-stu-id="03596-464">Table storage is a NoSQL key-attribute data store, which allows for rapid development and fast access to large quantities of data.</span></span>
* <span data-ttu-id="03596-465">Хранилище очередей обеспечивает надежный обмен сообщениями, поддерживая рабочие процессы обработки и обеспечивая взаимодействие между компонентами облачных служб.</span><span class="sxs-lookup"><span data-stu-id="03596-465">Queue Storage provides reliable messaging for workflow processing and for communication between components of cloud services.</span></span>
* <span data-ttu-id="03596-466">Хранилище файлов — это совместно используемое хранилище для старых приложений, доступ к которому осуществляется на основе стандартного протокола SMB.</span><span class="sxs-lookup"><span data-stu-id="03596-466">File Storage offers shared storage for legacy applications using the standard SMB protocol.</span></span> <span data-ttu-id="03596-467">Виртуальные машины и облачные службы Azure могут использовать файловые данные компонентов приложений через подключенные ресурсы, а локальные приложения получают доступ к этим данным совместно с помощью службы файлов API REST.</span><span class="sxs-lookup"><span data-stu-id="03596-467">Azure virtual machines and cloud services can share file data across application components via mounted shares, and on-premises applications can access file data in a share via the File service REST API.</span></span>

<span data-ttu-id="03596-468">Хранилище таблиц и хранилище BLOB-объектов фактически представляют собой хранилища на базе значения и ключа, оптимизированные для хранения структурированных и неструктурированных данных соответственно.</span><span class="sxs-lookup"><span data-stu-id="03596-468">Table storage and blob storage are essentially key-value stores that are optimized to hold structured and unstructured data respectively.</span></span> <span data-ttu-id="03596-469">Очереди хранилища предоставляют механизм для создания слабосвязанных масштабируемых приложений.</span><span class="sxs-lookup"><span data-stu-id="03596-469">Storage queues provide a mechanism for building loosely coupled, scalable applications.</span></span> <span data-ttu-id="03596-470">Хранилище таблиц, хранилище файлов, хранилище BLOB-объектов и очереди хранилища создаются в контексте учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-470">Table storage, file storage, blob storage, and storage queues are created within the context of an Azure storage account.</span></span> <span data-ttu-id="03596-471">Учетные записи хранения Azure поддерживают три вида избыточности.</span><span class="sxs-lookup"><span data-stu-id="03596-471">Storage accounts support three forms of redundancy:</span></span>

* <span data-ttu-id="03596-472">**Локально избыточное хранилище**поддерживает три копии данных в одном центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="03596-472">**Locally redundant storage**, which maintains three copies of data within a single datacenter.</span></span> <span data-ttu-id="03596-473">Эта форма избыточности обеспечивает защиту от сбоев оборудования, но не от аварии, которая охватывает весь центр обработки данных.</span><span class="sxs-lookup"><span data-stu-id="03596-473">This form of redundancy protects against hardware failure but not against a disaster that encompasses the entire datacenter.</span></span>
* <span data-ttu-id="03596-474">**Хранилище, избыточное в пределах зоны**, поддерживает три копии данных, которые хранятся в различных центрах обработки данных в одном регионе (или двух географически близких регионах).</span><span class="sxs-lookup"><span data-stu-id="03596-474">**Zone-redundant storage**, which maintains three copies of data spread across different datacenters within the same region (or across two geographically close regions).</span></span> <span data-ttu-id="03596-475">Эта форма избыточности обеспечивает защиту от сбоев, возникающих в рамках одного центра обработки данных, но не может защитить от крупномасштабных сетевых отключений, которые влияют на весь регион.</span><span class="sxs-lookup"><span data-stu-id="03596-475">This form of redundancy can protect against disasters that occur within a single datacenter, but cannot protect against large-scale network disconnects that affect an entire region.</span></span> <span data-ttu-id="03596-476">Обратите внимание, что хранилище, избыточное в пределах зоны, доступно только для блочных BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="03596-476">Note that zone-redundant storage is currently only available for block blobs.</span></span>
* <span data-ttu-id="03596-477">**Геоизбыточное хранилище**поддерживает шесть копий данных: три копии хранятся в одном регионе (в вашем локальном регионе), а еще три копии — в удаленном регионе.</span><span class="sxs-lookup"><span data-stu-id="03596-477">**Geo-redundant storage**, which maintains six copies of data: three copies in one region (your local region), and another three copies in a remote region.</span></span> <span data-ttu-id="03596-478">Эта форма избыточности обеспечивает самый высокий уровень защиты от аварии.</span><span class="sxs-lookup"><span data-stu-id="03596-478">This form of redundancy provides the highest level of disaster protection.</span></span>

<span data-ttu-id="03596-479">Корпорация Майкрософт опубликовала целевые показатели масштабируемости для хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-479">Microsoft has published scalability targets for Azure Storage.</span></span> <span data-ttu-id="03596-480">Дополнительные сведения см. на странице [Целевые показатели масштабируемости и производительности службы хранилища Azure] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-480">For more information, see the page [Azure Storage scalability and performance targets] on the Microsoft website.</span></span> <span data-ttu-id="03596-481">В настоящее время общая емкость учетной записи хранения не может превышать 500 ТБ.</span><span class="sxs-lookup"><span data-stu-id="03596-481">Currently, the total storage account capacity cannot exceed 500 TB.</span></span> <span data-ttu-id="03596-482">(Сюда входит размер данных, хранящихся в хранилище таблиц, хранилище файлов и хранилище BLOB-объектов, а также ожидающих сообщений, хранящихся в очереди хранилища.)</span><span class="sxs-lookup"><span data-stu-id="03596-482">(This includes the size of data that's held in table storage, file storage and blob storage, as well as outstanding messages that are held in storage queue).</span></span>

<span data-ttu-id="03596-483">Максимальная скорость запросов к учетной записи хранилища (исходя из размера 1 КБ для сущностей, больших двоичных объектов и сообщений) составляет 20 000 запросов в секунду.</span><span class="sxs-lookup"><span data-stu-id="03596-483">The maximum request rate for a storage account (assuming a 1-KB entity, blob, or message size) is 20,000 requests per second.</span></span> <span data-ttu-id="03596-484">Для учетной записи хранения выделяется по 1000 операций ввода-вывода (размером по 8 КБ) на один файловый ресурс.</span><span class="sxs-lookup"><span data-stu-id="03596-484">A storage account has a maximum of 1000 IOPS (8 KB in size) per file share.</span></span> <span data-ttu-id="03596-485">Если для вашей системы вероятно превышение этих ограничений, попробуйте разбить нагрузку на несколько учетных записей хранения.</span><span class="sxs-lookup"><span data-stu-id="03596-485">If your system is likely to exceed these limits, consider partitioning the load across multiple storage accounts.</span></span> <span data-ttu-id="03596-486">Для одной подписки Azure можно создать до 200 учетных записей хранения.</span><span class="sxs-lookup"><span data-stu-id="03596-486">A single Azure subscription can create up to 200 storage accounts.</span></span> <span data-ttu-id="03596-487">Однако обратите внимание, что эти ограничения могут изменяться со временем.</span><span class="sxs-lookup"><span data-stu-id="03596-487">However, note that these limits might change over time.</span></span>

## <a name="partitioning-azure-table-storage"></a><span data-ttu-id="03596-488">Секционирование хранилища таблиц Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="03596-488">Partitioning Azure table storage</span></span>
<span data-ttu-id="03596-489">Хранилище таблиц Azure является хранилищем ключей и значений, которое разработано на основе секционирования.</span><span class="sxs-lookup"><span data-stu-id="03596-489">Azure table storage is a key-value store that's designed around partitioning.</span></span> <span data-ttu-id="03596-490">Все сущности хранятся в секции, а секции управляются внутренне хранилищем таблиц Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-490">All entities are stored in a partition, and partitions are managed internally by Azure table storage.</span></span> <span data-ttu-id="03596-491">Каждая сущность, хранящаяся в таблице, должна предоставить двухкомпонентный ключ, включающий ключ секции и ключ строки.</span><span class="sxs-lookup"><span data-stu-id="03596-491">Each entity that's stored in a table must provide a two-part key that includes:</span></span>

* <span data-ttu-id="03596-492">**Ключ секции**.</span><span class="sxs-lookup"><span data-stu-id="03596-492">**The partition key**.</span></span> <span data-ttu-id="03596-493">Это строковые значения, которые определяют, в какой секции хранилища таблицы Azure нужно разместить сущность.</span><span class="sxs-lookup"><span data-stu-id="03596-493">This is a string value that determines in which partition Azure table storage will place the entity.</span></span> <span data-ttu-id="03596-494">Все сущности с одинаковым ключом секции будут храниться в одной секции.</span><span class="sxs-lookup"><span data-stu-id="03596-494">All entities with the same partition key will be stored in the same partition.</span></span>
* <span data-ttu-id="03596-495">**Ключ строки**.</span><span class="sxs-lookup"><span data-stu-id="03596-495">**The row key**.</span></span> <span data-ttu-id="03596-496">Это другое строковое значение, определяющее сущность в секции.</span><span class="sxs-lookup"><span data-stu-id="03596-496">This is another string value that identifies the entity within the partition.</span></span> <span data-ttu-id="03596-497">Все сущности в секции сортируются лексически в порядке возрастания с помощью этого ключа.</span><span class="sxs-lookup"><span data-stu-id="03596-497">All entities within a partition are sorted lexically, in ascending order, by this key.</span></span> <span data-ttu-id="03596-498">Сочетание ключа секции и ключа строки должно быть уникальным для каждой сущности, а его длина не может превышать 1 КБ.</span><span class="sxs-lookup"><span data-stu-id="03596-498">The partition key/row key combination must be unique for each entity and cannot exceed 1 KB in length.</span></span>

<span data-ttu-id="03596-499">Остальная часть данных для сущности состоит из полей, определяемых приложением.</span><span class="sxs-lookup"><span data-stu-id="03596-499">The remainder of the data for an entity consists of application-defined fields.</span></span> <span data-ttu-id="03596-500">Конкретные схемы не применяются, и каждая строка может содержать свой набор полей, определяемых приложением.</span><span class="sxs-lookup"><span data-stu-id="03596-500">No particular schemas are enforced, and each row can contain a different set of application-defined fields.</span></span> <span data-ttu-id="03596-501">Единственное ограничение: максимальный размер сущности (включая ключи секций и строк) в настоящее время составляет 1 МБ.</span><span class="sxs-lookup"><span data-stu-id="03596-501">The only limitation is that the maximum size of an entity (including the partition and row keys) is currently 1 MB.</span></span> <span data-ttu-id="03596-502">Максимальный размер таблицы составляет 200 ТБ, хотя эти данные могут измениться в будущем.</span><span class="sxs-lookup"><span data-stu-id="03596-502">The maximum size of a table is 200 TB, although these figures might change in the future.</span></span> <span data-ttu-id="03596-503">(Новейшие сведения об этих ограничениях см. на странице [Целевые показатели масштабируемости и производительности службы хранилища Azure] на веб-сайте Майкрософт.)</span><span class="sxs-lookup"><span data-stu-id="03596-503">(Check the page [Azure Storage scalability and performance targets] on the Microsoft website for the most recent information about these limits.)</span></span>

<span data-ttu-id="03596-504">Если вам необходимо хранить сущности, размер которых превышает это ограничение, попробуйте разбить их на несколько таблиц.</span><span class="sxs-lookup"><span data-stu-id="03596-504">If you are attempting to store entities that exceed this capacity, then consider splitting them into multiple tables.</span></span> <span data-ttu-id="03596-505">Используйте вертикальное секционирование и разделите поля на группы, которые, скорее всего, используются вместе.</span><span class="sxs-lookup"><span data-stu-id="03596-505">Use vertical partitioning to divide the fields into the groups that are most likely to be accessed together.</span></span>

<span data-ttu-id="03596-506">Рис. 7 демонстрирует логическую структуру примера учетной записи хранения (Contoso Data) для вымышленного приложения электронной коммерции.</span><span class="sxs-lookup"><span data-stu-id="03596-506">Figure 7 shows the logical structure of an example storage account (Contoso Data) for a fictitious e-commerce application.</span></span> <span data-ttu-id="03596-507">Учетные записи хранения содержат три таблицы: сведения о клиенте, сведения о продукции и сведения о заказах.</span><span class="sxs-lookup"><span data-stu-id="03596-507">The storage account contains three tables: Customer Info, Product Info, and Order Info.</span></span> <span data-ttu-id="03596-508">Каждая таблица содержит несколько секций.</span><span class="sxs-lookup"><span data-stu-id="03596-508">Each table has multiple partitions.</span></span>

<span data-ttu-id="03596-509">В таблице сведений о клиенте данные секционируются по городам, в которых находятся клиенты, а ключ строки содержит идентификатор клиента.</span><span class="sxs-lookup"><span data-stu-id="03596-509">In the Customer Info table, the data is partitioned according to the city in which the customer is located, and the row key contains the customer ID.</span></span> <span data-ttu-id="03596-510">В таблице сведений о продукте продукты секционированы по категориям, а ключ строки содержит номер продукта.</span><span class="sxs-lookup"><span data-stu-id="03596-510">In the Product Info table, the products are partitioned by product category, and the row key contains the product number.</span></span> <span data-ttu-id="03596-511">В таблице сведений о заказах заказы секционируются по дате размещения, а ключ строки указывает время получения заказа.</span><span class="sxs-lookup"><span data-stu-id="03596-511">In the Order Info table, the orders are partitioned by the date on which they were placed, and the row key specifies the time the order was received.</span></span> <span data-ttu-id="03596-512">Обратите внимание, что все данные в каждой секции упорядочены с помощью ключа строки.</span><span class="sxs-lookup"><span data-stu-id="03596-512">Note that all data is ordered by the row key in each partition.</span></span>

![Таблицы и секции в примере учетной записи хранения](./images/data-partitioning/TableStorage.png)

<span data-ttu-id="03596-514">*Рис. 7. Таблицы и секции в примере учетной записи хранения*</span><span class="sxs-lookup"><span data-stu-id="03596-514">*Figure 7. The tables and partitions in an example storage account*</span></span>

> [!NOTE]
> <span data-ttu-id="03596-515">Хранилище таблиц Azure также добавляет поле метки времени для каждой сущности.</span><span class="sxs-lookup"><span data-stu-id="03596-515">Azure table storage also adds a timestamp field to each entity.</span></span> <span data-ttu-id="03596-516">Поле метки времени обслуживается хранилищем таблиц.</span><span class="sxs-lookup"><span data-stu-id="03596-516">The timestamp field is maintained by table storage and is updated each time the entity is modified and written back to a partition.</span></span> <span data-ttu-id="03596-517">Оно обновляется при каждом изменении сущности и записывается обратно в секцию.</span><span class="sxs-lookup"><span data-stu-id="03596-517">The table storage service uses this field to implement optimistic concurrency.</span></span> <span data-ttu-id="03596-518">Служба хранилища таблиц использует поле для реализации оптимистичного параллелизма.</span><span class="sxs-lookup"><span data-stu-id="03596-518">(Each time an application writes an entity back to table storage, the table storage service compares the value of the timestamp in the entity that's being written with the value that's held in table storage.</span></span> <span data-ttu-id="03596-519">(Каждый раз, когда приложение записывает сущность обратно в хранилище таблиц, служба хранилища таблиц сравнивает значение метки времени записываемой сущности со значением, содержащимся в хранилище таблиц.</span><span class="sxs-lookup"><span data-stu-id="03596-519">If the values are different, it means that another application must have modified the entity since it was last retrieved, and the write operation fails.</span></span> <span data-ttu-id="03596-520">Если значения отличаются, возможно, другое приложение изменило сущность после получения, в результате чего происходит сбой операции записи.) Не изменяйте это поле в собственном коде, а также не задавайте значение для этого поля при создании новой сущности.</span><span class="sxs-lookup"><span data-stu-id="03596-520">Don't modify this field in your own code, and don't specify a value for this field when you create a new entity.</span></span>
>
>

<span data-ttu-id="03596-521">Хранилище таблиц Azure использует ключ секции для определения способа хранения данных.</span><span class="sxs-lookup"><span data-stu-id="03596-521">Azure table storage uses the partition key to determine how to store the data.</span></span> <span data-ttu-id="03596-522">При добавлении сущности в таблицу с ранее неиспользуемым ключом секции хранилище таблиц Azure создаст новую секцию для этой сущности.</span><span class="sxs-lookup"><span data-stu-id="03596-522">If an entity is added to a table with a previously unused partition key, Azure table storage creates a new partition for this entity.</span></span> <span data-ttu-id="03596-523">Другие сущности с одинаковым ключом секции будут храниться в одной секции.</span><span class="sxs-lookup"><span data-stu-id="03596-523">Other entities with the same partition key will be stored in the same partition.</span></span>

<span data-ttu-id="03596-524">Этот механизм эффективно реализует стратегию автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="03596-524">This mechanism effectively implements an automatic scale-out strategy.</span></span> <span data-ttu-id="03596-525">Каждая секция хранится на одном сервере в центре обработки данных Azure, чтобы обеспечить быстрое выполнение запросов, получающих данные из одной секции.</span><span class="sxs-lookup"><span data-stu-id="03596-525">Each partition is stored on a single server in an Azure datacenter to help ensure that queries that retrieve data from a single partition run quickly.</span></span> <span data-ttu-id="03596-526">Но разные секции могут располагаться на нескольких серверах.</span><span class="sxs-lookup"><span data-stu-id="03596-526">However, different partitions can be distributed across multiple servers.</span></span> <span data-ttu-id="03596-527">Кроме того, один сервер может поддерживать несколько секций, если размер этих секций ограничен.</span><span class="sxs-lookup"><span data-stu-id="03596-527">Additionally, a single server can host multiple partitions if these partitions are limited in size.</span></span>

<span data-ttu-id="03596-528">При проектировании сущностей для хранилища таблиц Azure учитывайте следующие моменты.</span><span class="sxs-lookup"><span data-stu-id="03596-528">Consider the following points when you design your entities for Azure table storage:</span></span>

* <span data-ttu-id="03596-529">Выбор значений ключа секции и ключа строки должен быть основан на способе получения доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="03596-529">The selection of partition key and row key values should be driven by the way in which the data is accessed.</span></span> <span data-ttu-id="03596-530">Необходимо выбрать сочетание ключа секции и ключа строки, которое поддерживает большинство запросов.</span><span class="sxs-lookup"><span data-stu-id="03596-530">Choose a partition key/row key combination that supports the majority of your queries.</span></span> <span data-ttu-id="03596-531">Наиболее эффективные запросы будут получать данные, указав ключ секции и ключ строки.</span><span class="sxs-lookup"><span data-stu-id="03596-531">The most efficient queries retrieve data by specifying the partition key and the row key.</span></span> <span data-ttu-id="03596-532">Запросы, которые определяют ключ секции и диапазон ключей строк, могут быть выполнены путем сканирования одной секции.</span><span class="sxs-lookup"><span data-stu-id="03596-532">Queries that specify a partition key and a range of row keys can be completed by scanning a single partition.</span></span> <span data-ttu-id="03596-533">Это относительно быстро, поскольку данные хранятся в порядке значений ключей строк.</span><span class="sxs-lookup"><span data-stu-id="03596-533">This is relatively fast because the data is held in row key order.</span></span> <span data-ttu-id="03596-534">В случае запросов, которые не указывают, какую секцию следует сканировать, ключ секции может потребовать от хранилища таблиц Azure проверить каждую секцию данных.</span><span class="sxs-lookup"><span data-stu-id="03596-534">If queries don't specify which partition to scan, the partition key might require Azure table storage to scan every partition for your data.</span></span>

  > [!TIP]
  > <span data-ttu-id="03596-535">Если у сущности есть один естественный ключ, используйте его в качестве ключа секции и укажите пустую строку в качестве ключа строки.</span><span class="sxs-lookup"><span data-stu-id="03596-535">If an entity has one natural key, then use it as the partition key and specify an empty string as the row key.</span></span> <span data-ttu-id="03596-536">Если сущность имеет составной ключ, включающий два свойства, выберите наиболее медленно изменяющееся свойство в качестве ключа секции, а второе — в качестве ключа строки.</span><span class="sxs-lookup"><span data-stu-id="03596-536">If an entity has a composite key comprising two properties, select the slowest changing property as the partition key and the other as the row key.</span></span> <span data-ttu-id="03596-537">Если сущность имеет более двух свойств ключа, используйте объединение свойств, чтобы указать ключи секций и строк.</span><span class="sxs-lookup"><span data-stu-id="03596-537">If an entity has more than two key properties, use a concatenation of properties to provide the partition and row keys.</span></span>
  >
  >
* <span data-ttu-id="03596-538">Если вы регулярно выполняете запросы, которые ищут данные с использованием других полей, кроме ключей секций и строк, рассмотрите возможность реализации [шаблона таблицы индексов].</span><span class="sxs-lookup"><span data-stu-id="03596-538">If you regularly perform queries that look up data by using fields other than the partition and row keys, consider implementing the [index table pattern].</span></span>
* <span data-ttu-id="03596-539">Если вы создаете ключи секций с помощью монотонной увеличивающейся или уменьшающейся последовательности (например 0001, 0002, 0003 и т. д.) и каждая секция содержит только ограниченный объем данных, хранилище таблиц Azure может физически сгруппировать эти секции вместе на одном сервере.</span><span class="sxs-lookup"><span data-stu-id="03596-539">If you generate partition keys by using a monotonic increasing or decreasing sequence (such as "0001", "0002", "0003", and so on) and each partition only contains a limited amount of data, then Azure table storage can physically group these partitions together on the same server.</span></span> <span data-ttu-id="03596-540">Этот механизм предполагает, что приложение, скорее всего, будет выполнять запросы к смежным секциям (запросы к диапазону), и оптимизирован для этого случая.</span><span class="sxs-lookup"><span data-stu-id="03596-540">This mechanism assumes that the application is most likely to perform queries across a contiguous range of partitions (range queries) and is optimized for this case.</span></span> <span data-ttu-id="03596-541">Однако такой подход может привести к образованию горячих точек на одном сервере, так как все операции добавления новых сущностей, вероятно, будут сконцентрированы на одном или другом конце непрерывного диапазона.</span><span class="sxs-lookup"><span data-stu-id="03596-541">However, this approach can lead to hotspots focused on a single server because all insertions of new entities are likely to be concentrated at one end or the other of the contiguous ranges.</span></span> <span data-ttu-id="03596-542">Он также может снизить масштабируемость.</span><span class="sxs-lookup"><span data-stu-id="03596-542">It can also reduce scalability.</span></span> <span data-ttu-id="03596-543">Чтобы более равномерно распределить нагрузку между серверами, рассмотрите возможность хэширования ключа секции, чтобы сделать последовательность более случайной.</span><span class="sxs-lookup"><span data-stu-id="03596-543">To spread the load more evenly across servers, consider hashing the partition key to make the sequence more random.</span></span>
* <span data-ttu-id="03596-544">Хранилище таблиц Azure поддерживает транзакционные операции для сущностей, которые относятся к одной секции.</span><span class="sxs-lookup"><span data-stu-id="03596-544">Azure table storage supports transactional operations for entities that belong to the same partition.</span></span> <span data-ttu-id="03596-545">Это означает, что приложение может выполнять несколько операций вставки, обновления, удаления или объединения как одну неделимую единицу (транзакции не должны включать более 100 сущностей, а размер полезных данных запроса не должен превышать 4 МБ).</span><span class="sxs-lookup"><span data-stu-id="03596-545">This means that an application can perform multiple insert, update, delete, replace, or merge operations as an atomic unit (as long as the transaction doesn't include more than 100 entities and the payload of the request doesn't exceed 4 MB).</span></span> <span data-ttu-id="03596-546">Операции, охватывающие несколько секций, не являются транзакционными и могут потребовать реализации окончательной согласованности, как описано в [руководстве по согласованности данных].</span><span class="sxs-lookup"><span data-stu-id="03596-546">Operations that span multiple partitions are not transactional, and might require you to implement eventual consistency as described by the [Data consistency primer].</span></span> <span data-ttu-id="03596-547">Дополнительные сведения о хранилище таблиц и транзакциях см. в статье [Performing entity group transactions] (Выполнение транзакций группы сущностей на веб-сайте Майкрософт).</span><span class="sxs-lookup"><span data-stu-id="03596-547">For more information about table storage and transactions, go to the page [Performing entity group transactions] on the Microsoft website.</span></span>
* <span data-ttu-id="03596-548">Уделите особое внимание гранулярности ключа секции. Это необходимо сделать по указанным далее причинам:</span><span class="sxs-lookup"><span data-stu-id="03596-548">Give careful attention to the granularity of the partition key because of the following reasons:</span></span>
  * <span data-ttu-id="03596-549">Использование одного и того же ключа секции для каждой сущности приведет к тому, что служба хранилища таблиц создаст одну большую секцию, хранящуюся на одном сервере. </span><span class="sxs-lookup"><span data-stu-id="03596-549">Using the same partition key for every entity causes the table storage service to create a single large partition that's held on one server.</span></span> <span data-ttu-id="03596-550">В результате масштабирование будет затруднено, а нагрузка сконцентрируется на одном сервере.</span><span class="sxs-lookup"><span data-stu-id="03596-550">This prevents it from scaling out and instead focuses the load on a single server.</span></span> <span data-ttu-id="03596-551">В результате этот подход применим только для систем, которые управляют небольшим количеством сущностей.</span><span class="sxs-lookup"><span data-stu-id="03596-551">As a result, this approach is only suitable for systems that manage a small number of entities.</span></span> <span data-ttu-id="03596-552">Тем не менее этот подход не гарантирует, что все сущности смогут участвовать в транзакциях группы сущностей.</span><span class="sxs-lookup"><span data-stu-id="03596-552">However, this approach does ensure that all entities can participate in entity group transactions.</span></span>
  * <span data-ttu-id="03596-553">Использование уникального ключа секции для каждой сущности приведет к тому, что служба хранилища таблиц создаст отдельную секцию для каждой сущности, в результате чего может появиться большое количество небольших секций (в зависимости от размера сущностей).</span><span class="sxs-lookup"><span data-stu-id="03596-553">Using a unique partition key for every entity causes the table storage service to create a separate partition for each entity, possibly resulting in a large number of small partitions (depending on the size of the entities).</span></span> <span data-ttu-id="03596-554">Этот подход лучше поддается масштабированию, чем подход с использованием одного ключа секции, но транзакции группы сущностей невозможны.</span><span class="sxs-lookup"><span data-stu-id="03596-554">This approach is more scalable than using a single partition key, but entity group transactions are not possible.</span></span> <span data-ttu-id="03596-555">Кроме того запросы, получающие более одной сущности, могут включать чтение с нескольких серверов.</span><span class="sxs-lookup"><span data-stu-id="03596-555">Also, queries that fetch more than one entity might involve reading from more than one server.</span></span> <span data-ttu-id="03596-556">Тем не менее, если приложение выполняет запросы к диапазону, использование монотонной последовательности для создания ключей секций может помочь оптимизировать такие запросы.</span><span class="sxs-lookup"><span data-stu-id="03596-556">However, if the application performs range queries, then using a monotonic sequence to generate the partition keys might help to optimize these queries.</span></span>
  * <span data-ttu-id="03596-557">Совместное использование ключа секции в подмножестве сущностей позволяет группировать связанные сущности в одну секцию.</span><span class="sxs-lookup"><span data-stu-id="03596-557">Sharing the partition key across a subset of entities makes it possible for you to group related entities in the same partition.</span></span> <span data-ttu-id="03596-558">Операции, включающие связанные сущности, можно выполнить с помощью транзакции группы сущностей, и запросы, получающие набор связанных сущностей, могут удовлетворяться путем доступа к одному серверу.</span><span class="sxs-lookup"><span data-stu-id="03596-558">Operations that involve related entities can be performed by using entity group transactions, and queries that fetch a set of related entities can be satisfied by accessing a single server.</span></span>

<span data-ttu-id="03596-559">Дополнительные сведения о секционировании данных в хранилище таблиц Azure см. в статье [Руководство по разработке табличных хранилищ Azure: разработка масштабируемых и высокопроизводительных таблиц] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-559">For additional information about partitioning data in Azure table storage, see the article [Azure storage table design guide] on the Microsoft website.</span></span>

## <a name="partitioning-azure-blob-storage"></a><span data-ttu-id="03596-560">Секционирование хранилища BLOB-объектов Azure</span><span class="sxs-lookup"><span data-stu-id="03596-560">Partitioning Azure blob storage</span></span>
<span data-ttu-id="03596-561">Хранилище BLOB-объектов Azure позволяет хранить большие двоичные объекты, размер которых сейчас может достигать 5 ТБ для блочных BLOB-объектов и 1 ТБ для страничных BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="03596-561">Azure blob storage makes it possible to hold large binary objects--currently up to 5 TB in size for block blobs or 1 TB for page blobs.</span></span> <span data-ttu-id="03596-562">(Новейшие сведения см. на странице [Целевые показатели масштабируемости и производительности службы хранилища Azure] на веб-сайте Майкрософт.) Используйте блочные BLOB-объекты в таких сценариях, как потоковая передача, где требуется быстро отправлять или загружать большие объемы данных.</span><span class="sxs-lookup"><span data-stu-id="03596-562">(For the most recent information, go to the page [Azure Storage scalability and performance targets] on the Microsoft website.) Use block blobs in scenarios such as streaming where you need to upload or download large volumes of data quickly.</span></span> <span data-ttu-id="03596-563">Используйте страничные BLOB-объекты для приложений, требующих случайного, а не последовательного доступа к частям данных.</span><span class="sxs-lookup"><span data-stu-id="03596-563">Use page blobs for applications that require random rather than serial access to parts of the data.</span></span>

<span data-ttu-id="03596-564">Каждый BLOB-объект (блочный или страничный) удерживается в контейнере в учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-564">Each blob (either block or page) is held in a container in an Azure storage account.</span></span> <span data-ttu-id="03596-565">Контейнеры можно использовать для группировки связанных BLOB-объектов с одинаковыми требованиями безопасности.</span><span class="sxs-lookup"><span data-stu-id="03596-565">You can use containers to group related blobs that have the same security requirements.</span></span> <span data-ttu-id="03596-566">Это группирование на логическом, а не на физическом уровне.</span><span class="sxs-lookup"><span data-stu-id="03596-566">This grouping is logical rather than physical.</span></span> <span data-ttu-id="03596-567">Внутри контейнера каждый BLOB-объект имеет уникальное имя.</span><span class="sxs-lookup"><span data-stu-id="03596-567">Inside a container, each blob has a unique name.</span></span>

<span data-ttu-id="03596-568">Ключ секции для большого двоичного объекта состоит из имен учетной записи, контейнера и большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="03596-568">The partition key for a blob is account name + container name + blob name.</span></span> <span data-ttu-id="03596-569">Таким образом, для каждого большого двоичного объекта может существовать отдельная секция, если это диктуется объемом нагрузки.</span><span class="sxs-lookup"><span data-stu-id="03596-569">This means each blob can have its own partition if load on the blob demands it.</span></span> <span data-ttu-id="03596-570">Большие двоичные объекты могут быть распределены по нескольким серверам для развертывания доступа к ним, но один большой двоичный объект может обслуживаться только одним сервером.</span><span class="sxs-lookup"><span data-stu-id="03596-570">Blobs can be distributed across many servers in order to scale out access to them, but a single blob can only be served by a single server.</span></span> 

<span data-ttu-id="03596-571">Действия записи одного блока (блочного BLOB-объекта) или страницы (страничного BLOB-объекта) являются неделимыми, но операции, охватывающие блоки, страницы или BLOB-объекты, таковыми не являются.</span><span class="sxs-lookup"><span data-stu-id="03596-571">The actions of writing a single block (block blob) or page (page blob) are atomic, but operations that span blocks, pages, or blobs are not.</span></span> <span data-ttu-id="03596-572">Если требуется обеспечить согласованность при выполнении операций записи всех блоков, страниц и BLOB-объектов, необходимо убрать блокировку записи с помощью аренды BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="03596-572">If you need to ensure consistency when performing write operations across blocks, pages, and blobs, take out a write lock by using a blob lease.</span></span>

<span data-ttu-id="03596-573">Хранилище BLOB-объектов Azure рассчитано на скорость передачи данных до 60 МБ в секунду или 500 запросов в секунду для каждого BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="03596-573">Azure blob storage targets transfer rates of up to 60 MB per second or 500 requests per second for each blob.</span></span> <span data-ttu-id="03596-574">Если предполагается превышение этих ограничений и данные BLOB-объекта относительно статичны, рассмотрите возможность репликации BLOB-объектов с помощью сети доставки содержимого Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-574">If you anticipate surpassing these limits, and the blob data is relatively static, then consider replicating blobs by using the Azure Content Delivery Network.</span></span> <span data-ttu-id="03596-575">Дополнительные сведения см. в описании [сети доставки содержимого Azure] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-575">For more information, see the page [Azure Content Delivery Network] on the Microsoft website.</span></span> <span data-ttu-id="03596-576">Дополнительные инструкции и рекомендации см. в руководстве по [использованию сети доставки содержимого Azure].</span><span class="sxs-lookup"><span data-stu-id="03596-576">For additional guidance and considerations, see [Using Azure Content Delivery Network].</span></span>

## <a name="partitioning-azure-storage-queues"></a><span data-ttu-id="03596-577">Секционирование очередей хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="03596-577">Partitioning Azure storage queues</span></span>
<span data-ttu-id="03596-578">Очереди хранилища Azure позволяют реализовать асинхронный обмен сообщениями между процессами.</span><span class="sxs-lookup"><span data-stu-id="03596-578">Azure storage queues enable you to implement asynchronous messaging between processes.</span></span> <span data-ttu-id="03596-579">Учетная запись хранения Azure может содержать любое количество очередей, и каждая очередь может содержать любое количество сообщений.</span><span class="sxs-lookup"><span data-stu-id="03596-579">An Azure storage account can contain any number of queues, and each queue can contain any number of messages.</span></span> <span data-ttu-id="03596-580">Единственным ограничением является место, доступное в учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="03596-580">The only limitation is the space that's available in the storage account.</span></span> <span data-ttu-id="03596-581">Максимальный размер отдельного сообщения составляет 64 КБ.</span><span class="sxs-lookup"><span data-stu-id="03596-581">The maximum size of an individual message is 64 KB.</span></span> <span data-ttu-id="03596-582">Если требуются сообщения большего размера, попробуйте использовать очереди служебной шины Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-582">If you require messages bigger than this, then consider using Azure Service Bus queues instead.</span></span>

<span data-ttu-id="03596-583">Каждая очередь хранилища имеет уникальное имя в пределах учетной записи хранения, где она содержится.</span><span class="sxs-lookup"><span data-stu-id="03596-583">Each storage queue has a unique name within the storage account that contains it.</span></span> <span data-ttu-id="03596-584">Очереди секций Azure основаны на имени.</span><span class="sxs-lookup"><span data-stu-id="03596-584">Azure partitions queues based on the name.</span></span> <span data-ttu-id="03596-585">Все сообщения одной очереди хранятся в одной секции, управляемой одним сервером.</span><span class="sxs-lookup"><span data-stu-id="03596-585">All messages for the same queue are stored in the same partition, which is controlled by a single server.</span></span> <span data-ttu-id="03596-586">Различными очередями могут управлять разные серверы, чтобы сбалансировать нагрузку.</span><span class="sxs-lookup"><span data-stu-id="03596-586">Different queues can be managed by different servers to help balance the load.</span></span> <span data-ttu-id="03596-587">Выделение очередей для серверов является прозрачным для приложений и пользователей.</span><span class="sxs-lookup"><span data-stu-id="03596-587">The allocation of queues to servers is transparent to applications and users.</span></span>

 <span data-ttu-id="03596-588">В приложении большого объема не используйте одну и ту же очередь хранилища для всех экземпляров приложения: этот подход может привести к тому, что на сервере образуется очередь, являющаяся горячей точкой.</span><span class="sxs-lookup"><span data-stu-id="03596-588">In a large-scale application, don't use the same storage queue for all instances of the application because this approach might cause the server that's hosting the queue to become a hotspot.</span></span> <span data-ttu-id="03596-589">Используйте различные очереди для различных функциональных областей приложения.</span><span class="sxs-lookup"><span data-stu-id="03596-589">Instead, use different queues for different functional areas of the application.</span></span> <span data-ttu-id="03596-590">Очереди хранилища Azure не поддерживают транзакции, поэтому направление сообщений в различные очереди должно мало влиять на согласованность обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="03596-590">Azure storage queues do not support transactions, so directing messages to different queues should have little impact on messaging consistency.</span></span>

<span data-ttu-id="03596-591">Очередь хранилища Azure может обрабатывать до 2 000 сообщений в секунду.</span><span class="sxs-lookup"><span data-stu-id="03596-591">An Azure storage queue can handle up to 2,000 messages per second.</span></span>  <span data-ttu-id="03596-592">Если необходимо обрабатывать сообщения с большей скоростью, рассмотрите возможность создания нескольких очередей.</span><span class="sxs-lookup"><span data-stu-id="03596-592">If you need to process messages at a greater rate than this, consider creating multiple queues.</span></span> <span data-ttu-id="03596-593">Например, в глобальном приложении создайте отдельные очереди хранилища в отдельных учетных записях хранения для обработки экземпляров приложений, работающих в каждом регионе.</span><span class="sxs-lookup"><span data-stu-id="03596-593">For example, in a global application, create separate storage queues in separate storage accounts to handle application instances that are running in each region.</span></span>

## <a name="partitioning-strategies-for-azure-service-bus"></a><span data-ttu-id="03596-594">Стратегии секционирования для служебной шины Azure</span><span class="sxs-lookup"><span data-stu-id="03596-594">Partitioning strategies for Azure Service Bus</span></span>
<span data-ttu-id="03596-595">Служебная шина Azure использует брокер сообщений для обработки сообщений, отправленных в очередь или раздел служебной шины.</span><span class="sxs-lookup"><span data-stu-id="03596-595">Azure Service Bus uses a message broker to handle messages that are sent to a Service Bus queue or topic.</span></span> <span data-ttu-id="03596-596">По умолчанию все сообщения, отправленные в очередь или раздел, обрабатываются одним процессом брокера сообщений.</span><span class="sxs-lookup"><span data-stu-id="03596-596">By default, all messages that are sent to a queue or topic are handled by the same message broker process.</span></span> <span data-ttu-id="03596-597">Эта архитектура может ограничить общую пропускную способность очереди сообщений.</span><span class="sxs-lookup"><span data-stu-id="03596-597">This architecture can place a limitation on the overall throughput of the message queue.</span></span> <span data-ttu-id="03596-598">Однако можно секционировать очереди или разделы при их создании.</span><span class="sxs-lookup"><span data-stu-id="03596-598">However, you can also partition a queue or topic when it is created.</span></span> <span data-ttu-id="03596-599">Это можно сделать, задав свойству *EnablePartitioning* описания очереди или раздела значение *true*.</span><span class="sxs-lookup"><span data-stu-id="03596-599">You do this by setting the *EnablePartitioning* property of the queue or topic description to *true*.</span></span>

<span data-ttu-id="03596-600">Секционированная очередь или раздел делится на несколько фрагментов, для каждого из которых выполняется резервное копирование в отдельном хранилище сообщений и брокере сообщений.</span><span class="sxs-lookup"><span data-stu-id="03596-600">A partitioned queue or topic is divided into multiple fragments, each of which is backed by a separate message store and message broker.</span></span> <span data-ttu-id="03596-601">Служебная шина отвечает за создание этих фрагментов и управление ими.</span><span class="sxs-lookup"><span data-stu-id="03596-601">Service Bus takes responsibility for creating and managing these fragments.</span></span> <span data-ttu-id="03596-602">Когда приложение отправляет сообщение в секционированную очередь или раздел, служебная шина назначает сообщение фрагменту для этой очереди или раздела.</span><span class="sxs-lookup"><span data-stu-id="03596-602">When an application posts a message to a partitioned queue or topic, Service Bus assigns the message to a fragment for that queue or topic.</span></span> <span data-ttu-id="03596-603">Когда приложение получает сообщение из очереди или подписки, служебная шина проверяет каждый фрагмент на наличие следующего доступного сообщения и передает его приложению для обработки.</span><span class="sxs-lookup"><span data-stu-id="03596-603">When an application receives a message from a queue or subscription, Service Bus checks each fragment for the next available message and then passes it to the application for processing.</span></span>

<span data-ttu-id="03596-604">Эта структура позволяет распределять нагрузку между брокерами сообщений и хранилищами сообщений, повышая масштабируемость и доступность.</span><span class="sxs-lookup"><span data-stu-id="03596-604">This structure helps distribute the load across message brokers and message stores, increasing scalability and improving availability.</span></span> <span data-ttu-id="03596-605">Если брокер или хранилище сообщений для одного фрагмента временно недоступны, служебная шина может получить сообщения от одного из оставшихся доступных фрагментов.</span><span class="sxs-lookup"><span data-stu-id="03596-605">If the message broker or message store for one fragment is temporarily unavailable, Service Bus can retrieve messages from one of the remaining available fragments.</span></span>

<span data-ttu-id="03596-606">Служебная шина присваивает сообщение фрагменту следующим образом.</span><span class="sxs-lookup"><span data-stu-id="03596-606">Service Bus assigns a message to a fragment as follows:</span></span>

* <span data-ttu-id="03596-607">Если сообщение относится к сеансу, все сообщения с одинаковым значением свойства *SessionId* отправляются в один и тот же фрагмент.</span><span class="sxs-lookup"><span data-stu-id="03596-607">If the message belongs to a session, all messages with the same value for the * SessionId*  property are sent to the same fragment.</span></span>
* <span data-ttu-id="03596-608">Если сообщение не относится к сеансу, но отправитель указал значение для свойства *PartitionKey*, все сообщения с тем же значением *PartitionKey* отправляются в тот же фрагмент.</span><span class="sxs-lookup"><span data-stu-id="03596-608">If the message does not belong to a session, but the sender has specified a value for the *PartitionKey* property, then all messages with the same *PartitionKey* value are sent to the same fragment.</span></span>

  > [!NOTE]
  > <span data-ttu-id="03596-609">Если значения заданы обоим свойствам (*SessionId* и *PartitionKey*), они должны быть одинаковыми, иначе сообщение будет отклонено.</span><span class="sxs-lookup"><span data-stu-id="03596-609">If the *SessionId* and *PartitionKey* properties are both specified, then they must be set to the same value or the message will be rejected.</span></span>
  >
  >
* <span data-ttu-id="03596-610">Если свойства *SessionId* и *PartitionKey* для сообщения не заданы, но включен поиск повторяющихся данных, будет использоваться свойство *MessageId*.</span><span class="sxs-lookup"><span data-stu-id="03596-610">If the *SessionId* and *PartitionKey* properties for a message are not specified, but duplicate detection is enabled, the *MessageId* property will be used.</span></span> <span data-ttu-id="03596-611">Все сообщения с тем же значением *MessageId* будут направляться в тот же фрагмент.</span><span class="sxs-lookup"><span data-stu-id="03596-611">All messages with the same *MessageId* will be directed to the same fragment.</span></span>
* <span data-ttu-id="03596-612">Если сообщения не содержат свойства *SessionId, PartitionKey* или *MessageId*, служебная шина назначает сообщения фрагментам по очереди.</span><span class="sxs-lookup"><span data-stu-id="03596-612">If messages do not include a *SessionId, PartitionKey,* or *MessageId* property, then Service Bus assigns messages to fragments sequentially.</span></span> <span data-ttu-id="03596-613">Если фрагмент недоступен, служебная шина перейдет к следующему.</span><span class="sxs-lookup"><span data-stu-id="03596-613">If a fragment is unavailable, Service Bus will move on to the next.</span></span> <span data-ttu-id="03596-614">Таким образом, временная ошибка в инфраструктуре обмена сообщениями не вызовет сбой операции отправки сообщения.</span><span class="sxs-lookup"><span data-stu-id="03596-614">This means that a temporary fault in the messaging infrastructure does not cause the message-send operation to fail.</span></span>

<span data-ttu-id="03596-615">При принятии решения о том, стоит ли и как именно секционировать очередь сообщений или раздел служебной шины, рекомендуется учитывать следующее.</span><span class="sxs-lookup"><span data-stu-id="03596-615">Consider the following points when deciding if or how to partition a Service Bus message queue or topic:</span></span>

* <span data-ttu-id="03596-616">Очереди и разделы служебной шины создаются в области пространства имен служебной шины.</span><span class="sxs-lookup"><span data-stu-id="03596-616">Service Bus queues and topics are created within the scope of a Service Bus namespace.</span></span> <span data-ttu-id="03596-617">В настоящее время служебная шина обеспечивает до 100 секционированных очередей или разделов на пространство имен.</span><span class="sxs-lookup"><span data-stu-id="03596-617">Service Bus currently allows up to 100 partitioned queues or topics per namespace.</span></span>
* <span data-ttu-id="03596-618">Каждое пространство имен служебной шины налагает квоты на доступные ресурсы, такие как количество подписок на раздел, количество параллельных запросов на отправку и получение в секунду, а также максимальное число одновременных подключений, которые можно установить.</span><span class="sxs-lookup"><span data-stu-id="03596-618">Each Service Bus namespace imposes quotas on the available resources, such as the number of subscriptions per topic, the number of concurrent send and receive requests per second, and the maximum number of concurrent connections that can be established.</span></span> <span data-ttu-id="03596-619">Эти квоты описаны на странице [Квоты на служебную шину]на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-619">These quotas are documented on the Microsoft website on the page [Service Bus quotas].</span></span> <span data-ttu-id="03596-620">Если предполагается, что эти значения будут превышены, создайте дополнительные пространства имен с собственными очередями и разделами и распределите работу по этим пространствам имен.</span><span class="sxs-lookup"><span data-stu-id="03596-620">If you expect to exceed these values, then create additional namespaces with their own queues and topics, and spread the work across these namespaces.</span></span> <span data-ttu-id="03596-621">Например, в глобальном приложении создайте отдельные пространства имен в каждом регионе и настройте экземпляры приложения на использование очередей и разделов в ближайшем пространстве имен.</span><span class="sxs-lookup"><span data-stu-id="03596-621">For example, in a global application, create separate namespaces in each region and configure application instances to use the queues and topics in the nearest namespace.</span></span>
* <span data-ttu-id="03596-622">Сообщения, отправленные в рамках транзакции, должны указать ключ секции.</span><span class="sxs-lookup"><span data-stu-id="03596-622">Messages that are sent as part of a transaction must specify a partition key.</span></span> <span data-ttu-id="03596-623">Это может быть свойство *SessionId*, *PartitionKey* или *MessageId*.</span><span class="sxs-lookup"><span data-stu-id="03596-623">This can be a *SessionId*, *PartitionKey*, or *MessageId* property.</span></span> <span data-ttu-id="03596-624">Все сообщения, отправленные в рамках одной транзакции, должны указать один и тот же ключ секции, так как их должен обрабатывать один брокер сообщений.</span><span class="sxs-lookup"><span data-stu-id="03596-624">All messages that are sent as part of the same transaction must specify the same partition key because they must be handled by the same message broker process.</span></span> <span data-ttu-id="03596-625">Невозможно отправить сообщения в различные очереди или разделы в рамках одной транзакции.</span><span class="sxs-lookup"><span data-stu-id="03596-625">You cannot send messages to different queues or topics within the same transaction.</span></span>
* <span data-ttu-id="03596-626">Невозможно настроить автоматическое удаление секционированной очереди или раздела, когда они становятся неактивными.</span><span class="sxs-lookup"><span data-stu-id="03596-626">Partitioned queues and topics can't be configured to be automatically deleted when they become idle.</span></span>
* <span data-ttu-id="03596-627">При построении межплатформенных или гибридных решений в настоящее время нельзя использовать секционированные очереди и расширенный протокол управления очередью сообщений (AMQP).</span><span class="sxs-lookup"><span data-stu-id="03596-627">Partitioned queues and topics can't currently be used with the Advanced Message Queuing Protocol (AMQP) if you are building cross-platform or hybrid solutions.</span></span>

## <a name="partitioning-strategies-for-documentdb-api"></a><span data-ttu-id="03596-628">Стратегии секционирования для API DocumentDB</span><span class="sxs-lookup"><span data-stu-id="03596-628">Partitioning strategies for DocumentDB API</span></span>
<span data-ttu-id="03596-629">Azure Cosmos DB — это база данных NoSQL для хранения документов, использующая интерфейс [DocumentDB API][documentdb-api].</span><span class="sxs-lookup"><span data-stu-id="03596-629">Azure Cosmos DB is a NoSQL database that can store documents using the [DocumentDB API][documentdb-api].</span></span> <span data-ttu-id="03596-630">Документ в базе данных Cosmos DB является представлением сериализованных данных JSON объекта или другого блока данных.</span><span class="sxs-lookup"><span data-stu-id="03596-630">A document in a Cosmos DB database is a JSON-serialized representation of an object or other piece of data.</span></span> <span data-ttu-id="03596-631">Фиксированные схемы не применяются, за исключением того, что каждый документ должен содержать уникальный идентификатор.</span><span class="sxs-lookup"><span data-stu-id="03596-631">No fixed schemas are enforced except that every document must contain a unique ID.</span></span>

<span data-ttu-id="03596-632">Документы организованы в коллекции.</span><span class="sxs-lookup"><span data-stu-id="03596-632">Documents are organized into collections.</span></span> <span data-ttu-id="03596-633">Связанные документы можно группировать в коллекции.</span><span class="sxs-lookup"><span data-stu-id="03596-633">You can group related documents together in a collection.</span></span> <span data-ttu-id="03596-634">Например, в системе, которая хранит сообщения блогов, можно хранить содержимое каждой записи блога в виде документа в коллекции.</span><span class="sxs-lookup"><span data-stu-id="03596-634">For example, in a system that maintains blog postings, you can store the contents of each blog post as a document in a collection.</span></span> <span data-ttu-id="03596-635">Можно также создавать коллекции для каждого типа субъекта.</span><span class="sxs-lookup"><span data-stu-id="03596-635">You can also create collections for each subject type.</span></span> <span data-ttu-id="03596-636">Кроме того, в мультитенантном приложении, таком как система, где разные авторы управляют собственными блогами и записями, можно секционировать блоги по авторам и создавать отдельную коллекцию для каждого автора.</span><span class="sxs-lookup"><span data-stu-id="03596-636">Alternatively, in a multitenant application, such as a system where different authors control and manage their own blog posts, you can partition blogs by author and create separate collections for each author.</span></span> <span data-ttu-id="03596-637">Выделенное для коллекций дисковое пространство гибкое и может уменьшаться или увеличиваться по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="03596-637">The storage space that's allocated to collections is elastic and can shrink or grow as needed.</span></span>

<span data-ttu-id="03596-638">Коллекция документов предоставляет естественный механизм для секционирования данных в пределах отдельной базы данных.</span><span class="sxs-lookup"><span data-stu-id="03596-638">Document collections provide a natural mechanism for partitioning data within a single database.</span></span> <span data-ttu-id="03596-639">База данных Cosmos DB может размещаться на нескольких серверах. В некоторой степени она балансирует нагрузку, распределяя коллекции между серверами.</span><span class="sxs-lookup"><span data-stu-id="03596-639">Internally, a Cosmos DB database can span several servers and might attempt to spread the load by distributing collections across servers.</span></span> <span data-ttu-id="03596-640">Самый простой способ реализации сегментирования — создание коллекции для каждого сегмента.</span><span class="sxs-lookup"><span data-stu-id="03596-640">The simplest way to implement sharding is to create a collection for each shard.</span></span>

> [!NOTE]
> <span data-ttu-id="03596-641">У каждой базы данных Cosmos DB свой *уровень производительности*, который определяет объем выделяемых для нее ресурсов.</span><span class="sxs-lookup"><span data-stu-id="03596-641">Each Cosmos DB database has a *performance level* that determines the amount of resources it gets.</span></span> <span data-ttu-id="03596-642">Каждый уровень производительности связан с ограничением частоты в виде *единицы запроса* (ЕЗ).</span><span class="sxs-lookup"><span data-stu-id="03596-642">A performance level is associated with a *request unit* (RU) rate limit.</span></span> <span data-ttu-id="03596-643">Ограничение частоты RU определяет объем ресурсов, которые зарезервированы для этой коллекции и доступны для эксклюзивного использования этой коллекцией.</span><span class="sxs-lookup"><span data-stu-id="03596-643">The RU rate limit specifies the volume of resources that's reserved and available for exclusive use by that collection.</span></span> <span data-ttu-id="03596-644">Стоимость коллекции зависит от выбранного для нее уровня производительности.</span><span class="sxs-lookup"><span data-stu-id="03596-644">The cost of a collection depends on the performance level that's selected for that collection.</span></span> <span data-ttu-id="03596-645">Чем выше уровень производительность (и ограничение частоты RU), тем выше стоимость.</span><span class="sxs-lookup"><span data-stu-id="03596-645">The higher the performance level (and RU rate limit) the higher the charge.</span></span> <span data-ttu-id="03596-646">Уровень производительности коллекции можно настроить с помощью портала Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-646">You can adjust the performance level of a collection by using the Azure portal.</span></span> <span data-ttu-id="03596-647">Дополнительные сведения см. в описании [уровней производительности в Cosmos DB] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-647">For more information, see the page [Performance levels in Cosmos DB] on the Microsoft website.</span></span>
>
>

<span data-ttu-id="03596-648">Все базы данных создаются в контексте учетной записи базы данных Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="03596-648">All databases are created in the context of a Cosmos DB database account.</span></span> <span data-ttu-id="03596-649">Одна учетная запись может содержать несколько баз данных. Также она определяет, в каком регионе создаются эти базы данных.</span><span class="sxs-lookup"><span data-stu-id="03596-649">A single account can contain several databases, and it specifies in which regions the databases are created.</span></span> <span data-ttu-id="03596-650">Кроме того, для каждой учетной записи отдельно настраивается управление доступом.</span><span class="sxs-lookup"><span data-stu-id="03596-650">Each account also enforces its own access control.</span></span> <span data-ttu-id="03596-651">С помощью учетных записей Cosmos DB вы можете выделить сегменты (коллекции в базах данных), географически расположенные рядом с пользователями, и настроить ограничения так, чтобы к ним подключались только такие пользователи.</span><span class="sxs-lookup"><span data-stu-id="03596-651">You can use Cosmos DB accounts to geo-locate shards (collections within databases) close to the users who need to access them, and enforce restrictions so that only those users can connect to them.</span></span>

<span data-ttu-id="03596-652">Каждая учетная запись Cosmos DB имеет определенную квоту, которая ограничивает число содержащихся в ней баз данных и коллекций, а также доступный объем хранилища документов.</span><span class="sxs-lookup"><span data-stu-id="03596-652">Each Cosmos DB account has a quota that limits the number of databases and collections that it can contain and the amount of document storage that's available.</span></span> <span data-ttu-id="03596-653">Дополнительные сведения см. в статье [Подписка Azure и лимиты службы, квоты и ограничения][azure-limits].</span><span class="sxs-lookup"><span data-stu-id="03596-653">For more information, see [Azure subscription and service limits, quotas, and constraints][azure-limits].</span></span> <span data-ttu-id="03596-654">При реализации системы, где все сегменты принадлежат одной базе данных, теоретически возможно достичь предельной емкости хранилища в учетной записи.</span><span class="sxs-lookup"><span data-stu-id="03596-654">It is theoretically possible that if you implement a system where all shards belong to the same database, you might reach the storage capacity limit of the account.</span></span>

<span data-ttu-id="03596-655">В этом случае вы можете создать дополнительные учетные записи и базы данных, а затем распределить сегменты между ними.</span><span class="sxs-lookup"><span data-stu-id="03596-655">In this case, you might need to create additional accounts and databases, and distribute the shards across these databases.</span></span> <span data-ttu-id="03596-656">Даже если вы не ожидаете превышения емкости хранилища базы данных, целесообразно использовать несколько баз данных.</span><span class="sxs-lookup"><span data-stu-id="03596-656">However, even if you are unlikely to reach the storage capacity of a database, it's a good practice to use multiple databases.</span></span> <span data-ttu-id="03596-657">Это связано с тем, что каждая база данных имеет собственный набор пользователей и разрешений. Этот механизм позволяет изолировать доступ к коллекциям отдельно для каждой базы данных.</span><span class="sxs-lookup"><span data-stu-id="03596-657">That's because each database has its own set of users and permissions, and you can use this mechanism to isolate access to collections on a per-database basis.</span></span>

<span data-ttu-id="03596-658">На рис. 8 показана обобщенная структура API DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="03596-658">Figure 8 illustrates the high-level structure of the DocumentDB API.</span></span>

![Структура API DocumentDB](./images/data-partitioning/DocumentDBStructure.png)

<span data-ttu-id="03596-660">*Рис. 8.  Структура архитектуры API DocumentDB*</span><span class="sxs-lookup"><span data-stu-id="03596-660">*Figure 8.  The structure of the DocumentDB API architecture*</span></span>

<span data-ttu-id="03596-661">Клиентское приложение должно отвечать за направление запросов в соответствующий сегмент, обычно путем реализации собственного механизма сопоставления на основе некоторых атрибутов данных, которые определяют ключ сегмента.</span><span class="sxs-lookup"><span data-stu-id="03596-661">It is the task of the client application to direct requests to the appropriate shard, usually by implementing its own mapping mechanism based on some attributes of the data that define the shard key.</span></span> <span data-ttu-id="03596-662">На рис. 9 показаны две базы данных API DocumentDB, каждая из которых содержит две коллекции, выполняющие роль сегментов.</span><span class="sxs-lookup"><span data-stu-id="03596-662">Figure 9 shows two DocumentDB API databases, each containing two collections that are acting as shards.</span></span> <span data-ttu-id="03596-663">Данные сегментируются по идентификатору клиента и содержат данные конкретного клиента.</span><span class="sxs-lookup"><span data-stu-id="03596-663">The data is sharded by a tenant ID and contains the data for a specific tenant.</span></span> <span data-ttu-id="03596-664">Базы данных создаются в отдельных учетных записях Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="03596-664">The databases are created in separate Cosmos DB accounts.</span></span> <span data-ttu-id="03596-665">Эти учетные записи находятся в том же регионе, что и клиенты, данные которых они содержат.</span><span class="sxs-lookup"><span data-stu-id="03596-665">These accounts are located in the same region as the tenants for which they contain data.</span></span> <span data-ttu-id="03596-666">Логика маршрутизации в клиентском приложении использует идентификатор клиента как ключ сегментирования.</span><span class="sxs-lookup"><span data-stu-id="03596-666">The routing logic in the client application uses the tenant ID as the shard key.</span></span>

![Реализация сегментирования с помощью API DocumentDB](./images/data-partitioning/DocumentDBPartitions.png)

<span data-ttu-id="03596-668">*Рис. 9. Реализация сегментирования с помощью API DocumentDB*</span><span class="sxs-lookup"><span data-stu-id="03596-668">*Figure 9. Implementing sharding using the DocumentDB API*</span></span>

<span data-ttu-id="03596-669">Принимая решение о том, как секционировать данные с помощью API DocumentDB, учитывайте следующие аспекты:</span><span class="sxs-lookup"><span data-stu-id="03596-669">Consider the following points when deciding how to partition data with the DocumentDB API:</span></span>

* <span data-ttu-id="03596-670">**Ресурсы, доступные для базы данных API DocumentDB, могут быть ограничены квотами учетной записи.**</span><span class="sxs-lookup"><span data-stu-id="03596-670">**The resources available to a DocumentDB API database are subject to the quota limitations of the account**.</span></span> <span data-ttu-id="03596-671">Каждая база данных может содержать несколько коллекций (здесь тоже есть ограничение), каждая из которых связана с уровнем производительности, который управляет ограничением частоты RU (зарезервированной пропускной способностью) для этой коллекции.</span><span class="sxs-lookup"><span data-stu-id="03596-671">Each database can hold a number of collections (again, there is a limit), and each collection is associated with a performance level that governs the RU rate limit (reserved throughput) for that collection.</span></span> <span data-ttu-id="03596-672">Дополнительные сведения см. в статье [Подписка Azure и лимиты службы, квоты и ограничения].</span><span class="sxs-lookup"><span data-stu-id="03596-672">For more information, see [Azure subscription and service limits, quotas, and constraints].</span></span>
* <span data-ttu-id="03596-673">**Каждый документ должен иметь атрибут, который используется для идентификации этого документа в пределах содержащей его коллекции**.</span><span class="sxs-lookup"><span data-stu-id="03596-673">**Each document must have an attribute that can be used to uniquely identify that document within the collection in which it is held**.</span></span> <span data-ttu-id="03596-674">Этот атрибут отличается от ключа сегмента, который определяет, в какой коллекции содержится документ.</span><span class="sxs-lookup"><span data-stu-id="03596-674">This attribute is different from the shard key, which defines which collection holds the document.</span></span> <span data-ttu-id="03596-675">Коллекция может содержать большое количество документов.</span><span class="sxs-lookup"><span data-stu-id="03596-675">A collection can contain a large number of documents.</span></span> <span data-ttu-id="03596-676">Теоретически она ограничена только максимальной длиной идентификатора документа.</span><span class="sxs-lookup"><span data-stu-id="03596-676">In theory, it's limited only by the maximum length of the document ID.</span></span> <span data-ttu-id="03596-677">Идентификатор документа может включать до 255 символов.</span><span class="sxs-lookup"><span data-stu-id="03596-677">The document ID can be up to 255 characters.</span></span>
* <span data-ttu-id="03596-678">**Все операции с документом выполняются в контексте транзакции. Транзакции выполняются в той коллекции, где содержится документ.**</span><span class="sxs-lookup"><span data-stu-id="03596-678">**All operations against a document are performed within the context of a transaction. Transactions are scoped to the collection in which the document is contained.**</span></span> <span data-ttu-id="03596-679">Если произошел сбой операции, происходит откат выполняемой работы.</span><span class="sxs-lookup"><span data-stu-id="03596-679">If an operation fails, the work that it has performed is rolled back.</span></span> <span data-ttu-id="03596-680">Пока выполняется операция с документом, любые сделанные изменения подвергаются изоляции уровня моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="03596-680">While a document is subject to an operation, any changes that are made are subject to snapshot-level isolation.</span></span> <span data-ttu-id="03596-681">Этот механизм гарантирует, что если, например, запрос на создание нового документа завершается ошибкой, другой пользователь, одновременно запрашивающий базу данных, не увидит частичный документ, который затем удаляется.</span><span class="sxs-lookup"><span data-stu-id="03596-681">This mechanism guarantees that if, for example, a request to create a new document fails, another user who's querying the database simultaneously will not see a partial document that is then removed.</span></span>
* <span data-ttu-id="03596-682">**Запросы к базам данных также ограничиваются уровнем коллекции**.</span><span class="sxs-lookup"><span data-stu-id="03596-682">**Database queries are also scoped to the collection level**.</span></span> <span data-ttu-id="03596-683">Один запрос может получать данные только из одной коллекции.</span><span class="sxs-lookup"><span data-stu-id="03596-683">A single query can retrieve data from only one collection.</span></span> <span data-ttu-id="03596-684">Если требуется получить данные из нескольких коллекций, необходимо запросить каждую коллекцию отдельно и объединить результаты в коде приложения.</span><span class="sxs-lookup"><span data-stu-id="03596-684">If you need to retrieve data from multiple collections, you must query each collection individually and merge the results in your application code.</span></span>
* <span data-ttu-id="03596-685">**Базы данных API DocumentDB поддерживают программируемые элементы, которые можно хранить в коллекции вместе с документами**.</span><span class="sxs-lookup"><span data-stu-id="03596-685">**DocumentDB API databases supports programmable items that can all be stored in a collection alongside documents**.</span></span> <span data-ttu-id="03596-686">Это хранимые процедуры, определяемые пользователем функции и триггеры (на языке JavaScript).</span><span class="sxs-lookup"><span data-stu-id="03596-686">These include stored procedures, user-defined functions, and triggers (written in JavaScript).</span></span> <span data-ttu-id="03596-687">Эти элементы могут получить доступ к любому документу в одной коллекции.</span><span class="sxs-lookup"><span data-stu-id="03596-687">These items can access any document within the same collection.</span></span> <span data-ttu-id="03596-688">Кроме того, эти элементы выполняются либо внутри области внешней транзакции (в случае триггера, срабатывающего в результате операций создания, удаления и замены документа), либо путем запуска новой транзакции (в случае хранимой процедуры, выполняемой в результате явного запроса клиента).</span><span class="sxs-lookup"><span data-stu-id="03596-688">Furthermore, these items run either inside the scope of the ambient transaction (in the case of a trigger that fires as the result of a create, delete, or replace operation performed against a document), or by starting a new transaction (in the case of a stored procedure that is run as the result of an explicit client request).</span></span> <span data-ttu-id="03596-689">Если код в программируемом элементе создает исключение, транзакция откатывается.</span><span class="sxs-lookup"><span data-stu-id="03596-689">If the code in a programmable item throws an exception, the transaction is rolled back.</span></span> <span data-ttu-id="03596-690">Чтобы сохранить целостность и согласованность между документами, можно использовать хранимые процедуры и триггеры, но эти документы всегда должны быть частью одной коллекции.</span><span class="sxs-lookup"><span data-stu-id="03596-690">You can use stored procedures and triggers to maintain integrity and consistency between documents, but these documents must all be part of the same collection.</span></span>
* <span data-ttu-id="03596-691">**В базах данных следует хранить такие коллекции, нагрузка на которые не превысит ограничения пропускной способности, установленных для соответствующего уровня производительности**.</span><span class="sxs-lookup"><span data-stu-id="03596-691">**The collections that you intend to hold in the databases should be unlikely to exceed the throughput limits defined by the performance levels of the collections**.</span></span> <span data-ttu-id="03596-692">См. дополнительные сведения о единицах запросов в базе данных Azure Cosmos DB][cosmos-db-ru].</span><span class="sxs-lookup"><span data-stu-id="03596-692">For more informationm, see Request Units in Azure Cosmos DB][cosmos-db-ru].</span></span> <span data-ttu-id="03596-693">Если вы ожидаете, что нагрузка превысит эти ограничения, попробуйте распределить коллекции между базами данных в разных учетных записях, чтобы снизить нагрузку на каждую коллекцию.</span><span class="sxs-lookup"><span data-stu-id="03596-693">If you anticipate reaching these limits, consider splitting collections across databases in different accounts to reduce the load per collection.</span></span>

## <a name="partitioning-strategies-for-azure-search"></a><span data-ttu-id="03596-694">Стратегии секционирования для поиска Azure</span><span class="sxs-lookup"><span data-stu-id="03596-694">Partitioning strategies for Azure Search</span></span>
<span data-ttu-id="03596-695">Возможность поиска данных часто является основным методом навигации и просмотра, который предоставляют многие веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="03596-695">The ability to search for data is often the primary method of navigation and exploration that's provided by many web applications.</span></span> <span data-ttu-id="03596-696">Она помогает пользователям быстро находить ресурсы (например продукты в приложении электронной коммерции) на основе сочетания условий поиска.</span><span class="sxs-lookup"><span data-stu-id="03596-696">It helps users find resources quickly (for example, products in an e-commerce application) based on combinations of search criteria.</span></span> <span data-ttu-id="03596-697">Служба поиска Azure предоставляет возможности полнотекстового поиска по веб-содержимому и включает такие функции, как автозаполнение, предлагаемые запросы на основании совпадений и многогранная навигация.</span><span class="sxs-lookup"><span data-stu-id="03596-697">The Azure Search service provides full-text search capabilities over web content, and includes features such as type-ahead, suggested queries based on near matches, and faceted navigation.</span></span> <span data-ttu-id="03596-698">Полное описание этих возможностей см. на странице [What is Azure Search?] (Общие сведения о поиске Azure) на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-698">A full description of these capabilities is available on the page [What is Azure Search?] on the Microsoft website.</span></span>

<span data-ttu-id="03596-699">Служба поиска Azure хранит подлежащее поиску содержимое как документы JSON в базе данных.</span><span class="sxs-lookup"><span data-stu-id="03596-699">Azure Search stores searchable content as JSON documents in a database.</span></span> <span data-ttu-id="03596-700">Можно определить индексы, которые указывают поля для поиска в этих документах, и предоставить эти определения службе поиска Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-700">You define indexes that specify the searchable fields in these documents and provide these definitions to Azure Search.</span></span> <span data-ttu-id="03596-701">Когда пользователь отправляет поисковый запрос, служба поиска Azure использует соответствующие индексы для поиска совпадающих элементов.</span><span class="sxs-lookup"><span data-stu-id="03596-701">When a user submits a search request, Azure Search uses the appropriate indexes to find matching items.</span></span>

<span data-ttu-id="03596-702">Чтобы снизить количество конфликтов, можно разделить хранилища, используемые службой поиска Azure, на 1, 2, 3, 4, 6 или 12 секций, и каждую секцию реплицировать до 6 раз.</span><span class="sxs-lookup"><span data-stu-id="03596-702">To reduce contention, the storage that's used by Azure Search can be divided into 1, 2, 3, 4, 6, or 12 partitions, and each partition can be replicated up to 6 times.</span></span> <span data-ttu-id="03596-703">Произведение числа секций и числа реплик называется *единицей поиска* (SU).</span><span class="sxs-lookup"><span data-stu-id="03596-703">The product of the number of partitions multiplied by the number of replicas is called the *search unit* (SU).</span></span> <span data-ttu-id="03596-704">Один экземпляр службы поиска Azure может содержать не более 36 единиц поиска (база данных с 12 секциями поддерживает не более 3 реплик).</span><span class="sxs-lookup"><span data-stu-id="03596-704">A single instance of Azure Search can contain a maximum of 36 SUs (a database with 12 partitions only supports a maximum of 3 replicas).</span></span>

<span data-ttu-id="03596-705">Плата взимается за каждую единицу поиска, выделенную для службы.</span><span class="sxs-lookup"><span data-stu-id="03596-705">You are billed for each SU that is allocated to your service.</span></span> <span data-ttu-id="03596-706">При увеличении объема содержимого для поиска или скорости запросов поиска можно добавить единицы поиска в существующий экземпляр службы поиска Azure для обработки дополнительной нагрузки.</span><span class="sxs-lookup"><span data-stu-id="03596-706">As the volume of searchable content increases or the rate of search requests grows, you can add SUs to an existing instance of Azure Search to handle the extra load.</span></span> <span data-ttu-id="03596-707">Сама служба поиска Azure отвечает за равномерное распределение документов по секциям.</span><span class="sxs-lookup"><span data-stu-id="03596-707">Azure Search itself distributes the documents evenly across the partitions.</span></span> <span data-ttu-id="03596-708">Сейчас стратегии секционирования вручную не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="03596-708">No manual partitioning strategies are currently supported.</span></span>

<span data-ttu-id="03596-709">Каждая секция может содержать не более 15 миллионов документов или занимать не более 300 ГБ дискового пространства (в зависимости от того, какое значение ниже).</span><span class="sxs-lookup"><span data-stu-id="03596-709">Each partition can contain a maximum of 15 million documents or occupy 300 GB of storage space (whichever is smaller).</span></span> <span data-ttu-id="03596-710">Можно создать до 50 индексов.</span><span class="sxs-lookup"><span data-stu-id="03596-710">You can create up to 50 indexes.</span></span> <span data-ttu-id="03596-711">Производительность службы зависит от сложности документов, доступных индексов и эффектов задержки в сети.</span><span class="sxs-lookup"><span data-stu-id="03596-711">The performance of the service varies and depends on the complexity of the documents, the available indexes, and the effects of network latency.</span></span> <span data-ttu-id="03596-712">В среднем одна реплика (1 единица поиска) должна уметь обрабатывать 15 запросов в секунду (QPS), хотя рекомендуется выполнить тестирование производительности со своими данными, чтобы получить более точные показатели пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="03596-712">On average, a single replica (1 SU) should be able to handle 15 queries per second (QPS), although we recommend performing benchmarking with your own data to obtain a more precise measure of throughput.</span></span> <span data-ttu-id="03596-713">Дополнительные сведения см. на странице [Ограничения службы поиска Azure] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-713">For more information, see the page [Service limits in Azure Search] on the Microsoft website.</span></span>

> [!NOTE]
> <span data-ttu-id="03596-714">В документах для поиска можно хранить ограниченный набор типов данных: строки, логические значения, числовые данные, данные даты и времени и географические данные.</span><span class="sxs-lookup"><span data-stu-id="03596-714">You can store a limited set of data types in searchable documents, including strings, Booleans, numeric data, datetime data, and some geographical data.</span></span> <span data-ttu-id="03596-715">Дополнительные сведения см. на странице [Supported data types (Azure Search)] (Поддерживаемые типы данных (поиск Azure)) на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-715">For more details, see the page [Supported data types (Azure Search)] on the Microsoft website.</span></span>
>
>

<span data-ttu-id="03596-716">Вы можете лишь частично контролировать то, как служба поиска Azure секционирует данные для каждого экземпляра службы.</span><span class="sxs-lookup"><span data-stu-id="03596-716">You have limited control over how Azure Search partitions data for each instance of the service.</span></span> <span data-ttu-id="03596-717">Однако в глобальной среде можно повысить производительность и снизить задержку и количество конфликтов за счет секционирования самой службы одним из следующих способов.</span><span class="sxs-lookup"><span data-stu-id="03596-717">However, in a global environment you might be able to improve performance and reduce latency and contention further by partitioning the service itself using either of the following strategies:</span></span>

* <span data-ttu-id="03596-718">Создайте экземпляр службы поиска Azure в каждом географическом регионе и убедитесь, что клиентские приложения направляются к ближайшему доступному экземпляру.</span><span class="sxs-lookup"><span data-stu-id="03596-718">Create an instance of Azure Search in each geographic region, and ensure that client applications are directed towards the nearest available instance.</span></span> <span data-ttu-id="03596-719">Эта стратегия требует своевременной репликации всех обновлений содержимого для поиска во всех экземплярах службы.</span><span class="sxs-lookup"><span data-stu-id="03596-719">This strategy requires that any updates to searchable content are replicated in a timely manner across all instances of the service.</span></span>
* <span data-ttu-id="03596-720">Создайте два уровня службы поиска Azure:</span><span class="sxs-lookup"><span data-stu-id="03596-720">Create two tiers of Azure Search:</span></span>

  * <span data-ttu-id="03596-721">локальную службу в каждом регионе, которая содержит наиболее часто применяемые пользователями этого региона данные.</span><span class="sxs-lookup"><span data-stu-id="03596-721">A local service in each region that contains the data that's most frequently accessed by users in that region.</span></span> <span data-ttu-id="03596-722">Пользователи могут направлять запросы в локальную службу для получения быстрых, но ограниченных результатов.</span><span class="sxs-lookup"><span data-stu-id="03596-722">Users can direct requests here for fast but limited results.</span></span>
  * <span data-ttu-id="03596-723">Глобальная служба, которая включает в себя все данные.</span><span class="sxs-lookup"><span data-stu-id="03596-723">A global service that encompasses all the data.</span></span> <span data-ttu-id="03596-724">Пользователи могут направлять запросы в глобальную службу для получения менее быстрых, но более полных результатов.</span><span class="sxs-lookup"><span data-stu-id="03596-724">Users can direct requests here for slower but more complete results.</span></span>

<span data-ttu-id="03596-725">Этот подход наиболее эффективен при значительных региональных различиях в данных, по которым выполняется поиск.</span><span class="sxs-lookup"><span data-stu-id="03596-725">This approach is most suitable when there is a significant regional variation in the data that's being searched.</span></span>

## <a name="partitioning-strategies-for-azure-redis-cache"></a><span data-ttu-id="03596-726">Стратегии секционирования кэша Redis для Azure</span><span class="sxs-lookup"><span data-stu-id="03596-726">Partitioning strategies for Azure Redis Cache</span></span>
<span data-ttu-id="03596-727">Кэш Redis для Azure предоставляет службу общего кэша в облаке, которая основана на хранилище данных Redis типа ключ-значение.</span><span class="sxs-lookup"><span data-stu-id="03596-727">Azure Redis Cache provides a shared caching service in the cloud that's based on the Redis key-value data store.</span></span> <span data-ttu-id="03596-728">Как понятно из названия, кэш Redis для Azure создан как решение для кэширования.</span><span class="sxs-lookup"><span data-stu-id="03596-728">As its name implies, Azure Redis Cache is intended as a caching solution.</span></span> <span data-ttu-id="03596-729">Поэтому его следует использовать только для хранения временных данных, а не как постоянное хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="03596-729">Use it only for holding transient data and not as a permanent data store.</span></span> <span data-ttu-id="03596-730">Приложения, использующие кэш Redis для Azure, должны иметь возможность продолжать работу, даже если кэш недоступен.</span><span class="sxs-lookup"><span data-stu-id="03596-730">Applications that utilize Azure Redis Cache should be able to continue functioning if the cache is unavailable.</span></span> <span data-ttu-id="03596-731">Кэш Redis для Azure поддерживает первичную или вторичную репликацию для обеспечения высокой доступности, но сейчас максимальный размер кэша ограничен 53 ГБ.</span><span class="sxs-lookup"><span data-stu-id="03596-731">Azure Redis Cache supports primary/secondary replication to provide high availability, but currently limits the maximum cache size to 53 GB.</span></span> <span data-ttu-id="03596-732">Если требуется больше места, необходимо создать дополнительные кэши.</span><span class="sxs-lookup"><span data-stu-id="03596-732">If you need more space than this, you must create additional caches.</span></span> <span data-ttu-id="03596-733">Дополнительные сведения см. на странице [Кэш Redis для Azure] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-733">For more information, go to the page [Azure Redis Cache] on the Microsoft website.</span></span>

<span data-ttu-id="03596-734">Секционирование хранилища данных Redis включает в себя разбиение данных по экземплярам службы Redis.</span><span class="sxs-lookup"><span data-stu-id="03596-734">Partitioning a Redis data store involves splitting the data across instances of the Redis service.</span></span> <span data-ttu-id="03596-735">Каждый экземпляр представляет одну секцию.</span><span class="sxs-lookup"><span data-stu-id="03596-735">Each instance constitutes a single partition.</span></span> <span data-ttu-id="03596-736">Кэш Redis для Azure абстрагирует службы Redis за фасадом и не раскрывает их напрямую.</span><span class="sxs-lookup"><span data-stu-id="03596-736">Azure Redis Cache abstracts the Redis services behind a façade and does not expose them directly.</span></span> <span data-ttu-id="03596-737">Самый простой способ реализации секционирования — создание нескольких экземпляров кэша Redis для Azure и распределение данных между ними.</span><span class="sxs-lookup"><span data-stu-id="03596-737">The simplest way to implement partitioning is to create multiple Azure Redis Cache instances and spread the data across them.</span></span>

<span data-ttu-id="03596-738">Каждый элемент данных можно связать с идентификатором (ключом секции), который указывает, в каком кэше его следует хранить.</span><span class="sxs-lookup"><span data-stu-id="03596-738">You can associate each data item with an identifier (a partition key) that specifies which cache stores the data item.</span></span> <span data-ttu-id="03596-739">Логика клиентского приложения может использовать этот идентификатор для перенаправления запросов в соответствующую секцию.</span><span class="sxs-lookup"><span data-stu-id="03596-739">The client application logic can then use this identifier to route requests to the appropriate partition.</span></span> <span data-ttu-id="03596-740">Эта схема очень проста, но при изменении схемы секционирования (например, если создаются дополнительные экземпляры кэша Redis для Azure) может потребоваться изменение конфигурации клиентских приложений.</span><span class="sxs-lookup"><span data-stu-id="03596-740">This scheme is very simple, but if the partitioning scheme changes (for example, if additional Azure Redis Cache instances are created), client applications might need to be reconfigured.</span></span>

<span data-ttu-id="03596-741">Собственный Redis (не кэш Redis для Azure) поддерживает серверную часть секционирования на основе кластеризации Redis.</span><span class="sxs-lookup"><span data-stu-id="03596-741">Native Redis (not Azure Redis Cache) supports server-side partitioning based on Redis clustering.</span></span> <span data-ttu-id="03596-742">При таком подходе данные делятся поровну между серверами с помощью механизма хэширования.</span><span class="sxs-lookup"><span data-stu-id="03596-742">In this approach, you can divide the data evenly across servers by using a hashing mechanism.</span></span> <span data-ttu-id="03596-743">На каждом сервере Redis хранятся метаданные, описывающие диапазон содержащихся в секции хэш-ключей, а также сведения о хэш-ключах, которые находятся в секциях на других серверах.</span><span class="sxs-lookup"><span data-stu-id="03596-743">Each Redis server stores metadata that describes the range of hash keys that the partition holds, and also contains information about which hash keys are located in the partitions on other servers.</span></span>

<span data-ttu-id="03596-744">Клиентские приложения просто отправляют запросы на любой сервер-участник Redis (скорее всего, на ближайший).</span><span class="sxs-lookup"><span data-stu-id="03596-744">Client applications simply send requests to any of the participating Redis servers (probably the closest one).</span></span> <span data-ttu-id="03596-745">Сервер Redis проверяет запрос клиента.</span><span class="sxs-lookup"><span data-stu-id="03596-745">The Redis server examines the client request.</span></span> <span data-ttu-id="03596-746">Если его можно разрешить локально, сервер выполняет запрошенную операцию.</span><span class="sxs-lookup"><span data-stu-id="03596-746">If it can be resolved locally, it performs the requested operation.</span></span> <span data-ttu-id="03596-747">В противном случае он перенаправляет запрос на соответствующий сервер.</span><span class="sxs-lookup"><span data-stu-id="03596-747">Otherwise it forwards the request on to the appropriate server.</span></span>

<span data-ttu-id="03596-748">Эта модель реализуется с помощью кластеризации Redis и более подробно описана на странице [Учебник по кластерам Redis] на веб-сайте Redis.</span><span class="sxs-lookup"><span data-stu-id="03596-748">This model is implemented by using Redis clustering, and is described in more detail on the [Redis cluster tutorial] page on the Redis website.</span></span> <span data-ttu-id="03596-749">Кластеризация Redis прозрачна для клиентских приложений.</span><span class="sxs-lookup"><span data-stu-id="03596-749">Redis clustering is transparent to client applications.</span></span> <span data-ttu-id="03596-750">В кластер можно добавлять дополнительные серверы Redis (а также повторно секционировать данные) без необходимости перенастройки клиентов.</span><span class="sxs-lookup"><span data-stu-id="03596-750">Additional Redis servers can be added to the cluster (and the data can be re-partitioned) without requiring that you reconfigure the clients.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="03596-751">Кэш Redis для Azure в настоящее время не поддерживает кластеризацию Redis.</span><span class="sxs-lookup"><span data-stu-id="03596-751">Azure Redis Cache does not currently support Redis clustering.</span></span> <span data-ttu-id="03596-752">Если вы хотите реализовать такой подход с Azure, необходимо сначала реализовать собственные серверы Redis, установив Redis на набор виртуальных машин Azure и настроив их вручную.</span><span class="sxs-lookup"><span data-stu-id="03596-752">If you want to implement this approach with Azure, then you must implement your own Redis servers by installing Redis on a set of Azure virtual machines and configuring them manually.</span></span> <span data-ttu-id="03596-753">На странице [Запуск Redis на виртуальной машине CentOS Linux в Azure] на веб-сайте Майкрософт содержится пример, показывающий, как создать и настроить узел Redis, запущенный в качестве виртуальной машины Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-753">The page [Running Redis on a CentOS Linux VM in Azure] on the Microsoft website walks through an example that shows you how to build and configure a Redis node running as an Azure VM.</span></span>
>
>

<span data-ttu-id="03596-754">Дополнительные сведения о реализации секционирования с помощью Redis см. на странице [Partitioning: how to split data among multiple Redis instances] (Секционирование: распределение данных между несколькими экземплярами Redis) на веб-сайте Redis.</span><span class="sxs-lookup"><span data-stu-id="03596-754">The page [Partitioning: how to split data among multiple Redis instances] on the Redis website provides more information about implementing partitioning with Redis.</span></span> <span data-ttu-id="03596-755">В оставшейся части этого раздела предполагается, что вы реализуете секционирование на стороне клиента или через прокси-сервер.</span><span class="sxs-lookup"><span data-stu-id="03596-755">The remainder of this section assumes that you are implementing client-side or proxy-assisted partitioning.</span></span>

<span data-ttu-id="03596-756">При выборе способа секционирования данных с помощью кэша Redis для Azure учитывайте следующие моменты.</span><span class="sxs-lookup"><span data-stu-id="03596-756">Consider the following points when deciding how to partition data with Azure Redis Cache:</span></span>

* <span data-ttu-id="03596-757">Кэш Redis для Azure не предназначен для работы в качестве постоянного хранилища данных, поэтому, какую бы схему секционирования вы ни выбрали, код приложения должен быть готов извлекать данные из источника, не являющегося кэшем.</span><span class="sxs-lookup"><span data-stu-id="03596-757">Azure Redis Cache is not intended to act as a permanent data store, so whatever partitioning scheme you implement, your application code must be able to retrieve data from a location that's not the cache.</span></span>
* <span data-ttu-id="03596-758">Часто используемые данные необходимо размещать в одной секции.</span><span class="sxs-lookup"><span data-stu-id="03596-758">Data that is frequently accessed together should be kept in the same partition.</span></span> <span data-ttu-id="03596-759">Redis — это эффективное хранилище типа ключ-значение, которое предоставляет несколько значительно оптимизированных механизмов для структурирования данных.</span><span class="sxs-lookup"><span data-stu-id="03596-759">Redis is a powerful key-value store that provides several highly optimized mechanisms for structuring data.</span></span> <span data-ttu-id="03596-760">Механизмы могут быть следующими:</span><span class="sxs-lookup"><span data-stu-id="03596-760">These mechanisms can be one of the following:</span></span>

  * <span data-ttu-id="03596-761">простые строки (двоичные данные длиной до 512 МБ);</span><span class="sxs-lookup"><span data-stu-id="03596-761">Simple strings (binary data up to 512 MB in length)</span></span>
  * <span data-ttu-id="03596-762">агрегатные типы, такие как списки (которые могут выступать в качестве очередей и стеков);</span><span class="sxs-lookup"><span data-stu-id="03596-762">Aggregate types such as lists (which can act as queues and stacks)</span></span>
  * <span data-ttu-id="03596-763">наборы (упорядоченные и неупорядоченные);</span><span class="sxs-lookup"><span data-stu-id="03596-763">Sets (ordered and unordered)</span></span>
  * <span data-ttu-id="03596-764">хэши (которые могут группировать связанные поля, например элементы, представляющие поля в объекте).</span><span class="sxs-lookup"><span data-stu-id="03596-764">Hashes (which can group related fields together, such as the items that represent the fields in an object)</span></span>
* <span data-ttu-id="03596-765">Агрегатные типы позволяют связывать несколько взаимосвязанных значений с одним ключом.</span><span class="sxs-lookup"><span data-stu-id="03596-765">The aggregate types enable you to associate many related values with the same key.</span></span> <span data-ttu-id="03596-766">Ключ Redis определяет список, набор или хэш, а не элементы данных, которые он содержит.</span><span class="sxs-lookup"><span data-stu-id="03596-766">A Redis key identifies a list, set, or hash rather than the data items that it contains.</span></span> <span data-ttu-id="03596-767">Все эти типы доступны в кэше Redis для Azure и описаны на странице [Data types] (Типы данных) на веб-сайте Redis.</span><span class="sxs-lookup"><span data-stu-id="03596-767">These types are all available with Azure Redis Cache and are described by the [Data types] page on the Redis website.</span></span> <span data-ttu-id="03596-768">Например, в части системы электронной коммерции, отслеживающей размещенные клиентами заказы, подробные сведения о каждом клиенте могут храниться в хэше Redis, зашифрованном с помощью идентификатора клиента.</span><span class="sxs-lookup"><span data-stu-id="03596-768">For example, in part of an e-commerce system that tracks the orders that are placed by customers, the details of each customer can be stored in a Redis hash that is keyed by using the customer ID.</span></span> <span data-ttu-id="03596-769">Каждый хэш может содержать коллекцию идентификаторов заказов клиента.</span><span class="sxs-lookup"><span data-stu-id="03596-769">Each hash can hold a collection of order IDs for the customer.</span></span> <span data-ttu-id="03596-770">Отдельный набор Redis может содержать заказы, опять же структурированные как хэши, зашифрованные с помощью идентификатора заказа.</span><span class="sxs-lookup"><span data-stu-id="03596-770">A separate Redis set can hold the orders, again structured as hashes, and keyed by using the order ID.</span></span> <span data-ttu-id="03596-771">Эта структура показана на рис. 10.</span><span class="sxs-lookup"><span data-stu-id="03596-771">Figure 10 shows this structure.</span></span> <span data-ttu-id="03596-772">Обратите внимание, что Redis не реализует какую-либо форму целостности данных, поэтому разработчик сам должен обеспечить связь между клиентами и заказами.</span><span class="sxs-lookup"><span data-stu-id="03596-772">Note that Redis does not implement any form of referential integrity, so it is the developer's responsibility to maintain the relationships between customers and orders.</span></span>

![Предлагаемая структура в хранилище Redis для записи заказов клиентов и сведений о них](./images/data-partitioning/RedisCustomersandOrders.png)

<span data-ttu-id="03596-774">*Рис. 10. Предлагаемая структура в хранилище Redis для записи заказов клиентов и сведений о них*</span><span class="sxs-lookup"><span data-stu-id="03596-774">*Figure 10. Suggested structure in Redis storage for recording customer orders and their details*</span></span>

> [!NOTE]
> <span data-ttu-id="03596-775">В Redis все ключи являются значениями двоичных данных (например строки Redis) и могут содержать до 512 МБ данных.</span><span class="sxs-lookup"><span data-stu-id="03596-775">In Redis, all keys are binary data values (like Redis strings) and can contain up to 512 MB of data.</span></span> <span data-ttu-id="03596-776">В теории ключ может содержать почти любую информацию.</span><span class="sxs-lookup"><span data-stu-id="03596-776">In theory, a key can contain almost any information.</span></span> <span data-ttu-id="03596-777">Однако рекомендуется использовать согласованный контекст именования ключей, согласно которому имя должно описывать тип данных и определять сущность, но не быть слишком длинным.</span><span class="sxs-lookup"><span data-stu-id="03596-777">However, we recommend adopting a consistent naming convention for keys that is descriptive of the type of data and that identifies the entity, but is not excessively long.</span></span> <span data-ttu-id="03596-778">Распространенный подход — использовать ключи в формате "entity_type: ID".</span><span class="sxs-lookup"><span data-stu-id="03596-778">A common approach is to use keys of the form "entity_type:ID".</span></span> <span data-ttu-id="03596-779">Например, можно использовать "customer: 99", чтобы указать ключ для клиента с идентификатором 99.</span><span class="sxs-lookup"><span data-stu-id="03596-779">For example, you can use "customer:99" to indicate the key for a customer with the ID 99.</span></span>
>
>

* <span data-ttu-id="03596-780">Можно реализовать вертикальное секционирование, сохраняя связанные сведения в различных агрегатах в одной базе данных.</span><span class="sxs-lookup"><span data-stu-id="03596-780">You can implement vertical partitioning by storing related information in different aggregations in the same database.</span></span> <span data-ttu-id="03596-781">Например, в приложении электронной коммерции можно хранить часто используемые сведения о продуктах в одном хэше Redis, а реже используемые сведения — в другом.</span><span class="sxs-lookup"><span data-stu-id="03596-781">For example, in an e-commerce application, you can store commonly accessed information about products in one Redis hash and less frequently used detailed information in another.</span></span>
  <span data-ttu-id="03596-782">Оба хэша могут использовать один и тот же идентификатор продукта как часть ключа.</span><span class="sxs-lookup"><span data-stu-id="03596-782">Both hashes can use the same product ID as part of the key.</span></span> <span data-ttu-id="03596-783">Например, используйте формат "product: *nn*" (где *nn* — идентификатор продукта) для предоставления сведений о продукте и "product_details: *nn*" для подробного описания.</span><span class="sxs-lookup"><span data-stu-id="03596-783">For example, you can use "product: *nn*" (where *nn* is the product ID) for the product information and "product_details: *nn*" for the detailed data.</span></span> <span data-ttu-id="03596-784">Эта стратегия позволяет сократить объем данных, к которым обращается большинство запросов.</span><span class="sxs-lookup"><span data-stu-id="03596-784">This strategy can help reduce the volume of data that most queries are likely to retrieve.</span></span>
* <span data-ttu-id="03596-785">Перераспределение хранилища данных Redis является сложной задачей, которая требует много времени.</span><span class="sxs-lookup"><span data-stu-id="03596-785">You can repartition a Redis data store, but keep in mind that it's a complex and time-consuming task.</span></span> <span data-ttu-id="03596-786">Кластеризация Redis может секционировать данные автоматически, но эта возможность не поддерживается в кэше Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-786">Redis clustering can repartition data automatically, but this capability is not available with Azure Redis Cache.</span></span> <span data-ttu-id="03596-787">Таким образом, при разработке схемы секционирования попытайтесь оставить достаточно свободного места в каждой секции, чтобы учесть ожидаемый со временем рост данных.</span><span class="sxs-lookup"><span data-stu-id="03596-787">Therefore, when you design your partitioning scheme, try to leave sufficient free space in each partition to allow for expected data growth over time.</span></span> <span data-ttu-id="03596-788">Однако помните, что кэш Redis для Azure предназначен для временного кэширования данных, а также что у данных, хранящихся в кэше, может быть ограниченное время существования, указанное как значение срока жизни (TTL).</span><span class="sxs-lookup"><span data-stu-id="03596-788">However, remember that Azure Redis Cache is intended to cache data temporarily, and that data held in the cache can have a limited lifetime specified as a time-to-live (TTL) value.</span></span> <span data-ttu-id="03596-789">Для относительно временных данных значение TTL должно быть коротким, но для статических данных значение TTL может быть гораздо большим.</span><span class="sxs-lookup"><span data-stu-id="03596-789">For relatively volatile data, the TTL can be short, but for static data the TTL can be a lot longer.</span></span> <span data-ttu-id="03596-790">Не следует хранить большие объемы долгоживущих данных в кэше, если эти данные, скорее всего, переполнят кэш.</span><span class="sxs-lookup"><span data-stu-id="03596-790">Avoid storing large amounts of long-lived data in the cache if the volume of this data is likely to fill the cache.</span></span> <span data-ttu-id="03596-791">Можно указать политику вытеснения, согласно которой кэш Redis для Azure будет удалять данные, если места осталось мало.</span><span class="sxs-lookup"><span data-stu-id="03596-791">You can specify an eviction policy that causes Azure Redis Cache to remove data if space is at a premium.</span></span>

  > [!NOTE]
  > <span data-ttu-id="03596-792">При использовании кэша Redis для Azure вы указываете максимальный размер кэша (от 250 МБ до 53 ГБ), выбирая соответствующую ценовую категорию.</span><span class="sxs-lookup"><span data-stu-id="03596-792">When you use Azure Redis cache, you specify the maximum size of the cache (from 250 MB to 53 GB) by selecting the appropriate pricing tier.</span></span> <span data-ttu-id="03596-793">Однако после создания кэша Redis для Azure нельзя увеличить (или уменьшить) его размер.</span><span class="sxs-lookup"><span data-stu-id="03596-793">However, after an Azure Redis Cache has been created, you cannot increase (or decrease) its size.</span></span>
  >
  >
* <span data-ttu-id="03596-794">Пакеты и транзакции Redis не могут охватывать несколько подключений, поэтому все данные, затрагиваемые пакетом или транзакцией, должны храниться в одной базе данных (в одном сегменте).</span><span class="sxs-lookup"><span data-stu-id="03596-794">Redis batches and transactions cannot span multiple connections, so all data that is affected by a batch or transaction should be held in the same database (shard).</span></span>

  > [!NOTE]
  > <span data-ttu-id="03596-795">Последовательность операций в транзакции Redis не обязательно является неделимой.</span><span class="sxs-lookup"><span data-stu-id="03596-795">A sequence of operations in a Redis transaction is not necessarily atomic.</span></span> <span data-ttu-id="03596-796">Команды, которые составляют транзакцию, проверяются и добавляются в очередь перед выполнением.</span><span class="sxs-lookup"><span data-stu-id="03596-796">The commands that compose a transaction are verified and queued before they run.</span></span> <span data-ttu-id="03596-797">Если на этом этапе возникает ошибка, вся очередь удаляется.</span><span class="sxs-lookup"><span data-stu-id="03596-797">If an error occurs during this phase, the entire queue is discarded.</span></span> <span data-ttu-id="03596-798">Однако после успешной отправки транзакции команды в очереди будут выполняться последовательно.</span><span class="sxs-lookup"><span data-stu-id="03596-798">However, after the transaction has been successfully submitted, the queued commands run in sequence.</span></span> <span data-ttu-id="03596-799">Если какая-либо из команд завершается ошибкой, прерывается только эта команда.</span><span class="sxs-lookup"><span data-stu-id="03596-799">If any command fails, only that command stops running.</span></span> <span data-ttu-id="03596-800">Все предыдущие и последующие команды выполняются по очереди.</span><span class="sxs-lookup"><span data-stu-id="03596-800">All previous and subsequent commands in the queue are performed.</span></span> <span data-ttu-id="03596-801">Дополнительные сведения см. на странице [Transactions] (Транзакции) на веб-сайте Redis.</span><span class="sxs-lookup"><span data-stu-id="03596-801">For more information, go to the [Transactions] page on the Redis website.</span></span>
  >
  >
* <span data-ttu-id="03596-802">Redis поддерживает ограниченное число атомарных операций.</span><span class="sxs-lookup"><span data-stu-id="03596-802">Redis supports a limited number of atomic operations.</span></span> <span data-ttu-id="03596-803">Единственными операциями такого типа, которые поддерживают несколько ключей, являются MGET и MSET.</span><span class="sxs-lookup"><span data-stu-id="03596-803">The only operations of this type that support multiple keys and values are MGET and MSET operations.</span></span> <span data-ttu-id="03596-804">Операции MGET возвращают коллекцию значений для указанного списка ключей, а операции MSET сохраняют коллекцию значений для указанного списка ключей.</span><span class="sxs-lookup"><span data-stu-id="03596-804">MGET operations return a collection of values for a specified list of keys, and MSET operations store a collection of values for a specified list of keys.</span></span> <span data-ttu-id="03596-805">Если необходимо использовать эти операции, пары ключ-значение, на которые ссылаются команды MSET и MGET, должны храниться в той же базе данных.</span><span class="sxs-lookup"><span data-stu-id="03596-805">If you need to use these operations, the key-value pairs that are referenced by the MSET and MGET commands must be stored within the same database.</span></span>

## <a name="partitioning-strategies-for-azure-service-fabric"></a><span data-ttu-id="03596-806">Стратегии секционирования для Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="03596-806">Partitioning Strategies for Azure Service Fabric</span></span>
<span data-ttu-id="03596-807">Azure Service Fabric — это платформа микрослужб, которая предоставляет в облаке среду выполнения для распределенных приложений.</span><span class="sxs-lookup"><span data-stu-id="03596-807">Azure Service Fabric is a microservices platform that provides a runtime for distributed applications in the cloud.</span></span> <span data-ttu-id="03596-808">Service Fabric поддерживает гостевые исполняемые файлы .NET, службы с отслеживанием состояния и без, а также контейнеры.</span><span class="sxs-lookup"><span data-stu-id="03596-808">Service Fabric supports .Net guest executables, stateful and stateless services, and containers.</span></span> <span data-ttu-id="03596-809">Службы с отслеживанием состояния предоставляют [надежные коллекции][service-fabric-reliable-collections] для долгосрочного хранения данных в формате "ключ — значение" в кластере Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="03596-809">Stateful services provide a [reliable collection][service-fabric-reliable-collections] to persistently store data in a key-value collection within the Service Fabric cluster.</span></span> <span data-ttu-id="03596-810">Дополнительные сведения об использовании ключей сегментирования в надежной коллекции см. в [инструкциях и рекомендациях по работе с надежными коллекциями в Azure Service Fabric].</span><span class="sxs-lookup"><span data-stu-id="03596-810">For more information about strategies for partioning keys in a reliable collection, see [guidelines and recommendations for reliable collections in Azure Service Fabric].</span></span>

### <a name="more-information"></a><span data-ttu-id="03596-811">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="03596-811">More information</span></span>
* <span data-ttu-id="03596-812">В статье [Общие сведения о Service Fabric] содержится обзор службы Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="03596-812">[Overview of Azure Service Fabric] is an introduction to Azure Service Fabric.</span></span>
* <span data-ttu-id="03596-813">В статье [Секционирование служб Reliable Services в Service Fabric] содержатся дополнительные сведения о надежных службах в Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="03596-813">[Partition Service Fabric reliable services] provides more information about reliable services in Azure Service Fabric.</span></span>

## <a name="partitioning-strategies-for-azure-event-hubs"></a><span data-ttu-id="03596-814">Стратегии секционирования для концентраторов событий Azure</span><span class="sxs-lookup"><span data-stu-id="03596-814">Partitioning strategies for Azure Event Hubs</span></span>

<span data-ttu-id="03596-815">[Концентраторы событий Azure][event-hubs] предназначены для потоковой передачи данных в больших объемах. В них реализована встроенная поддержка секционирования, которая обеспечивает горизонтальное масштабирование.</span><span class="sxs-lookup"><span data-stu-id="03596-815">[Azure Event Hubs][event-hubs] is designed for data streaming at massive scale, and partitioning is built into the service to enable horizontal scaling.</span></span> <span data-ttu-id="03596-816">Каждый потребитель считывает только определенный раздел потока сообщений.</span><span class="sxs-lookup"><span data-stu-id="03596-816">Each consumer only reads a specific partition of the message stream.</span></span> 

<span data-ttu-id="03596-817">Издателю событий известен только ключ секции, но не сама секция, в которой публикуются события.</span><span class="sxs-lookup"><span data-stu-id="03596-817">The event publisher is only aware of its partition key, not the partition to which the events are published.</span></span> <span data-ttu-id="03596-818">Благодаря разделению ключа и секции отправителю не нужно располагать избыточными сведениями о последующей обработке и хранении событий.</span><span class="sxs-lookup"><span data-stu-id="03596-818">This decoupling of key and partition insulates the sender from needing to know too much about the downstream processing.</span></span> <span data-ttu-id="03596-819">(Также есть возможность отправлять события напрямую в определенную секцию, но обычно так делать не следует.)</span><span class="sxs-lookup"><span data-stu-id="03596-819">(It's also possible send events directly to a given partition, but generally that's not recommended.)</span></span>  

<span data-ttu-id="03596-820">Выбирать число секций следует с учетом долгосрочной перспективы.</span><span class="sxs-lookup"><span data-stu-id="03596-820">Consider long-term scale when you select the partition count.</span></span> <span data-ttu-id="03596-821">Создав концентратор событий, вы уже не сможете изменить число секций.</span><span class="sxs-lookup"><span data-stu-id="03596-821">After an event hub is created, you can't change the number of partitions.</span></span> 

<span data-ttu-id="03596-822">Дополнительные сведения об использовании секций в концентраторах событий см. в статье [Что такое концентраторы событий?]</span><span class="sxs-lookup"><span data-stu-id="03596-822">For more information about using partitions in Event Hubs, see [What is Event Hubs?].</span></span>

<span data-ttu-id="03596-823">См. также дополнительные сведения о [доступности и согласованности в концентраторах событий].</span><span class="sxs-lookup"><span data-stu-id="03596-823">For considerations about trade-offs between availability and consistency, see [Availability and consistency in Event Hubs].</span></span>

## <a name="rebalancing-partitions"></a><span data-ttu-id="03596-824">Балансировка секций</span><span class="sxs-lookup"><span data-stu-id="03596-824">Rebalancing partitions</span></span>
<span data-ttu-id="03596-825">По мере того как система развивается и схемы использования становятся более понятны, может возникнуть необходимость изменить схему секционирования.</span><span class="sxs-lookup"><span data-stu-id="03596-825">As a system matures and you understand the usage patterns better, you might have to adjust the partitioning scheme.</span></span> <span data-ttu-id="03596-826">Например, отдельные секции могут начать привлекать непропорциональный объем трафика и становятся горячими точками, что приводит к слишком большому количеству конфликтов.</span><span class="sxs-lookup"><span data-stu-id="03596-826">For example, individual partitions might start attracting a disproportionate volume of traffic and become hot, leading to excessive contention.</span></span> <span data-ttu-id="03596-827">Кроме того, вы могли недооценить объем данных в некоторых секциях, в результате чего достигли пределов емкости хранилища в этих секциях.</span><span class="sxs-lookup"><span data-stu-id="03596-827">Additionally, you might have underestimated the volume of data in some partitions, causing you to approach the limits of the storage capacity in these partitions.</span></span> <span data-ttu-id="03596-828">Какой бы ни была причина, иногда необходимо повторно сбалансировать секции, чтобы более равномерно распределить нагрузку.</span><span class="sxs-lookup"><span data-stu-id="03596-828">Whatever the cause, it is sometimes necessary to rebalance partitions to spread the load more evenly.</span></span>

<span data-ttu-id="03596-829">В некоторых случаях системы хранения данных, которые не демонстрируют способ распределения данных на серверах, могут автоматически балансировать секции в пределах доступных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="03596-829">In some cases, data storage systems that don't publicly expose how data is allocated to servers can automatically rebalance partitions within the limits of the resources available.</span></span> <span data-ttu-id="03596-830">В других ситуациях перераспределение является административной задачей, которая состоит из двух этапов.</span><span class="sxs-lookup"><span data-stu-id="03596-830">In other situations, rebalancing is an administrative task that consists of two stages:</span></span>

1. <span data-ttu-id="03596-831">Сначала необходимо определить новую стратегию секционирования, чтобы понять следующие моменты:</span><span class="sxs-lookup"><span data-stu-id="03596-831">Determining the new partitioning strategy to ascertain:</span></span>
   * <span data-ttu-id="03596-832">Какие секции необходимо разделить (или, возможно, объединить).</span><span class="sxs-lookup"><span data-stu-id="03596-832">Which partitions might need to be split (or possibly combined).</span></span>
   * <span data-ttu-id="03596-833">Как разместить данные в этих новых секциях, создав новые ключи секций.</span><span class="sxs-lookup"><span data-stu-id="03596-833">How to allocate data to these new partitions by designing new partition keys.</span></span>
2. <span data-ttu-id="03596-834">Затем необходимо перенести затронутые данные из старой схемы секционирования в новый набор секций.</span><span class="sxs-lookup"><span data-stu-id="03596-834">Migrating the affected data from the old partitioning scheme to the new set of partitions.</span></span>

> [!NOTE]
> <span data-ttu-id="03596-835">Сопоставление коллекций и серверов баз данных является прозрачным, но вы можете достигнуть пределов емкости хранилища и (или) пропускной способности учетной записи Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="03596-835">The mapping of database collections to servers is transparent, but you can still reach the storage capacity and throughput limits of a Cosmos DB account.</span></span> <span data-ttu-id="03596-836">В этом случае потребуется изменить схему секционирования и перенести данные.</span><span class="sxs-lookup"><span data-stu-id="03596-836">If this happens, you might need to redesign your partitioning scheme and migrate the data.</span></span>
>
>

<span data-ttu-id="03596-837">В зависимости от технологии хранения данных и структуры системы хранения данных у вас может быть возможность перенести данные между секциями, не останавливая их использование (оперативная миграция).</span><span class="sxs-lookup"><span data-stu-id="03596-837">Depending on the data storage technology and the design of your data storage system, you might be able to migrate data between partitions while they are in use (online migration).</span></span> <span data-ttu-id="03596-838">Если это невозможно, потребуется заблокировать доступ к соответствующим секциям на время перемещения данных (автономная миграция).</span><span class="sxs-lookup"><span data-stu-id="03596-838">If this isn't possible, you might need to make the affected partitions temporarily unavailable while the data is relocated (offline migration).</span></span>

## <a name="offline-migration"></a><span data-ttu-id="03596-839">Автономная миграция</span><span class="sxs-lookup"><span data-stu-id="03596-839">Offline migration</span></span>
<span data-ttu-id="03596-840">Автономная миграция, возможно, является самым простым подходом, так как уменьшает вероятность возможных конфликтов.</span><span class="sxs-lookup"><span data-stu-id="03596-840">Offline migration is arguably the simplest approach because it reduces the chances of contention occurring.</span></span> <span data-ttu-id="03596-841">Не вносите никаких изменений в данные во время перемещения и реструктуризации.</span><span class="sxs-lookup"><span data-stu-id="03596-841">Don't make any changes to the data while it is being moved and restructured.</span></span>

<span data-ttu-id="03596-842">По сути, этот процесс включает в себя следующие шаги:</span><span class="sxs-lookup"><span data-stu-id="03596-842">Conceptually, this process includes the following steps:</span></span>

1. <span data-ttu-id="03596-843">пометить сегменты как отключенные;</span><span class="sxs-lookup"><span data-stu-id="03596-843">Mark the shard offline.</span></span>
2. <span data-ttu-id="03596-844">разделить или объединить сегменты и переместить данные в новые сегменты;</span><span class="sxs-lookup"><span data-stu-id="03596-844">Split-merge and move the data to the new shards.</span></span>
3. <span data-ttu-id="03596-845">проверить данные;</span><span class="sxs-lookup"><span data-stu-id="03596-845">Verify the data.</span></span>
4. <span data-ttu-id="03596-846">подключить новые сегменты;</span><span class="sxs-lookup"><span data-stu-id="03596-846">Bring the new shards online.</span></span>
5. <span data-ttu-id="03596-847">удалить старый сегмент.</span><span class="sxs-lookup"><span data-stu-id="03596-847">Remove the old shard.</span></span>

<span data-ttu-id="03596-848">Чтобы сохранить некоторую доступность, можно в шаге 1 сделать исходный сегмент доступным только для чтения, а не полностью недоступным.</span><span class="sxs-lookup"><span data-stu-id="03596-848">To retain some availability, you can mark the original shard as read-only in step 1 rather than making it unavailable.</span></span> <span data-ttu-id="03596-849">Это позволит приложениям считывать данные во время перемещения, но не изменять их.</span><span class="sxs-lookup"><span data-stu-id="03596-849">This allows applications to read the data while it is being moved but not to change it.</span></span>

## <a name="online-migration"></a><span data-ttu-id="03596-850">Оперативная миграция</span><span class="sxs-lookup"><span data-stu-id="03596-850">Online migration</span></span>
<span data-ttu-id="03596-851">Оперативную миграцию реализовать сложнее, но удобнее для пользователей, так как данные остаются доступными во время всей процедуры.</span><span class="sxs-lookup"><span data-stu-id="03596-851">Online migration is more complex to perform but less disruptive to users because data remains available during the entire procedure.</span></span> <span data-ttu-id="03596-852">Процесс аналогичен процессу автономной миграции, за исключением того, что исходный сегмент не помечается как отключенный (шаг 1).</span><span class="sxs-lookup"><span data-stu-id="03596-852">The process is similar to that used by offline migration, except that the original shard is not marked offline (step 1).</span></span> <span data-ttu-id="03596-853">В зависимости от гранулярности процесса миграции (например по элементу или по сегменту), коду доступа к данным в клиентских приложениях может понадобиться считывать и записывать данные, находящиеся в двух расположениях (в исходном сегменте и в новом).</span><span class="sxs-lookup"><span data-stu-id="03596-853">Depending on the granularity of the migration process (for example, whether it's done item by item or shard by shard), the data access code in the client applications might have to handle reading and writing data that's held in two locations (the original shard and the new shard).</span></span>

<span data-ttu-id="03596-854">Пример решения, которое поддерживает оперативную миграцию, см. в статье [Перемещение данных между масштабируемыми облачными базами данных] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-854">For an example of a solution that supports online migration, see the article [Scaling using the Elastic Database split-merge tool] on the Microsoft website.</span></span>

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="03596-855">Связанные шаблоны и рекомендации</span><span class="sxs-lookup"><span data-stu-id="03596-855">Related patterns and guidance</span></span>
<span data-ttu-id="03596-856">При выборе стратегии реализации согласованности данных для вашего сценария также могут быть полезны указанные далее шаблоны.</span><span class="sxs-lookup"><span data-stu-id="03596-856">When considering strategies for implementing data consistency, the following patterns might also be relevant to your scenario:</span></span>

* <span data-ttu-id="03596-857">[руководстве по согласованности данных] на веб-сайте Майкрософт описывает стратегии для поддержания согласованности в распределенной среде, например в облаке.</span><span class="sxs-lookup"><span data-stu-id="03596-857">The [Data consistency primer] page on the Microsoft website describes strategies for maintaining consistency in a distributed environment such as the cloud.</span></span>
* <span data-ttu-id="03596-858">На странице [Рекомендации по секционированию данных] на веб-сайте Майкрософт предоставлены общие сведения по проектированию секций для удовлетворения различных критериев в распределенном решении.</span><span class="sxs-lookup"><span data-stu-id="03596-858">The [Data partitioning guidance] page on the Microsoft website provides a general overview of how to design partitions to meet various criteria in a distributed solution.</span></span>
* <span data-ttu-id="03596-859">[Шаблон сегментирования] , описанный на веб-сайте Майкрософт, включает некоторые распространенные стратегии для сегментирования данных.</span><span class="sxs-lookup"><span data-stu-id="03596-859">The [sharding pattern] as described on the Microsoft website summarizes some common strategies for sharding data.</span></span>
* <span data-ttu-id="03596-860">[Шаблон таблицы индексов] , описанный на веб-сайте Майкрософт, иллюстрирует создание вторичных индексов данных.</span><span class="sxs-lookup"><span data-stu-id="03596-860">The [index table pattern] as described on the Microsoft website illustrates how to create secondary indexes over data.</span></span> <span data-ttu-id="03596-861">Такой подход позволяет приложению быстро получить данные с помощью запросов, которые не ссылаются на первичный ключ коллекции.</span><span class="sxs-lookup"><span data-stu-id="03596-861">An application can quickly retrieve data with this approach, by using queries that do not reference the primary key of a collection.</span></span>
* <span data-ttu-id="03596-862">[Шаблон материализованного представления] , представленный на веб-сайте Майкрософт, описывает, как создавать предварительно заполненные представления, которые отображают итоговые данные для поддержки операций быстрого запроса.</span><span class="sxs-lookup"><span data-stu-id="03596-862">The [materialized view pattern] as described on the Microsoft website describes how to generate pre-populated views that summarize data to support fast query operations.</span></span> <span data-ttu-id="03596-863">Этот подход можно использовать в секционированном хранилище данных, если секции, содержащие итоговые данные, распределены по нескольким сайтам.</span><span class="sxs-lookup"><span data-stu-id="03596-863">This approach can be useful in a partitioned data store if the partitions that contain the data being summarized are distributed across multiple sites.</span></span>
* <span data-ttu-id="03596-864">Статья [использованию сети доставки содержимого Azure] содержит дополнительные рекомендации по настройке и использованию сети доставки содержимого с помощью Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-864">The [Using Azure Content Delivery Network] article on the Microsoft website provides additional guidance on configuring and using Content Delivery Network with Azure.</span></span>

## <a name="more-information"></a><span data-ttu-id="03596-865">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="03596-865">More information</span></span>
* <span data-ttu-id="03596-866">На странице [Что такое база данных SQL? Введение в базы данных SQL] на веб-сайте Майкрософт представлена подробная документация, в которой описываются способы создания и использования базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="03596-866">The page [What is Azure SQL Database?] on the Microsoft website provides detailed documentation that describes how to create and use SQL databases.</span></span>
* <span data-ttu-id="03596-867">Дополнительные сведения об эластичной базе данных см. на странице [Развертывание с помощью Базы данных SQL Azure] на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="03596-867">The page [Elastic Database features overview] on the Microsoft website provides a comprehensive introduction to Elastic Database.</span></span>
* <span data-ttu-id="03596-868">На странице [Перемещение данных между масштабируемыми облачными базами данных] веб-сайта Майкрософт содержатся сведения об использовании службы разбиения и объединения для управления сегментами эластичной базы данных.</span><span class="sxs-lookup"><span data-stu-id="03596-868">The page [Scaling using the Elastic Database split-merge tool] on the Microsoft website contains information about using the split-merge service to manage Elastic Database shards.</span></span>
* <span data-ttu-id="03596-869">На странице [Целевые показатели производительности и масштабируемости хранилища Azure](https://msdn.microsoft.com/library/azure/dn249410.aspx) на веб-сайте Майкрософт перечислены текущие ограничения размера и пропускной способности хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-869">The page [Azure storage scalability and performance targets](https://msdn.microsoft.com/library/azure/dn249410.aspx) on the Microsoft website documents the current sizing and throughput limits of Azure Storage.</span></span>
* <span data-ttu-id="03596-870">На странице [Выполнение групповых транзакций сущности] на веб-сайте Майкрософт предоставлены подробные сведения о реализации транзакционных операций по сущностям, хранящимся в хранилище таблиц Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-870">The page [Performing entity group transactions] on the Microsoft website provides detailed information about implementing transactional operations over entities that are stored in Azure table storage.</span></span>
* <span data-ttu-id="03596-871">Статья [Руководство по разработке таблиц хранилища Azure] на веб-сайте Майкрософт содержит подробные сведения о секционировании данных в хранилище таблиц Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-871">The article [Azure Storage table design guide] on the Microsoft website contains detailed information about partitioning data in Azure table storage.</span></span>
* <span data-ttu-id="03596-872">В статье [использованию сети доставки содержимого Azure] объясняется, как реплицировать данные, хранящиеся в хранилище BLOB-объектов Azure, с помощью сети доставки содержимого Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-872">The page [Using Azure Content Delivery Network] on the Microsoft website describes how to replicate data that's held in Azure blob storage by using the Azure Content Delivery Network.</span></span>
* <span data-ttu-id="03596-873">Страница [What is Azure Search?] на веб-сайте Майкрософт содержит полное описание возможностей, доступных в службе поиска Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-873">The page [What is Azure Search?] on the Microsoft website provides a full description of the capabilities that are available in Azure Search.</span></span>
* <span data-ttu-id="03596-874">На странице [Ограничения службы поиска Azure] на веб-сайте Майкрософт представлены сведения о емкости каждого экземпляра службы поиска Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-874">The page [Service limits in Azure Search] on the Microsoft website contains information about the capacity of each instance of Azure Search.</span></span>
* <span data-ttu-id="03596-875">На странице [Поддерживаемые типы данных (служба поиска Azure)] на веб-сайте Майкрософт перечислены типы данных, которые можно использовать в документах и индексах для поиска.</span><span class="sxs-lookup"><span data-stu-id="03596-875">The page [Supported data types (Azure Search)] on the Microsoft website summarizes the data types that you can use in searchable documents and indexes.</span></span>
* <span data-ttu-id="03596-876">На странице [Кэш Redis для Azure] на веб-сайте Майкрософт представлено введение в кэш Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-876">The page [Azure Redis Cache] on the Microsoft website provides an introduction to Azure Redis Cache.</span></span>
* <span data-ttu-id="03596-877">На странице [Partitioning: how to split data among multiple Redis instances] на веб-сайте Redis содержатся сведения о реализации секционирования с использованием Redis.</span><span class="sxs-lookup"><span data-stu-id="03596-877">The [Partitioning: how to split data among multiple Redis instances] page on the Redis website provides information about how to implement partitioning with Redis.</span></span>
* <span data-ttu-id="03596-878">На странице [Запуск Redis на виртуальной машине CentOS Linux в Azure] на веб-сайте Майкрософт содержится пример, показывающий, как создать и настроить узел Redis, запущенный в качестве виртуальной машины Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-878">The page [Running Redis on a CentOS Linux VM in Azure] on the Microsoft website walks through an example that shows you how to build and configure a Redis node running as an Azure VM.</span></span>
* <span data-ttu-id="03596-879">На странице [Типы данных] на веб-сайте Redis описаны типы данных, которые доступны в Redis и кэше Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="03596-879">The [Data types] page on the Redis website describes the data types that are available with Redis and Azure Redis Cache.</span></span>

[доступности и согласованности в концентраторах событий]: /azure/event-hubs/event-hubs-availability-and-consistency
[azure-limits]: /azure/azure-subscription-service-limit
[сети доставки содержимого Azure]: /azure/cdn/cdn-overview
[Кэш Redis для Azure]: http://azure.microsoft.com/services/cache/
[Azure Storage Scalability and Performance Targets]: /azure/storage/storage-scalability-targets
[Azure Storage Table Design Guide]: /azure/storage/storage-table-design-guide
[Создание решения Polyglot]: https://msdn.microsoft.com/library/dn313279.aspx
[cosmos-db-ru]: /azure/documentdb/documentdb-request-units
[Доступ к данным для масштабируемых решений: с помощью SQL, NoSQL и Polyglot Persistence]: https://msdn.microsoft.com/library/dn271399.aspx
[руководстве по согласованности данных]: http://aka.ms/Data-Consistency-Primer
[Data Partitioning Guidance]: https://msdn.microsoft.com/library/dn589795.aspx
[Data Types]: http://redis.io/topics/data-types
[documentdb-api]: /azure/documentdb/documentdb-introduction
[Развертывание с помощью Базы данных SQL Azure]: /azure/sql-database/sql-database-elastic-scale-introduction
[event-hubs]: /azure/event-hubs
[Federations Migration Utility]: https://code.msdn.microsoft.com/vstudio/Federations-Migration-ce61e9c1
[инструкциях и рекомендациях по работе с надежными коллекциями в Azure Service Fabric]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections-guidelines
[Index Table Pattern]: http://aka.ms/Index-Table-Pattern
[Materialized View Pattern]: http://aka.ms/Materialized-View-Pattern
[Многосегментное формирование запросов]: /azure/sql-database/sql-database-elastic-scale-multishard-querying
[Общие сведения о Service Fabric]: /azure/service-fabric/service-fabric-overview
[Секционирование служб Reliable Services в Service Fabric]: /azure/service-fabric/service-fabric-concepts-partitioning
[Partitioning: how to split data among multiple Redis instances]: http://redis.io/topics/partitioning
[Performing Entity Group Transactions]: https://msdn.microsoft.com/library/azure/dd894038.aspx
[Учебник по кластерам Redis]: http://redis.io/topics/cluster-tutorial
[Запуск Redis на виртуальной машине CentOS Linux в Azure]: http://blogs.msdn.com/b/tconte/archive/2012/06/08/running-redis-on-a-centos-linux-vm-in-windows-azure.aspx
[Перемещение данных между масштабируемыми облачными базами данных]: /azure/sql-database/sql-database-elastic-scale-overview-split-and-merge
[использованию сети доставки содержимого Azure]: /azure/cdn/cdn-create-new-endpoint
[Квоты на служебную шину]: /azure/service-bus-messaging/service-bus-quotas
[service-fabric-reliable-collections]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections
[Ограничения службы поиска Azure]:  /azure/search/search-limits-quotas-capacity
[Sharding pattern]: http://aka.ms/Sharding-Pattern
[Поддерживаемые типы данных (служба поиска Azure)]:  https://msdn.microsoft.com/library/azure/dn798938.aspx
[Transactions]: http://redis.io/topics/transactions
[Что такое концентраторы событий?]: /azure/event-hubs/event-hubs-what-is-event-hubs
[What is Azure Search?]: /azure/search/search-what-is-azure-search
[Что такое база данных SQL? Введение в базы данных SQL]: /azure/sql-database/sql-database-technical-overview
