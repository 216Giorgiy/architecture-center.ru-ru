---
title: Руководство по секционированию данных
titleSuffix: Best practices for cloud applications
description: Руководство по способам разделения секций для реализации отдельного управления и доступа.
author: dragon119
ms.date: 11/04/2018
ms.topic: best-practice
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: 561fe6e47a4cd64aa545349dde4c76260d76e78e
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2019
ms.locfileid: "58248959"
---
# <a name="horizontal-vertical-and-functional-data-partitioning"></a><span data-ttu-id="29a2c-103">Горизонтальное, вертикальное и функциональное секционирование данных</span><span class="sxs-lookup"><span data-stu-id="29a2c-103">Horizontal, vertical, and functional data partitioning</span></span>

<span data-ttu-id="29a2c-104">Во многих крупномасштабных решениях данные разделяются на *секции*, которыми можно управлять и пользоваться независимо.</span><span class="sxs-lookup"><span data-stu-id="29a2c-104">In many large-scale solutions, data is divided into *partitions* that can be managed and accessed separately.</span></span> <span data-ttu-id="29a2c-105">Секционирование помогает улучшить масштабируемость, уменьшить количество конфликтов и оптимизировать производительность.</span><span class="sxs-lookup"><span data-stu-id="29a2c-105">Partitioning can improve scalability, reduce contention, and optimize performance.</span></span> <span data-ttu-id="29a2c-106">Оно также способно обеспечить механизм для разделения данных по шаблону использования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-106">It can also provide a mechanism for dividing data by usage pattern.</span></span> <span data-ttu-id="29a2c-107">Например, можно архивировать старые данные в хранилище более низкой ценовой категории.</span><span class="sxs-lookup"><span data-stu-id="29a2c-107">For example, you can archive older data in cheaper data storage.</span></span>

<span data-ttu-id="29a2c-108">Но следует тщательно выбирать стратегию секционирования, чтобы в полной мере использовать ее преимущества и свести к минимуму отрицательные эффекты.</span><span class="sxs-lookup"><span data-stu-id="29a2c-108">However, the partitioning strategy must be chosen carefully to maximize the benefits while minimizing adverse effects.</span></span>

> [!NOTE]
> <span data-ttu-id="29a2c-109">Термин *секционирование* в этом руководстве обозначает процесс физического разделения данных на отдельные хранилища.</span><span class="sxs-lookup"><span data-stu-id="29a2c-109">In this article, the term *partitioning* means the process of physically dividing data into separate data stores.</span></span> <span data-ttu-id="29a2c-110">Не следует путать его с секционированием таблиц в SQL Server.</span><span class="sxs-lookup"><span data-stu-id="29a2c-110">It is not the same as SQL Server table partitioning.</span></span>

<!-- markdownlint-disable MD026 -->

## <a name="why-partition-data"></a><span data-ttu-id="29a2c-111">Зачем секционировать данные?</span><span class="sxs-lookup"><span data-stu-id="29a2c-111">Why partition data?</span></span>

<!-- markdownlint-enable MD026 -->

- <span data-ttu-id="29a2c-112">**Повышение масштабируемости**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-112">**Improve scalability**.</span></span> <span data-ttu-id="29a2c-113">Вертикальное масштабирование отдельной базы данных рано или поздно столкнется с физическими ограничениями оборудования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-113">When you scale up a single database system, it will eventually reach a physical hardware limit.</span></span> <span data-ttu-id="29a2c-114">При разделении данных на несколько секций, каждая из которых размещается на отдельном сервере, можно практически неограниченно масштабировать систему.</span><span class="sxs-lookup"><span data-stu-id="29a2c-114">If you divide data across multiple partitions, each hosted on a separate server, you can scale out the system almost indefinitely.</span></span>

- <span data-ttu-id="29a2c-115">**Повышение производительности**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-115">**Improve performance**.</span></span> <span data-ttu-id="29a2c-116">В каждой секции осуществляется доступ к данным меньшего объема.</span><span class="sxs-lookup"><span data-stu-id="29a2c-116">Data access operations on each partition take place over a smaller volume of data.</span></span> <span data-ttu-id="29a2c-117">Правильно выполненное секционирование может повысить эффективность системы.</span><span class="sxs-lookup"><span data-stu-id="29a2c-117">Correctly done, partitioning can make your system more efficient.</span></span> <span data-ttu-id="29a2c-118">Операции, которые задействуют несколько секций, могут выполняться параллельно.</span><span class="sxs-lookup"><span data-stu-id="29a2c-118">Operations that affect more than one partition can run in parallel.</span></span>

- <span data-ttu-id="29a2c-119">**Усиление безопасности**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-119">**Improve security**.</span></span> <span data-ttu-id="29a2c-120">В некоторых случаях можно разделить конфиденциальные и не конфиденциальные данные по разным секциям и применить к ним разные элементы управления безопасностью.</span><span class="sxs-lookup"><span data-stu-id="29a2c-120">In some cases, you can separate sensitive and non-sensitive data into different partitions and apply different security controls to the sensitive data.</span></span>

- <span data-ttu-id="29a2c-121">**Обеспечение операционной гибкости**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-121">**Provide operational flexibility**.</span></span> <span data-ttu-id="29a2c-122">Секционирование предлагает множество возможностей для операций тонкой настройки, максимально повышая эффективность администрирования и сводя затраты к минимуму.</span><span class="sxs-lookup"><span data-stu-id="29a2c-122">Partitioning offers many opportunities for fine tuning operations, maximizing administrative efficiency, and minimizing cost.</span></span> <span data-ttu-id="29a2c-123">Некоторые примеры определяют разные стратегии управления, мониторинга, резервного копирования и восстановления, а также других административных задач в зависимости от степени важности данных в каждой секции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-123">For example, you can define different strategies for management, monitoring, backup and restore, and other administrative tasks based on the importance of the data in each partition.</span></span>

- <span data-ttu-id="29a2c-124">**Сопоставление хранилища данных с шаблоном использования.**</span><span class="sxs-lookup"><span data-stu-id="29a2c-124">**Match the data store to the pattern of use**.</span></span> <span data-ttu-id="29a2c-125">Секционирование позволяет развернуть любую секцию в хранилище данных любого типа в зависимости от стоимости и встроенных функций, которые предоставляет хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-125">Partitioning allows each partition to be deployed on a different type of data store, based on cost and the built-in features that data store offers.</span></span> <span data-ttu-id="29a2c-126">Например, большие объемы двоичных данных могут храниться в хранилище BLOB-объектов, а более структурированные данные — в базе данных документов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-126">For example, large binary data can be stored in blob storage, while more structured data can be held in a document database.</span></span> <span data-ttu-id="29a2c-127">См. статью [Выбор правильного хранилища данных](../guide/technology-choices/data-store-overview.md).</span><span class="sxs-lookup"><span data-stu-id="29a2c-127">See [Choose the right data store](../guide/technology-choices/data-store-overview.md).</span></span>

- <span data-ttu-id="29a2c-128">**Повышение доступности**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-128">**Improve availability**.</span></span> <span data-ttu-id="29a2c-129">Распределение данных по нескольким серверам позволяет избежать наличия единственной точки отказа.</span><span class="sxs-lookup"><span data-stu-id="29a2c-129">Separating data across multiple servers avoids a single point of failure.</span></span> <span data-ttu-id="29a2c-130">Если один экземпляр выходит из строя, данные будут недоступны только в этой секции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-130">If one instance fails, only the data in that partition is unavailable.</span></span> <span data-ttu-id="29a2c-131">Операции в других секциях можно продолжать.</span><span class="sxs-lookup"><span data-stu-id="29a2c-131">Operations on other partitions can continue.</span></span> <span data-ttu-id="29a2c-132">Для управляемых хранилищ данных PaaS это не так актуально, так как такие службы спроектированы для обеспечения надежности.</span><span class="sxs-lookup"><span data-stu-id="29a2c-132">For managed PaaS data stores, this consideration is less relevant, because these services are designed with built-in redundancy.</span></span>

## <a name="designing-partitions"></a><span data-ttu-id="29a2c-133">Проектирование секций</span><span class="sxs-lookup"><span data-stu-id="29a2c-133">Designing partitions</span></span>

<span data-ttu-id="29a2c-134">Ниже представлены три распространенных стратегии секционирования данных:</span><span class="sxs-lookup"><span data-stu-id="29a2c-134">There are three typical strategies for partitioning data:</span></span>

- <span data-ttu-id="29a2c-135">**Горизонтальное секционирование** (часто называемое *сегментированием*).</span><span class="sxs-lookup"><span data-stu-id="29a2c-135">**Horizontal partitioning** (often called *sharding*).</span></span> <span data-ttu-id="29a2c-136">В рамках этой стратегии каждая секция представляет собой отдельное хранилище, но все они имеют одну общую схему.</span><span class="sxs-lookup"><span data-stu-id="29a2c-136">In this strategy, each partition is a separate data store, but all partitions have the same schema.</span></span> <span data-ttu-id="29a2c-137">Каждая секция называется *сегментом* и содержит определенный набор данных, например все заказы от определенной группы клиентов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-137">Each partition is known as a *shard* and holds a specific subset of the data, such as all the orders for a specific set of customers.</span></span>

- <span data-ttu-id="29a2c-138">**Вертикальное секционирование**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-138">**Vertical partitioning**.</span></span> <span data-ttu-id="29a2c-139">В этой стратегии каждая секция содержит подмножество полей для элементов в хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-139">In this strategy, each partition holds a subset of the fields for items in the data store.</span></span> <span data-ttu-id="29a2c-140">Поля разделяются по шаблону их использования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-140">The fields are divided according to their pattern of use.</span></span> <span data-ttu-id="29a2c-141">Например, часто используемые поля размещаются в одной вертикальной секции, а более редко используемые поля — в другой.</span><span class="sxs-lookup"><span data-stu-id="29a2c-141">For example, frequently accessed fields might be placed in one vertical partition and less frequently accessed fields in another.</span></span>

- <span data-ttu-id="29a2c-142">**Функциональное секционирование**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-142">**Functional partitioning**.</span></span> <span data-ttu-id="29a2c-143">В этой стратегии данные группируются в соответствии с их использованием в каждом связанном контексте в системе.</span><span class="sxs-lookup"><span data-stu-id="29a2c-143">In this strategy, data is aggregated according to how it is used by each bounded context in the system.</span></span> <span data-ttu-id="29a2c-144">Например, система для нужд электронной коммерции может хранить данные о счетах в одном разделе, а в другом — данные о товарных запасах.</span><span class="sxs-lookup"><span data-stu-id="29a2c-144">For example, an e-commerce system might store invoice data in one partition and product inventory data in another.</span></span>

<span data-ttu-id="29a2c-145">Эти стратегии не являются взаимоисключающими, и при разработке схемы секционирования рекомендуется учитывать все три.</span><span class="sxs-lookup"><span data-stu-id="29a2c-145">These strategies can be combined, and we recommend that you consider them all when you design a partitioning scheme.</span></span> <span data-ttu-id="29a2c-146">Например, можно разделить данные на сегменты и затем использовать вертикальное секционирование для дальнейшего разделения данных в каждом сегменте.</span><span class="sxs-lookup"><span data-stu-id="29a2c-146">For example, you might divide data into shards and then use vertical partitioning to further subdivide the data in each shard.</span></span>

### <a name="horizontal-partitioning-sharding"></a><span data-ttu-id="29a2c-147">Горизонтальное секционирование (сегментирование)</span><span class="sxs-lookup"><span data-stu-id="29a2c-147">Horizontal partitioning (sharding)</span></span>

<span data-ttu-id="29a2c-148">На рисунке 1 показано горизонтальное секционирование или сегментирование.</span><span class="sxs-lookup"><span data-stu-id="29a2c-148">Figure 1 shows horizontal partitioning or sharding.</span></span> <span data-ttu-id="29a2c-149">В этом примере данные инвентаризации продуктов разделены на сегменты на основании ключа продукта.</span><span class="sxs-lookup"><span data-stu-id="29a2c-149">In this example, product inventory data is divided into shards based on the product key.</span></span> <span data-ttu-id="29a2c-150">Каждый сегмент содержит данные для непрерывного диапазона ключей сегментов (A-G и H-Z) в алфавитном порядке.</span><span class="sxs-lookup"><span data-stu-id="29a2c-150">Each shard holds the data for a contiguous range of shard keys (A-G and H-Z), organized alphabetically.</span></span> <span data-ttu-id="29a2c-151">Сегментирование распределяет нагрузку между несколькими компьютерами, уменьшая вероятность возникновения конфликтов и повышая производительность.</span><span class="sxs-lookup"><span data-stu-id="29a2c-151">Sharding spreads the load over more computers, which reduces contention and improves performance.</span></span>

![Горизонтальное секционирование данных (сегментирование) на основании ключа секции](./images/data-partitioning/DataPartitioning01.png)

<span data-ttu-id="29a2c-153">*Рис. 1. Горизонтальное секционирование данных (сегментирование) на основе ключа секции.*</span><span class="sxs-lookup"><span data-stu-id="29a2c-153">*Figure 1. Horizontally partitioning (sharding) data based on a partition key.*</span></span>

<span data-ttu-id="29a2c-154">Самым важным фактором является выбор ключа сегментирования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-154">The most important factor is the choice of a sharding key.</span></span> <span data-ttu-id="29a2c-155">Может быть трудно изменить ключ после начала работы системы.</span><span class="sxs-lookup"><span data-stu-id="29a2c-155">It can be difficult to change the key after the system is in operation.</span></span> <span data-ttu-id="29a2c-156">Ключ должен гарантировать, что данные секционированы таким образом, чтобы рабочая нагрузка была распределена между сегментами максимально равномерно.</span><span class="sxs-lookup"><span data-stu-id="29a2c-156">The key must ensure that data is partitioned to spread the workload as evenly as possible across the shards.</span></span>

<span data-ttu-id="29a2c-157">Сегменты не обязательно должны быть одинакового размера.</span><span class="sxs-lookup"><span data-stu-id="29a2c-157">The shards don't have to be the same size.</span></span> <span data-ttu-id="29a2c-158">Важнее сбалансировать количество запросов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-158">It's more important to balance the number of requests.</span></span> <span data-ttu-id="29a2c-159">Некоторые сегменты могут быть очень большими, но количество операций доступа к каждому элементу должно быть небольшим.</span><span class="sxs-lookup"><span data-stu-id="29a2c-159">Some shards might be very large, but each item has a low number of access operations.</span></span> <span data-ttu-id="29a2c-160">Другие сегменты будут меньше, но данные в них могут использоваться чаще.</span><span class="sxs-lookup"><span data-stu-id="29a2c-160">Other shards might be smaller, but each item is accessed much more frequently.</span></span> <span data-ttu-id="29a2c-161">Также важно убедиться, что сегмент не превышает ограничения масштабирования (в контексте емкости и ресурсов обработки) хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-161">It's also important to ensure that a single shard does not exceed the scale limits (in terms of capacity and processing resources) of the data store.</span></span>

<span data-ttu-id="29a2c-162">Следует избегать возникновения "горячих" секций, которые могут повлиять на производительность и доступность.</span><span class="sxs-lookup"><span data-stu-id="29a2c-162">Avoid creating "hot" partitions that can affect performance and availability.</span></span> <span data-ttu-id="29a2c-163">Например, использование первой буквы в имени клиента приводит к неравномерному распределению, так как некоторые буквы встречаются чаще. Вместо этого используйте хэш идентификатора клиента, чтобы более равномерно распределять данные между секциями.</span><span class="sxs-lookup"><span data-stu-id="29a2c-163">For example, using the first letter of a customer’s name causes an unbalanced distribution, because some letters are more common Instead, use a hash of a customer identifier to distribute data more evenly across partitions.</span></span>

<span data-ttu-id="29a2c-164">Выберите такой ключ сегментирования, который минимизирует потенциальную необходимость дробить большие сегменты, объединять небольшие сегменты в секции большего размера или изменять схему.</span><span class="sxs-lookup"><span data-stu-id="29a2c-164">Choose a sharding key that minimizes any future requirements to split large shards, coalesce small shards into larger partitions, or change the schema.</span></span> <span data-ttu-id="29a2c-165">Эти операции могут занять очень много времени и потребовать отключения одного или нескольких сегментов во время их выполнения.</span><span class="sxs-lookup"><span data-stu-id="29a2c-165">These operations can be very time consuming, and might require taking one or more shards offline while they are performed.</span></span>

<span data-ttu-id="29a2c-166">Если сегменты реплицируются, можно оставить некоторые реплики в рабочем режиме во время разделения, слияния или перенастройки других реплик.</span><span class="sxs-lookup"><span data-stu-id="29a2c-166">If shards are replicated, it might be possible to keep some of the replicas online while others are split, merged, or reconfigured.</span></span> <span data-ttu-id="29a2c-167">Но система может ограничить операции, выполняемые с данными в этих сегментах во время перенастройки.</span><span class="sxs-lookup"><span data-stu-id="29a2c-167">However, the system might need to limit the operations that can be performed during the reconfiguration.</span></span> <span data-ttu-id="29a2c-168">Например, данные в репликах могут быть помечены только для чтения во избежание несоответствия данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-168">For example, the data in the replicas might be marked as read-only to prevent data inconsistences.</span></span>

<span data-ttu-id="29a2c-169">Дополнительные сведения о горизонтальном секционировании см. в статье [Sharding pattern] (Шаблон сегментирования).</span><span class="sxs-lookup"><span data-stu-id="29a2c-169">For more information about horizontal partitioning, see [Sharding pattern].</span></span>

### <a name="vertical-partitioning"></a><span data-ttu-id="29a2c-170">Вертикальное секционирование</span><span class="sxs-lookup"><span data-stu-id="29a2c-170">Vertical partitioning</span></span>

<span data-ttu-id="29a2c-171">Вертикальное секционирование чаще всего применяется для сокращения количества операций ввода-вывода и расходов на производительность, связанных с обращением к часто используемым элементам.</span><span class="sxs-lookup"><span data-stu-id="29a2c-171">The most common use for vertical partitioning is to reduce the I/O and performance costs associated with fetching items that are frequently accessed.</span></span> <span data-ttu-id="29a2c-172">На рисунке 2 показан пример вертикального секционирования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-172">Figure 2 shows an example of vertical partitioning.</span></span> <span data-ttu-id="29a2c-173">В этом примере разные свойства элемента данных хранятся в разных секциях.</span><span class="sxs-lookup"><span data-stu-id="29a2c-173">In this example, different properties of an item are stored in different partitions.</span></span> <span data-ttu-id="29a2c-174">В одной секции хранятся данные, используемые чаще всего, например название товара, его описание и цена.</span><span class="sxs-lookup"><span data-stu-id="29a2c-174">One partition holds data that is accessed more frequently, including product name, description, and price.</span></span> <span data-ttu-id="29a2c-175">В другой секции содержатся данные о товарных запасах — объем запасов и дата последнего заказа.</span><span class="sxs-lookup"><span data-stu-id="29a2c-175">Another partition holds inventory data: the stock count and last-ordered date.</span></span>

![Вертикальное секционирование данных по шаблону использования](./images/data-partitioning/DataPartitioning02.png)

<span data-ttu-id="29a2c-177">*Рис. 2. Вертикальное секционирование данных по шаблону использования.*</span><span class="sxs-lookup"><span data-stu-id="29a2c-177">*Figure 2. Vertically partitioning data by its pattern of use.*</span></span>

<span data-ttu-id="29a2c-178">В этом примере приложение регулярно запрашивает имя, описание и цену продукта при отображении подробных сведений о продукте для клиента.</span><span class="sxs-lookup"><span data-stu-id="29a2c-178">In this example, the application regularly queries the product name, description, and price when displaying the product details to customers.</span></span> <span data-ttu-id="29a2c-179">Данные об объеме запасов и дате последнего заказа хранятся в отдельной секции, так как эти два элемента часто используются вместе.</span><span class="sxs-lookup"><span data-stu-id="29a2c-179">Stock count and last- ordered date are held in a separate partition because these two items are commonly used together.</span></span>

<span data-ttu-id="29a2c-180">Другие преимущества вертикального секционирования:</span><span class="sxs-lookup"><span data-stu-id="29a2c-180">Other advantages of vertical partitioning:</span></span>

- <span data-ttu-id="29a2c-181">Можно разделить относительно редко меняющиеся данные (название товара, его описание и цена) и часто меняющиеся данные (объем товарных запасов и дата последнего заказа).</span><span class="sxs-lookup"><span data-stu-id="29a2c-181">Relatively slow-moving data (product name, description, and price) can be separated from the more dynamic data (stock level and last ordered date).</span></span> <span data-ttu-id="29a2c-182">Редко меняющиеся данные приложение может кэшировать в памяти.</span><span class="sxs-lookup"><span data-stu-id="29a2c-182">Slow moving data is a good candidate for an application to cache in memory.</span></span>

- <span data-ttu-id="29a2c-183">Конфиденциальные данные могут храниться в отдельной секции с применением дополнительных средств защиты.</span><span class="sxs-lookup"><span data-stu-id="29a2c-183">Sensitive data can be stored in a separate partition with additional security controls.</span></span>

- <span data-ttu-id="29a2c-184">Вертикальное секционирование способно сократить количество необходимых операций одновременного доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="29a2c-184">Vertical partitioning can reduce the amount of concurrent access that's needed.</span></span>

<span data-ttu-id="29a2c-185">Вертикальное секционирование выполняется на уровне сущности в хранилище данных, частично нормализуя сущность и преобразуя ее из *широкого* элемента в набор *узких* элементов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-185">Vertical partitioning operates at the entity level within a data store, partially normalizing an entity to break it down from a *wide* item to a set of *narrow* items.</span></span> <span data-ttu-id="29a2c-186">Это идеально подходит для хранилищ данных со столбцами, таких как HBase и Cassandra.</span><span class="sxs-lookup"><span data-stu-id="29a2c-186">It is ideally suited for column-oriented data stores such as HBase and Cassandra.</span></span> <span data-ttu-id="29a2c-187">Если данные в коллекции столбцов меняются редко, также можно использовать хранилища со столбцами в SQL Server.</span><span class="sxs-lookup"><span data-stu-id="29a2c-187">If the data in a collection of columns is unlikely to change, you can also consider using column stores in SQL Server.</span></span>

### <a name="functional-partitioning"></a><span data-ttu-id="29a2c-188">Функциональное секционирование</span><span class="sxs-lookup"><span data-stu-id="29a2c-188">Functional partitioning</span></span>

<span data-ttu-id="29a2c-189">Когда можно идентифицировать связанный контекст для каждой бизнес-области приложения, функциональное секционирование позволяет повысить уровень изоляции и ускорить доступ к данным.</span><span class="sxs-lookup"><span data-stu-id="29a2c-189">When it's possible to identify a bounded context for each distinct business area in an application, functional partitioning is a way to improve isolation and data access performance.</span></span> <span data-ttu-id="29a2c-190">Кроме того, функциональное секционирование обычно используется для разделения данных, предназначенных для чтения и записи и только для чтения.</span><span class="sxs-lookup"><span data-stu-id="29a2c-190">Another common use for functional partitioning is to separate read-write data from read-only data.</span></span> <span data-ttu-id="29a2c-191">На рисунке 3 представлен обзор функционального секционирования, где инвентаризации отделены от данных клиентов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-191">Figure 3 shows an overview of functional partitioning where inventory data is separated from customer data.</span></span>

![Функциональное секционирование данных по связанному контексту или дочернему домену](./images/data-partitioning/DataPartitioning03.png)

<span data-ttu-id="29a2c-193">*Рис. 3. Функциональное секционирование данных по связанному контексту или дочернему домену.*</span><span class="sxs-lookup"><span data-stu-id="29a2c-193">*Figure 3. Functionally partitioning data by bounded context or subdomain.*</span></span>

<span data-ttu-id="29a2c-194">Эта стратегия секционирования может помочь уменьшить количество конфликтов доступа к данным в различных частях системы.</span><span class="sxs-lookup"><span data-stu-id="29a2c-194">This partitioning strategy can help reduce data access contention across different parts of a system.</span></span>

## <a name="designing-partitions-for-scalability"></a><span data-ttu-id="29a2c-195">Проектирование секций для масштабируемости</span><span class="sxs-lookup"><span data-stu-id="29a2c-195">Designing partitions for scalability</span></span>

<span data-ttu-id="29a2c-196">Важно учитывать размер и рабочую нагрузку каждой секции и равномерно распределять данные для достижения максимальной масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="29a2c-196">It's vital to consider size and workload for each partition and balance them so that data is distributed to achieve maximum scalability.</span></span> <span data-ttu-id="29a2c-197">Тем не менее необходимо все же секционировать данные так, чтобы не превысить ограничения масштабирования одной секции хранилища.</span><span class="sxs-lookup"><span data-stu-id="29a2c-197">However, you must also partition the data so that it does not exceed the scaling limits of a single partition store.</span></span>

<span data-ttu-id="29a2c-198">При создании секций для масштабируемости выполните приведенные далее действия.</span><span class="sxs-lookup"><span data-stu-id="29a2c-198">Follow these steps when designing partitions for scalability:</span></span>

1. <span data-ttu-id="29a2c-199">Проанализируйте приложение, чтобы понять шаблоны доступа к данным, такие как размер результирующего набора, возвращаемого каждым запросом, частота доступа, встречающиеся задержки и требования к вычислительной обработке на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="29a2c-199">Analyze the application to understand the data access patterns, such as the size of the result set returned by each query, the frequency of access, the inherent latency, and the server-side compute processing requirements.</span></span> <span data-ttu-id="29a2c-200">Во многих случаях несколько основных сущностей потребуют большую часть вычислительных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-200">In many cases, a few major entities will demand most of the processing resources.</span></span>
2. <span data-ttu-id="29a2c-201">На основе анализа определите текущие и будущие целевые показатели масштабируемости, такие как размер данных и рабочая нагрузка.</span><span class="sxs-lookup"><span data-stu-id="29a2c-201">Use this analysis to determine the current and future scalability targets, such as data size and workload.</span></span> <span data-ttu-id="29a2c-202">Затем распределите данные по секциям в соответствии с целевыми показателями масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="29a2c-202">Then distribute the data across the partitions to meet the scalability target.</span></span> <span data-ttu-id="29a2c-203">При горизонтальном секционирования важно правильно выбрать ключ сегмента, чтобы обеспечить равномерное распределение.</span><span class="sxs-lookup"><span data-stu-id="29a2c-203">For horizontal partitioning, choosing the right shard key is important to make sure distribution is even.</span></span> <span data-ttu-id="29a2c-204">Дополнительные сведения см. в статье [Sharding pattern] (Шаблон сегментирования).</span><span class="sxs-lookup"><span data-stu-id="29a2c-204">For more information, see the [Sharding pattern].</span></span>
3. <span data-ttu-id="29a2c-205">Убедитесь в том, что каждой секции предоставлено достаточно ресурсов для выполнения требований масштабируемости в контексте объема данных и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="29a2c-205">Make sure each partition has enough resources to handle the scalability requirements, in terms of data size and throughput.</span></span> <span data-ttu-id="29a2c-206">В зависимости от хранилища данных могут существовать ограничения на объем хранения, вычислительную мощность или пропускную способность секции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-206">Depending on the data store, there might be a limit on the amount of storage space, processing power, or network bandwidth per partition.</span></span> <span data-ttu-id="29a2c-207">Если требования превышают эти ограничения, можно пересмотреть стратегию или далее разделить данные, возможно, используя несколько стратегий.</span><span class="sxs-lookup"><span data-stu-id="29a2c-207">If the requirements are likely to exceed these limits, you may need to refine your partitioning strategy or split data out further, possibly combining two or more strategies.</span></span>
4. <span data-ttu-id="29a2c-208">Понаблюдайте за системой, чтобы убедиться, что данные распределяются ожидаемым образом и секции справляются со своей нагрузкой.</span><span class="sxs-lookup"><span data-stu-id="29a2c-208">Monitor the system to verify that data is distributed as expected and that the partitions can handle the load.</span></span> <span data-ttu-id="29a2c-209">Реальное использование не всегда соответствует аналитическим прогнозам.</span><span class="sxs-lookup"><span data-stu-id="29a2c-209">Actual usage does not always match what an analysis predicts.</span></span> <span data-ttu-id="29a2c-210">В таком случае можно повторно сбалансировать секции или изменить некоторые компоненты системы, чтобы добиться необходимого баланса.</span><span class="sxs-lookup"><span data-stu-id="29a2c-210">If so, it might be possible to rebalance the partitions, or else redesign some parts of the system to gain the required balance.</span></span>

<span data-ttu-id="29a2c-211">Некоторые облачные среды распределяют ресурсы в границах своей инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="29a2c-211">Some cloud environments allocate resources in terms of infrastructure boundaries.</span></span> <span data-ttu-id="29a2c-212">Следует убедиться, что ограничения выбранной границы предоставляют достаточно места для любого ожидаемого роста объема данных с точки зрения хранилища данных, вычислительной мощности и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="29a2c-212">Ensure that the limits of your selected boundary provide enough room for any anticipated growth in the volume of data, in terms of data storage, processing power, and bandwidth.</span></span>

<span data-ttu-id="29a2c-213">Например, в Хранилище таблиц Azure существует ограничение на объем запросов, которые могут обрабатываться одной секцией в определенный период времени.</span><span class="sxs-lookup"><span data-stu-id="29a2c-213">For example, if you use Azure table storage, there is a limit to the volume of requests that can be handled by a single partition in a particular period of time.</span></span> <span data-ttu-id="29a2c-214">(См. статью [Целевые показатели масштабируемости и производительности хранилища Azure].) Занятый сегмент может использовать больше ресурсов, чем способна обработать одна секция.</span><span class="sxs-lookup"><span data-stu-id="29a2c-214">(See [Azure storage scalability and performance targets].) A busy shard might require more resources than a single partition can handle.</span></span> <span data-ttu-id="29a2c-215">В этом случае можно повторно секционировать сегмент, чтобы распределить нагрузку.</span><span class="sxs-lookup"><span data-stu-id="29a2c-215">If so, the shard might need to be repartitioned to spread the load.</span></span> <span data-ttu-id="29a2c-216">Если общий объем или пропускная способность этих таблиц превышают емкость учетной записи хранения, может потребоваться создать дополнительные учетные записи хранения и распределить таблицы между ними.</span><span class="sxs-lookup"><span data-stu-id="29a2c-216">If the total size or throughput of these tables exceeds the capacity of a storage account, you might need to create additional storage accounts and spread the tables across these accounts.</span></span>

## <a name="designing-partitions-for-query-performance"></a><span data-ttu-id="29a2c-217">Проектирование секций для повышения производительности запросов</span><span class="sxs-lookup"><span data-stu-id="29a2c-217">Designing partitions for query performance</span></span>

<span data-ttu-id="29a2c-218">Производительность запросов часто можно увеличить путем использования небольших наборов данных и параллельного выполнения запросов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-218">Query performance can often be boosted by using smaller data sets and by running parallel queries.</span></span> <span data-ttu-id="29a2c-219">Каждая секция должна содержать небольшую часть всего набора данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-219">Each partition should contain a small proportion of the entire data set.</span></span> <span data-ttu-id="29a2c-220">Такое уменьшение объема может повысить производительность запросов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-220">This reduction in volume can improve the performance of queries.</span></span> <span data-ttu-id="29a2c-221">Тем не менее секционирование не является альтернативой правильной разработке и настройке базы данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-221">However, partitioning is not an alternative for designing and configuring a database appropriately.</span></span> <span data-ttu-id="29a2c-222">Например, необходимо убедиться в том, что присутствуют все необходимые индексы.</span><span class="sxs-lookup"><span data-stu-id="29a2c-222">For example, make sure that you have the necessary indexes in place.</span></span>

<span data-ttu-id="29a2c-223">При создании секций для производительности запросов выполните приведенные далее действия.</span><span class="sxs-lookup"><span data-stu-id="29a2c-223">Follow these steps when designing partitions for query performance:</span></span>

1. <span data-ttu-id="29a2c-224">Изучите требования и производительность приложения.</span><span class="sxs-lookup"><span data-stu-id="29a2c-224">Examine the application requirements and performance:</span></span>

   - <span data-ttu-id="29a2c-225">Используйте бизнес-требования, чтобы определить важные запросы, которые всегда должны выполняться быстро.</span><span class="sxs-lookup"><span data-stu-id="29a2c-225">Use business requirements to determine the critical queries that must always perform quickly.</span></span>
   - <span data-ttu-id="29a2c-226">Отслеживайте состояния системы, чтобы выявить любые медленно выполняемые запросы.</span><span class="sxs-lookup"><span data-stu-id="29a2c-226">Monitor the system to identify any queries that perform slowly.</span></span>
   - <span data-ttu-id="29a2c-227">Выясните, какие запросы выполняются чаще всего.</span><span class="sxs-lookup"><span data-stu-id="29a2c-227">Find which queries are performed most frequently.</span></span> <span data-ttu-id="29a2c-228">Расходы на один запрос могут быть минимальными, тогда как общее потребление ресурсов может оказаться значительным.</span><span class="sxs-lookup"><span data-stu-id="29a2c-228">Even if a single query has a minimal cost, the cumulative resource consumption could be significant.</span></span>

2. <span data-ttu-id="29a2c-229">Разделите данные, которые вызывают снижение производительности.</span><span class="sxs-lookup"><span data-stu-id="29a2c-229">Partition the data that is causing slow performance:</span></span>
   - <span data-ttu-id="29a2c-230">Ограничьте размер каждой секции, чтобы время отклика запроса оставалось в пределах целевого значения.</span><span class="sxs-lookup"><span data-stu-id="29a2c-230">Limit the size of each partition so that the query response time is within target.</span></span>
   - <span data-ttu-id="29a2c-231">При горизонтальном секционировании создайте ключ сегментирования так, чтобы приложение могло легко находить требуемую секцию.</span><span class="sxs-lookup"><span data-stu-id="29a2c-231">If you use horizontal partitioning, design the shard key so that the application can easily select the right partition.</span></span> <span data-ttu-id="29a2c-232">Так запросу не потребуется проверять каждую секцию.</span><span class="sxs-lookup"><span data-stu-id="29a2c-232">This prevents the query from having to scan through every partition.</span></span>
   - <span data-ttu-id="29a2c-233">Учитывайте влияние расположения секции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-233">Consider the location of a partition.</span></span> <span data-ttu-id="29a2c-234">Если это возможно, старайтесь хранить данные в секциях, географически близких к использующим их приложениям и пользователям.</span><span class="sxs-lookup"><span data-stu-id="29a2c-234">If possible, try to keep data in partitions that are geographically close to the applications and users that access it.</span></span>

3. <span data-ttu-id="29a2c-235">Если у сущности есть требования к пропускной способности и запросам, используйте функциональное секционирование на основе этой сущности.</span><span class="sxs-lookup"><span data-stu-id="29a2c-235">If an entity has throughput and query performance requirements, use functional partitioning based on that entity.</span></span> <span data-ttu-id="29a2c-236">Если по-прежнему не удается удовлетворить требования, примените также горизонтальное секционирование.</span><span class="sxs-lookup"><span data-stu-id="29a2c-236">If this still doesn't satisfy the requirements, apply horizontal partitioning as well.</span></span> <span data-ttu-id="29a2c-237">В большинстве случаев будет достаточно одной стратегии секционирования, но в некоторых случаях более эффективно будет объединить обе стратегии.</span><span class="sxs-lookup"><span data-stu-id="29a2c-237">In most cases a single partitioning strategy will suffice, but in some cases it is more efficient to combine both strategies.</span></span>

4. <span data-ttu-id="29a2c-238">Для повышения производительности рекомендуется выполнять параллельные запросы к секциям.</span><span class="sxs-lookup"><span data-stu-id="29a2c-238">Consider running queries in parallel across partitions to improve performance.</span></span>

## <a name="designing-partitions-for-availability"></a><span data-ttu-id="29a2c-239">Проектирование секций для увеличения доступности</span><span class="sxs-lookup"><span data-stu-id="29a2c-239">Designing partitions for availability</span></span>

<span data-ttu-id="29a2c-240">Секционирование данных может повысить доступность приложений за счет того, что весь набор данных не составляет единственную точку отказа и что отдельными подмножествами набора данных можно управлять независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="29a2c-240">Partitioning data can improve the availability of applications by ensuring that the entire dataset does not constitute a single point of failure and that individual subsets of the dataset can be managed independently.</span></span>

<span data-ttu-id="29a2c-241">Учитывайте следующие факторы, влияющие на доступность:</span><span class="sxs-lookup"><span data-stu-id="29a2c-241">Consider the following factors that affect availability:</span></span>

<span data-ttu-id="29a2c-242">**Степень важности данных для бизнес-операций.**</span><span class="sxs-lookup"><span data-stu-id="29a2c-242">**How critical the data is to business operations**.</span></span> <span data-ttu-id="29a2c-243">Определите, какие данные являются важной бизнес-информацией (транзакции) а какие — второстепенными (файлы журнала).</span><span class="sxs-lookup"><span data-stu-id="29a2c-243">Identify which data is critical business information, such as transactions, and which data is less critical operational data, such as log files.</span></span>

- <span data-ttu-id="29a2c-244">Критически важные данные можно хранить в высокодоступных секциях с соответствующим планом резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-244">Consider storing critical data in highly-available partitions with an appropriate backup plan.</span></span>

- <span data-ttu-id="29a2c-245">Внедрите отдельные процедуры управления и мониторинга для различных наборов данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-245">Establish separate management and monitoring procedures for the different datasets.</span></span>

- <span data-ttu-id="29a2c-246">Можно разместить данные с одинаковым уровнем важности в одной секции, чтобы их можно было архивировать с соответствующей частотой.</span><span class="sxs-lookup"><span data-stu-id="29a2c-246">Place data that has the same level of criticality in the same partition so that it can be backed up together at an appropriate frequency.</span></span> <span data-ttu-id="29a2c-247">Например, резервное копирование может требоваться чаще для секций, содержащих данные о транзакциях, чем для секций, содержащих данные журналов или трассировки.</span><span class="sxs-lookup"><span data-stu-id="29a2c-247">For example, partitions that hold transaction data might need to be backed up more frequently than partitions that hold logging or trace information.</span></span>

<span data-ttu-id="29a2c-248">**Как можно управлять отдельными секциями**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-248">**How individual partitions can be managed**.</span></span> <span data-ttu-id="29a2c-249">Проектирование секций с поддержкой независимых управления и обслуживания обеспечивает ряд преимуществ.</span><span class="sxs-lookup"><span data-stu-id="29a2c-249">Designing partitions to support independent management and maintenance provides several advantages.</span></span> <span data-ttu-id="29a2c-250">Например: </span><span class="sxs-lookup"><span data-stu-id="29a2c-250">For example:</span></span>

- <span data-ttu-id="29a2c-251">Если в секции происходит сбой, ее можно восстановить независимо, не затрагивая приложения, которые обращаются к данным в других секциях.</span><span class="sxs-lookup"><span data-stu-id="29a2c-251">If a partition fails, it can be recovered independently without applications that access data in other partitions.</span></span>

- <span data-ttu-id="29a2c-252">Секционирование данных по географическому региону позволит запускать запланированные задачи по обслуживанию в непиковые часы для каждого расположения.</span><span class="sxs-lookup"><span data-stu-id="29a2c-252">Partitioning data by geographical area allows scheduled maintenance tasks to occur at off-peak hours for each location.</span></span> <span data-ttu-id="29a2c-253">Убедитесь, что секции не слишком велики и их размер не помешает завершить запланированное обслуживание в течение этого периода.</span><span class="sxs-lookup"><span data-stu-id="29a2c-253">Ensure that partitions are not too big to prevent any planned maintenance from being completed during this period.</span></span>

<span data-ttu-id="29a2c-254">**Подумайте, следует ли реплицировать критически важные данные по секциям**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-254">**Whether to replicate critical data across partitions**.</span></span> <span data-ttu-id="29a2c-255">Эта стратегия может повысить доступность и производительность, хотя она также может вызвать проблемы с согласованностью.</span><span class="sxs-lookup"><span data-stu-id="29a2c-255">This strategy can improve availability and performance, but can also introduce consistency issues.</span></span> <span data-ttu-id="29a2c-256">Необходимо некоторое время для синхронизации изменений с каждой репликой.</span><span class="sxs-lookup"><span data-stu-id="29a2c-256">It takes time to synchronize changes with every replica.</span></span> <span data-ttu-id="29a2c-257">В течение этого времени различные секции будут содержать разные значения данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-257">During this period, different partitions will contain different data values.</span></span>

## <a name="application-design-considerations"></a><span data-ttu-id="29a2c-258">Рекомендации по проектированию приложений</span><span class="sxs-lookup"><span data-stu-id="29a2c-258">Application design considerations</span></span>

<span data-ttu-id="29a2c-259">Использование секционирования усложняет проектирование и разработку системы.</span><span class="sxs-lookup"><span data-stu-id="29a2c-259">Partitioning adds complexity to the design and development of your system.</span></span> <span data-ttu-id="29a2c-260">Секционирование следует рассматривать как основную часть разработки системы, даже если система изначально содержит только одну секцию.</span><span class="sxs-lookup"><span data-stu-id="29a2c-260">Consider partitioning as a fundamental part of system design even if the system initially only contains a single partition.</span></span> <span data-ttu-id="29a2c-261">Если задача секционирования будет отсрочена, ее сложность возрастет, так как вам нужно поддерживать работоспособность уже запущенной системы:</span><span class="sxs-lookup"><span data-stu-id="29a2c-261">If you address partitioning as an afterthought, it will be more challenging because you already have a live system to maintain:</span></span>

- <span data-ttu-id="29a2c-262">Необходимо изменить логику доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="29a2c-262">Data access logic will need to be modified.</span></span>
- <span data-ttu-id="29a2c-263">Может потребоваться перенести большой объем существующих данных, чтобы распределить их между секциями.</span><span class="sxs-lookup"><span data-stu-id="29a2c-263">Large quantities of existing data may need to be migrated, to distribute it across partitions</span></span>
- <span data-ttu-id="29a2c-264">Пользователи ожидают, что система сохранит работоспособность во время такого переноса.</span><span class="sxs-lookup"><span data-stu-id="29a2c-264">Users expect to be able to continue using the system during the migration.</span></span>

<span data-ttu-id="29a2c-265">В некоторых случаях секционирование не считается важным, так как исходный набор данных небольшой и легко обрабатывается на одном сервере.</span><span class="sxs-lookup"><span data-stu-id="29a2c-265">In some cases, partitioning is not considered important because the initial dataset is small and can be easily handled by a single server.</span></span> <span data-ttu-id="29a2c-266">Это может быть справедливо для некоторых рабочих нагрузок, но многим коммерческим системам требуется масштабирование по мере роста количества пользователей.</span><span class="sxs-lookup"><span data-stu-id="29a2c-266">This might be true for some workloads, but many commercial systems need to expand as the number of users increases.</span></span>

<span data-ttu-id="29a2c-267">Кроме того, секционирование требуется не только для больших хранилищ данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-267">Moreover, it's not only large data stores that benefit from partitioning.</span></span> <span data-ttu-id="29a2c-268">Например, небольшое хранилище данных могут использовать сотни параллельных клиентов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-268">For example, a small data store might be heavily accessed by hundreds of concurrent clients.</span></span> <span data-ttu-id="29a2c-269">Секционирование данных в этой ситуации может помочь уменьшить количество конфликтов и повысить пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="29a2c-269">Partitioning the data in this situation can help to reduce contention and improve throughput.</span></span>

<span data-ttu-id="29a2c-270">При разработке схемы секционирования данных учитывайте следующие моменты.</span><span class="sxs-lookup"><span data-stu-id="29a2c-270">Consider the following points when you design a data partitioning scheme:</span></span>

<span data-ttu-id="29a2c-271">**Сокращение количества операций доступа к данным из разных секций**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-271">**Minimize cross-partition data access operations**.</span></span> <span data-ttu-id="29a2c-272">По возможности храните вместе данные для наиболее распространенных операций базы данных в каждой секции, чтобы минимизировать выполнение операций доступа к данным из разных секций.</span><span class="sxs-lookup"><span data-stu-id="29a2c-272">Where possible, keep data for the most common database operations together in each partition to minimize cross-partition data access operations.</span></span> <span data-ttu-id="29a2c-273">Запросы к разным секциям могут выполняться дольше, чем запросы в пределах одной секции, но оптимизация секций для одного набора запросов может неблагоприятно повлиять на другие такие наборы.</span><span class="sxs-lookup"><span data-stu-id="29a2c-273">Querying across partitions can be more time-consuming than querying within a single partition, but optimizing partitions for one set of queries might adversely affect other sets of queries.</span></span> <span data-ttu-id="29a2c-274">Если нельзя устранить необходимость в запросах к разным секциям, реализуйте параллельные запросы к секциям и агрегирование результатов в приложении, чтобы сократить время запроса.</span><span class="sxs-lookup"><span data-stu-id="29a2c-274">If you must query across partitions, minimize query time by running parallel queries and aggregating the results within the application.</span></span> <span data-ttu-id="29a2c-275">(В некоторых случаях такой подход нельзя реализовать, например, когда результат одного запроса используется в следующем запросе.)</span><span class="sxs-lookup"><span data-stu-id="29a2c-275">(This approach might not be possible in some cases, such as when the result from one query is used in the next query.)</span></span>

<span data-ttu-id="29a2c-276">**Рассмотрите возможность репликации статических ссылочных данных**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-276">**Consider replicating static reference data.**</span></span> <span data-ttu-id="29a2c-277">Если запросы используют относительно статичные справочные данные, например таблицы почтовых индексов или списки товаров, рассмотрите возможность репликации этих данных во всех секциях, чтобы сократить количество отдельных операций поиска в другие секции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-277">If queries use relatively static reference data, such as postal code tables or product lists, consider replicating this data in all of the partitions to reduce separate lookup operations in different partitions.</span></span> <span data-ttu-id="29a2c-278">Такой подход также может снизить вероятность того, что справочные данные станут "горячим" набором данных с большим объемом трафика из разных частей системы.</span><span class="sxs-lookup"><span data-stu-id="29a2c-278">This approach can also reduce the likelihood of the reference data becoming a "hot" dataset, with heavy traffic from across the entire system.</span></span> <span data-ttu-id="29a2c-279">Но синхронизация любых изменений в справочных данных связана с дополнительными расходами.</span><span class="sxs-lookup"><span data-stu-id="29a2c-279">However, there is an additional cost associated with synchronizing any changes to the reference data.</span></span>

<span data-ttu-id="29a2c-280">**Сокращение количества соединений между секциями**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-280">**Minimize cross-partition joins.**</span></span> <span data-ttu-id="29a2c-281">По возможности сведите к минимуму требования к целостности данных для вертикальных и функциональных секций.</span><span class="sxs-lookup"><span data-stu-id="29a2c-281">Where possible, minimize requirements for referential integrity across vertical and functional partitions.</span></span> <span data-ttu-id="29a2c-282">В этих схемах само приложение отвечает за обеспечение целостности данных в секциях.</span><span class="sxs-lookup"><span data-stu-id="29a2c-282">In these schemes, the application is responsible for maintaining referential integrity across partitions.</span></span> <span data-ttu-id="29a2c-283">Запросы, которые объединяют данные из нескольких секций, неэффективны, так как приложению обычно требуется выполнить последовательные запросы на основе ключа, а затем на основе внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="29a2c-283">Queries that join data across multiple partitions are inefficient because the application typically needs to perform consecutive queries based on a key and then a foreign key.</span></span> <span data-ttu-id="29a2c-284">Вместо этого рассмотрите возможность репликации или денормализации соответствующих данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-284">Instead, consider replicating or de-normalizing the relevant data.</span></span> <span data-ttu-id="29a2c-285">Если соединения между секциями являются необходимыми, реализуйте параллельные запросы из разных секций и объединение данных внутри приложения.</span><span class="sxs-lookup"><span data-stu-id="29a2c-285">If cross-partition joins are necessary, run parallel queries over the partitions and join the data within the application.</span></span>

<span data-ttu-id="29a2c-286">**Учитывайте итоговую согласованность**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-286">**Embrace eventual consistency**.</span></span> <span data-ttu-id="29a2c-287">Следует оценить, является ли строгое согласование обязательным.</span><span class="sxs-lookup"><span data-stu-id="29a2c-287">Evaluate whether strong consistency is actually a requirement.</span></span> <span data-ttu-id="29a2c-288">Стандартным подходом для распределенных систем является реализация итоговой согласованности.</span><span class="sxs-lookup"><span data-stu-id="29a2c-288">A common approach in distributed systems is to implement eventual consistency.</span></span> <span data-ttu-id="29a2c-289">Данные в каждой секции обновляются отдельно, а логика приложения может нести ответственность за обеспечение успешного завершения обновлений.</span><span class="sxs-lookup"><span data-stu-id="29a2c-289">The data in each partition is updated separately, and the application logic ensures that the updates are all completed successfully.</span></span> <span data-ttu-id="29a2c-290">Она также обрабатывает несоответствия, которые могут возникнуть после запроса данных во время выполнения операции согласования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-290">It also handles the inconsistencies that can arise from querying data while an eventually consistent operation is running.</span></span>

<span data-ttu-id="29a2c-291">**Подумайте, как запросы будут находить правильную секцию**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-291">**Consider how queries locate the correct partition**.</span></span> <span data-ttu-id="29a2c-292">Если запрос должен сканировать все секции, чтобы найти требуемые данные, это сильно повлияет на производительность даже при выполнении нескольких параллельных запросов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-292">If a query must scan all partitions to locate the required data, there is a significant impact on performance, even when multiple parallel queries are running.</span></span> <span data-ttu-id="29a2c-293">При вертикальном и функциональном секционировании запросы могут естественным образом определять секцию.</span><span class="sxs-lookup"><span data-stu-id="29a2c-293">With vertical and functional partitioning, queries can naturally specify the partition.</span></span> <span data-ttu-id="29a2c-294">С другой стороны, при горизонтальном секционировании поиск элемента может быть затруднен, так как для каждого сегмента используется одна схема.</span><span class="sxs-lookup"><span data-stu-id="29a2c-294">Horizontal partitioning, on the other hand, can make locating an item difficult, because every shard has the same schema.</span></span> <span data-ttu-id="29a2c-295">Стандартное решение — использование карты для поиска расположения сегмента для определенных элементов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-295">A typical solution to maintain a map that is used to look up the shard location for specific items.</span></span> <span data-ttu-id="29a2c-296">Эту карту можно реализовать в логике сегментирования приложения или поддерживать в хранилище данных, если оно поддерживает прозрачное сегментирование.</span><span class="sxs-lookup"><span data-stu-id="29a2c-296">This map can be implemented in the sharding logic of the application, or maintained by the data store if it supports transparent sharding.</span></span>

<span data-ttu-id="29a2c-297">**Рассмотрите возможность периодической балансировки сегментов**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-297">**Consider periodically rebalancing shards**.</span></span> <span data-ttu-id="29a2c-298">При горизонтальном секционировании повторная балансировка сегментов позволит равномерно распределять данные по объему и рабочей нагрузке и свести к минимуму дисбаланс, повысить производительность выполнения запросов и обойти ограничения физического хранилища.</span><span class="sxs-lookup"><span data-stu-id="29a2c-298">With horizontal partitioning, rebalancing shards can help distribute the data evenly by size and by workload to minimize hotspots, maximize query performance, and work around physical storage limitations.</span></span> <span data-ttu-id="29a2c-299">Однако это сложная задача, которая часто требует использования пользовательских средств или процессов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-299">However, this is a complex task that often requires the use of a custom tool or process.</span></span>

<span data-ttu-id="29a2c-300">**Реплицируйте разделы**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-300">**Replicate partitions.**</span></span> <span data-ttu-id="29a2c-301">Репликация каждой секции обеспечивает дополнительную защиту от сбоев.</span><span class="sxs-lookup"><span data-stu-id="29a2c-301">If you replicate each partition, it provides additional protection against failure.</span></span> <span data-ttu-id="29a2c-302">В случае сбоя одной реплики запросы могут направляться на рабочую копию.</span><span class="sxs-lookup"><span data-stu-id="29a2c-302">If a single replica fails, queries can be directed towards a working copy.</span></span>

<span data-ttu-id="29a2c-303">**При достижении физических ограничений стратегии секционирования может потребоваться расширить масштабируемость до другого уровня**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-303">**If you reach the physical limits of a partitioning strategy, you might need to extend the scalability to a different level**.</span></span> <span data-ttu-id="29a2c-304">Например, если секционирование находится на уровне базы данных, может потребоваться разместить или реплицировать секции в нескольких базах данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-304">For example, if partitioning is at the database level, you might need to locate or replicate partitions in multiple databases.</span></span> <span data-ttu-id="29a2c-305">Если секционирование уже находится на уровне базы данных и физические ограничения стали проблемой, это может означать необходимость размещения или репликации секций в нескольких учетных записях.</span><span class="sxs-lookup"><span data-stu-id="29a2c-305">If partitioning is already at the database level, and physical limitations are an issue, it might mean that you need to locate or replicate partitions in multiple hosting accounts.</span></span>

<span data-ttu-id="29a2c-306">**Избегайте транзакций, осуществляющих доступ к данным в нескольких секциях**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-306">**Avoid transactions that access data in multiple partitions**.</span></span> <span data-ttu-id="29a2c-307">Некоторые хранилища данных реализуют согласованность и целостность транзакций для операций, которые изменяют данные, но только в том случае, когда они находятся в одной секции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-307">Some data stores implement transactional consistency and integrity for operations that modify data, but only when the data is located in a single partition.</span></span> <span data-ttu-id="29a2c-308">Если требуется поддержка транзакций с использованием нескольких секций, возможно, потребуется реализовать это как часть логики приложения, поскольку большая часть систем секционирования не обеспечивает встроенную поддержку.</span><span class="sxs-lookup"><span data-stu-id="29a2c-308">If you need transactional support across multiple partitions, you will probably need to implement this as part of your application logic because most partitioning systems do not provide native support.</span></span>

<span data-ttu-id="29a2c-309">Все хранилища данных требуют некоторого оперативного управления и наблюдения за активностью.</span><span class="sxs-lookup"><span data-stu-id="29a2c-309">All data stores require some operational management and monitoring activity.</span></span> <span data-ttu-id="29a2c-310">Задачи могут варьироваться от загрузки данных, резервного копирования и восстановления данных до реорганизации данных и обеспечения правильной и эффективной работы системы.</span><span class="sxs-lookup"><span data-stu-id="29a2c-310">The tasks can range from loading data, backing up and restoring data, reorganizing data, and ensuring that the system is performing correctly and efficiently.</span></span>

<span data-ttu-id="29a2c-311">Учитывайте следующие факторы, влияющие на оперативное управление.</span><span class="sxs-lookup"><span data-stu-id="29a2c-311">Consider the following factors that affect operational management:</span></span>

- <span data-ttu-id="29a2c-312">**Как при секционировании данных реализовать соответствующее управление и рабочие задачи**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-312">**How to implement appropriate management and operational tasks when the data is partitioned**.</span></span> <span data-ttu-id="29a2c-313">В число этих задач могут входить архивация и восстановление, архивация данных, мониторинг системы и других задач администрирования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-313">These tasks might include backup and restore, archiving data, monitoring the system, and other administrative tasks.</span></span> <span data-ttu-id="29a2c-314">Например, сохранение логического соответствия во время операций резервного копирования и восстановления может оказаться непростой задачей.</span><span class="sxs-lookup"><span data-stu-id="29a2c-314">For example, maintaining logical consistency during backup and restore operations can be a challenge.</span></span>

- <span data-ttu-id="29a2c-315">**Как можно загружать данные в несколько секций и как добавлять новые данные, поступающие из других источников**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-315">**How to load the data into multiple partitions and add new data that's arriving from other sources**.</span></span> <span data-ttu-id="29a2c-316">Некоторые средства и служебные программы могут не поддерживать операции с сегментированными данными, например загрузку в нужную секцию.</span><span class="sxs-lookup"><span data-stu-id="29a2c-316">Some tools and utilities might not support sharded data operations such as loading data into the correct partition.</span></span>

- <span data-ttu-id="29a2c-317">**Как будут архивироваться и удаляться данные на регулярной основе**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-317">**How to archive and delete the data on a regular basis**.</span></span> <span data-ttu-id="29a2c-318">Для предотвращения чрезмерного увеличения размера секций необходимо регулярно архивировать и обновлять данные (возможно, раз в месяц).</span><span class="sxs-lookup"><span data-stu-id="29a2c-318">To prevent the excessive growth of partitions, you need to archive and delete data on a regular basis (perhaps monthly).</span></span> <span data-ttu-id="29a2c-319">Очевидно, потребуется преобразовать данные, чтобы обеспечить соответствие другой схеме архивирования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-319">It might be necessary to transform the data to match a different archive schema.</span></span>

- <span data-ttu-id="29a2c-320">**Как обнаруживать проблемы целостности данных**.</span><span class="sxs-lookup"><span data-stu-id="29a2c-320">**How to locate data integrity issues**.</span></span> <span data-ttu-id="29a2c-321">Рассмотрите возможность периодически выполнять обнаружение проблем с целостностью данных, например, когда данные в одной секции ссылаются на отсутствующие данные в другой секции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-321">Consider running a periodic process to locate any data integrity issues, such as data in one partition that references missing information in another.</span></span> <span data-ttu-id="29a2c-322">Эта операция может автоматически устранять проблемы или создавать отчет для проверки вручную.</span><span class="sxs-lookup"><span data-stu-id="29a2c-322">The process can either attempt to fix these issues automatically or simply generate a report for manual review.</span></span>

## <a name="rebalancing-partitions"></a><span data-ttu-id="29a2c-323">Балансировка секций</span><span class="sxs-lookup"><span data-stu-id="29a2c-323">Rebalancing partitions</span></span>

<span data-ttu-id="29a2c-324">По мере развития системы могут потребоваться изменения в схеме секционирования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-324">As a system matures, you might have to adjust the partitioning scheme.</span></span> <span data-ttu-id="29a2c-325">Например, трафик к некоторым секциям может непропорционально возрасти, приведя к дисбалансу и вызывая большое количество конфликтов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-325">For example, individual partitions might start get a disproportionate volume of traffic and become hot, leading to excessive contention.</span></span> <span data-ttu-id="29a2c-326">Или фактический объем данных в некоторых секциях может оказаться больше прогнозируемого, в результате чего некоторые секции могут достигать ограничений емкости.</span><span class="sxs-lookup"><span data-stu-id="29a2c-326">Or you might have underestimated the volume of data in some partitions, causing some partitions to approach capacity limits.</span></span>

<span data-ttu-id="29a2c-327">Некоторые хранилища данных, такие как Cosmos DB, могут автоматически балансировать секции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-327">Some data stores, such as Cosmos DB, can automatically rebalance partitions.</span></span> <span data-ttu-id="29a2c-328">В других ситуациях балансировка является административной задачей, которая состоит из двух этапов:</span><span class="sxs-lookup"><span data-stu-id="29a2c-328">In other cases, rebalancing is an administrative task that consists of two stages:</span></span>

1. <span data-ttu-id="29a2c-329">Определение новой стратегии секционирования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-329">Determine a new partitioning strategy.</span></span>

    - <span data-ttu-id="29a2c-330">Какие секции необходимо разделить (или, возможно, объединить)?</span><span class="sxs-lookup"><span data-stu-id="29a2c-330">Which partitions need to be split (or possibly combined)?</span></span>
    - <span data-ttu-id="29a2c-331">Каким будет новой ключ секции?</span><span class="sxs-lookup"><span data-stu-id="29a2c-331">What is the new partition key?</span></span>

2. <span data-ttu-id="29a2c-332">Перенос данных из старой схемы секционирования в новый набор секций.</span><span class="sxs-lookup"><span data-stu-id="29a2c-332">Migrate data from the old partitioning scheme to the new set of partitions.</span></span>

<span data-ttu-id="29a2c-333">Некоторые хранилища позволяют переносить данные между секциями в процессе их использования.</span><span class="sxs-lookup"><span data-stu-id="29a2c-333">Depending on the data store, you might be able to migrate data between partitions while they are in use.</span></span> <span data-ttu-id="29a2c-334">Это называется *оперативная миграция*.</span><span class="sxs-lookup"><span data-stu-id="29a2c-334">This is called *online migration*.</span></span> <span data-ttu-id="29a2c-335">Если такая миграция невозможна, потребуется заблокировать доступ к секциям на время переноса данных (*автономная миграция*).</span><span class="sxs-lookup"><span data-stu-id="29a2c-335">If that's not possible, you might need to make partitions unavailable while the data is relocated (*offline migration*).</span></span>

### <a name="offline-migration"></a><span data-ttu-id="29a2c-336">Автономная миграция</span><span class="sxs-lookup"><span data-stu-id="29a2c-336">Offline migration</span></span>

<span data-ttu-id="29a2c-337">Автономная миграция в целом является самым простым подходом, минимизируя вероятность возникновения конфликтов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-337">Offline migration is generally simpler, because it reduces the chances of contention occurring.</span></span> <span data-ttu-id="29a2c-338">Автономная миграция осуществляется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="29a2c-338">Conceptually, offline migration works as follows:</span></span>

1. <span data-ttu-id="29a2c-339">Отключите доступ к секции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-339">Mark the partition offline.</span></span>
2. <span data-ttu-id="29a2c-340">Разделите или объедините секции и переместите данные в новые секции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-340">Split-merge and move the data to the new partitions.</span></span>
3. <span data-ttu-id="29a2c-341">проверить данные;</span><span class="sxs-lookup"><span data-stu-id="29a2c-341">Verify the data.</span></span>
4. <span data-ttu-id="29a2c-342">Включите доступ к новым секциям.</span><span class="sxs-lookup"><span data-stu-id="29a2c-342">Bring the new partitions online.</span></span>
5. <span data-ttu-id="29a2c-343">Удалите старую секцию.</span><span class="sxs-lookup"><span data-stu-id="29a2c-343">Remove the old partition.</span></span>

<span data-ttu-id="29a2c-344">При необходимости можно разрешить доступ к секции только для чтения на этапе 1, чтобы приложения могли считывать данные при их переносе.</span><span class="sxs-lookup"><span data-stu-id="29a2c-344">Optionally, you can mark a partition as read-only in step 1, so that applications can still read the data while it is being moved.</span></span>

## <a name="online-migration"></a><span data-ttu-id="29a2c-345">Оперативная миграция</span><span class="sxs-lookup"><span data-stu-id="29a2c-345">Online migration</span></span>

<span data-ttu-id="29a2c-346">Оперативная миграция является более сложным, но менее ощутимым для работы системы процессом.</span><span class="sxs-lookup"><span data-stu-id="29a2c-346">Online migration is more complex to perform but less disruptive.</span></span> <span data-ttu-id="29a2c-347">Процедура аналогична автономной миграции, за исключением того, что доступ к исходной секции не отключается.</span><span class="sxs-lookup"><span data-stu-id="29a2c-347">The process is similar to offline migration, except the original partition is not marked offline.</span></span> <span data-ttu-id="29a2c-348">В зависимости от способа переноса (по элементам или по сегментам), коду доступа к данным в клиентских приложениях может понадобиться считывать и записывать данные, находящиеся в двух расположениях — в исходной и новой секциях.</span><span class="sxs-lookup"><span data-stu-id="29a2c-348">Depending on the granularity of the migration process (for example, item by item versus shard by shard), the data access code in the client applications might have to handle reading and writing data that's held in two locations, the original partition and the new partition.</span></span>

## <a name="related-patterns"></a><span data-ttu-id="29a2c-349">Связанные шаблоны</span><span class="sxs-lookup"><span data-stu-id="29a2c-349">Related patterns</span></span>

<span data-ttu-id="29a2c-350">Следующие шаблоны проектирования могут оказаться полезными для вашего сценария:</span><span class="sxs-lookup"><span data-stu-id="29a2c-350">The following design patterns might be relevant to your scenario:</span></span>

- <span data-ttu-id="29a2c-351">[Шаблон сегментирования](../patterns/sharding.md) описывает некоторые распространенные стратегии сегментирования данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-351">The [sharding pattern](../patterns/sharding.md) describes some common strategies for sharding data.</span></span>

- <span data-ttu-id="29a2c-352">[Шаблон таблицы индексов](../patterns/index-table.md) демонстрирует, как создавать вторичные индексы для данных.</span><span class="sxs-lookup"><span data-stu-id="29a2c-352">The [index table pattern](../patterns/index-table.md) shows how to create secondary indexes over data.</span></span> <span data-ttu-id="29a2c-353">Такой подход позволяет приложению быстро получить данные с помощью запросов, которые не ссылаются на первичный ключ коллекции.</span><span class="sxs-lookup"><span data-stu-id="29a2c-353">An application can quickly retrieve data with this approach, by using queries that do not reference the primary key of a collection.</span></span>

- <span data-ttu-id="29a2c-354">[Шаблон материализованного представления](../patterns/materialized-view.md) описывает, как создавать предварительно заполненные представления, которые отображают итоговые данные для поддержки операций быстрых запросов.</span><span class="sxs-lookup"><span data-stu-id="29a2c-354">The [materialized view pattern](../patterns/materialized-view.md) describes how to generate pre-populated views that summarize data to support fast query operations.</span></span> <span data-ttu-id="29a2c-355">Этот подход можно использовать в секционированном хранилище данных, если секции, содержащие итоговые данные, распределены по нескольким сайтам.</span><span class="sxs-lookup"><span data-stu-id="29a2c-355">This approach can be useful in a partitioned data store if the partitions that contain the data being summarized are distributed across multiple sites.</span></span>

## <a name="next-steps"></a><span data-ttu-id="29a2c-356">Дополнительная информация</span><span class="sxs-lookup"><span data-stu-id="29a2c-356">Next steps</span></span>

- <span data-ttu-id="29a2c-357">Дополнительные сведения о стратегии секционирования для определенных служб Azure см.</span><span class="sxs-lookup"><span data-stu-id="29a2c-357">Learn about partitioning strategies for specific Azure services.</span></span> <span data-ttu-id="29a2c-358">в статье [Data partitioning strategies](./data-partitioning-strategies.md) (Стратегии секционирования данных).</span><span class="sxs-lookup"><span data-stu-id="29a2c-358">See [Data partitioning strategies](./data-partitioning-strategies.md)</span></span>

[Целевые показатели масштабируемости и производительности хранилища Azure]: /azure/storage/storage-scalability-targets
[Azure Storage Scalability and Performance Targets]: /azure/storage/storage-scalability-targets
