---
title: "Руководство по сети доставки содержимого"
description: "Рекомендации по сети доставки содержимого (CDN) для обеспечения доставки содержимого, размещенного в Azure, по сети с высокой пропускной способностью."
author: dragon119
ms.date: 09/30/2016
pnp.series.title: Best Practices
ms.openlocfilehash: fffe0b0523c0a9c817f4346744ff3b5e3f11dede
ms.sourcegitcommit: cf207fd10110f301f1e05f91eeb9f8dfca129164
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2018
---
# <a name="content-delivery-network"></a>Сеть доставки содержимого
[!INCLUDE [header](../_includes/header.md)]

[Сеть доставки содержимого (CDN)](/azure/cdn/cdn-overview) Microsoft Azure предлагает разработчикам глобальное решение по доставке содержимого, размещенного в Azure или любом другом расположении, по сети с высокой пропускной способностью. Используя CDN, вы можете кэшировать общедоступные объекты, загруженные из хранилища BLOB-объектов, веб-приложения, виртуальной машины, папки приложения или другого расположения HTTP или HTTPS. Кэш CDN может храниться в стратегически важных местах для обеспечения максимальной пропускной способности при доставке содержимого пользователям. CDN обычно используется для доставки статического содержимого, например изображений, таблиц стилей, документов, файлов, клиентских скриптов и HTML-страниц.

CDN можно также использовать как кэш для обслуживания динамического содержимого, например отчетов в формате PDF или графа на основе указанных входных данных. Если одни и те же входные значения предоставляются разными пользователями, выходные данные должны быть одинаковыми.

Основные преимущества использования CDN: небольшая задержка и ускоренная доставка содержимого пользователям независимо от их географического расположения относительно центра обработки данных, в котором размещено приложение.  

![Схема сети CDN](./images/cdn/CDN.png)

Использование CDN также позволяет снизить нагрузку на приложение благодаря отсутствию необходимости выполнять обработку, необходимую для доступа к содержимому и его доставки. Уменьшение нагрузки позволяет повысить производительность и масштабируемость приложения, а также минимизировать затраты на размещение путем сокращения объема вычислительных ресурсов, необходимых для получения определенного уровня производительности и доступности.

## <a name="how-and-why-a-cdn-is-used"></a>Как и для чего используется CDN
К типичным случаям использования CDN относятся:  

* Доставка статических ресурсов для клиентских приложений, часто с веб-сайта. Это могут быть изображения, таблицы стилей, документы, файлы, клиентские скрипты, HTML-страницы, фрагменты HTML или любое другое содержимое, которое серверу не нужно изменять по каждому запросу. Приложение может создавать элементы во время выполнения и предоставлять их в сеть CDN (например, путем создания списка текущих новостей), но оно делает это не для каждого запроса.
* Доставка общедоступного статического и общего содержимого на устройства, например мобильные телефоны и планшетные компьютеры. Само приложение является веб-службой, которая предоставляет доступ к API клиентам, запущенным на разных устройствах. CDN также может доставлять статические наборы данных (через веб-службу) для использования клиентами, в том числе для создания пользовательского интерфейса клиента. Например, CDN можно использовать для распределения документов JSON или XML.
* Предоставление веб-сайтов целиком (при условии, что они состоят только из общедоступного статического содержимого) клиентам без необходимости использовать выделенные вычислительные ресурсы.
* Потоковая передача видеофайлов в клиент по запросу. Видео передаются с низкой задержкой и по надежному подключению, доступному из центров обработки данных, расположенных по всему миру, которые предлагают подключения к сети CDN. Службы мультимедиа Microsoft Azure (AMS) интегрируется с Azure CDN и напрямую доставляют в CDN содержимое для дальнейшего распространения. Дополнительные сведения см. в статье [Общие сведения о конечных точках потоковой передачи](/azure/media-services/media-services-streaming-endpoints-overview).
* Оптимизация взаимодействия для пользователей, особенно для тех, кто находится далеко от центра обработки, в котором размещено приложение. В противном случае такие пользователи могут испытывать большие задержки. Большой объем содержимого в веб-приложении часто является статическим, а использование CDN поможет поддерживать производительность и общее качество взаимодействия с пользователями на нужном уровне, исключая при этом необходимость развертывания приложения в нескольких центрах обработки данных.
* Обработка возрастающих нагрузок в приложениях с поддержкой решений IoT (Интернет вещей). Большое количество таких устройств может легко перегрузить приложение, если оно используется для обработки широковещательных сообщений и управления обновлением встроенного ПО непосредственно для каждого устройства.
* Обработка пиковых нагрузок и бросков напряжения в использовании без масштабирования приложения и увеличения последующих затрат на его работу. Например, при выпуске обновления операционной системы для оборудования (например, определенной модели маршрутизатора) либо пользовательского устройства (например, смарт-ТВ), возникает пиковое количество запросов, ведь оно скачивается миллионами пользователей и устройств за короткий период времени.

В следующем списке показаны примеры медианы времени до получения первого байта из разных географических расположений. Целевая веб-роль развертывается в регионе "Запад США" Azure. Чем ближе приложение к узлу CDN, тем значительнее ускорение работы от использования этой сети. Полный список расположений узлов Azure CDN доступен на странице [Расположения узлов сети доставки содержимого Azure](/azure/cdn/cdn-pop-locations/).

|  | Время (мс) до получения первого байта (источник) | Время (мс) до первого (CDN) | Улучшение времени CDN (%) |
| --- | --- | --- | --- |
| \*Сан-Хосе, Калифорния |47,5 |46,5 |2 % |
| \*\*Даллес, Вирджиния |109 |40,5 |169% |
| Буэнос-Айрес, Аргентина |210 |151 |39% |
| \*Лондон, Великобритания |195 |44 |343% |
| Шанхай, Китай |242 |206 |17% |
| \*Сингапур |214 |74 |189 % |
| \*Токио, Япония |163 |48 |204 % |
| Сеул, Корея |190 |190 |0% |

\* Узел Azure CDN расположен в одном городе.  
\*\* Узел Azure CDN расположен в соседнем городе.  

## <a name="challenges"></a>Сложности
При планировании использования CDN следует учитывать некоторые сложности.  

* **Развертывание**. Определите источник, из которого CDN получает содержимое, а также решите, нужно ли развертывать содержимое больше, чем в одной системе хранения данных (например, в CDN и альтернативном расположении).

  Механизм развертывания приложения должен учитывать особенности процесса развертывания не только статического содержимого и ресурсов, но и файлов приложений, например страниц ASPX. Например, вам может понадобиться выполнить отдельное действие по загрузке содержимого в хранилище BLOB-объектов Azure.
* **Управление версиями и кэшем**. Выберите способы обновления статического содержимого и развертывания новых версий. Содержимое CDN можно [очищать](/azure/cdn/cdn-purge-endpoint/) с помощью портала Azure, когда появляются новые версии ресурсов. Это задача аналогична задаче управления кэшированием на стороне клиента, например в браузере.
* **Тестирование**. Выполнение локального тестирования параметров CDN при разработке и тестировании приложения локально или в промежуточной среде может представлять сложности.
* **Оптимизация для поисковых систем (SEO)**. Содержимое, например изображения и документы, передаются из другого домена при использовании CDN, что может повлиять на SEO для этого содержимого.
* **Безопасность содержимого**. Многие службы CDN, например Azure CDN, сейчас не предлагают какие-либо типы контроля доступа к содержимому.
* **Безопасность клиента**. Клиенты могут подключаться из среды, которая не разрешает доступ к ресурсам в CDN. Это может быть среда с правилами безопасности, которая предоставляет доступ только к набору известных ресурсов или которая предотвращает загрузку ресурсов из любого расположения, кроме исходной страницы. В таких случаях требуется выполнить откат.
* **Устойчивость**. CDN — это потенциальная единая точка отказа для приложения. Она имеет соглашение об уровне обслуживания с более низкой доступностью по сравнению с хранилищем больших двоичных объектов (которое можно использовать для доставки содержимого напрямую), поэтому вам может потребоваться реализовать механизм отработки отказа для критически важного содержимого.

  Вы можете отслеживать доступность содержимого CDN, пропускную способность, передаваемые данные, попадания в кэш, коэффициент попаданий в кэш, а также метрики кэша на портале Azure [в режиме реального времени](/azure/cdn/cdn-real-time-stats/) и (или) [в статистических отчетах](/azure/cdn/cdn-analyze-usage-patterns/).

Сценарии, в которых сеть CDN может быть менее эффективной.  

* Если содержимое используется редко, к нему выполняется мало обращений, пока оно остается действительным (в зависимости от указанного срока жизни). При первом скачивании элемента с вас взимается плата за две транзакции (от источника в CDN, а затем от CDN пользователю).
* Если данные являются конфиденциальными, например в больших организациях или экосистемах цепочки поставок.

## <a name="general-guidelines-and-good-practices"></a>Общие инструкции и рекомендации
Использование CDN — это хороший способ минимизировать нагрузку на приложение и максимально повысить доступность и производительность. Попробуйте внедрить эту стратегию для всего содержимого и любых ресурсов, которые использует ваше приложение. При разработке стратегии по использованию CDN необходимо учитывать следующее.  

### <a name="origin"></a>Исходный домен
Для развертывания содержимого в CDN необходимо просто указать [конечную точку](/azure/cdn/cdn-create-new-endpoint) HTTP и (или) HTTPS, которую служба CDN будет использовать для доступа к содержимому и его кэширования.

Конечная точка может определять контейнер хранилища BLOB-объектов Azure, содержащий статическое содержимое, которое будет поставляться через CDN. Контейнер должен быть помечен как общедоступный. В сети CDN будут доступны только большие двоичные объекты, размещенные в общедоступном контейнере с открытым доступом на чтение.

Конечная точка может указать папку с именем **cdn** в корне одного из вычислительных слоев приложения (например, веб-роли или виртуальной машины). Результаты запросов на ресурсы, включая динамические ресурсы, такие как страницы ASPX, будут кэшированы в CDN. Минимальный период кэширования составляет 300 секунд. Более короткий период не позволяет выполнить развертывание содержимого в CDN (дополнительные сведения см. в разделе *Управление кэшем* ниже).

При использовании веб-приложений в качестве конечной точки задается корневая папка сайта. Для этого необходимо выбрать сайт при создании экземпляра CDN. Все содержимое сайта будет доступно в CDN.

В большинстве случаев вы можете увеличить гибкость и контроль, если конечная точка CDN будет указывать на папку в одном из вычислительных слоев приложения. Например, станет проще управлять текущими и будущими требованиями к маршрутизации, а также динамически создавать статическое содержимое, например эскизы изображений.

Если содержимое поставляется из динамических источников, таких как страницы ASPX, то для разделения объектов кэша можно использовать [строки запросов](/azure/cdn/cdn-query-string/). Это поведение можно отключить, установив соответствующий параметр на портале Azure при указании конечной точки CDN. При доставке содержимого из хранилища больших двоичных объектов строки запросов рассматриваются как строковые литералы, поэтому два элемента с одинаковыми именами и разными строками запроса сохраняются в CDN в виде отдельных элементов.

Для таких ресурсов, как скрипты и другое содержимое, можно использовать переопределение URL-адресов, чтобы избежать перемещения файлов в папку источника CDN.

Если вы используете для хранения содержимого сети CDN большие двоичные объекты Azure, для имен контейнеров и больших двоичных объектов в URL-адресах ресурсов учитывается регистр.

При использовании пользовательских источников или веб-приложений Azure следует указать путь к экземпляру CDN в ссылках на ресурсы. Например, ниже указан файл изображения в папке **Images** (Изображения) для сайта, который будет доставлен через CDN:

```XML
<img src="http://[your-cdn-endpoint].azureedge.net/Images/image.jpg" />
```

### <a name="deployment"></a>Развертывание
Может потребоваться подготовить и развернуть статическое содержимое независимо от приложения, если вы не включите его в пакет или процесс развертывания приложения. Рассмотрите, как это повлияет на подход к управлению версиями, который используется для компонентов приложения и содержимого статических ресурсов.

Узнайте, как будет обрабатываться объединение (совмещение нескольких файлов в один) и минификация (удаление ненужных символов, например пробелов, символов новой строки, комментариев и других символов) для скрипта и CSS-файлов. Эти распространенные подходы позволяют сократить время загрузки для клиентов; кроме того, они совместимы с доставкой содержимого через CDN. Дополнительные сведения см. в статье [Объединение и минификация](http://www.asp.net/mvc/tutorials/mvc-4/bundling-and-minification).

Если вам нужно развернуть содержимое в дополнительное расположение, это потребуется сделать в дополнительном шаге развертывания. Если приложение обновляет содержимое для CDN регулярно или в ответ на событие, оно должно сохранять обновленное содержимое и конечную точку CDN во всех дополнительных расположениях.

Задать конечную точку CDN для приложения в локальном эмуляторе Azure в Visual Studio нельзя. Это ограничение повлияет на модульное и функциональное тестирование, а также финальное тестирование перед развертыванием. Это необходимо учесть и реализовать альтернативный механизм. Например, вы можете предварительно развернуть содержимое в CDN с помощью пользовательского приложения или служебной программы, а затем выполнить тестирование во время периода кэширования. Кроме того, можно воспользоваться директивами компилятора или глобальными константами для управления расположением, из которого приложение загружает ресурсы. Например, при запуске в режиме отладки можно загрузить такие ресурсы, как клиентские наборы скриптов и другое содержимое из локальной папки, и использовать CDN при запуске в режиме выпуска.

Выберите метод сжатия, который должен поддерживаться CDN.

* Можно [включить сжатие](/azure/cdn/cdn-improve-performance/) на сервере-источнике. В этом случае CDN будет поддерживать сжатие по умолчанию и доставлять клиентам содержимое, сжатое в таких форматах, как ZIP или GZIP. При использовании папки приложения в качестве конечной точки CDN сервер может сжимать часть содержимого автоматически — так же, как и при доставке непосредственно в браузер или другой тип клиента. Формат зависит от значения заголовка **Accept-Encoding** в запросе, отправленном клиентом. В Azure содержимое автоматически сжимается по умолчанию, если загрузка ЦП не превышает 50 %. Если приложение размещается в облачной службе, возможно, при изменении параметров потребуется выполнить задачу запуска, чтобы включить сжатие динамических выходных данных в IIS. Дополнительные сведения см. в статье [Включение сжатия GZIP в Microsoft Azure CDN с помощью веб-роли](http://blogs.msdn.com/b/avkashchauhan/archive/2012/03/05/enableing-gzip-compression-with-windows-azure-cdn-through-web-role.aspx).
* Можно включить сжатие непосредственно на пограничных серверах CDN — в таком случае CDN будет сжимать файлы и доставлять их конечным пользователям. Дополнительные сведения см. в статье [Сжатие Azure CDN](/azure/cdn/cdn-improve-performance/).

### <a name="routing-and-versioning"></a>Маршрутизация и управление версиями
Вы можете использовать разные экземпляры CDN в разные моменты времени. Например, при развертывании новой версии приложения можно использовать новую сеть CDN, а старую сеть CDN (вместе с содержимым в старом формате) оставить для предыдущих версий. Если вы используете хранилище больших двоичных объектов Azure в качестве источника содержимого, вы можете создать отдельную учетную запись хранения или отдельный контейнер и указать его в качестве конечной точки CDN. Если вы используете корневую папку cdn в качестве конечной точки CDN в приложении, с помощью переопределения URL-адресов вы можете направлять запросы в другую папку.

Не используйте строку запроса для указания разных версий приложения в ссылках на ресурсы CDN, так как при получении содержимого из хранилища BLOB-объектов Azure строка запроса является частью имени ресурса (имени большого двоичного объекта). Это может повлиять на способ кэширования ресурсов клиентом.

Развертывание новых версий статического содержимого при обновлении приложения может представлять сложность, если предыдущие ресурсы кэшировались в CDN. Дополнительные сведения см. в статье *Управление кэшем*.

Доступ к содержимому CDN можно ограничивать по странам. Azure CDN позволяет отфильтровывать запросы на основе страны происхождения, ограничивая доставку содержимого. Дополнительные сведения см. в статье [Ограничение доступа к содержимому по странам](/azure/cdn/cdn-restrict-access-by-country/).

### <a name="cache-control"></a>управление кэшем;
Выберите способ управления кэшированием в системе. Например, при использовании папки в качестве источника CDN вы можете указать возможность кэширования страниц, которые создают содержимое, а также срок истечения действия содержимого для всех ресурсов в определенной папке. Вы можете также указать свойства кэша для CDN и для клиента, использующего стандартные заголовки HTTP. Хотя вы, скорее всего, уже управляете кэшированием на сервере и клиенте, сеть CDN позволит получить дополнительные сведения о способе и месте кэширования содержимого.

Чтобы запретить доступ к объектам в CDN, их можно удалить из источника (контейнера больших двоичных объектов или корневой папки *cdn* приложения). Кроме того, можно удалить конечную точку CDN или, в случае хранилища BLOB-объектов, сделать контейнер или большой двоичный объект закрытым. При этом элементы будут удалены из CDN только по истечении их срока жизни. Если период истечения срока действия кэша не указан (например, если содержимое загружается из хранилища BLOB-объектов), оно хранится в CDN не более 7 дней.  Можно также вручную [очистить конечную точку CDN](/azure/cdn/cdn-purge-endpoint/).

В веб-приложении можно задать параметры кэширования и срок истечения действия для всего содержимого с помощью элемента *clientCache* в разделе *system.webServer/staticContent* файла web.config. Учтите, что размещение файла web.config в какой-либо папке влияет на файлы в этой папке и всех вложенных папках.

Если содержимое для CDN создается динамически (например, в коде вашего приложения), убедитесь, что вы указали свойство *Cache.SetExpires* на каждой странице. CDN не будет кэшировать выходные данные со страниц, которые используют для возможности кэширования стандартный параметр *public*.  Задайте нужное значение для срока истечения действия кэша, чтобы гарантировать, что содержимое не будет удаляться или перезагружаться из приложения через очень короткие интервалы времени.  

### <a name="security"></a>Безопасность
CDN может доставлять содержимое по протоколу HTTPS (SSL), используя предоставленный CDN сертификат, а также по стандартному протоколу HTTP. Чтобы избежать предупреждений браузера о смешанном содержимом, следует применять HTTPS для запроса статического содержимого на тех страницах, которые были получены по протоколу HTTPS.

Если вы используете CDN для передачи статических активов, таких как файлы шрифтов, некоторые проблемы может вызвать политика одного источника, например при использовании *XMLHttpRequest* для получения ресурсов из другого домена. Многие веб-браузеры предотвращают общий доступ к ресурсам независимо от источника (CORS), если сервер не настроен для задания соответствующих заголовков ответов. Вы можете настроить в CDN поддержку CORS, используя любой из следующих методов.

* Добавьте заголовки ответов CORS с помощью обработчика правил CDN. Обычно это самый лучший метод, поскольку он поддерживает подстановочные знаки и несколько явно разрешенных источников. Дополнительные сведения см. в статье [Использование Azure CDN с CORS](https://docs.microsoft.com/en-us/azure/cdn/cdn-cors). 
* Добавьте *CorsRule* в свойства службы. Этот метод удобен, если вы доставляете содержимое из хранилища BLOB-объектов Azure. Правило может указать разрешенные источники для запросов CORS, разрешенные методы, например GET, и максимальный возраст правила в секундах (период, в течение которого клиент должен запросить связанные ресурсы после загрузки исходного содержимого). Если вы применяете CORS для хранилища, которое используется с CDN, в списке разрешенных источников поддерживается только подстановочный знак "*". Дополнительные сведения см. в статье [Поддержка общего доступа к ресурсам независимо от источника (CORS) для служб хранилища Azure](http://msdn.microsoft.com/library/azure/dn535601.aspx).
* Настройте правила для исходящих подключений в файле конфигурации приложения, чтобы добавлять заголовок *Access-Control-Allow-Origin* во все ответы. Этот метод можно использовать, если исходный сервер работает под управлением IIS. Если вы применяете этот метод для CDN, в списке разрешенных источников поддерживается только подстановочный знак "*". Дополнительные сведения об использовании правил переопределения см. в статье [Модуль переопределения URL-адресов](http://www.iis.net/learn/extensions/url-rewrite-module).

### <a name="custom-domains"></a>Личные домены
Сеть Azure CDN позволяет указывать [имя личного домена](/azure/cdn/cdn-map-content-to-custom-domain/), а также использовать его для доступа к ресурсам через CDN. Вы можете также настроить пользовательское поддоменное имя с помощью записи *CNAME* в DNS. Этот подход обеспечит дополнительный уровень абстракции и контроля.

При использовании *CNAME*вы не можете использовать SSL, так как в CDN есть собственный SSL-сертификат, который не соответствует пользовательским именам доменов и поддоменов.

### <a name="cdn-fallback"></a>Резервная сеть CDN
Оцените, как приложение будет обрабатывать сбои в CDN и (или) временную недоступность. Клиентские приложения могут использовать копии ресурсов, которые были кэшированы локально (на клиенте) во время предыдущих запросов. Также вы можете включить код, который обнаруживает сбой и запрашивает ресурсы из источника (папки приложения или контейнера больших двоичных объектов Azure, в котором содержатся ресурсы), если сеть CDN недоступна.

Следующий пример демонстрирует резервные механизмы на основе [вспомогательных функций тегов](https://docs.microsoft.com/en-us/aspnet/core/mvc/views/tag-helpers/intro) в представлении Razor.

```HTML
...
<link rel="stylesheet" href="https://[your-cdn-endpoint].azureedge.net/lib/bootstrap/dist/css/bootstrap.min.css"
      asp-fallback-href="~/lib/bootstrap/dist/css/bootstrap.min.css"
      asp-fallback-test-class="sr-only" asp-fallback-test-property="position" asp-fallback-test-value="absolute"/>
<link rel="stylesheet" href="~/css/site.min.css" asp-append-version="true"/>
...
<script src="https://[your-cdn-endpoint].azureedge.net/lib/jquery/dist/jquery-2.2.0.min.js"
        asp-fallback-src="~/lib/jquery/dist/jquery.min.js"
        asp-fallback-test="window.jQuery">
</script>
<script src="https://[your-cdn-endpoint].azureedge.net/lib/bootstrap/dist/js/bootstrap.min.js"
        asp-fallback-src="~/lib/bootstrap/dist/js/bootstrap.min.js"
        asp-fallback-test="window.jQuery && window.jQuery.fn && window.jQuery.fn.modal">
</script>
...
```

### <a name="search-engine-optimization"></a>Оптимизация для поисковых систем
Если SEO является важной частью приложения, выполните следующие задачи.

* Включите канонический заголовок *Rel* на каждой странице или в каждом ресурсе.
* Используйте запись поддомена *CNAME* и обращайтесь к ресурсам с помощью этого имени.
* Учитывайте возможность того, что IP-адрес CDN может быть страной или регионом, который отличается от самого приложения.
* При использовании хранилища больших двоичных объектов Azure в качестве источника сохраните ту же структуру файлов для ресурсов в CDN, что и в папках приложения.

### <a name="monitoring-and-logging"></a>Мониторинг и ведение журнала
Включите CDN в стратегию мониторинга приложений, чтобы обнаруживать и измерять сбои приложения или длительные задержки.  Мониторинг можно выполнять в диспетчере профилей CDN, который доступен на сайте портала Azure.

Включите ведение журнала для CDN и выполняйте мониторинг этого журнала как часть ежедневных операций.

Выполните анализ трафика CDN для схем использования. Портал Azure предоставляет средства, которые позволяют отслеживать следующие показатели:

* пропускная способность;
* переданные данные;
* попадания в кэш (коды состояния);
* состояние кэша;
* коэффициент попаданий в кэш;
* доля запросов IPV4 и IPV6.

Дополнительные сведения см. в статье [Анализ вариантов использования CDN](/azure/cdn/cdn-analyze-usage-patterns/).

### <a name="cost-implications"></a>Потенциальные затраты
За передачу исходящих данных из сети CDN производится тарификация.  Кроме того, если вы используете хранилище больших двоичных объектов для размещения ресурсов, начисляется плата за хранение транзакций, когда CDN загружает данные из приложения. Устанавливайте разумные сроки действия, чтобы содержимое оставалось актуальным, но не слишком часто загружалось в CDN из приложения или хранилища больших двоичных объектов.

Редко скачиваемые элементы повлекут расходы на две транзакции, не сильно уменьшая нагрузку на сервер.

### <a name="bundling-and-minification"></a>Объединение и минификация
Используйте объединение и минификацию, чтобы уменьшить размер таких ресурсов, как код JavaScript и HTML-страницы, которые хранятся в сети CDN. Эта стратегия позволяет сократить время, необходимое для загрузки этих элементов на клиент.

Объединение и минификацию может обрабатывать ASP.NET. В проекте MVC вы определяете наборы в *BundleConfig.cs*. Ссылка на набор минифицированных скриптов создается путем вызова метода *Script.Render* , обычно в коде класса представления. Эта ссылка содержит строку запроса, которая включает хэш, основанный на содержимом набора. При изменении содержимого набора созданный хэш также изменится.  

По умолчанию в экземплярах Azure CDN параметр *Состояние строки запроса* отключен. Чтобы обновленные наборы скриптов правильно обрабатывались CDN, необходимо включить параметр *Состояние строки запроса* для экземпляра CDN. Учтите, что активация этого параметра может занять больше часа.

### <a name="features"></a>Функции

Azure предлагает несколько продуктов CDN. При выборе CDN внимательно оцените, какие возможности поддерживаются для каждого из них. Дополнительные сведения см. в разделе [Компоненты Azure CDN][cdn-features]. Возможно, вас заинтересуют эти дополнительные возможности.

- **[Обработчик правил](/azure/cdn/cdn-rules-engine)**. Обработчик правил позволяет настроить способ обработки HTTP-запросов, например блокировку доставки определенных типов содержимого, определение политики кэширования и изменение заголовков HTTP. 

- **[Статистика в реальном времени](/azure/cdn/cdn-real-time-stats)**. Отслеживайте в реальном времени такие данные, как пропускная способность, состояния кэша и количество одновременных подключений к профилю CDN, а также получайте [оповещения в реальном времени](/azure/cdn/cdn-real-time-alerts). 


## <a name="rules-engine-url-rewriting-example"></a>Пример переопределения URL-адресов с помощью обработчика правил

На следующей схеме показано, как правильно выполнять [переопределение URL-адресов](https://technet.microsoft.com/library/ee215194.aspx) при использовании CDN. Запросы на кэшируемое содержимое из CDN будут перенаправляться в определенные папки в корне приложения на основе типа ресурса (например, скрипты и изображения).  

![Схема обработчика правил](./images/cdn/rules-engine.png)

Эти правила переопределения выполняют следующие переопределения.

* Первое правило позволяет внедрить версию в имя файла ресурса, которая потом пропускается. Например, *Filename_v123.jpg* переопределяется как *Filename.jpg*.
* Следующие четыре правила показывают, как перенаправлять запросы, если вы не хотите сохранять ресурсы в папке с именем *cdn** в корневом каталоге веб-роли. Правило сопоставляет URL-адреса *cdn/Images*, *cdn/Content*, *cdn/Scripts* и *cdn/bundles* с соответствующими корневыми папками в веб-роли.

Учтите, что при использовании переопределения URL-адресов требуется внести некоторые изменения в объединение ресурсов.     

## <a name="more-information"></a>Дополнительные сведения
* [Azure CDN](https://azure.microsoft.com/services/cdn/)
* [Документация по сетям доставки содержимого Azure (CDN)](https://azure.microsoft.com/documentation/services/cdn/)
* [Использование Azure CDN](/azure/cdn/cdn-create-new-endpoint/)
* [Интеграция облачной службы с Azure CDN](/azure/cdn/cdn-cloud-service-with-cdn/)(https://azure.microsoft.com/blog/2011/03/18/best-practices-for-the-windows-azure-content-delivery-network/)


<!-- links -->

[cdn-features]: /azure/cdn/cdn-overview#azure-cdn-features
