---
title: Контрольный список для обеспечения устойчивости служб Azure
titleSuffix: Azure Design Review Framework
description: Контрольный список, который содержит рекомендации по обеспечению устойчивости различных служб Azure.
author: petertaylor9999
ms.date: 11/26/2018
ms.topic: checklist
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.custom: resiliency, checklist
ms.openlocfilehash: fbb7501a663c8b5e326b2b601685419c8e5a0806
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54486919"
---
# <a name="resiliency-checklist-for-specific-azure-services"></a><span data-ttu-id="4a29a-103">Контрольный список для обеспечения устойчивости конкретных служб Azure</span><span class="sxs-lookup"><span data-stu-id="4a29a-103">Resiliency checklist for specific Azure services</span></span>

<span data-ttu-id="4a29a-104">Устойчивость представляет собой возможность восстановления системы после сбоев и продолжения работы. Это один из [основных критериев качества программного обеспечения](../guide/pillars.md).</span><span class="sxs-lookup"><span data-stu-id="4a29a-104">Resiliency is the ability of a system to recover from failures and continue to function, and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="4a29a-105">Каждая технология имеет собственные режимы сбоев, которые необходимо учитывать при разработке и реализации приложения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-105">Every technology has its own particular failure modes, which you must consider when designing and implementing your application.</span></span> <span data-ttu-id="4a29a-106">Используйте этот контрольный список для проверки факторов устойчивости конкретных служб Azure.</span><span class="sxs-lookup"><span data-stu-id="4a29a-106">Use this checklist to review the resiliency considerations for specific Azure services.</span></span> <span data-ttu-id="4a29a-107">Также ознакомьтесь с [общим контрольным списком для обеспечения устойчивости](./resiliency.md).</span><span class="sxs-lookup"><span data-stu-id="4a29a-107">Also review the [general resiliency checklist](./resiliency.md).</span></span>

## <a name="app-service"></a><span data-ttu-id="4a29a-108">Служба приложений</span><span class="sxs-lookup"><span data-stu-id="4a29a-108">App Service</span></span>

<span data-ttu-id="4a29a-109">**Уровень "Стандартный" или "Премиум".**</span><span class="sxs-lookup"><span data-stu-id="4a29a-109">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="4a29a-110">Эти уровни поддерживают промежуточные слоты и автоматическое резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="4a29a-110">These tiers support staging slots and automated backups.</span></span> <span data-ttu-id="4a29a-111">Дополнительные сведения см. в статье [Подробный обзор планов службы приложений Azure](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-111">For more information, see [Azure App Service plans in-depth overview](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)</span></span>

<span data-ttu-id="4a29a-112">**Избегайте увеличения или уменьшения масштаба.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-112">**Avoid scaling up or down.**</span></span> <span data-ttu-id="4a29a-113">Вместо этого выберите уровень и размер экземпляра в соответствии с требованиями к производительности при типичной нагрузке, а затем выполните [горизонтальное масштабирование](/azure/app-service-web/web-sites-scale/) экземпляров для обработки изменений объема трафика.</span><span class="sxs-lookup"><span data-stu-id="4a29a-113">Instead, select a tier and instance size that meet your performance requirements under typical load, and then [scale out](/azure/app-service-web/web-sites-scale/) the instances to handle changes in traffic volume.</span></span> <span data-ttu-id="4a29a-114">Увеличение или уменьшение масштаба может вызвать перезапуск приложения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-114">Scaling up and down may trigger an application restart.</span></span>

<span data-ttu-id="4a29a-115">**Сохраняйте конфигурацию в виде настроек приложений.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-115">**Store configuration as app settings.**</span></span> <span data-ttu-id="4a29a-116">Используйте настройки приложения, чтобы сохранить параметры конфигурации в качестве настроек приложения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-116">Use app settings to hold configuration settings as app settings.</span></span> <span data-ttu-id="4a29a-117">Определите параметры в шаблонах Resource Manager или с помощью PowerShell, чтобы применить их в процессе автоматического развертывания или обновления. Этот подход надежнее.</span><span class="sxs-lookup"><span data-stu-id="4a29a-117">Define the settings in your Resource Manager templates, or using PowerShell, so that you can apply them as part of an automated deployment / update process, which is more reliable.</span></span> <span data-ttu-id="4a29a-118">Дополнительные сведения см. в статье [Настройка веб-приложений в службе приложений Azure](/azure/app-service-web/web-sites-configure/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-118">For more information, see [Configure web apps in Azure App Service](/azure/app-service-web/web-sites-configure/).</span></span>

<span data-ttu-id="4a29a-119">**Используйте разные планы службы приложений для рабочей и тестовой сред.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-119">**Create separate App Service plans for production and test.**</span></span> <span data-ttu-id="4a29a-120">Не используйте слоты в рабочем развертывании для тестирования.</span><span class="sxs-lookup"><span data-stu-id="4a29a-120">Don't use slots on your production deployment for testing.</span></span>  <span data-ttu-id="4a29a-121">Все приложения, которые находятся в одном плане службы приложений, совместно используют одни экземпляры виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="4a29a-121">All apps within the same App Service plan share the same VM instances.</span></span> <span data-ttu-id="4a29a-122">Если разместить рабочее и тестовое развертывание в одном плане, это может негативно повлиять на рабочее развертывание.</span><span class="sxs-lookup"><span data-stu-id="4a29a-122">If you put production and test deployments in the same plan, it can negatively affect the production deployment.</span></span> <span data-ttu-id="4a29a-123">Например, нагрузочные тесты могут привести к ухудшению производительности активного рабочего сайта.</span><span class="sxs-lookup"><span data-stu-id="4a29a-123">For example, load tests might degrade the live production site.</span></span> <span data-ttu-id="4a29a-124">Поместив тестовые развертывания в отдельный план, можно изолировать их от рабочей версии.</span><span class="sxs-lookup"><span data-stu-id="4a29a-124">By putting test deployments into a separate plan, you isolate them from the production version.</span></span>

<span data-ttu-id="4a29a-125">**Отделите веб-приложения от веб-API.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-125">**Separate web apps from web APIs.**</span></span> <span data-ttu-id="4a29a-126">Если в решении есть как веб-интерфейс, так и веб-API, рассмотрите возможность их разбивки на отдельные приложения службы приложений.</span><span class="sxs-lookup"><span data-stu-id="4a29a-126">If your solution has both a web front-end and a web API, consider decomposing them into separate App Service apps.</span></span> <span data-ttu-id="4a29a-127">Такой подход помогает распределять решения по рабочим нагрузкам.</span><span class="sxs-lookup"><span data-stu-id="4a29a-127">This design makes it easier to decompose the solution by workload.</span></span> <span data-ttu-id="4a29a-128">Вы можете запускать веб-приложение и API в отдельных планах службы приложений, чтобы они могли масштабироваться независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="4a29a-128">You can run the web app and the API in separate App Service plans, so they can be scaled independently.</span></span> <span data-ttu-id="4a29a-129">Если изначально этот уровень масштабируемости не требуется, можно развертывать приложения в одном плане и позже переместить их в отдельные планы (при необходимости).</span><span class="sxs-lookup"><span data-stu-id="4a29a-129">If you don't need that level of scalability at first, you can deploy the apps into the same plan, and move them into separate plans later, if needed.</span></span>

<span data-ttu-id="4a29a-130">**Избегайте использования функции резервного копирования службы приложений для резервного копирования баз данных Azure SQL.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-130">**Avoid using the App Service backup feature to back up Azure SQL databases.**</span></span> <span data-ttu-id="4a29a-131">Вместо этого используйте [автоматическое резервное копирование базы данных SQL][sql-backup].</span><span class="sxs-lookup"><span data-stu-id="4a29a-131">Instead, use [SQL Database automated backups][sql-backup].</span></span> <span data-ttu-id="4a29a-132">При резервном копировании службы приложений база данных экспортируется в BACPAC-файл SQL, использующий единицы DTU.</span><span class="sxs-lookup"><span data-stu-id="4a29a-132">App Service backup exports the database to a SQL .bacpac file, which costs DTUs.</span></span>

<span data-ttu-id="4a29a-133">**Выполняйте развертывания в промежуточном слоте.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-133">**Deploy to a staging slot.**</span></span> <span data-ttu-id="4a29a-134">Создайте слот развертывания для размещения в промежуточной среде.</span><span class="sxs-lookup"><span data-stu-id="4a29a-134">Create a deployment slot for staging.</span></span> <span data-ttu-id="4a29a-135">Разверните обновления приложений в промежуточном слоте и проверьте развертывание, прежде чем переносить его в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="4a29a-135">Deploy application updates to the staging slot, and verify the deployment before swapping it into production.</span></span> <span data-ttu-id="4a29a-136">Это снижает вероятность неправильного обновления в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="4a29a-136">This reduces the chance of a bad update in production.</span></span> <span data-ttu-id="4a29a-137">Это также гарантирует, что все экземпляры подготовлены перед перемещением в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="4a29a-137">It also ensures that all instances are warmed up before being swapped into production.</span></span> <span data-ttu-id="4a29a-138">Для многих приложений довольно долго выполняются начальная загрузка и "холодный" запуск.</span><span class="sxs-lookup"><span data-stu-id="4a29a-138">Many applications have a significant warmup and cold-start time.</span></span> <span data-ttu-id="4a29a-139">Дополнительные сведения см. в статье [Настройка промежуточных сред в службе приложений Azure](/azure/app-service-web/web-sites-staged-publishing/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-139">For more information, see [Set up staging environments for web apps in Azure App Service](/azure/app-service-web/web-sites-staged-publishing/).</span></span>

<span data-ttu-id="4a29a-140">**Создайте слот развертывания для хранения последнего известного корректного развертывания (LKG).**</span><span class="sxs-lookup"><span data-stu-id="4a29a-140">**Create a deployment slot to hold the last-known-good (LKG) deployment.**</span></span> <span data-ttu-id="4a29a-141">При развертывании обновления в рабочей среде переместите предыдущее рабочее развертывание в слот LKG.</span><span class="sxs-lookup"><span data-stu-id="4a29a-141">When you deploy an update to production, move the previous production deployment into the LKG slot.</span></span> <span data-ttu-id="4a29a-142">Это упрощает откат неправильного развертывания.</span><span class="sxs-lookup"><span data-stu-id="4a29a-142">This makes it easier to roll back a bad deployment.</span></span> <span data-ttu-id="4a29a-143">Если в дальнейшем обнаруживается проблема, можно быстро вернуться к версии LKG.</span><span class="sxs-lookup"><span data-stu-id="4a29a-143">If you discover a problem later, you can quickly revert to the LKG version.</span></span> <span data-ttu-id="4a29a-144">Дополнительные сведения см. в статье [Basic web application](../reference-architectures/app-service-web-app/basic-web-app.md) (Базовое веб-приложение).</span><span class="sxs-lookup"><span data-stu-id="4a29a-144">For more information, see [Basic web application](../reference-architectures/app-service-web-app/basic-web-app.md).</span></span>

<span data-ttu-id="4a29a-145">**Включите ведение журнала диагностики**, в частности для приложения и веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="4a29a-145">**Enable diagnostics logging**, including application logging and web server logging.</span></span> <span data-ttu-id="4a29a-146">Ведение журнала важно для мониторинга и диагностики.</span><span class="sxs-lookup"><span data-stu-id="4a29a-146">Logging is important for monitoring and diagnostics.</span></span> <span data-ttu-id="4a29a-147">Ознакомьтесь со статьей [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](/azure/app-service-web/web-sites-enable-diagnostic-log/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-147">See [Enable diagnostics logging for web apps in Azure App Service](/azure/app-service-web/web-sites-enable-diagnostic-log/)</span></span>

<span data-ttu-id="4a29a-148">**Храните данные журнала в хранилище BLOB-объектов.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-148">**Log to blob storage.**</span></span> <span data-ttu-id="4a29a-149">Это упрощает сбор и анализ данных.</span><span class="sxs-lookup"><span data-stu-id="4a29a-149">This makes it easier to collect and analyze the data.</span></span>

<span data-ttu-id="4a29a-150">**Создайте отдельную учетную запись хранения для журналов.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-150">**Create a separate storage account for logs.**</span></span> <span data-ttu-id="4a29a-151">Не используйте одну учетную запись хранения для журналов и данных приложения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-151">Don't use the same storage account for logs and application data.</span></span> <span data-ttu-id="4a29a-152">Это помогает предотвратить снижение производительности приложения из-за ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="4a29a-152">This helps to prevent logging from reducing application performance.</span></span>

<span data-ttu-id="4a29a-153">**Отслеживайте производительность.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-153">**Monitor performance.**</span></span> <span data-ttu-id="4a29a-154">Используйте службу мониторинга производительности, например [New Relic](https://newrelic.com/) или [Application Insights](/azure/application-insights/app-insights-overview/), чтобы контролировать производительность и поведение загруженных приложений.</span><span class="sxs-lookup"><span data-stu-id="4a29a-154">Use a performance monitoring service such as [New Relic](https://newrelic.com/) or [Application Insights](/azure/application-insights/app-insights-overview/) to monitor application performance and behavior under load.</span></span>  <span data-ttu-id="4a29a-155">Мониторинг производительности дает вам представление о приложении в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="4a29a-155">Performance monitoring gives you real-time insight into the application.</span></span> <span data-ttu-id="4a29a-156">Он позволяет диагностировать проблемы и выполнять анализ основной причины сбоев.</span><span class="sxs-lookup"><span data-stu-id="4a29a-156">It enables you to diagnose issues and perform root-cause analysis of failures.</span></span>

## <a name="application-gateway"></a><span data-ttu-id="4a29a-157">Шлюз приложений</span><span class="sxs-lookup"><span data-stu-id="4a29a-157">Application Gateway</span></span>

<span data-ttu-id="4a29a-158">**Подготовьте по крайней мере два экземпляра.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-158">**Provision at least two instances.**</span></span> <span data-ttu-id="4a29a-159">Разверните шлюз приложений как минимум с двумя экземплярами.</span><span class="sxs-lookup"><span data-stu-id="4a29a-159">Deploy Application Gateway with at least two instances.</span></span> <span data-ttu-id="4a29a-160">Один экземпляр является единой точкой отказа.</span><span class="sxs-lookup"><span data-stu-id="4a29a-160">A single instance is a single point of failure.</span></span> <span data-ttu-id="4a29a-161">Используйте два или более экземпляров для обеспечения избыточности и масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="4a29a-161">Use two or more instances for redundancy and scalability.</span></span> <span data-ttu-id="4a29a-162">В соответствии с [соглашением об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/application-gateway) необходимо предоставить два или более экземпляров среднего или большего размера.</span><span class="sxs-lookup"><span data-stu-id="4a29a-162">In order to qualify for the [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway), you must provision two or more medium or larger instances.</span></span>

## <a name="cosmos-db"></a><span data-ttu-id="4a29a-163">База данных Cosmos</span><span class="sxs-lookup"><span data-stu-id="4a29a-163">Cosmos DB</span></span>

<span data-ttu-id="4a29a-164">**Реплицируйте базу данных в разные регионы.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-164">**Replicate the database across regions.**</span></span> <span data-ttu-id="4a29a-165">Cosmos DB позволяет связать любое количество регионов Azure с учетной записью базы данных Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4a29a-165">Cosmos DB allows you to associate any number of Azure regions with a Cosmos DB database account.</span></span> <span data-ttu-id="4a29a-166">База данных Cosmos DB может иметь один регион записи и несколько регионов чтения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-166">A Cosmos DB database can have one write region and multiple read regions.</span></span> <span data-ttu-id="4a29a-167">В случае сбоя в регионе записи можно выполнять чтение из другой реплики.</span><span class="sxs-lookup"><span data-stu-id="4a29a-167">If there is a failure in the write region, you can read from another replica.</span></span> <span data-ttu-id="4a29a-168">Клиентский пакет SDK обрабатывает это автоматически.</span><span class="sxs-lookup"><span data-stu-id="4a29a-168">The Client SDK handles this automatically.</span></span> <span data-ttu-id="4a29a-169">Кроме того, можно выполнить отработку отказа региона записи в другой регион.</span><span class="sxs-lookup"><span data-stu-id="4a29a-169">You can also fail over the write region to another region.</span></span> <span data-ttu-id="4a29a-170">Дополнительные сведения см. в статье [Как работает глобальное распределение данных в Azure с помощью Cosmos DB](/azure/cosmos-db/distribute-data-globally).</span><span class="sxs-lookup"><span data-stu-id="4a29a-170">For more information, see [How to distribute data globally with Azure Cosmos DB](/azure/cosmos-db/distribute-data-globally).</span></span>

## <a name="event-hubs"></a><span data-ttu-id="4a29a-171">Центры событий</span><span class="sxs-lookup"><span data-stu-id="4a29a-171">Event Hubs</span></span>

<span data-ttu-id="4a29a-172">**Использование контрольных точек**.</span><span class="sxs-lookup"><span data-stu-id="4a29a-172">**Use checkpoints**.</span></span>  <span data-ttu-id="4a29a-173">Потребитель события должен записывать свою текущую позицию в постоянное хранилище с предопределенным интервалом.</span><span class="sxs-lookup"><span data-stu-id="4a29a-173">An event consumer should write its current position to persistent storage at some predefined interval.</span></span> <span data-ttu-id="4a29a-174">Таким образом, если работа потребителя приостановлена (например, происходит сбой потребителя или сбой узла), то новый экземпляр может возобновить чтение потока с последней записанной позиции.</span><span class="sxs-lookup"><span data-stu-id="4a29a-174">That way, if the consumer experiences a fault (for example, the consumer crashes, or the host fails), then a new instance can resume reading the stream from the last recorded position.</span></span> <span data-ttu-id="4a29a-175">См. дополнительные сведения о [потребителях событий](/azure/event-hubs/event-hubs-features#event-consumers).</span><span class="sxs-lookup"><span data-stu-id="4a29a-175">For more information, see [Event consumers](/azure/event-hubs/event-hubs-features#event-consumers).</span></span>

<span data-ttu-id="4a29a-176">**Обработка повторяющихся сообщений.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-176">**Handle duplicate messages.**</span></span> <span data-ttu-id="4a29a-177">При сбое потребителя события обработка сообщений возобновляется с последней записанной контрольной точки.</span><span class="sxs-lookup"><span data-stu-id="4a29a-177">If an event consumer fails, message processing is resumed from the last recorded checkpoint.</span></span> <span data-ttu-id="4a29a-178">Все сообщения, обработанные после последней контрольной точки, будут обработаны повторно.</span><span class="sxs-lookup"><span data-stu-id="4a29a-178">Any messages that were already processed after the last checkpoint will be processed again.</span></span> <span data-ttu-id="4a29a-179">Поэтому логика обработки сообщений должна быть идемпотентной. Или приложение должно уметь дедуплицировать сообщения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-179">Therefore, your message processing logic must be idempotent, or the application must be able to deduplicate messages.</span></span>

<span data-ttu-id="4a29a-180">**Обработка исключений.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-180">**Handle exceptions.**.</span></span> <span data-ttu-id="4a29a-181">Потребитель события обычно обрабатывает пакет сообщений в цикле.</span><span class="sxs-lookup"><span data-stu-id="4a29a-181">An event consumer typically processes a batch of messages in a loop.</span></span> <span data-ttu-id="4a29a-182">Вы должны обработать исключения в этом цикле обработки, чтобы избежать потери всего пакета сообщений, если одно сообщение приводит к возникновению исключения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-182">You should handle exceptions within this processing loop to avoid losing an entire batch of messages if a single message causes an exception.</span></span>

<span data-ttu-id="4a29a-183">**Использование недоставленных сообщений.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-183">**Use a dead-letter queue.**</span></span> <span data-ttu-id="4a29a-184">Если обработка сообщения приводит к временному сбою, поместите сообщение в очередь недоставленных сообщений, чтобы отслеживать состояние.</span><span class="sxs-lookup"><span data-stu-id="4a29a-184">If processing a message results in a non-transient failure, put the message onto a dead-letter queue, so that you can track the status.</span></span> <span data-ttu-id="4a29a-185">В зависимости от сценария можно повторно отправить сообщение позже, применить компенсирующую транзакцию или предпринять другое действие.</span><span class="sxs-lookup"><span data-stu-id="4a29a-185">Depending on the scenario, you might retry the message later, apply a compensating transaction, or take some other action.</span></span> <span data-ttu-id="4a29a-186">Обратите внимание, что в Центрах событий нет встроенной функции очереди недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4a29a-186">Note that Event Hubs does not have any built-in dead-letter queue functionality.</span></span> <span data-ttu-id="4a29a-187">Вместо этого можно использовать хранилище очередей Azure, служебную шину, Функции Azure или другой механизм обработки событий.</span><span class="sxs-lookup"><span data-stu-id="4a29a-187">You can use Azure Queue Storage or Service Bus to implement a dead-letter queue, or use Azure Functions or some other eventing mechanism.</span></span>

<span data-ttu-id="4a29a-188">**Реализация аварийного восстановления с помощью отработки отказа в дополнительное пространство имен Центров событий.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-188">**Implement disaster recovery by failing over to a secondary Event Hubs namespace.**</span></span> <span data-ttu-id="4a29a-189">Дополнительные сведения см. в статье [Географическое аварийное восстановление в Центрах событий Azure](/azure/event-hubs/event-hubs-geo-dr).</span><span class="sxs-lookup"><span data-stu-id="4a29a-189">For more information, see [Azure Event Hubs Geo-disaster recovery](/azure/event-hubs/event-hubs-geo-dr).</span></span>

## <a name="redis-cache"></a><span data-ttu-id="4a29a-190">кэш Redis;</span><span class="sxs-lookup"><span data-stu-id="4a29a-190">Redis Cache</span></span>

<span data-ttu-id="4a29a-191">**Настройка георепликации.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-191">**Configure Geo-replication**.</span></span> <span data-ttu-id="4a29a-192">Георепликация предоставляет механизм связывания двух экземпляров кэша Redis для Azure уровня "Премиум".</span><span class="sxs-lookup"><span data-stu-id="4a29a-192">Geo-replication provides a mechanism for linking two Premium tier Azure Redis Cache instances.</span></span> <span data-ttu-id="4a29a-193">Данные, записанные в основном кэше, реплицируются во вторичный кэш только для чтения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-193">Data written to the primary cache is replicated to a secondary read-only cache.</span></span> <span data-ttu-id="4a29a-194">Дополнительные сведения см. в статье [Как настроить георепликацию для кэша Redis для Azure](/azure/redis-cache/cache-how-to-geo-replication).</span><span class="sxs-lookup"><span data-stu-id="4a29a-194">For more information, see [How to configure Geo-replication for Azure Redis Cache](/azure/redis-cache/cache-how-to-geo-replication)</span></span>

<span data-ttu-id="4a29a-195">**Настройка сохраняемости данных.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-195">**Configure data persistence.**</span></span> <span data-ttu-id="4a29a-196">Постоянное хранение Redis позволяет постоянно хранить данные, размещенные в Redis.</span><span class="sxs-lookup"><span data-stu-id="4a29a-196">Redis persistence allows you to persist data stored in Redis.</span></span> <span data-ttu-id="4a29a-197">Также можно создавать моментальные снимки и архивировать данные, которые можно будет восстановить в случае сбоя оборудования.</span><span class="sxs-lookup"><span data-stu-id="4a29a-197">You can also take snapshots and back up the data, which you can load in case of a hardware failure.</span></span> <span data-ttu-id="4a29a-198">Дополнительные сведения см. в статье о [настройке постоянного хранения для кэша Redis для Azure категории "Премиум"](/azure/redis-cache/cache-how-to-premium-persistence).</span><span class="sxs-lookup"><span data-stu-id="4a29a-198">For more information, see [How to configure data persistence for a Premium Azure Redis Cache](/azure/redis-cache/cache-how-to-premium-persistence)</span></span>

<span data-ttu-id="4a29a-199">Если вы используете кэш Redis как временный кэш данных, а не постоянное хранилище, возможно, эти рекомендации будут неприменимы.</span><span class="sxs-lookup"><span data-stu-id="4a29a-199">If you are using Redis Cache as a temporary data cache and not as a persistent store, these recommendations may not apply.</span></span>

## <a name="search"></a><span data-ttu-id="4a29a-200">поиска</span><span class="sxs-lookup"><span data-stu-id="4a29a-200">Search</span></span>

<span data-ttu-id="4a29a-201">**Подготовьте несколько реплик.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-201">**Provision more than one replica.**</span></span> <span data-ttu-id="4a29a-202">Используйте как минимум две реплики, чтобы обеспечить высокую доступность операций чтения, или три, чтобы обеспечить высокую доступность операций чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="4a29a-202">Use at least two replicas for read high-availability, or three for read-write high-availability.</span></span>

<span data-ttu-id="4a29a-203">**Настройте индексаторы для развертываний в нескольких регионах.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-203">**Configure indexers for multi-region deployments.**</span></span> <span data-ttu-id="4a29a-204">Если имеется развертывание в нескольких регионах, рассмотрите варианты непрерывности индексирования.</span><span class="sxs-lookup"><span data-stu-id="4a29a-204">If you have a multi-region deployment, consider your options for continuity in indexing.</span></span>

- <span data-ttu-id="4a29a-205">Если источник данных геореплицируется, вы должны, как правило, указывать для каждого индексатора каждой региональной службы поиска Azure свою локальную реплику источника данных.</span><span class="sxs-lookup"><span data-stu-id="4a29a-205">If the data source is geo-replicated, you should generally point each indexer of each regional Azure Search service to its local data source replica.</span></span> <span data-ttu-id="4a29a-206">Однако мы не рекомендуем использовать этот подход для больших наборов данных, хранящихся в базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="4a29a-206">However, that approach is not recommended for large datasets stored in Azure SQL Database.</span></span> <span data-ttu-id="4a29a-207">Причина в том, что служба "Поиск Azure" не может выполнить добавочное индексирование из вторичных реплик базы данных SQL, а только из первичной реплики.</span><span class="sxs-lookup"><span data-stu-id="4a29a-207">The reason is that Azure Search cannot perform incremental indexing from secondary SQL Database replicas, only from primary replicas.</span></span> <span data-ttu-id="4a29a-208">Вместо этого укажите для всех индексаторов первичную реплику.</span><span class="sxs-lookup"><span data-stu-id="4a29a-208">Instead, point all indexers to the primary replica.</span></span> <span data-ttu-id="4a29a-209">После отработки отказа укажите для индексаторов службы "Поиск Azure" новую первичную реплику.</span><span class="sxs-lookup"><span data-stu-id="4a29a-209">After a failover, point the Azure Search indexers at the new primary replica.</span></span>

- <span data-ttu-id="4a29a-210">Если источник данных не геореплицируется, укажите для нескольких индексаторов один источник данных, чтобы службы Поиска Azure в нескольких регионах непрерывно и независимо индексировали источник данных.</span><span class="sxs-lookup"><span data-stu-id="4a29a-210">If the data source is not geo-replicated, point multiple indexers at the same data source, so that Azure Search services in multiple regions continuously and independently index from the data source.</span></span> <span data-ttu-id="4a29a-211">Дополнительные сведения см. в статье [Рекомендации по производительности и оптимизации Поиска Azure][search-optimization].</span><span class="sxs-lookup"><span data-stu-id="4a29a-211">For more information, see [Azure Search performance and optimization considerations][search-optimization].</span></span>

## <a name="service-bus"></a><span data-ttu-id="4a29a-212">Служебная шина Azure</span><span class="sxs-lookup"><span data-stu-id="4a29a-212">Service Bus</span></span>

<span data-ttu-id="4a29a-213">**Используйте уровень "премиум" для рабочих нагрузок**.</span><span class="sxs-lookup"><span data-stu-id="4a29a-213">**Use Premium tier for production workloads**.</span></span> <span data-ttu-id="4a29a-214">[Премиум-сообщения служебной шины Azure](/azure/service-bus-messaging/service-bus-premium-messaging) предоставляют выделенные и зарезервированные вычислительные ресурсы и объем памяти для поддержки прогнозируемой производительности и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="4a29a-214">[Service Bus Premium Messaging](/azure/service-bus-messaging/service-bus-premium-messaging) provides dedicated and reserved processing resources, and memory capacity to support predictable performance and throughput.</span></span> <span data-ttu-id="4a29a-215">Они также предоставляют доступ к новым функциям, доступным только для премиум-клиентов.</span><span class="sxs-lookup"><span data-stu-id="4a29a-215">Premium Messaging tier also gives you access to new features that are available only to premium customers at first.</span></span> <span data-ttu-id="4a29a-216">Вы можете определить количество сообщений на основе ожидаемых рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="4a29a-216">You can decide the number of messaging units based on expected workloads.</span></span>

<span data-ttu-id="4a29a-217">**Обработка повторяющихся сообщений**.</span><span class="sxs-lookup"><span data-stu-id="4a29a-217">**Handle duplicate messages**.</span></span> <span data-ttu-id="4a29a-218">Если издатель перестает работать сразу после отправки сообщения или при неполадках в сети или системе, он может ошибочно не записать, что сообщение было доставлено, и может отправить одно и то же сообщение в систему дважды.</span><span class="sxs-lookup"><span data-stu-id="4a29a-218">If a publisher fails immediately after sending a message, or experiences network or system issues, it may erroneously fail to record that the message was delivered, and may send the same message to the system twice.</span></span> <span data-ttu-id="4a29a-219">Служебная шина Azure может решить эту проблему, включив обнаружение повторяющихся сообщений.</span><span class="sxs-lookup"><span data-stu-id="4a29a-219">Service Bus can handle this issue by enabling duplicate detection.</span></span> <span data-ttu-id="4a29a-220">Дополнительные сведения см. в разделе [Синхронизация удостоверений и устойчивость обнаружения](/azure/service-bus-messaging/duplicate-detection).</span><span class="sxs-lookup"><span data-stu-id="4a29a-220">For more information, see [Duplicate detection](/azure/service-bus-messaging/duplicate-detection).</span></span>

<span data-ttu-id="4a29a-221">**Обработка исключений**.</span><span class="sxs-lookup"><span data-stu-id="4a29a-221">**Handle exceptions**.</span></span> <span data-ttu-id="4a29a-222">API обмена сообщениями генерирует исключения, когда возникает ошибка пользователя, настройки или другая ошибка.</span><span class="sxs-lookup"><span data-stu-id="4a29a-222">Messaging APIs generate exceptions when a user error, configuration error, or other error occurs.</span></span> <span data-ttu-id="4a29a-223">Код клиента (отправителя и получателя) должен обрабатывать эти исключения в своем коде.</span><span class="sxs-lookup"><span data-stu-id="4a29a-223">The client code (senders and receivers) should handle these exceptions in their code.</span></span> <span data-ttu-id="4a29a-224">Это особенно важно в использовании пакетной обработки во избежании потери целой партии сообщений.</span><span class="sxs-lookup"><span data-stu-id="4a29a-224">This is especially important in batch processing, where exception handling can be used to avoid losing an entire batch of messages.</span></span> <span data-ttu-id="4a29a-225">Дополнительные сведения см. в статье [Исключения обмена сообщениями служебной шины](/azure/service-bus-messaging/service-bus-messaging-exceptions).</span><span class="sxs-lookup"><span data-stu-id="4a29a-225">For more information, see [Service Bus messaging exceptions](/azure/service-bus-messaging/service-bus-messaging-exceptions).</span></span>

<span data-ttu-id="4a29a-226">**Политика повтора**</span><span class="sxs-lookup"><span data-stu-id="4a29a-226">**Retry policy**.</span></span> <span data-ttu-id="4a29a-227">Служебная шина позволяет выбрать наилучшую политику повтора для ваших приложений.</span><span class="sxs-lookup"><span data-stu-id="4a29a-227">Service Bus allows you to pick the best retry policy for your applications.</span></span> <span data-ttu-id="4a29a-228">Политика по умолчанию разрешает максимально 9 повторных попыток с ожиданием 30 секунд, но это можно настраивать дополнительно.</span><span class="sxs-lookup"><span data-stu-id="4a29a-228">The default policy is to allow 9 maximum retry attempts, and wait for 30 seconds but this can be further adjusted.</span></span> <span data-ttu-id="4a29a-229">Дополнительные сведения см. на странице [Политика повтора — служебная шина](/azure/architecture/best-practices/retry-service-specific#service-bus).</span><span class="sxs-lookup"><span data-stu-id="4a29a-229">For more information, see [Retry policy – Service Bus](/azure/architecture/best-practices/retry-service-specific#service-bus).</span></span>

<span data-ttu-id="4a29a-230">**Использование недоставленных сообщений**.</span><span class="sxs-lookup"><span data-stu-id="4a29a-230">**Use a dead-letter queue**.</span></span> <span data-ttu-id="4a29a-231">Если сообщение не может быть обработано или доставлено любому получателю после нескольких попыток, оно перемещается в очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4a29a-231">If a message cannot be processed or delivered to any receiver after multiple retries, it is moved to a dead letter queue.</span></span> <span data-ttu-id="4a29a-232">Внедрите процесс чтения сообщений из очереди недоставленных сообщений, проверьте их и устраните проблему.</span><span class="sxs-lookup"><span data-stu-id="4a29a-232">Implement a process to read messages from the dead letter queue, inspect them, and remediate the problem.</span></span> <span data-ttu-id="4a29a-233">В зависимости от сценария вы можете повторить сообщение как есть, внести изменения и повторить попытку отправки или отказаться от него.</span><span class="sxs-lookup"><span data-stu-id="4a29a-233">Depending on the scenario, you might retry the message as-is, make changes and retry, or discard the message.</span></span> <span data-ttu-id="4a29a-234">Дополнительные сведения см. в статье [Обзор очередей недоставленных сообщений служебной шины](/azure/service-bus-messaging/service-bus-dead-letter-queues).</span><span class="sxs-lookup"><span data-stu-id="4a29a-234">For more information, see [Overview of Service Bus dead-letter queues](/azure/service-bus-messaging/service-bus-dead-letter-queues).</span></span>

<span data-ttu-id="4a29a-235">**Используйте геоизбыточное аварийное восстановление**.</span><span class="sxs-lookup"><span data-stu-id="4a29a-235">**Use Geo-Disaster Recovery**.</span></span> <span data-ttu-id="4a29a-236">Географическое аварийное восстановление гарантирует, что обработка данных будет продолжать работать в другом регионе или центре обработки данных, если весь регион или центр данных Azure станет недоступным из-за стихийного бедствия.</span><span class="sxs-lookup"><span data-stu-id="4a29a-236">Geo-disaster recovery ensures that data processing continues to operate in a different region or datacenter if an entire Azure region or datacenter becomes unavailable due to a disaster.</span></span> <span data-ttu-id="4a29a-237">Дополнительные сведения см. в разделе [Географическое аварийное восстановление в служебной шине Azure](/azure/service-bus-messaging/service-bus-geo-dr).</span><span class="sxs-lookup"><span data-stu-id="4a29a-237">For more information, see [Azure Service Bus Geo-disaster recovery](/azure/service-bus-messaging/service-bus-geo-dr).</span></span>

## <a name="storage"></a><span data-ttu-id="4a29a-238">Хранилище</span><span class="sxs-lookup"><span data-stu-id="4a29a-238">Storage</span></span>

<span data-ttu-id="4a29a-239">Используйте **геоизбыточное хранилище с доступом для чтения** для данных приложения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-239">**For application data, use read-access geo-redundant storage (RA-GRS).**</span></span> <span data-ttu-id="4a29a-240">Хранилище RA-GRS реплицирует данные в дополнительный регион и предоставляет доступ только для чтения из вторичного региона.</span><span class="sxs-lookup"><span data-stu-id="4a29a-240">RA-GRS storage replicates the data to a secondary region, and provides read-only access from the secondary region.</span></span> <span data-ttu-id="4a29a-241">При наличии доступа к хранилищу в первичном регионе приложение может считывать данные из вторичного региона.</span><span class="sxs-lookup"><span data-stu-id="4a29a-241">If there is a storage outage in the primary region, the application can read the data from the secondary region.</span></span> <span data-ttu-id="4a29a-242">Дополнительные сведения см. в статье [Репликация службы хранилища Azure](/azure/storage/storage-redundancy/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-242">For more information, see [Azure Storage replication](/azure/storage/storage-redundancy/).</span></span>

<span data-ttu-id="4a29a-243">**Используйте управляемые диски в качестве дисков виртуальных машин.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-243">**For VM disks, use Managed Disks.**</span></span> <span data-ttu-id="4a29a-244">Служба [Управляемые диски][managed-disks] обеспечивает более высокую надежность виртуальных машин в группах доступности, так как диски достаточно изолированы друг от друга, что позволяет избежать единой точки отказа.</span><span class="sxs-lookup"><span data-stu-id="4a29a-244">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="4a29a-245">Кроме того, управляемые диски не подпадают под ограничения операций ввода-вывода в секунду для виртуальных жестких дисков (VHD), созданных в учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-245">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="4a29a-246">Дополнительные сведения см. в статье [Управление доступностью виртуальных машин Windows в Azure][vm-manage-availability].</span><span class="sxs-lookup"><span data-stu-id="4a29a-246">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>

<span data-ttu-id="4a29a-247">**Создайте резервную очередь в другом регионе, чтобы создать хранилище очередей.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-247">**For Queue storage, create a backup queue in another region.**</span></span> <span data-ttu-id="4a29a-248">Для хранилища очередей реплика, предназначенная только для чтения, ограничена в использовании, так как вы не можете ставить элементы в очередь или удалять их из нее.</span><span class="sxs-lookup"><span data-stu-id="4a29a-248">For Queue storage, a read-only replica has limited use, because you can't queue or dequeue items.</span></span> <span data-ttu-id="4a29a-249">Вместо этого создайте резервную очередь в учетной записи хранения в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="4a29a-249">Instead, create a backup queue in a storage account in another region.</span></span> <span data-ttu-id="4a29a-250">При отказе хранилища приложение может использовать резервную очередь, пока основной регион снова не станет доступен.</span><span class="sxs-lookup"><span data-stu-id="4a29a-250">If there is a storage outage, the application can use the backup queue, until the primary region becomes available again.</span></span> <span data-ttu-id="4a29a-251">Таким образом приложение может обрабатывать новые запросы.</span><span class="sxs-lookup"><span data-stu-id="4a29a-251">That way, the application can still process new requests.</span></span>

## <a name="sql-database"></a><span data-ttu-id="4a29a-252">База данных SQL</span><span class="sxs-lookup"><span data-stu-id="4a29a-252">SQL Database</span></span>

<span data-ttu-id="4a29a-253">**Уровень "Стандартный" или "Премиум".**</span><span class="sxs-lookup"><span data-stu-id="4a29a-253">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="4a29a-254">Эти уровни обеспечивают более длительный период восстановления на определенный момент времени (35 дней).</span><span class="sxs-lookup"><span data-stu-id="4a29a-254">These tiers provide a longer point-in-time restore period (35 days).</span></span> <span data-ttu-id="4a29a-255">Дополнительные сведения см. в статье [Что такое уровни служб Базы данных SQL](/azure/sql-database/sql-database-service-tiers/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-255">For more information, see [SQL Database options and performance](/azure/sql-database/sql-database-service-tiers/).</span></span>

<span data-ttu-id="4a29a-256">**Включите аудит базы данных SQL.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-256">**Enable SQL Database auditing.**</span></span> <span data-ttu-id="4a29a-257">Аудит может использоваться для диагностики вредоносных атак или ошибки из-за человеческого фактора.</span><span class="sxs-lookup"><span data-stu-id="4a29a-257">Auditing can be used to diagnose malicious attacks or human error.</span></span> <span data-ttu-id="4a29a-258">Дополнительные сведения см. в статье [Приступая к работе с аудитом базы данных SQL](/azure/sql-database/sql-database-auditing-get-started/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-258">For more information, see [Get started with SQL database auditing](/azure/sql-database/sql-database-auditing-get-started/).</span></span>

<span data-ttu-id="4a29a-259">Используйте **активную георепликацию**, чтобы создать доступную для чтения вторичную реплику в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="4a29a-259">**Use Active Geo-Replication** Use Active Geo-Replication to create a readable secondary in a different region.</span></span>  <span data-ttu-id="4a29a-260">Если произойдет сбой вашей базы данных-источника (или вам просто потребуется перевести ее в автономный режим), выполните отработку отказа в ручном режиме в любую базу данных-получатель.</span><span class="sxs-lookup"><span data-stu-id="4a29a-260">If your primary database fails, or simply needs to be taken offline, perform a manual failover to the secondary database.</span></span>  <span data-ttu-id="4a29a-261">До отработки отказа база данных-получатель остается доступной только для чтения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-261">Until you fail over, the secondary database remains read-only.</span></span>  <span data-ttu-id="4a29a-262">Дополнительные сведения см. в статье [Обзор. Группы отработки отказа и активная георепликация](/azure/sql-database/sql-database-geo-replication-overview/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-262">For more information, see [SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/).</span></span>

<span data-ttu-id="4a29a-263">**Используйте сегментирование.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-263">**Use sharding.**</span></span> <span data-ttu-id="4a29a-264">Рассмотрите возможность использования сегментирования для горизонтального секционирования базы данных.</span><span class="sxs-lookup"><span data-stu-id="4a29a-264">Consider using sharding to partition the database horizontally.</span></span> <span data-ttu-id="4a29a-265">Сегментирование может обеспечить изоляцию от сбоев.</span><span class="sxs-lookup"><span data-stu-id="4a29a-265">Sharding can provide fault isolation.</span></span> <span data-ttu-id="4a29a-266">Дополнительные сведения см. в статье [Развертывание с помощью Базы данных SQL Azure](/azure/sql-database/sql-database-elastic-scale-introduction/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-266">For more information, see [Scaling out with Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction/).</span></span>

<span data-ttu-id="4a29a-267">**Используйте восстановление до точки во времени для восстановления после ошибки пользователя.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-267">**Use point-in-time restore to recover from human error.**</span></span>  <span data-ttu-id="4a29a-268">При восстановлении до точки во времени база данных возвращается в состояние на более ранний момент времени.</span><span class="sxs-lookup"><span data-stu-id="4a29a-268">Point-in-time restore returns your database to an earlier point in time.</span></span> <span data-ttu-id="4a29a-269">Дополнительные сведения см. в статье [Восстановление базы данных Azure SQL с помощью создаваемых автоматически резервных копий][sql-restore].</span><span class="sxs-lookup"><span data-stu-id="4a29a-269">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

<span data-ttu-id="4a29a-270">**Используйте геовосстановление для восстановления после сбоя службы.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-270">**Use geo-restore to recover from a service outage.**</span></span> <span data-ttu-id="4a29a-271">При геовосстановлении база данных восстанавливается из геоизбыточной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="4a29a-271">Geo-restore restores a database from a geo-redundant backup.</span></span>  <span data-ttu-id="4a29a-272">Дополнительные сведения см. в статье [Восстановление базы данных Azure SQL с помощью создаваемых автоматически резервных копий][sql-restore].</span><span class="sxs-lookup"><span data-stu-id="4a29a-272">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

## <a name="sql-data-warehouse"></a><span data-ttu-id="4a29a-273">Хранилище данных SQL</span><span class="sxs-lookup"><span data-stu-id="4a29a-273">SQL Data Warehouse</span></span>

<span data-ttu-id="4a29a-274">**Не отключайте геоизбыточное резервное копирование.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-274">**Do not disable geo-backup.**</span></span> <span data-ttu-id="4a29a-275">По умолчанию в Хранилище данных SQL каждые 24 часа выполняется полное резервное копирование данных для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="4a29a-275">By default, SQL Data Warehouse takes a full backup of your data every 24 hours for disaster recovery.</span></span> <span data-ttu-id="4a29a-276">Не рекомендуется отключать эту функцию.</span><span class="sxs-lookup"><span data-stu-id="4a29a-276">It is not recommended to turn this feature off.</span></span> <span data-ttu-id="4a29a-277">Дополнительные сведения см. в разделе о [геоизбыточных резервных копиях](/azure/sql-data-warehouse/backup-and-restore#geo-backups).</span><span class="sxs-lookup"><span data-stu-id="4a29a-277">For more information, see [Geo-backups](/azure/sql-data-warehouse/backup-and-restore#geo-backups).</span></span>

## <a name="sql-server-running-in-a-vm"></a><span data-ttu-id="4a29a-278">SQL Server на виртуальной машине</span><span class="sxs-lookup"><span data-stu-id="4a29a-278">SQL Server running in a VM</span></span>

<span data-ttu-id="4a29a-279">**Реплицируйте базу данных.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-279">**Replicate the database.**</span></span> <span data-ttu-id="4a29a-280">Используйте группы доступности Always On SQL Server для репликации базы данных.</span><span class="sxs-lookup"><span data-stu-id="4a29a-280">Use SQL Server Always On Availability Groups to replicate the database.</span></span> <span data-ttu-id="4a29a-281">При сбое в одном экземпляре SQL Server они обеспечивают высокий уровень доступности.</span><span class="sxs-lookup"><span data-stu-id="4a29a-281">Provides high availability if one SQL Server instance fails.</span></span> <span data-ttu-id="4a29a-282">Дополнительные сведения см. в статье [Запуск виртуальных машин Windows для n-уровневого приложения](../reference-architectures/virtual-machines-windows/n-tier.md).</span><span class="sxs-lookup"><span data-stu-id="4a29a-282">For more information, see [Run Windows VMs for an N-tier application](../reference-architectures/virtual-machines-windows/n-tier.md)</span></span>

<span data-ttu-id="4a29a-283">**Архивируйте базу данных.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-283">**Back up the database**.</span></span> <span data-ttu-id="4a29a-284">Если вы уже используете службу [Azure Backup](/azure/backup/) для архивации виртуальных машин, рассмотрите возможность ее использования [для рабочих нагрузок SQL Server с помощью DPM](/azure/backup/backup-azure-backup-sql/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-284">If you are already using [Azure Backup](/azure/backup/) to back up your VMs, consider using [Azure Backup for SQL Server workloads using DPM](/azure/backup/backup-azure-backup-sql/).</span></span> <span data-ttu-id="4a29a-285">При таком подходе используется одна роль администратора архивации для организации и единая процедура восстановления для виртуальных машин и SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4a29a-285">With this approach, there is one backup administrator role for the organization and a unified recovery procedure for VMs and SQL Server.</span></span> <span data-ttu-id="4a29a-286">В противном случае используйте [управляемое резервное копирование SQL Server в Microsoft Azure](https://msdn.microsoft.com/library/dn449496.aspx).</span><span class="sxs-lookup"><span data-stu-id="4a29a-286">Otherwise, use [SQL Server Managed Backup to Microsoft Azure](https://msdn.microsoft.com/library/dn449496.aspx).</span></span>

## <a name="traffic-manager"></a><span data-ttu-id="4a29a-287">Диспетчер трафика</span><span class="sxs-lookup"><span data-stu-id="4a29a-287">Traffic Manager</span></span>

<span data-ttu-id="4a29a-288">**Выполняйте восстановление размещения вручную.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-288">**Perform manual failback.**</span></span> <span data-ttu-id="4a29a-289">После отработки отказа диспетчера трафика выполните восстановление размещения вручную, а не автоматически.</span><span class="sxs-lookup"><span data-stu-id="4a29a-289">After a Traffic Manager failover, perform manual failback, rather than automatically failing back.</span></span> <span data-ttu-id="4a29a-290">Убедитесь, что все подсистемы приложения полностью работоспособны, и лишь затем выполните восстановление размещения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-290">Before failing back, verify that all application subsystems are healthy.</span></span>  <span data-ttu-id="4a29a-291">В противном случае могут возникнуть ситуации, в которых приложение будет переходить между центрами обработки данных.</span><span class="sxs-lookup"><span data-stu-id="4a29a-291">Otherwise, you can create a situation where the application flips back and forth between data centers.</span></span> <span data-ttu-id="4a29a-292">Дополнительные сведения см. в статье [Запуск виртуальных машин Windows в нескольких регионах для обеспечения высокой доступности](../reference-architectures/virtual-machines-windows/multi-region-application.md).</span><span class="sxs-lookup"><span data-stu-id="4a29a-292">For more information, see [Run VMs in multiple regions for high availability](../reference-architectures/virtual-machines-windows/multi-region-application.md).</span></span>

<span data-ttu-id="4a29a-293">**Создайте конечную точку проверки работоспособности.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-293">**Create a health probe endpoint.**</span></span> <span data-ttu-id="4a29a-294">Создайте пользовательскую конечную точку, которая сообщает об общей работоспособности приложения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-294">Create a custom endpoint that reports on the overall health of the application.</span></span> <span data-ttu-id="4a29a-295">Это позволяет диспетчеру трафика выполнить отработку отказа при сбое любого критического пути, а не только внешнего интерфейса.</span><span class="sxs-lookup"><span data-stu-id="4a29a-295">This enables Traffic Manager to fail over if any critical path fails, not just the front end.</span></span> <span data-ttu-id="4a29a-296">Конечная точка должна возвращать код ошибки HTTP, если какая-либо критическая зависимость неработоспособна или недоступна.</span><span class="sxs-lookup"><span data-stu-id="4a29a-296">The endpoint should return an HTTP error code if any critical dependency is unhealthy or unreachable.</span></span> <span data-ttu-id="4a29a-297">Однако не сообщайте об ошибках некритических служб.</span><span class="sxs-lookup"><span data-stu-id="4a29a-297">Don't report errors for non-critical services, however.</span></span> <span data-ttu-id="4a29a-298">В противном случае проверка работоспособности может вызвать ненужную отработку отказа, создавая ложные срабатывания.</span><span class="sxs-lookup"><span data-stu-id="4a29a-298">Otherwise, the health probe might trigger failover when it's not needed, creating false positives.</span></span> <span data-ttu-id="4a29a-299">Дополнительные сведения см. в статье [Мониторинг конечных точек в диспетчере трафика](/azure/traffic-manager/traffic-manager-monitoring/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-299">For more information, see [Traffic Manager endpoint monitoring and failover](/azure/traffic-manager/traffic-manager-monitoring/).</span></span>

## <a name="virtual-machines"></a><span data-ttu-id="4a29a-300">Виртуальные машины</span><span class="sxs-lookup"><span data-stu-id="4a29a-300">Virtual Machines</span></span>

<span data-ttu-id="4a29a-301">**Не выполняйте рабочую нагрузку на одной виртуальной машине.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-301">**Avoid running a production workload on a single VM.**</span></span> <span data-ttu-id="4a29a-302">Одно развертывание виртуальной машины неустойчиво при плановом или внеплановом обслуживании.</span><span class="sxs-lookup"><span data-stu-id="4a29a-302">A single VM deployment is not resilient to planned or unplanned maintenance.</span></span> <span data-ttu-id="4a29a-303">Вместо этого поместите несколько виртуальных машин в группу доступности или [масштабируемый набор виртуальных машин](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/) перед подсистемой балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4a29a-303">Instead, put multiple VMs in an availability set or [VM scale set](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/), with a load balancer in front.</span></span>

<span data-ttu-id="4a29a-304">**Укажите группу доступности при подготовке виртуальной машины.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-304">**Specify an availability set when you provision the VM.**</span></span> <span data-ttu-id="4a29a-305">В настоящее время после подготовки виртуальную машину невозможно добавить в группу доступности.</span><span class="sxs-lookup"><span data-stu-id="4a29a-305">Currently, there is no way to add a VM to an availability set after the VM is provisioned.</span></span> <span data-ttu-id="4a29a-306">Добавляя новую виртуальную машину в имеющуюся группу доступности, обязательно создайте сетевую карту для виртуальной машины и добавьте ее в серверный пул адресов в подсистеме балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4a29a-306">When you add a new VM to an existing availability set, make sure to create a NIC for the VM, and add the NIC to the back-end address pool on the load balancer.</span></span> <span data-ttu-id="4a29a-307">В противном случае подсистема балансировки нагрузки не будет маршрутизировать сетевой трафик на эту виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="4a29a-307">Otherwise, the load balancer won't route network traffic to that VM.</span></span>

<span data-ttu-id="4a29a-308">**Поместите каждый уровень приложения в отдельных группах доступности.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-308">**Put each application tier into a separate Availability Set.**</span></span> <span data-ttu-id="4a29a-309">В n-уровневом приложении не следует размещать виртуальные машины из разных уровней в одной группе доступности.</span><span class="sxs-lookup"><span data-stu-id="4a29a-309">In an N-tier application, don't put VMs from different tiers into the same availability set.</span></span> <span data-ttu-id="4a29a-310">Виртуальные машины в группе доступности располагаются в доменах сбоя и доменах обновления.</span><span class="sxs-lookup"><span data-stu-id="4a29a-310">VMs in an availability set are placed across fault domains (FDs) and update domains (UD).</span></span> <span data-ttu-id="4a29a-311">Тем не менее, чтобы получить преимущества избыточности этих доменов, каждая виртуальная машина в группе доступности должна иметь возможность обрабатывать одни и те же клиентские запросы.</span><span class="sxs-lookup"><span data-stu-id="4a29a-311">However, to get the redundancy benefit of FDs and UDs, every VM in the availability set must be able to handle the same client requests.</span></span>

<span data-ttu-id="4a29a-312">**Репликация виртуальных машин с помощью Site Recovery.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-312">**Replicate VMs using Azure Site Recovery.**</span></span> <span data-ttu-id="4a29a-313">При репликации виртуальных машин Azure с помощью [Site Recovery][site-recovery] все диски виртуальных машин непрерывно и асинхронно реплицируются в целевой регион.</span><span class="sxs-lookup"><span data-stu-id="4a29a-313">When you replicate Azure VMs using [Site Recovery][site-recovery], all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="4a29a-314">Точки восстановления создаются каждые несколько минут.</span><span class="sxs-lookup"><span data-stu-id="4a29a-314">The recovery points are created every few minutes.</span></span> <span data-ttu-id="4a29a-315">Это обеспечивает требуемую целевую точку восстановления (RPO) в минутах.</span><span class="sxs-lookup"><span data-stu-id="4a29a-315">This gives you a Recovery Point Objective (RPO) in the order of minutes.</span></span> <span data-ttu-id="4a29a-316">Можно выполнять аварийное восстановление столько раз, сколько требуется. Это не повлияет на рабочее приложение или текущую репликацию.</span><span class="sxs-lookup"><span data-stu-id="4a29a-316">You can conduct disaster recovery drills as many times as you want, without impacting the production application or the ongoing replication.</span></span> <span data-ttu-id="4a29a-317">См. дополнительные сведения об [отработке аварийного восстановления в Azure][site-recovery-test].</span><span class="sxs-lookup"><span data-stu-id="4a29a-317">For more information, see [Run a disaster recovery drill to Azure][site-recovery-test].</span></span>

<span data-ttu-id="4a29a-318">**Выберите подходящий размер виртуальной машины в соответствии с требованиями к производительности.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-318">**Choose the right VM size based on performance requirements.**</span></span> <span data-ttu-id="4a29a-319">При перемещении имеющейся рабочей нагрузки в Azure выберите начальный размер виртуальной машины, который больше всего соответствует вашим локальным серверам.</span><span class="sxs-lookup"><span data-stu-id="4a29a-319">When moving an existing workload to Azure, start with the VM size that's the closest match to your on-premises servers.</span></span> <span data-ttu-id="4a29a-320">Затем измерьте производительность фактической рабочей нагрузки по таким ресурсам, как потребление ЦП, памяти и дисковых операций ввода-вывода в секунду, и при необходимости измените размер виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="4a29a-320">Then measure the performance of your actual workload with respect to CPU, memory, and disk IOPS, and adjust the size if needed.</span></span> <span data-ttu-id="4a29a-321">Это гарантирует, что приложение будет правильно работать в облачной среде.</span><span class="sxs-lookup"><span data-stu-id="4a29a-321">This helps to ensure the application behaves as expected in a cloud environment.</span></span> <span data-ttu-id="4a29a-322">Кроме того, если требуется использовать несколько сетевых карт, то учтите ограничения на количество сетевых карт для каждого размера.</span><span class="sxs-lookup"><span data-stu-id="4a29a-322">Also, if you need multiple NICs, be aware of the NIC limit for each size.</span></span>

<span data-ttu-id="4a29a-323">**Используйте управляемые диски для VHD.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-323">**Use Managed Disks for VHDs.**</span></span> <span data-ttu-id="4a29a-324">Служба [Управляемые диски][managed-disks] обеспечивает более высокую надежность виртуальных машин в группах доступности, так как диски достаточно изолированы друг от друга, что позволяет избежать единой точки отказа.</span><span class="sxs-lookup"><span data-stu-id="4a29a-324">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="4a29a-325">Кроме того, управляемые диски не подпадают под ограничения операций ввода-вывода в секунду для виртуальных жестких дисков (VHD), созданных в учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="4a29a-325">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="4a29a-326">Дополнительные сведения см. в статье [Управление доступностью виртуальных машин Windows в Azure][vm-manage-availability].</span><span class="sxs-lookup"><span data-stu-id="4a29a-326">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>

<span data-ttu-id="4a29a-327">**Устанавливайте приложения на диск данных, а не на диск операционной системы.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-327">**Install applications on a data disk, not the OS disk.**</span></span> <span data-ttu-id="4a29a-328">В противном случае можно превысить предельный размер диска.</span><span class="sxs-lookup"><span data-stu-id="4a29a-328">Otherwise, you may reach the disk size limit.</span></span>

<span data-ttu-id="4a29a-329">**Используйте службу Azure Backup для архивации виртуальных машин.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-329">**Use Azure Backup to back up VMs.**</span></span> <span data-ttu-id="4a29a-330">Резервные копии позволяют обеспечить защиту от случайной потери данных.</span><span class="sxs-lookup"><span data-stu-id="4a29a-330">Backups protect against accidental data loss.</span></span> <span data-ttu-id="4a29a-331">Дополнительные сведения см. в статье [Архивация виртуальных машин Azure в хранилище служб восстановления](/azure/backup/backup-azure-vms-first-look-arm/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-331">For more information, see [Protect Azure VMs with a recovery services vault](/azure/backup/backup-azure-vms-first-look-arm/).</span></span>

<span data-ttu-id="4a29a-332">**Включите журналы диагностики**, в том числе базовые метрики работоспособности, а также ведение журналов инфраструктуры и [диагностику загрузки][boot-diagnostics].</span><span class="sxs-lookup"><span data-stu-id="4a29a-332">**Enable diagnostic logs**, including basic health metrics, infrastructure logs, and [boot diagnostics][boot-diagnostics].</span></span> <span data-ttu-id="4a29a-333">Если виртуальную машину невозможно загрузить, для обнаружения неисправностей можно использовать диагностику загрузки.</span><span class="sxs-lookup"><span data-stu-id="4a29a-333">Boot diagnostics can help you diagnose a boot failure if your VM gets into a non-bootable state.</span></span> <span data-ttu-id="4a29a-334">Дополнительные сведения см. в статье [Сбор и использование данных журнала из ресурсов Azure][diagnostics-logs].</span><span class="sxs-lookup"><span data-stu-id="4a29a-334">For more information, see [Overview of Azure Diagnostic Logs][diagnostics-logs].</span></span>

<span data-ttu-id="4a29a-335">**Используйте расширение AzureLogCollector.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-335">**Use the AzureLogCollector extension.**</span></span> <span data-ttu-id="4a29a-336">(Только для виртуальных машин Windows.) Это расширение объединяет журналы платформы Azure и загружает их в службу хранилища Azure без необходимости удаленного входа оператора в виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="4a29a-336">(Windows VMs only.) This extension aggregates Azure platform logs and uploads them to Azure storage, without the operator remotely logging into the VM.</span></span> <span data-ttu-id="4a29a-337">Дополнительные сведения см. в статье [Расширение AzureLogCollector](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="4a29a-337">For more information, see [AzureLogCollector Extension](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

## <a name="virtual-network"></a><span data-ttu-id="4a29a-338">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="4a29a-338">Virtual Network</span></span>

<span data-ttu-id="4a29a-339">**Чтобы поместить общедоступные IP-адреса в список разрешений или заблокировать их, добавьте NSG в подсеть.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-339">**To whitelist or block public IP addresses, add an NSG to the subnet.**</span></span> <span data-ttu-id="4a29a-340">Блокируйте доступ злоумышленников или разрешите доступ только для пользователей с привилегиями для доступа к приложению.</span><span class="sxs-lookup"><span data-stu-id="4a29a-340">Block access from malicious users, or allow access only from users who have privilege to access the application.</span></span>

<span data-ttu-id="4a29a-341">**Создайте пользовательскую проверку работоспособности.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-341">**Create a custom health probe.**</span></span> <span data-ttu-id="4a29a-342">При проверке работоспособности Load Balancer может тестироваться HTTP или TCP.</span><span class="sxs-lookup"><span data-stu-id="4a29a-342">Load Balancer Health Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="4a29a-343">Если виртуальная машина работает на HTTP-сервере, проверка HTTP поможет лучше определить состояние работоспособности, чем проверка TCP.</span><span class="sxs-lookup"><span data-stu-id="4a29a-343">If a VM runs an HTTP server, the HTTP probe is a better indicator of health status than a TCP probe.</span></span> <span data-ttu-id="4a29a-344">Для проверки HTTP используйте настраиваемую конечную точку, которая сообщает об общей работоспособности приложения, включая все критические зависимости.</span><span class="sxs-lookup"><span data-stu-id="4a29a-344">For an HTTP probe, use a custom endpoint that reports the overall health of the application, including all critical dependencies.</span></span> <span data-ttu-id="4a29a-345">Дополнительные сведения см. в разделе [Обзор Azure Load Balancer](/azure/load-balancer/load-balancer-overview/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-345">For more information, see [Azure Load Balancer overview](/azure/load-balancer/load-balancer-overview/).</span></span>

<span data-ttu-id="4a29a-346">**Не блокируйте проверку работоспособности.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-346">**Don't block the health probe.**</span></span> <span data-ttu-id="4a29a-347">Проверка работоспособности Load Balancer отправляется с известного IP-адреса — 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="4a29a-347">The Load Balancer Health probe is sent from a known IP address, 168.63.129.16.</span></span> <span data-ttu-id="4a29a-348">Не блокируйте входящий и исходящий трафик для этого IP-адреса в каких-либо политиках брандмауэра или правилах группы безопасности сети (NSG).</span><span class="sxs-lookup"><span data-stu-id="4a29a-348">Don't block traffic to or from this IP in any firewall policies or network security group (NSG) rules.</span></span> <span data-ttu-id="4a29a-349">При блокировании проверки работоспособности подсистема балансировки нагрузки удаляет виртуальную машину из ротации.</span><span class="sxs-lookup"><span data-stu-id="4a29a-349">Blocking the health probe would cause the load balancer to remove the VM from rotation.</span></span>

<span data-ttu-id="4a29a-350">**Включите ведение журнала для Load Balancer.**</span><span class="sxs-lookup"><span data-stu-id="4a29a-350">**Enable Load Balancer logging.**</span></span> <span data-ttu-id="4a29a-351">В журналах показано, сколько виртуальных машин на серверной стороне не получают сетевой трафик из-за неудачных ответов проверки.</span><span class="sxs-lookup"><span data-stu-id="4a29a-351">The logs show how many VMs on the back-end are not receiving network traffic due to failed probe responses.</span></span> <span data-ttu-id="4a29a-352">Дополнительные сведения см. в статье [Служба анализа журналов для Azure Load Balancer](/azure/load-balancer/load-balancer-monitor-log/).</span><span class="sxs-lookup"><span data-stu-id="4a29a-352">For more information, see [Log analytics for Azure Load Balancer](/azure/load-balancer/load-balancer-monitor-log/).</span></span>

<!-- links -->
[boot-diagnostics]: https://azure.microsoft.com/blog/boot-diagnostics-for-virtual-machines-v2/
[diagnostics-logs]: /azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs/
[managed-disks]: /azure/storage/storage-managed-disks-overview
[search-optimization]: /azure/search/search-performance-optimization/
[site-recovery]: /azure/site-recovery/
[site-recovery-test]: /azure/site-recovery/site-recovery-test-failover-to-azure
[sql-backup]: /azure/sql-database/sql-database-automated-backups/
[sql-restore]: /azure/sql-database/sql-database-recovery-using-backups/
[vm-manage-availability]: /azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set
