---
title: Контрольный список для обеспечения отказоустойчивости
description: Контрольный список с рекомендациями по вопросам обеспечения отказоустойчивости, возникающим во время проектирования.
author: petertaylor9999
ms.date: 01/10/2018
ms.custom: resiliency, checklist
ms.openlocfilehash: ce538a0b234a5b120415980e983096f567f9cf86
ms.sourcegitcommit: 1b5411f07d74f0a0680b33c266227d24014ba4d1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2018
ms.locfileid: "52305950"
---
# <a name="resiliency-checklist"></a>Контрольный список для обеспечения отказоустойчивости

Устойчивость представляет собой возможность восстановления системы после сбоев и продолжения работы. Это один из [основных критериев качества программного обеспечения](../guide/pillars.md). Разработка приложения для обеспечения отказоустойчивости требует планирования и устранения различных режимов сбоев, которые могут возникнуть. Воспользуйтесь этим контрольным списком, чтобы проверить архитектуру приложения с точки зрения устойчивости. Также см. [контрольный список для обеспечения устойчивости конкретных служб Azure](./resiliency-per-service.md).

## <a name="requirements"></a>Требования

**Определите требования вашего клиента к обеспечению доступности.** У вашего клиента будут требования к обеспечению доступности для компонентов приложения, которые повлияют на проектирование вашего приложения. Получите соглашение вашего клиента с требованиями к обеспечению доступности каждой части приложения, иначе ваш проект может не соответствовать ожиданиям клиента. Дополнительные сведения см. в статье [Проектирование устойчивых приложений для Azure](../resiliency/index.md).

## <a name="application-design"></a>Проектирование приложений

**Выполните анализ режима сбоя (FMA) приложения.** FMA — это процесс повышения отказоустойчивости в приложении на ранней стадии проектирования. Дополнительные сведения см. в статье [Анализ режима сбоя][fma]. Цели FMA:  

* Определите типы сбоев, которые могут возникнуть в приложении.
* Запишите потенциальные эффекты и влияние каждого типа сбоя на приложение.
* Определите стратегии восстановления.
  

**Развертывайте несколько экземпляров служб.** Если приложение зависит от одного экземпляра службы, создается единая точка отказа. Подготовка нескольких экземпляров улучшает как отказоустойчивость, так и масштабируемость. Для [службы приложений Azure](/azure/app-service/app-service-value-prop-what-is/) выберите [план служб приложений](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/), где есть несколько экземпляров. Для облачных служб Azure настройте каждую роль для применения [нескольких экземпляров](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management). Для [виртуальных машин Azure](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) убедитесь, что архитектура виртуальных машин содержит несколько виртуальных машин, а также что каждая виртуальная машина входит в [группу доступности][availability-sets].   

**Используйте автоматическое масштабирование для реагирования на увеличение нагрузки.** Если в приложении не настроено автоматическое масштабирование при увеличении нагрузки, возможно, при перегрузке пользовательскими запросами в службах вашего приложения будут происходить сбои. Подробные сведения см. в следующих статьях:

* Общие сведения: [Контрольный список для обеспечения масштабируемости](./scalability.md).
* Служба приложений Azure: [Масштабирование числа экземпляров вручную или автоматически][app-service-autoscale].
* Облачные службы: [Как настроить автомасштабирование для облачной службы на портале][cloud-service-autoscale].
* Виртуальные машины: [Обзор автомасштабирования с помощью масштабируемых наборов виртуальных машин Azure][vmss-autoscale].

**Используйте балансировку нагрузки для распределения запросов.** Балансировка нагрузки распределяет запросы вашего приложения между работоспособными экземплярами службы, удаляя неработоспособные экземпляры из ротации. Если служба использует службу приложений Azure или облачные службы Azure, нагрузка в ней уже сбалансирована. Однако, если приложение использует виртуальные машины Azure, вам необходимо будет установить подсистему балансировки нагрузки. Дополнительные сведения см. в статье [Обзор Azure Load Balancer](/azure/load-balancer/load-balancer-overview/).

**Настройте шлюзы приложения Azure для использования нескольких экземпляров.** В зависимости от требований приложения [шлюз приложений Azure](/azure/application-gateway/application-gateway-introduction/) может лучше подойти для распространения запросов в вашем приложении. Однако единичные экземпляры службы шлюза приложений не гарантируются соглашением об уровне обслуживания (SLA), поэтому возможно, что в вашем приложении могут возникать сбои, если экземпляр шлюза приложения завершит работу с ошибкой. Подготовьте несколько небольших или средних экземпляров шлюза приложений для гарантии доступности службы в соответствии с условиями [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/).

**Используйте группы доступности Azure для каждого уровня приложения.** Размещение экземпляров в [группе доступности][availability-sets] обеспечивает более высокий уровень [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/). 

**Репликация виртуальных машин с помощью Site Recovery** При репликации виртуальных машин Azure с помощью [Site Recovery][site-recovery] все диски виртуальных машин непрерывно и асинхронно реплицируются в целевой регион. Точки восстановления создаются каждые несколько минут. Это обеспечивает требуемую целевую точку восстановления (RPO) в минутах.

**Рассмотрите возможность развертывания приложения в нескольких регионах.** Если ваше приложение развертывается в одном регионе, в редких случаях, когда весь регион становится недоступным, ваше приложение также будет недоступно. Это может быть неприемлемо в соответствии с условиями SLA вашего приложения. Если это так, рассмотрите возможность развертывания приложения и служб в нескольких регионах. Развертывание в нескольких регионах может использовать шаблон "активный — активный" (распределение запросов между несколькими активными экземплярами) или "активный — пассивный" (сохранение резервного экземпляра на случай сбоя основного). Мы рекомендуем развернуть несколько экземпляров служб вашего приложения в парах регионов. Дополнительные сведения см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](/azure/best-practices-availability-paired-regions).

**Используйте диспетчер трафика Azure для маршрутизации трафика вашего приложения в разные регионы.**  [Диспетчер трафика Azure][traffic-manager] выполняет балансировку нагрузки на уровне DNS и направляет трафик в разные регионы на основе указанного метода [маршрутизации трафика][traffic-manager-routing] и состояния конечных точек вашего приложения. Без диспетчера трафика вы ограничены одним регионом для развертывания. При этом ограничивается масштаб, увеличивается задержка для некоторых пользователей и возникает простой приложений в случае нарушения работы служб на уровне региона.

**Настройте и выполните проверку работоспособности подсистемы балансировки нагрузки и диспетчеров трафика.** Убедитесь, что ваша логика работоспособности проверяет критически важные части системы и соответствующим образом реагирует на проверки работоспособности.

* Проверки работоспособности [диспетчера трафика Azure][traffic-manager] и [Azure Load Balancer][load-balancer] выполняют определенную функцию. Для диспетчера трафика при проверке работоспособности определяется, следует ли выполнить отработку отказа в другой регион. Для подсистемы балансировки нагрузки определяется, следует ли удалять виртуальную машину из ротации.      
* Для проверки диспетчера трафика конечная точка работоспособности должна проверять любые критические зависимости, которые развертываются в одном регионе и сбой которых должен инициировать отработку отказа с переходом в другой регион.  
* Для подсистемы балансировки нагрузки конечная точка работоспособности должна сообщать о работоспособности виртуальной машины. Не включайте в развертывание другие уровни или внешние службы. В противном случае при сбое вне виртуальной машины подсистема балансировки нагрузки удалит виртуальную машину из ротации.
* Инструкции по реализации мониторинга работоспособности в приложении см. в статье [Health Endpoint Monitoring Pattern](https://msdn.microsoft.com/library/dn589789.aspx) (Шаблон мониторинга конечной точки работоспособности).

**Отслеживайте сторонние службы.** Если ваше приложение зависит от сторонних служб, определите, где и как могут произойти сбои этих сторонних служб и как эти сбои могут повлиять на ваше приложение. Сторонняя служба может не включать в себя мониторинг и диагностику, поэтому важно регистрировать свои вызовы и сопоставлять их с журналом работоспособности и диагностики вашего приложения с использованием уникального идентификатора. Дополнительные сведения о методиках мониторинга и диагностики см. в статье [Мониторинг и диагностика][monitoring-and-diagnostics-guidance].

**Убедитесь, что любая используемая сторонняя служба предоставляет SLA.** Если ваше приложение зависит от сторонней службы, но сторонний поставщик не гарантирует доступность в форме SLA, доступность вашего приложения также невозможно гарантировать. Соглашение SLA зависит от наименее доступного компонента вашего приложения.

**При необходимости применяйте шаблоны отказоустойчивости для удаленных операций.** Если работа приложения зависит от связи между удаленными службами, для устранения кратковременных сбоев применяйте [конструктивные шаблоны](../patterns/category/resiliency.md), например [шаблон повторов][retry-pattern] и [шаблон прерывателя][circuit-breaker]. 

**По возможности реализуйте асинхронные операции.** Синхронные операции могут монополизировать ресурсы и блокировать другие операции, пока вызывающий объект ждет завершения процесса. Проектируйте каждую часть приложения таким образом, чтобы по возможности обеспечить возможность асинхронных операций. Дополнительные сведения о том, как реализовать асинхронное программирование в C#, см. в статье [Асинхронное программирование][asynchronous-c-sharp].

## <a name="data-management"></a>Управление данными

**Изучите методы репликации источников данных приложения.** Данные приложения будут храниться в разных источниках данных и иметь разные требования к доступности. Проанализируйте методы репликации для каждого типа хранилища данных в Azure, включая [репликацию хранилища Azure](/azure/storage/storage-redundancy/) и [активную георепликацию для базы данных SQL](/azure/sql-database/sql-database-geo-replication-overview/), чтобы убедиться, что требования данных приложения выполняются. При репликации виртуальных машин Azure с помощью [Site Recovery][site-recovery] все диски виртуальных машин непрерывно и асинхронно реплицируются в целевой регион. Точки восстановления создаются каждые несколько минут. 

**Убедитесь, что ни одна учетная запись пользователя не имеет доступа к рабочим и резервным данным.** Резервные копии данных будут скомпрометированы, если одна учетная запись пользователя имеет разрешение на запись как в источники рабочих данных разработки, так и в источники резервных копий. Злоумышленник может намеренно удалить все ваши данные, а обычный пользователь может сделать это случайно. Создайте приложение для ограничения разрешений каждой учетной записи пользователя, чтобы только пользователи, которым требуется доступ на запись, имели доступ на запись только в рабочих или резервных данных, но не в обоих.

**Документируйте процесс отработки отказа и восстановления размещения источника данных и протестируйте его.** В случае, когда ваш источник данных полностью выходит из строя, оператору придется следовать набору документированных инструкций, чтобы выполнить отработку отказа и перейти к новому источнику данных. Если в задокументированных шагах есть ошибки, оператор не сможет успешно выполнить их и выполнить отработку отказа ресурса. Регулярно проверяйте шаги инструкции, чтобы убедиться, что оператор может успешно выполнить отработку отказа и восстановить размещение источника данных.

**Проверяйте резервные копии данных.** Регулярно проверяйте состояние резервных данных, запустив скрипт для проверки целостности данных, схемы и запросов. Резервная копия не имеет смысла, если с ее помощью невозможно восстановить источники данных. Регистрируйте и сообщайте о любых несоответствиях, чтобы можно было устранить неисправность службы восстановления.

**Рассмотрите возможность использования геоизбыточной учетной записи хранения.** Данные, хранящиеся в учетной записи хранения Azure, всегда реплицируются локально. Однако существует несколько стратегий репликации, которые можно выбрать при подготовке учетной записи хранения. Выберите [геоизбыточное хранилище с доступом на чтение (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage) для защиты данных приложения в тех редких случаях, когда весь регион становится недоступным.

> [!NOTE]
> Для виртуальных машин не следует полагаться на репликацию RA-GRS для восстановления дисков виртуальных машин (файлы VHD). Вместо этого используйте [Azure Backup][azure-backup].   
>
>

## <a name="security"></a>Безопасность

**Реализуйте защиту на уровне приложения от атак типа "отказ в обслуживании" (DDoS).** Службы Azure защищены от атак DDoS на сетевом уровне. Тем не менее Azure не может защитить от атак на уровне приложений, потому что трудно отличить истинные запросы пользователей от вредоносных. Дополнительные сведения о том, как обеспечить защиту от атак DDoS на уровне приложений, см. в разделе "Защита от атак DDoS" документа о [сетевой безопасности Microsoft Azure](https://download.microsoft.com/download/C/A/3/CA3FC5C0-ECE0-4F87-BF4B-D74064A00846/AzureNetworkSecurity_v3_Feb2015.pdf) (в формате PDF).

**Реализуйте принцип наименьших привилегий для доступа к ресурсам приложения.** Значение по умолчанию для доступа к ресурсам приложения должно быть максимально ограничивающим. Предоставляйте разрешения более высокого уровня на основе утверждения. Предоставление повышенных прав доступа к ресурсам приложения по умолчанию может привести к тому, что кто-то намеренно или случайно удалит ресурсы. Azure предоставляет [управление доступом на основе ролей](/azure/active-directory/role-based-access-built-in-roles/) для управления привилегиями пользователей, но важно проверить разрешения с минимальными привилегиями для других ресурсов с собственными системами разрешений, например SQL Server.

## <a name="testing"></a>Тестирование

**Протестируйте отработку отказа и восстановление размещения для приложения.** Если вы еще не полностью протестировали отработку отказа и восстановление размещения, нельзя с уверенностью заявить, что зависимые службы в вашем приложении восстановят работу синхронизировано во время аварийного восстановления. Убедитесь в том, что зависимые службы приложения выполняют отработку отказа и восстановление размещения в правильном порядке. Если вы используете [Azure Site Recovery][site-recovery] для репликации виртуальных машин, периодически запускайте аварийное восстановление периодически, выполняя тестовую отработку отказа. См. дополнительные сведения об [отработке аварийного восстановления в Azure][site-recovery-test].

**Выполните тестирование путем внедрения ошибки в приложение.** Приложение может не работать по разным причинам, таким как истечение срока действия сертификата, исчерпание системных ресурсов в виртуальной машине или сбои хранилища. Протестируйте приложение в среде, максимально приближенной к рабочей, путем моделирования или запуска реальных сбоев. Например, удалите сертификаты, искусственно используйте системные ресурсы или удалите источник хранения. Проверьте способность вашего приложения восстанавливать все типы неисправностей автономно и в сочетании с различными методами. Убедитесь, что ошибки не распространяются или не объединяются в вашей системе.

**Выполните тестирования в среде разработки с использованием как синтетических, так и реальных пользовательских данных.** Тестирование и разработка редко идентичны, поэтому важно использовать метод развертывания Blue-Green или раннее развертывание и тестировать приложение в рабочей среде. Это позволяет протестировать приложение в рабочей среде с реальной нагрузкой и гарантировать, что оно будет функционировать должным образом после полного развертывания.

## <a name="deployment"></a>Развертывание

**Документируйте процесс выпуска вашего приложения.** Без подробного документирования процесса выпуска оператор может развернуть неправильное обновление или неправильно настроить параметры вашего приложения. Четко определите и задокументируйте процесс выпуска и убедитесь, что он доступен для всей группы разработки. 

**Автоматизируйте процесс развертывания приложения.** Если рабочий персонал должен вручную развертывать ваше приложение, человеческий фактор может привести к сбою развертывания. 

**Разработайте процесс выпуска, максимально повышающий доступность приложений.** Если процесс выпуска требует, чтобы службы отключались во время развертывания, ваше приложение будет недоступно, пока службы не вернутся в сеть. Используйте метод развертывания выпуска [Blue-Green](https://martinfowler.com/bliki/BlueGreenDeployment.html) или [раннее](https://martinfowler.com/bliki/CanaryRelease.html) развертывание для развертывания приложения в рабочей среде. Оба этих метода включают в себя развертывание кода выпуска вместе с рабочим кодом, чтобы пользователей кода выпуска можно было перенаправить в рабочий код в случае сбоя.

**Выполняйте регистрирование и аудит развертываний приложения.** Если вы используете промежуточные методы развертывания, такие как Blue-Green или ранние выпуски, в рабочей среде будет существовать несколько версий вашего приложения. Если возникает ошибка, очень важно определить, какая версия приложения вызвала ее. Реализуйте надежную стратегию ведения журнала, чтобы получить как можно больше сведений о версии.

**Составьте план отката развертывания.** Возможно, развертывание приложения может завершиться сбоем и привести к тому, что ваше приложение станет недоступно. Создайте процесс отката, позволяющий вернуться к последней известной рабочей версии и минимизировать время простоя. 

## <a name="operations"></a>Операции

**Реализуйте рекомендации по мониторингу и оповещению в приложении.** Без надлежащего мониторинга, диагностики и оповещения невозможно обнаружить сбои в приложении и сообщить оператору об их устранении. Дополнительные сведения см. в статье [Мониторинг и диагностика][monitoring-and-diagnostics-guidance].

**Измеряйте статистику удаленных вызовов, чтобы сделать информацию доступной команде разработки.**  Если не отслеживать и не передавать статистику удаленных вызовов в режиме реального времени и не предоставлять простой способ просмотра этой информации, группа разработки не сможет мгновенно узнать о работоспособности вашего приложения. Если вы измеряете среднее время удаленного вызова, у вас будет недостаточно информации для выявления проблем в службах. Суммируйте показатели удаленного вызова, такие как задержка, пропускная способность и ошибки на уровне 99-го и 95-го процентилей. Выполните статистический анализ показателей, чтобы выявить ошибки, возникающие на каждом процентиле.

**Отслеживайте количество временных исключений и повторений за соответствующий временной интервал.** Если вы не отслеживаете временные исключения и попытки повторения с течением времени, возможно, что проблема или сбой могут быть скрыты логикой повторения вашего приложения. То есть, если мониторинг и ведение журнала показывают только успешность или неудачу операции, то тот факт, что операцию пришлось повторить несколько раз из-за исключений, будет скрыт. Тенденция увеличения исключений с течением времени указывает на то, что в службе возникла проблема и она может выйти из строя. Дополнительные сведения см. в статье [Руководство по использованию механизма повторов для отдельных служб][retry-service-guidance].

**Реализуйте систему раннего предупреждения оператора.** Определите ключевые показатели эффективности вашего приложения, такие как временные исключения и задержка удаленного вызова, и установите соответствующие пороговые значения для каждого из них. Отправьте оповещение операциям при достижении порогового значения. Установите эти пороговые значения на уровнях, которые идентифицируют проблемы до того, как они станут критическими и потребуют мер восстановления.

**Убедитесь, что в команде несколько специалистов обучено контролировать приложение и выполнять любые шаги восстановления вручную.** Если в вашей команде есть только один оператор, который может контролировать приложение и запускать шаги восстановления, он становится единой точкой отказа. Обучите нескольких людей обнаружению и восстановлению и убедитесь, что в любой момент всегда есть как минимум один активный участник.

**Убедитесь, что приложение не сталкивается с [ограничениями подписки Azure](/azure/azure-subscription-service-limits/).** В подписках Azure предусмотрены ограничения на определенные типы ресурсов, такие как количество групп ресурсов, количество ядер и количество учетных записей.  Если ваши требования к приложениям превышают лимиты подписки Azure, создайте еще одну подписку Azure и подготовьте в ней достаточное количество ресурсов.

**Убедитесь, что приложение не сталкивается с [ограничениями для одной службы](/azure/azure-subscription-service-limits/).** Отдельные службы Azure имеют ограничения на потребление, например ограничения на объем хранения, пропускную способность, количество подключений, запросы в секунду и другие показатели. Приложение не будет работать, если оно попытается использовать ресурсы за пределами этих ограничений. Это приведет к регулированию службы и возможному простою для затронутых пользователей. В зависимости от конкретной службы и требований приложений вы можете избежать этих ограничений путем вертикального (например, выбора другого уровня цен) или горизонтального масштабирования (добавления новых экземпляров).  

**Разрабатывайте требования к хранилищу приложений в соответствии целевыми показателями масштабируемости и производительности службы хранилища Azure.** Служба хранилища Azure предназначена для работы в рамках предопределенных целевых показателей масштабируемости и производительности, поэтому разрабатывайте приложение для использования хранилища в рамках этих показателей. При превышении этих целевых показателей хранилище приложения будет регулироваться. Чтобы устранить эту проблему, подготовьте дополнительные учетные записи хранения. Если вы столкнулись с лимитом учетной записи хранения, подготовьте дополнительные подписки Azure и дополнительные учетные записи хранения. Дополнительные сведения см. в статье [Целевые показатели масштабируемости и производительности службы хранилища Azure](/azure/storage/storage-scalability-targets/).

**Выберите правильный размер виртуальной машины для своего приложения.** Измерьте фактические показатели по использованию процессора, памяти, диску и операциям ввода-вывода ваших виртуальных машин в рабочей среде и убедитесь, что выбранный вами размер виртуальной машины достаточен. В противном случае ваше приложение может испытывать проблемы с пропускной способностью при достижении ограничений в виртуальных машинах. Размеры виртуальных машин подробно описываются в статье [Размеры виртуальных машин Windows в Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

**Определите, является ли рабочая нагрузка вашего приложения стабильной или колеблющейся с течением времени.** Если ваша рабочая нагрузка изменяется с течением времени, используйте масштабируемые наборы виртуальных машин для автоматического масштабирования требуемого количества экземпляров виртуальных машин. В противном случае необходимо вручную увеличить или уменьшить число виртуальных машин. Дополнительные сведения см. в статье [Общие сведения о масштабируемых наборах виртуальных машин в Azure](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).

**Выберите соответствующий уровень служб для базы данных Azure SQL.** Если приложение использует базу данных Azure SQL, убедитесь, что вы выбрали соответствующий уровень служб. Если вы выберете уровень, который не сможет обрабатывать требования к единицам передачи данных приложения (DTU), использование данных будет регулироваться. Дополнительные сведения о выборе соответствующего плана служб см. в статье [Что такое уровни служб Базы данных SQL](/azure/sql-database/sql-database-service-tiers/).

**Создайте процесс для взаимодействия со службой поддержки Azure.** Если процесс обращения в [службу поддержки Azure](https://azure.microsoft.com/support/plans/) не установлен до того, как возникнет необходимость обратиться в службу поддержки, время простоя будет увеличиваться по мере того, как процесс обращения в службу поддержки будет применяться в первый раз. Изначально включите процесс обращения в службу поддержки и эскалацию проблем как часть отказоустойчивости вашего приложения.

**Убедитесь, что приложение не использует больше максимального количества учетных записей для подписки.** Azure поддерживает не более 200 учетных записей хранения для подписки. Если вашему приложению требуется больше учетных записей, чем в настоящее время доступно в вашей подписке, вам придется создать подписку и создать в ней дополнительные учетные записи хранения. Дополнительные сведения см. в статье [Подписка Azure, границы, квоты и ограничения службы](/azure/azure-subscription-service-limits/#storage-limits).

**Убедитесь, что приложение не превышает целевые показатели масштабируемости для дисков виртуальной машины.** Виртуальные машины Azure IaaS поддерживают подключение нескольких дисков данных в зависимости от ряда факторов, включая размер виртуальной машины и тип учетной записи хранения. Если приложение превышает целевые показатели масштабируемости для дисков виртуальных машин, подготовьте дополнительные учетные записи хранения и создайте в них виртуальные диски. Дополнительные сведения см. в статье [Целевые показатели масштабируемости и производительности службы хранилища Azure](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks).

## <a name="telemetry"></a>Телеметрия

**Регистрируйте данные телеметрии во время работы приложения в рабочей среде.** Сохраняйте надежные данные телеметрии во время работы приложения в рабочей среде. В противном случае у вас будет недостаточно информации, чтобы диагностировать причину проблем во время активного обслуживания пользователей в приложении. Дополнительные сведения см. в статье [Мониторинг и диагностика][monitoring-and-diagnostics-guidance].

**Реализуйте ведение журнала с использованием асинхронного шаблона.** Если операции ведения журнала являются синхронными, они могут блокировать код приложения. Убедитесь, что ведение журнала операций реализовано в виде асинхронных операций.

**Сопоставляйте данные журнала в границах служб.** В типичном n-уровневом приложении пользовательский запрос может пересекать границы нескольких служб. Например, пользовательский запрос обычно возникает на веб-уровне и передается на бизнес-уровень и, наконец, сохраняется на уровне данных. В более сложных сценариях запрос пользователя может распространяться на множество различных служб и хранилищ данных. Убедитесь, что система ведения журнала сопоставляет вызовы в границах служб для отслеживания запроса в приложении.

## <a name="azure-resources"></a>Ресурсы Azure

**Используйте шаблоны Azure Resource Manager для подготовки ресурсов.** Шаблоны Resource Manager облегчают автоматизирование развертываний с помощью PowerShell или Azure CLI, что обеспечивает более надежный процесс развертывания. Дополнительные сведения см. в [обзоре Azure Resource Manager][resource-manager].

**Присваивайте ресурсам информативные имена.** Это упростит поиск определенного ресурса и понимание его роли. Дополнительные сведения см. в статье [Соглашения об именовании](../best-practices/naming-conventions.md).

**Управление доступом на основе ролей (RBAC).** Контролируйте доступ к развертываемым ресурсам Azure с помощью RBAC. RBAC позволяет назначать роли авторизации участникам команды DevOps, чтобы предотвратить случайное удаление или изменение развернутых ресурсов. Дополнительные сведения см. в статье [Начало работы с управлением доступом на основе ролей на портале Azure](/azure/active-directory/role-based-access-control-what-is/).

**Используйте блокировки ресурсов для критических ресурсов, таких как виртуальные машины.** Блокировки ресурсов предотвращают случайное удаление ресурса оператором. Дополнительные сведения см. в статье [Блокировка ресурсов для предотвращения непредвиденных изменений](/azure/azure-resource-manager/resource-group-lock-resources/).

**Выберите пары регионов.** При развертывании в двух регионах выберите регионы из одной пары регионов. На случай масштабного сбоя в каждой паре определяется приоритетный регион для восстановления. Некоторые службы, например геоизбыточное хранилище, автоматически реплицируют данные в дополнительный регион. Дополнительные сведения см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](/azure/best-practices-availability-paired-regions).

**Организуйте группы ресурсов в соответствии с функциями и жизненным циклом.**  Как правило, группа ресурсов должна содержать ресурсы с одним и тем же жизненным циклом. Это упрощает управление развертываниями, удаление тестовых развертываний и назначение прав доступа, что снижает вероятность случайного удаления или изменения рабочего развертывания. Создайте отдельные группы ресурсов для рабочей среды, сред разработки и тестирования. При развертывании в нескольких регионах поместите ресурсы для каждого региона в отдельные группы ресурсов. Это упрощает повторное развертывание в одном регионе, не затрагивая другие.

## <a name="next-steps"></a>Дополнительная информация

- [Контрольный список для обеспечения устойчивости конкретных служб Azure](./resiliency-per-service.md)
- [Анализ режима сбоя](../resiliency/failure-mode-analysis.md)


<!-- links -->
[app-service-autoscale]: /azure/monitoring-and-diagnostics/insights-how-to-scale/
[asynchronous-c-sharp]: /dotnet/articles/csharp/async
[availability-sets]:/azure/virtual-machines/virtual-machines-windows-manage-availability/
[azure-backup]: https://azure.microsoft.com/documentation/services/backup/
[circuit-breaker]: ../patterns/circuit-breaker.md
[cloud-service-autoscale]: /azure/cloud-services/cloud-services-how-to-scale/
[fma]: ../resiliency/failure-mode-analysis.md
[load-balancer]: /azure/load-balancer/load-balancer-overview/
[monitoring-and-diagnostics-guidance]: ../best-practices/monitoring.md
[resource-manager]: /azure/azure-resource-manager/resource-group-overview/
[retry-pattern]: ../patterns/retry.md
[retry-service-guidance]: ../best-practices/retry-service-specific.md
[site-recovery]: /azure/site-recovery/
[site-recovery-test]: /azure/site-recovery/site-recovery-test-failover-to-azure
[traffic-manager]: /azure/traffic-manager/traffic-manager-overview/
[traffic-manager-routing]: /azure/traffic-manager/traffic-manager-routing-methods/
[vmss-autoscale]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/
