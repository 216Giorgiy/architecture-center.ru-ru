---
title: "Контрольный список для обеспечения отказоустойчивости"
description: "Контрольный список с рекомендациями по вопросам обеспечения отказоустойчивости, возникающим во время проектирования."
author: petertaylor9999
ms.date: 03/24/2017
ms.custom: resiliency, checklist
ms.openlocfilehash: d0ae48be603391a7be043130d6d77d3c82abad18
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2017
---
# <a name="resiliency-checklist"></a><span data-ttu-id="45327-103">Контрольный список для обеспечения отказоустойчивости</span><span class="sxs-lookup"><span data-stu-id="45327-103">Resiliency checklist</span></span>
[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="45327-104">Разработка приложения для обеспечения отказоустойчивости требует планирования и устранения различных режимов сбоев, которые могут возникнуть.</span><span class="sxs-lookup"><span data-stu-id="45327-104">Designing your application for resiliency requires planning for and mitigating a variety of failure modes that could occur.</span></span> <span data-ttu-id="45327-105">Просмотрите пункты в этом контрольном списке при разработке приложения, чтобы повысить его отказоустойчивость.</span><span class="sxs-lookup"><span data-stu-id="45327-105">Review the items in this checklist against your application design to improve its resiliency.</span></span>

## <a name="requirements"></a><span data-ttu-id="45327-106">Требования</span><span class="sxs-lookup"><span data-stu-id="45327-106">Requirements</span></span>
* <span data-ttu-id="45327-107">**Определите требования вашего клиента к обеспечению доступности.**</span><span class="sxs-lookup"><span data-stu-id="45327-107">**Define your customer's availability requirements.**</span></span> <span data-ttu-id="45327-108">У вашего клиента будут требования к обеспечению доступности для компонентов приложения, которые повлияют на проектирование вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-108">Your customer will have availability requirements for the components in your application and this will affect your application's design.</span></span> <span data-ttu-id="45327-109">Получите соглашение вашего клиента с требованиями к обеспечению доступности каждой части приложения, иначе ваш проект может не соответствовать ожиданиям клиента.</span><span class="sxs-lookup"><span data-stu-id="45327-109">Get agreement from your customer for the availability targets of each piece of your application, otherwise your design may not meet the customer's expectations.</span></span> <span data-ttu-id="45327-110">Дополнительные сведения см. в разделе [Определение требований к отказоустойчивости](../resiliency/index.md#defining-your-resiliency-requirements).</span><span class="sxs-lookup"><span data-stu-id="45327-110">For more information, see [Defining your resiliency requirements](../resiliency/index.md#defining-your-resiliency-requirements).</span></span>

## <a name="application-design"></a><span data-ttu-id="45327-111">Проектирование приложений</span><span class="sxs-lookup"><span data-stu-id="45327-111">Application Design</span></span>
* <span data-ttu-id="45327-112">**Выполните анализ режима сбоя (FMA) приложения.**</span><span class="sxs-lookup"><span data-stu-id="45327-112">**Perform a failure mode analysis (FMA) for your application.**</span></span> <span data-ttu-id="45327-113">FMA — это процесс повышения отказоустойчивости в приложении на ранней стадии проектирования.</span><span class="sxs-lookup"><span data-stu-id="45327-113">FMA is a process for building resiliency into an application early in the design stage.</span></span> <span data-ttu-id="45327-114">Дополнительные сведения см. в статье [Анализ режима сбоя][fma].</span><span class="sxs-lookup"><span data-stu-id="45327-114">For more information, see [Failure mode analysis][fma].</span></span> <span data-ttu-id="45327-115">Цели FMA:</span><span class="sxs-lookup"><span data-stu-id="45327-115">The goals of an FMA include:</span></span>  

  * <span data-ttu-id="45327-116">Определите типы сбоев, которые могут возникнуть в приложении.</span><span class="sxs-lookup"><span data-stu-id="45327-116">Identify what types of failures an application might experience.</span></span>
  * <span data-ttu-id="45327-117">Запишите потенциальные эффекты и влияние каждого типа сбоя на приложение.</span><span class="sxs-lookup"><span data-stu-id="45327-117">Capture the potential effects and impact of each type of failure on the application.</span></span>
  * <span data-ttu-id="45327-118">Определите стратегии восстановления.</span><span class="sxs-lookup"><span data-stu-id="45327-118">Identify recovery strategies.</span></span>
  
* <span data-ttu-id="45327-119">**Развертывайте несколько экземпляров служб.**</span><span class="sxs-lookup"><span data-stu-id="45327-119">**Deploy multiple instances of services.**</span></span> <span data-ttu-id="45327-120">Если приложение зависит от одного экземпляра службы, создается единая точка отказа.</span><span class="sxs-lookup"><span data-stu-id="45327-120">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="45327-121">Подготовка нескольких экземпляров улучшает как отказоустойчивость, так и масштабируемость.</span><span class="sxs-lookup"><span data-stu-id="45327-121">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="45327-122">Для [службы приложений Azure](/azure/app-service/app-service-value-prop-what-is/) выберите [план служб приложений](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/), где есть несколько экземпляров.</span><span class="sxs-lookup"><span data-stu-id="45327-122">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service Plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span> <span data-ttu-id="45327-123">Для облачных служб Azure настройте каждую роль для применения [нескольких экземпляров](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management).</span><span class="sxs-lookup"><span data-stu-id="45327-123">For Azure Cloud Services, configure each of your roles to use [multiple instances](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management).</span></span> <span data-ttu-id="45327-124">Для [виртуальных машин Azure](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) убедитесь, что архитектура виртуальных машин содержит несколько виртуальных машин, а также что каждая виртуальная машина входит в [группу доступности][availability-sets].</span><span class="sxs-lookup"><span data-stu-id="45327-124">For [Azure Virtual Machines (VMs)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your VM architecture includes more than one VM and that each VM is included in an [availability set][availability-sets].</span></span>   
* <span data-ttu-id="45327-125">**Используйте автоматическое масштабирование для реагирования на увеличение нагрузки.**</span><span class="sxs-lookup"><span data-stu-id="45327-125">**Use autoscaling to respond to increases in load.**</span></span> <span data-ttu-id="45327-126">Если в приложении не настроено автоматическое масштабирование при увеличении нагрузки, возможно, при перегрузке пользовательскими запросами в службах вашего приложения будут происходить сбои.</span><span class="sxs-lookup"><span data-stu-id="45327-126">If your application is not configured to scale out automatically as load increases, it's possible that your application's services will fail if they become saturated with user requests.</span></span> <span data-ttu-id="45327-127">Подробные сведения см. в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="45327-127">For more details, see the following:</span></span>

  * <span data-ttu-id="45327-128">Общие сведения: [Контрольный список для обеспечения масштабируемости](./scalability.md).</span><span class="sxs-lookup"><span data-stu-id="45327-128">General: [Scalability checklist](./scalability.md)</span></span>
  * <span data-ttu-id="45327-129">Служба приложений Azure: [Масштабирование числа экземпляров вручную или автоматически][app-service-autoscale].</span><span class="sxs-lookup"><span data-stu-id="45327-129">Azure App Service: [Scale instance count manually or automatically][app-service-autoscale]</span></span>
  * <span data-ttu-id="45327-130">Облачные службы: [Как настроить автомасштабирование для облачной службы на портале][cloud-service-autoscale].</span><span class="sxs-lookup"><span data-stu-id="45327-130">Cloud Services: [How to auto scale a cloud service][cloud-service-autoscale]</span></span>
  * <span data-ttu-id="45327-131">Виртуальные машины: [Обзор автомасштабирования с помощью масштабируемых наборов виртуальных машин Azure][vmss-autoscale].</span><span class="sxs-lookup"><span data-stu-id="45327-131">Virtual Machines: [Automatic scaling and virtual machine scale sets][vmss-autoscale]</span></span>
* <span data-ttu-id="45327-132">**Используйте балансировку нагрузки для распределения запросов.**</span><span class="sxs-lookup"><span data-stu-id="45327-132">**Use load balancing to distribute requests.**</span></span> <span data-ttu-id="45327-133">Балансировка нагрузки распределяет запросы вашего приложения между работоспособными экземплярами службы, удаляя неработоспособные экземпляры из ротации.</span><span class="sxs-lookup"><span data-stu-id="45327-133">Load balancing distributes your application's requests to healthy service instances by removing unhealthy instances from rotation.</span></span> <span data-ttu-id="45327-134">Если служба использует службу приложений Azure или облачные службы Azure, нагрузка в ней уже сбалансирована.</span><span class="sxs-lookup"><span data-stu-id="45327-134">If your service uses Azure App Service or Azure Cloud Services, it is already load balanced for you.</span></span> <span data-ttu-id="45327-135">Однако, если приложение использует виртуальные машины Azure, вам необходимо будет установить подсистему балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="45327-135">However, if your application uses Azure VMs, you will need to provision a load balancer.</span></span> <span data-ttu-id="45327-136">Дополнительные сведения см. в статье [Обзор Azure Load Balancer](/azure/load-balancer/load-balancer-overview/).</span><span class="sxs-lookup"><span data-stu-id="45327-136">See the [Azure Load Balancer](/azure/load-balancer/load-balancer-overview/) overview for more details.</span></span>
* <span data-ttu-id="45327-137">**Настройте шлюзы приложения Azure для использования нескольких экземпляров.**</span><span class="sxs-lookup"><span data-stu-id="45327-137">**Configure Azure Application Gateways to use multiple instances.**</span></span> <span data-ttu-id="45327-138">В зависимости от требований приложения [шлюз приложений Azure](/azure/application-gateway/application-gateway-introduction/) может лучше подойти для распространения запросов в вашем приложении.</span><span class="sxs-lookup"><span data-stu-id="45327-138">Depending on your application's requirements, an [Azure Application Gateway](/azure/application-gateway/application-gateway-introduction/) may be better suited to distributing requests to your application's services.</span></span> <span data-ttu-id="45327-139">Однако единичные экземпляры службы шлюза приложений не гарантируются соглашением об уровне обслуживания (SLA), поэтому возможно, что в вашем приложении могут возникать сбои, если экземпляр шлюза приложения завершит работу с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="45327-139">However, single instances of the Application Gateway service are not guaranteed by an SLA so it's possible that your application could fail if the Application Gateway instance fails.</span></span> <span data-ttu-id="45327-140">Подготовьте несколько небольших или средних экземпляров шлюза приложений для гарантии доступности службы в соответствии с условиями [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/).</span><span class="sxs-lookup"><span data-stu-id="45327-140">Provision more than one medium or larger Application Gateway instance to guarantee availability of the service under the terms of the [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/).</span></span>
* <span data-ttu-id="45327-141">**Используйте группы доступности Azure для каждого уровня приложения.**</span><span class="sxs-lookup"><span data-stu-id="45327-141">**Use Availability Sets for each application tier.**</span></span> <span data-ttu-id="45327-142">Размещение экземпляров в [группе доступности][availability-sets] обеспечивает более высокий уровень [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="45327-142">Placing your instances in an [availability set][availability-sets] provides a higher [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/).</span></span> 
* <span data-ttu-id="45327-143">**Рассмотрите возможность развертывания приложения в нескольких регионах.**</span><span class="sxs-lookup"><span data-stu-id="45327-143">**Consider deploying your application across multiple regions.**</span></span> <span data-ttu-id="45327-144">Если ваше приложение развертывается в одном регионе, в редких случаях, когда весь регион становится недоступным, ваше приложение также будет недоступно.</span><span class="sxs-lookup"><span data-stu-id="45327-144">If your application is deployed to a single region, in the rare event the entire region becomes unavailable, your application will also be unavailable.</span></span> <span data-ttu-id="45327-145">Это может быть неприемлемо в соответствии с условиями SLA вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-145">This may be unacceptable under the terms of your application's SLA.</span></span> <span data-ttu-id="45327-146">Если это так, рассмотрите возможность развертывания приложения и служб в нескольких регионах.</span><span class="sxs-lookup"><span data-stu-id="45327-146">If so, consider deploying your application and its services across multiple regions.</span></span> <span data-ttu-id="45327-147">Развертывание в нескольких регионах может использовать шаблон "активный — активный" (распределение запросов между несколькими активными экземплярами) или "активный — пассивный" (сохранение резервного экземпляра на случай сбоя основного).</span><span class="sxs-lookup"><span data-stu-id="45327-147">A multi-region deployment can use an active-active pattern (distributing requests across multiple active instances) or an active-passive pattern (keeping a "warm" instance in reserve, in case the primary instance fails).</span></span> <span data-ttu-id="45327-148">Мы рекомендуем развернуть несколько экземпляров служб вашего приложения в парах регионов.</span><span class="sxs-lookup"><span data-stu-id="45327-148">We recommend that you deploy multiple instances of your application's services across regional pairs.</span></span> <span data-ttu-id="45327-149">Дополнительные сведения см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="45327-149">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>
* <span data-ttu-id="45327-150">**Используйте диспетчер трафика Azure для маршрутизации трафика вашего приложения в разные регионы.**</span><span class="sxs-lookup"><span data-stu-id="45327-150">**Use Azure Traffic Manager to route your application's traffic to different regions.**</span></span>  <span data-ttu-id="45327-151">[Диспетчер трафика Azure][traffic-manager] выполняет балансировку нагрузки на уровне DNS и направляет трафик в разные регионы на основе указанного метода [маршрутизации трафика][traffic-manager-routing] и состояния конечных точек вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-151">[Azure Traffic Manager][traffic-manager] performs load balancing at the DNS level and will route traffic to different regions based on the [traffic routing][traffic-manager-routing] method you specify and the health of your application's endpoints.</span></span> <span data-ttu-id="45327-152">Без диспетчера трафика вы ограничены одним регионом для развертывания. При этом ограничивается масштаб, увеличивается задержка для некоторых пользователей и возникает простой приложений в случае нарушения работы служб на уровне региона.</span><span class="sxs-lookup"><span data-stu-id="45327-152">Without Traffic Manager, you are limited to a single region for your deployment, which limits scale, increases latency for some users, and causes application downtime in the case of a region-wide service disruption.</span></span>
* <span data-ttu-id="45327-153">**Настройте и выполните проверку работоспособности подсистемы балансировки нагрузки и диспетчеров трафика.**</span><span class="sxs-lookup"><span data-stu-id="45327-153">**Configure and test health probes for your load balancers and traffic managers.**</span></span> <span data-ttu-id="45327-154">Убедитесь, что ваша логика работоспособности проверяет критически важные части системы и соответствующим образом реагирует на проверки работоспособности.</span><span class="sxs-lookup"><span data-stu-id="45327-154">Ensure that your health logic checks the critical parts of the system and responds appropriately to health probes.</span></span>
  * <span data-ttu-id="45327-155">Проверки работоспособности [диспетчера трафика Azure][traffic-manager] и [Azure Load Balancer][load-balancer] выполняют определенную функцию.</span><span class="sxs-lookup"><span data-stu-id="45327-155">The health probes for [Azure Traffic Manager][traffic-manager] and [Azure Load Balancer][load-balancer] serve a specific function.</span></span> <span data-ttu-id="45327-156">Для диспетчера трафика при проверке работоспособности определяется, следует ли выполнить отработку отказа в другой регион.</span><span class="sxs-lookup"><span data-stu-id="45327-156">For Traffic Manager, the health probe determines whether to fail over to another region.</span></span> <span data-ttu-id="45327-157">Для подсистемы балансировки нагрузки определяется, следует ли удалять виртуальную машину из ротации.</span><span class="sxs-lookup"><span data-stu-id="45327-157">For a load balancer, it determines whether to remove a VM from rotation.</span></span>      
  * <span data-ttu-id="45327-158">Для проверки диспетчера трафика конечная точка работоспособности должна проверять любые критические зависимости, которые развертываются в одном регионе и сбой которых должен инициировать отработку отказа с переходом в другой регион.</span><span class="sxs-lookup"><span data-stu-id="45327-158">For a Traffic Manager probe, your health endpoint should check any critical dependencies that are deployed within the same region, and whose failure should trigger a failover to another region.</span></span>  
  * <span data-ttu-id="45327-159">Для подсистемы балансировки нагрузки конечная точка работоспособности должна сообщать о работоспособности виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="45327-159">For a load balancer, the health endpoint should report the health of the VM.</span></span> <span data-ttu-id="45327-160">Не включайте в развертывание другие уровни или внешние службы.</span><span class="sxs-lookup"><span data-stu-id="45327-160">Don't include other tiers or external services.</span></span> <span data-ttu-id="45327-161">В противном случае при сбое вне виртуальной машины подсистема балансировки нагрузки удалит виртуальную машину из ротации.</span><span class="sxs-lookup"><span data-stu-id="45327-161">Otherwise, a failure that occurs outside the VM will cause the load balancer to remove the VM from rotation.</span></span>
  * <span data-ttu-id="45327-162">Инструкции по реализации мониторинга работоспособности в приложении см. в статье [Health Endpoint Monitoring Pattern](https://msdn.microsoft.com/library/dn589789.aspx) (Шаблон мониторинга конечной точки работоспособности).</span><span class="sxs-lookup"><span data-stu-id="45327-162">For guidance on implementing health monitoring in your application, see [Health Endpoint Monitoring Pattern](https://msdn.microsoft.com/library/dn589789.aspx).</span></span>
* <span data-ttu-id="45327-163">**Отслеживайте сторонние службы.**</span><span class="sxs-lookup"><span data-stu-id="45327-163">**Monitor third-party services.**</span></span> <span data-ttu-id="45327-164">Если ваше приложение зависит от сторонних служб, определите, где и как могут произойти сбои этих сторонних служб и как эти сбои могут повлиять на ваше приложение.</span><span class="sxs-lookup"><span data-stu-id="45327-164">If your application has dependencies on third-party services, identify where and how these third-party services can fail and what effect those failures will have on your application.</span></span> <span data-ttu-id="45327-165">Сторонняя служба может не включать в себя мониторинг и диагностику, поэтому важно регистрировать свои вызовы и сопоставлять их с журналом работоспособности и диагностики вашего приложения с использованием уникального идентификатора.</span><span class="sxs-lookup"><span data-stu-id="45327-165">A third-party service may not include monitoring and diagnostics, so it's important to log your invocations of them and correlate them with your application's health and diagnostic logging using a unique identifier.</span></span> <span data-ttu-id="45327-166">Дополнительные сведения о методиках мониторинга и диагностики см. в статье [Мониторинг и диагностика][monitoring-and-diagnostics-guidance].</span><span class="sxs-lookup"><span data-stu-id="45327-166">For more information on proven practices for monitoring and diagnostics, see [Monitoring and Diagnostics guidance][monitoring-and-diagnostics-guidance].</span></span>
* <span data-ttu-id="45327-167">**Убедитесь, что любая используемая сторонняя служба предоставляет SLA.**</span><span class="sxs-lookup"><span data-stu-id="45327-167">**Ensure that any third-party service you consume provides an SLA.**</span></span> <span data-ttu-id="45327-168">Если ваше приложение зависит от сторонней службы, но сторонний поставщик не гарантирует доступность в форме SLA, доступность вашего приложения также невозможно гарантировать.</span><span class="sxs-lookup"><span data-stu-id="45327-168">If your application depends on a third-party service, but the third party provides no guarantee of availability in the form of an SLA, your application's availability also cannot be guaranteed.</span></span> <span data-ttu-id="45327-169">Соглашение SLA зависит от наименее доступного компонента вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-169">Your SLA is only as good as the least available component of your application.</span></span>
* <span data-ttu-id="45327-170">**При необходимости применяйте шаблоны отказоустойчивости для удаленных операций.**</span><span class="sxs-lookup"><span data-stu-id="45327-170">**Implement resiliency patterns for remote operations where appropriate.**</span></span> <span data-ttu-id="45327-171">Если ваше приложение зависит от связи между удаленными службами, следуйте конструктивным шаблонам для устранения кратковременных сбоев, таким как [шаблон повторов][retry-pattern] и [шаблон автоматического выключения][circuit-breaker].</span><span class="sxs-lookup"><span data-stu-id="45327-171">If your application depends on communication between remote services, follow design patterns for dealing with transient failures, such as [Retry Pattern][retry-pattern], and [Circuit Breaker Pattern][circuit-breaker].</span></span> <span data-ttu-id="45327-172">Дополнительные сведения см. в разделе [Стратегии обеспечения отказоустойчивости](../resiliency/index.md#resiliency-strategies).</span><span class="sxs-lookup"><span data-stu-id="45327-172">For more information, see [Resiliency strategies](../resiliency/index.md#resiliency-strategies).</span></span>
* <span data-ttu-id="45327-173">**По возможности реализуйте асинхронные операции.**</span><span class="sxs-lookup"><span data-stu-id="45327-173">**Implement asynchronous operations whenever possible.**</span></span> <span data-ttu-id="45327-174">Синхронные операции могут монополизировать ресурсы и блокировать другие операции, пока вызывающий объект ждет завершения процесса.</span><span class="sxs-lookup"><span data-stu-id="45327-174">Synchronous operations can monopolize resources and block other operations while the caller waits for the process to complete.</span></span> <span data-ttu-id="45327-175">Проектируйте каждую часть приложения таким образом, чтобы по возможности обеспечить возможность асинхронных операций.</span><span class="sxs-lookup"><span data-stu-id="45327-175">Design each part of your application to allow for asynchronous operations whenever possible.</span></span> <span data-ttu-id="45327-176">Дополнительные сведения о том, как реализовать асинхронное программирование в C#, см. в статье [Асинхронное программирование][asynchronous-c-sharp].</span><span class="sxs-lookup"><span data-stu-id="45327-176">For more information on how to implement asynchronous programming in C#, see [Asynchronous Programming with async and await][asynchronous-c-sharp].</span></span>

## <a name="data-management"></a><span data-ttu-id="45327-177">Управление данными</span><span class="sxs-lookup"><span data-stu-id="45327-177">Data management</span></span>
* <span data-ttu-id="45327-178">**Изучите методы репликации источников данных приложения.**</span><span class="sxs-lookup"><span data-stu-id="45327-178">**Understand the replication methods for your application's data sources.**</span></span> <span data-ttu-id="45327-179">Данные приложения будут храниться в разных источниках данных и иметь разные требования к доступности.</span><span class="sxs-lookup"><span data-stu-id="45327-179">Your application data will be stored in different data sources and have different availability requirements.</span></span> <span data-ttu-id="45327-180">Проанализируйте методы репликации для каждого типа хранилища данных в Azure, включая [репликацию хранилища Azure](/azure/storage/storage-redundancy/) и [активную георепликацию для базы данных SQL](/azure/sql-database/sql-database-geo-replication-overview/), чтобы убедиться, что требования данных приложения выполняются.</span><span class="sxs-lookup"><span data-stu-id="45327-180">Evaluate the replication methods for each type of data storage in Azure, including [Azure Storage Replication](/azure/storage/storage-redundancy/) and [SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/) to ensure that your application's data requirements are satisfied.</span></span>
* <span data-ttu-id="45327-181">**Убедитесь, что ни одна учетная запись пользователя не имеет доступа к рабочим и резервным данным.**</span><span class="sxs-lookup"><span data-stu-id="45327-181">**Ensure that no single user account has access to both production and backup data.**</span></span> <span data-ttu-id="45327-182">Резервные копии данных будут скомпрометированы, если одна учетная запись пользователя имеет разрешение на запись как в источники рабочих данных разработки, так и в источники резервных копий.</span><span class="sxs-lookup"><span data-stu-id="45327-182">Your data backups are compromised if one single user account has permission to write to both production and backup sources.</span></span> <span data-ttu-id="45327-183">Злоумышленник может намеренно удалить все ваши данные, а обычный пользователь может сделать это случайно.</span><span class="sxs-lookup"><span data-stu-id="45327-183">A malicious user could purposely delete all your data, while a regular user could accidentally delete it.</span></span> <span data-ttu-id="45327-184">Создайте приложение для ограничения разрешений каждой учетной записи пользователя, чтобы только пользователи, которым требуется доступ на запись, имели доступ на запись только в рабочих или резервных данных, но не в обоих.</span><span class="sxs-lookup"><span data-stu-id="45327-184">Design your application to limit the permissions of each user account so that only the users that require write access have write access and it's only to either production or backup, but not both.</span></span>
* <span data-ttu-id="45327-185">**Документируйте процесс отработки отказа и восстановления размещения источника данных и протестируйте его.**</span><span class="sxs-lookup"><span data-stu-id="45327-185">**Document your data source fail over and fail back process and test it.**</span></span> <span data-ttu-id="45327-186">В случае, когда ваш источник данных полностью выходит из строя, оператору придется следовать набору документированных инструкций, чтобы выполнить отработку отказа и перейти к новому источнику данных.</span><span class="sxs-lookup"><span data-stu-id="45327-186">In the case where your data source fails catastrophically, a human operator will have to follow a set of documented instructions to fail over to a new data source.</span></span> <span data-ttu-id="45327-187">Если в задокументированных шагах есть ошибки, оператор не сможет успешно выполнить их и выполнить отработку отказа ресурса.</span><span class="sxs-lookup"><span data-stu-id="45327-187">If the documented steps have errors, an operator will not be able to successfully follow them and fail over the resource.</span></span> <span data-ttu-id="45327-188">Регулярно проверяйте шаги инструкции, чтобы убедиться, что оператор может успешно выполнить отработку отказа и восстановить размещение источника данных.</span><span class="sxs-lookup"><span data-stu-id="45327-188">Regularly test the instruction steps to verify that an operator following them is able to successfully fail over and fail back the data source.</span></span>
* <span data-ttu-id="45327-189">**Проверяйте резервные копии данных.**</span><span class="sxs-lookup"><span data-stu-id="45327-189">**Validate your data backups.**</span></span> <span data-ttu-id="45327-190">Регулярно проверяйте состояние резервных данных, запустив скрипт для проверки целостности данных, схемы и запросов.</span><span class="sxs-lookup"><span data-stu-id="45327-190">Regularly verify that your backup data is what you expect by running a script to validate data integrity, schema, and queries.</span></span> <span data-ttu-id="45327-191">Резервная копия не имеет смысла, если с ее помощью невозможно восстановить источники данных.</span><span class="sxs-lookup"><span data-stu-id="45327-191">There's no point having a backup if it's not useful to restore your data sources.</span></span> <span data-ttu-id="45327-192">Регистрируйте и сообщайте о любых несоответствиях, чтобы можно было устранить неисправность службы восстановления.</span><span class="sxs-lookup"><span data-stu-id="45327-192">Log and report any inconsistencies so the backup service can be repaired.</span></span>
* <span data-ttu-id="45327-193">**Рассмотрите возможность использования геоизбыточной учетной записи хранения.**</span><span class="sxs-lookup"><span data-stu-id="45327-193">**Consider using a storage account type that is geo-redundant.**</span></span> <span data-ttu-id="45327-194">Данные, хранящиеся в учетной записи хранения Azure, всегда реплицируются локально.</span><span class="sxs-lookup"><span data-stu-id="45327-194">Data stored in an Azure Storage account is always replicated locally.</span></span> <span data-ttu-id="45327-195">Однако существует несколько стратегий репликации, которые можно выбрать при подготовке учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="45327-195">However, there are multiple replication strategies to choose from when a Storage Account is provisioned.</span></span> <span data-ttu-id="45327-196">Выберите [геоизбыточное хранилище с доступом на чтение (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage) для защиты данных приложения в тех редких случаях, когда весь регион становится недоступным.</span><span class="sxs-lookup"><span data-stu-id="45327-196">Select [Azure Read-Access Geo Redundant Storage (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage) to protect your application data against the rare case when an entire region becomes unavailable.</span></span>

  > [!NOTE]
  > <span data-ttu-id="45327-197">Для виртуальных машин не следует полагаться на репликацию RA-GRS для восстановления дисков виртуальных машин (файлы VHD).</span><span class="sxs-lookup"><span data-stu-id="45327-197">For VMs, do not rely on RA-GRS replication to restore the VM disks (VHD files).</span></span> <span data-ttu-id="45327-198">Вместо этого используйте [Azure Backup][azure-backup].</span><span class="sxs-lookup"><span data-stu-id="45327-198">Instead, use [Azure Backup][azure-backup].</span></span>   
  >
  >

## <a name="security"></a><span data-ttu-id="45327-199">Безопасность</span><span class="sxs-lookup"><span data-stu-id="45327-199">Security</span></span>
* <span data-ttu-id="45327-200">**Реализуйте защиту на уровне приложения от атак типа "отказ в обслуживании" (DDoS).**</span><span class="sxs-lookup"><span data-stu-id="45327-200">**Implement application-level protection against distributed denial of service (DDoS) attacks.**</span></span> <span data-ttu-id="45327-201">Службы Azure защищены от атак DDoS на сетевом уровне.</span><span class="sxs-lookup"><span data-stu-id="45327-201">Azure services are protected against DDos attacks at the network layer.</span></span> <span data-ttu-id="45327-202">Тем не менее Azure не может защитить от атак на уровне приложений, потому что трудно отличить истинные запросы пользователей от вредоносных.</span><span class="sxs-lookup"><span data-stu-id="45327-202">However, Azure cannot protect against application-layer attacks, because it is difficult to distinguish between true user requests from malicious user requests.</span></span> <span data-ttu-id="45327-203">Дополнительные сведения о том, как обеспечить защиту от атак DDoS на уровне приложений, см. в разделе "Защита от атак DDoS" документа о [сетевой безопасности Microsoft Azure](http://download.microsoft.com/download/C/A/3/CA3FC5C0-ECE0-4F87-BF4B-D74064A00846/AzureNetworkSecurity_v3_Feb2015.pdf) (в формате PDF).</span><span class="sxs-lookup"><span data-stu-id="45327-203">For more information on how to protect against application-layer DDoS attacks, see the "Protecting against DDoS" section of [Microsoft Azure Network Security](http://download.microsoft.com/download/C/A/3/CA3FC5C0-ECE0-4F87-BF4B-D74064A00846/AzureNetworkSecurity_v3_Feb2015.pdf) (PDF download).</span></span>
* <span data-ttu-id="45327-204">**Реализуйте принцип наименьших привилегий для доступа к ресурсам приложения.**</span><span class="sxs-lookup"><span data-stu-id="45327-204">**Implement the principle of least privilege for access to the application's resources.**</span></span> <span data-ttu-id="45327-205">Значение по умолчанию для доступа к ресурсам приложения должно быть максимально ограничивающим.</span><span class="sxs-lookup"><span data-stu-id="45327-205">The default for access to the application's resources should be as restrictive as possible.</span></span> <span data-ttu-id="45327-206">Предоставляйте разрешения более высокого уровня на основе утверждения.</span><span class="sxs-lookup"><span data-stu-id="45327-206">Grant higher level permissions on an approval basis.</span></span> <span data-ttu-id="45327-207">Предоставление повышенных прав доступа к ресурсам приложения по умолчанию может привести к тому, что кто-то намеренно или случайно удалит ресурсы.</span><span class="sxs-lookup"><span data-stu-id="45327-207">Granting overly permissive access to your application's resources by default can result in someone purposely or accidentally deleting resources.</span></span> <span data-ttu-id="45327-208">Azure предоставляет [управление доступом на основе ролей](/azure/active-directory/role-based-access-built-in-roles/) для управления привилегиями пользователей, но важно проверить разрешения с минимальными привилегиями для других ресурсов с собственными системами разрешений, например SQL Server.</span><span class="sxs-lookup"><span data-stu-id="45327-208">Azure provides [role-based access control](/azure/active-directory/role-based-access-built-in-roles/) to manage user privileges, but it's important to verify least privilege permissions for other resources that have their own permissions systems such as SQL Server.</span></span>

## <a name="testing"></a><span data-ttu-id="45327-209">Тестирование</span><span class="sxs-lookup"><span data-stu-id="45327-209">Testing</span></span>
* <span data-ttu-id="45327-210">**Протестируйте отработку отказа и восстановление размещения для приложения.**</span><span class="sxs-lookup"><span data-stu-id="45327-210">**Perform failover and failback testing for your application.**</span></span> <span data-ttu-id="45327-211">Если вы еще не полностью протестировали отработку отказа и восстановление размещения, нельзя с уверенностью заявить, что зависимые службы в вашем приложении восстановят работу синхронизировано во время аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="45327-211">If you haven't fully tested failover and failback, you can't be certain that the dependent services in your application come back up in a synchronized manner during disaster recovery.</span></span> <span data-ttu-id="45327-212">Убедитесь в том, что зависимые службы приложения выполняют отработку отказа и восстановление размещения в правильном порядке.</span><span class="sxs-lookup"><span data-stu-id="45327-212">Ensure that your application's dependent services failover and fail back in the correct order.</span></span>
* <span data-ttu-id="45327-213">**Выполните тестирование путем внедрения ошибки в приложение.**</span><span class="sxs-lookup"><span data-stu-id="45327-213">**Perform fault-injection testing for your application.**</span></span> <span data-ttu-id="45327-214">Приложение может не работать по разным причинам, таким как истечение срока действия сертификата, исчерпание системных ресурсов в виртуальной машине или сбои хранилища.</span><span class="sxs-lookup"><span data-stu-id="45327-214">Your application can fail for many different reasons, such as certificate expiration, exhaustion of system resources in a VM, or storage failures.</span></span> <span data-ttu-id="45327-215">Протестируйте приложение в среде, максимально приближенной к рабочей, путем моделирования или запуска реальных сбоев.</span><span class="sxs-lookup"><span data-stu-id="45327-215">Test your application in an environment as close as possible to production, by simulating or triggering real failures.</span></span> <span data-ttu-id="45327-216">Например, удалите сертификаты, искусственно используйте системные ресурсы или удалите источник хранения.</span><span class="sxs-lookup"><span data-stu-id="45327-216">For example, delete certificates, artificially consume system resources, or delete a storage source.</span></span> <span data-ttu-id="45327-217">Проверьте способность вашего приложения восстанавливать все типы неисправностей автономно и в сочетании с различными методами.</span><span class="sxs-lookup"><span data-stu-id="45327-217">Verify your application's ability to recover from all types of faults, alone and in combination.</span></span> <span data-ttu-id="45327-218">Убедитесь, что ошибки не распространяются или не объединяются в вашей системе.</span><span class="sxs-lookup"><span data-stu-id="45327-218">Check that failures are not propagating or cascading through your system.</span></span>
* <span data-ttu-id="45327-219">**Выполните тестирования в среде разработки с использованием как синтетических, так и реальных пользовательских данных.**</span><span class="sxs-lookup"><span data-stu-id="45327-219">**Run tests in production using both synthetic and real user data.**</span></span> <span data-ttu-id="45327-220">Тестирование и разработка редко идентичны, поэтому важно использовать метод развертывания Blue-Green или раннее развертывание и тестировать приложение в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="45327-220">Test and production are rarely identical, so it's important to use blue/green or a canary deployment and test your application in production.</span></span> <span data-ttu-id="45327-221">Это позволяет протестировать приложение в рабочей среде с реальной нагрузкой и гарантировать, что оно будет функционировать должным образом после полного развертывания.</span><span class="sxs-lookup"><span data-stu-id="45327-221">This allows you to test your application in production under real load and ensure it will function as expected when fully deployed.</span></span>

## <a name="deployment"></a><span data-ttu-id="45327-222">Развертывание</span><span class="sxs-lookup"><span data-stu-id="45327-222">Deployment</span></span>
* <span data-ttu-id="45327-223">**Документируйте процесс выпуска вашего приложения.**</span><span class="sxs-lookup"><span data-stu-id="45327-223">**Document the release process for your application.**</span></span> <span data-ttu-id="45327-224">Без подробного документирования процесса выпуска оператор может развернуть неправильное обновление или неправильно настроить параметры вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-224">Without detailed release process documentation, an operator might deploy a bad update or improperly configure settings for your application.</span></span> <span data-ttu-id="45327-225">Четко определите и задокументируйте процесс выпуска и убедитесь, что он доступен для всей группы разработки.</span><span class="sxs-lookup"><span data-stu-id="45327-225">Clearly define and document your release process, and ensure that it's available to the entire operations team.</span></span> 
* <span data-ttu-id="45327-226">**Автоматизируйте процесс развертывания приложения.**</span><span class="sxs-lookup"><span data-stu-id="45327-226">**Automate your application's deployment process.**</span></span> <span data-ttu-id="45327-227">Если рабочий персонал должен вручную развертывать ваше приложение, человеческий фактор может привести к сбою развертывания.</span><span class="sxs-lookup"><span data-stu-id="45327-227">If your operations staff is required to manually deploy your application, human error can cause the deployment to fail.</span></span> 
* <span data-ttu-id="45327-228">**Разработайте процесс выпуска, максимально повышающий доступность приложений.**</span><span class="sxs-lookup"><span data-stu-id="45327-228">**Design your release process to maximize application availability.**</span></span> <span data-ttu-id="45327-229">Если процесс выпуска требует, чтобы службы отключались во время развертывания, ваше приложение будет недоступно, пока службы не вернутся в сеть.</span><span class="sxs-lookup"><span data-stu-id="45327-229">If your release process requires services to go offline during deployment, your application will be unavailable until they come back online.</span></span> <span data-ttu-id="45327-230">Используйте метод развертывания выпуска [Blue-Green](http://martinfowler.com/bliki/BlueGreenDeployment.html) или [раннее](http://martinfowler.com/bliki/CanaryRelease.html) развертывание для развертывания приложения в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="45327-230">Use the [blue/green](http://martinfowler.com/bliki/BlueGreenDeployment.html) or [canary release](http://martinfowler.com/bliki/CanaryRelease.html) deployment technique to deploy your application to production.</span></span> <span data-ttu-id="45327-231">Оба этих метода включают в себя развертывание кода выпуска вместе с рабочим кодом, чтобы пользователей кода выпуска можно было перенаправить в рабочий код в случае сбоя.</span><span class="sxs-lookup"><span data-stu-id="45327-231">Both of these techniques involve deploying your release code alongside production code so users of release code can be redirected to production code in the event of a failure.</span></span>
* <span data-ttu-id="45327-232">**Выполняйте регистрирование и аудит развертываний приложения.**</span><span class="sxs-lookup"><span data-stu-id="45327-232">**Log and audit your application's deployments.**</span></span> <span data-ttu-id="45327-233">Если вы используете промежуточные методы развертывания, такие как Blue-Green или ранние выпуски, в рабочей среде будет существовать несколько версий вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-233">If you use staged deployment techniques such as blue/green or canary releases there will be more than one version of your application running in production.</span></span> <span data-ttu-id="45327-234">Если возникает ошибка, очень важно определить, какая версия приложения вызвала ее.</span><span class="sxs-lookup"><span data-stu-id="45327-234">If a problem should occur, it's critical to determine which version of your application is causing a problem.</span></span> <span data-ttu-id="45327-235">Реализуйте надежную стратегию ведения журнала, чтобы получить как можно больше сведений о версии.</span><span class="sxs-lookup"><span data-stu-id="45327-235">Implement a robust logging strategy to capture as much version-specific information as possible.</span></span>
* <span data-ttu-id="45327-236">**Составьте план отката развертывания.**</span><span class="sxs-lookup"><span data-stu-id="45327-236">**Have a rollback plan for deployment.**</span></span> <span data-ttu-id="45327-237">Возможно, развертывание приложения может завершиться сбоем и привести к тому, что ваше приложение станет недоступно.</span><span class="sxs-lookup"><span data-stu-id="45327-237">It's possible that your application deployment could fail and cause your application to become unavailable.</span></span> <span data-ttu-id="45327-238">Создайте процесс отката, позволяющий вернуться к последней известной рабочей версии и минимизировать время простоя.</span><span class="sxs-lookup"><span data-stu-id="45327-238">Design a rollback process to go back to a last known good version and minimize downtime.</span></span> 

## <a name="operations"></a><span data-ttu-id="45327-239">Операции</span><span class="sxs-lookup"><span data-stu-id="45327-239">Operations</span></span>
* <span data-ttu-id="45327-240">**Реализуйте рекомендации по мониторингу и оповещению в приложении.**</span><span class="sxs-lookup"><span data-stu-id="45327-240">**Implement best practices for monitoring and alerting in your application.**</span></span> <span data-ttu-id="45327-241">Без надлежащего мониторинга, диагностики и оповещения невозможно обнаружить сбои в приложении и сообщить оператору об их устранении.</span><span class="sxs-lookup"><span data-stu-id="45327-241">Without proper monitoring, diagnostics, and alerting, there is no way to detect failures in your application and alert an operator to fix them.</span></span> <span data-ttu-id="45327-242">Дополнительные сведения см. в статье [Мониторинг и диагностика][monitoring-and-diagnostics-guidance].</span><span class="sxs-lookup"><span data-stu-id="45327-242">For more information, see [Monitoring and Diagnostics guidance][monitoring-and-diagnostics-guidance].</span></span>
* <span data-ttu-id="45327-243">**Измеряйте статистику удаленных вызовов, чтобы сделать информацию доступной команде разработки.**</span><span class="sxs-lookup"><span data-stu-id="45327-243">**Measure remote call statistics and make the information available to the application team.**</span></span>  <span data-ttu-id="45327-244">Если не отслеживать и не передавать статистику удаленных вызовов в режиме реального времени и не предоставлять простой способ просмотра этой информации, группа разработки не сможет мгновенно узнать о работоспособности вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-244">If you don't track and report remote call statistics in real time and provide an easy way to review this information, the operations team will not have an instantaneous view into the health of your application.</span></span> <span data-ttu-id="45327-245">Если вы измеряете среднее время удаленного вызова, у вас будет недостаточно информации для выявления проблем в службах.</span><span class="sxs-lookup"><span data-stu-id="45327-245">And if you only measure average remote call time, you will not have enough information to reveal issues in the services.</span></span> <span data-ttu-id="45327-246">Суммируйте показатели удаленного вызова, такие как задержка, пропускная способность и ошибки на уровне 99-го и 95-го процентилей.</span><span class="sxs-lookup"><span data-stu-id="45327-246">Summarize remote call metrics such as latency, throughput, and errors in the 99 and 95 percentiles.</span></span> <span data-ttu-id="45327-247">Выполните статистический анализ показателей, чтобы выявить ошибки, возникающие на каждом процентиле.</span><span class="sxs-lookup"><span data-stu-id="45327-247">Perform statistical analysis on the metrics to uncover errors that occur within each percentile.</span></span>
* <span data-ttu-id="45327-248">**Отслеживайте количество временных исключений и повторений за соответствующий временной интервал.**</span><span class="sxs-lookup"><span data-stu-id="45327-248">**Track the number of transient exceptions and retries over an appropriate timeframe.**</span></span> <span data-ttu-id="45327-249">Если вы не отслеживаете временные исключения и попытки повторения с течением времени, возможно, что проблема или сбой могут быть скрыты логикой повторения вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-249">If you don't track and monitor transient exceptions and retry attempts over time, it's possible that an issue or failure could be hidden by your application's retry logic.</span></span> <span data-ttu-id="45327-250">То есть, если мониторинг и ведение журнала показывают только успешность или неудачу операции, то тот факт, что операцию пришлось повторить несколько раз из-за исключений, будет скрыт.</span><span class="sxs-lookup"><span data-stu-id="45327-250">That is, if your monitoring and logging only shows success or failure of an operation, the fact that the operation had to be retried multiple times due to exceptions will be hidden.</span></span> <span data-ttu-id="45327-251">Тенденция увеличения исключений с течением времени указывает на то, что в службе возникла проблема и она может выйти из строя.</span><span class="sxs-lookup"><span data-stu-id="45327-251">A trend of increasing exceptions over time indicates that the service is having an issue and may fail.</span></span> <span data-ttu-id="45327-252">Дополнительные сведения см. в статье [Руководство по использованию механизма повторов для отдельных служб][retry-service-guidance].</span><span class="sxs-lookup"><span data-stu-id="45327-252">For more information, see [Retry service specific guidance][retry-service-guidance].</span></span>
* <span data-ttu-id="45327-253">**Реализуйте систему раннего предупреждения оператора.**</span><span class="sxs-lookup"><span data-stu-id="45327-253">**Implement an early warning system that alerts an operator.**</span></span> <span data-ttu-id="45327-254">Определите ключевые показатели эффективности вашего приложения, такие как временные исключения и задержка удаленного вызова, и установите соответствующие пороговые значения для каждого из них.</span><span class="sxs-lookup"><span data-stu-id="45327-254">Identify the key performance indicators of your application's health, such as transient exceptions and remote call latency, and set appropriate threshold values for each of them.</span></span> <span data-ttu-id="45327-255">Отправьте оповещение операциям при достижении порогового значения.</span><span class="sxs-lookup"><span data-stu-id="45327-255">Send an alert to operations when the threshold value is reached.</span></span> <span data-ttu-id="45327-256">Установите эти пороговые значения на уровнях, которые идентифицируют проблемы до того, как они станут критическими и потребуют мер восстановления.</span><span class="sxs-lookup"><span data-stu-id="45327-256">Set these thresholds at levels that identify issues before they become critical and require a recovery response.</span></span>
* <span data-ttu-id="45327-257">**Убедитесь, что в команде несколько специалистов обучено контролировать приложение и выполнять любые шаги восстановления вручную.**</span><span class="sxs-lookup"><span data-stu-id="45327-257">**Ensure that more than one person on the team is trained to monitor the application and perform any manual recovery steps.**</span></span> <span data-ttu-id="45327-258">Если в вашей команде есть только один оператор, который может контролировать приложение и запускать шаги восстановления, он становится единой точкой отказа.</span><span class="sxs-lookup"><span data-stu-id="45327-258">If you only have a single operator on the team who can monitor the application and kick off recovery steps, that person becomes a single point of failure.</span></span> <span data-ttu-id="45327-259">Обучите нескольких людей обнаружению и восстановлению и убедитесь, что в любой момент всегда есть как минимум один активный участник.</span><span class="sxs-lookup"><span data-stu-id="45327-259">Train multiple individuals on detection and recovery and make sure there is always at least one active at any time.</span></span>
* <span data-ttu-id="45327-260">**Убедитесь, что приложение не сталкивается с [ограничениями подписки Azure](/azure/azure-subscription-service-limits/).**</span><span class="sxs-lookup"><span data-stu-id="45327-260">**Ensure that your application does not run up against [Azure subscription limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="45327-261">В подписках Azure предусмотрены ограничения на определенные типы ресурсов, такие как количество групп ресурсов, количество ядер и количество учетных записей.</span><span class="sxs-lookup"><span data-stu-id="45327-261">Azure subscriptions have limits on certain resource types, such as number of resource groups, number of cores, and number of storage accounts.</span></span>  <span data-ttu-id="45327-262">Если ваши требования к приложениям превышают лимиты подписки Azure, создайте еще одну подписку Azure и подготовьте в ней достаточное количество ресурсов.</span><span class="sxs-lookup"><span data-stu-id="45327-262">If your application requirements exceed Azure subscription limits, create another Azure subscription and provision sufficient resources there.</span></span>
* <span data-ttu-id="45327-263">**Убедитесь, что приложение не сталкивается с [ограничениями для одной службы](/azure/azure-subscription-service-limits/).**</span><span class="sxs-lookup"><span data-stu-id="45327-263">**Ensure that your application does not run up against [per-service limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="45327-264">Отдельные службы Azure имеют ограничения на потребление, например ограничения на объем хранения, пропускную способность, количество подключений, запросы в секунду и другие показатели.</span><span class="sxs-lookup"><span data-stu-id="45327-264">Individual Azure services have consumption limits &mdash; for example, limits on storage, throughput, number of connections, requests per second, and other metrics.</span></span> <span data-ttu-id="45327-265">Приложение не будет работать, если оно попытается использовать ресурсы за пределами этих ограничений.</span><span class="sxs-lookup"><span data-stu-id="45327-265">Your application will fail if it attempts to use resources beyond these limits.</span></span> <span data-ttu-id="45327-266">Это приведет к регулированию службы и возможному простою для затронутых пользователей.</span><span class="sxs-lookup"><span data-stu-id="45327-266">This will result in service throttling and possible downtime for affected users.</span></span> <span data-ttu-id="45327-267">В зависимости от конкретной службы и требований приложений вы можете избежать этих ограничений путем вертикального (например, выбора другого уровня цен) или горизонтального масштабирования (добавления новых экземпляров).</span><span class="sxs-lookup"><span data-stu-id="45327-267">Depending on the specific service and your application requirements, you can often avoid these limits by scaling up (for example, choosing another pricing tier) or scaling out (adding new instances).</span></span>  
* <span data-ttu-id="45327-268">**Разрабатывайте требования к хранилищу приложений в соответствии целевыми показателями масштабируемости и производительности службы хранилища Azure.**</span><span class="sxs-lookup"><span data-stu-id="45327-268">**Design your application's storage requirements to fall within Azure storage scalability and performance targets.**</span></span> <span data-ttu-id="45327-269">Служба хранилища Azure предназначена для работы в рамках предопределенных целевых показателей масштабируемости и производительности, поэтому разрабатывайте приложение для использования хранилища в рамках этих показателей.</span><span class="sxs-lookup"><span data-stu-id="45327-269">Azure storage is designed to function within predefined scalability and performance targets, so design your application to utilize storage within those targets.</span></span> <span data-ttu-id="45327-270">При превышении этих целевых показателей хранилище приложения будет регулироваться.</span><span class="sxs-lookup"><span data-stu-id="45327-270">If you exceed these targets your application will experience storage throttling.</span></span> <span data-ttu-id="45327-271">Чтобы устранить эту проблему, подготовьте дополнительные учетные записи хранения.</span><span class="sxs-lookup"><span data-stu-id="45327-271">To fix this, provision additional Storage Accounts.</span></span> <span data-ttu-id="45327-272">Если вы столкнулись с лимитом учетной записи хранения, подготовьте дополнительные подписки Azure и дополнительные учетные записи хранения.</span><span class="sxs-lookup"><span data-stu-id="45327-272">If you run up against the Storage Account limit, provision additional Azure Subscriptions and then provision additional Storage Accounts there.</span></span> <span data-ttu-id="45327-273">Дополнительные сведения см. в статье [Целевые показатели масштабируемости и производительности службы хранилища Azure](/azure/storage/storage-scalability-targets/).</span><span class="sxs-lookup"><span data-stu-id="45327-273">For more information, see [Azure Storage Scalability and Performance Targets](/azure/storage/storage-scalability-targets/).</span></span>
* <span data-ttu-id="45327-274">**Выберите правильный размер виртуальной машины для своего приложения.**</span><span class="sxs-lookup"><span data-stu-id="45327-274">**Select the right VM size for your application.**</span></span> <span data-ttu-id="45327-275">Измерьте фактические показатели по использованию процессора, памяти, диску и операциям ввода-вывода ваших виртуальных машин в рабочей среде и убедитесь, что выбранный вами размер виртуальной машины достаточен.</span><span class="sxs-lookup"><span data-stu-id="45327-275">Measure the actual CPU, memory, disk, and I/O of your VMs in production and verify that the VM size you've selected is sufficient.</span></span> <span data-ttu-id="45327-276">В противном случае ваше приложение может испытывать проблемы с пропускной способностью при достижении ограничений в виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="45327-276">If not, your application may experience capacity issues as the VMs approach their limits.</span></span> <span data-ttu-id="45327-277">Размеры виртуальных машин подробно описываются в статье [Размеры виртуальных машин Windows в Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="45327-277">VM sizes are described in detail in [Sizes for virtual machines in Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>
* <span data-ttu-id="45327-278">**Определите, является ли рабочая нагрузка вашего приложения стабильной или колеблющейся с течением времени.**</span><span class="sxs-lookup"><span data-stu-id="45327-278">**Determine if your application's workload is stable or fluctuating over time.**</span></span> <span data-ttu-id="45327-279">Если ваша рабочая нагрузка изменяется с течением времени, используйте масштабируемые наборы виртуальных машин для автоматического масштабирования требуемого количества экземпляров виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="45327-279">If your workload fluctuates over time, use Azure VM scale sets to automatically scale the number of VM instances.</span></span> <span data-ttu-id="45327-280">В противном случае необходимо вручную увеличить или уменьшить число виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="45327-280">Otherwise, you will have to manually increase or decrease the number of VMs.</span></span> <span data-ttu-id="45327-281">Дополнительные сведения см. в статье [Общие сведения о масштабируемых наборах виртуальных машин в Azure](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span><span class="sxs-lookup"><span data-stu-id="45327-281">For more information, see the [Virtual Machine Scale Sets Overview](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span></span>
* <span data-ttu-id="45327-282">**Выберите соответствующий уровень служб для базы данных Azure SQL.**</span><span class="sxs-lookup"><span data-stu-id="45327-282">**Select the right service tier for Azure SQL Database.**</span></span> <span data-ttu-id="45327-283">Если приложение использует базу данных Azure SQL, убедитесь, что вы выбрали соответствующий уровень служб.</span><span class="sxs-lookup"><span data-stu-id="45327-283">If your application uses Azure SQL Database, ensure that you have selected the appropriate service tier.</span></span> <span data-ttu-id="45327-284">Если вы выберете уровень, который не сможет обрабатывать требования к единицам передачи данных приложения (DTU), использование данных будет регулироваться.</span><span class="sxs-lookup"><span data-stu-id="45327-284">If you select a tier that is not able to handle your application's database transaction unit (DTU) requirements, your data use will be throttled.</span></span> <span data-ttu-id="45327-285">Дополнительные сведения о выборе соответствующего плана служб см. в статье [Что такое уровни служб Базы данных SQL](/azure/sql-database/sql-database-service-tiers/).</span><span class="sxs-lookup"><span data-stu-id="45327-285">For more information on selecting the correct service plan, see [SQL Database options and performance: Understand what's available in each service tier](/azure/sql-database/sql-database-service-tiers/).</span></span>
* <span data-ttu-id="45327-286">**Создайте процесс для взаимодействия со службой поддержки Azure.**</span><span class="sxs-lookup"><span data-stu-id="45327-286">**Create a process for interacting with Azure support.**</span></span> <span data-ttu-id="45327-287">Если процесс обращения в [службу поддержки Azure](https://azure.microsoft.com/support/plans/) не установлен до того, как возникнет необходимость обратиться в службу поддержки, время простоя будет увеличиваться по мере того, как процесс обращения в службу поддержки будет применяться в первый раз.</span><span class="sxs-lookup"><span data-stu-id="45327-287">If the process for contacting [Azure support](https://azure.microsoft.com/support/plans/) is not set before the need to contact support arises, downtime will be prolonged as the support process is navigated for the first time.</span></span> <span data-ttu-id="45327-288">Изначально включите процесс обращения в службу поддержки и эскалацию проблем как часть отказоустойчивости вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-288">Include the process for contacting support and escalating issues as part of your application's resiliency from the outset.</span></span>
* <span data-ttu-id="45327-289">**Убедитесь, что приложение не использует больше максимального количества учетных записей для подписки.**</span><span class="sxs-lookup"><span data-stu-id="45327-289">**Ensure that your application doesn't use more than the maximum number of storage accounts per subscription.**</span></span> <span data-ttu-id="45327-290">Azure поддерживает не более 200 учетных записей хранения для подписки.</span><span class="sxs-lookup"><span data-stu-id="45327-290">Azure allows a maximum of 200 storage accounts per subscription.</span></span> <span data-ttu-id="45327-291">Если вашему приложению требуется больше учетных записей, чем в настоящее время доступно в вашей подписке, вам придется создать подписку и создать в ней дополнительные учетные записи хранения.</span><span class="sxs-lookup"><span data-stu-id="45327-291">If your application requires more storage accounts than are currently available in your subscription, you will have to create a new subscription and create additional storage accounts there.</span></span> <span data-ttu-id="45327-292">Дополнительные сведения см. в статье [Подписка Azure, границы, квоты и ограничения службы](/azure/azure-subscription-service-limits/#storage-limits).</span><span class="sxs-lookup"><span data-stu-id="45327-292">For more information, see [Azure subscription and service limits, quotas, and constraints](/azure/azure-subscription-service-limits/#storage-limits).</span></span>
* <span data-ttu-id="45327-293">**Убедитесь, что приложение не превышает целевые показатели масштабируемости для дисков виртуальной машины.**</span><span class="sxs-lookup"><span data-stu-id="45327-293">**Ensure that your application doesn't exceed the scalability targets for virtual machine disks.**</span></span> <span data-ttu-id="45327-294">Виртуальные машины Azure IaaS поддерживают подключение нескольких дисков данных в зависимости от ряда факторов, включая размер виртуальной машины и тип учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="45327-294">An Azure IaaS VM supports attaching a number of data disks depending on several factors, including the VM size and type of storage account.</span></span> <span data-ttu-id="45327-295">Если приложение превышает целевые показатели масштабируемости для дисков виртуальных машин, подготовьте дополнительные учетные записи хранения и создайте в них виртуальные диски.</span><span class="sxs-lookup"><span data-stu-id="45327-295">If your application exceeds the scalability targets for virtual machine disks, provision additional storage accounts and create the virtual machine disks there.</span></span> <span data-ttu-id="45327-296">Дополнительные сведения см. в статье [Целевые показатели масштабируемости и производительности службы хранилища Azure](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks).</span><span class="sxs-lookup"><span data-stu-id="45327-296">For more information, see [Azure Storage Scalability and Performance Targets](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks)</span></span>

## <a name="telemetry"></a><span data-ttu-id="45327-297">Телеметрия</span><span class="sxs-lookup"><span data-stu-id="45327-297">Telemetry</span></span>
* <span data-ttu-id="45327-298">**Регистрируйте данные телеметрии во время работы приложения в рабочей среде.**</span><span class="sxs-lookup"><span data-stu-id="45327-298">**Log telemetry data while the application is running in the production environment.**</span></span> <span data-ttu-id="45327-299">Сохраняйте надежные данные телеметрии во время работы приложения в рабочей среде. В противном случае у вас будет недостаточно информации, чтобы диагностировать причину проблем во время активного обслуживания пользователей в приложении.</span><span class="sxs-lookup"><span data-stu-id="45327-299">Capture robust telemetry information while the application is running in the production environment or you will not have sufficient information to diagnose the cause of issues while it's actively serving users.</span></span> <span data-ttu-id="45327-300">Дополнительные сведения см. в статье [Мониторинг и диагностика][monitoring-and-diagnostics-guidance].</span><span class="sxs-lookup"><span data-stu-id="45327-300">For more information, see [Monitoring and Diagnostics][monitoring-and-diagnostics-guidance].</span></span>
* <span data-ttu-id="45327-301">**Реализуйте ведение журнала с использованием асинхронного шаблона.**</span><span class="sxs-lookup"><span data-stu-id="45327-301">**Implement logging using an asynchronous pattern.**</span></span> <span data-ttu-id="45327-302">Если операции ведения журнала являются синхронными, они могут блокировать код приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-302">If logging operations are synchronous, they might block your application code.</span></span> <span data-ttu-id="45327-303">Убедитесь, что ведение журнала операций реализовано в виде асинхронных операций.</span><span class="sxs-lookup"><span data-stu-id="45327-303">Ensure that your logging operations are implemented as asynchronous operations.</span></span>
* <span data-ttu-id="45327-304">**Сопоставляйте данные журнала в границах служб.**</span><span class="sxs-lookup"><span data-stu-id="45327-304">**Correlate log data across service boundaries.**</span></span> <span data-ttu-id="45327-305">В типичном n-уровневом приложении пользовательский запрос может пересекать границы нескольких служб.</span><span class="sxs-lookup"><span data-stu-id="45327-305">In a typical n-tier application, a user request may traverse several service boundaries.</span></span> <span data-ttu-id="45327-306">Например, пользовательский запрос обычно возникает на веб-уровне и передается на бизнес-уровень и, наконец, сохраняется на уровне данных.</span><span class="sxs-lookup"><span data-stu-id="45327-306">For example, a user request typically originates in the web tier and is passed to the business tier and finally persisted in the data tier.</span></span> <span data-ttu-id="45327-307">В более сложных сценариях запрос пользователя может распространяться на множество различных служб и хранилищ данных.</span><span class="sxs-lookup"><span data-stu-id="45327-307">In more complex scenarios, a user request may be distributed to many different services and data stores.</span></span> <span data-ttu-id="45327-308">Убедитесь, что система ведения журнала сопоставляет вызовы в границах служб для отслеживания запроса в приложении.</span><span class="sxs-lookup"><span data-stu-id="45327-308">Ensure that your logging system correlates calls across service boundaries so you can track the request throughout your application.</span></span>

## <a name="azure-resources"></a><span data-ttu-id="45327-309">Ресурсы Azure</span><span class="sxs-lookup"><span data-stu-id="45327-309">Azure Resources</span></span>
* <span data-ttu-id="45327-310">**Используйте шаблоны Azure Resource Manager для подготовки ресурсов.**</span><span class="sxs-lookup"><span data-stu-id="45327-310">**Use Azure Resource Manager templates to provision resources.**</span></span> <span data-ttu-id="45327-311">Шаблоны Resource Manager облегчают автоматизирование развертываний с помощью PowerShell или Azure CLI, что обеспечивает более надежный процесс развертывания.</span><span class="sxs-lookup"><span data-stu-id="45327-311">Resource Manager templates make it easier to automate deployments via PowerShell or the Azure CLI, which leads to a more reliable deployment process.</span></span> <span data-ttu-id="45327-312">Дополнительные сведения см. в [обзоре Azure Resource Manager][resource-manager].</span><span class="sxs-lookup"><span data-stu-id="45327-312">For more information, see [Azure Resource Manager overview][resource-manager].</span></span>
* <span data-ttu-id="45327-313">**Присваивайте ресурсам информативные имена.**</span><span class="sxs-lookup"><span data-stu-id="45327-313">**Give resources meaningful names.**</span></span> <span data-ttu-id="45327-314">Это упростит поиск определенного ресурса и понимание его роли.</span><span class="sxs-lookup"><span data-stu-id="45327-314">Giving resources meaningful names makes it easier to locate a specific resource and understand its role.</span></span> <span data-ttu-id="45327-315">Дополнительные сведения см. в статье [Соглашения об именовании](../best-practices/naming-conventions.md).</span><span class="sxs-lookup"><span data-stu-id="45327-315">For more information, see [Naming conventions for Azure resources](../best-practices/naming-conventions.md)</span></span>
* <span data-ttu-id="45327-316">**Управление доступом на основе ролей (RBAC).**</span><span class="sxs-lookup"><span data-stu-id="45327-316">**Use role-based access control (RBAC).**</span></span> <span data-ttu-id="45327-317">Контролируйте доступ к развертываемым ресурсам Azure с помощью RBAC.</span><span class="sxs-lookup"><span data-stu-id="45327-317">Use RBAC to control access to the Azure resources that you deploy.</span></span> <span data-ttu-id="45327-318">RBAC позволяет назначать роли авторизации участникам команды DevOps, чтобы предотвратить случайное удаление или изменение развернутых ресурсов.</span><span class="sxs-lookup"><span data-stu-id="45327-318">RBAC lets you assign authorization roles to members of your DevOps team, to prevent accidental deletion or changes to deployed resources.</span></span> <span data-ttu-id="45327-319">Дополнительные сведения см. в статье [Начало работы с управлением доступом на основе ролей на портале Azure](/azure/active-directory/role-based-access-control-what-is/).</span><span class="sxs-lookup"><span data-stu-id="45327-319">For more information, see [Get started with access management in the Azure portal](/azure/active-directory/role-based-access-control-what-is/)</span></span>
* <span data-ttu-id="45327-320">**Используйте блокировки ресурсов для критических ресурсов, таких как виртуальные машины.**</span><span class="sxs-lookup"><span data-stu-id="45327-320">**Use resource locks for critical resources, such as VMs.**</span></span> <span data-ttu-id="45327-321">Блокировки ресурсов предотвращают случайное удаление ресурса оператором.</span><span class="sxs-lookup"><span data-stu-id="45327-321">Resource locks prevent an operator from accidentally deleting a resource.</span></span> <span data-ttu-id="45327-322">Дополнительные сведения см. в статье [Блокировка ресурсов для предотвращения непредвиденных изменений](/azure/azure-resource-manager/resource-group-lock-resources/).</span><span class="sxs-lookup"><span data-stu-id="45327-322">For more information, see [Lock resources with Azure Resource Manager](/azure/azure-resource-manager/resource-group-lock-resources/)</span></span>
* <span data-ttu-id="45327-323">**Выберите пары регионов.**</span><span class="sxs-lookup"><span data-stu-id="45327-323">**Choose regional pairs.**</span></span> <span data-ttu-id="45327-324">При развертывании в двух регионах выберите регионы из одной пары регионов.</span><span class="sxs-lookup"><span data-stu-id="45327-324">When deploying to two regions, choose regions from the same regional pair.</span></span> <span data-ttu-id="45327-325">На случай масштабного сбоя в каждой паре определяется приоритетный регион для восстановления.</span><span class="sxs-lookup"><span data-stu-id="45327-325">In the event of a broad outage, recovery of one region is prioritized out of every pair.</span></span> <span data-ttu-id="45327-326">Некоторые службы, например геоизбыточное хранилище, автоматически реплицируют данные в дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="45327-326">Some services such as Geo-Redundant Storage provide automatic replication to the paired region.</span></span> <span data-ttu-id="45327-327">Дополнительные сведения см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="45327-327">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions)</span></span>
* <span data-ttu-id="45327-328">**Организуйте группы ресурсов в соответствии с функциями и жизненным циклом.**</span><span class="sxs-lookup"><span data-stu-id="45327-328">**Organize resource groups by function and lifecycle.**</span></span>  <span data-ttu-id="45327-329">Как правило, группа ресурсов должна содержать ресурсы с одним и тем же жизненным циклом.</span><span class="sxs-lookup"><span data-stu-id="45327-329">In general, a resource group should contain resources that share the same lifecycle.</span></span> <span data-ttu-id="45327-330">Это упрощает управление развертываниями, удаление тестовых развертываний и назначение прав доступа, что снижает вероятность случайного удаления или изменения рабочего развертывания.</span><span class="sxs-lookup"><span data-stu-id="45327-330">This makes it easier to manage deployments, delete test deployments, and assign access rights, reducing the chance that a production deployment is accidentally deleted or modified.</span></span> <span data-ttu-id="45327-331">Создайте отдельные группы ресурсов для рабочей среды, сред разработки и тестирования.</span><span class="sxs-lookup"><span data-stu-id="45327-331">Create separate resource groups for production, development, and test environments.</span></span> <span data-ttu-id="45327-332">При развертывании в нескольких регионах поместите ресурсы для каждого региона в отдельные группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="45327-332">In a multi-region deployment, put resources for each region into separate resource groups.</span></span> <span data-ttu-id="45327-333">Это упрощает повторное развертывание в одном регионе, не затрагивая другие.</span><span class="sxs-lookup"><span data-stu-id="45327-333">This makes it easier to redeploy one region without affecting the other region(s).</span></span>

## <a name="azure-services"></a><span data-ttu-id="45327-334">Службы Azure</span><span class="sxs-lookup"><span data-stu-id="45327-334">Azure Services</span></span>
<span data-ttu-id="45327-335">Следующие элементы контрольного списка применяются к отдельным службам в Azure.</span><span class="sxs-lookup"><span data-stu-id="45327-335">The following checklist items apply to specific services in Azure.</span></span>

### <a name="app-service"></a><span data-ttu-id="45327-336">Служба приложений</span><span class="sxs-lookup"><span data-stu-id="45327-336">App Service</span></span>
* <span data-ttu-id="45327-337">**Уровень "Стандартный" или "Премиум".**</span><span class="sxs-lookup"><span data-stu-id="45327-337">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="45327-338">Эти уровни поддерживают промежуточные слоты и автоматическое резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="45327-338">These tiers support staging slots and automated backups.</span></span> <span data-ttu-id="45327-339">Дополнительные сведения см. в статье [Подробный обзор планов службы приложений Azure](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/).</span><span class="sxs-lookup"><span data-stu-id="45327-339">For more information, see [Azure App Service plans in-depth overview](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)</span></span>
* <span data-ttu-id="45327-340">**Избегайте увеличения или уменьшения масштаба.**</span><span class="sxs-lookup"><span data-stu-id="45327-340">**Avoid scaling up or down.**</span></span> <span data-ttu-id="45327-341">Вместо этого выберите уровень и размер экземпляра в соответствии с требованиями к производительности при типичной нагрузке, а затем выполните [горизонтальное масштабирование](/azure/app-service-web/web-sites-scale/) экземпляров для обработки изменений объема трафика.</span><span class="sxs-lookup"><span data-stu-id="45327-341">Instead, select a tier and instance size that meet your performance requirements under typical load, and then [scale out](/azure/app-service-web/web-sites-scale/) the instances to handle changes in traffic volume.</span></span> <span data-ttu-id="45327-342">Увеличение или уменьшение масштаба может вызвать перезапуск приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-342">Scaling up and down may trigger an application restart.</span></span>  
* <span data-ttu-id="45327-343">**Сохраняйте конфигурацию в виде настроек приложений.**</span><span class="sxs-lookup"><span data-stu-id="45327-343">**Store configuration as app settings.**</span></span> <span data-ttu-id="45327-344">Используйте настройки приложения, чтобы сохранить параметры конфигурации в качестве настроек приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-344">Use app settings to hold configuration settings as app settings.</span></span> <span data-ttu-id="45327-345">Определите параметры в шаблонах Resource Manager или с помощью PowerShell, чтобы применить их в процессе автоматического развертывания или обновления. Этот подход надежнее.</span><span class="sxs-lookup"><span data-stu-id="45327-345">Define the settings in your Resource Manager templates, or using PowerShell, so that you can apply them as part of an automated deployment / update process, which is more reliable.</span></span> <span data-ttu-id="45327-346">Дополнительные сведения см. в статье [Настройка веб-приложений в службе приложений Azure](/azure/app-service-web/web-sites-configure/).</span><span class="sxs-lookup"><span data-stu-id="45327-346">For more information, see [Configure web apps in Azure App Service](/azure/app-service-web/web-sites-configure/).</span></span>
* <span data-ttu-id="45327-347">**Используйте разные планы службы приложений для рабочей и тестовой сред.**</span><span class="sxs-lookup"><span data-stu-id="45327-347">**Create separate App Service plans for production and test.**</span></span> <span data-ttu-id="45327-348">Не используйте слоты в рабочем развертывании для тестирования.</span><span class="sxs-lookup"><span data-stu-id="45327-348">Don't use slots on your production deployment for testing.</span></span>  <span data-ttu-id="45327-349">Все приложения, которые находятся в одном плане службы приложений, совместно используют одни экземпляры виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="45327-349">All apps within the same App Service plan share the same VM instances.</span></span> <span data-ttu-id="45327-350">Если разместить рабочее и тестовое развертывание в одном плане, это может негативно повлиять на рабочее развертывание.</span><span class="sxs-lookup"><span data-stu-id="45327-350">If you put production and test deployments in the same plan, it can negatively affect the production deployment.</span></span> <span data-ttu-id="45327-351">Например, нагрузочные тесты могут привести к ухудшению производительности активного рабочего сайта.</span><span class="sxs-lookup"><span data-stu-id="45327-351">For example, load tests might degrade the live production site.</span></span> <span data-ttu-id="45327-352">Поместив тестовые развертывания в отдельный план, можно изолировать их от рабочей версии.</span><span class="sxs-lookup"><span data-stu-id="45327-352">By putting test deployments into a separate plan, you isolate them from the production version.</span></span>  
* <span data-ttu-id="45327-353">**Отделите веб-приложения от веб-API.**</span><span class="sxs-lookup"><span data-stu-id="45327-353">**Separate web apps from web APIs.**</span></span> <span data-ttu-id="45327-354">Если в решении есть как веб-интерфейс, так и веб-API, рассмотрите возможность их разбивки на отдельные приложения службы приложений.</span><span class="sxs-lookup"><span data-stu-id="45327-354">If your solution has both a web front-end and a web API, consider decomposing them into separate App Service apps.</span></span> <span data-ttu-id="45327-355">Такой подход помогает распределять решения по рабочим нагрузкам.</span><span class="sxs-lookup"><span data-stu-id="45327-355">This design makes it easier to decompose the solution by workload.</span></span> <span data-ttu-id="45327-356">Вы можете запускать веб-приложение и API в отдельных планах службы приложений, чтобы они могли масштабироваться независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="45327-356">You can run the web app and the API in separate App Service plans, so they can be scaled independently.</span></span> <span data-ttu-id="45327-357">Если изначально этот уровень масштабируемости не требуется, можно развертывать приложения в одном плане и позже переместить их в отдельные планы (при необходимости).</span><span class="sxs-lookup"><span data-stu-id="45327-357">If you don't need that level of scalability at first, you can deploy the apps into the same plan, and move them into separate plans later, if needed.</span></span>
* <span data-ttu-id="45327-358">**Избегайте использования функции резервного копирования службы приложений для резервного копирования баз данных Azure SQL.**</span><span class="sxs-lookup"><span data-stu-id="45327-358">**Avoid using the App Service backup feature to back up Azure SQL databases.**</span></span> <span data-ttu-id="45327-359">Вместо этого используйте [автоматическое резервное копирование базы данных SQL][sql-backup].</span><span class="sxs-lookup"><span data-stu-id="45327-359">Instead, use [SQL Database automated backups][sql-backup].</span></span> <span data-ttu-id="45327-360">При резервном копировании службы приложений база данных экспортируется в BACPAC-файл SQL, использующий единицы DTU.</span><span class="sxs-lookup"><span data-stu-id="45327-360">App Service backup exports the database to a SQL .bacpac file, which costs DTUs.</span></span>  
* <span data-ttu-id="45327-361">**Выполняйте развертывания в промежуточном слоте.**</span><span class="sxs-lookup"><span data-stu-id="45327-361">**Deploy to a staging slot.**</span></span> <span data-ttu-id="45327-362">Создайте слот развертывания для размещения в промежуточной среде.</span><span class="sxs-lookup"><span data-stu-id="45327-362">Create a deployment slot for staging.</span></span> <span data-ttu-id="45327-363">Разверните обновления приложений в промежуточном слоте и проверьте развертывание, прежде чем переносить его в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="45327-363">Deploy application updates to the staging slot, and verify the deployment before swapping it into production.</span></span> <span data-ttu-id="45327-364">Это снижает вероятность неправильного обновления в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="45327-364">This reduces the chance of a bad update in production.</span></span> <span data-ttu-id="45327-365">Это также гарантирует, что все экземпляры подготовлены перед перемещением в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="45327-365">It also ensures that all instances are warmed up before being swapped into production.</span></span> <span data-ttu-id="45327-366">Для многих приложений довольно долго выполняются начальная загрузка и "холодный" запуск.</span><span class="sxs-lookup"><span data-stu-id="45327-366">Many applications have a significant warmup and cold-start time.</span></span> <span data-ttu-id="45327-367">Дополнительные сведения см. в статье [Настройка промежуточных сред в службе приложений Azure](/azure/app-service-web/web-sites-staged-publishing/).</span><span class="sxs-lookup"><span data-stu-id="45327-367">For more information, see [Set up staging environments for web apps in Azure App Service](/azure/app-service-web/web-sites-staged-publishing/).</span></span>
* <span data-ttu-id="45327-368">**Создайте слот развертывания для хранения последнего известного корректного развертывания (LKG).**</span><span class="sxs-lookup"><span data-stu-id="45327-368">**Create a deployment slot to hold the last-known-good (LKG) deployment.**</span></span> <span data-ttu-id="45327-369">При развертывании обновления в рабочей среде переместите предыдущее рабочее развертывание в слот LKG.</span><span class="sxs-lookup"><span data-stu-id="45327-369">When you deploy an update to production, move the previous production deployment into the LKG slot.</span></span> <span data-ttu-id="45327-370">Это упрощает откат неправильного развертывания.</span><span class="sxs-lookup"><span data-stu-id="45327-370">This makes it easier to roll back a bad deployment.</span></span> <span data-ttu-id="45327-371">Если в дальнейшем обнаруживается проблема, можно быстро вернуться к версии LKG.</span><span class="sxs-lookup"><span data-stu-id="45327-371">If you discover a problem later, you can quickly revert to the LKG version.</span></span> <span data-ttu-id="45327-372">Дополнительные сведения см. в статье [Basic web application](../reference-architectures/app-service-web-app/basic-web-app.md) (Базовое веб-приложение).</span><span class="sxs-lookup"><span data-stu-id="45327-372">For more information, see [Basic web application](../reference-architectures/app-service-web-app/basic-web-app.md).</span></span>
* <span data-ttu-id="45327-373">**Включите ведение журнала диагностики**, в частности для приложения и веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="45327-373">**Enable diagnostics logging**, including application logging and web server logging.</span></span> <span data-ttu-id="45327-374">Ведение журнала важно для мониторинга и диагностики.</span><span class="sxs-lookup"><span data-stu-id="45327-374">Logging is important for monitoring and diagnostics.</span></span> <span data-ttu-id="45327-375">Ознакомьтесь со статьей [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](/azure/app-service-web/web-sites-enable-diagnostic-log/).</span><span class="sxs-lookup"><span data-stu-id="45327-375">See [Enable diagnostics logging for web apps in Azure App Service](/azure/app-service-web/web-sites-enable-diagnostic-log/)</span></span>
* <span data-ttu-id="45327-376">**Храните данные журнала в хранилище BLOB-объектов.**</span><span class="sxs-lookup"><span data-stu-id="45327-376">**Log to blob storage.**</span></span> <span data-ttu-id="45327-377">Это упрощает сбор и анализ данных.</span><span class="sxs-lookup"><span data-stu-id="45327-377">This makes it easier to collect and analyze the data.</span></span>
* <span data-ttu-id="45327-378">**Создайте отдельную учетную запись хранения для журналов.**</span><span class="sxs-lookup"><span data-stu-id="45327-378">**Create a separate storage account for logs.**</span></span> <span data-ttu-id="45327-379">Не используйте одну учетную запись хранения для журналов и данных приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-379">Don't use the same storage account for logs and application data.</span></span> <span data-ttu-id="45327-380">Это помогает предотвратить снижение производительности приложения из-за ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="45327-380">This helps to prevent logging from reducing application performance.</span></span>
* <span data-ttu-id="45327-381">**Отслеживайте производительность.**</span><span class="sxs-lookup"><span data-stu-id="45327-381">**Monitor performance.**</span></span> <span data-ttu-id="45327-382">Используйте службу мониторинга производительности, например [New Relic](http://newrelic.com/) или [Application Insights](/azure/application-insights/app-insights-overview/), чтобы контролировать производительность и поведение загруженных приложений.</span><span class="sxs-lookup"><span data-stu-id="45327-382">Use a performance monitoring service such as [New Relic](http://newrelic.com/) or [Application Insights](/azure/application-insights/app-insights-overview/) to monitor application performance and behavior under load.</span></span>  <span data-ttu-id="45327-383">Мониторинг производительности дает вам представление о приложении в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="45327-383">Performance monitoring gives you real-time insight into the application.</span></span> <span data-ttu-id="45327-384">Он позволяет диагностировать проблемы и выполнять анализ основной причины сбоев.</span><span class="sxs-lookup"><span data-stu-id="45327-384">It enables you to diagnose issues and perform root-cause analysis of failures.</span></span>

### <a name="application-gateway"></a><span data-ttu-id="45327-385">Шлюз приложений</span><span class="sxs-lookup"><span data-stu-id="45327-385">Application Gateway</span></span>
* <span data-ttu-id="45327-386">**Подготовьте по крайней мере два экземпляра.**</span><span class="sxs-lookup"><span data-stu-id="45327-386">**Provision at least two instances.**</span></span> <span data-ttu-id="45327-387">Разверните шлюз приложений как минимум с двумя экземплярами.</span><span class="sxs-lookup"><span data-stu-id="45327-387">Deploy Application Gateway with at least two instances.</span></span> <span data-ttu-id="45327-388">Один экземпляр является единой точкой отказа.</span><span class="sxs-lookup"><span data-stu-id="45327-388">A single instance is a single point of failure.</span></span> <span data-ttu-id="45327-389">Используйте два или более экземпляров для обеспечения избыточности и масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="45327-389">Use two or more instances for redundancy and scalability.</span></span> <span data-ttu-id="45327-390">В соответствии с [соглашением об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/) необходимо предоставить два или более экземпляров среднего или большего размера.</span><span class="sxs-lookup"><span data-stu-id="45327-390">In order to qualify for the [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/), you must provision two or more medium or larger instances.</span></span>

### <a name="azure-search"></a><span data-ttu-id="45327-391">поиск Azure;</span><span class="sxs-lookup"><span data-stu-id="45327-391">Azure Search</span></span>
* <span data-ttu-id="45327-392">**Подготовьте несколько реплик.**</span><span class="sxs-lookup"><span data-stu-id="45327-392">**Provision more than one replica.**</span></span> <span data-ttu-id="45327-393">Используйте как минимум две реплики, чтобы обеспечить высокую доступность операций чтения, или три, чтобы обеспечить высокую доступность операций чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="45327-393">Use at least two replicas for read high-availability, or three for read-write high-availability.</span></span>
* <span data-ttu-id="45327-394">**Настройте индексаторы для развертываний в нескольких регионах.**</span><span class="sxs-lookup"><span data-stu-id="45327-394">**Configure indexers for multi-region deployments.**</span></span> <span data-ttu-id="45327-395">Если имеется развертывание в нескольких регионах, рассмотрите варианты непрерывности индексирования.</span><span class="sxs-lookup"><span data-stu-id="45327-395">If you have a multi-region deployment, consider your options for continuity in indexing.</span></span>

  * <span data-ttu-id="45327-396">Если источник данных геореплицируется, вы должны, как правило, указывать для каждого индексатора каждой региональной службы поиска Azure свою локальную реплику источника данных.</span><span class="sxs-lookup"><span data-stu-id="45327-396">If the data source is geo-replicated, you should generally point each indexer of each regional Azure Search service to its local data source replica.</span></span> <span data-ttu-id="45327-397">Однако мы не рекомендуем использовать этот подход для больших наборов данных, хранящихся в базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="45327-397">However, that approach is not recommended for large datasets stored in Azure SQL Database.</span></span> <span data-ttu-id="45327-398">Причина в том, что служба "Поиск Azure" не может выполнить добавочное индексирование из вторичных реплик базы данных SQL, а только из первичной реплики.</span><span class="sxs-lookup"><span data-stu-id="45327-398">The reason is that Azure Search cannot perform incremental indexing from secondary SQL Database replicas, only from primary replicas.</span></span> <span data-ttu-id="45327-399">Вместо этого укажите для всех индексаторов первичную реплику.</span><span class="sxs-lookup"><span data-stu-id="45327-399">Instead, point all indexers to the primary replica.</span></span> <span data-ttu-id="45327-400">После отработки отказа укажите для индексаторов службы "Поиск Azure" новую первичную реплику.</span><span class="sxs-lookup"><span data-stu-id="45327-400">After a failover, point the Azure Search indexers at the new primary replica.</span></span>  
  * <span data-ttu-id="45327-401">Если источник данных не геореплицируется, укажите для нескольких индексаторов один источник данных, чтобы службы Поиска Azure в нескольких регионах непрерывно и независимо индексировали источник данных.</span><span class="sxs-lookup"><span data-stu-id="45327-401">If the data source is not geo-replicated, point multiple indexers at the same data source, so that Azure Search services in multiple regions continuously and independently index from the data source.</span></span> <span data-ttu-id="45327-402">Дополнительные сведения см. в статье [Рекомендации по производительности и оптимизации Поиска Azure][search-optimization].</span><span class="sxs-lookup"><span data-stu-id="45327-402">For more information, see [Azure Search performance and optimization considerations][search-optimization].</span></span>

### <a name="azure-storage"></a><span data-ttu-id="45327-403">Хранилище Azure</span><span class="sxs-lookup"><span data-stu-id="45327-403">Azure Storage</span></span>
* <span data-ttu-id="45327-404">Используйте **геоизбыточное хранилище с доступом для чтения** для данных приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-404">**For application data, use read-access geo-redundant storage (RA-GRS).**</span></span> <span data-ttu-id="45327-405">Хранилище RA-GRS реплицирует данные в дополнительный регион и предоставляет доступ только для чтения из вторичного региона.</span><span class="sxs-lookup"><span data-stu-id="45327-405">RA-GRS storage replicates the data to a secondary region, and provides read-only access from the secondary region.</span></span> <span data-ttu-id="45327-406">При наличии доступа к хранилищу в первичном регионе приложение может считывать данные из вторичного региона.</span><span class="sxs-lookup"><span data-stu-id="45327-406">If there is a storage outage in the primary region, the application can read the data from the secondary region.</span></span> <span data-ttu-id="45327-407">Дополнительные сведения см. в статье [Репликация службы хранилища Azure](/azure/storage/storage-redundancy/).</span><span class="sxs-lookup"><span data-stu-id="45327-407">For more information, see [Azure Storage replication](/azure/storage/storage-redundancy/).</span></span>
* <span data-ttu-id="45327-408">**Используйте управляемые диски в качестве дисков виртуальных машин.**</span><span class="sxs-lookup"><span data-stu-id="45327-408">**For VM disks, use Managed Disks.**</span></span> <span data-ttu-id="45327-409">Служба [Управляемые диски][managed-disks] обеспечивает более высокую надежность виртуальных машин в группах доступности, так как диски достаточно изолированы друг от друга, что позволяет избежать единой точки отказа.</span><span class="sxs-lookup"><span data-stu-id="45327-409">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="45327-410">Кроме того, управляемые диски не подпадают под ограничения операций ввода-вывода в секунду для виртуальных жестких дисков (VHD), созданных в учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="45327-410">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="45327-411">Дополнительные сведения см. в статье [Управление доступностью виртуальных машин Windows в Azure][vm-manage-availability].</span><span class="sxs-lookup"><span data-stu-id="45327-411">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>
* <span data-ttu-id="45327-412">**Создайте резервную очередь в другом регионе, чтобы создать хранилище очередей.**</span><span class="sxs-lookup"><span data-stu-id="45327-412">**For Queue storage, create a backup queue in another region.**</span></span> <span data-ttu-id="45327-413">Для хранилища очередей реплика, предназначенная только для чтения, ограничена в использовании, так как вы не можете ставить элементы в очередь или удалять их из нее.</span><span class="sxs-lookup"><span data-stu-id="45327-413">For Queue storage, a read-only replica has limited use, because you can't queue or dequeue items.</span></span> <span data-ttu-id="45327-414">Вместо этого создайте резервную очередь в учетной записи хранения в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="45327-414">Instead, create a backup queue in a storage account in another region.</span></span> <span data-ttu-id="45327-415">При отказе хранилища приложение может использовать резервную очередь, пока основной регион снова не станет доступен.</span><span class="sxs-lookup"><span data-stu-id="45327-415">If there is a storage outage, the application can use the backup queue, until the primary region becomes available again.</span></span> <span data-ttu-id="45327-416">Таким образом приложение может обрабатывать новые запросы.</span><span class="sxs-lookup"><span data-stu-id="45327-416">That way, the application can still process new requests.</span></span>  

### <a name="cosmos-db"></a><span data-ttu-id="45327-417">База данных Cosmos</span><span class="sxs-lookup"><span data-stu-id="45327-417">Cosmos DB</span></span>
* <span data-ttu-id="45327-418">**Реплицируйте базу данных в разные регионы.**</span><span class="sxs-lookup"><span data-stu-id="45327-418">**Replicate the database across regions.**</span></span> <span data-ttu-id="45327-419">Cosmos DB позволяет связать любое количество регионов Azure с учетной записью базы данных Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="45327-419">Cosmos DB allows you to associate any number of Azure regions with a Cosmos DB database account.</span></span> <span data-ttu-id="45327-420">База данных Cosmos DB может иметь один регион записи и несколько регионов чтения.</span><span class="sxs-lookup"><span data-stu-id="45327-420">A Cosmos DB database can have one write region and multiple read regions.</span></span> <span data-ttu-id="45327-421">В случае сбоя в регионе записи можно выполнять чтение из другой реплики.</span><span class="sxs-lookup"><span data-stu-id="45327-421">If there is a failure in the write region, you can read from another replica.</span></span> <span data-ttu-id="45327-422">Клиентский пакет SDK обрабатывает это автоматически.</span><span class="sxs-lookup"><span data-stu-id="45327-422">The Client SDK handles this automatically.</span></span> <span data-ttu-id="45327-423">Кроме того, можно выполнить отработку отказа региона записи в другой регион.</span><span class="sxs-lookup"><span data-stu-id="45327-423">You can also fail over the write region to another region.</span></span> <span data-ttu-id="45327-424">Дополнительные сведения см. в статье [Как работает глобальное распределение данных в Azure с помощью Cosmos DB](/azure/documentdb/documentdb-distribute-data-globally).</span><span class="sxs-lookup"><span data-stu-id="45327-424">For more information, see [How to distribute data globally with Azure Cosmos DB?](/azure/documentdb/documentdb-distribute-data-globally)</span></span>

### <a name="sql-database"></a><span data-ttu-id="45327-425">База данных SQL</span><span class="sxs-lookup"><span data-stu-id="45327-425">SQL Database</span></span>
* <span data-ttu-id="45327-426">**Уровень "Стандартный" или "Премиум".**</span><span class="sxs-lookup"><span data-stu-id="45327-426">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="45327-427">Эти уровни обеспечивают более длительный период восстановления на определенный момент времени (35 дней).</span><span class="sxs-lookup"><span data-stu-id="45327-427">These tiers provide a longer point-in-time restore period (35 days).</span></span> <span data-ttu-id="45327-428">Дополнительные сведения см. в статье [Что такое уровни служб Базы данных SQL](/azure/sql-database/sql-database-service-tiers/).</span><span class="sxs-lookup"><span data-stu-id="45327-428">For more information, see [SQL Database options and performance](/azure/sql-database/sql-database-service-tiers/).</span></span>
* <span data-ttu-id="45327-429">**Включите аудит базы данных SQL.**</span><span class="sxs-lookup"><span data-stu-id="45327-429">**Enable SQL Database auditing.**</span></span> <span data-ttu-id="45327-430">Аудит может использоваться для диагностики вредоносных атак или ошибки из-за человеческого фактора.</span><span class="sxs-lookup"><span data-stu-id="45327-430">Auditing can be used to diagnose malicious attacks or human error.</span></span> <span data-ttu-id="45327-431">Дополнительные сведения см. в статье [Приступая к работе с аудитом базы данных SQL](/azure/sql-database/sql-database-auditing-get-started/).</span><span class="sxs-lookup"><span data-stu-id="45327-431">For more information, see [Get started with SQL database auditing](/azure/sql-database/sql-database-auditing-get-started/).</span></span>
* <span data-ttu-id="45327-432">Используйте **активную георепликацию**, чтобы создать доступную для чтения вторичную реплику в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="45327-432">**Use Active Geo-Replication** Use Active Geo-Replication to create a readable secondary in a different region.</span></span>  <span data-ttu-id="45327-433">Если произойдет сбой вашей базы данных-источника (или вам просто потребуется перевести ее в автономный режим), выполните отработку отказа в ручном режиме в любую базу данных-получатель.</span><span class="sxs-lookup"><span data-stu-id="45327-433">If your primary database fails, or simply needs to be taken offline, perform a manual failover to the secondary database.</span></span>  <span data-ttu-id="45327-434">До отработки отказа база данных-получатель остается доступной только для чтения.</span><span class="sxs-lookup"><span data-stu-id="45327-434">Until you fail over, the secondary database remains read-only.</span></span>  <span data-ttu-id="45327-435">Дополнительные сведения см. в статье [Обзор. Группы отработки отказа и активная георепликация](/azure/sql-database/sql-database-geo-replication-overview/).</span><span class="sxs-lookup"><span data-stu-id="45327-435">For more information, see [SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/).</span></span>
* <span data-ttu-id="45327-436">**Используйте сегментирование.**</span><span class="sxs-lookup"><span data-stu-id="45327-436">**Use sharding.**</span></span> <span data-ttu-id="45327-437">Рассмотрите возможность использования сегментирования для горизонтального секционирования базы данных.</span><span class="sxs-lookup"><span data-stu-id="45327-437">Consider using sharding to partition the database horizontally.</span></span> <span data-ttu-id="45327-438">Сегментирование может обеспечить изоляцию от сбоев.</span><span class="sxs-lookup"><span data-stu-id="45327-438">Sharding can provide fault isolation.</span></span> <span data-ttu-id="45327-439">Дополнительные сведения см. в статье [Развертывание с помощью Базы данных SQL Azure](/azure/sql-database/sql-database-elastic-scale-introduction/).</span><span class="sxs-lookup"><span data-stu-id="45327-439">For more information, see [Scaling out with Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction/).</span></span>
* <span data-ttu-id="45327-440">**Используйте восстановление до точки во времени для восстановления после ошибки пользователя.**</span><span class="sxs-lookup"><span data-stu-id="45327-440">**Use point-in-time restore to recover from human error.**</span></span>  <span data-ttu-id="45327-441">При восстановлении до точки во времени база данных возвращается в состояние на более ранний момент времени.</span><span class="sxs-lookup"><span data-stu-id="45327-441">Point-in-time restore returns your database to an earlier point in time.</span></span> <span data-ttu-id="45327-442">Дополнительные сведения см. в статье [Восстановление базы данных Azure SQL с помощью создаваемых автоматически резервных копий][sql-restore].</span><span class="sxs-lookup"><span data-stu-id="45327-442">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>
* <span data-ttu-id="45327-443">**Используйте геовосстановление для восстановления после сбоя службы.**</span><span class="sxs-lookup"><span data-stu-id="45327-443">**Use geo-restore to recover from a service outage.**</span></span> <span data-ttu-id="45327-444">При геовосстановлении база данных восстанавливается из геоизбыточной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="45327-444">Geo-restore restores a database from a geo-redundant backup.</span></span>  <span data-ttu-id="45327-445">Дополнительные сведения см. в статье [Восстановление базы данных Azure SQL с помощью создаваемых автоматически резервных копий][sql-restore].</span><span class="sxs-lookup"><span data-stu-id="45327-445">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

### <a name="sql-server-running-in-a-vm"></a><span data-ttu-id="45327-446">SQL Server (на виртуальной машине)</span><span class="sxs-lookup"><span data-stu-id="45327-446">SQL Server (running in a VM)</span></span>
* <span data-ttu-id="45327-447">**Реплицируйте базу данных.**</span><span class="sxs-lookup"><span data-stu-id="45327-447">**Replicate the database.**</span></span> <span data-ttu-id="45327-448">Используйте группы доступности Always On SQL Server для репликации базы данных.</span><span class="sxs-lookup"><span data-stu-id="45327-448">Use SQL Server Always On Availability Groups to replicate the database.</span></span> <span data-ttu-id="45327-449">При сбое в одном экземпляре SQL Server они обеспечивают высокий уровень доступности.</span><span class="sxs-lookup"><span data-stu-id="45327-449">Provides high availability if one SQL Server instance fails.</span></span> <span data-ttu-id="45327-450">Дополнительные сведения см. в статье [Запуск виртуальных машин Windows для n-уровневого приложения](../reference-architectures/virtual-machines-windows/n-tier.md).</span><span class="sxs-lookup"><span data-stu-id="45327-450">For more information, see [Run Windows VMs for an N-tier application](../reference-architectures/virtual-machines-windows/n-tier.md)</span></span>
* <span data-ttu-id="45327-451">**Архивируйте базу данных.**</span><span class="sxs-lookup"><span data-stu-id="45327-451">**Back up the database**.</span></span> <span data-ttu-id="45327-452">Если вы уже используете службу [Azure Backup](https://azure.microsoft.com/documentation/services/backup/) для архивации виртуальных машин, рассмотрите возможность ее использования [для рабочих нагрузок SQL Server с помощью DPM](/azure/backup/backup-azure-backup-sql/).</span><span class="sxs-lookup"><span data-stu-id="45327-452">If you are already using [Azure Backup](https://azure.microsoft.com/documentation/services/backup/) to back up your VMs, consider using [Azure Backup for SQL Server workloads using DPM](/azure/backup/backup-azure-backup-sql/).</span></span> <span data-ttu-id="45327-453">При таком подходе используется одна роль администратора архивации для организации и единая процедура восстановления для виртуальных машин и SQL Server.</span><span class="sxs-lookup"><span data-stu-id="45327-453">With this approach, there is one backup administrator role for the organization and a unified recovery procedure for VMs and SQL Server.</span></span> <span data-ttu-id="45327-454">В противном случае используйте [управляемое резервное копирование SQL Server в Microsoft Azure](https://msdn.microsoft.com/library/dn449496.aspx).</span><span class="sxs-lookup"><span data-stu-id="45327-454">Otherwise, use [SQL Server Managed Backup to Microsoft Azure](https://msdn.microsoft.com/library/dn449496.aspx).</span></span>

### <a name="traffic-manager"></a><span data-ttu-id="45327-455">Диспетчер трафика</span><span class="sxs-lookup"><span data-stu-id="45327-455">Traffic Manager</span></span>
* <span data-ttu-id="45327-456">**Выполняйте восстановление размещения вручную.**</span><span class="sxs-lookup"><span data-stu-id="45327-456">**Perform manual failback.**</span></span> <span data-ttu-id="45327-457">После отработки отказа диспетчера трафика выполните восстановление размещения вручную, а не автоматически.</span><span class="sxs-lookup"><span data-stu-id="45327-457">After a Traffic Manager failover, perform manual failback, rather than automatically failing back.</span></span> <span data-ttu-id="45327-458">Убедитесь, что все подсистемы приложения полностью работоспособны, и лишь затем выполните восстановление размещения.</span><span class="sxs-lookup"><span data-stu-id="45327-458">Before failing back, verify that all application subsystems are healthy.</span></span>  <span data-ttu-id="45327-459">В противном случае могут возникнуть ситуации, в которых приложение будет переходить между центрами обработки данных.</span><span class="sxs-lookup"><span data-stu-id="45327-459">Otherwise, you can create a situation where the application flips back and forth between data centers.</span></span> <span data-ttu-id="45327-460">Дополнительные сведения см. в статье [Запуск виртуальных машин Windows в нескольких регионах для обеспечения высокой доступности](../reference-architectures/virtual-machines-windows/multi-region-application.md).</span><span class="sxs-lookup"><span data-stu-id="45327-460">For more information, see [Run VMs in multiple regions for high availability](../reference-architectures/virtual-machines-windows/multi-region-application.md).</span></span>
* <span data-ttu-id="45327-461">**Создайте конечную точку проверки работоспособности.**</span><span class="sxs-lookup"><span data-stu-id="45327-461">**Create a health probe endpoint.**</span></span> <span data-ttu-id="45327-462">Создайте пользовательскую конечную точку, которая сообщает об общей работоспособности приложения.</span><span class="sxs-lookup"><span data-stu-id="45327-462">Create a custom endpoint that reports on the overall health of the application.</span></span> <span data-ttu-id="45327-463">Это позволяет диспетчеру трафика выполнить отработку отказа при сбое любого критического пути, а не только внешнего интерфейса.</span><span class="sxs-lookup"><span data-stu-id="45327-463">This enables Traffic Manager to fail over if any critical path fails, not just the front end.</span></span> <span data-ttu-id="45327-464">Конечная точка должна возвращать код ошибки HTTP, если какая-либо критическая зависимость неработоспособна или недоступна.</span><span class="sxs-lookup"><span data-stu-id="45327-464">The endpoint should return an HTTP error code if any critical dependency is unhealthy or unreachable.</span></span> <span data-ttu-id="45327-465">Однако не сообщайте об ошибках некритических служб.</span><span class="sxs-lookup"><span data-stu-id="45327-465">Don't report errors for non-critical services, however.</span></span> <span data-ttu-id="45327-466">В противном случае проверка работоспособности может вызвать ненужную отработку отказа, создавая ложные срабатывания.</span><span class="sxs-lookup"><span data-stu-id="45327-466">Otherwise, the health probe might trigger failover when it's not needed, creating false positives.</span></span> <span data-ttu-id="45327-467">Дополнительные сведения см. в статье [Мониторинг конечных точек в диспетчере трафика](/azure/traffic-manager/traffic-manager-monitoring/).</span><span class="sxs-lookup"><span data-stu-id="45327-467">For more information, see [Traffic Manager endpoint monitoring and failover](/azure/traffic-manager/traffic-manager-monitoring/).</span></span>

### <a name="virtual-machines"></a><span data-ttu-id="45327-468">Виртуальные машины</span><span class="sxs-lookup"><span data-stu-id="45327-468">Virtual Machines</span></span>
* <span data-ttu-id="45327-469">**Не выполняйте рабочую нагрузку на одной виртуальной машине.**</span><span class="sxs-lookup"><span data-stu-id="45327-469">**Avoid running a production workload on a single VM.**</span></span> <span data-ttu-id="45327-470">Одно развертывание виртуальной машины неустойчиво при плановом или внеплановом обслуживании.</span><span class="sxs-lookup"><span data-stu-id="45327-470">A single VM deployment is not resilient to planned or unplanned maintenance.</span></span> <span data-ttu-id="45327-471">Вместо этого поместите несколько виртуальных машин в группу доступности или [масштабируемый набор виртуальных машин](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/) перед подсистемой балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="45327-471">Instead, put multiple VMs in an availability set or [VM scale set](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/), with a load balancer in front.</span></span>
* <span data-ttu-id="45327-472">**Укажите группу доступности при подготовке виртуальной машины.**</span><span class="sxs-lookup"><span data-stu-id="45327-472">**Specify an availability set when you provision the VM.**</span></span> <span data-ttu-id="45327-473">В настоящее время после подготовки виртуальную машину невозможно добавить в группу доступности.</span><span class="sxs-lookup"><span data-stu-id="45327-473">Currently, there is no way to add a VM to an availability set after the VM is provisioned.</span></span> <span data-ttu-id="45327-474">Добавляя новую виртуальную машину в имеющуюся группу доступности, обязательно создайте сетевую карту для виртуальной машины и добавьте ее в серверный пул адресов в подсистеме балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="45327-474">When you add a new VM to an existing availability set, make sure to create a NIC for the VM, and add the NIC to the back-end address pool on the load balancer.</span></span> <span data-ttu-id="45327-475">В противном случае подсистема балансировки нагрузки не будет маршрутизировать сетевой трафик на эту виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="45327-475">Otherwise, the load balancer won't route network traffic to that VM.</span></span>
* <span data-ttu-id="45327-476">**Поместите каждый уровень приложения в отдельных группах доступности.**</span><span class="sxs-lookup"><span data-stu-id="45327-476">**Put each application tier into a separate Availability Set.**</span></span> <span data-ttu-id="45327-477">В n-уровневом приложении не следует размещать виртуальные машины из разных уровней в одной группе доступности.</span><span class="sxs-lookup"><span data-stu-id="45327-477">In an N-tier application, don't put VMs from different tiers into the same availability set.</span></span> <span data-ttu-id="45327-478">Виртуальные машины в группе доступности располагаются в доменах сбоя и доменах обновления.</span><span class="sxs-lookup"><span data-stu-id="45327-478">VMs in an availability set are placed across fault domains (FDs) and update domains (UD).</span></span> <span data-ttu-id="45327-479">Тем не менее, чтобы получить преимущества избыточности этих доменов, каждая виртуальная машина в группе доступности должна иметь возможность обрабатывать одни и те же клиентские запросы.</span><span class="sxs-lookup"><span data-stu-id="45327-479">However, to get the redundancy benefit of FDs and UDs, every VM in the availability set must be able to handle the same client requests.</span></span>
* <span data-ttu-id="45327-480">**Выберите подходящий размер виртуальной машины в соответствии с требованиями к производительности.**</span><span class="sxs-lookup"><span data-stu-id="45327-480">**Choose the right VM size based on performance requirements.**</span></span> <span data-ttu-id="45327-481">При перемещении имеющейся рабочей нагрузки в Azure выберите начальный размер виртуальной машины, который больше всего соответствует вашим локальным серверам.</span><span class="sxs-lookup"><span data-stu-id="45327-481">When moving an existing workload to Azure, start with the VM size that's the closest match to your on-premises servers.</span></span> <span data-ttu-id="45327-482">Затем измерьте производительность фактической рабочей нагрузки по таким ресурсам, как потребление ЦП, памяти и дисковых операций ввода-вывода в секунду, и при необходимости измените размер виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="45327-482">Then measure the performance of your actual workload with respect to CPU, memory, and disk IOPS, and adjust the size if needed.</span></span> <span data-ttu-id="45327-483">Это гарантирует, что приложение будет правильно работать в облачной среде.</span><span class="sxs-lookup"><span data-stu-id="45327-483">This helps to ensure the application behaves as expected in a cloud environment.</span></span> <span data-ttu-id="45327-484">Кроме того, если требуется использовать несколько сетевых карт, то учтите ограничения на количество сетевых карт для каждого размера.</span><span class="sxs-lookup"><span data-stu-id="45327-484">Also, if you need multiple NICs, be aware of the NIC limit for each size.</span></span>
* <span data-ttu-id="45327-485">**Используйте управляемые диски для VHD.**</span><span class="sxs-lookup"><span data-stu-id="45327-485">**Use Managed Disks for VHDs.**</span></span> <span data-ttu-id="45327-486">Служба [Управляемые диски][managed-disks] обеспечивает более высокую надежность виртуальных машин в группах доступности, так как диски достаточно изолированы друг от друга, что позволяет избежать единой точки отказа.</span><span class="sxs-lookup"><span data-stu-id="45327-486">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="45327-487">Кроме того, управляемые диски не подпадают под ограничения операций ввода-вывода в секунду для виртуальных жестких дисков (VHD), созданных в учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="45327-487">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="45327-488">Дополнительные сведения см. в статье [Управление доступностью виртуальных машин Windows в Azure][vm-manage-availability].</span><span class="sxs-lookup"><span data-stu-id="45327-488">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>
* <span data-ttu-id="45327-489">**Устанавливайте приложения на диск данных, а не на диск операционной системы.**</span><span class="sxs-lookup"><span data-stu-id="45327-489">**Install applications on a data disk, not the OS disk.**</span></span> <span data-ttu-id="45327-490">В противном случае можно превысить предельный размер диска.</span><span class="sxs-lookup"><span data-stu-id="45327-490">Otherwise, you may reach the disk size limit.</span></span>
* <span data-ttu-id="45327-491">**Используйте службу Azure Backup для архивации виртуальных машин.**</span><span class="sxs-lookup"><span data-stu-id="45327-491">**Use Azure Backup to back up VMs.**</span></span> <span data-ttu-id="45327-492">Резервные копии позволяют обеспечить защиту от случайной потери данных.</span><span class="sxs-lookup"><span data-stu-id="45327-492">Backups protect against accidental data loss.</span></span> <span data-ttu-id="45327-493">Дополнительные сведения см. в статье [Архивация виртуальных машин Azure в хранилище служб восстановления](/azure/backup/backup-azure-vms-first-look-arm/).</span><span class="sxs-lookup"><span data-stu-id="45327-493">For more information, see [Protect Azure VMs with a recovery services vault](/azure/backup/backup-azure-vms-first-look-arm/).</span></span>
* <span data-ttu-id="45327-494">**Включите журналы диагностики**, в том числе базовые метрики работоспособности, а также ведение журналов инфраструктуры и [диагностику загрузки][boot-diagnostics].</span><span class="sxs-lookup"><span data-stu-id="45327-494">**Enable diagnostic logs**, including basic health metrics, infrastructure logs, and [boot diagnostics][boot-diagnostics].</span></span> <span data-ttu-id="45327-495">Если виртуальную машину невозможно загрузить, для обнаружения неисправностей можно использовать диагностику загрузки.</span><span class="sxs-lookup"><span data-stu-id="45327-495">Boot diagnostics can help you diagnose a boot failure if your VM gets into a non-bootable state.</span></span> <span data-ttu-id="45327-496">Дополнительные сведения см. в статье [Сбор и использование данных журнала из ресурсов Azure][diagnostics-logs].</span><span class="sxs-lookup"><span data-stu-id="45327-496">For more information, see [Overview of Azure Diagnostic Logs][diagnostics-logs].</span></span>
* <span data-ttu-id="45327-497">**Используйте расширение AzureLogCollector.**</span><span class="sxs-lookup"><span data-stu-id="45327-497">**Use the AzureLogCollector extension.**</span></span> <span data-ttu-id="45327-498">(Только для виртуальных машин Windows.) Это расширение объединяет журналы платформы Azure и загружает их в службу хранилища Azure без необходимости удаленного входа оператора в виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="45327-498">(Windows VMs only.) This extension aggregates Azure platform logs and uploads them to Azure storage, without the operator remotely logging into the VM.</span></span> <span data-ttu-id="45327-499">Дополнительные сведения см. в статье [Расширение AzureLogCollector](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="45327-499">For more information, see [AzureLogCollector Extension](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

### <a name="virtual-network"></a><span data-ttu-id="45327-500">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="45327-500">Virtual Network</span></span>
* <span data-ttu-id="45327-501">**Чтобы поместить общедоступные IP-адреса в список разрешений или заблокировать их, добавьте NSG в подсеть.**</span><span class="sxs-lookup"><span data-stu-id="45327-501">**To whitelist or block public IP addresses, add an NSG to the subnet.**</span></span> <span data-ttu-id="45327-502">Блокируйте доступ злоумышленников или разрешите доступ только для пользователей с привилегиями для доступа к приложению.</span><span class="sxs-lookup"><span data-stu-id="45327-502">Block access from malicious users, or allow access only from users who have privilege to access the application.</span></span>  
* <span data-ttu-id="45327-503">**Создайте пользовательскую проверку работоспособности.**</span><span class="sxs-lookup"><span data-stu-id="45327-503">**Create a custom health probe.**</span></span> <span data-ttu-id="45327-504">При проверке работоспособности Load Balancer может тестироваться HTTP или TCP.</span><span class="sxs-lookup"><span data-stu-id="45327-504">Load Balancer Health Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="45327-505">Если виртуальная машина работает на HTTP-сервере, проверка HTTP поможет лучше определить состояние работоспособности, чем проверка TCP.</span><span class="sxs-lookup"><span data-stu-id="45327-505">If a VM runs an HTTP server, the HTTP probe is a better indicator of health status than a TCP probe.</span></span> <span data-ttu-id="45327-506">Для проверки HTTP используйте настраиваемую конечную точку, которая сообщает об общей работоспособности приложения, включая все критические зависимости.</span><span class="sxs-lookup"><span data-stu-id="45327-506">For an HTTP probe, use a custom endpoint that reports the overall health of the application, including all critical dependencies.</span></span> <span data-ttu-id="45327-507">Дополнительные сведения см. в разделе [Обзор Azure Load Balancer](/azure/load-balancer/load-balancer-overview/).</span><span class="sxs-lookup"><span data-stu-id="45327-507">For more information, see [Azure Load Balancer overview](/azure/load-balancer/load-balancer-overview/).</span></span>
* <span data-ttu-id="45327-508">**Не блокируйте проверку работоспособности.**</span><span class="sxs-lookup"><span data-stu-id="45327-508">**Don't block the health probe.**</span></span> <span data-ttu-id="45327-509">Проверка работоспособности Load Balancer отправляется с известного IP-адреса — 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="45327-509">The Load Balancer Health probe is sent from a known IP address, 168.63.129.16.</span></span> <span data-ttu-id="45327-510">Не блокируйте входящий и исходящий трафик для этого IP-адреса в каких-либо политиках брандмауэра или правилах группы безопасности сети (NSG).</span><span class="sxs-lookup"><span data-stu-id="45327-510">Don't block traffic to or from this IP in any firewall policies or network security group (NSG) rules.</span></span> <span data-ttu-id="45327-511">При блокировании проверки работоспособности подсистема балансировки нагрузки удаляет виртуальную машину из ротации.</span><span class="sxs-lookup"><span data-stu-id="45327-511">Blocking the health probe would cause the load balancer to remove the VM from rotation.</span></span>
* <span data-ttu-id="45327-512">**Включите ведение журнала для Load Balancer.**</span><span class="sxs-lookup"><span data-stu-id="45327-512">**Enable Load Balancer logging.**</span></span> <span data-ttu-id="45327-513">В журналах показано, сколько виртуальных машин на серверной стороне не получают сетевой трафик из-за неудачных ответов проверки.</span><span class="sxs-lookup"><span data-stu-id="45327-513">The logs show how many VMs on the back-end are not receiving network traffic due to failed probe responses.</span></span> <span data-ttu-id="45327-514">Дополнительные сведения см. в статье [Служба анализа журналов для Azure Load Balancer](/azure/load-balancer/load-balancer-monitor-log/).</span><span class="sxs-lookup"><span data-stu-id="45327-514">For more information, see [Log analytics for Azure Load Balancer](/azure/load-balancer/load-balancer-monitor-log/).</span></span>

<!-- links -->
[app-service-autoscale]: /azure/monitoring-and-diagnostics/insights-how-to-scale/
[asynchronous-c-sharp]: /dotnet/articles/csharp/async
[availability-sets]:/azure/virtual-machines/virtual-machines-windows-manage-availability/
[azure-backup]: https://azure.microsoft.com/documentation/services/backup/
[boot-diagnostics]: https://azure.microsoft.com/blog/boot-diagnostics-for-virtual-machines-v2/
[circuit-breaker]: ../patterns/circuit-breaker.md
[cloud-service-autoscale]: /azure/cloud-services/cloud-services-how-to-scale/
[diagnostics-logs]: /azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs/
[fma]: ../resiliency/failure-mode-analysis.md
[resilient-deployment]: ../resiliency/index.md#resilient-deployment
[load-balancer]: /azure/load-balancer/load-balancer-overview/
[managed-disks]: /azure/storage/storage-managed-disks-overview
[monitoring-and-diagnostics-guidance]: ../best-practices/monitoring.md
[resource-manager]: /azure/azure-resource-manager/resource-group-overview/
[retry-pattern]: ../patterns/retry.md
[retry-service-guidance]: ../best-practices/retry-service-specific.md
[search-optimization]: /azure/search/search-performance-optimization/
[sql-backup]: /azure/sql-database/sql-database-automated-backups/
[sql-restore]: /azure/sql-database/sql-database-recovery-using-backups/
[traffic-manager]: /azure/traffic-manager/traffic-manager-overview/
[traffic-manager-routing]: /azure/traffic-manager/traffic-manager-routing-methods/
[vm-manage-availability]: /azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set
[vmss-autoscale]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/
