# <a name="devops-checklist"></a>Контрольный список DevOps

DevOps — это интеграция операций разработки, контроля качества и ИТ-операций в единую среду и набор параметров для предоставления программного обеспечения. 

Используйте этот контрольный список в качестве отправной точки для оценки языка и региональных параметров, а также процессов DevOps.

## <a name="culture"></a>Язык и региональные параметры

**Обеспечьте выравнивание бизнеса между организациями и командами.** Конфликты за ресурсы, цели и приоритеты внутри организации могут представлять риски для успешного выполнения операций. Убедитесь, что действия всех команд, отвечающих за бизнес-деятельность, разработки и операции, согласованы.

**Убедитесь, что все члены команды разобрались с жизненным циклом программного обеспечения.** Ваша команда должна понимать общий жизненный цикл приложения, а также ее члены должны понимать, на каком этапе жизненного цикла сейчас находится приложение. Благодаря этому все члены команды будут знать, что они должны делать в данный момент, какие планы составлять и к чему готовиться в будущем.

**Сократите время цикла.** Стремитесь свести к минимуму время, необходимое для перехода с этапа идеи на этап готового доступного программного обеспечения. Ограничьте размер и область отдельных выпусков, чтобы поддерживать тестовую нагрузку на низком уровне. По возможности автоматизируйте процессы создания, тестирования, конфигурации и развертывания. Устраните любые препятствия для обмена данными между разработчиками, а также для получения данных из операций для разработчиков. 

**Проанализируйте и оптимизируйте процессы.** Процессы и процедуры (и автоматические, и ручные) никогда не являются окончательными. Установите регулярные проверки текущих рабочих процессов, процедур и документации с целью их непрерывного усовершенствования.

**Выполняйте предварительное планирование.** Заранее готовьтесь к сбою. У вас должны быть предусмотрены процессы, позволяющие быстро выявлять возникающие проблемы, передавать их соответствующим членам команды для устранения и утверждать разрешение.

**Учитесь на ошибках.** Сбои неизбежны, однако важно учиться на ошибках, чтобы не повторять их. Если при работе происходит сбой, рассмотрите проблему, задокументируйте причину и решение, а также поделитесь полученными знаниями. По возможности обновляйте свои процессы создания, чтобы автоматически обнаруживать сбои подобного рода в будущем.

**Выполните оптимизацию для обеспечения быстродействия и сбора данных.** Каждое запланированное улучшение — это гипотеза. Разбивайте работу на как можно меньшие задания. Считайте новые идеи экспериментами. Инструментируйте эксперименты, чтобы иметь возможность собрать рабочие данные для оценки их эффективности. Будьте готовы к быстрому возникновению сбоя, если гипотеза окажется неверной.

**Выделите время для обучения.** И ошибки, и успешное завершение задачи предоставляют хорошие возможности для обучения. Прежде чем переходить к новым проектам, выделите достаточно времени на обдумывание и убедитесь, что ваша команда все усвоила. Кроме того, давайте команде время для приобретения навыков, экспериментирования и изучения новых средств и методов. 

**Документируйте операции.** Документируйте все средства, процессы и автоматизированные задачи с тем же уровнем качества, что и код продукта. Задокументируйте текущий проект и архитектуру любых поддерживаемых систем, а также процессы восстановления и другие процедуры обслуживания. Сосредоточьтесь на выполняемых действиях, а не на теоретически оптимальных процессах. Регулярно просматривайте и обновляйте документацию. При написании кода убедитесь, что значимые комментарии включены, особенно в общедоступных API. По возможности используйте средства для автоматического создания документации по коду. 

**Делитесь знаниями.** Документация полезна, только если пользователи знают, что она имеется, и могут ее найти. Убедитесь, что документация упорядочена и легко доступна. Будьте изобретательны: используйте короткие презентации (неофициальные презентации), видеоролики или информационные бюллетени для обмена знаниями.

## <a name="development"></a>Разработка

**Предоставьте разработчикам среду, максимально приближенную к рабочей.** Если среды для разработки и тестирования не совпадают с рабочей средой, трудно тестировать и диагностировать проблемы. Поэтому настройте среду для разработки и тестирования таким образом, чтобы она была максимально приближена к рабочей. Убедитесь, что данные теста соответствуют данным, используемым в рабочей среде, даже если это пример данных, а не реальные данные о рабочей среде (в целях конфиденциальности или соответствия). Запланируйте создание примера тестовых данных и сделайте его анонимным.

**Убедитесь, что все авторизованные члены команды могут подготовить инфраструктуру и развернуть приложение.** Настройка ресурсов, близких к рабочей среде, и развертывание приложения не должны включать сложных задач, выполняемых вручную, или требовать подробных технических знаний о системе. Любой пользователь с соответствующими разрешениями должен иметь возможность создавать или развертывать ресурсы, близкие к рабочей среде, не обращаясь к группе эксплуатации. 

> Это не означает, что все могут принудительно отправлять обновления в реальном времени в рабочее развертывание. Речь идет об упрощении работы разработчиков и команд контроля качества при создании сред, максимально приближенных к рабочей.

**Инструментуйте приложения для получения аналитики.** Чтобы разобраться с работоспособностью приложения, нужно знать, как оно работает и есть ли в нем какие-либо ошибки или проблемы. Всегда включайте инструментирование в качестве требования к разработке, а также реализуйте эту возможность в приложении с самого начала. Инструментирование должно включать ведение журнала событий для анализа первопричин, а также телеметрию и метрики для мониторинга общей работоспособности и использования приложения.

**Следите за техническими компромиссами.** Во многих проектах расписания выпуска могут получить приоритет над качеством кода в той или иной степени. Не упускайте это из виду. Документируйте любые обходные пути или другие неоптимальные реализации и запланируйте время для пересмотра этих проблем.

**Рассмотрите возможность отправки обновлений непосредственно в рабочую среду.** Чтобы сократить общее время цикла выпуска, рассмотрите возможность отправки правильно тестированных фиксаций кода непосредственно в рабочую среду. Используйте [ротацию функций][feature-toggles] для управления тем, какие функции были включены. Это позволяет быстро перейти от разработки к выпуску, используя переключатели для включения или отключения функций. Переключатели также полезны при выполнении тестов, таких как [ранние выпуски][canary-release], в которых конкретные возможности развертываются в подмножестве рабочей среды.

## <a name="testing"></a>Тестирование

**Автоматизируйте тестирование.** Тестирование программного обеспечения вручную занимает много времени и подвержено ошибкам. Автоматизируйте часто выполняемые задачи тестирования и интегрируйте тесты в процесс создания. Автоматизированное тестирование гарантирует согласованность и воспроизводимость протестированного кода. Встроенные тесты пользовательского интерфейса также должны выполняться автоматическим средством. Azure предлагает ресурсы для разработки и тестирования, которые могут помочь в настройке и тестировании. Дополнительные сведения см. на странице [Разработка и тестирование][dev-test].

**Выполняйте тестирование на наличие сбоев.** Если системе не удается подключиться к службе, как она отвечает? Можно ли ее восстановить, когда служба снова станет доступна? Сделайте тестирование путем внедрения ошибки стандартной частью проверки в тестовых и промежуточных средах. Когда процесс тестирования и методы станут отлаженными, рассмотрите возможность выполнения этих тестов в рабочей среде. 

**Выполняйте тестирование в рабочей среде.** Процесс выпуска не ограничивается развертыванием в рабочую среду. У вас должны быть предусмотрены тесты, гарантирующие, что развернутый код работает должным образом. Для развертываний, которые обновляются нечасто, планируйте тестирование рабочей среды в рамках обычного обслуживания.

**Автоматизируйте тестирование производительности, чтобы раньше идентифицировать проблемы производительности.** Влияние серьезных проблем производительности может быть таким же серьезным, как и ошибка в коде. Хотя автоматизированные функциональные тесты могут предотвращать ошибки приложений, но они могут не обнаруживать проблемы с производительностью. Определите приемлемые показатели производительности для таких метрик, как задержка, время загрузки и потребление ресурсов. Включите автоматизированные тесты производительности в конвейере выпуска, чтобы убедиться, что приложение соответствует указанным целям.

**Выполните тестирование емкости.** Приложение может работать нормально в условиях тестирования, а затем могут появиться проблемы в рабочей среде из-за ограничений масштаба или ресурсов. Всегда определяйте максимальные ожидаемые ограничения емкости и использования. Выполните тестирование, чтобы убедиться, что приложение может справиться с этими ограничениями, а также проверьте, что происходит, когда эти ограничения превышаются. Тестирование емкости должно проводиться с регулярными интервалами.

После первоначального выпуска нужно выполнять тесты производительности и емкости всякий раз при обновлении кода рабочей среды. Используйте исторические данные для точной настройки тестов и определения того, какие типы тестов необходимо выполнить.

**Выполняйте автоматические тесты на проникновение в систему безопасности.** Обеспечение безопасности приложения так же важно, как и тестирование любых других функций. Сделайте автоматический тест на проникновение стандартной частью процесса создания и развертывания. Планируйте регулярные тесты на проникновение и сканирование уязвимостей в развернутых приложениях, а также мониторинг открытых портов, конечных точек и атак. Автоматическое тестирование не устраняет необходимость в подробных проверках безопасности через регулярные промежутки времени.

**Выполняйте автоматическое тестирование непрерывности бизнес-процессов.** Разработайте тестирование непрерывности бизнес-процессов в больших масштабах, включая восстановление резервной копии и отработку отказа. Настройте автоматизированные процессы для регулярного выполнения этих тестов.

## <a name="release"></a>Release

**Автоматизируйте развертывания.** Автоматизируйте развертывание приложения в тестовую, промежуточную и рабочую среду. Автоматизация обеспечивает более быстрое, надежное и согласованное развертывание в любую поддерживаемую среду. Таким образом устраняется риск человеческой ошибки, вызванной развертываниями вручную. При этом также упрощается своевременное планирование выпусков, позволяющее свести к минимуму любые последствия потенциального времени простоя.

**Используйте непрерывную интеграцию.** Непрерывная интеграция — это способ объединения всего кода разработчика в центральной базе кода на основе регулярного расписания, а затем автоматического выполнения стандартных процессов сборки и тестирования. Непрерывная интеграция гарантирует, что вся группа может работать в базе кода одновременно и без конфликтов. Она также гарантирует, что дефекты кода обнаруживаются как можно раньше. Предпочтительно, чтобы процесс непрерывной интеграции выполнялся каждый раз, когда код фиксируется или записывается после изменения. Он должен выполняться по крайне мере один раз в день.

> Попробуйте внедрить [модель разработки на основе магистралей][trunk-based]. В этой модели разработчики фиксируют одну ветвь (магистраль). Есть требование, которое обязывает никогда не прерывать создание. Эта модель облегчает непрерывную интеграцию, так как все задания по функции выполняются в магистрали, а любые конфликты слияния разрешаются при фиксации.

**Рассмотрите возможность использования непрерывной поставки.** Непрерывная поставка — это метод обеспечения постоянной готовности кода к развертыванию путем автоматического создания, тестирования и развертывания кода в рабочих средах. Добавление непрерывной поставки для создания полного конвейера непрерывной интеграции и поставки поможет быстро определять дефекты кода, а также гарантировать, что правильно протестированные обновления могут быть выпущены за очень короткое время.

> Непрерывное *развертывание* — это дополнительный процесс, который автоматически принимает все обновления, прошедшие через конвейер непрерывной интеграции и поставки, и развертывает их в рабочей среде. Непрерывное развертывание требует надежного автоматического тестирования и расширенного планирования процессов и может подходить не для всех команд.

**Вносите небольшие изменения поэтапно.** При значительных изменениях кода есть большая вероятность возникновения ошибок. По возможности вносите небольшие изменения. Это ограничивает потенциальное влияние каждого изменения и упрощает анализ и отладку любых проблем.

**Управляйте доступностью изменений.** Убедитесь, что вы контролируете, когда обновления видны пользователям. Рассмотрите возможность использования ротации функций, чтобы контролировать процесс включения функций для пользователей.

**Реализуйте стратегии управления выпусками, чтобы снизить риск при развертывании.** Развертывание обновления приложения в рабочую среду всегда влечет за собой определенный риск. Чтобы свести его к минимуму, используйте стратегии, такие как [ранние выпуски][canary-release] или [развертывания Blue-Green][blue-green], для развертывания обновлений для подмножества пользователей. Убедитесь, что обновление работает ожидаемым образом, а затем разверните его в остальные части системы.

**Документируйте все изменения.** Незначительные изменения и изменения конфигурации могут стать источником неточностей и конфликтов версий. Всегда храните отчет о любых изменениях, независимо от их размера. Записывайте в журнал все изменения, включая примененные исправления, изменения политики и конфигурации. (Не включайте конфиденциальные данные в эти журналы. Например, запишите в журнал, что учетные данные были обновлены, кто внес изменения, но не записывайте обновленные учетные данные.) Запись об изменении должна быть видна всей команде. 

**Автоматизируйте развертывания.** Автоматизируйте все развертывания и используйте системы для обнаружения каких-либо проблем во время развертывания. У вас должен быть предусмотрен процесс устранения рисков для сохранения имеющегося кода и данных в рабочей среде, прежде чем обновление заменит их во всех рабочих экземплярах. Разработайте автоматизированный способ наката исправлений или отката изменений.

**Рассмотрите возможность использования неизменяемой инфраструктуры.** Неизменяемая инфраструктура — это принцип, согласно которому не следует изменять инфраструктуру после ее развертывания в рабочей среде. В противном случае может произойти ситуация, в которой были применены ситуативные изменения, затрудняющие точное определение того, что изменилось. Неизменяемая инфраструктура выполняется путем замены целых серверов в качестве части любого нового развертывания. Это позволяет тестировать и развертывать код и среду узла в качестве блока. После развертывания компоненты инфраструктуры не изменяются до следующего цикла создания и развертывания. 

## <a name="monitoring"></a>Мониторинг

**Сделайте системы отслеживаемыми.** Рабочая группа всегда должна иметь четкое представление о работоспособности и статусе системы или службы. Настройте внешние конечные точки работоспособности для мониторинга состояния и убедитесь, что приложения закодированы для инструментирования метрик операций. Используйте общую согласованную схему, которая позволит сопоставлять события в различных системах. [Система диагностики Azure][azure-diagnostics] и [Application Insights][app-insights] — это стандартные методы отслеживания работоспособности и состояния ресурсов Azure. [Operations Management Suite][oms] также обеспечивает централизованный мониторинг и управление для облачных или гибридных решений.

**Вычисляйте и коррелируйте журналы и метрики.** Правильно инструментированная система телеметрии обеспечит большое количество необработанных данных производительности и журналов событий. Убедитесь, что данные телеметрии и журнала быстро обрабатываются и коррелируются, чтобы члены группы эксплуатации всегда имели актуальное представление о состоянии системы. Упорядочивайте и показывайте данные таким образом, чтобы обеспечить четкое представление о любых проблемах и, по возможности, можно было точно определить, связаны ли события друг с другом.

> Просмотрите корпоративную политику хранения, чтобы получить данные о требованиях к обработке данных и времени их хранения. 

**Реализуйте автоматические оповещения и уведомления.** Настройте такие средства мониторинга, как [Azure Monitor][azure-monitor], чтобы обнаруживать шаблоны или условия, которые указывают на потенциальные или имеющиеся проблемы, и отправлять оповещения членам команды, которые могут устранить проблемы. Настройте оповещения таким образом, чтобы избежать ложных срабатываний.

**Отслеживайте срок действия ресурсов.** Некоторые ресурсы, такие как сертификаты, становятся недействительными через определенное количество времени. Обязательно отслеживайте ресурсы, срок действия которых истекает, когда он истекает и какие службы или возможности зависят от этих ресурсов. Используйте автоматизированные процессы для мониторинга этих ресурсов. Уведомите рабочую группу до истечения срока действия ресурса и начните эскалацию, если истечение срока действия может нарушить работу приложения.

## <a name="management"></a>управления

**Автоматизируйте задачи операций.** Обработка повторяющихся операций вручную сопровождается частыми ошибками. По возможности автоматизируйте эти задачи, чтобы обеспечить согласованное выполнение и высокое качество. Код, который реализует автоматизацию, должен управляться системой управления версиями. Как и любой другой код, средства автоматизации нужно протестировать.

**Примените подход "инфраструктура как код" при подготовке.** Минимизируйте объем ручной настройки, необходимой для подготовки ресурсов. Вместо этого используйте скрипты и шаблоны [Azure Resource Manager][resource-manager]. Храните скрипты и шаблоны в системе управления версиями, как и любой другой поддерживаемый вами код. 

**Рассмотрите возможность использования контейнеров.** Контейнеры предоставляют стандартный интерфейс на основе пакета для развертывания приложений. Используя контейнеры, приложение развертывается с применением автономных пакетов, которые включают программное обеспечение, зависимости и файлы, необходимые для запуска приложения, что значительно упрощает процесс развертывания. 

Контейнеры также создают уровень абстракции между приложением и базовой операционной системой, обеспечивающий согласованность во всех средах. Эта абстракция может также изолировать контейнер от других процессов или приложений, выполняемых на узле. 

**Реализуйте механизмы устойчивости и самовосстановления.** Устойчивость — это способность приложения восстанавливаться после сбоев. Стратегии обеспечения устойчивости включают повторы в случае временных сбоев и выполнение отработки отказа во вторичный экземпляр или даже в другой регион. Дополнительные сведения см. в статье [Проектирование устойчивых приложений для Azure][resiliency]. Инструментируйте приложения, чтобы они сразу сообщали о проблемах и вы могли управлять сбоями или другими ошибками системы.

**Создайте руководство по эксплуатации.** Руководство по эксплуатации или *runbook*  документирует процедуры и информацию управления, необходимую сотрудникам для обслуживания системы. Кроме того, документируются любые сценарии операций и планы по устранению рисков, используемые во время сбоя или другого прерывания работы службы. Создайте эту документацию во время разработки и поддерживайте ее в актуальном состоянии. Этот документ динамичен, его следует проверять, тестировать и регулярно совершенствовать. 

Предоставление общего доступа к документации — критически важно. Поощряйте членов команды вносить свой вклад и делиться знаниями. Вся команда должна иметь доступ к документам. Упростите этот процесс для всей команды, чтобы помочь обеспечить обновление документов.

**Документируйте процедуры вызова.** Удостоверьтесь, что обязанности, расписания и процедуры по вызову документированы и переданы всем членам команды. Постоянно обновляйте эту информацию.

**Документируйте процедуры эскалации для сторонних зависимостей.** Если ваше приложение зависит от внешних сторонних служб, которые не контролируются напрямую, составьте план устранения сбоев. Создайте документацию для запланированных процессов устранения неполадок. Включите контакты службы поддержки и пути эскалации.

**Используйте управление конфигурацией.** Изменения конфигурации должны быть запланированы, видимы для операций и записываться. Это можно реализовать в форме базы данных управления конфигурацией или подхода "конфигурация как код". Нужно регулярно проводить аудит конфигурации, чтобы убедиться, что ожидаемые показатели совпадают с фактическими.

**Получите план поддержки Azure и ознакомьтесь с процессом.** Azure предлагает ряд [планов поддержки][azure-support-plans]. Определите план в соответствии с требованиями и убедитесь, что вся команда знает, как его использовать. Члены команды должны понимать детали плана, как предоставляется поддержка и как отправить запрос в службу поддержки с помощью Azure. Если вы ожидаете масштабного мероприятия, служба поддержки Azure может помочь вам с увеличением ограничений службы. Дополнительные сведения см. на странице [Часто задаваемые вопросы о поддержке Azure](https://azure.microsoft.com/en-us/support/faq/).

**Следуйте принципам наименьших привилегий при предоставлении доступа к ресурсам.** Соблюдайте осторожность при управлении доступом к ресурсам. По умолчанию доступ должен быть запрещен, если пользователю явно не предоставлен доступ к ресурсу. Предоставляйте пользователям доступ только к тем ресурсам, которые им нужны для выполнения своих задач. Отслеживайте разрешения пользователей и проводите регулярный аудит безопасности.

**Используйте контроль доступа на основе ролей.** Не следует назначать учетные записи пользователей и доступ к ресурсам вручную. Используйте такой метод предоставления доступа, как [управление доступом на основе ролей][rbac], в котором используются удостоверения и группы [Azure Active Directory][azure-ad]. 

**Используйте систему отслеживания ошибок для отслеживания проблем.** Без эффективного способа отслеживания ошибок легко пропустить элементы, дублировать работу или вызвать дополнительные проблемы. Не полагайтесь на "живое" общение для отслеживания состояния ошибок. Используйте средство отслеживания ошибок, чтобы записывать сведения о проблемах, назначать ресурсы для их устранения и предоставлять журнал аудита с данными о прогрессе и состоянии. 

**Управляйте всеми ресурсами в системе управления изменениями.** Все аспекты вашего процесса DevOps должны быть включены в систему управления и контроля версий для простого отслеживания изменений и их аудита. Это включает в себя код, инфраструктуру, конфигурацию, документацию и скрипты. Все эти типы ресурсов следует рассматривать как код во время тестирования, сборки или проверки. 

**Используйте контрольные списки.** Создавайте контрольные списки операций, чтобы обеспечить соблюдение процессов. В большом руководстве обычно можно что-то пропустить. Соблюдая требования контрольного списка, можно обратить внимание на детали, которые в противном случае могли бы быть упущены. Ведите контрольные списки и постоянно ищите способы автоматизации задач и оптимизации процессов.

Дополнительные сведения о DevOps см. в статье [What is DevOps?][what-is-devops] (Что такое DevOps?) на сайте Visual Studio.

<!-- links -->

[app-insights]: /azure/application-insights/
[azure-ad]: https://azure.microsoft.com/services/active-directory/
[azure-diagnostics]: /azure/monitoring-and-diagnostics/azure-diagnostics
[azure-monitor]: /azure/monitoring-and-diagnostics/monitoring-overview
[azure-support-plans]: https://azure.microsoft.com/support/plans/
[blue-green]: https://martinfowler.com/bliki/BlueGreenDeployment.html
[canary-release]:https://martinfowler.com/bliki/CanaryRelease.html
[dev-test]: https://azure.microsoft.com/solutions/dev-test/
[feature-toggles]: https://www.martinfowler.com/articles/feature-toggles.html
[oms]: https://www.microsoft.com/cloud-platform/operations-management-suite
[rbac]: /azure/active-directory/role-based-access-control-what-is
[resiliency]: ../resiliency/index.md
[resource-manager]: /azure/azure-resource-manager/
[trunk-based]: https://trunkbaseddevelopment.com/
[what-is-devops]: https://www.visualstudio.com/learn/what-is-devops/
