---
title: Управление удостоверениями для мультитенантных приложений
description: Рекомендации по аутентификации, авторизации и управлению удостоверениями в мультитенантных приложениях.
author: MikeWasson
ms.date: 07/21/2017
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.openlocfilehash: f8875612ad6b1a71fdb6f7a768078ae599eb70b5
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54480565"
---
# <a name="manage-identity-in-multitenant-applications"></a>Управление удостоверением в мультитенантных приложениях

В этом цикле статей описываются рекомендации по архитектуре обслуживания одним экземпляром приложения нескольких развертываний, когда Azure AD используется для аутентификации и управления удостоверениями.

[![GitHub](../_images/github.png) Пример кода][sample-application]

При создании мультитенантного приложения одной из первейших задач является управление удостоверениями пользователей, так как теперь каждый пользователь относится к клиенту. Например: 

- Пользователи входят с использованием учетных данных организации.
- У пользователей должен быть доступ к их данным в организации, но не к данным, относящимся к другим клиентам.
- Организация может зарегистрироваться для использования приложения, а затем назначить роли приложения своим участникам.

В Azure Active Directory (Azure AD) имеется несколько удобных функций, которые делают возможными все эти сценарии.

Для этого цикла статей мы создали комплексную [сквозную реализацию][sample-application] мультитенантного приложения. Статьи отражают то, что мы узнали в процессе создания приложения. Чтобы приступить к работе с приложением, см. статью [Запуск приложения Surveys][running-the-app].

## <a name="introduction"></a>Введение

Предположим, что вы разрабатываете корпоративное приложение SaaS, которое будет размещено в облаке. Конечно, в приложении будут существовать пользователи.

![Пользователи](./images/users.png)

Эти пользователи принадлежат организациям.

![Пользователи организации](./images/org-users.png)

Пример: Tailspin продает подписки на свое приложение SaaS. Contoso и Fabrikam регистрируются для использования приложения. Когда Элис (`alice@contoso`) выполняет вход, приложение должно знать, что она является пользователем Contoso.

- Элис *должна* иметь доступ к данным компании Contoso.
- У Элис *не должно* быть доступа к данным компании Fabrikam.

Из этого руководства вы узнаете, как управлять удостоверениями пользователей в мультитенантном приложении, используя [Azure Active Directory (Azure AD)](/azure/active-directory) для обработки операций входа и аутентификации.

<!-- markdownlint-disable MD026 -->

## <a name="what-is-multitenancy"></a>Что такое мультитенантность?

<!-- markdownlint-enable MD026 -->

*Клиент* — это группа пользователей. В приложении SaaS клиентом является подписчик или заказчик приложения. *Мультитенантность* представляет собой архитектуру использования несколькими клиентами одного физического экземпляра приложения. Несмотря на то, что клиенты совместно используют физические ресурсы (например виртуальные машины и хранилище данных), каждый клиент получает собственный логический экземпляр приложения.

Как правило, данные приложения являются общими для пользователей в пределах конкретного клиента, но не в других клиентах.

![Мультитенантное приложение](./images/multitenant.png)

Сравним эту архитектуру с однотенантной архитектурой, где клиент имеет выделенный физический экземпляр. В однотенантной архитектуре добавление клиентов осуществляется путем развертывания новых экземпляров приложения.

![Однотенантное приложение](./images/single-tenant.png)

### <a name="multitenancy-and-horizontal-scaling"></a>Мультитенантность и горизонтальное масштабирование

Масштабирование в облаке чаще всего достигается за счет добавления дополнительных физических экземпляров. Это известно как *горизонтальное масштабирование* или *развертывание*. Рассмотрим веб-приложение. Для обработки большего объема трафика можно добавить дополнительные серверные виртуальные машины и разместить их за балансировщиком нагрузки. На каждой виртуальной машине запущен отдельный физический экземпляр веб-приложения.

![Балансировка нагрузки веб-сайта](./images/load-balancing.png)

Запросы могут направляться в любой экземпляр. Вся система функционирует как единый логический экземпляр. Процессы удаления ВМ или запуска новой ВМ не нарушают работу пользователей. В этой архитектуре каждый физический экземпляр является мультитенантным, а масштабирование осуществляется путем добавления дополнительных экземпляров. Если какой-либо экземпляр выходит из строя, он не влияет на клиенты.

## <a name="identity-in-a-multitenant-app"></a>Идентификация в мультитенантном приложении

В мультитенантном приложении пользователей необходимо рассматривать в контексте клиентов.

### <a name="authentication"></a>Authentication

- Пользователи входят в приложение с использованием учетных данных организации. Им не нужно создавать профили пользователей для приложения.
- Пользователи одной организации являются частью одного и того же клиента.
- Когда пользователь входит в систему, приложение знает, какому клиенту он принадлежит.

### <a name="authorization"></a>Авторизация

- При авторизации действий пользователя (например просмотра ресурса) приложение должно учитывать клиент пользователя.
- Пользователям могут быть назначены роли в приложении, такие как "Администратор" или "Обычный пользователь". Назначениями ролей должен управлять клиент, а не поставщик SaaS.

**Пример.** Элис, сотрудник компании Contoso, переходит к приложению в браузере и нажимает кнопку "Вход". Она перенаправляется на экран входа, где вводит свои корпоративные учетные данные (имя пользователя и пароль). Она выполнила вход в приложение как `alice@contoso.com`. Приложению также известно, что Элис является администратором этого приложения. Так как она имеет права администратора, она может просмотреть список всех ресурсов, принадлежащих компании Contoso. Однако она не может просмотреть ресурсы компании Fabrikam, так как является администратором только в рамках своего клиента.

В этом руководстве мы отдельно рассмотрим использование Azure AD для управления удостоверениями.

- Предполагается, что клиент хранит профили пользователей в Azure AD (включая клиенты Office 365 и Dynamics CRM).
- Клиенты с локальной службой Active Directory (AD) могут использовать [Azure AD Connect](/azure/active-directory/hybrid/whatis-hybrid-identity) для синхронизации локальной службы AD с Azure AD.

Если клиент с локальной службой AD не может использовать Azure AD Connect (ввиду особенностей корпоративной ИТ-политики или по другим причинам), поставщик SaaS может создать федерацию с AD с помощью служб федерации Active Directory (AD FS). Эта возможность описана в статье [Федерация со службой AD FS клиента](adfs.md).

В этом руководстве не учитываются другие аспекты мультитенантности, такие как секционирование данных, конфигурация для отдельных клиентов и т. д.

[**Далее**](./tailspin.md)

<!-- links -->

[sample-application]: https://github.com/mspnp/multitenant-saas-guidance
[running-the-app]: ./run-the-app.md
